/**** v6.1.34, build: 04/29/2019 ****/
!function(e,t){function r(e,t){if(r.hooks[e])return t?r.hooks[e].apply(null,t):r.hooks[e].apply();if(0===e.indexOf("draw.")||0===e.indexOf("place.")){Jt(e);return!0}var n=r.wildcardHooks;for(var i in n)if(new RegExp(i).test(e))return n[i](e,t);return!1}function n(e){return navigator.userAgent.indexOf(e)}function a(e,t){this.x=+e||0;this.y=+t||0}function o(e){return e?t.getElementById(e):null}function s(e,r){if(!e||"#"==e)return[];try{return(r||t).querySelectorAll(e)}catch(e){return[]}}function c(e,r){if(!e||"#"==e)return null;try{return(r||t).querySelector(e)}catch(e){return null}}function l(e,t,r){if(e&&t){var n,i,a,o,s;a=t?t.split(/\s+/):[];s=r?"add":!1===r?"remove":"toggle";if(e.classList&&e.classList.toggle)for(n=0;n<a.length;n++)a[n]&&e.classList[s](a[n]);else{var c="object"==typeof e.className,l=c?e.className.baseVal:e.className;i=l?l.split(/\s+/):[];for(n=0;n<a.length;n++)if(a[n]){o=i.indexOf(a[n]);o<0?"remove"!=s&&i.push(a[n]):"add"!=s&&i.splice(o,1)}l=i.join(" ");c?e.className.baseVal=l:e.className=l}}}function h(e,t){if(e.classList)return e.classList.contains(t);var r="object"==typeof e.className?e.className.baseVal:e.className;return t&&r&&r.split(/\s+/).indexOf(t)>=0}function f(e,t){if(e&&t){var r,n=t?t.split(/\s+/):[];if(e.classList)for(r=0;r<n.length;r++)n[r]&&e.classList.add(n[r]);else{var i="object"==typeof e.className,a=i?e.className.baseVal:e.className,o=a?a.trim().split(/\s+/):[];for(r=0;r<n.length;r++)n[r]&&o.indexOf(n[r])<0&&o.push(n[r]);a=o.join(" ");i?e.className.baseVal=a:e.className=a}}}function u(e,t){var r,n,i=t?t.split(/\s+/):[];if(e.classList)for(r=0;r<i.length;r++)i[r]&&e.classList.remove(i[r]);else{var a="object"==typeof e.className,o=a?e.className.baseVal:e.className,s=o?o.trim().split(/\s+/):[];for(r=0;r<i.length;r++){n=s.indexOf(i[r]);n>=0&&s.splice(n,1)}o=s.join(" ");a?e.className.baseVal=o:e.className=o}}function p(e){if(e&&e.parentNode)return e.parentNode.removeChild(e)}function g(e,t){return e&&e.cloneNode(!1!==t)}function v(e,t,r){if(!e)return null;var n,i,a,o,s=arguments.length;if(e.tagName){if("string"==typeof t){if(2===s)return e.getAttribute(t);if(t.indexOf(":")>0){i=t.substr(0,t.indexOf(":"));if(i in Zn){a=t.substr(i.length+1);Ri?e.setAttributeNS(Zn[i],t,r):e.setAttributeNS(Zn[i],a,r)}}else{e.setAttribute(t,r);if(""===r||null===r||void 0===r){"transform"===t&&e.setAttribute(t,"");e.removeAttribute(t)}}return e}for(n in t)if(w(t,n))if(n.indexOf(":")>0){i=n.substr(0,n.indexOf(":"));if(i in Zn){a=n.substr(i.length+1);""===t[n]?e.hasAttributeNS(Zn[i],a)&&e.removeAttributeNS(Zn[i],a):Ri?e.setAttributeNS(Zn[i],n,t[n]):e.setAttributeNS(Zn[i],a,t[n])}}else if(""===t[n]){if(e.hasAttribute(n)){"transform"===n&&e.setAttribute(n,"");e.removeAttribute(n)}}else e.setAttribute(n,t[n]);return e}if(Array.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection||Gi&&"number"==typeof e.length){if("string"==typeof t&&2==s)return e[0]?v(e[0],t):null;if(2==s)for(o=0;o<e.length;o++)v(e[o],t);else if(s>=3)for(o=0;o<e.length;o++)v(e[o],t,r);return e}}function m(e,t){if(!e||!t)return e;if(e.removeAttribute)e.removeAttribute(t);else if(e.length)for(var r=0,n=e.length;r<n;r++)e[r]&&e[r].removeAttribute&&e[r].removeAttribute(t)}function _(e){var t,r=e.attributes,n=r?r.length:0,i={};for(t=0;t<n;t++){var a=r[t].name;a.match(/[a-z]/)||(a=a.toLowerCase());i[a.toLowerCase()]=r[t].value}return i}function b(e){var t,r,n;for(t=e.childNodes,r=t.length-1,n="";r>=0;r--){n=t[r].tagName;if(!n||n.indexOf(":")>0||"script"===n||"metadata"===n)e.removeChild(t[r]);else{S(t[r]);t[r].childNodes.length>0&&"text"!==n&&"tspan"!==n&&b(t[r])}}}function S(e){var t,r=e.attributes,n=r.length,i={};for(t=n-1;t>=0;t--)if(r[t].nodeName.indexOf(":")>0){var a=r[t].namespaceURI;if(a in Zn){if(!1===/^c:|^xlink:|^xml:|^xmlns:/.test(r[t].nodeName))try{if(a===NS_c){if(r[t].prefix!==Zn[NS_c]){i[Zn[NS_c]+":"+r[t].localName]=r[t].nodeValue;e.removeAttributeNode(r[t])}}else e.removeAttributeNode(r[t])}catch(e){parent.$.messager.alert(e.message)}}else e.removeAttributeNode(r[t])}else if(0===r[t].nodeName.indexOf("on"))try{e.removeAttributeNode(r[t])}catch(e){parent.$.messager.alert(e.description)}v(e,i)}function C(e,t){for(var r,n=[],i=[],a=[],o=0,s=e.length;o<s;o++){n[o]=o;r=t?e[o][t]:e[o];i[o]=r.toUpperCase().match(/\D+|\d+(?:\.\d+)?/g);a[o]=[];if(i[o])for(var c=0;c<i[o].length;c++)a[o][c]=i[o][c].match(/\d/)?1:2}var l=function(e,t){var r=i[e],n=i[t],o=a[e],s=a[t];if(!r||!n)return r==n?0:r?1:-1;for(var c=0,l=Math.max(r.length,n.length);c<l;c++){if(!r[c])return-1;if(!n[c])return 1;if(r[c]!=n[c])return o[c]!=s[c]?1==o[c]?-1:1:1==o[c]?r[c]-n[c]:r[c]<n[c]?-1:1}return 0};n.sort(l);var d=[];for(o=0;o<s;o++)d[o]=e[n[o]];return d}function P(e){return t.createTextNode(e||"")}function w(e,t){return!!e&&e.hasOwnProperty(t)}function N(e){try{return JSON.parse(e)}catch(e){return null}}function A(e){try{return e?JSON.parse(JSON.stringify(e)):e}catch(t){return e}}function k(e,t){if(!e)return null;t=!0===t;try{var r=(new DOMParser).parseFromString(e,"text/xml");if(!r||r.querySelector("parsererror")){!t&&(parent.$||self.$).messager.error("ERROR: svg parsererror");return null}return r}catch(e){!t&&(parent.$||self.$).messager.error("ERROR: svg parsererror");return null}}function O(){for(var e=[],t=Jn.children,r=ya==ii.PCB||ya==ii.PCBLIB||ya==ii.PCBMODULE,n=0,i=t.length;n<i;n++){var a=t[n];if(1===a.nodeType&&a.id){if(r){var o=ee(a);if(!o||"RATLINE"==o)continue}e.push(a.id)}}return e}function T(){for(var e=s("[id]",Jn),t=0,r=/^[^\d]*(\d+)$/,n=0,i=e.length;n<i;n++)if(r.test(e[n].id)){var a=+RegExp.$1;a&&(t=Math.max(t,a))}return t}function L(e){return(e||"").replace(/[ ,]{2,}| /g,",").split(",")}function I(e){for(var t=[],r=L(e),n=r.length-1,i=0;i<n;i+=2)t[i/2]=new a(+r[i],+r[i+1]);return t}function E(e,t){var r;t&&t.match(/^PCB/i)&&(r={decimalPlaces:4});if(e&&e.length>=2){for(var n=[],i=0;i<e.length;i++)e[i]&&n.push(ji.formatLengthSave(e[i].x,r),ji.formatLengthSave(e[i].y,r));return n.join(" ")}return""}function M(e){return e.x+"_"+e.y}function V(){}function B(e){return Array.isArray(e)||e&&"object"==typeof e&&"[object String]"!=Object.prototype.toString.call(e)&&"number"==typeof e.length&&e.length>=0&&e.length<4294967296&&e.length%1==0}function G(e){return Array.isArray(e)}function F(e){return e?e.trim?e.trim():e.replace(/^\s+|\s+$/g,""):""}function R(e){for(var t,r=e;r!=t;){t=r;r=t.replace(/~|\^\^|#@\$|`|#sheet#/gi,"")}return r}function D(e,t){var r;for(r in e)if(w(e,r)&&w(t,r)&&e[r]===t[r]){delete e[r];delete t[r]}}function H(e){if(null===e||void 0===e||""===e)return"";e=W(e);return e}function j(e,t){var r;for(var n in t)if(w(t,n)&&-1!==e.indexOf(n)){r=!0;break}return r}function U(e){function t(e){return r[e]}if("string"!=typeof e)return e;if(void 0===e||null===e)return"";var r={"~":"&#126;","^":"&#94;","#@$":"&#35;&#64;&#36;","`":"&#96;"};return j(e,r)?e.replace(/(\~|\^|#@\$|\`)/g,t):e}function z(e){function t(e){return r[e]}if("string"!=typeof e)return e;if(void 0===e||null===e)return"";var r={"&#126;":"~","&#94;":"^","&#35;&#64;&#36;":"#@$","&#96;":"`","&apos;":"'","&APOS;":"'"};return void 0===e||null===e?"":j(e,r)?(e+"").replace(/(&#96;|&#126;|&#94;|&#35;&#64;&#36;|&apos;)/gi,t):e}function X(e){function t(e){return r[e]}if("string"!=typeof e)return e;if(void 0===e||null===e)return"";var r={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","&":"&amp;","&#039;":"'"};return void 0===e||null===e?"":j(e,r)?(e+"").replace(/[<>'"&]/g,t):e}function Y(e){function t(e){return r[e]}if("string"!=typeof e)return e;if(void 0===e||null===e)return"";var r={"&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&","&#039;":"'"};return j(e,r)?(e+"").replace(/&([^;]+);/g,t):e}function W(e){if(void 0===e||null===e)return"";e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/"/g,"&quot;");e=e.replace(/'/g,"&#039;");return e}function J(e){if(Pi.lsCache)return w(Pi.lsCache,String(e))?Pi.lsCache[e]:null;try{return localStorage.getItem(e)}catch(e){return null}}function K(e,t){if(Pi.lsCache)Pi.lsCache[e]=String(t);else try{localStorage.setItem(e,t)}catch(r){Pi.localStorageDisabled=1;Pi.lsCache={};Pi.lsCache[e]=String(t)}}function q(){function e(e){return navigator.userAgent.indexOf(e)}return e("chromeframe")>0||e("x-clock")>0?"chromeframe":e("MSIE")>0||e("Trident")>=0?"ie":e("Edge/")>0?"edge":e("Electron/")>0?"electron":e("Firefox/")>0?"firefox":0===e("Opera/")?"opera":0===e("Chrome/")?"chrome":0===e("Safari/")?"safari":"other"}function Q(e,t){var r=+e;t="-"!=t?"+":"-";if(r<=0||isNaN(r))return"100";if(r<.1||.1==r&&"-"==t)return"0.1";if(r>1e5||1e5==r&&"+"==t)return"100000";e=r<1?(10+r+"").substr(1):r+"";e=e.replace(/([1-9]\.?\d)(.*)/,function(e,t,r){return t+r.replace(/[1-9]/g,"0")});e.match(/[1-9]$/)&&(e=e.indexOf(".")<0?e+".0":e+"0");var n,i,a=e.match(/([1-9])\.?(\d)/),o=a[1]+a[2],s="--,10,14,20,27,38,54,75,AA".split(",");Ii&&(s="--,10,12,15,17,20,25,30,35,40,50,60,80,90,AA".split(","));for(n=1;n<s.length;n++){if(o==s[n]){i=s["+"==t?n+1:n-1];break}if(o<s[n]){i=s["+"==t?n:n-1];break}}if("AA"==i){i=s[1];e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);e=function(e){return e.indexOf(".")<0?e+"0":e.replace(/\.(\d)/,"$1.").replace(/^0+(?!\.)/,"").replace(/\.$/,"")}(e)}else if("--"==i){i=s[s.length-2];e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);e=function(e){return e.indexOf(".")<0?e.replace(/\d$/,".$&").replace(/^\./,"0."):e.replace(/(\d)\./,".$1").replace(/^\./,"0.")}(e)}else e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);return function(e){return e.indexOf(".")>0?e.replace(/\.?0*$/,""):e}(e)}function Z(e,t){if("canvas"!==t.cmdKey){var r,n=["attr-topic","groupAttr","cmdKey","attr-selected-count","sameType"];t.c_para&&(t.c_para=ji.c_paraToJson(t.c_para));if(!t)return!1;e.sameType=!w(e,"sameType")||e.sameType;t.cmdKey!==e.cmdKey&&(e.sameType=!1);for(r in e){w(e,r)&&!w(t,r)&&-1===n.indexOf(r)&&delete e[r];e[r]!==t[r]&&"c_para"!==r&&-1===n.indexOf(r)&&(e[r]="<...>")}if(e.c_para)if(t.c_para){e.c_para||(e.c_para={});for(r in t.c_para)w(t.c_para,r)&&(w(e.c_para,r)?e.c_para[r]!==t.c_para[r]&&(e.c_para[r]="<...>"):e.c_para[r]="<...>")}else delete e.c_para}}function ee(e){var t=void 0!==ya;t=t?ya:getActiveDoctype();if(t){var r=ji.fileType.getAbstractFileType(t),n=r.match(/^sch/)?ji.getSCHCmdKey(e):ji.getPCBCmdKey(e);yi&&"draw.origin"===yi&&(n="origin");return n}}function te(e){return MD5(Date.now()+Ae(!0,3,32)+e).substr(8,16)}function re(){var e,t=/{([\d\w.]+)}/g,r=Array.prototype.slice.call(arguments),n=r.shift()+"";1==r.length&&"object"==typeof r[0]&&(r=r[0]);t.lastIndex=0;return n.replace(t,function(t,n){e=r[n];return void 0===e?t:e})}function ne(e,t,r){ea.move(e.childNodes[0],t,r);var n,i,a=ji.svg.getBBox(e),o=v(e,"transform"),s=o&&o.match(/scale\(.*?\)/)?o.match(/scale\(.*?\)/)[0]:"",c=s?1*s.match(/scale\((.*?)\)/)[1]:1,l=(o&&o.match(/translate\(.*?\)/)&&o.match(/translate\(.*?\)/)[0],Je(e)),d=l.c_origin;if(d){d=d.split(",");n=d[0];i=d[1]}else{var h=ji.svg.getPlainBBox(e);n=h.x+h.width/2;i=h.y+h.height/2}var f=1*n+1*t,u=1*i+1*r,p=l.c_rotation||0,g=-(a.width*c-a.width)/2/c,y=-(a.height*c-a.height)/2/c;v(e,{transform:re("rotate({rotate}) {scale} translate({translateX}, {translateY})",{scale:s,translateX:-(a.x*c-a.x)/c+g,translateY:-(a.y*c-a.y)/c+y,rotate:p+" "+f+" "+u}),c_origin:f+","+u})}function ie(e,t,r){e=e||Jn;"string"==typeof r&&(r=o(r));r?e.insertBefore(t,r):e.appendChild(t)}function ae(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,c=r.y,l=a-n,d=o-i,h=l*l+d*d,f=((s-n)*l+(c-i)*d)/h;return{x:n+f*l,y:i+f*d}}function oe(e,t,r,n){var i=e.x,a=e.y,o=t.x,s=t.y,c=r.x,l=r.y,d=o-i,h=s-a,f=d*d+h*h;void 0===n&&(n=0);var u=((c-i)*d+(l-a)*h)/f;if(!(u>=1+n||u<=0)){var p=i+u*d,g=a+u*h,y=p-c,v=g-l;return{point:{x:p,y:g},distance2:y*y+v*v}}}function se(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,c=r.y,l=a-n,d=o-i,h=l*l+d*d;if(0===h)return(s-n)*(s-n)+(c-i)*(c-i);var f=((s-n)*l+(c-i)*d)/h,u=n+f*l,p=i+f*d,g=u-s,y=p-c;return g*g+y*y}function ce(e,t,r,n){var i=e.x,a=e.y,o=t.x,s=t.y,c=r.x,l=r.y,d=n.x,h=n.y,f=o-i,u=s-a,p=c-d,g=l-h,y=u*p-f*g;return y?{x:(f*p*(l-a)-c*f*g+i*u*p)/y,y:(u*g*(c-i)-l*u*p+a*f*g)/-y}:null}function le(e,t,r){var n,i,a=e.x,o=e.y,s=-1,c=t.getAttribute("stroke-width")/2;r&&(c+=r);var l,d,h=c*c,f=t.points,u=f.numberOfItems;l=f.getItem(0);if(a==l.x&&o==l.y)return 0;for(var p=0;p<u-1;p++){l=f.getItem(p);d=f.getItem(p+1);if(a==d.x&&o==d.y)return 2*(p+1);if(l.x!=d.x||l.y!=d.y){n=oe(l,d,e);if(n&&n.distance2<=h&&(void 0===i||n.distance2<i)){i=n.distance2;s=2*p+1}}}return s}function de(e,t,r,n){function i(e,t){return e.x==t.x&&e.y==t.y}var a=i(e,r)||i(e,n)?e:i(t,r)||i(t,n)?t:null;if(a)return{x:a.x,y:a.y};var o,s,c,l,d,h,f,u,p;o=t.x-e.x;s=t.y-e.y;c=n.x-r.x;l=n.y-r.y;f=c*s-l*o;if(0===f)return!1;u=r.x-e.x;p=r.y-e.y;h=(o*p-s*u)/f;d=(c*p-l*u)/f;return h>=0&&h<=1&&d>=0&&d<=1&&{x:e.x+d*o,y:e.y+d*s}}function he(e,t){var r={x:+e.x,y:+e.y};gridX=t||+v(o("gridPattern"),"width"),gridY=t||+v(o("gridPattern"),"height"),modx=e.x%gridX,mody=e.y%gridY;if(!gridX||!gridY)return r;if(modx){modx<0&&(modx+=gridX);r.x+=-modx+(modx<gridX/2?0:gridX)}if(mody){mody<0&&(mody+=gridY);r.y+=-mody+(mody<gridY/2?0:gridY)}r.x=ji.toFixed(r.x,2);r.y=ji.toFixed(r.y,2);return r}function fe(e,t,r){if(!t)return null;var n,i,a,o=t.length,s=null,c=t[0].x,l=t[0].y,d=c,h=l,f=e.x,u=e.y;for(n=1;n<o;n++){i=t[n].x;a=t[n].y;c>i&&(c=i);l>a&&(l=a);d<i&&(d=i);h<a&&(h=a)}if(f<c-r||u<l-r||f>d+r||u>h+r)return null;for(n=1;n<o;n++){s=ue(e,t[n-1],t[n]);if(s.d<r)return s}return null}function ue(e,t,r){var n,i,a,o,s,c,l,d=+t.x,h=+t.y,f=+r.x,u=+r.y,p=+e.x,g=+e.y,y=f-d,v=u-h,x=p-d,m=g-h;if(0===y&&0===v)return{d:Math.sqrt(x*x+m*m),point:{x:d,y:h}};n=(x*y+m*v)/(y*y+v*v);if(n<0)return{d:Math.sqrt(x*x+m*m),point:{x:d,y:h}};if(n>1){i=p-f;a=g-u;return{d:Math.sqrt(i*i+a*a),point:{x:f,y:u}}}c=d+n*y;l=h+n*v;o=p-c;s=g-l;return{d:Math.sqrt(o*o+s*s),point:{x:c,y:l}}}function pe(e,t,r,n){var i=e-r,a=t-n;return i*i+a*a}function ge(e,t,r,n){return Math.sqrt(pe(e,t,r,n))}function ye(e,t,r,n){t=+t;r=+r;n=+n;if(void 0===r||void 0===n)return e.slice(0);t=be(t);if(!t)return e.slice(0);for(var i=e.slice(0),a=i.length,o=0;o<a;o++)"number"!=typeof i[o]&&(i[o]-=0);if(!w(Kn,t)){Kn[t]=Math.sin(t*Math.PI/180);qn[t]=Math.cos(t*Math.PI/180)}var s=Kn[t],c=qn[t];for(o=0;o<a;o+=2){var l=i[o],d=i[o+1],h=l-r,f=d-n;i[o]=r+c*h-s*f;i[o+1]=n+c*f+s*h}return i}function ve(e,t,r,n){var i=[e.x,e.y,e.x+e.width,e.y,e.x,e.y+e.height,e.x+e.width,e.y+e.height];i=ye(i,t,r,n);var a={x:Math.min(i[0],i[2],i[4],i[6]),y:Math.min(i[1],i[3],i[5],i[7])};a.width=Math.max(i[0],i[2],i[4],i[6])-a.x;a.height=Math.max(i[1],i[3],i[5],i[7])-a.y;return a}function xe(e,t){var r,n=v(e,"transform");if(!n||n.indexOf("rotate")<0)return 0;r=t?n.match(/rotate\(([\-\+]?[\d\.]+)(?:[,\s]+([\-\+]?[\d\.]+)[,\s]+([\-\+]?[\d\.]+))?\)/):n.match(/rotate\(([\-\+]?[\d\.]+).*?\)/);if(!r)return 0;var i=r[1]%360;i<0&&(i+=360);return t?{ang:i,ox:+r[2],oy:+r[3]}:i}function me(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=e[0]-t[0],o=e[1]-t[1];return[a*i-o*n+t[0],o*i+a*n+t[1]]}function _e(e,t,r){if(null===r)return e;r="string"==typeof r?-parseInt(r):-r;return me(e,t,r*Math.PI/180)}function be(e){return e<0?(360+e%360)%360:e>=360?e%360:e}function Se(e,t,r){var n=e-t;r||(r=1e-10);return(n>0?n:-n)<r}function Ce(e,t){var r=e.x-t.x,n=e.y-t.y;return(r>0?r:-r)<.001&&(n>0?n:-n)<.001}function Pe(e,t){var r=e-t;return(r>0?r:-r)<.1}function we(e,t,r,n,i,a,o){void 0===o&&(o=.001);var s,c,l,d,h,f,u,p;if(Math.abs(t-i)>o){var g=(e*e-n*n+t*t-i*i+a*a-r*r)/(2*(t-i)),y=(e-n)/(t-i);s=1+y*y;c=-2*(e+(g-t)*y);l=e*e+Math.pow(g-t,2)-r*r;p=c*c-4*s*l;if(p>.001){d=(-c+Math.sqrt(p))/(2*s);h=(-c-Math.sqrt(p))/(2*s);f=g-y*d;u=g-y*h}else{if(!(Math.abs(p)<.001))return null;d=-c/(2*s);h=d;f=g-y*d;u=f}}else{if(!(Math.abs(e-n)>o))return null;d=(e*e-n*n+a*a-r*r)/(2*(e-n));h=d;s=1;c=-2*t;l=t*t-r*r+(d-e)*(d-e);p=c*c-4*s*l;if(p>.001){f=(-c+Math.sqrt(p))/(2*s);u=(-c-Math.sqrt(p))/(2*s)}else{if(!(p>-.001))return null;f=-c/(2*s);u=f}}return[{x:d,y:f},{x:h,y:u}]}function Ne(e,t,r){var n=(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x);return n>0?"顺时针":n<0?"逆时针":0===n?"共线":void 0}function Ae(e,t,r){t=t||1;r=r||32;var n="",i=t,a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];e&&(i=Math.round(Math.random()*(r-t))+t);for(var o=0;o<i;o++){pos=Math.round(Math.random()*(a.length-1));n+=a[pos]}return n}function ke(e,t){function r(e,t){return[e[0]-t[0],e[1]-t[1]]}function n(e,t){return e[0]*t[0]+e[1]*t[1]}function i(e){return e[0]*e[0]+e[1]*e[1]}function a(e,t){return i(r(e,t))}function o(e,t,s,c,l){if(!(c<=s+1)){for(var d,h,f,u,p,g=s,y=0,v=e*e,x=[t[s],t[c]],m=r(x[1],x[0]),_=i(m,m),b=s+1;b<c;b++){d=r(t[b],x[0]);u=n(d,m);if(u<=0)p=a(t[b],x[0]);else if(_<=u)p=a(t[b],x[1]);else{f=u/_;h=[x[0][0]+f*m[0],x[0][1]+f*m[1]];p=a(t[b],h)}if(!(p<=y)){g=b;y=p}}if(y>v){l[g]=1;o(e,t,s,g,l);o(e,t,g,c,l)}}}var s,c,l,d,h=e.length,f=[],u=t*t,p=[],g=[];p[0]=e[0];for(s=c=1,d=0;s<h;s++)if(!(a(e[s],e[d])<u)){p[c++]=e[s];d=s}d<h-1&&(p[c++]=e[h-1]);g[0]=g[c-1]=1;o(t,p,0,c-1,g);for(s=l=0;s<c;s++)g[s]&&(f[l++]=p[s]);return f}function Oe(e,t,r){if(e&&!(t.length<=4)){for(var n,i,a=[],o=[],s=[],c=0,l=0,d=t.length;c<d;c+=2){a[l]=[t[c],t[c+1]];o[l]=t[c];s[l]=t[c+1];l++}r<0&&(r=0);if(void 0===r){n=Math.max.apply(null,o)-Math.min.apply(null,o);i=Math.max.apply(null,s)-Math.min.apply(null,s);r=Math.min(.1/Wi,Math.max(.01*n,.01*i));if(!r)return}var h=ke(a,r);if(2*h.length!==d){var f=h.slice(1).join(" ").replace(/,/g," ");"path"===e.tagName?v(e,"d","M"+t[0]+" "+t[1]+" L"+f):"polyline"!==e.tagName&&"polygon"!==e.tagName||v(e,"points",t[0]+" "+t[1]+" "+f)}}}function Te(e){return ji.svg.getViewBBox(e)}function Le(e,t){if(t%360==0)return"";var r=" rotate("+t+","+e.x+","+e.y+")";return 90==t?"translate("+e.height+",0)"+r:180==t?"translate("+e.width+","+e.height+")"+r:270==t?"translate(0,"+e.width+")"+r:""}function Ie(e){return{x:+v(e,"x"),y:+v(e,"y"),width:+v(e,"width"),height:+v(e,"height")}}function Ee(e,t){var r=xe(e),n=be(r+(t||0));v(e,"transform",n?Le(Ie(e),n):"");v(e,"c_rotation",n?360-n:0)}function Me(e){"string"==typeof e||e.tagName&&(e=v(e,"d"));return e.replace(/\,/g," ").replace(/(?=\S)([\+\-A-Z])/gi,"  $1").replace(/([A-Za-z])(?=\S)/g,"$1 ").replace(/^\s+|\s+$/g,"").split(/\s+/g)}function Ve(e){var t=ua.getViewBox();return{x:t[0]+e.x/Wi,y:t[1]+e.y/Wi}}function Be(e){return Ge(e)}function Ge(e){if(e&&e.points){var t,r,n,i,a,o,s,c,l,d,h,f,u,p,g=e.points,y=g.numberOfItems;for(i=y-2;i>=0;i--){t=g.getItem(i);r=g.getItem(i+1);Pe(t.x,r.x)&&Pe(t.y,r.y)&&(0===i?g.removeItem(i+1):g.removeItem(i))}y=g.numberOfItems;for(i=y-2;i>=1;i--){t=g.getItem(i-1);n=g.getItem(i);r=g.getItem(i+1);if(Pe(t.x,n.x)&&Pe(r.x,n.x)){o=t.x+r.x+n.x;s=Math.abs(o-3*r.x);c=Math.abs(o-3*n.x);o=Math.abs(o-3*t.x);l=Math.min(o,s,c);l==o?r.x=n.x=t.x:t.x=l==s?n.x=r.x:r.x=n.x;var v=(t.y+r.y+n.y)/3;o=Math.abs(t.y-v);s=Math.abs(r.y-v);c=Math.abs(n.y-v);l=Math.min(o,s,c);l==o?g.removeItem(i-1):l==s?g.removeItem(i+1):g.removeItem(i)}else if(Pe(t.y,n.y)&&Pe(r.y,n.y)){o=t.y+r.y+n.y;s=Math.abs(o-3*r.y);c=Math.abs(o-3*n.y);o=Math.abs(o-3*t.y);l=Math.min(o,s,c);l==o?r.y=n.y=t.y:t.y=l==s?n.y=r.y:r.y=n.y;g.removeItem(i)}else{o=Math.atan((t.y-n.y)/(t.x-n.x));s=Math.atan((r.y-n.y)/(r.x-n.x));Math.abs(o-s)<Math.PI/180&&g.removeItem(i)}}y=g.numberOfItems;for(i=3;i<y;i++){h=[g.getItem(i-1),g.getItem(i)];for(a=1;a<i-1;a++){f=[g.getItem(a-1),g.getItem(a)];d=de({x:h[0].x,y:h[0].y},{x:h[1].x,y:h[1].y},{x:f[0].x,y:f[0].y},{x:f[1].x,y:f[1].y});if(d){if(1===a&&i===y-1&&Ce(h[1],f[0]))continue;for(u=a;u<i;u++)g.removeItem(a);p=hi.createSVGPoint();p.x=d.x;p.y=d.y;g.insertItemBefore(p,a);i=2;y=g.numberOfItems;break}}}}}function Fe(e,t){var r,n,i=[],a=e.points,o=a.numberOfItems;for(n=0;n<o;n++){r=a.getItem(n);switch(t){case 1:i.push(r.x,r.y);break;case 2:i[n]=[r.x,r.y];break;default:i[n]={x:r.x,y:r.y}}}return i}function Re(e){var t=hi.createSVGPoint();t.x=e.x;t.y=e.y;return t}function De(e){if(e&&(e.length||e.tagName)){e.tagName&&(e=[e]);var t,r,n,i,a,o=e.length;for(n=0;n<o;n++){t=v(e[n],"c_origin");if(t){r=t.split(",");return{x:+r[0],y:+r[1]}}}for(n=0;n<o;n++){a=e[n];switch(a.tagName){case"polyline":case"polygon":var c=L(v(a,"points"));if(c.length>=4)return{x:+c[0],y:+c[1]};break;case"rect":case"image":return{x:+v(a,"x"),y:+v(a,"y")};case"circle":case"ellipse":return{x:+v(a,"cx"),y:+v(a,"cy")};case"line":return{x:+v(a,"x1"),y:+v(a,"y1")}}}for(n=0;n<o;n++){a=e[n];if("path"==a.tagName&&a.pathSegList.numberOfItems){i=a.pathSegList.getItem(0);if(i&&"M"==i.pathSegTypeAsLetter)return{x:ji.formatLengthSave(i.x),y:ji.formatLengthSave(i.y)}}}for(n=0;n<o;n++)if("text"==e[n].tagName)return{x:+v(e[n],"x"),y:+v(e[n],"y")};for(n=0;n<o;n++)if(e[n]&&e[n].children){var l=De(s("*",e[n]));if(l)return l}}}function He(e){var t=ji.svg.getBBox(e);return{x:t.x,y:t.y}}function je(e){var t=_i.canvas.originX,r=_i.canvas.originY,n=ia.getSanpSize("X"),i=ia.getSanpSize("Y"),a=Math.round((e.x-t)/n)*n+t,o=Math.round((e.y-r)/i)*i+r;return{x:ji.formatLengthSave(a),y:ji.formatLengthSave(o)}}function Ue(e,t,r){var n=ia.getSanpSize("X"),i=ia.getSanpSize("Y"),a=je(e);t>0&&a.x<e.x?a.x+=n:t<0&&a.x>e.x&&(a.x-=n);r>0&&a.y<e.y?a.y+=i:r<0&&a.y>e.y&&(a.y-=i);return a}function ze(e,t,r){ea[e.tagName]&&ea[e.tagName](e,t,r)}function Xe(e,t,r){if(!e||!e.length)return!1;for(var n=0;n<e.length;n++)(ea[e[n].tagName]||V)(e[n],t,r);return!0}function Ye(e,t,r){if(e&&"text"==e.tagName&&"string"==typeof t){t.indexOf("\r")>=0&&(t=t.indexOf("\n")>=0?t.replace(/\r/g,""):t.replace(/\r/g,"\n"));void 0===r&&(r="\n");var n,i,a,o="line"==v(e,"c_shapetype")||e.parentNode&&"part_annotation"==v(e.parentNode,"c_partid");if(o){n=t.split(r);i=n.length;a=i>1}else{t=t.replace(/\n/g," ");n=[t];i=1;a=!1}var c=s("tspan",e),l=c.length,d=v(e,"x");if(a){0===l&&e.childNodes[0]&&e.removeChild(e.childNodes[0]);for(;l<i;){e.appendChild(yn("tspan",{x:d,dy:l?"1em":"0","xml:space":"preserve"}));l++}for(;l>i;){l--;c[l].parentNode.removeChild(c[l])}for(;i--;)e.childNodes[i].textContent=n[i]||" ";Ri&&a&&setTimeout(function(){for(var t=s("tspan",e),r=t.length,n=0;n<r;n++)t[n].textContent=t[n].textContent},1)}else{for(;e.lastChild;)e.removeChild(e.lastChild);ji.node.setTextContent(e,t)}}}function We(e,t){if(!e||"text"!==e.tagName)return"";var r=s("tspan",e),n=r.length,i="";void 0===t&&(t="\n");if(n>0){i=r[0].textContent;for(var a=1;a<n;a++)i+=t+r[a].textContent}else i=e.textContent;return i}function Je(e){function t(e){return ji.formatLengthSave(e)+""}if(!e)return null;var r,n=e.attributes,i=n?n.length:0,a={},o=/\d+\.\d{9,}/g,s=/^(?:points|d|x|y|width|height|cx|cy|r|rx|ry|x1|y1|x2|y2|dx|dy|transform|stroke-width|viewBox|c_origin|c_rotation)/;for(r=0;r<i;r++){var c=n[r].name;c.match(/[a-z]/)||(c=c.toLowerCase());s.test(c)?a[c]=n[r].value.replace(o,t):a[c]=n[r].value}return a}function $e(e){if(e&&e.length){var t,r,n,i,a=ua.getViewBox(),o="getBoundingClientRect";for(t=0;t<e.length;t++){r=e[t];if(r){if(r[o]){n=r[o]();if(!n.width&&!n.height)continue;n=[a[0]+n.left/Wi,a[1]+n.top/Wi,a[0]+n.right/Wi,a[1]+n.bottom/Wi]}else{n=ji.svg.getBBox(r);if(!n.width&&!n.height)continue;n=[n.x,n.y,n.x+n.width,n.y+n.height]}i=i?[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]:n.slice(0,4)}}if(i){return{x:i[0],y:i[1],width:i[2]-i[0],height:i[3]-i[1]}}}}function Ke(t,r){if(!t)return!1;var n,i,a,o,c=[],l=e.frameElement,d=l&&l.parentNode,h=d&&"none"!=d.style.display;d&&!h&&(d.style.display="");if(t!=Jn){a=s("[c_note]",t);i=a.length;for(n=0;n<i;n++){c[n]=a[n].style.display;"none"!=c[n]&&(a[n].style.display="none")}o=ji.svg.getBBox(t);for(n=0;n<i;n++)a[n].style.display=c[n]}else{o=ji.svg.getBBox(t);if(!o.width&&!o.height){d=e.frameElement&&e.frameElement.parentNode;if(d){if(!(d.style&&"none"!=d.style.display)){d.style.display="";o=ji.svg.getBBox(t);d.style.display="none"}}}if(!o.width&&!o.height){if(ji.fileType.isLib(ya))Qe(_i.canvas.originX,_i.canvas.originY);else{var f=ua.getViewBox();f[0]=_i.canvas.originX;f[1]=_i.canvas.originY;ua.setViewBox(f)}return}}d&&!h&&(d.style.display="none");o&&(o.width||o.height)&&qe(o,r)}function qe(e,r){if(e&&(e.x||e.y||e.width||e.height)){!r||e.width||e.height||(r=0);var n=e.x+e.width/2,i=e.y+e.height/2,a=t.body.clientWidth||9,o=t.body.clientHeight||9,s=r?Math.min(a/e.width,o/e.height):Wi,c=r&&isFinite(s)?Q(99*s,"-"):100*Wi,l=c/100,d=ua.getViewBox();if(c<.1){c=.1;l=c/100}else if(c>1e5){c=1e5;l=c/100}var h=l!=Wi;d[0]=n-d[2]/2;d[1]=i-d[3]/2;ua.setViewBox(d);h&&Ct("zoom",[c])}}function Qe(e,t){var r=ua.getViewBox();r[0]+=e-(r[0]+r[2]/2);r[1]+=t-(r[1]+r[3]/2);ua.setViewBox(r)}function Ze(e,t){var r=$e(e);r&&et(r,t)}function et(e,t){var r=e.x,n=e.y,i=r+e.width,a=n+e.height,o=ua.getViewBox();t=isFinite(t)?t/Wi:20/Wi;r-=t;n-=t;i+=t;a+=t;var s,c;s=r<=o[0]==i>=o[0]+o[2]?0:r<=o[0]?r-o[0]:i-o[0]-o[2];c=n<=o[1]==a>=o[1]+o[3]?0:n<=o[1]?n-o[1]:a-o[1]-o[3];if(s||c){o[0]+=s;o[1]+=c;ua.setViewBox(o)}}function tt(e,t){et({x:e.x,y:e.y,width:0,height:0},t)}function rt(){Ke(Jn,1)}function nt(e,t,r){var n,i,a,o=v(e,"c_para")||"",s=o.split("`"),c=s.length;c%2&&(s[c-1]?s[c++]="":s.length=--c);t=t.replace(/[`\^~\\"]/gi,"");for(var l=0;l<c-1;l+=2){n=s[l];i=s[l+1];if(t==n){a=1;if(r==i)return o;s[l+1]=r;break}}a||s.push(t,r);var d=s.join("`");v(e,"c_para",d);di.updateOne(e);var h={},f={};h.c_para=o;f.c_para=d;xi.save(["attr",e.id,h,f]);return d}function it(e){function t(e){var t=e.id;t?e.id="":t=ji.newId();if(t.match(/^(frame_\w*?)([_\?\d]*)$/)){var r=RegExp.$1,n=1;"_"!=r.substr(-1)&&(r+="_");t=r+n;for(;o(t);)t=r+ ++n}else for(;o(t);)t=ji.newId();e.id==t?t.match(/^gge(\d+)$/)&&+RegExp.$1>$i&&($i=+RegExp.$1):e.id=t;return t}var r=t(e);[].forEach.call(s("*",e),t);return r}function at(t){if(!(Fi&&e.frameElement&&"none"==e.frameElement.parentNode.style.display||function(e){if(!e||"g"!=e.tagName)return!0;var t=v(e,"c_partid");if(!t||t.indexOf("part_import")<0)return!0;var r=c('text[c_note="note_name"]',e),n=r&&(r.textContent||"").toLowerCase();return n&&0===n.indexOf("frame")}(t))){var r=t.id;r||(t.id="rnd"+(Math.random()+"").replace(".",""));var n=c("#"+t.id+">rect.hitbox",t),i="none"==v(t,"display");i&&m(t,"display");for(var a=s("#"+t.id+">*",t),o=[],l=[],d=0,h=a.length;d<h;d++){var f=a[d],u=f.tagName;if("none"!=v(f,"display"))if("g"==u){var p=f.getAttribute("c_partid");if("part_annotation,part_pin,part_junction,part_netLabel_text".indexOf(p)>=0){o.push(f);continue}l.push(f)}else"text"==u?o.push(f):l.push(f)}r||(t.id="");if(l.length){for(d=0,h=o.length;d<h;d++)v(o[d],"display","none");var g=t.getBBox();for(d=0,h=o.length;d<h;d++)m(o[d],"display");i&&v(t,"display","none");if(g.width&&g.height){var y={x:g.x,y:g.y,width:g.width,height:g.height,fill:"none",class:"hitbox"};if(n)v(n,y);else{n=yn("rect",y);t.insertBefore(n,t.firstChild)}}}else i&&v(t,"display","none")}}function ot(e){e=e||o("part_arrowhead");return o("part_arrowhead").getAttribute("arrowtype")||"3"}function st(e){e=e||o("part_arrowhead");return+e.getAttribute("arrowsize")||15}function ct(e,t){if(!(t.childNodes.length<=0)){v(t,"arrowtype",e);lt(st(t),t.childNodes[0])}}function lt(e,t){var r,n=v(t.parentNode,"arrowtype")||ot(t),i=t.pathSegList,a=i.getItem(0).x,o=i.getItem(0).y,s=e,c=[];switch(n){case"1":v(t,"stroke",v(t,"fill"));c=[a,o,a-s,o+s/2,a,o,a-s,o-s/2];r=+v(t.parentNode,"c_rotation")||0;r=360-r;r&&(c=ye(c,r,a,o));d="M"+c[0]+","+c[1]+"L"+c.slice(2).join(",");break;case"2":v(t,"stroke","none");c=[a,o,a-s,o+s/2,a-s,o-s/2];r=+v(t.parentNode,"c_rotation")||0;r=360-r;r&&(c=ye(c,r,a,o));d="M"+c[0]+","+c[1]+"L"+c.slice(2).join(",")+"Z";break;case"3":v(t,"stroke","none");c=[a,o,a-s,o+s/2,a-3*s/4,o,a-s,o-s/2];r=+v(t.parentNode,"c_rotation")||0;r=360-r;r&&(c=ye(c,r,a,o));d="M"+c[0]+","+c[1]+"L"+c.slice(2).join(",")+"Z"}v(t,"d",d)}function dt(e,t){function r(e){e[0].type="M"}function n(e,t){i.updateAndSave();di.updateOne(e);t[3]={points:v(e,o)};if(a&&"wire"===ee(e)){bi.solveItem(e);bi.solveTodoList();xi.save(bi.batHistoryCmd(t))}else xi.save(t);xi.saveBatch()}xi.startBatch();var i=new Ln([e]),a=ji.fileType.getAbstractFileType(ya).match(/^sch/),o="points";"path"===e.tagName&&(o="d");var s,c,l,d=e.getPathData(),h=d.length;for(l=h-1;l>0;l--)d[l].values.join("")===d[l-1].values.join("")&&d.splice(l-1,1);r(d);h=d.length;var f,p,g=-1,y=e.getAttribute("stroke-width"),x=y*y,m={};m[o]=v(e,o);var _=["attr",e.id,m];if(!(h<3)){for(l=h-1;l>=1;l--){s={x:d[l].values[0],y:d[l].values[1]};c={x:d[l-1].values[0],y:d[l-1].values[1]};f=function(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,c=r.y,l=a-n,d=o-i,h=l*l+d*d,f=((s-n)*l+(c-i)*d)/h;if(!(f>=1||f<=0)){var u=n+f*l,p=i+f*d,g=u-s,y=p-c;return{point:{x:u,y:p},d2:g*g+y*y}}}(s,c,t);if(f&&f.d2<=x&&(void 0===p||p>f.d2)){p=f.d2;g=l;f.point.x;f.point.y}}a&&"wire"===ee(e)&&bi.solveItem(e);if(1===g){d.splice(0,1);r(d);e.setPathData(d);n(e,_);Nt(e)}else if(g===h-1){d.splice(h-1,1);r(d);e.setPathData(d);n(e,_);Nt(e)}else if(g>1){var b=e.cloneNode(!0);u(e,"active");u(b,"active");b.id=ji.newId();wt();var S=A(d).splice(g);r(S);e.setPathData(S);var C=A(d).splice(0,g);r(C);b.setPathData(C);e.parentNode&&e.parentNode.insertBefore(b,e.nextSibling);di.updateOne(e,{notCopper:!0});di.updateOne(b,{notCopper:!0});xi.save(["add",b.id,ji.node.getRefId(b)]);n(e,_)}v(e,"net")&&ratLineMgr.buildOneNet(v(e,"net"),!1);return!0}dr([e]);xi.saveBatch()}function ht(e){var t=Ar();if(!t.length)return!1;var r=t[0],n=v(r,"c_para")||"";if(0===n.length)return!1;e["Supplier Part"]=e["Supplier Part"]||e.LCSC;e.package=e.package||e.Package;e.Value=e.Value||e.Name;var i=r.cloneNode(!0),a=r.children,o=ji.c_paraToJson(n);e.spicePre&&(o.spicePre=e.spicePre);e.package&&(o.package=e.package);e.Supplier&&(o.BOM_Supplier=e.Supplier);e.Manufacturer&&(o.BOM_Manufacturer=e.Manufacturer);e["Manufacturer Part"]&&(o["BOM_Manufacturer Part"]=e["Manufacturer Part"]);e["Supplier Part"]&&(o["BOM_Supplier Part"]=e["Supplier Part"]);e.Value&&(o.Value=e.Value);n=ji.jsonToC_para(o);v(r,{c_para:n});e.pre&&(Vt("pre",r).childNodes[0].textContent=e.pre);if(e.data){var s,c=e.data;for(var l in c)if(w(c,l)){s=a[c[l].id];if(s){v(s,{c_spicepin:c[l].spiceNum});ji.node.setTextContent(s.children[0],c[l].name);ji.node.setTextContent(s.children[1],c[l].num)}e.hiddenPin&&"4"==v(s,"c_elec")?v(s,{c_show:"none",display:"none"}):e.hiddenPin||v(s,{c_show:"show",display:""})}}var d=r.cloneNode(!0);di.updateOne(r);xi.save(["node",r.id,i,d])}function ft(e){var t,r=e.target==hi,n=e.target,i=n.parentNode,a=v(i,"c_partid"),s="cdot"==v(e.target,"c_shapetype");v(n,"attach_libid")&&(n=o(v(n,"attach_libid")));if("part_pad"===a||"part_pcbtext"===a||"part_annotation"===a){n=n.parentNode;t=!0}else n=nr(n);var c=Ar();if((!s&&!r&&"TEXTAREA"!=e.target.tagName&&(!n||!h(n,"selected"))||r)&&!c){Ct("multiSelect",[!1]);Ct("releaseActive")}!function(e){if(!e)return Ct("triggerEvent",["select_change"]);fi=e;l(fi,"active",!0);Ct("triggerEvent",["select_change"]);"line"==v(e,"c_shapetype")&&Nt(e)}(n);var d,f=Ar();if(r){d="";if(0!==c.length){d=ee(f[0]);if(!d)return}else f="canvas"}else if(s&&"light"!=v(e.target,"class")){d="cdot";f=[e.target]}else if("part_import_frame_lib"==v(n,"c_partid"))d="sheet";else{if(!n)return;d=ee(n);if(!d)return}var u=xt(e,!1);0===f.length&&n&&"part_image"===v(n.parentNode,"c_partid")&&(f=[n]);var p={target:f,docType:ya,cmdKey:d,clientX:e.clientX,clientY:e.clientY,x:u.x,y:u.y};t&&n.parentNode!==Jn||(p.locked=v(n,"locked"));Pi.contextmenuDisableOnce||Ct("showEditorContextMenu",[p])}function ut(){if(e.frameElement){var r=frameElement.getAttribute("c_para");r&&v(Jn,{c_para:r});var n=frameElement.getAttribute("winzoom");if(ji.fileType.isLib(ya)){er(+n,{clientX:(t.documentElement.clientWidth||9)>>1,clientY:(t.documentElement.clientHeight||9)>>1})}else er(+n,{clientX:0,clientY:0});v(o("gridOH"),{y1:_i.canvas.originY,y2:_i.canvas.originY});v(o("gridOV"),{x1:_i.canvas.originX,x2:_i.canvas.originX})}}function pt(e){var t,r=e.childNodes
;if(r&&r.length>0)for(t=r.length-1;t>=0;t--)1==r[t].nodeType?"text"!=r[t].tagName&&"tspan"!=r[t].tagName&&pt(r[t]):e.removeChild(r[t])}function gt(){var e=ua.getViewBox();Ct("updateRuler",[{zoom:Wi,unit:_i.canvas.unit,vbX:e[0],vbY:e[1],originX:_i.canvas.originX,originY:_i.canvas.originY}])}function yt(e){Ct("updateRuler",[{clientX:e.clientX,clientY:e.clientY}])}function vt(){var e=t.body,r=t.documentElement;return{zoom:Ji,scrollLeft:Math.max(e.scrollLeft,r.scrollLeft),scrollTop:Math.max(e.scrollTop,r.scrollTop),scrollWidth:Math.max(e.scrollWidth,r.scrollWidth),scrollHeight:Math.max(e.scrollHeight,r.scrollHeight),clientWidth:r.clientWidth,clientHeight:r.clientHeight,width:Math.max(e.scrollWidth,r.scrollWidth),height:Math.max(e.scrollHeight,r.scrollHeight),canvasWidth:+v(hi,"width"),canvasHeight:+v(hi,"height"),viewBox:v(hi,"viewBox")}}function xt(e,t){var r=Ve({x:e.clientX,y:e.clientY}),n=r.x,i=r.y;return!0===t||!1!==t&&_i.adsorbGrid.enabled?je(r):{x:ji.formatLengthSave(n),y:ji.formatLengthSave(i)}}function mt(e){if("TEXTAREA"!=e.target.tagName&&"INPUT"!=e.target.tagName){e.preventDefault();""===yi&&(Ni&&Ni.ready||Pi.dragpanning||Pi.drawing||zi&&zi.on||Pi.contextmenuDisableOnce&&(Pi.contextmenuDisableOnce=!1))}}function _t(e){if(!("TEXTAREA"==e.target.tagName||Ii&&Pi.dragpanning)){e.preventDefault();if(e.detail||e.deltaX||e.deltaY){var t,r,n,i,a=1===e.deltaMode,o=100;r=e.deltaX||e.wheelDeltaX/-3||0;n=e.deltaY||e.wheelDeltaY/-3||0;!e.detail||r||n||(n=e.detail);a&&(o=3);Pi.wheelData=Pi.wheelData||{x:0,y:0,lastFire:0,lastRealHandle:0};var s=Pi.wheelData,c=Date.now();if(c-s.lastFire>500){s.x=0;s.y=0}s.x+=r;s.y+=n;s.lastFire;s.lastFire=c;if(!(Math.abs(s.x)<o&&Math.abs(s.y)<o)){s.lastRealHandle=c;i=Math.abs(s.x)>Math.abs(s.y);if(i){t=s.x>0;s.x+=s.x>0?-o:o;s.y=0}else{t=s.y>0;s.y+=s.y>0?-o:o;s.x=0}var l=Di.getCacheObj("ZoomWay");void 0===l&&(l="ScrollKey");"ScrollKey"===l?bt(e,i,t):St(e,i,t)}}}}function bt(e,t,r){if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||t){var n;n=t||e.shiftKey?r?[1,0]:[-1,0]:r?[0,1]:[0,-1];var i=ua.getViewBox(),a=20/Wi;i[0]+=a*n[0];i[1]+=a*n[1];ua.setViewBox(i)}else if(!e.altKey)try{var o=Q(Ji,r?"-":"+"),s=ya==ii.PCB||ya==ii.PCBMODULE;if(s&&Li.isWaiting()){var c={nextZoom:o,clientX:e.clientX,clientY:e.clientY};Li.setWaitingZoomOption(c)}else{er(o,{clientX:e.clientX,clientY:e.clientY});Ct("setZoomText",[o+"%"])}}catch(e){}}function St(e,t,r){if(e.ctrlKey||e.altKey||e.metaKey||t)try{var n=Q(Ji,r?"-":"+");if((ya==ii.PCB||ya==ii.PCBMODULE)&&Li.isWaiting()){var i={nextZoom:n,clientX:e.clientX,clientY:e.clientY};Li.setWaitingZoomOption(i)}else{er(n,{clientX:e.clientX,clientY:e.clientY});Ct("setZoomText",[n+"%"])}}catch(e){}else if(e.shiftKey||!e.altKey){var a,o=t||e.shiftKey;a=o?r?[1,0]:[-1,0]:r?[0,1]:[0,-1];var s=ua.getViewBox(),c=20/Wi;s[0]+=c*a[0];s[1]+=c*a[1];ua.setViewBox(s)}}function Ct(t,r,n){var i=parent;if(i!=e){var a=r||[],o=[{args:a,uuid:n,func:t}];return i.callByEditor.apply(e,o)}}function Pt(e,t,r){if(e||t){var n,i,a,o,s=e.length,c="x"==t?"y":"x";for(n=s-1;n>=0;n--)for(i=s-n;i>=0;i--)if(e[i]&&e[i-1]&&e[i][t]<e[i-1][t]){a=e[i];e[i]=e[i-1];e[i-1]=a;o=r[i];r[i]=r[i-1];r[i-1]=o}else if(e[i]&&e[i-1]&&e[i][t]==e[i-1][t]&&e[i][c]<e[i-1][c]){a=e[i];e[i]=e[i-1];e[i-1]=a;o=r[i];r[i]=r[i-1];r[i-1]=o}return{os:e,objs:r}}}function wt(){v(la,{visibility:"hidden"});v(ha,{visibility:"hidden"});v(fa,{visibility:"hidden"});da&&v(da.children[0],{visibility:"hidden"})}function Nt(e){if(("pinpart"!=v(e,"c_etype")||0===v(e,"c_partid").indexOf("part_import"))&&(!v(e,"c_partid")||0===v(e,"c_partid").indexOf("part_import"))&&(!v(e,"c_partid")||0!==v(e,"c_partid").indexOf("part_import")||ya===ii.PCB)&&o(e.id)){var t=na.get(e);t.length>=2&&Cr(t)}}function At(e,t){function r(e,t){var n=ya==ii.PCB||ya==ii.PCBMODULE;if(!1===e||arguments.length<2){v(o("gMarkError"),"visibility","hidden");Tt(!1)}else{v(o("gMarkError"),{cx:e,cy:t,visibility:"yes","stroke-width":1.5/Wi});if(n){tt({x:e,y:t},20);Tt(e,t,{strokeWidth:"2",strokeLinecap:"square"});"#FFFFFF"!=getSystemColor().background&&Tt(e,t,{stroke:"#FFFFFF",strokeWidth:"2",strokeLinecap:"square"})}else{Qe(e,t);Tt(e,t,{strokeWidth:"2",strokeLinecap:"square"})}setTimeout(r,1e3)}}t=t||{fromHotKey:!1};if(e.wires){var n=$e(e.wires);if(!n)return;var i=ua.getViewBox();n.width>i[2]||n.height>i[3]?Ke(e.wires[0]):qe(n)}else if(e.pin){var a=e.pin.gId,c=o(a);if(c&&"pin"==ee(c)){var d=ji.numberlistToArray(v(c,"c_origin"));r(d[0],d[1])}}else{e.labelFlag&&r(e.labelFlag.pinDot.x,e.labelFlag.pinDot.y);var h=ya==ii.PCB||ya==ii.PCBMODULE;if(h&&e.pad){var f=e.pad,u=di.gJsonCache.FOOTPRINT[f.fid],y=u&&u.PAD&&u.PAD[f.gId];f.number==y.number&&r(y.x,y.y)}else if(G(e)){!t.fromHotKey&&Or();!t.fromHotKey&&rr();for(var x,m=[],_=0,b=e.length;_<b;_++){x=o(e[_]);x&&m.push(x)}t&&!1===t.scroll||Ze(m);for(_=0,b=m.length;_<b;_++){x=m[_];if(x){var S=t.fromHotKey?"selected-h":"selected";l(x,S,!0);if(!h){var C=g(x),P=s('[c_partid="part_annotation"]',C);for(_=0;_<P.length;_++)p(P[_]);var w=ji.svg.getBBoxFixed(C,{excludeText:!1});r(w.x+w.width/2,w.y+w.height/2)}}}Ct("triggerEvent",["select_change"])}}}function kt(){for(var e,r=o("gCursors").childNodes,n=r.length,i=0;i<n;i++)(e=r[i].id)&&(mi[e]={trs:v(r[i],"transform")||"",width:v(r[i],"width"),height:v(r[i],"height")});t.addEventListener("mousemove",Lt,!1)}function Ot(e,t,r){var n=/^(grab|grabbing|row-resize|col-resize)$/;vi&&("cross-red"==vi?Tt(!1):n.test(vi)?u(hi,"cursor-"+vi):v(o(vi),{display:"none"}));if(e&&n.test(e)){f(hi,"cursor-"+e);vi=e}else{var i=!1;if(e&&mi[e])if("cross-red"==e)if(!1===Ct("getCrossCursor")){Tt(!1);i=!0}else if(arguments.length>=3){Tt(t,r);i=!0}else if(vi&&!0===t)Tt(!1);else{Tt(!1);i=!0}else if(arguments.length>=3)v(o(e),{x:t,y:r,display:""});else if(vi&&!0===t)v(o(e),{display:""});else{v(o(e),{x:-1e5,y:-1e5,display:""});i=!0}else i=!0;l(hi,"cursor-none",!i);vi=e||""}}function Tt(e,t,r){if(!1===e||isFinite(e)&&isFinite(t)){var n=o("cross-x-big"),i=o("cross-y-big");if(!1!==e&&!1!==Ct("getCrossCursor")){var a=ua.getViewBox(),s=1/Wi,c=s/2,l=e%s,d=t%s;e=e-l+c;t=t-d+c;e=Math.round(1e6*e)/1e6;t=Math.round(1e6*t)/1e6;v(n,"d","M"+e+" "+a[1]+" v"+a[3]);v(i,"d","M"+a[0]+" "+t+" h"+a[2]);if(r&&r.stroke){v(n,"stroke",r.stroke);v(i,"stroke",r.stroke)}else{v(n,"stroke","red");v(i,"stroke","red")}if(r&&r.strokeWidth){v(n,"stroke-width",r.strokeWidth);v(i,"stroke-width",r.strokeWidth);v(n,"stroke-dasharray",2*r.strokeWidth+","+2*r.strokeWidth);v(i,"stroke-dasharray",2*r.strokeWidth+","+2*r.strokeWidth);if(r.strokeLinecap){n.style.strokeLinecap=r.strokeLinecap;i.style.strokeLinecap=r.strokeLinecap}}else{v(n,"stroke-width","1");v(i,"stroke-width","1");v(n,"stroke-dasharray","2, 2");v(i,"stroke-dasharray","2, 2");n.style.strokeLinecap="round";i.style.strokeLinecap="round"}}else{v(n,"d","M0 0");v(i,"d","M0 0")}}}function Lt(e){if(vi)if(e.target!=t.documentElement&&e.target!=t.body||Gi){var r,n;if(!_i.adsorbGrid.enabled&&pa.forcedPixelSnap){r=ji.extend({},_i.adsorbGrid);ji.extend(_i.adsorbGrid,{distanceX:1,distanceY:1,enabled:!0});n=function(){ji.extend(_i.adsorbGrid,r)}}var i,a;if(_i.adsorbGrid.enabled&&"cursor-hand"!=vi&&"cursor-grab"!=vi&&"cursor-freedraw"!=vi){ia.altKeyEnabled=e.altKey;var s=je(xt(e));i=s.x;a=s.y}else{var c=xt(e,!1);i=c.x;a=c.y}"cross-red"==vi?Tt(i,a):v(o(vi),{x:i,y:a,display:""});n&&n()}else"cross-red"==vi?Tt(!1):v(o(vi),{display:"none"})}function It(e){for(;e&&e.parentNode!=Jn;)e=e.parentNode;return e}function Et(e,t,r){var n,i,a;if(e){n="string"==typeof e?o(e):e;if(3==arguments.length){v(n,{display:""});i=v(n,"c_origin");a=i?i.split(","):[0,0];ea.g(n,t-a[0],r-a[1]);v(n,{c_origin:t+","+r,display:""})}else v(n,{display:"none"})}}function Mt(e){var t=[];e=e||Ar();for(var r=0,n=e.length;r<n;r++)t.push(e[r].id);return t.join(",")}function Vt(e,t){var r="name"==e?"note_name":"note_pre",n=t.querySelector("[c_note="+r+"]");if(!n){var i=t.firstElementChild&&h(t.firstElementChild,"hitbox")?t.firstElementChild:null,a=i?i.nextElementSibling:t.firstElementChild,o=ji.svg.getBBox(t),s=null;if(ai[ya].match(/^PCB/)){s=yn("g",{c_partid:"part_pcbtext",id:ji.newId(),c_origin:o.x+o.width/2+","+("note_name"===r?o.y-10:o.y-5),layerid:ni.TOPSILKLAYER,display:"none"});n=yn("path",{c_note:r,c_fontSize:"4.5",c_text:" ",fill:"none","text-anchor":"start","stroke-width":"0.7",d:"M0,0"});s.appendChild(n);t.insertBefore(s,a||null)}else{s=yn("g",{c_partid:"part_annotation",id:ji.newId()});n=yn("text",{c_note:r,"font-family":"Arial","font-size":"7pt",fill:"#000080","text-anchor":"start",x:o.x+o.width/2,y:"note_name"===r?o.y-10:o.y-5});s.appendChild(n);t.insertBefore(s,a||null);"name"==e?Kr(null,n):Kr(n,null)}}return n.parentNode}function Bt(e,t,r){var n=Vt("pre",e),i=Vt("name",e);if("schlib"===r){t.pre&&("string"==typeof t.pre?c("text",n).textContent=z(t.pre):n.parentNode.replaceChild(t.pre,n));t.name&&("string"==typeof t.name?c("text",i).textContent=z(t.name):i.parentNode.replaceChild(t.name,i))}else if("pcblib"===r){t.pre&&("string"==typeof t.pre?v(n.firstChild,{c_text:z(t.pre),d:Ct("getFontPath",[{fontFamily:v(n.firstChild,"c_fontFamily"),c_fontSize:v(n.firstChild,"c_fontSize"),degree:v(n,"c_rotation"),mirror:v(n,"c_mirror"),text:z(t.pre),x:v(n,"c_origin").split(",")[0],y:v(n,"c_origin").split(",")[1]}])}):n.parentNode.replaceChild(t.pre,n));t.name&&("string"==typeof t.name?v(i.firstChild,{c_text:z(t.name),d:Ct("getFontPath",[{fontFamily:v(i.firstChild,"c_fontFamily"),c_fontSize:v(i.firstChild,"c_fontSize"),degree:v(i,"c_rotation"),mirror:v(i,"c_mirror"),text:z(t.name),x:v(i,"c_origin").split(",")[0],y:v(i,"c_origin").split(",")[1]}])}):i.parentNode.replaceChild(t.name,i))}}function Gt(e){if(!e){if(!fi)return;e=fi}var r,n=function(e){if(e==t)return null;for(;e&&e.parentNode;){if(e.parentNode==Jn||"g"===e.tagName)return e;e=e.parentNode}return null}(e),i="cdot"==v(e,"c_shapetype"),a=!n&&(e==hi||"bodyPlaceholder"===e.id);r=i&&"light"!=v(e,"class")?"cdot":"part_import_frame_lib"==v(n,"c_partid")?"sheet":ee(n);Ct("showAttrDialog",[{cmdKey:r,docType:ya,targetId:a?"canvas":e.id}])}function Ft(e){return e==ii.SCH||e==ii.SUBCKT}function Rt(e){function t(e,t){t.forEach(function(t){e.push(t)})}function r(e,t){var r=ee(e),n=v(e,"c_rotation");if("FOOTPRINT"===r||"schlib"===r){n&&mr([e],360- -1*n);mr([e],be(360-parseInt(t,10)))}else{n&&_r([e],360- -1*n);_r([e],1*t)}}var n,i,a,o=Ar(),s=[],l=[],d=[],h=0,f=0,u=0;if(o.length){xi.startBatch();o.forEach(function(e){var t=ee(e);"FOOTPRINT"===t?s.push(e):"PAD"===t?l.push(e):d.push(e)});s.forEach(function(e,t){s[t]={ele:e,pre:v(c('[c_note="note_pre"]',Vt("pre",e)),"c_text")}});s=C(s,"pre");s.forEach(function(e,t){s[t]=e.ele});l.forEach(function(e,t){l[t]={ele:e,number:v(e,"number")}});l=C(l,"number");l.forEach(function(e,t){l[t]=e.ele});o=[];t(o,s);t(o,l);t(o,d);var p,g;if("matrix"===e["distribute-type"])o.forEach(function(t){p=t.cloneNode(!0);e.rotation&&r(t,e.rotation);g=v(t,"c_origin");if(g){n={};g=g.split(",");n.centerX=g[0];n.centerY=g[1]}else{n=ji.svg.getPlainBBox(t);n.centerX=n.x+n.width/2;n.centery=n.y+n.height/2}i=1*e["start-x"]+e["distance-x"]*h;a=1*e["start-y"]+e["distance-y"]*f;cr([t],i-n.centerX,a-n.centerY,{notHistory:!0});if("row"===e["distribute-by"]){h++;if(h>=e["per-count"]){h=0;f++}}if("column"===e["distribute-by"]){f++;if(f>=e["per-count"]){f=0;h++}}di.updateOne(t,{noText:!0,notCopper:!0});xi.save(["node",t.id,p,t.cloneNode(!0)])});else if("circular"===e["distribute-type"]){var y=0,x=e.radius,m=0;e["start-degree"]=1*e["start-degree"]+90;o.forEach(function(t){p=t.cloneNode(!0);(e.rotation||"yes"===e["r-to-match"])&&r(t,e.rotation);g=v(t,"c_origin");if(g){n={};g=g.split(",");n.centerX=1*g[0];n.centerY=1*g[1]}else{n=ji.svg.getPlainBBox(t);n.centerX=n.x+n.width/2;n.centery=n.y+n.height/2}y=u*e.spacing%360;m="anti-clockwise"===e.deretion?e["start-degree"]+y:e["start-degree"]-y;i=Math.sin(m*Math.PI/180)*x+1*e["center-x"];a=Math.cos(m*Math.PI/180)*x+1*e["center-y"];cr([t],i-n.centerX,a-n.centerY,{notHistory:!0});"yes"===e["r-to-match"]&&("anti-clockwise"===e.deretion?mr([t],-(90+y)):mr([t],90+y));di.updateOne(t);xi.save(["node",t.id,p,t.cloneNode(!0)]);u++})}xi.saveBatch()}}function Dt(e){function t(e,t,r,n,i){var a=!!i;try{n===(i?"different":"same")?String(e).match(new RegExp(t,r))&&(a=!i):String(e).match(new RegExp(t,r))||(a=!i)}catch(e){}return a}function r(e,r){var n,i,a,o,s=!0,c=/\/.*?\/g?i?/;for(n in e)if(w(e,n)){i=e[n].val.match(c);if(i){a=e[n].val.split("/")[1];o=e[n].val.split("/")[2]}if("same"===e[n].type&&!w(r,n)&&!e[n].val)continue;if("any"===e[n].type)continue;if("same"===e[n].type){if(i){s=t(r[n],a,o,e[n].type,!0);if(!s)continue}else if(e[n].val!=String(r[n]).toUpperCase()){s=!1;continue}}else if("different"===e[n].type)if(i){s=t(r[n],a,o,e[n].type,!0);if(!s)continue}else if(e[n].val==String(r[n]).toUpperCase()){s=!1;continue}}return s}function n(t){var n,i,a=[],s=!0,c=!0;if(t)for(var d in t)if(w(t,d)){n=o(d);i=Mn(n);i.c_para&&(i.c_para=ji.c_paraToJson(i.c_para));s=r(e.attr,i);w(e,"custom")&&(c=r(e.custom,i.c_para));if(s&&c){l(n,"selected",!0);a.push(n)}}return a}rr();var i,a=A(di.gJsonCache);if(a.schlib)for(i in a.schlib)if(w(a.schlib,i)&&i.match(/frame_lib_/)){a.sheet||(a.sheet={});a.sheet[i]=a.schlib[i];delete a.schlib[i]}n(a[e.head.type]);"netlabel"===e.head.type&&n(a.netflag);var s,c,d;if(("prefix"===e.head.type||"name"===e.head.type||"package"===e.head.type)&&a.schlib)for(i in a.schlib)if(w(a.schlib,i)&&a.schlib[i].annotation){s=a.schlib[i].annotation;for(c in s)if(w(s,c)){d=v(o(c).querySelector("text[c_note]"),"c_note");if("prefix"===e.head.type&&"note_pre"===d||"name"===e.head.type&&"note_name"===d||"package"===e.head.type&&"note_package"===d)continue;delete s[c]}n(s)}if(("PREFIX"===e.head.type||"NAME"===e.head.type||"PAD"===e.head.type)&&a.FOOTPRINT)for(i in a.FOOTPRINT)if(w(a.FOOTPRINT,i)&&(a.FOOTPRINT[i].PAD||a.FOOTPRINT[i].TEXT))if("PAD"===e.head.type)n(a.FOOTPRINT[i].PAD);else{s=a.FOOTPRINT[i].TEXT;for(c in s)if(w(s,c)){d=v(o(c).querySelector("path[c_note]"),"c_note");if("PREFIX"===e.head.type&&"note_pre"===d||"NAME"===e.head.type&&"note_name"===d)continue;delete s[c]}n(s)}Ct("triggerEvent",["select_change","multiSelect"])}function Ht(e){function t(e){e=h?ji.units.convert(+e,"pixel",h):+e;e=ji.formatLengthShow(e);return h?e+h:e}var r;r=ji.fileType.getAbstractFileType(ya).match(/^pcb/)?3:6;if("mousemove"==e.type||"mouseup"==e.type){var n=xt(e,!1);if(ya!=ii.WAVEFORM){var i=e.target,a=_i.canvas,o=Ht.data;o.clientX=e.clientX;o.clientY=e.clientY;if(null===o.lastUpX){o.lastUpX=a.originX;o.lastUpY=a.originY}var s=n.x,c=n.y,l=s-o.lastUpX,d=c-o.lastUpY;if("mouseup"==e.type&&(i==hi||i==Jn||Jn.contains(i))){o.lastUpX=s;o.lastUpY=c;o.uplock=!0;o.clientX>0&&o.clientY>0&&o.clientX<e.view.innerWidth&&o.clientY<e.view.innerHeight&&(o.uplock=!1)}var h="pixel"!=a.unit&&a.unit||"",f={x:s,y:c};f=je(f);f.x-=a.originX;f.y-=a.originY;f.x=t(f.x);f.y=t(f.y);o.uplock&&"mousemove"==e.type&&(Math.abs(l)*Wi>r||Math.abs(d)*Wi>r)&&(o.uplock=!1);if(!o.uplock){f.dx=t(l);f.dy=t(d)}o.currAbsX=f.absX=n.x;o.currAbsY=f.absY=n.y;Ct("updateMouseXY",[f])}else Ci.updateMessageBarInfo(n)}}function jt(e){if(!(e instanceof SVGPathElement))return!1;for(var t,r,n,i,a,o,s,c,l,d=e.getPathData(),h=d.length,f=[],u=!1,p=0;p<h;p++){t=d[p];i=t.type;o=t.values;if("M"==i||"L"==i){n=o[0]+"_"+o[1];-1==f.indexOf(n)&&f.push(n)}else if("A"==i){u=!0;r=0===p?{}:d[p-1];a=r.type;s=r.values;c=null;l=null;if("M"==a||"L"==a){c=s[0];l=s[1]}else if("A"==a){c=s[5];l=s[6]}if(c==o[5]&&l==o[6])return!1}}var g,y,v,x,m,_,b,S=!0;if(f.length<3&&!u)return!1;if(f.length>=3){g=f[0].split("_")[0];y=f[0].split("_")[1];v=f[1].split("_")[0];x=f[1].split("_")[1];for(p=2;p<f.length;p++){b=f[p].split("_");m=b[0];_=b[1];if(!Se((g-v)*(_-x),(m-v)*(y-x))){S=!1;break}}if(S)return!1}var C,P,w,N,A,k,O,T,L;if("Z"!=d[h-1].type.toUpperCase()){C=d[0];P=C.values;A=d[h-1];k=A.type;O=A.values;w=P[0];N=P[1];if("M"==k||"L"==k){T=O[0];L=O[1]}else if("A"==k){T=O[5];L=O[6]}if(w==T&&N==L){e.pathSegList.appendItem(new SVGPathSegClosePath(void 0));return!0}return!1}return!0}function Ut(e){function t(e){var t=Mn(e);t.groupAttr=!0;return t}if(!e||e.length<2)return!1;var r=t(e[0]);if(!r)return!1;r.c_para&&(r.c_para=ji.c_paraToJson(r.c_para));for(var n=1,i=e.length;n<i;n++){Z(r,t(e[n]))}r["attr-selected-count"]=e.length;return r}function zt(e){var t=Ar();if(t.length){var r,n,i;xi.startBatch();t.forEach(function(t){i=ee(t);if("schlib"===i||"FOOTPRINT"===i){var a=Vt("pre",t),o=ji.svg.getPlainBBox(t),s=e;o.centerX=o.x+o.width/2;o.centerY=o.y+o.height/2;var c=ji.svg.getBBox(a);c.centerX=c.x+c.width/2;c.centerY=c.y+c.height/2;parseFloat(v(a.firstChild,"c_fontSize")||v(a.firstChild,"font-size")||"7");r=o.centerX-c.centerX;n=o.centerY-c.centerY;v(t,"layerid")==ni.BOTTOMLAYER&&("left"===s?s="right":"right"===s&&(s="left"));"top"===s?n+=-1*(o.height/2+c.height/2+3):"left"===s?r+=-1*(o.width/2+c.width/2+3):"bottom"===s?n=n+o.height/2+c.height/2+3:"right"===s&&(r=r+o.width/2+c.width/2+3);ze(a,r,n);di.updateOne(t);xi.save(["move",a.id,r,n])}});xi.saveBatch();Ct("setTabUnsaved")}}function Xt(e,t){for(var r in e){var n=e[r],i=t[r];if(i)for(var a=0;a<i.length;a++){var s=o(i[a].gid);s&&v(s,"c_issystemlib",n.isSystemLib)}}}function Yt(e,t,r){var n,i,a=t.getBBox().x,o=t.getBBox().y+t.getBBox().height,c=0,l=Ct("i18nTransfer",["This component is verified","This component is unmounted"]);if("verify"==e){i=yn("g",{id:ji.newId()});n=yn("title");f(n,"i18n");n.innerHTML=l[0];i.appendChild(n);var d=yn("text",{c_note:"note_verify",x:a,y:o+11});d.textContent="✔";d.style.fontSize="7pt";d.style.fontFamily="Arial";f(d,"verify-icon");i.appendChild(d);t.appendChild(i)}else if("mounted"==e){if(s("[c_note = note_verify]",t).length>0){var h=s("[c_note = note_verify]",t)[0],u=h.parentNode;p(h);a=t.getBBox().x;o=t.getBBox().y+t.getBBox().height;c=12;u.appendChild(h)}i=yn("g",{id:ji.newId()});n=yn("title");f(n,"i18n");n.innerHTML=l[1];i.appendChild(n);d=yn("text",{c_note:"note_mounted",x:a+c,y:o+11,fill:"red"});d.textContent="(R)";d.style.fontSize="7pt";d.style.fontFamily="Arial";f(i,"mounted-icon");i.appendChild(d);i.style.display=!1===r?"block":"none";t.appendChild(i)}}function Wt(e,r){var n=t.getElementById(e);if(!n)return!1;var i=r,a=n.cloneNode(!0);di.updateOne(n);xi.save(["node",n.id,i,a])}function Jt(e){if(yi!=e&&!(ki&&ki.start||Oi&&Oi.start||Ti&&Ti.start)){""!==yi&&qt();if(e){Ct("releaseActive");Ct("triggerEvent",["select_change"]);r("dragMoveSwitch",[!1]);$t(e);pa.ready()}}}function $t(e){return""===yi?yi=e:yi}function Kt(){Ct("endToolbarCmd",[yi]);yi="";pa.target=null}function qt(){if(""!==yi){pa.end();yi="";pa.target=null}}function Qt(e){function n(e){return e&&"text"==e.tagName&&e.parentNode&&"part_annotation"==v(e.parentNode,"c_partid")&&e.parentNode.parentNode&&e.parentNode.parentNode.parentNode==Jn&&0!=e.parentNode.id.indexOf("frame_tick_")}function i(e){return e&&"image"==e.tagName&&e.parentNode&&"part_image"==v(e.parentNode,"c_partid")&&e.parentNode.parentNode&&e.parentNode.parentNode.parentNode==Jn}if("mousedown"==e.type){Ct("hideMenuOnMouseDown");Ct("triggerPanelChange");xi.lastMergeSource=""}if(""===yi&&!(ki&&ki.start||Oi&&Oi.start||Ti&&Ti.start||un&&un.instance.start)){var a,o,d=e.target,f=e.type,u=e.button,p=u===ei,g=u===ti,y=Ii?e.metaKey:e.ctrlKey;3==d.nodeType&&(d=d.parentNode);"tspan"==d.tagName&&(d=d.parentNode);if(d!=t&&d!=t.documentElement&&d!=t.body||Gi||Ui){var x=nr(d),m=x,_="cdot"==v(d,"c_shapetype");if(!m&&_){if("mousedown"==f&&!y&&p){ki.mdown(e);return}m=fi}!m&&Ui&&Ui.target&&(m=Ui.target);for(;m&&m.parentNode!=Jn;)m=m.parentNode;if(m&&"mouseover"==f){if(!x)return;if(Ui){l(Ui.target,"hover",!1);Ui=null;t.removeEventListener("mousemove",Zt,!1)}l(m,"hover",!0)}else if(m&&"mouseout"==f)if("cdot"==v(d,"c_shapetype")){if(Ui){l(Ui.target,"hover",!1);Ui=null}t.removeEventListener("mousemove",Zt,!1)}else{var b=xt(e,!1);Ui={x:b.x,y:b.y,target:m,evtTarget:d};t.addEventListener("mousemove",Zt,!1)}else if(m||"mousedown"!=f||"TEXTAREA"==e.target.tagName||y||!p){if(m&&"mousedown"==f&&!y&&p){Ct("multiSelect",[!1]);if(n(d)||i(d)){a=d.parentNode;if(fi!=a){Ct("releaseActive");if(fi){fi.parentNode==Jn&&l(fi,"selected",!0);"line"==v(fi,"c_shapetype")&&wt()}fi=a;l(fi,"active",!0)}Ct("triggerEvent",["select_change"]);if(i(d)){Nt(d);fi=d}return}if(m==fi||h(m,"selected"))return;Ct("releaseActive");if("sch"==ji.fileType.getAbstractFileType(ya)&&"pinpart"==v(d.parentNode,"c_etype")&&"part_junction"!=v(d.parentNode,"c_partid")){var S=c("circle[c_pindot]",d.parentNode);if(S){var C=+v(S,"cx"),P=+v(S,"cy"),w=+v(S,"r"),N=xt(e),A=N.x,k=N.y;if(d==S||ge(A,k,C,P)<=w){Ct("triggerEvent",["select_change"]);Jt("draw.wire");pa.dots=[C,P];pa.draw(A,k,!1);return}}}if(!_){fi&&fi!=m&&l(fi,"active",!1);if(!fi||fi!=m){fi=m;l(fi,"active",!0)}o=v(m,"c_shapetype");"line"==o?Nt(m):"group"==o&&wt();Ct("triggerEvent",["select_change"])}}else if(m&&"mousedown"==f&&y&&p){Ct("multiSelect",[!0]);h(m,"active")||h(m,"selected")?l(m,"selected",!1):l(m,"selected");l(m,"active",!1);if(fi){if(fi!=m){l(fi,"selected",!0);l(fi,"active",!1)}fi=null;wt()}var O=s(".selected .selected",Jn).toArray();O.forEach(function(e){l(e,"selected",!1)});Ct("triggerEvent",["select_change","multiSelect"])}else if(m&&"mouseup"==f&&!y&&p){if(zi.on&&!zi.bind){r("dragMoveCheck",[e,[m]]);return}if(n(d)){a=d.parentNode;if(fi!=a){rr();fi=a;l(fi,"active",!0)}}}else if("mousedown"==f&&!y&&g)zi.on&&(Pi.contextmenuDisableOnce=!0);else if("mouseup"==f&&!y&&g){if(zi.on){Pi.contextmenuDisableOnce=!0;zi.bind||r("dragMoveSwitch",[!1]);return}if(Pi.dragpanning)return;if(yi)return;ft(e)}}else{Ct("multiSelect",[!1]);Ct("releaseActive");Ct("triggerEvent",["select_change"]);Ti.e.mdown(e)}}}}function Zt(e){if(Ui){var r=xt(e,!1);if(Math.pow((r.x-Ui.x)*Wi,2)+Math.pow((r.y-Ui.y)*Wi,2)>81){l(Ui.target,"hover",!1);t.removeEventListener("mousemove",Zt,!1);Ui=null}else l(Ui.target,"hover",!0)}}function er(t,r){if(ya!=ii.WAVEFORM){t=+t;if(!(!t||t<.1||t>1e5)){t=function(e){var t=e+"",r=t.match(/[1-9]\.?\d/);if(!r)return e;var n=t.indexOf(r[0])+r[0].length;t=t.substr(0,n)+t.substr(n).replace(/[1-9]/g,"0");return+t}(t);var n=Wi;Ji=t;Wi=t/100;var i,a,c=1===Wi?1:ji.toFixed(100/t+1e-5,5),l=ua.getViewBox(),d=+v(hi,"width"),h=+v(hi,"height");if(r&&w(r,"clientX")&&!r.uplock){var f=1/n-1/Wi;a=[l[0]+r.clientX*f,l[1]+r.clientY*f,d/Wi,h/Wi]}else{var u=ji.svg.getBBox(Jn);i={x:u.width?u.x+u.width/2:u.x||l[0]+l[2]/2,y:u.height?u.y+u.height/2:u.y||l[1]+l[3]/2};a=[i.x-d/Wi/2,i.y-h/Wi/2,d/Wi,h/Wi]}ua.setViewBox(a);var p=+_i.adsorbGrid.gridSize;(!p||p<1)&&(p=1);for(;p*Wi<5;)p*=p*Wi*2>=5?2:p*Wi*5>=5?5:10;var g=.5/Wi,y=void 0!==ca.style.vectorEffect,x=function(e){return e/Wi},m=s("#gCursors>image");gt();setTimeout(function(){v(o("gridPattern"),{x:_i.canvas.originX,y:_i.canvas.originY});v(o("gridPattern2"),{x:_i.canvas.originX+c,y:_i.canvas.originY+c});v(o("gridCell"),{width:c,height:c});v(o("gridCell2"),"stroke-width",c);v([o("gridPattern"),o("gridPattern2")],{width:p,height:p});v(o("gridCell2"),{d:"M10 0V10H-10".replace(/10/g,p)});v(o("gridOH"),{"stroke-width":c,y1:_i.canvas.originY+g,y2:_i.canvas.originY+g});v(o("gridOV"),{"stroke-width":c,x1:_i.canvas.originX+g,x2:_i.canvas.originX+g});v(s("circle.pindot, #gPinDots circle"),{r:Math.max(4*c,1)});var r=Math.max(4*c,1);r=Math.min(r,2);v(s("circle.pindot"),{r:r});if(!y){var n=ji.toFixed(3*c,2);v(ca,"stroke-width",c);ca.style.strokeDasharray=n+","+n;var i=o("cross-x-big"),l=o("cross-y-big");v([i,l],{"stroke-width":c,"stroke-dasharray":n+","+n});i.style.strokeDasharray=n+","+n;l.style.strokeDasharray=n+","+n;if(2==i.pathSegList.numberOfItems&&i.pathSegList.getItem(1).y){var d=50/t,h=i.pathSegList.getItem(0).x,f=l.pathSegList.getItem(0).y;h=h-h%(100/t)+d;f=f-f%(100/t)+d;h=Math.round(1e6*h)/1e6;f=Math.round(1e6*f)/1e6;v(i,"d","M"+h+" "+a[1]+" v"+a[3]);v(l,"d","M"+a[0]+" "+f+" h"+a[2])}v(fa.children,{"stroke-width":c,"stroke-dasharray":n+","+n});v(ha.children,{"stroke-width":c,"stroke-dasharray":n+","+n});v(s("#gControlDots>*"),{"stroke-width":c})}var u;for(u=0;u<ui.length;u++)v(ui[u],{r:4*c});!function(e,t){if(e){var r=e.sheet.cssRules[0];r&&(r.style.strokeWidth=t)}}(o("px1Style"),c);!function(e,t,r){if(e)if(r<1){var n,i=e.sheet,a=i.cssRules,o=a.length,s=1/r;s=s<21?s:21;for(n=o-1;n>=0;n--)i.deleteRule(n);var c="";for(n=1;n<s;n++)c+=',#g1 [stroke-width="'+n+'"]';c=c.substr(1);c+=y?"{stroke-width:1;vector-effect:non-scaling-stroke;}":"{stroke-width:"+ji.toFixed(s+99e-7,5)+";}";i.insertRule(c,0);e.disabled=!1}else e.disabled=!0}(o("thinLineStyle"),0,Wi);for(u=0;u<m.length;u++){var _=mi[m[u].id];if(_&&_.trs){var b=1==Wi?_.trs:_.trs.replace(/-?[\d.]+/g,x);v(m[u],{width:_.width/Wi,height:_.height/Wi,transform:b})}}e.frameElement&&e.frameElement.setAttribute("winzoom",t);y||v(s("#gControlLocks rect"),{"stroke-width":c,"stroke-dasharray":n+","+n})},62.5)}}}function tr(){var e=!1,t=!1;if(ya==ii.SCH){var r=Ar();e=r&&1===r.length&&v(r[0],"c_partid")&&!!v(r[0],"c_para")}ya==ii.SPICESYMBOL&&(t=!0);var n=Ar();return{newModified:!0,canUndo:xi.canUndo(),canRedo:xi.canRedo(),selected:!!Jn.querySelector('#g1>.active, #g1>.selected, text.active, #g1>g[c_partid^="part_import_"]>g[c_partid="part_annotation"].active'),selectedObjs:n,canPaste:gClipboard.childNodes.length>0,zoom:Ji,toolbars:"",visible_grid:_i.adsorbGrid.visible,snap_grid:_i.adsorbGrid.enabled,oneSchLib:e,canEditSubckt:t}}function rr(e){if(fi){l(fi,"active",!1);fi=null;wt()}for(var t=s("#g1 .hover"),r=t.length-1;r>=0;r--)l(t[r],"hover",!1);t=s("#g1 .active");for(r=t.length-1;r>=0;r--)l(t[r],"active",!1);t=s("#g1 .wire-hover");for(r=t.length-1;r>=0;r--)l(t[r],"wire-hover",!1);Or(e)}function nr(e){if(e==t)return null;for(var r;e&&e!=hi&&e!=t;){r=v(e,"c_shapetype");if("line"==r||"group"==r)return e;e=e.parentNode}return null}function ir(){var e=[],t=di.gJsonCache.schlib;for(var r in t)if(w(t,r)){if(r.match(/frame_lib_\d+/i))continue;if(t[r].itemOrder.length>=2&&t[r].annotation){var n=t[r].annotation[t[r].itemOrder[1]];if(!n)continue;var i=F(n.string);if("P"==n.mark&&i){var a=ji.c_paraToJson(t[r].head.c_para).package||"";e.push({id:r,pre:F(i+" ("+a+")")})}}}return e}function ar(e){function t(e,r){if(!1===e||arguments.length<2){v(o("gMarkError"),"visibility","hidden");Tt(!1)}else{v(o("gMarkError"),{cx:e,cy:r,visibility:"yes","stroke-width":1.5/Wi});Tt(e,r,{strokeWidth:"2",strokeLinecap:"square"});setTimeout(t,1e3)}}var r=o(e);Or();rr();l(r,"selected",!0);var n=ji.svg.getBBoxFixed(r,{excludeText:!1});Ke(r);t(n.x+n.width/2,n.y+n.height/2)}function or(e,t,r,n,i){if(e&&"string"==typeof e){var a;if(!t){t="prefix";r=Jn;n=0;a=!0}var o,c;if("prefix"==t){for(var l=s('#g1>g>g text[c_note="note_pre"]',r),d=l,h=0;h<l.length;h++)l[h].parentNode.parentNode.id==n&&(d=l.slice(h+1));for(h=0;h<d.length;h++){c=d[h].textContent;if(F(c||"").toUpperCase()==F(e||"").toUpperCase()){o=d[h].parentNode.parentNode;break}}}else if("name"==t){var f=s('#g1>g>g text[c_note="note_name"]',r),u=f;for(h=0;h<f.length;h++)f[h].parentNode.parentNode.id==n&&(u=f.slice(h+1));for(h=0;h<u.length;h++){c=u[h].textContent;if(F(c||"").toUpperCase()==F(e||"").toUpperCase()){o=u[h].parentNode.parentNode;break}}}else if("package"==t){var p=s("#g1>g",r),g=p;for(h=0;h<p.length;h++)p[h].id==n&&(g=p.slice(h+1));var y;for(h=0;h<g.length;h++){y=ji.c_paraToJson(v(g[h],"c_para"));if(y&&F(y.package||"").toUpperCase()==F(e||"").toUpperCase()){o=g[h];break}}}else if("netlabel"==t){var x=s('#g1>g[c_partid^="part_netLabel"]',r),m=x;for(h=0;h<x.length;h++)x[h].id==n&&(m=x.slice(h+1));for(h=0;h<m.length;h++){c=m[h].textContent;if(F(c||"").toUpperCase()==F(e||"").toUpperCase()){o=m[h];break}}}if(!o)return null;var _=o.id;(i&&Ct("setTabActive",[i])||a)&&Ct("componentFoundHighLight",[_]);Ct("triggerEvent",["select_change"]);return o}}function sr(e,t){if(!(ki&&ki.start||Oi&&Oi.start||Ti&&Ti.start)){var r,n,i=Wi>=10?1:Math.round(10/Wi),a=ia.getSanpSize("X"),o=ia.getSanpSize("Y"),s=Ar().filter(function(e){return!aa.isLocked(e)});!s.length&&fi&&(s=[fi].filter(function(e){return!aa.isLocked(e)}));bi.solveItems(s);var l;if(_i.adsorbGrid.enabled){s.forEach(function(e){var t=c('[c_partid="part_pin"]',e);if(t){var r=ji.numberlistToArray(v(t,"c_origin"));l={x:+r[0],y:+r[1]}}});l||(l=De(s))}var d=l&&Ue(l,e,t);if(l&&d){r=d.x-l.x;n=d.y-l.y}if(!r&&!n){r=e?e*(_i.adsorbGrid.enabled?a:i):0;n=t?t*(_i.adsorbGrid.enabled?o:i):0}if(!1!==Xe(s,r,n)){di.updateMore(s);bi.solveItems(s);bi.solveTodoList();xi.save(bi.batHistoryCmd(["move",Mt(s),r,n]));fi&&Nt(fi);return!0}return!1}}function cr(e,t,r){if("number"==typeof arguments[0]){r=arguments[1];t=arguments[0];e=Ar()}else e=e?[].map.call(e,function(e){return"string"==typeof e?o(e):e.gId?o(e.gId):e}).filter(function(e){return e&&e.parentNode==Jn}):Ar();isFinite(t)||(t=0);isFinite(r)||(r=0);var n=[].map.call(e,function(e){return e.id||""}).join(",");bi.solveItems(e);if(!1!==Xe(e,t,r)){di.updateMore(e);bi.solveItems(e);bi.solveTodoList();xi.save(bi.batHistoryCmd(["move",n,t,r]));fi&&Nt(fi);return!0}return!1}function lr(e,t,r){if("number"==typeof arguments[0]){r=arguments[1];t=arguments[0];e=Ar()}else e=e?[].map.call(e,function(e){return"string"==typeof e?o(e):e.gId?o(e.gId):e}).filter(function(e){return e&&e.parentNode==Jn}):Ar();xi.startBatch();try{for(var n=isFinite(t),i=isFinite(r),a=0,s=e.length;a<s;a++){var c=e[a],l=c&&c.id,d=c&&v(c,"c_origin"),h=0,f=0;if(l){if(d){d=d.replace(/\s+/g,"").split(/,/);n&&(h=t-d[0]);i&&(f=r-d[1])}else{var u=ji.svg.getRefPoint(c);if(u){n&&(h=t-u.x);i&&(f=r-u.y)}}cr([c],h,f)}}}catch(e){}xi.saveBatch();fi&&Nt(fi)}function dr(e,t){!e||G(e)||B(e)||(e=[e]);var r,n,i,a=(e||Ar()).filter(function(e){return(!aa.isLocked(e)||aa.isLocked(e)&&t)&&!(v(e,"c_partid")&&v(e.childNodes[0],"c_note"))}),o=a.length,s=(e||Ar()).filter(function(e){return!((!aa.isLocked(e)||aa.isLocked(e)&&t)&&(!v(e,"c_partid")||!v(e.childNodes[0],"c_note")))}),c={};for(r=0;r<s.length;r++){n=s[r];if(n){l(n,"active",!1);i=v(n.childNodes[0],"c_note")||"";switch(i){case"note_name":c["attr-part-common-name-display"]="none";break;case"note_pre":c["attr-part-common-pre-display"]="none";break;case"note_package":c["Package Display"]="No";break;default:c=!1}n.parentNode&&c&&En(n.parentNode,c)}}bi.solveItems(a);if(o>0){var d=[];rr();for(r=0;r<o;r++){n=a[r];if(n){d[r]=["del",n.id,ji.node.getRefId(n)];di.removeOne(n);Yi.appendChild(n)}}bi.solveTodoList();xi.save(bi.batHistoryCmd(d));Ct("triggerEvent",["select_change"])}}function hr(){var t=Ar().filter(function(e){return!aa.isLocked(e)}),r=t.length;if(1==r&&v(t[0],"c_partid")&&v(t[0].childNodes[0],"c_note"))parent.$.messager.error("This field can't be removed!");else{bi.solveItems(t);if(0!==r){gClipboard.childNodes.length>0&&ji.node.clearChildNodes(gClipboard);rr();var n,i,a=[];for(n=0;n<r;n++){i=t[n];di.removeOne(i);a[n]=["del",i.id,ji.node.getRefId(i)];gClipboard.appendChild(i.cloneNode(!0));Yi.appendChild(i)}Pi.pasteCount=0;Pi.pasteFrom="cut";bi.solveTodoList();xi.save(bi.batHistoryCmd(a));Ct("triggerEvent",["select_change"]);parent.globalEditorClipboard=[ya,e.frameElement.id,+new Date]}}}function fr(){var t,r,n,i=Ar(),a=i.length;if(a>0){n=gClipboard.childNodes.length>0;n&&ji.node.clearChildNodes(gClipboard);for(t=0;t<a;t++){r=i[t].cloneNode(!0);u(r,"active");u(r,"hover");u(r,"selected");m(r,"locked");gClipboard.appendChild(r)}if(1==a&&i[0].parentNode!=Jn&&"part_annotation"==v(r,"c_partid")&&r.childNodes[0]&&v(r.childNodes[0],"c_note")){v(r,"c_origin",v(r.childNodes[0],"x")+","+v(r.childNodes[0],"y"));v(r,"c_shapetype","group");v(r,"c_etype","pinpart");v(r.childNodes[0],"type","comment");m(r.childNodes[0],"c_note")}n||Ct("triggerEvent",["enable_paste"]);Pi.pasteFrom="copy";Pi.pasteCount=0;parent.globalEditorClipboard=[ya,e.frameElement.id,+new Date]}}function ur(){var e,t=gClipboard.childNodes,r=t.length,n=[];if(r){for(var i=0;i<r;i++){e=t[i];"none"==v(e,"display")||h(e,"hitbox")||h(e,"pindot")||n.push(e.cloneNode(!0))}gr(n);Pi.pasteCount++}}function pr(){var r=parent.globalEditorClipboard;if(r){var n=ji.fileType.getAbstractFileType(r[0]),i=ji.fileType.getAbstractFileType(ya);if("sch"===n||"schlib"===n)if(r[1]!=e.frameElement.id){
var a=e.frameElement.ownerDocument.getElementById(r[1]),o=a&&a.contentWindow;o=o&&o.gClipboard;o=o&&o.childNodes;if(o&&o.length){var s,l,d,f=function(e){m(e,"style");m(e,"class");m(e,"id")},u=[];for(s=0,l=o.length;s<l;s++){d=t.importNode(o[s],!0);Fn(_i.colors,d);n==i?u[s]=d:u=u.concat(function e(t){if("none"==v(t,"display")||h(t,"hitbox")||h(t,"pindot"))return[];var r=ee(t),n=[];f(t);switch(r){case"schlib":case"netlabel":case"netflag":for(var i=0,a=t.children,o=a.length;i<o;i++){var s=e(a[i]);s.length&&(n=n.concat(s))}t=null;break;case"annotation":v(t,"c_shapetype","group");v(t,"c_etype","pinpart");var l=c("text",t);v(t,"c_origin",v(l,"x")+","+v(l,"y"));v(l,"type","comment");m(l,"c_note");break;case"pin":case"arrowhead":v(t,"c_shapetype","group");v(t,"c_etype","pinpart");break;case"svgnode":v(t,"c_shapetype","group");break;case"wire":case"bus":v(t,"c_shapetype","line");m(t,"c_etype");v(t,"stroke","#000000");break;case"arc":case"path":case"polyline":case"polygon":case"ellipse":case"circle":case"rect":case"image":v(t,"c_shapetype","line");m(t,"c_etype");break;case"text":v(t,"c_shapetype","line");v(t,"type","comment");m(t,"c_etype");var d=yn("g",{c_shapetype:"group",c_etype:"pinpart",c_partid:"part_annotation",c_origin:v(t,"x")+","+v(t,"y")});d.appendChild(t.cloneNode(!0));t=d;break;case"noconnectflag":t=c("path",t);v(t,"c_shapetype","line");v(t,"fill","none");v(t,"stroke","#000000");break;case"busentry":t=c("line",t);t=yn("polyline",{points:[v(t,"x1"),v(t,"y1"),v(t,"x2"),v(t,"y2")].join(" "),c_shapetype:"line",fill:"none",stroke:"#000000","stroke-width":"1"});break;case"line":t=yn("polyline",{points:[v(t,"x1"),v(t,"y1"),v(t,"x2"),v(t,"y2")].join(" "),c_shapetype:"line",fill:"none",stroke:v(t,"stroke"),"stroke-width":v(t,"stroke-width")});break;case"junction":default:t=null}t&&n.push(t);return n}(d))}u.length&&gr(u)}}else ur()}}function gr(e){if(e&&e.length&&!zi.on){var t,r,n,i=e.length;rr();var a=yn("g");for(t=-1;++t<i;)a.appendChild(e[t]);hi.appendChild(a);for(t=0,r=s("[id]",a),n=r.length;t<n;t++)0===r[t].id.indexOf("frame_")?v(r[t],"id",r[t].id.replace(/^(.*?)(?:[_?\d]*)$/,"$1_?")):v(r[t],"id","");var o,l,d,h,u,p,g=a.getBBox(),y={x:g.x+g.width/2,y:g.y+g.height/2},x=vt();o=Ve({x:Ht.data.clientX||x.clientWidth/2,y:Ht.data.clientY||x.clientHeight/2});h=c('g[c_partid="part_pin"]',a);h||(h=c("g[c_origin]",a));if(h){p=ji.numberlistToArray(v(h,"c_origin"));p={x:p[0],y:p[1]}}else p={x:y.x,y:y.y};if(1===i&&v(e[0],"c_origin")){u=ji.numberlistToArray(v(e[0],"c_origin"));u={x:u[0],y:u[1]}}else u={x:y.x,y:y.y};var m=je({x:p.x+o.x-u.x,y:p.y+o.y-u.y});l=m.x-p.x;d=m.y-p.y;l=ji.toFixed(l,2);d=ji.toFixed(d,2);ze(a,l,d);if(!1!==Di.getCacheObj("AutoAnnotatePre")&&"sch"==ji.fileType.getAbstractFileType(ya)){var _=s("text[c_note=note_pre]",a);if(_.length){var b=[];for(t=0,i=_.length;t<i;t++)b[t]=F(_[t].textContent).toUpperCase();var S=li.getNewPreArr(b,!0);for(t=0,i=_.length;t<i;t++)S[t]&&S[t]!=b[t]&&ji.node.setTextContent(_[t],S[t])}}it(a);var C;for(t=-1;++t<e.length;){f(e[t],"selected");C=ee(e[t]);"schlib"===C&&("cut"===Pi.pasteFrom&&Pi.pasteCount>0||"cut"!==Pi.pasteFrom)&&v(e[t],"bindPCBId",te());Jn.appendChild(e[t])}hi.removeChild(a);on(!0);Ot("cross-red",u.x+l,u.y+d);cn({targets:e,x:o.x,y:o.y,bbox:{x:g.x+l,y:g.y+d,width:g.width,height:g.height},hasPin:!!h});Ct("triggerEvent",["select_change"])}}function yr(e){if(e&&e.length){var t=e.map(function(e){var t=e.cloneNode(!0);e.parentNode.insertBefore(t,e.nextSibling);v(t,"class","");it(t);if("pinpart"==v(t,"c_etype")){var r=c("text[c_note=note_pre]",t);if(r){var n=F(r.textContent),i=getNewPre(n);n!=i&&ji.node.setTextContent(r,i)}}return t});di.updateMore(t);bi.solveItems(t);bi.solveTodoList();var r=t.map(function(e){return e.id}),n=r.join(",");xi.save(bi.batHistoryCmd(["add",n]));return r}}function vr(e,t){if(vi&&yi&&0===yi.indexOf("place.part_")){var r=yi.substr(6),n=o(r);if(pa.target)return e?ra.flipH([pa.target]):ra.flipV([pa.target]);if(n)return e?ra.flipH([n]):ra.flipV([n])}else{var i=Oi&&Oi.start,a=i;if(!nn()||i){var s;t=(t||Ar()).filter(function(e){return!aa.isLocked(e)});bi.solveItems(t);if(0!==t.length){a||(s=new Ln(t));e?ra.flipH(t):ra.flipV(t);fi&&Nt(fi);di.updateMore(t);bi.solveItems(t);bi.solveTodoList();if(!a){s.update();xi.save(bi.batHistoryCmd(s.hist))}}}}}function xr(e,t){function r(e,t,r){return{x:Math.round((e.x-r.x)/t)*t+r.x-e.x,y:Math.round((e.y-r.y)/t)*t+r.y-e.y}}t=t&&t.ids?t.ids:t;if(!t||Array.isArray(t)){t=t?[].map.call(t,function(e){return"string"==typeof e?o(e):e.gId?o(e.gId):e}).filter(function(e){return e&&e.parentNode==Jn&&!aa.isLocked(obj)}):Ar().filter(function(e){return!aa.isLocked(e)});if(t.length){bi.solveItems(t);var n,i,a,s,c,l,d,h,f,u,p,g,y=new Ln(t),v=[],x=0,m=_i.adsorbGrid.gridSize,_={x:_i.canvas.originX,y:_i.canvas.originY};for(a=0,s=t.length;a<s;a++){var b=ji.svg.getBBoxFixed(t[a],{excludeText:!0,excludePindot:!0});if(b.width||b.height){v[a]=b;if(0===a){n=b.x;i=b.y;h=b.x;f=b.y;u=b.x+b.width;p=b.y+b.height}switch(e){case"align_left":n=void 0===n?b.x:Math.min(n,b.x);break;case"align_right":n=void 0===n?b.x+b.width:Math.max(n,b.x+b.width);break;case"align_top":i=void 0===i?b.y:Math.min(i,b.y);break;case"align_bottom":i=void 0===i?b.y+b.height:Math.max(i,b.y+b.height);break;case"align_horizontal_center":i=void 0===i?b.y:Math.min(i,b.y);p=Math.max(p,b.y+b.height);a==s-1&&(i=(p+i)/2);break;case"align_vertical_center":n=void 0===n?b.x:Math.min(n,b.x);u=Math.max(u,b.x+b.width);a==s-1&&(n=(u+n)/2);break;case"align_horizontal_equidistant":n=void 0===n?b.x:Math.min(n,b.x);u=Math.max(u,b.x+b.width);break;case"align_vertical_equidistant":i=void 0===i?b.y:Math.min(i,b.y);p=Math.max(p,b.y+b.height);break;case"align_left_side_edge_equidistant":n=void 0===n?b.x:Math.min(n,b.x);h=void 0===n?b.x:Math.max(h,b.x);break;case"align_top_side_edge_equidistant":i=void 0===i?b.y:Math.min(i,b.y);f=void 0===i?b.y:Math.max(f,b.y);break;case"align_grid":n=void 0===n?b.x:Math.min(n,b.x);a==s-1&&(n=Math.round(n/m)*m);break;default:return}}}if((void 0!==n||"align_left"!=e&&"align_right"!=e&&"align_horizontal_center"!=e)&&(void 0!==i||"align_top"!=e&&"align_bottom"!=e&&"align_vertical_center"!=e)){if("align_vertical_center"==e||"align_top_side_edge_equidistant"==e||"align_vertical_equidistant"==e){var S=Pt(v,"y",t);t=S.objs;v=S.os}else if("align_horizontal_center"==e||"align_left_side_edge_equidistant"==e||"align_horizontal_equidistant"==e){var C=Pt(v,"x",t);t=C.objs;v=C.os}"align_left_side_edge_equidistant"==e?g=Math.abs(h-n)/(t.length-1):"align_top_side_edge_equidistant"==e&&(g=Math.abs(f-i)/(t.length-1));if("align_horizontal_equidistant"==e){g=u-n;if(v.length<=2)return;for(a=0;a<v.length;a++){g-=v[a].width;a==v.length-1&&(g/=v.length-1)}}else if("align_vertical_equidistant"==e){g=p-i;if(v.length<=2)return;for(a=0;a<v.length;a++){g-=v[a].height;a==v.length-1&&(g/=v.length-1)}}for(a=0,s=t.length,c=0;a<s;a++)if(v[a]){l=0;d=0;switch(e){case"align_left":l=n-v[a].x;break;case"align_right":l=n-v[a].x-v[a].width;break;case"align_top":d=i-v[a].y;break;case"align_bottom":d=i-v[a].y-v[a].height;break;case"align_horizontal_center":d=i-v[a].y-v[a].height/2;break;case"align_vertical_center":l=n-v[a].x-v[a].width/2;break;case"align_horizontal_equidistant":if(v[a].x+v[a].width===u)break;l=n-v[a].x;n=n+v[a].width+g;break;case"align_vertical_equidistant":if(v[a].x+v[a].height===p)break;d=i-v[a].y;i=i+v[a].height+g;break;case"align_left_side_edge_equidistant":l=Math.round(n-v[a].x);n+=g;break;case"align_top_side_edge_equidistant":d=Math.round(i-v[a].y);i+=g;break;case"align_grid":var P,w=t[a].getAttribute("c_origin");w&&(w=w.split(","));var N=t[a].children;N.length&&"text"==N[0].tagName&&(w="");if(w&&w.length)P=r({x:w[0],y:w[1]},m,_);else if("path"==t[a].tagName){var A=Me(t[a].getAttribute("d"));P=r({x:Number(A[1]),y:Number(A[2])},m,_)}else if("ellipse"==t[a].tagName||"circle"==t[a].tagName){var k=t[a].getAttribute("cx"),O=t[a].getAttribute("cy");P={x:Math.round(k/m-_.x)*m+_.x-v[a].x,y:Math.round(O/m-_.y)*m+_.y-v[a].y}}else if("polygon"==t[a].tagName||"polyline"==t[a].tagName){var T=Fe(t[a],1);P=r({x:Number(T[1]),y:Number(T[2])},m,_)}else P=r(v[a],m,_);l=P.x;d=P.y}if(l||d){ea.move(t[a],l,d);x++}else y.deleteItemAt(a+c--)}else y.deleteItemAt(a+c--);if(x){di.updateMore(t);bi.solveItems(t);bi.solveTodoList();y.update();xi.save(bi.batHistoryCmd(y.hist));fi&&Nt(fi)}}}}}function mr(e,t,r){void 0===t?t=270:"string"==typeof t&&(t=+t);t>360&&(t%=360);t<0&&(t=360+t%360);for(var n,i=0,a=0,o=e.length;i<o;i++){var s=e[i],c=v(s,"c_origin"),l=+v(s,"c_rotation")||0;if(c)c=ji.numberlistToArray(c);else{n=ji.svg.getBBox(s);c=[n.x+n.width/2,n.y+n.height/2]}if(!0===r){var d=t-l;d<0&&(d+=360);ta[s.tagName](s,d,c[0],c[1])}else ta[s.tagName](s,t,c[0],c[1]);a++}return a>0}function _r(){var e,t,r=arguments;e="object"==typeof r[0]?r[0]:Ar();t="number"==typeof r[0]?r[0]:"number"==typeof r[1]?r[1]:270;if(!e.length)return!1;bi.solveItems(e,"old");if(e.length>1){var n=ji.svg.getElementsCenter(e,!0);n=he(n);for(var i=0,a=e.length;i<a;i++){ji.svg.fixOrigin(e[i]);ta.rotate(e[i],t,n.x,n.y)}}else{ta.rotate(e[0],t);ji.svg.fixOrigin(e[0])}di.updateMore(e);bi.solveItems(e);bi.solveTodoList();fi&&Nt(fi);return a>0}function br(){var e,t,r,n,i=Ar().filter(function(e){return!aa.isLocked(e)}),a=i.length,o=[];if(a){for(e=a-1;e>=0;e--){t=i[e];r=t.parentNode;if(t!=r.lastChild){n=t.nextSibling?t.nextSibling.id:"";r.insertBefore(t,null);o.push(["elePosition",t.id,n,""])}}o.length&&xi.save(o)}}function Sr(){var e,t,r,n,i,a=Ar(),o=a.length,s=[];if(o){for(e=o-1;e>=0;e--){t=a[e];r=t.parentNode;if(t!=r.firstChild){n=t.nextSibling?t.nextSibling.id:"";i=r.firstChild.id;r.insertBefore(t,r.firstChild);s.push(["elePosition",t.id,n,i])}}s.length&&xi.save(s)}}function Cr(e,t){function r(e,t){for(var r=gi[e],n=e;r&&r.tagName!=t;){v(r,"id","cline"+ ++n);r=gi[n]}if(r){if(n!=e){gi.splice(n,1);gi.splice(e,0,r);v(r,"id","cline"+e)}}else{r=yn(t,{fill:"none",stroke:v(gi[0],"stroke"),"stroke-dasharray":v(gi[0],"stroke-dasharray"),id:"cline"+e});fa.insertBefore(r,gi[e]||null);gi.splice(e,0,r)}return r}function n(e){var t=pi[e];if(!t){t=ha.appendChild(g(pi[0]));v(t,"id","crect"+e);pi[e]=t}return t}if(ya!=ii.WAVEFORM&&ya!=ii.PHOTOVIEW){v(la,{visibility:"visible"});v(ha,{visibility:"visible"});v(fa,{visibility:"visible"});var i=e.length/2,a=ui.length;if(0===a){ui[0]=o("cdot0");ui[1]=o("cdot1");a=2}var s,c,l={},d={},h={};l.transform=d.transform=h.transform=t||"";l.visibility=d.visibility=h.visibility="";l.r=4/Wi;if(!e.onlyLines)for(s=0,c=Math.max(i,a);s<c;s++){l.visibility="";if(s<i&&s<a);else{if(s>=i){v(ui[s],{visibility:"hidden"});continue}ui[s]=ui[0].cloneNode(!0);l.id="cdot"+s;la.appendChild(ui[s])}l.cx=e[2*s];l.cy=e[2*s+1];if("odd"==e.lightDots&&s%2){l.class="light";if(ya==ii.PCB||ya==ii.PCBLIB||ya==ii.PCBMODULE){var f=Ar()[0];f&&"TRACK"==ee(f)&&isSignalLayer(v(f,"layerid"))&&(l.visibility="hidden")}}else l.class="";v(ui[s],l)}var u=e.c_helper_lines;if(u){var p=gi.length,y=pi.length;if(0===p){gi[0]=o("cline0");p=1}if(0===y){pi[0]=o("crect0");y=1}s=-1;for(var x,m,_,b,S,C=-1,P=-1;++s<u.length;)if("rect_center_corner"==u[s].type){b=n(++P);x=u[s].center;m=u[s].corner;_=[e[2*x],e[2*x+1],e[2*m],e[2*m+1]];v(b,d);v(b,{x:Math.min(2*_[0]-_[2],_[2]),y:Math.min(2*_[1]-_[3],_[3]),width:2*Math.abs(_[0]-_[2]),height:2*Math.abs(_[1]-_[3])})}else if("rect_corner_corner"==u[s].type){b=n(++P);x=u[s].corner1;m=u[s].corner2;_=[e[2*x],e[2*x+1],e[2*m],e[2*m+1]];v(b,d);v(b,{x:Math.min(_[0],_[2]),y:Math.min(_[1],_[3]),width:Math.abs(_[0]-_[2]),height:Math.abs(_[1]-_[3])})}else if("rect"==u[s].type){b=n(++P);v(b,d);v(b,u[s].data)}else if("path_arc"==u[s].type){S=r(++C,"path");v(S,h);v(S,"d",e.path_arc||"")}else{S=r(++C,"line");v(S,h);x=u[s].from;m=u[s].to;_={x1:e[2*x],y1:e[2*x+1],x2:e[2*m],y2:e[2*m+1]};var w=_.x2-_.x1,N=_.y2-_.y1;if(!w&&!N){v(S,"visibility","hidden");continue}if(-1===u[s].ray){_.x2=_.x1+_.x1-_.x2;_.y2=_.y1+_.y1-_.y2}if(1===u[s].ray||-1===u[s].ray){var A=ua.getViewBox(),k=+A[0],O=+A[1],T=k+ +A[2],L=O+ +A[2];if(_.x2>k&&_.x2<T&&_.y2>O&&_.y2<L){var I=_.x2<_.x1?k:T,E=_.y2<_.y1?O:L,M=w?(I-_.x1)/w:0,V=N?(E-_.y1)/N:0,B=Math.min(M,V);_.x2=_.x1+B*w;_.y2=_.y1+B*N}}v(S,_)}for(s=C+1;s<p;s++)v(gi[s],{visibility:"hidden"});for(s=P+1;s<y;s++)v(pi[s],{visibility:"hidden"})}else{v(ha,{visibility:"hidden"});v(fa,{visibility:"hidden"})}}}function Pr(e,t,r){r=r||"";var n,i,a,s,l,d,f,u,p,g,y="check-group"==e&&1===arguments.length,x=Ar().filter(function(e){return!aa.isLocked(e)}),_=[],b=[],S=[];if(0===x.length)return"group fail";if(1===x.length){xi.startBatch();a=x[0];if("group"==v(a,"c_shapetype")&&c('g[c_partid="part_annotation"] text[c_note="note_name"]',a)){di.removeOne(a);var C=a.children;for(n=0,i=C.length;n<i;n++){p=C[n].cloneNode(!0);"part_annotation"==v(p,"c_partid")&&m(p,"display");if(!h(p,"hitbox")&&"none"!=v(p,"display")){l="g"==p.tagName?"group":"line";v(p,"c_shapetype",l);if("part_annotation"==v(p,"c_partid")){g=c("text[c_note]",p);if(g){v(g,"c_note")&&v(g,"c_note_0",v(g,"c_note"));v(g,"type","comment");m(g,"c_note")}}Jn.appendChild(p);it(p);di.updateOne(p);S.push(p.id)}}S.length>0&&b.push(["add",S.join(",")]);b.push(["del",a.id]);Yi.appendChild(a);xi.save(b);xi.saveBatch();return"ungroup ok"}return"ungroup fail"}var P,w;for(n=0,i=x.length;n<i;n++){a=x[n];s=v(a,"c_partid");l=v(a,"c_shapetype");d=v(a,"c_etype");if("part_pin"==s||"part_annotation"==s||"line"==l&&!d){if("part_annotation"==s){g=c("text",a);f=v(g,"c_note")||v(g,"c_note_0");if("note_name"==f){w=!0;_.unshift(a);continue}if("note_pre"==f){P=!0;w?_.splice(1,0,a):_.unshift(a);continue}}_.push(a)}}if(_.length<2)return"group fail";if(_.length==(P?1:0)+(w?1:0))return"group fail";if(y){e=P?_[w?1:0].firstChild.firstChild.nodeValue:"";t=w?_[0].firstChild.firstChild.nodeValue:"";r="";return[e,t,r]}var N="package`"+r,A=o("part_import_tmpl").cloneNode(!0);A.id=ji.newId();for(n=0,i=_.length;n<i;n++){a=_[n];m(a,"class");p=a.cloneNode(!0);m(p,"c_shapetype");A.appendChild(p);di.removeOne(p);Yi.appendChild(a);S.push(a.id)}S.length>0&&b.push(["del",S.join(",")]);v(A,{c_para:N,display:""});Jn.appendChild(A);it(A);b.push(["add",A.id]);xi.save(b);var k,O,T,L,I,E;T=A.children[0];L=A.children[1];if(P&&w){A.removeChild(T);A.removeChild(L)}else if(P)A.removeChild(L);else if(w){A.removeChild(T);A.removeChild(L);A.insertBefore(L,A.children[1]||null)}k=A.children[0];O=A.children[1];I=c("text",k);E=c("text",O);Ye(I,t||"none");Ye(E,e||"none");m(I,"c_note_0");m(E,"c_note_0");v(I,"c_note","note_name");v(E,"c_note","note_pre");O.style.display="none";k.style.display="none";var M=ji.svg.getBBoxFixed(A);k.style.display="";O.style.display="";var V=function(e,t,r,n){var i=+v(e,"c_rotation")||0;180==i&&(i=0);v(t,{x:r,y:n,transform:i?"rotate("+(360-i)+","+r+","+n+")":""});v(e,"c_origin",r+","+n);v(e,"c_rotation",i)},B=function(e,t){var r=v(t,"x"),n=v(t,"y");V(e,t,r,n)};w?B(k,I):V(k,I,Math.round(M.x+M.width/2),Math.round(M.y+M.height+10));P?B(O,E):V(O,E,Math.round(M.x+M.width/2),Math.round(M.y-5));u={x:M.x+M.width/2,y:M.y+M.height/2};u=he(u);v(A,"c_origin",u.x+","+u.y);at(A);di.updateOne(A);return"group ok"}function wr(){if(parent!=self){var e=k(Qi);if(e)for(var r,n,i=t.adoptNode(e.documentElement),a=i.childNodes,s=a.length-1;s>=0;s--){r=v(n=a[s],"c_partid");if(r&&!o(r)){o("gCurParts").appendChild(n);v(n,{id:r,display:"none"})}}}}function Nr(e){var r,n=[];if(parent!=self){var i=k(Qi);if(i){for(var a,s,c=t.adoptNode(i.documentElement),l=c.childNodes,d=l.length-1;d>=0;d--){a=v(s=l[d],"c_partid");if(a&&o(a)){if(e&&a.match(/part_import/))continue;r=o(a).cloneNode(!0);o(a).remove();v(s,{id:a,display:"none"});o("gCurParts").appendChild(s);n.push({exNode:r,newNode:s.cloneNode(!0)})}}return n}}}function Ar(e){var t=s("#g1>.active,#g1 .selected,#g1 .active",Jn).toArray();t=t.filter(function(e){var t=e.parentNode;return t==Jn||t.parentNode==Jn&&!h(t,"selected")&&!h(t,"active")});for(var r=0,n=t.length;r<n;r++)if(function(e){return e&&"g"==e.tagName&&e.parentNode&&"part_image"==v(e,"c_partid")&&e.parentNode.parentNode==Jn}(t[r])){t[r]=t[r].firstChild;null===t[r]&&t.length--}if(!e)return t;var i={};for(r=0,n=t.length;r<n;r++){var a=ee(t[r]),o=t[r].id;if(a&&o&&di.gJsonCache[a]){i[a]||(i[a]={});i[a][o]=di.gJsonCache[a][o]}}return i}function kr(){return Jn.querySelector("#g1>.active,#g1 .selected")}function Or(e){var t=e||Ar(),r=t.length;if(r>0){for(var n=r;--n>=0;)l(t[n],"selected",!1);wt()}return r}function Tr(){Ct("multiSelect",[!0]);if(fi){l(fi,"active",!1);fi=null;wt()}var e,t,r,n=s("#g1 .hover, #g1 .wire-hover");for(e=n.length-1;e>=0;e--){l(n[e],"hover",!1);l(n[e],"wire-hover",!1)}t=s("#g1 .selected",Jn);for(e=0;e<t.length;e++)l(t[e],"selected",!1);t=s('#g1 > [c_shapetype]:not(.selected):not([display="none"])',Jn);t=[].filter.call(t,function(e){var t=getComputedStyle(e);return t&&"none"!=t.display});r=t.length;if(r>0){e=r;for(;--e>=0;)l(t[e],"selected",!0)}Ct("triggerEvent",["select_change"]);return r}function Lr(e){rr();e=e.filter(function(e){return e&&e.parentNode==Jn&&!h(e,"events-none")&&function(e){var t=getComputedStyle(e);return t&&"none"!=t.display}(e)});for(var t=0;t<e.length;t++)l(e[t],"selected",!0)}function Ir(e){var t=e.id;if(t){var r,n,i,a,s=fi;if(!aa.isLocked(s)&&s&&s.parentNode==Jn){r=o(t);if(r&&r.parentNode==la&&"light"!=v(r,"class")&&("path"==s.tagName||"polyline"==s.tagName||"polygon"==s.tagName)){n=+t.substr(4);i=la.children[1];!i||"light"!=v(i,"class")&&"hidden"!=v(i,"visibility")||(n>>=1);if("path"!=s.tagName){var c=s,l=c.points,d=l.numberOfItems;if(!(d<=2)&&n>=0&&n<d){a=["attr",c.id,{points:v(c,"points")}];var h="wire"==ee(c);h&&bi.solveItem(c);l.removeItem(n);Nt(c);di.updateOne(c);h&&bi.solveItem(c);h&&bi.solveTodoList();a[3]={points:v(c,"points")};xi.save(h?bi.batHistoryCmd(a):a)}}else{a=["attr",s.id,{d:v(s,"d")}];ji.svg.deletePathPointAtCdot(s,n);a[3]={d:v(s,"d")};if(a[2].d!=a[3].d)if(s.getTotalLength(s)<.01){v(s,"d",a[2].d);dr([s])}else{di.updateOne(s);Nt(s);xi.save(a)}}}}}}function Er(e){if(!e)return!1;for(var t,r,n,i,a=e.children,o={},s=0,c=!1,l=0,d=a.length;l<d;l++){t=a[l];if("part_pin"==v(t,"c_partid")){r=v(t,"c_spicepin")||"";i=F(H(t.children[0].textContent))||"";n=F(H(t.children[1].textContent))||"none";o[s++]={spicePinOrder:r,pinName:i,id:l,pinNum:n};"none"==F(v(t,"display"))&&(c=!0)}}return{pinMap:o,pinCount:s,hiddenPin:c}}function Mr(e){var t,r=e.data,n=Jn.children;for(var i in r)if(w(r,i)&&r[i]){t=n[r[i].id];if(t){v(t,{c_spicepin:r[i].spiceNum});ji.node.setTextContent(t.children[0],r[i].name);ji.node.setTextContent(t.children[1],r[i].num)}}di.calAll()}function Vr(){var e=Ar();if(e.length>0){var t=e[0],r=v(t,"c_para")||"";if(0===r.length)return!1;var n,i,a=ji.c_paraToJson(r);n=Vt("pre",t).childNodes[0].textContent;i=a.spicePre;var o=Er(t)||{};return{pre:n,spicePre:i,pinMap:o.pinMap,pinCount:o.pinCount,hiddenPin:o.hiddenPin}}return!1}function Br(){var e=Er(Jn)||{};return{pinMap:e.pinMap,pinCount:e.pinCount,hiddenPin:e.hiddenPin}}function Gr(e){var t=v(e,"c_partid"),r=t&&o(t),n=e.cloneNode(!0);v(n,"id",r.id);v(n,"display","none");v(s("[id]",n),"id","");o("gCurParts").replaceChild(n,r)}function Fr(e){if(!e){e=fi&&fi.id.match(/^frame_lib_/)&&fi;e||(e=c("#g1 > g.selected[id^=frame_lib_]"));e||(e=c("#g1 > g[id^=frame_lib_]"))}if(e&&e.id.match(/^frame_lib_/)){var t=c("rect[id^=frame_outbox_]",e),r=Hr(e)||{};return ji.extend(r,{id:e.id,width:+v(t,"width")+20,height:+v(t,"height")+20})}}function Rr(e){if(e.width&&e.height){e.id&&(e.id.match(/^frame_lib_/)&&o(e.id)||(e.id=""));if(e.id){var t=o(e.id);if(!t)return;jr(t,e);Dr(t,{date:"?",product:"?"});t.parentNode==Jn&&di.updateOne(t)}else{var r={},n=Hr("LAST");n=ji.extend({},r,n);e.title&&(n.title=e.title);e.drawn&&(n.drawn=e.drawn);Dr(o("part_frame_lib"),n);jr(o("part_frame_lib"),e);Jt("place.part_frame_lib")}}}function Dr(e,t){var r=e.nodeType?e:o(e);if(r)for(var n in t)if(w(t,n)){var i=t[n];switch(n){case"date":if(!i||"?"==i){var a=new Date;i=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();i=i.replace(/\b\d\b/g,"0$&")}break;case"product":i="EASYEDA V"+$n}i&&"?"!=i&&function(e,t){for(var n='g[id^="frame_?_"] text, text[id^="frame_?_"]'.replace(/\?/g,e),i=s(n,r),a=0;a<i.length;a++)Ye(i[a],t||"?")}(n,i)}}function Hr(e){if("FIRST"==e){e=c('#g1 > g[id^="frame_lib_"]');e||(e=o("part_frame_lib"))}else if("LAST"==e){e=s('#g1 > g[id^="frame_lib_"]');e.length&&(e=e[e.length-1]);e||(e=o("part_frame_lib"))}var t=e.nodeType?e:o(e);if(t){for(var r,n="%1 g%2 text, %1 text%2".replace(/%1/g,t.id?"#"+t.id:"").replace(/%2/g,'[id^="frame_"]:not([id^="frame_tick_"])'),i=s(n,t),a={},l=/^frame_(.+?)_\d+$/,d=0;d<i.length;d++)for(var h=i[d];h!=t;){r=h.id.match(l);if(r){a[r[1]]=We(i[d]);break}h=h.parentNode}return a}}function jr(e,t){var r,n,i,a,o,l,d={A4:{w:1169,h:826},A3:{w:1652,h:1169},A2:{w:2338,h:1652},A1:{w:3304,h:2338},A0:{w:4676,h:3304},A:{w:1100,h:850},B:{w:1700,h:1100},C:{w:2200,h:1700},D:{w:3400,h:2200},E:{w:4400,h:3400},USLetter:{w:1100,h:850},USLegal:{w:1400,h:850},USLedger:{w:1700,h:1100}},h={stroke:"#880000","stroke-width":1,fill:"none"},f={type:"comment",fill:"#880000","font-family":"Verdana","font-size":"7pt","text-anchor":"start"},u=function(){var e=yn("g",{id:"frame_tick_?",c_origin:"0,0",c_partid:"part_annotation"});e.appendChild(yn("text",ji.extend(f,{x:0,y:0})));return function(t,r,n){var i=e.cloneNode(!0);Ye(i.children[0],t,"\\n");v(i,"c_origin",r+","+n);v(i.children[0],{x:r,y:n});return i}}(),g=function(t){return e.insertBefore(t,x)};if(t.width&&t.height){n=t.width;i=t.height}else if(t.size){r=d[t.size]||{};n=r.w;i=r.h}if(n&&i){a=t.orientation||(n>=i?"L":"P");n<i!=("P"==a)&&(n=[i,i=n][0]);n-=20;i-=20;var y=c("[id^=frame_outbox]",e),x=c("[id^=frame_innerbox]",e);if(y&&x){var m=_(y);o=+m.x+(m.width-n);l=+m.y+(m.height-i);var b={x:o,y:l,width:n,height:i},S={x:o+10,y:l+10,width:n-20,height:i-20};v(y,b);v(x,S);v(e,"c_origin",o+(.5*n|0)+","+(l+(.5*i|0)));var C,P,w,N,A,k,O=[],T=S.x,L=S.y,I=Math.floor(S.width/196),E=Math.floor(S.height/196),M=s("[id^=frame_tick_]",e);for(P=0;P<M.length;P++)p(M[P]);for(P=1,w=T;P<=I;P++){w+=196;O.push(["M",w,L,"L",w,L-10].join(" "));O.push(["M",w,L+S.height,"L",w,L+S.height+10].join(" "))}for(P=1,N=L;P<=E;P++){N+=196;O.push(["M",T,N,"L",T-10,N].join(" "));O.push(["M",T+S.width,N,"L",T+S.width+10,N].join(" "))}A=O.join("").replace(/\s*([a-z])\s*/gi,"$1");C=yn("path",{id:"frame_tick_?",d:A});v(C,h);g(C);for(P=1;P<=E;P++){N=S.y+196*(P-.5);k=function(e){if(e<1)return"";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZ";if(e<=26)return t[e-1];for(var r="",n=1,i=26;(e-=n)>=0;n=i,i*=26)r=t[e%i/n|0]+r;return r}(P);g(u(k,S.x-10+1.5,N));g(u(k,S.x+S.width+1.5,N))}for(P=1;P<=I;P++){w=S.x+196*(P-.5);k=P+"";g(u(k,w,S.y-1.5));g(u(k,w,S.y+S.height+10-1.5))}it(e);v(c(".hitbox",e),{x:o,y:l,width:0,height:0});ea.move(e,m.x-v(y,"x"),m.y-v(y,"y"))}}}function Ur(e,t){var r=c("rect[id^=frame_outbox_]",e),n=+v(r,"width")+20,i=+v(r,"height")+20,a=n>=i?"L":"P";if(t["attr-sheet-size-template"]){a=t["attr-sheet-orientation"]||a;jr(e,{size:t["attr-sheet-size-template"],orientation:a})}else if(t["attr-sheet-orientation"]){n=+t["attr-sheet-width"]||n;i=+t["attr-sheet-height"]||i;jr(e,{width:n,height:i,orientation:t["attr-sheet-orientation"]})}else if(t["attr-sheet-width"]){n=+t["attr-sheet-width"];i=+t["attr-sheet-height"]||i;jr(e,{width:n,height:i})}else if(t["attr-sheet-height"]){n=+t["attr-sheet-width"]||n;i=+t["attr-sheet-height"];jr(e,{width:n,height:i})}"attr-sheet-x"in t&&ea.move(e,t["attr-sheet-x"]-v(r,"x"),0);"attr-sheet-y"in t&&ea.move(e,0,t["attr-sheet-y"]-v(r,"y"));if(t["attr-sheet-color"]){v(s("rect,polyline,path",e),"stroke",t["attr-sheet-color"]);v(s("g[id^=frame_tick_]>text, g[id^=frame_product_]>text, g:not([id^=frame_])>text",e),"fill",t["attr-sheet-color"])}}function zr(e){var t=c("rect[id^=frame_outbox_]",e),r=+v(t,"width")+20,n=+v(t,"height")+20,i={};i["attr-sheet-size-template"]="";i["attr-sheet-orientation"]=r>=n?"L":"P";i["attr-sheet-width"]=r;i["attr-sheet-height"]=n;i["attr-sheet-color"]=v(t,"stroke")||"#880000";i["attr-sheet-x"]=+v(t,"x");i["attr-sheet-y"]=+v(t,"y");return i}function Xr(e,t){for(var r in ri)if(w(ri,r)&&ri[r].W==e&&ri[r].H==t)return r;return"none"}function Yr(){return s("g[c_partid=part_netLabel_volProbe]",Jn).filter(function(e){return e!=pa.target})}function Wr(){for(var e=s("g>g>[c_note=note_name]",Jn),t=0,r=e.length;t<r;t++)if("Voltmeter"==We(e[t])||"Ammeter"==We(e[t]))return!0;return!1}function Jr(e){for(var t=s("text[type=spice]",Jn),r=0,n=t.length;r<n;r++){var i=We(t[r]);if("probe"==e){if((i||"").match(/\bprobe\b/gi))return!0}else if("gnd"==e){if((i||"").match(/\bgnd\b/gi))return!0;if((i||"").match(/\b0\b/gi))return!0}else{var a=new RegExp("^\\.?"+e+"\\b","mi");if((i||"").match(a))return!0}}return!1}function $r(e){var t,r=Yr(),n=!1,i=e||"volProbe1";t=i.match(/\D+\d+$/)?i.match(/(\D+)\d+$/)[1]:i;for(var a=1;a<100;a++){n=!1;for(var o=0,s=r.length;o<s;o++)if(r[o].childNodes[1]&&r[o].childNodes[1].firstChild&&i.toLowerCase()==F(r[o].childNodes[1].firstChild.nodeValue||"").toLowerCase()){i=t+a;n=!0;break}if(!n)return i}}function Kr(e,t,r,n){if(e||t){var i,a,o,s,l;r&&(s=r.parentNode);n&&(l=n.parentNode);if(r||n){p(r);p(n)}var d=(e||t).parentNode.parentNode,h={top:!!c('g[c_partid="part_pin"][c_rotation="90"]',d),left:!!c('g[c_partid="part_pin"][c_rotation="180"]',d),right:!!c('g[c_partid="part_pin"][c_rotation="0"]',d),bottom:!!c('g[c_partid="part_pin"][c_rotation="270"]',d)};h.all=h.top&&h.left&&h.right&&h.bottom;if(Fi&&"none"===v(d,"display")){v(d,"display","");o=ji.svg.getBBoxFixed(d,{excludeText:!0});v(d,"display","none")}else o=ji.svg.getBBoxFixed(d,{excludeText:!0});if(e){m(e,"transform");i=ji.svg.getBBox(e)}if(t){m(t,"transform");var f="none"==v(t.parentNode,"display");f&&v(t.parentNode,"display","");a=ji.svg.getBBox(t);f&&v(t.parentNode,"display","none")}e&&(!h.top||h.all?ea.text(e,h.all?o.x-i.x:o.x+o.width/2-(i.x+i.width/2),o.y-(i.y+i.height)-10):h.right?h.bottom?h.left||ea.text(e,o.x-(i.x+Math.max(i.width,a.width)),o.y+o.height/2-(i.y+i.height/2)):ea.text(e,o.x+o.width/2-(i.x+i.width/2),o.y+o.height-i.y):ea.text(e,o.x+o.width-i.x+2,o.y+o.height/2-(i.y+i.height/2)));if(t){if(!e){e=c("g>g>text[c_note=note_pre]",d);if(!e)return}i=ji.svg.getBBox(e);var u="start"==v(e,"text-anchor")?i.x:i.x+a.width;v(t,{"text-anchor":v(e,"text-anchor"),x:u,y:i.y+i.height+7})}r&&s.appendChild(r);n&&l.appendChild(n)}}function qr(e,t){if(e||t){var r,n,i,a=0,o=(e||t).parentNode.parentNode;e&&(n=e.parentNode);t&&(i=t.parentNode);p(e);p(t);r=ji.svg.getBBoxFixed(o,{excludeText:!1});e&&n.appendChild(e);t&&i.appendChild(t);if(e){m(e,"transform");a=12}if(t){m(t,"transform");var s="none"==v(t.parentNode,"display");s&&v(t.parentNode,"display","");s&&v(t.parentNode,"display","none")}e&&v(e,{x:r.x,y:r.y+r.height+11});t&&v(t,{x:r.x+a,y:r.y+r.height+11})}}function Qr(e){if(!e)return!1;var t=v(e,"c_partid");if(!t||0!==t.indexOf("part_import_"))return!1;var r=c('g[c_partid="part_annotation"] text[c_note="note_pre"]',e);return!!r&&!!/\.\d+$/.test(r.textContent)}function Zr(){function e(e){var t=e.target;t&&1!==t.nodeType&&t.parentNode&&(t=t.parentNode);if(!t||!t.tagName||"TEXTAREA"!=t.tagName.toUpperCase()){e.preventDefault();e.stopPropagation();return!1}}for(var r=["selectstart","drag","draggesture","dragstart","dragover"],n=0;n<r.length;n++)t.addEventListener(r[n],e,!1);void 0!==Gi&&Gi&&t.addEventListener("mousedown",function(e){if((Ii?e.metaKey:e.ctrlKey)&&0===e.button){hi.currentScale=1;hi.currentTranslate.x=0;hi.currentTranslate.y=0}},!1)}function en(e){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.ready=!1;this.start=!1;e&&e.ondragstart&&(this.ondragstart=e.ondragstart);e&&e.ondrag&&(this.ondrag=e.ondrag);e&&e.ondragend&&(this.ondragend=e.ondragend)}function tn(e){var r=this;r.x0=0;r.y0=0;r.x1=0;r.y1=0;r.target=null;r.ready=!1;r.start=!1;if(e)for(var n in e)w(e,n)&&(r[n]=e[n]);t.addEventListener("mousedown",r.mdown,!1)}function rn(e){var t=this;t.x0=0;t.y0=0;t.x1=0;t.y1=0;t.ready=!1;t.start=!1;t.mouseIsDown=!1;t.mousedownTarget=hi;t.mousemoveTarget=hi;t.mouseupTarget=hi;if(e&&e instanceof Object)for(var r in e)w(e,r)&&(t[r]=e[r]);t.e={};t.e.mdown=function(e){t.mdown.call(t,e)};t.e.mmove=function(e){t.mmove.call(t,e)};t.e.mup=function(e){t.mup.call(t,e)}}function nn(){return ki&&ki.start||Oi&&Oi.start||Ti&&Ti.start}function an(){var e={rect:ca,show:function(e,t,r,n){v(ca,{display:"",width:r,height:n,x:e,y:t})},showD:function(e,t,r,n){v(ca,{display:"",width:Math.abs(r),height:Math.abs(n),x:r>0?e:e+r,y:n>0?t:t+n,stroke:ya==ii.WAVEFORM?Hi._gridSetting.gridColor:"#0000FF"})},hide:function(){v(ca,{display:"none"})}};ki=new en({ondragstart:function(e){bi.solveItem(this.target)},ondrag:function(e){var t=this,r=v(t.target,"c_etype");"wire"!=r&&"bus"!=r||di.checkShow(t.targetX0+t.movedX,t.targetY0+t.movedY)},ondragend:function(e){var t=this,r=t.target,n=v(r,"c_etype");"line"==v(r,"c_shapetype")&&Nt(r);di.updateOne(r);"wire"!=n&&"bus"!=n||v(o("pdot0"),"display","none");bi.solveItem(r);bi.solveTodoList();var i=t.attrs,a=_(r);D(i,a);delete i.class;delete a.class;xi.save(bi.batHistoryCmd(["attr",r.id,i,a]))}});Oi=new tn({ondragstart:function(e){var t,r,n=this,i=n.selectedObjs,a=[];wt();if(!n.atPartNoteText&&!n.atPartText||1!==i.length){var s,c,l,d,h=Zi.calFollowing(i),f=h.followingWireIds,u=h.followingNoConnectFlagIds;for(s in f)if(w(f,s)){c=o(s);bi.solveItem(c,"old");a.push(["node",s,c.cloneNode(!0),null])}a.wiresCount=a.length;for(l in u)if(w(u,l)){d=o(l);bi.solveItem(d);a.push(["node",l,d.cloneNode(!0),null])}a.noConnectFlagsCount=a.length-a.wiresCount;for(t=0,r=i.length;t<r;t++)a.push(["node",i[t].id,i[t].cloneNode(!0),null]);n.hist=a;n.followingInfo=h;bi.solveItems(i,"old")}else{var p=n.evtTarget;n.hist=["node",p.parentNode.id,p.parentNode.cloneNode(!0),null]}},ondrag:function(e){var t=this,r=t.selectedObjs;if(!t.atPartNoteText&&!t.atPartText||1!==r.length){t.followingInfo&&t.followingInfo.followingMap&&Zi.moveFollowing(t.followingInfo.followingMap);t.followingInfo&&t.followingInfo.followingMapFlag&&Zi.moveFollowingNoConnectFlags(t.followingInfo.followingMapFlag)}},ondragend:function(e){var t=this,r=t.selectedObjs,n=!(!t.movedX&&!t.movedY);if(!t.atPartNoteText&&!t.atPartText||1!==r.length){if(1==r.length&&"line"==v(r[0],"c_shapetype")){fi&&fi!=r[0]&&rr();Nt(r[0]);fi=r[0];l(fi,"active",!0)}var i,a,s,c,d,h,f,u,p=0,g=0,y=t.hist;for(c=0,d=y.wiresCount;c<d;c++){i=y[c][1];a=o(i);Be(a);if(a&&v(a,"points")!=v(y[c][2],"points")){p++;if(a.points&&a.points.numberOfItems<2){s=ji.node.getRefId(a);di.removeOne(a);v(a,"points",v(y[c][2],"points"));Yi.appendChild(a);y[c]=["del",i,s]}else{t.addWire.indexOf(a.id)>-1?y[c]=["add",i,ji.node.getRefId(a)]:y[c][3]=a.cloneNode(!0);di.updateOne(a);bi.solveItem(a)}}else y[c].length=0}for(c=y.wiresCount,d=y.noConnectFlagsCount+y.wiresCount;c<d;c++){f=y[c][1];u=o(f);bi.solveItem(u);y[c][3]=u.cloneNode(!0);di.updateOne(u)}for(c=0,d=r.length;c<d;c++){h=y[c+y.wiresCount+y.noConnectFlagsCount];if(!n&&ji.node.isSame(h[2],r[c]))h.length=0;else{g++;h[3]=r[c].cloneNode(!0)}}di.updateMore(r);bi.solveItems(r);bi.solveTodoList();1==r.length&&Ct("updateAttrPanel");y.length&&(p||g)&&xi.save(bi.batHistoryCmd(y));t.hist=null;Zi.uplock=!0}else{var x=t.evtTarget,m=x;if(!n&&ji.node.isSame(t.hist[2],x.parentNode))return;t.hist[3]=x.parentNode.cloneNode(!0);for(;m&&m.parentNode!=Jn;)m=m.parentNode;m&&di.updateOne(m);xi.save(t.hist);t.hist=null}}});Ti=new rn({strictMousedownTarget:hi,onmousedown:function(e,t){if(yi)return!1;if(ki.start)return!1;if(Oi.start)return!1;if(!e.shiftKey){var r=Ar();if(r.length>0){rr(r);Ct("triggerEvent",["select_change"])}}ya==ii.WAVEFORM&&(Ci.isDrawingSelectBox=!0)},onready:function(e,t){rr()},ondragstart:function(e,t){},ondrag:function(t,r){if(0!==r.dx&&0!==r.dy){if(!zi.pasting){ya==ii.WAVEFORM&&Ci.updateMessageBarInfo({x:r.x0,y:r.y0,width:r.dx,height:r.dy});e.showD(r.x0,r.y0,r.dx,r.dy)}}else e.hide()},ondragend:function(t,n){if(!zi.pasting){e.hide();var i={x:n.dx>0?n.x0:n.x0+n.dx,y:n.dy>0?n.y0:n.y0+n.dy,width:n.dx>0?n.dx:-n.dx,height:n.dy>0?n.dy:-n.dy};if(ya!=ii.WAVEFORM){for(var a,o,s,c,d,f,u=Jn.children,p=u.length,g=p;--g>=0;){d=u[g]
;f=getComputedStyle(d);if((!f||"none"!=f.display)&&!(f&&"none"==f.pointerEvents||d.id.match(/^frame_lib_/))){try{o=Te(d)}catch(e){continue}if(n.dx>0)s=ji.isRectInRect(o,i);else{s=ji.isRectTouchRect(o,i);s&&("polyline"==d.tagName?s=ji.isPolylineTouchRect(d,i):"polygon"==d.tagName&&(s=ji.isPolygonTouchRect(d,i)))}a=h(d,"selected");if(s!=a){l(d,"selected",s);Ct("multiSelect",[!0]);c=!0}}}c&&Ct("triggerEvent",["select_change"]);r("dragMoveCheck",[t])}else Ci.zoomViaSelectBox(i)}}})}function on(e){var r=zi;if(r.on!==e){if(r.on&&r.waitingSave&&r.targets){if(r.pasting)return;if(r.offsetX||r.offsetY){di.updateMore(r.targets);bi.solveItems(r.targets);bi.solveTodoList();xi.save(bi.batHistoryCmd(["move",r.ids,r.offsetX,r.offsetY]))}r.targets=null;r.ids="";r.waitingSave=0}qt();r.on=void 0!==e?e:!r.on;!r.on&&r.targets&&(r.targets=null);Ot(r.on?"grab":void 0);!r.on&&r.pasting&&delete r.pasting;if(!1===e&&r.bind||null===r.targets){r.bind=!1;t.removeEventListener("mousemove",hn,!1);t.removeEventListener("mouseup",ln,!1);t.removeEventListener("keydown",fn,!1)}}}function sn(e,r){if(zi.on){zi.targets=r||Ar();if(!(zi.targets.length<=0)){var n=zi,a=xt(e,!1);n.startX=a.x;n.startY=a.y;n.offsetX=0;n.offsetY=0;n.hasPin=!!c('g.selected[c_partid="part_pin"], g.selected g[c_partid="part_pin"]');r||(r=n.targets);l(Jn,"hidetext",!1);var o=r[0].id,s=r.length;for(i=1;i<s;i++)o+=","+r[i].id;n.ids=o;n.waitingSave=0;Ot("grabbing",n.startX,n.startY);n.snapped=_i.adsorbGrid.enabled;n.unitSnap=!1;for(i=0;i<s;i++){var d=ee(n.targets[i]);if("pin"==d||"schlib"==d||"wire"==d){n.unitSnap=!0;break}}bi.solveItems(r);if(!zi.bind){zi.bind=!0;t.addEventListener("mousemove",hn,!1);setTimeout(function(){t.addEventListener("mouseup",ln,!1)},1)}}}}function cn(e){var r=zi;r.pasting=!0;r.targets=e.targets;r.startX=e.x;r.startY=e.y;r.offsetX=0;r.offsetY=0;r.hasPin=e.hasPin;l(Jn,"hidetext",!1);var n,i=r.targets[0].id,a=r.targets.length;for(n=1;n<a;n++)i+=","+r.targets[n].id;r.ids=i;r.waitingSave=1;r.snapped=_i.adsorbGrid.enabled;r.unitSnap=!1;for(n=0;n<a;n++){var o=ee(r.targets[n]);if("pin"==o||"schlib"==o||"wire"==o){r.unitSnap=!0;break}}if(!r.bind){r.bind=!0;t.addEventListener("mousemove",hn,!1);t.addEventListener("keydown",fn,!1);setTimeout(function(){t.addEventListener("mouseup",ln,!1)},1)}}function ln(e){var t=zi;if(t.on){Tt(!1);if(t.pasting)dn(e);else if(e.button===ei){if(t.waitingSave&&t.targets){di.updateMore(t.targets);bi.solveItems(t.targets);bi.solveTodoList();xi.save(bi.batHistoryCmd(["move",t.ids,t.offsetX,t.offsetY]));t.targets=null;t.ids="";t.waitingSave=0}r("dragMoveSwitch",[!1]);t.on=!0;Ot("grab")}else if(e.button===ti){t.targets&&(t.offsetX||t.offsetY)&&Xe(t.targets,-t.offsetX,-t.offsetY);t.targets=null;t.ids="";t.waitingSave=0;r("dragMoveSwitch",[!1])}}}function dn(e){var t=zi;if(t.on){if(e&&e.button!==ei){if(e&&e.button===ti)for(var n=t.targets,i=n.length-1;i>=0;i--)p(n[i])}else{di.updateMore(t.targets);bi.solveItems(t.targets);bi.solveTodoList();xi.save(bi.batHistoryCmd(["add",t.ids]))}delete t.pasting;t.targets=null;t.ids="";t.waitingSave=0;r("dragMoveSwitch",[!1])}}function hn(e){var t=zi;t.targets=t.targets.filter(function(e){return!aa.isLocked(e)});var r=xt(e,!1),n=r.x-t.startX,i=r.y-t.startY;ia.altKeyEnabled=e.altKey;if(t.snapped){var a=ia.getSanpSize("X"),o=ia.getSanpSize("Y");n=Math.round(n/a)*a;i=Math.round(i/o)*o}if(t.unitSnap){n=Math.round(n);i=Math.round(i)}var s=n-t.offsetX,c=i-t.offsetY;if(s||c){Xe(t.targets,s,c);t.offsetX+=s;t.offsetY+=c;fi&&Nt(fi);t.waitingSave=1}var l=v(t.targets[0],"c_origin");l&&Tt(+l.split(",")[0],+l.split(",")[1])}function fn(e){if(27==e.keyCode){var t=zi;if(t.on){for(var n=t.targets,i=n.length-1;i>=0;i--)p(n[i]);delete t.pasting;t.targets=null;t.ids="";t.waitingSave=0;r("dragMoveSwitch",[!1])}}}function un(e){this.startX=0;this.startY=0;this.ready=0;this.start=0;this.target=null;this.oldPoints=[];this.pIndex=-1;if(e)for(var r in e)w(e,r)&&(this[r]=e[r]);un.instance=this;t.addEventListener("mousedown",this.mdown,!1)}function pn(e,t){var r=e.points.getItem(t>>1),n=e.points.getItem(t+1>>1),i=r.y-n.y,a=r.x-n.x,o=Math.PI;Ot((a?Math.abs(Math.atan(i/a)/o):.5)<.25?"row-resize":"col-resize")}function gn(){new un({ondragstart:function(e){var t,r,n,i,a,o,s,c=e.target,d=e.dx,h=e.dy,f=c.points,u=f.numberOfItems,p=un.instance;if(c!==fi)if(fi)rr();else{fi=c;l(fi,"active",!0);Nt(c);Ct("triggerEvent",["select_change"])}"wire"==ee(c)&&bi.solveItem(c,"old");Be(c);if(u!=c.points.numberOfItems){f=c.points;u=f.numberOfItems;s=9;r=le({x:e.x0,y:e.y0},c,s)}else r=p.pIndex;r<=0?r=1:r%2==0&&r--;p.pIndex=r;n=Fe(c);t=r>>1;i=n[t];a=n[t+1];i={x:i.x+d,y:i.y+h};a={x:a.x+d,y:a.y+h};if(u>2&&t===u-2){o=n[u-1];n.push({x:o.x,y:o.y});f.appendItem(Re(o));u++}if(u>2&&0===t){o=n[0];n.unshift({x:o.x,y:o.y});f.insertItemBefore(Re(o),0);u++;r+=2;p.pIndex=r}p.oldPoints=n},ondrag:function(e){var t,r,n,i,a,s,c,l,d,h,f,u,p,g,y,v=e.target,x=e.dx,m=e.dy,_=v.points,b=_.numberOfItems,S=un.instance;r=S.pIndex;n=Fe(v).length>2?S.oldPoints:Fe(v);if(n&&o(v.id)){t=r>>1;i=n[t];a=n[t+1];s={x:i.x+x,y:i.y+m};c={x:a.x+x,y:a.y+m};var C,P;if(n.length>2){l=n[t-1];i=n[t];a=n[t+1];d=n[t+2];if(S.snap){h={x:e.x1,y:e.y1};f=ae(s,c,h);u=je(f);s.x+=u.x-f.x;s.y+=u.y-f.y;c.x+=u.x-f.x;c.y+=u.y-f.y}if(pe(l.x,l.y,i.x,i.y)<1){p=ce(s,c,{x:l.x+1,y:l.y},i);p||(p=ce(s,c,{x:l.x,y:l.y+1},i))}else p=ce(s,c,l,i);if(pe(a.x,a.y,d.x,d.y)<1){g=ce(s,c,a,{x:d.x+1,y:d.y});g||(g=ce(s,c,a,{x:d.x,y:d.y+1}))}else g=ce(s,c,a,d);y=de(l,p,a,g);if(y){p=y;g=y}}else{p=s;g=c;if(S.snap){C=je(p);P=je(g);pe(C.x,C.y,p.x,p.y)<=pe(P.x,P.y,g.x,g.y)?P={x:g.x+C.x-p.x,y:g.y+C.y-p.y}:C={x:p.x+P.x-g.x,y:p.y+P.y-g.y};p=C;g=P}}if(t+1<b){i=_.getItem(t);a=_.getItem(t+1);i.x=p.x;i.y=p.y;a.x=g.x;a.y=g.y}if(ya==ii.PCB){var w=ee(v);if("TRACK"==w);else if("COPPERAREA"==w){di.updateOne(v);Ct("buildCopper",[v.id])}}"object"==typeof DRCMgr&&DRCMgr&&DRCMgr.doRealtimeDRC&&fi&&DRCMgr.doRealtimeDRC(fi,!0);v==fi&&Nt(v)}},ondragend:function(e){var t=un.instance,r=e.target;if(t.polylinePoints&&t.polylinePoints!==v(r,"points")){Be(r);r==fi&&Nt(r);di.updateOne(r);if(ya==ii.PCB){var n=ee(r),i=v(r,"layerid");"TRACK"!=n&&"ARC"!=n||!isPlaneLayer(i)||copperAreaMgr.rebuildPlane(i);"TRACK"==n?ratLineMgr.buildOneNet(v(r,"net"),!0):"COPPERAREA"==n&&Ct("buildCopper",[r.id])}else if(ya==ii.SCH||ya==ii.SCHLIB){bi.solveItem(r);bi.solveTodoList()}var a=["attr",r.id,{points:t.polylinePoints},{points:v(r,"points")}];ya==ii.SCH||ya==ii.SCHLIB?xi.save(bi.batHistoryCmd(a)):xi.save(a)}}})}function yn(e,r){var n=t.createElementNS("http://www.w3.org/2000/svg",e);r&&v(n,r);return n}function vn(e){if(e){e='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e.trim()+"</svg>";var r=k(e);if(r){var n=t.importNode(r.documentElement,!0);return n.removeChild(n.childNodes[0])}}}function xn(n,i){var a,l,d,h;if("string"==typeof n){a=k(n);if(!a)return;l=t.importNode(a.documentElement,!0)}else 1===n.nodeType?l=t.importNode(n,!0):n.constructor==Object&&(l=makeSVG(n.tagName||n.tag,n.attr||n.attrs));if(l){var f=v(l,"canvas")||"";if(ya==ii.WAVEFORM){var u=v(l,"waveForm")||"{}";Hi=N(u)||{}}var p={offsetX:_i.canvas.originX,offsetY:_i.canvas.originY};kn(f);p.offsetX=_i.canvas.originX-p.offsetX;p.offsetY=_i.canvas.originY-p.offsetY;var g=l.querySelector("g"),y={};g&&(y=Je(g));b(l);var x=l.getElementsByTagName("title");x=x[0]&&x[0].firstChild&&3===x[0].firstChild.nodeType?x[0].firstChild.nodeValue:" ";var _=hi.getElementsByTagName("title")[0];if(_){for(;_.firstChild;)_.removeChild(_.firstChild);_.appendChild(P(x))}if(ji.fileType.isLib(ya)){var S=s('g[c_partid="part_pin"][display="none"]',l);for(d=0;d<S.length;d++){m(S[d],"display");v(S[d],{c_show:"none",display:""})}}var C=c("*[c_shapetype]",l);C&&(l=C.parentNode);var A=o("g1").cloneNode(!0);ua.clear("NotSaveHistory");i&&i.isOpen&&xi.clear();var O=e.frameElement,L=O&&O.parentNode,I=L&&"none"!=L.style.display;L&&!I&&(L.style.display="");if(l)for(;l.firstChild;){d=l.firstChild;if(1!=d.nodeType||"polyline"==d.tagName&&d.points.numberOfItems<2||"polygon"==d.tagName&&d.points.numberOfItems<3)l.removeChild(d);else{Jn.appendChild(d);ji.svg.fixOrigin(d)}}i&&i.isOpen||xi.save([["node",Jn.id,A,Jn.cloneNode(!0)],["originXY","set.origin",p]]);!function(){var e,t,r,n,i,a=s("#g1 > [c_origin]"),o=0,c=0;for(e=a.length-1;e>=0;e--){t=a[e];xy=v(t,"c_origin").split(",");xy[0]=+xy[0];xy[1]=+xy[1];(r===i||r>xy[0])&&(r=xy[0]);(n===i||n>xy[1])&&(n=xy[1])}(r>65536||r<-65536)&&(o=100-r|0);(n>65536||n<-65536)&&(c=100-n|0);(o||c)&&Xe(Jn.children,o,c)}();!function(){var e=ji.svg.getBBox(Jn);if(e.width>1e5||e.height>1e5){var t,r,n,i=Jn.children;for(t=i.length-1;t>=0;t--){n=i[t];e=ji.svg.getBBox(n);if(e.width||e.height||!n.id.match(/^gge|^rep/)){if("schlib"==ee(n)){var a=s('text[c_note="note_name"], text[c_note="note_pre"]',n);for(r=a.length-1;r>=0;r--)a[r].style.display="none";e=ji.svg.getBBox(n);for(r=a.length-1;r>=0;r--){var o=+v(a[r],"x"),c=+v(a[r],"y"),l=0,d=0;o-e.x<-1e3?l=e.x-50-o:o-e.x-e.width>1e3&&(l=e.x+e.width+50-o);c-e.y<-1e3?d=e.y-50-c:c-e.y-e.height>1e3&&(d=e.y+e.height+50-c);(l||d)&&ea.move(a[r],l,d)}for(r=a.length-1;r>=0;r--)a[r].style.display=""}}else Jn.removeChild(n)}}}();$i=T()+1;if(y.c_transformList){var E=y.c_transformList.split(" ");for(d=0;d<E.length-1;d+=2){var M=o(E[d]),V=E[d+1],B=0,G="M"==V.charAt(0);if(M){if(G){ra.flipH([M]);B=+V.substr(1)}else{B=+V;B=360-B}B&&wn(M,B);isNaN(B)}}if(E.length>0){var F=r("getBBox"),R=F.x<0?Math.abs(F.x)+100:0,D=F.y<0?Math.abs(F.y)+100:0;(R||D)&&Xe(Jn.childNodes,R,D);Qe(F.x+F.width/2,F.y+F.height/2)}}for(d in y)w(y,d)&&v(Jn,d,y[d]||"");var H=Ct("getJsonCache");H&&H.colors&&(_i.colors=ji.extend({},H.colors));Pn();di.calAll();if(Ft(ya)||ya==ii.SCHMODULE){Nn();if(!Fi||!e.frameElement||"none"!=e.frameElement.parentNode.style.display){var j=s("#g1>g");for(d=0,h=j.length;d<h;d++)at(j[d])}}ya==ii.WAVEFORM?Ci.resizeToFitWindow():Ke(Jn);if(i&&w(i,"notForcePickDataOfImportDoc"))var U=i.notForcePickDataOfImportDoc;Ct("triggerEvent",["import_doc_done",U]);Ct("triggerEvent",["select_change"]);L&&!I&&(L.style.display="none");(Ft(ya)||ya==ii.SCHMODULE)&&li.checkPreDuplicate({whole:!1});aa.createLockUi(s('[locked="1"]',Jn));var z=[],X={};if(di.gJsonCache){var Y=di.gJsonCache.schlib;for(var W in Y)if(Y[W].head.uuid){if(X[Y[W].head.uuid]){X[Y[W].head.uuid].push({c_para:Y[W].head.c_para,gid:W});continue}X[Y[W].head.uuid]=[{c_para:Y[W].head.c_para,gid:W}];z.push(Y[W].head.uuid)}}Ct("getSchLibDataFromServer",[z,X]);Y=di.gJsonCache.schlib;for(W in Y){l=o(W);"No"==ji.c_paraToJson(v(l,"c_para")).BOM_Mounted?Yt("mounted",l,!1):Yt("mounted",l)}setTimeout(function(){_n()},60)}else parent.$.messager.alert("import fail")}function mn(e,t){var r=ji.c_paraToJson(v(e,"c_para")),n=e.id;if(w(r,"Package Display")&&"No"!==r["Package Display"]||t){if(c("#"+n+"_P",e)){if(!t)return;p(c("#"+n+"_P",e))}var i=Ct("getTabbarDivs")||[],a=0,o=[];for(a=0;a<i.length;a++){o.push(i[a].style.display);i[a].style.display="block"}var s=ji.svg.getPlainBBox(e);for(a=0;a<i.length;a++)i[a].style.display=o[a];var l=yn("g",{c_partid:"part_annotation",id:n+"_P"}),d=yn("text",{c_note:"note_package",x:s.x,y:s.y+s.height+10,fill:"#000080","font-family":"Arial","font-size":"7pt","font-weight":"","font-style":"","dominant-baseline":"","text-anchor":"start"});d.innerHTML=r.package;l.appendChild(d);e.appendChild(l)}}function _n(){var e=di.gJsonCache.schlib;if(e){var t;for(var r in e)if(w(e,r)){t=o(r);mn(t)}}}function bn(e,r){pa.started&&qt();var n,i,a,l,d=null;if(e){if("string"==typeof e){e.match(/^<\w/)&&!e.match(/^<svg/)&&(e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e+"</svg>");n=k(e);if(!n)return;d=t.importNode(n.documentElement,!0)}else 1===e.nodeType?d=t.importNode(e,!0):e.constructor==Object&&(d=makeSVG(e.tagName||e.tag,e.attr||e.attrs));if(d){b(d);m(d,"c_maxggei");if("svg"==d.tagName)for(i=0,a=d.childNodes.length;i<a;i++)if("g"===d.childNodes[i].tagName){d=d.childNodes[i];break}if("g"!=d.tagName){var h=yn("g");if("svg"==d.tagName)for(;d.firstChild;)h.appendChild(d.firstChild);else h.appendChild(d);d=h}if(d.children.length){v(d,"bindPCBId")||v(d,"bindPCBId",r&&r.bindPCBId||te());var f=!!c("[id^=frame_]",d);for(i=0,l=s("[id]",d),a=l.length;i<a;i++)0===l[i].id.indexOf("frame_")?v(l[i],"id",l[i].id.replace(/^(.*?)(?:[_\?\d]*)$/,"$1_?")):v(l[i],"id","");for(i=0,l=s("[c_shapetype]",d),a=l.length;i<a;i++)v(l[i],"c_shapetype","");v(d,"c_origin")||v(d,"c_origin","0,0");v(d,"display","");var u,y,x,_,S="",C=ji.c_paraToJson(v(d,"c_para")||"");C["BOM_Manufacturer Part"]||(C["BOM_Manufacturer Part"]="?");C.package||(C.package="NONE");d.id="g"+Date.now();x=c("#"+d.id+' > g[c_partid="part_annotation"] > text[c_note="note_name"]',d);x&&(x=x.parentNode);_=c("#"+d.id+' > g[c_partid="part_annotation"] > text[c_note="note_pre"]',d);if(_){_.textContent.indexOf("?")<0&&(_.textContent=_.textContent.replace(/\d+(\D*)$/,"?$1"));_=_.parentNode}d.id="";if(!_){C.pre=F(C.pre||"")?C.pre:"U?";y='<g xmlns="http://www.w3.org/2000/svg" c_partid="part_annotation" c_shapetype="group"><text c_note="note_pre" x="0" y="0" font-family="Arial" font-size="7pt" fill="#000080" text-anchor="start">'+X(C.pre)+"</text></g>";n=k(y);if(n){_=t.importNode(n.documentElement,!0);d.insertBefore(_,d.firstChild)}C.spicePre||(C.spicePre=C.pre.substr(0,1));delete C.pre}if(!x){if(C.nameAlias&&C.nameAlias.length>0){$nameStr=C[C.nameAlias]||C.name||"";delete C[C.nameAlias];u='<g xmlns="http://www.w3.org/2000/svg" c_partid="part_annotation" '+("0"==C.nameDisplay?'display="none" ':"")+'c_shapetype="group"><text c_note="note_name" x="0" y="0" font-family="Arial" font-size="7pt" fill="#000080" text-anchor="start">'+X($nameStr)+"</text></g>";C.spiceSymbolName=C.name}else u='<g xmlns="http://www.w3.org/2000/svg" c_partid="part_annotation" '+("0"==C.nameDisplay?'display="none" ':"")+'c_shapetype="group"><text c_note="note_name" x="0" y="0" font-family="Arial" font-size="7pt" fill="#000080" text-anchor="start">'+X(C.name)+"</text></g>";n=k(u);if(n){x=t.importNode(n.documentElement,!0);d.insertBefore(x,d.firstChild)}delete C.name;delete C.nameDisplay}S=ji.jsonToC_para(C);var P=function(){return"part_import_"+(1e6+(1e6*Math.random()|0)+"").substr(1)}();v(d,{c_para:S,c_partid:P});if(r)Jn.appendChild(d);else{var N="part_import",A=o(N);A&&p(A);v(d,{id:N});o("gCurParts").appendChild(d)}Kr(_.childNodes[0],x.childNodes[0]);Fn(_i.colors,d);var O=c('g[c_partid="part_pin"][c_origin]',d);O||(O=c("g[c_origin]",d));if(O){var T,L,I,E,M,V,B=ji.numberlistToArray(v(d,"c_origin")),G=v(O,"c_origin");if(G){G=ji.numberlistToArray(G);T=+_i.adsorbGrid.distanceX;I=(B[0]-G[0])%T;if(I){I<0&&(I+=T);M=I<T/2?-ji.toFixed(I,2):+ji.toFixed(T-I,2);B[0]+=M}L=+_i.adsorbGrid.distanceY;E=(B[1]-G[1])%L;if(E){E<0&&(E+=L);V=E<L/2?-ji.toFixed(E,2):+ji.toFixed(L-E,2);B[1]+=V}(I||E)&&v(d,{c_origin:B[0]+","+B[1]})}}(Ft(ya)||ya==ii.SCHMODULE)&&at(d);ji.svg.fixOrigin(d);var R,D,H,j,U,z,Y,W,J,$,K,q;if(r){r.rotation&&mr([d],360-r.rotation,!0);if(w(r,"x")&&w(r,"y")){R=r.oldLib;D=c('[c_partid="part_pin"]',d);H=c('[c_partid="part_pin"]',R);if(D&&H){j=v(D,"c_origin").split(",");U=v(H,"c_origin").split(",");z=[U[0]-j[0],U[1]-j[1]]}else{R=g(R);Jn.append(R);Y=Vt("pre",d);W=Vt("pre",R);Y&&(Y.style.display="none");W&&(W.style.display="none");J=d.getBBox();$=R.getBBox();p(R);Y&&(Y.style.display="");W&&(W.style.display="");z=[$.x-J.x,$.y-J.y]}if(z){K=z[0];q=z[1]}K=ji.formatLengthSave(K);q=ji.formatLengthSave(q);ea.move(d,K,q)}!function(){f?v(d,{id:"frame_lib_?"}):v(d,{id:ji.newId()});v(d,{c_shapetype:"group",c_etype:"pinpart"});m(d,"pointer-events");Jn.appendChild(d);if(r.pre||r.name){r.pre&&Bt(d,{pre:r.pre},"schlib");r.name&&Bt(d,{name:r.name},"schlib")}else{var e=c('g text[c_note="note_pre"]',d),t=e.textContent;t.indexOf("?")>0?Bt(d,{pre:li.getNewPre(t)},"schlib"):t.search(/\d+/)>=0&&Bt(d,{pre:li.getNewPre(t.replace(/\d+(\D*)$/,"?$1"))},"schlib")}r.locked&&v(d,{locked:"1"});r.c_issystemlib&&v(d,{c_issystemlib:r.c_issystemlib});r.c_verify&&v(d,{c_verify:r.c_verify});r.c_lcsc&&v(d,{c_lcsc:r.c_lcsc});r.c_szlcsc&&v(d,{c_szlcsc:r.c_szlcsc});"No"==C.BOM_Mounted?Yt("mounted",d,!1):Yt("mounted",d);it(d);di.updateOne(d);bi.solveItem(d);bi.solveTodoList();xi.save(bi.batHistoryCmd(["add",d.id]))}()}else{v(d,"display","none");Jt("place."+N)}}}else parent.$.messager.alert("import fail")}}function Sn(e,r){pa.started&&qt();var n,i,a,l,d,h=null;if("string"==typeof e){e.match(/^<\w/)&&!e.match(/^<svg/)&&(e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e+"</svg>");n=k(e);if(!n)return;h=t.importNode(n.documentElement,!0)}else 1===e.nodeType?h=t.importNode(e,!0):e.constructor==Object&&(h=makeSVG(e.tagName||e.tag,e.attr||e.attrs));if(h){b(h);m(h,"c_maxggei");if("svg"==h.tagName)for(i=0,a=h.childNodes.length;i<a;i++)if("g"===h.childNodes[i].tagName){h=h.childNodes[i];break}if("g"!=h.tagName){var f=yn("g");if("svg"==h.tagName)for(;h.firstChild;)f.appendChild(h.firstChild);else f.appendChild(h);h=f}for(i=0,l=s("[id]",h),a=l.length;i<a;i++)0===l[i].id.indexOf("frame_")?v(l[i],"id",l[i].id.replace(/^(.*?)(?:[_\?\d]*)$/,"$1_?")):v(l[i],"id","");v(h,"display","");if(r)Jn.appendChild(h);else{var u="part_import",g=o(u);g&&p(g);v(h,{id:u});o("gCurParts").appendChild(h)}var y=ji.svg.getBBox(h),x=y.x+y.width/2|0,_=y.y+y.height/2|0;v(h,"c_origin",x+","+_);v(h,"c_module","1");var S=c('g[c_partid="part_pin"][c_origin]',h);S||(S=c("g[c_origin]",h));if(S){var C,P,N,A,O,T,L=ji.numberlistToArray(v(h,"c_origin")),I=v(S,"c_origin");if(I){I=ji.numberlistToArray(I);C=+_i.adsorbGrid.distanceX;N=(L[0]-I[0])%C;if(N){N<0&&(N+=C);O=N<C/2?-ji.toFixed(N,2):+ji.toFixed(C-N,2);L[0]+=O}P=+_i.adsorbGrid.distanceY;A=(L[1]-I[1])%P;if(A){A<0&&(A+=P);T=A<P/2?-ji.toFixed(A,2):+ji.toFixed(P-A,2);L[1]+=T}(N||A)&&v(h,{c_origin:L[0]+","+L[1]})}}if(Ft(ya)||ya==ii.SCHMODULE)for(i=0,d=h.children||h.childNodes,a=d.length;i<a;i++)"g"==d[i].tagName&&at(d[i]);if(r){w(r,"x")&&w(r,"y")&&Et(h,r.x,r.y);r.rotation&&mr([h],r.rotation,!0);!function(){it(h);for(var e=[].slice.call(h.children||h.childNodes,0).filter(function(e){return 1===e.nodeType}),t=e.map(function(e){return e.id}).join(","),r=0;r<e.length;r++){Jn.appendChild(e[r]);"part_netLabel_volProbe"==v(e[r],"c_partid")&&(e[r].childNodes[1].firstChild.nodeValue=$r());if("g"==e[r].tagName){for(var n,i=s('text[c_note="note_pre"]',e[r]),a=[],o=0;o<i.length;o++){n=i[o].textContent;if(n.indexOf("?")>0)a[o]=n;else if(/\.\d+$/.test(n)){/\d+(\D*\.\d+)$/.test(n)&&(n=n.replace(/\d+(\D*\.\d+)$/,"?$1"));a[o]=n}else n.search(/\d+/)>=0&&(a[o]=n.replace(/\d+(\D*)$/,"?$1"))}var c=li.getNewPre(a);for(o=0;o<i.length;o++)i[o].textContent=c[o]}di.updateOne(e[r])}p(h);bi.solveItems(e);bi.solveTodoList();xi.save(bi.batHistoryCmd(["add",t]))}()}else{v(h,"display","none");Jt("place."+u);var E,M=s('g text[c_note="note_pre"]',h);for(i=0;i<M.length;i++){E=M[i].textContent;E.indexOf("?")<0&&E.search(/\d+/)>=0&&(/\.\d+$/.test(E)?/\d+(\D*\.\d+)$/.test(E)&&(M[i].textContent=E.replace(/\d+(\D*\.\d+)$/,"?$1")):M[i].textContent=E.replace(/\d+(\D*)$/,"?$1"))}}}else parent.$.messager.alert("import fail")}function Cn(e,r){var n,i,a,l,d,h;if(B(e)){xi.startBatch();for(h=0;h<e.length;h++)Cn(e[h],r);xi.saveBatch()}else if(e){h=e.indexOf(" xmlns=");(h<0||h>e.indexOf(">"))&&(e=e.replace(/\/?>/,' xmlns="http://www.w3.org/2000/svg"$&'));h=e.indexOf(" xlink:href");if(h>0){h=e.indexOf(" xmlns:xlink=");h<0&&(e=e.replace(/\/?>/,' xmlns:xlink="http://www.w3.org/1999/xlink"$&'))}n=k(e);if(n&&n.documentElement.namespaceURI==Zn.svg){i=t.importNode(n.documentElement,!0);if(i){d=i.tagName;if(d&&!(d.indexOf(":")>0)&&"script"!==d&&"metadata"!==d){b(i);v(i,"c_shapetype","line");it(i);if(r.appendTo&&r.appendTo.indexOf(",")<0){a=c("#"+r.appendTo,Jn);(a||Jn).appendChild(i)}else if(r.insertBefore&&r.appendTo.indexOf(",")<0){l=c("#"+r.insertBefore,Jn);l?l.parentNode.insertBefore(i,l):Jn.appendChild(i)}else Jn.appendChild(i);di.updateOne(i);var f=ee(i);if(0===f.indexOf("part_")){var u,p=s("g text[c_note]",i);for(h=0;h<p.length;h++){u=p[h].textContent;if(u.indexOf("?")>0){p[h].textContent=li.getNewPre(u);di.updateOne(i)}}if("part_pin"==f){var g=o("part_pin"),y=+g.childNodes[2].textContent,x=+i.childNodes[2].textContent;if(isNaN(x)||x<y){i.childNodes[2].textContent=y;i.childNodes[3].textContent=y;g.childNodes[2].textContent=y+1;g.childNodes[3].textContent=y+1}else{g.childNodes[2].textContent=x+1;g.childNodes[3].textContent=x+1}v(g,{c_spicepin:y})}else{if("part_netLabel_volProbe"==v(i,"c_partid")){i.childNodes[1].firstChild.nodeValue=$r();di.updateOne(i)}bi.solveItem(i);bi.solveTodoList()}}if("wire"==f){bi.solveItem(i);bi.solveTodoList()}xi.save(["add",i.id])}}else parent.$.messager.alert("import fail")}}}function Pn(){var e=!0,t=Ct("getJsonCache");if(t){var r=N(JSON.stringify(t));r.head.editorVersion=$n;di.gJsonCache=r}else e=!1;return e}function wn(e,t){var r=v(e,"c_origin"),n=v(e,"c_rotation")||"0";if(r){r=ji.numberlistToArray(r);var i,a,o,s=t-n,c=r[0],l=r[1];void 0===s&&(s=270);if(s%360==0)return;r=v(e,"c_origin");if(void 0===c||void 0===l)if(r){i=r.split(",");c=+i[0];l=+i[1]}else{a=e.getBBox();c=a.x+a.width/2;l=a.y+a.height/2}else if(r){i=r.split(",");o=[+i[0],+i[1]];o=ye(o,s,c,l);v(e,"c_origin",o.join(","))}if(r){n=+(v(e,"c_rotation")||0);n=be(n-s);v(e,"c_rotation",n)}for(var d=e.children||e.childNodes,h=d.length,f=0;f<h;f++)"part_annotation"==v(d[f],"c_partid")&&d[f].firstChild&&v(d[f].firstChild,"c_note")||d[f].tagName&&ta.hasOwnProperty(d[f].tagName)&&ta[d[f].tagName](d[f],s,c,l)}}function Nn(){var e=[];for(var t in di.gJsonCache.junction)w(di.gJsonCache.junction,t)&&(function(e){var t;for(t in di.dots)if(w(di.dots,t)&&oa.isPointEqual(e,di.dots[t]))return!0;for(t in di.wires)if(w(di.wires,t)&&(oa.isPointEqual(e,di.wires[t][0])||oa.isPointEqual(e,di.wires[t][di.wires[t].length-1])))return!0;return!1}(di.gJsonCache.junction[t].pinDot)||e.push(o(t)));if(e.length){dr(e);xi.clear()}}function An(){return{viewWidth:1e3,viewHeight:1e3,backGround:v(o("gridBg"),"fill"),gridVisible:v(o("grid1"),"display")||"yes",gridColor:v(o("gridCell"),"fill"),gridSize:_i.adsorbGrid.gridSize,canvasWidth:1e3,canvasHeight:1e3,gridStyle:"url(#gridPattern)"==v(o("grid1"),"fill")?"dot":"line",snapSize:_i.adsorbGrid.distanceX,unit:_i.canvas.unit,altSnapSize:_i.adsorbGrid.altSnapSize,originX:_i.canvas.originX,originY:_i.canvas.originY}}function kn(e){if(e.length>10){var t=e.split(oi);ua.modify_canvas({"attr-canvas-width":t[7]||1e3,"attr-canvas-height":t[8]||1e3,"attr-canvas-bgcolor":t[3]||"#FFFFFF","attr-canvas-grid-visible":t[4],"attr-canvas-grid-color":t[5],"attr-canvas-grid-size":t[6]||10,"attr-canvas-grid-style":t[9],"attr-canvas-snap-size":t[10],"attr-canvas-alt-snap-size":t[12]||t[10]/2});if(e.length>14&&t[13]&&t[14]){var n=+t[13],i=+t[14];isFinite(n)&&isFinite(i)&&r("setOriginXY",[{x:n,y:i}])}}}function On(e,t){Tn(e,t)&&setTimeout(function(){Ct("alert_polyline_maybe_wire")},10)}function Tn(e,t){for(var r in di.dots)if(w(di.dots,r)){var n=di.dots[r];if(n.x==e&&n.y==t)return!0}return!1}function Ln(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(["node",e[r].id,e[r].cloneNode(!0)]);this.hist=t;this.nodes=[].slice.call(e)}function In(){function e(e){var t={"Ctrl+Shift+R":!0,"Ctrl+Shift+O":!0,"Ctrl+Shift+B":!0,"Ctrl+Shift+G":!0,"Ctrl+L":!0,"Ctrl+Tab":function(){return!0},"Ctrl+Shift+H":!0,"Shift+Alt+H":!0,"Ctrl+Shift+E":!0,"Ctrl+Shift+C":!0};return!(!e||e.split("+").length<2)&&("function"==typeof t[e]?t[e]():t[e])}function n(e){var t=e.metaKey,r=e.ctrlKey,n=e.shiftKey,i=e.altKey,a=e.keyCode,o="",s=c[a];t&&(o+="Cmd+");r&&(o+="Ctrl+");n&&(o+="Shift+");i&&(o+="Alt+");a>=48&&a<=57||a>=65&&a<=90?o+=String.fromCharCode(a):"Cmd"!=s&&"Ctrl"!=s&&"Shift"!=s&&"Alt"!=s&&w(c,a)&&(o+=c[a]);o&&/[^+]\+$/.test(o)&&(o=o.substring(0,o.length-1));return o}function i(t){ia.altKeyEnabled=t.altKey;if(t.target.tagName){var i=t.target.tagName.toUpperCase();if("TEXTAREA"==i||"INPUT"==i&&"text"==t.target.type)return}if("keydown"===t.type){var a,c=n(t),l=ya==ii.PCB||ya==ii.PCBLIB||ya==ii.PCBMODULE?"PCB":"SCH",d=Ct("getHotkeyConfig");if(d&&d[l]){d[l].hasOwnProperty(c)?a=d[l][c]:w(d.ALL,c)&&(a=d.ALL[c]);a||"R"!=c||(a="rotate");var h=["draw.wire","draw.bus","cmd.groupSymbol"],f=["left","right","up","down","zoom_in","zoom_out","fitview"],u=["file_save"],p=["draw.connect","draw.copperArea","draw.rect","cmd.groupSymbol"],g=ji.fileType.getAbstractFileType(ya);if(a){Ct("addUserBehaviorRecord",["hotkey-down",{cmd:a,fileType:g,target:Ar().map(function(e){return e.id}).join(",")}]);if("schlib"==g&&(-1!==h.indexOf(a)||/^place.part_(?!pin$)(?!annotation$)/.test(a))){t.preventDefault();t.stopPropagation();return}if("photoview"==g&&-1===f.indexOf(a)){t.preventDefault();t.stopPropagation();return}if("waveform"==g&&-1===u.indexOf(a)){t.preventDefault();t.stopPropagation();return}if("pcblib"==g&&-1!==p.indexOf(a)){t.preventDefault();t.stopPropagation();return}if(w(s,a)){if(!1===s[a](t)&&("Up"==c||"Down"==c||"Left"==c||"Right"==c)){var y={Up:[0,-1],Down:[0,1],Left:[-1,0],Right:[1,0]},v=ua.getViewBox(),x=10/Wi;v[0]+=x*y[c][0];v[1]+=x*y[c][1];ua.setViewBox(v);t.preventDefault();t.stopPropagation();return}}else r(a)}if(e(c)||o.test(c)||Ii&&"Delete"==c){t.preventDefault();t.stopPropagation()}t.altKey&&t.preventDefault()}}}function a(t){if("keyup"===t.type){if(t.target.tagName){var i=t.target.tagName.toUpperCase();if("TEXTAREA"==i||"INPUT"==i&&"text"==t.target.type)return}var a=n(t);(o.test(a)||Ii&&"Delete"==a||e(a))&&t.preventDefault();if("Esc"===a){if(zi.on){r("dragMoveSwitch",[!1]);r("undo")}Ct("triggerEvent",["keyup",t])}"Backspace"===a&&r("undoDraw")}}var o=/^(Backspace|Space|F1|Home|End|(?:Ctrl|Cmd|Shift)\+[\-+AOSFRDG])$/,s={left:function(){return sr(-1,0)},right:function(){return sr(1,0)},up:function(){return sr(0,-1)},down:function(){return sr(0,1)},zoom_in:function(){return Ct("zoom_in",[Ht.data])},zoom_out:function(){return Ct("zoom_out",[Ht.data])},draw_end:function(e){if("draw.track"!==yi||27!==e.keyCode||!Ct("trackWidthPanelStatus")){if(0===yi.indexOf("place.part_")){pa.end(c.ESC);return!0}if(yi){pa.restart(!0);return!0}return!1}},file_save:function(){return Ct("file_save")},editSymbol:function(){return Ct("symbolTool")},snap_grid:function(){return Ct("snap_grid",[!_i.adsorbGrid.enabled])},change_route_angle:function(){var e=_i.canvas.angle+"",t=["45","90","0","ARC"];return Ct("updateAttrByHotkey",[{cmd:"pcbcanvas-angle",value:t[(t.indexOf(e)+1)%t.length]}])},decrease_routing_width:function(){var e=+_i.canvas.routing;if(e>=.4){return Ct("updateAttrByHotkey",[{cmd:"pcbcanvas-routing-size",value:ji.toFixed(ji.units.convert(e-.2,"pixel",_i.canvas.unit),ji.units.decimals[_i.canvas.unit])}])}},increase_routing_width:function(){var e=+_i.canvas.routing;return Ct("updateAttrByHotkey",[{cmd:"pcbcanvas-routing-size",value:ji.toFixed(ji.units.convert(e+.2,"pixel",_i.canvas.unit),ji.units.decimals[_i.canvas.unit])}])},decrease_snap_size:function(){var e=+_i.adsorbGrid.distanceX;if(e>=.6){return Ct("updateAttrByHotkey",[{cmd:"pcbcanvas-snap-size",value:ji.toFixed(ji.units.convert(e-.1,"pixel",_i.canvas.unit),ji.units.decimals[_i.canvas.unit])}])}},increase_snap_size:function(){var e=+_i.adsorbGrid.distanceX;return Ct("updateAttrByHotkey",[{cmd:"pcbcanvas-snap-size",value:ji.toFixed(ji.units.convert(e+.1,"pixel",_i.canvas.unit),ji.units.decimals[_i.canvas.unit])}])},remove_all_copper_area:function(){removeAllCopperPolygons();Ct("setTabUnsaved")},rebuild_all_copper_area:function(){Ct("buildCopper",["all"]);var e=di.getAllObjsOf("COPPERAREA");RTreeMgr.insertNodes(e,"COPPERAREA");var t=di.getAllObjsOf("PLANEZONE");RTreeMgr.insertNodes(t,"PLANEZONE");Ct("setTabUnsaved")},findComponent:function(){return Ct("findComponent")},findLibs:function(){Ct("findLibs")},crossProbe:function(){return Ct("crossProbe")},crossProbeAndPlace:function(){return Ct("crossProbeAndPlace")},designManager:function(){return Ct("designManager")},runDocSimulation:function(){return Ct("runDocSimulation")},exploreFindComponents:function(){return Ct("exploreFindComponents")},show_drawing_attr_dlg:function(e){if(pa.started){var t=ee(pa.target);""===t&&pa.controlLine&&(t=ee(pa.controlLine));r("show_drawing_attr_dlg",[t,pa.target]);e.preventDefault();e.stopPropagation()}else if(zi.on)Ar()&&Ct("showOffsetElementsByPastDlg");else{var n=Ar();if(n.length>0){Ct("showOffsetElementsDlg");e.preventDefault();e.stopPropagation()}}},"Open the FAQ page":function(){return Ct("OpenFAQPage")}},c=function(){var e,t={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Esc:27,Space:32,PageUp:33,PageDn:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,"`":192,"-":Fi?173:189,"+":Fi?61:187,"[":219,"]":221,"\\":220,";":Fi?59:186,"'":222,",":188,".":190,"/":191,"*":106};for(e=1;e<=12;e++)t["F"+e]=111+e;var r=Object.keys(t);for(e=0;e<r.length;e++){var n=t[r[e]];w(t,n)||(t[n]=r[e])}if(Ii){if(Fi)t[224]="Cmd";else{t[91]="Cmd";t[93]="Cmd"}delete t.Backspace;t[8]="Delete";t.Delete=8}var i={107:"+107",109:"-109"};return Object.assign({},t,i)}();r.registerHook({transferKeydown:i,transferKeypress:i});t.addEventListener("keydown",i,!1);t.addEventListener("keyup",a,!1);!function(){if(Gi){var e=function(e){if((e.keyCode==c["+"]||e.keyCode==c["-"])&&(Ii?e.metaKey:e.ctrlKey)){e.preventDefault();e.stopPropagation();return!1}};t.addEventListener("keydown",e,!1)}}()}function En(e,t,r,n){var i,a,l,d,f,u,p,g,y,x,_,b,S,C,P,N,A,k,O,T,L,I,E;if(G(e)){if(1!==e.length){xi.startBatch();for(d=0;d<e.length;d++)En("string"==typeof e[d]?o(e[d]):e[d],t,r,n,!0);xi.saveBatch();return}e=e[0]}var M=e&&e.tagName;if(e&&"object"==typeof t&&("object"!=typeof e||1==e.nodeType)&&Object.keys(t).length)if("canvas"!=e){if("NotSaveHistory"==r&&"quickchange"==n)if(xi.quickchangeNode!=e){L=e.cloneNode(!0);xi.quickchangeNode=e;xi.quickchangeNodeClone=L}else L=xi.quickchangeNodeClone;else"NotSaveHistory"!=r&&(L=xi.quickchangeNode!=e?e.cloneNode(!0):xi.quickchangeNodeClone);var V,B=v(e,"c_partid")||"",F=v(e,"c_shapetype")||"";v(e,"c_helper_type");l=v(e,"c_origin");l&&(V=ji.numberlistToArray(l));w(t,"attr-locked")&&("yes"===t["attr-locked"]?aa.lockObjs([e]):aa.unlockObjs([e]));var D=Object.keys(t);1===D.length&&"attr-locked"===D[0]&&(r="NotSaveHistory");if("line"==F&&"text"==M){for(f in t)if(w(t,f)){u=t[f];switch(f){case"attr-text-text":Bn(e.parentNode,u);break;case"attr-text-fill-color":v(e,{fill:u});break;default:p={};p[f.substr(10)]=u;v(e,p);if(Ri&&"attr-text-font-size"==f){y=c("tspan:last-child",e);y&&y.parentNode.appendChild(y.parentNode.removeChild(y))}}}}else if("line"==F&&"image"==M){var H=t["attr-image-href"];if(void 0!==H&&!ji.isValidImageURL(H))return;if(void 0!==H&&R(H)!=H)return;for(f in t)if(w(t,f)){u=t[f];switch(f){case"attr-image-href":v(e,{"xlink:href":u});break;case"attr-image-x":v(e,{x:u});break;case"attr-image-y":v(e,{y:u});break;case"attr-image-width":v(e,{width:u});break;case"attr-image-height":v(e,{height:u});break;case"attr-image-rotation":v(e,{c_rotation:u})}}var j=w(t,"attr-image-rotation")?be(360-t["attr-image-rotation"]):xe(e);j?v(e,"transform",Le(Ie(e),j)):v(e,"transform","");Ct("updateAttrPanel");Nt(e)}else if("line"==F&&"text"!=M&&"image"!=M){if("attr-stroke-color"in t){v(e,{stroke:t["attr-stroke-color"]});"wire"==v(e,"c_etype")&&(_i.canvas.schWireStrokeColor=t["attr-stroke-color"])}if("attr-stroke-width"in t){v(e,{"stroke-width":t["attr-stroke-width"]});_i.canvas.strokeWidth=t["attr-stroke-width"]}"attr-stroke-dasharray"in t&&v(e,{"stroke-dasharray":t["attr-stroke-dasharray"]});"attr-fill-color"in t&&v(e,{fill:t["attr-fill-color"]});"attr-rect-rxry"in t&&v(e,{rx:t["attr-rect-rxry"],ry:t["attr-rect-rxry"]});"attr-rect-width"in t&&v(e,{width:t["attr-rect-width"]});"attr-rect-height"in t&&v(e,{height:t["attr-rect-height"]});"hidden"!=v(la,"visibility")&&Nt(e);if("attr-arrow-marker"in t&&("path"==M||"polyline"==M||"line"==M||"polygon"==M)){u=t["attr-arrow-marker"];"start"!=u&&m(e,"marker-start");"end"!=u&&m(e,"marker-end")
;"start"==u?v(e,"marker-start",Ri?"url(#arrowOnStartChrome)":"url(#arrowOnStart)"):"end"==u&&v(e,"marker-end",Ri?"url(#arrowOnEndChrome)":"url(#arrowOnEnd)")}if("ellipse"==M){"attr-ellipse-rx"in t&&v(e,{rx:t["attr-ellipse-rx"]});"attr-ellipse-ry"in t&&v(e,{ry:t["attr-ellipse-ry"]});"attr-center-x"in t&&v(e,{cx:t["attr-center-x"]});"attr-center-y"in t&&v(e,{cy:t["attr-center-y"]});"hidden"!=v(la,"visibility")&&Nt(e)}if("path"==M&&("attr-ellipse-rx"in t||"attr-ellipse-ry"in t||"attr-center-x"in t||"attr-center-y"in t)){x=e.pathSegList;var U,z,X=x.numberOfItems;if(2==X||4==X){for(d=1;d<X;d++)if("A"==x.getItem(d).pathSegTypeAsLetter){b=x.getItem(d);_=x.getItem(d-1);break}if(b&&("attr-ellipse-rx"in t||"attr-ellipse-ry"in t)){A=U=b.r1;k=z=b.r2;U="attr-ellipse-rx"in t?+t["attr-ellipse-rx"]:A;z="attr-ellipse-ry"in t?+t["attr-ellipse-ry"]:k;(isNaN(U)||U<=0)&&(U=A);(isNaN(z)||z<=0)&&(z=k);if(U==A&&z==k)return;var Y=(_.x-b.x)/2,W=(_.y-b.y)/2,J=Y*Y/(U*U)+W*W/(z*z);if(J>1)return;b.r1=U;b.r2=z;if(4==X){N=ji.arc.getCenterParam(_.x,_.y,b.x,b.y,b.largeArcFlag,b.sweepFlag,U,z,b.angle);if(N){_=x.getItem(0);_.x=N.cx;_.y=N.cy}}}if(b&&("attr-center-x"in t||"attr-center-y"in t)){N=ji.arc.getCenterPoint(_.x,_.y,b.x,b.y,b.largeArcFlag,b.sweepFlag,b.r1,b.r2,b.angle);"attr-center-x"in t&&ze(e,t["attr-center-x"]-N.x,0);"attr-center-y"in t&&ze(e,0,t["attr-center-y"]-N.y)}"hidden"!=v(la,"visibility")&&Nt(e)}}}else if("part_annotation"==B){for(f in t)if(w(t,f)){g=e.childNodes[0];u=t[f];switch(f){case"attr-text-text":Bn(e,u);break;case"attr-text-fill-color":v(g,{fill:u});break;case"attr-text-type":v(g,{type:u});if(!w(t,"attr-text-fill-color")){var $="spice"===u?{fill:"#000000","font-style":"italic"}:{fill:"#0000FF","font-style":""};v(g,$)}break;default:if("attr-text-"!=f.substr(0,10))break;p={};p[f.substr(10)]=u;v(g,p);if(Ri&&"attr-text-font-size"==f){y=c("tspan:last-child",e);y&&y.parentNode.appendChild(y.parentNode.removeChild(y))}}}if(g.parentNode.parentNode==Jn){var K=Je(g),q={},Q=["font-family","font-size","fill","font-style","text-anchor","font-weight"];for(d=0;d<Q.length;d++)q[Q[d]]=K[Q[d]];v(o("part_annotation").childNodes[0],q)}}else if("part_pin"==B){var Z=e.childNodes[0],ee=e.childNodes[1],te=e.childNodes[2],re=e.childNodes[3],ne=e.childNodes[4],ie=e.childNodes[5];for(f in t)if(w(t,f)){u=t[f];switch(f){case"attr-pinpart-rotation":mr([e],360-parseInt(u,10),!0);break;case"attr-pinpart-name":Bn(Z,u);break;case"attr-pinpart-font-family":v(Z,{"font-family":u});v(ee,{"font-family":u});break;case"attr-pinpart-font-size":v(Z,{"font-size":u});v(ee,{"font-size":u});break;case"attr-pinpart-number":Bn(ee,u);break;case"attr-pinpart-name-display":v(Z,{display:"none"==u?"none":""});break;case"attr-pinpart-number-display":v(ee,{display:"none"==u?"none":""});break;case"attr-pinpart-color":v(re,{stroke:u});v(ne,{stroke:u});v(ie,{stroke:u});break;case"attr-pinpart-name-color":v(Z,{fill:u});break;case"attr-pinpart-number-color":v(ee,{fill:u});break;case"attr-pinpart-dot":var ae=v(ne,"display")||"";if("none"!=ae==("none"!=u))break;re;l=ji.numberlistToArray(v(e,"c_origin"));_=re.pathSegList.getItem(0);S=re.pathSegList.getItem(1);C=S.pathSegTypeAsLetter;P=6;v(ne,{display:"none"==u?"none":""});var oe="h"==C?"x":"y";S[oe]+=S[oe]<0==("none"==u)?-P:+P;break;case"attr-pinpart-Clock":v(ie,{display:"none"==u?"none":""});break;case"attr-pinpart-show":v(e,{c_show:"none"==u?"none":"show"});break;case"attr-pinpart-elec":v(e,{c_elec:u});break;case"attr-pinpart-spicepin":v(e,{c_spicepin:u});break;case"attr-pinpart-length":re;_=re.pathSegList.getItem(0);S=re.pathSegList.getItem(1);C=S.pathSegTypeAsLetter;P=0;u=Math.abs(0|+u);u<1&&(u=0);if(ne&&"none"!==v(ne,"display")){P=2*v(ne,"r");u<P&&(u=P)}var se="h"==C?"x":"y",ce=+v(te,"cx"),le=+v(te,"cy");if(_.x!=ce||_.y!=le){_.x=ce;_.y=le;if(0!==S[se]){S[se]=-S[se];"y"==se?v(e,"c_rotation",S[se]>0?"90":"270"):v(e,"c_rotation",S[se]>0?"180":"0")}}var de=S[se],he=v(e,"c_rotation")||"0",fe={0:-1,90:1,180:1,270:-1},ue=fe[he]*(u-P);if(ue!=de){S[se]=ue;var pe={x:0,y:0};pe[se]=ue-de;ea.move(Z,pe.x,pe.y);ea.move(ee,pe.x/2|0,pe.y/2|0);ea.move(ne,pe.x,pe.y);ea.move(ie,pe.x,pe.y)}v(e,"c_origin",v(te,"cx")+","+v(te,"cy"));break;case"attr-pinpart-x":ea.move(e,u-v(e,"c_origin").split(",")[0],0);break;case"attr-pinpart-y":ea.move(e,0,u-v(e,"c_origin").split(",")[1])}}}else if("part_junction"==B){var ge=o("part_junction");for(f in t)if(w(t,f)){u=t[f];switch(f){case"attr-part-junction-x":l=ji.numberlistToArray(v(e,"c_origin"));Et(e,+u,l[1]);break;case"attr-part-junction-y":l=ji.numberlistToArray(v(e,"c_origin"));Et(e,l[0],+u);break;case"attr-part-junction-size":v(e.childNodes[1],{r:u});v(ge.childNodes[1],{r:u});break;case"attr-part-junction-color":v(e.childNodes[1],{fill:u});v(ge.childNodes[1],{fill:u})}}}else if("part_arrowhead"==B){for(f in t)if(w(t,f)){u=t[f];switch(f){case"attr-fill-color":v(e.childNodes[0],"fill",u);if("1"===v(e,"arrowtype")){v(e.childNodes[0],"stroke",u);v(o("part_arrowhead").childNodes[0],"stroke",u)}else v(o("part_arrowhead").childNodes[0],"stroke","none");break;case"attr-arrowhead-rotation":O=360-(u-v(e,"c_rotation"));ta.rotate(e,O,V[0],V[1]);break;case"attr-arrowhead-size":u=+u;if(u>=1){lt(u,e.childNodes[0],!0);v(e,"arrowsize",u);lt(u,o("part_arrowhead").childNodes[0]);v(o("part_arrowhead"),"arrowsize",u)}break;case"attr-arrowhead-type":v(o("part_arrowhead"),"arrowtype",u);ct(u,e);ct(u,o("part_arrowhead"))}}}else if("part_no_connect_flag"==B){for(f in t)if(w(t,f)){u=t[f];if("attr-no-connect-flag-color"==f){v(e.childNodes[0],{stroke:t["attr-no-connect-flag-color"]});v(o("part_no_connect_flag").childNodes[0],{stroke:t["attr-no-connect-flag-color"]})}}}else if("part_import_frame_lib"==B)Ur(e,t);else if(0===B.indexOf("part_netLabel_")){for(f in t)if(w(t,f)){u=t[f];switch(f){case"attr-netLabel-name":Bn(e,u);break;case"attr-netLabel-color":var ye=s("path[stroke],circle[stroke],rect[stroke],polyline[stroke],ellipse[stroke]",e);for(d=0;d<ye.length;d++)h(ye[d],"pindot")||v(ye[d],"stroke",u);v(e.childNodes[1],{fill:u});break;case"attr-netLabel-font-family":v(e.childNodes[1],{"font-family":u});break;case"attr-netLabel-font-size":v(e.childNodes[1],{"font-size":u})}}"part_netLabel_text"==B&&"NotUpdateJsonCache"!=n&&Gr(e)}else if(0===B.indexOf("part_")){var ve,me,_e=di.gJsonCache,Se=_e.schlib;for(f in t)if(w(t,f)){u=t[f];switch(f){case"attr-part-common-name":Bn(Vt("name",e),u);break;case"attr-part-common-name-display":if(/\.\d+$/.test(Vt("pre",e).childNodes[0].innerHTML)){v(Vt("name",e),{display:"none"==u?"none":""});Ce=Vt("pre",e).textContent;for(ve in Se)if(!(ve.indexOf("frame_lib")>=0)){Pe=[];for(me in Se[ve].annotation)Pe.push(Se[ve].annotation[me]);we=Pe[1].string.indexOf(".");if(we>=1&&Pe[1].string.substr(0,we)===Ce.substr(0,we)){Ne=o(Se[ve].head.gId);if(Ne===e)continue;v(Vt("name",Ne),{display:"none"==u?"none":""})}}}else v(Vt("name",e),{display:"none"==u?"none":""});break;case"attr-part-common-prefix":Bn(Vt("pre",e),u);break;case"attr-part-common-pre-display":if(/\.\d+$/.test(Vt("pre",e).childNodes[0].innerHTML)){v(Vt("pre",e),{display:"none"==u?"none":""});var Ce=Vt("pre",e).textContent;for(ve in Se)if(!(ve.indexOf("frame_lib")>=0)){var Pe=[];for(me in Se[ve].annotation)Pe.push(Se[ve].annotation[me]);var we=Pe[1].string.indexOf(".");if(we>=1&&Pe[1].string.substr(0,we)===Ce.substr(0,we)){var Ne=o(Se[ve].head.gId);if(Ne===e)continue;v(Vt("pre",Ne),{display:"none"==u?"none":""})}}}else v(Vt("pre",e),{display:"none"==u?"none":""})}}i="";a="";E=!1;for(f in t)if(f&&!f.match(/^attr-/)){i=f;a=t[f];E=!0;if(/\.\d+$/.test(Vt("pre",e).childNodes[0].innerHTML)){Vn(e,i,a);Ce=Vt("pre",e).textContent;for(ve in Se)if(!(ve.indexOf("frame_lib")>=0)){Pe=[];for(me in Se[ve].annotation)Pe.push(Se[ve].annotation[me]);we=Pe[1].string.indexOf(".");if(we>=1&&Pe[1].string.substr(0,we)===Ce.substr(0,we)){Ne=o(Se[ve].head.gId);if(Ne===e)continue;Vn(Ne,i,a)}}}else Vn(e,i,a)}if(E){di.updateOne(e);Ct("updateAttrPanel")}}"NotUpdateJsonCache"!=n&&di.updateOne(e);if("NotSaveHistory"!=r){I=e.cloneNode(!0);var Ae=1===Object.keys(t).length?Object.keys(t)[0]:"";xi.quickchangeNode=null;xi.quickchangeNodeClone=null;xi.save(["node",e.id,L,I],Ae)}}else if("NotSaveHistory"!==r){var ke=ya==ii.SCHLIB||ii.SUBPART,Oe=!1;T=ua.getCanvasAttrs();ua.modify_canvas(t);for(f in T){if(w(T,f)&&ke&&"c_para"==f){var Te=ji.c_paraToJson(T[f]);for(var Ee in Te)if(w(Te,Ee)&&w(t,Ee)){Te[Ee]=t[Ee];Oe=!0}if(Oe){t[f]=ji.jsonToC_para(Te);continue}}w(T,f)&&!w(t,f)&&delete T[f]}if(Object.keys(T).length&&Object.keys(t).length){var Me=ji.c_paraToJson(T.c_para),Ve=!1;for(f in t)if(w(t,f)&&w(Me,f)){if(t[f]!==Me[f]){Ve=!1;break}Ve=!0}Ve||xi.save(["attrpanel",Jn.id,T,t])}}else ua.modify_canvas(t)}function Mn(e){var t,r,n,i,a,o={},c=e?G(e)?e:[e]:Ar(),l=c.length>1&&Ut(c);o["attr-selected-count"]=c.length;if(l)return l;if(c.length<1||c.length>1&&!l||1===c.length&&"g1"===c[0].id){o=ua.getCanvasAttrs();o["attr-selected-count"]=c.length;o.cmdKey="canvas";di.gJsonCache.head||(di.gJsonCache.head={});"schlib"!=ji.fileType.getAbstractFileType(ya)&&delete o.c_para;o.c_para&&(o.c_para=ji.sortC_paraJson(ji.c_paraToJson(o.c_para)));return o}r=c[0];o.cmdKey=ee(r);o["attr-locked"]="1"===v(r,"locked")?"yes":"none";n=Je(r);var d="part_annotation"==n.c_partid||!n.c_shapetype&&"annotation"==ee(r);if("line"==n.c_shapetype){t=r.tagName;o["attr-topic"]=(v(r,"c_etype")||t).replace(/^(\w)/,function(e){return e.toUpperCase()});if("text"==t){o["attr-text-text"]=We(r,"\\n");o["attr-text-fill-color"]=v(r,"fill");o["attr-text-font-family"]=v(r,"font-family");o["attr-text-font-size"]=v(r,"font-size");o["attr-text-font-weight"]=v(r,"font-weight");o["attr-text-font-style"]=v(r,"font-style");o["attr-text-text-anchor"]=v(r,"text-anchor");o["attr-text-dominant-baseline"]=v(r,"dominant-baseline")}else if("image"==t){o["attr-image-href"]=v(r,"xlink:href")||v(r,"href");o["attr-image-x"]=v(r,"x");o["attr-image-y"]=v(r,"y");o["attr-image-width"]=v(r,"width");o["attr-image-height"]=v(r,"height");var h=xe(r);h>0&&(h=360-h);o["attr-image-rotation"]=h}else{o["attr-stroke-color"]=v(r,"stroke")||"";o["attr-stroke-width"]=+v(r,"stroke-width");o["attr-stroke-dasharray"]=v(r,"stroke-dasharray");o["attr-fill-color"]=v(r,"fill")||"";if("rect"==t){o["attr-rect-width"]=v(r,"width")||"0";o["attr-rect-height"]=v(r,"height")||"0";o["attr-rect-rxry"]=v(r,"rx")||"0"}if("ellipse"==t){o["attr-ellipse-rx"]=v(r,"rx");o["attr-ellipse-ry"]=v(r,"ry");o["attr-center-x"]=v(r,"cx");o["attr-center-y"]=v(r,"cy")}if("path"==t){var f,u,p,g=r.pathSegList,y=g.numberOfItems,x="";for(i=0;i<y;i++)x+=g.getItem(i).pathSegTypeAsLetter;if(/^(?:MA|MALZ|MLAZ|MLLAZ?)$/.test(x)){i=x.indexOf("A");f=g.getItem(i-1);u=g.getItem(i);p=ji.arc.getCenterPoint(f.x,f.y,u.x,u.y,u.largeArcFlag,u.sweepFlag,u.r1,u.r2,u.angle);o["attr-ellipse-rx"]=u.r1;o["attr-ellipse-ry"]=u.r2;o["attr-center-x"]=p.x;o["attr-center-y"]=p.y;o["attr-topic"]=2==y?"Arc":"Pie"}else/^M[CSQT]+Z?$/i.test(x)&&(o["attr-topic"]="Bezier")}}}else if("group"==n.c_shapetype||d){"schlib"==ee(r.parentNode)&&delete o["attr-locked"];if("part_annotation"==n.c_partid||d){r=r.childNodes[0];"note_package"!==v(r,"c_note")&&(o["attr-text-text"]=We(r,"\\n"));o["attr-text-fill-color"]=v(r,"fill");o["attr-text-font-family"]=v(r,"font-family");o["attr-text-font-size"]=v(r,"font-size");o["attr-text-font-weight"]=v(r,"font-weight");o["attr-text-font-style"]=v(r,"font-style");o["attr-text-text-anchor"]=v(r,"text-anchor");o["attr-text-dominant-baseline"]=v(r,"dominant-baseline");o["attr-text-type"]=v(r,"type")||""}else if("part_pin"==n.c_partid){o["attr-pinpart-rotation"]=v(r,"c_rotation");a=v(r,"c_origin").split(",");o["attr-pinpart-x"]=a[0];o["attr-pinpart-y"]=a[1];o["attr-pinpart-length"]=v(r.childNodes[3],"d").replace(/^.*[hv]\s*\-?/,"");r.childNodes[4]&&"none"!=v(r.childNodes[4],"display")&&(o["attr-pinpart-length"]-=-6);o["attr-pinpart-name"]=r.childNodes[0].textContent;o["attr-pinpart-number"]=r.childNodes[1].textContent;o["attr-pinpart-name-display"]="none"==v(r.childNodes[0],"display")?"none":"yes";o["attr-pinpart-number-display"]="none"==v(r.childNodes[1],"display")?"none":"yes";o["attr-pinpart-color"]=v(r.childNodes[3],"stroke");o["attr-pinpart-name-color"]=v(r.childNodes[0],"fill");o["attr-pinpart-number-color"]=v(r.childNodes[1],"fill");o["attr-pinpart-dot"]="none"==v(r.childNodes[4],"display")?"none":"yes";o["attr-pinpart-Clock"]=r.childNodes[5]&&"none"!=v(r.childNodes[5],"display")?"yes":"none";o["attr-pinpart-show"]="none"==n.c_show?"none":"yes";o["attr-pinpart-elec"]=n.c_elec;o["attr-pinpart-spicepin"]=n.c_spicepin;o["attr-pinpart-font-family"]=v(r.childNodes[0],"font-family");o["attr-pinpart-font-size"]=v(r.childNodes[0],"font-size")}else if("part_junction"==n.c_partid){delete o["attr-locked"];o["attr-part-junction-x"]=n.c_origin.split(",")[0];o["attr-part-junction-y"]=n.c_origin.split(",")[1];o["attr-part-junction-size"]=v(r.childNodes[1],"r");o["attr-part-junction-color"]=v(r.childNodes[1],"fill")||""}else if(0===n.c_partid.indexOf("part_power_")){var m=s("path[stroke]",r);m=m[0]?m[0].getAttribute("stroke"):"#000000";o["attr-part-power-color"]=m}else if(0===n.c_partid.indexOf("part_netLabel_")){o["attr-netLabel-name"]=r.childNodes[1].textContent;o["attr-netLabel-color"]=v(r.childNodes[1],"fill")||"#000000";o["attr-netLabel-font-family"]=v(r.childNodes[1],"font-family");o["attr-netLabel-font-size"]=v(r.childNodes[1],"font-size");"part_netLabel_netPort"==n.c_partid?o["attr-topic"]="Net Port":"part_netLabel_text"==n.c_partid?o["attr-topic"]="Net Label":"part_netLabel_volProbe"==n.c_partid?o["attr-topic"]="Voltage Probe":o["attr-topic"]="Net Flag"}else if("part_busentry"===n.c_partid){o["attr-busentry-x1"]=v(r.childNodes[0],"cx");o["attr-busentry-y1"]=v(r.childNodes[0],"cy");o["attr-busentry-x2"]=v(r.childNodes[1],"cx");o["attr-busentry-y2"]=v(r.childNodes[1],"cy")}else if("part_arrowhead"===n.c_partid){o["attr-topic"]="Arrowhead";o["attr-fill-color"]=v(r.childNodes[0],"fill")||"";o["attr-arrowhead-rotation"]=n.c_rotation||"0";o["attr-arrowhead-size"]=+n.arrowsize||15;o["attr-arrowhead-type"]=n.arrowtype||"3"}else if("part_no_connect_flag"===n.c_partid)o["attr-no-connect-flag-color"]=v(r.childNodes[0],"stroke")||"";else if("part_import_frame_lib"===n.c_partid)ji.extend(o,zr(r));else if(0===n.c_partid.indexOf("part_")){o["attr-part-common-name"]=Vt("name",r).childNodes[0].textContent;o["attr-part-common-prefix"]=Vt("pre",r).childNodes[0].textContent;o["attr-part-common-name-display"]="none"==v(Vt("name",r),"display")?"none":"yes";o["attr-part-common-pre-display"]="none"==v(Vt("pre",r),"display")?"none":"yes";o.c_para=ji.c_paraToJson(v(r,"c_para"));w(o.c_para,"BOM_Supplier")||(o.c_para.BOM_Supplier="");w(o.c_para,"Package Display")||(o.c_para["Package Display"]="No");w(o.c_para,"BOM_Supplier Part")||(o.c_para["BOM_Supplier Part"]="");w(o.c_para,"BOM_Manufacturer")||(o.c_para.BOM_Manufacturer="");o.c_para=ji.sortC_paraJson(o.c_para)}}return o}function Vn(e,t,r){if(0!==t.indexOf("attr-")){var n=v(e,"c_para")||"",i=n.split(si),a=ji.c_paraToJson(n);if(Object.keys(a).length){a[t]=r;var o=ji.fileType.getAbstractFileType(ya),s=ji.jsonToC_para(a);if(0===t.indexOf("power_")){t=t.replace(/power_/g,"");var l=F(Vt("name",e).childNodes[0].textContent),d=function(e){var t=e.substr(0,e.indexOf("("));t=t?t.toUpperCase():"DC";return t}(l);if("function"==t)if("DC"==d&&"DC"!=r){l+=" ";l=r+"("+l.replace(/ /,") ");l=F(l)}else if("DC"!=d&&"DC"==r){var h=l.split(")")[1];l="5"+h}else l=l.replace(d,r);else if(-1!=t.indexOf("ac")){i=l.split("AC");if(i[1]){i[1]=F(i[1]);var f=i[1].split(/\s+/g);if("ac0"==t)f[0]=r;else{f[1]=r;if(!f[0])return;f[1]=r}l=f[0]||f[1]?i[0]+" AC "+f.join(" "):i[0]}else"ac0"==t&&(l=i[0]+" AC "+r)}else if(-1!=l.indexOf("(")){var u=l?l.substr(l.indexOf("(")+1):"";u=u?u.substr(0,u.indexOf(")")):"";u=F(u);i=u.split(/\s+/g);i[t]=r;l=l.replace(u,i.join(" "))}else{i=l.split(/\s+/g);i[0]=r;l=i.join(" ")}Vt("name",e).childNodes[0].textContent=l}if("package"==t&&r&&"sch"==o){var p=v(e,"eelibtitle");if(p){var g=J("easyeda.preferences");g=N(g);var y=g&&g["eelib-package"];y||(y=g["eelib-package"]={});v(e,"package-default")!=r?y[p]=r:delete y[p];K("easyeda.preferences",JSON.stringify(g))}}v(e,{c_para:s});if("Package Display"==t)if("Yes"===r)mn(e);else{var x=c('[c_note="note_package"]',e)&&c('[c_note="note_package"]',e).parentNode;x&&x.parentNode.removeChild(x)}Ct("updateAttrPanel")}}}function Bn(e,t,r){var n=e.parentNode,i="part_pin"===v(n,"c_partid"),a=v(n,"c_partid");if(!i){a=v(e,"c_partid");"part_annotation"===a&&(a=v(e.parentNode,"c_partid"));var s=c("text",e),l=s.textContent,d=v(s,"c_note"),h="note_pre"==d,f="note_name"==d,u=0===(a||"").indexOf("part_netLabel_")}if(!t)return Ct("updateAttrPanel");(h||i&&null===v(e,"c_pinname")||u)&&(t=t.replace(/[^\x20-\x7E]+/g,""));t=F(t);if(t==l||h&&t.indexOf(" ")>=0)return Ct("updateAttrPanel");if(h){t=t.toUpperCase();var g=Vt("pre",e);if(!g||!g.childNodes[0])return Ct("updateAttrPanel")}var y,x,m;if(""===t){if(i);else if(f||h);else if(u){var _={msg:"This text can not be empty!",timeout:5e3,showType:"slide",title:"Information"};parent.$.messager.show(_)}else{m=It(e);if(e==m){xi.save(["delete",m.id,ji.node.getRefId(m)]);di.removeOne(m);p(m)}else{y=m.cloneNode(!0);p(e);x=m.cloneNode(!0);xi.save(["node",m.id,y,x]);di.updateOne(m)}}return Ct("updateAttrPanel")}var b="place."+a;if(i){var S=v(e,"c_pinname")?0:1;pa.updateNextDrawLineName(b+S,t);v(e,0===S?"c_pinname":"c_pinnumber",t)}else u&&pa.updateNextDrawLineName(b,t);if("sch"===ji.fileType.getAbstractFileType(ya)&&h&&t.indexOf("?")<0&&li.isUsed(t,{except:e.id}))Ct("warnPrefixDuplicate",[t,"Components"]);else{"part_netLabel_text"!=a&&"part_netLabel_netPort"!=a||Gr(e);Ye(i?e:s,t);Ye(s,t);if(f){var C=di.gJsonCache.schlib;if(C){var P=Vt("pre",e.parentNode);if(/\.\d+$/.test(P.childNodes[0].textContent)){var w=P.childNodes[0].textContent;for(var N in C)if(!(N.indexOf("frame_lib")>=0)){var A=[];for(var k in C[N].annotation)A.push(C[N].annotation[k]);var O=A[1].string.indexOf(".");if(O>=1&&A[1].string.substr(0,O)===w.substr(0,O)){var T=o(C[N].head.gId);if(T===e)continue;Ye(Vt("name",T).childNodes[0],t)}}}}}r&&r()}}function Gn(t,r){e.schTheme||Rn();var n,i,a,c,l,d,h=t.color,f=[],u=[],p=Jn,g={},y={};for(d in h)w(h,d)&&"null"===h[d]&&schTheme[t.activeTheme]&&(h[d]=schTheme[t.activeTheme].color[d]||"#FFFFFF");var x,m=ua.getCanvasAttrs(),_={},b={};if(w(h,"background")){_["attr-canvas-bgcolor"]=m["attr-canvas-bgcolor"];b["attr-canvas-bgcolor"]=h.background;x=!0}if(w(h,"grid")){_["attr-canvas-grid-color"]=m["attr-canvas-grid-color"];b["attr-canvas-grid-color"]=h.grid;x=!0}if(x){r||f.push(["attrpanel",Jn.id,_,b]);ua.modify_canvas(b)}w(h,"foreground")&&(_i.canvas.fgcolor=h.foreground);for(var S=s(":not(g):not([id])",p),C=0,P=S.length;C<P;C++)S[C].id=ji.newId();n=Jn.cloneNode(!0);g=ji.extend({},_i.colors);f.push(["variable","",schTheme,"activeTheme",schTheme.activeTheme,t.activeTheme]);t.reloadBuiltInParts||function(){for(var e,t=o("gCurParts").childNodes,r=t.length-1;r>=0;r--){e=v(t[r],"c_partid");e&&o(e)&&!e.match(/part_import/)&&(y[e]=o(e).cloneNode(!0))}}();_i.colors=ji.extend({},t.colorSuffix||h);i=o("selectStyle").cloneNode(!0);Dn(_i.colors.select);u.push({exNode:i,newNode:o("selectStyle").cloneNode(!0)});Fn(h,p);if(t.reloadBuiltInParts){l=Nr(!0);l.length&&(u=u.concat(l))}else{Fn(_i.colors,o("gCurParts"));!function(){for(var e,t,r=o("gCurParts").childNodes,n=r.length-1;n>=0;n--){e=v(t=r[n],"c_partid");e&&y[e]&&u.push({exNode:y[e],newNode:t.cloneNode(!0)})}}()}schTheme.activeTheme=t.activeTheme;if("user-define"===t.activeTheme){a=ji.extend({},schTheme["user-define"].color);c=ji.extend(schTheme["user-define"].color,_i.colors);f.push(["variable","",schTheme["user-define"],"color",a,ji.extend({},c)])}di.calAll();u.push({exNode:n,newNode:Jn.cloneNode(!0)});f.push(["variable","",_i,"colors",g,ji.extend({},_i.colors)]);u.forEach(function(e){f.push(["node",e.exNode.id,e.exNode,e.newNode])});f.length&&!r&&xi.save(f);Ct("updateAttrPanel")}function Fn(e,t){var r,n;if(e){if(!t.id){n=!0;t.id="tempIdForSetElementColors"}r="#"+t.id;w(e,"text")&&v(s("text",t),"fill",e.text);if(w(e,"partGraphics")){v(s('g:not([c_partid="part_junction"]) > :not(text)[stroke]:not([stroke=none])',t),"stroke",e.partGraphics);v(s('g:not([c_partid="part_junction"]) > :not(text)[fill]:not([fill=none])[stroke=none],g:not([c_partid="part_junction"]) > :not(text)[fill]:not([fill=none]):not([stroke])',t),"fill",e.partGraphics)}w(e,"partGraphicsPrefix")&&v(s('g text[c_note="note_pre"]',t),"fill",e.partGraphicsPrefix);w(e,"partGraphicsName")&&v(s('g text[c_note="note_name"]',t),"fill",e.partGraphicsName);if(w(e,"foreground")){v(s("> [stroke]:not([stroke=none])",t),"stroke",e.foreground);v(s(r+" > [fill]:not([fill=none])[stroke=none],"+r+" > [fill]:not([fill=none]):not([stroke])",t),"fill",e.foreground)}w(e,"draw")&&v(s(r+' > [c_shapetype="line"][stroke]:not([stroke=none])',t),"stroke",e.draw);w(e,"arrow")&&v(s('g[c_partid="part_arrowhead"] [fill]:not([fill=none])',t),"fill",e.arrow);if(w(e,"pin")){v(s('g[c_partid="part_pin"] [stroke]:not([stroke=none])',t),"stroke",e.pin);v(s('g[c_partid="part_pin"] [fill]:not([fill=none]):not(text)',t),"fill",e.pin)}w(e,"pinName")&&v(s('g[c_partid="part_pin"] text',t),"fill",e.pinName);w(e,"pinNumber")&&v(s('g[c_partid="part_pin"] text[c_pinnumber]',t),"fill",e.pinNumber);w(e,"drawFill")&&v(s("g > :not(text)[fill]:not([fill=none]):not([fill=NONE])[stroke]:not([stroke=none])",t),"fill",e.drawFill);w(e,"wire")&&v(s('[c_etype="wire"]',t),"stroke",e.wire);w(e,"bus")&&v(s('[c_etype="bus"]',t),"stroke",e.bus);if(w(e,"sheet")){v(s('g[c_partid="part_import_frame_lib"] > *[c_partid="part_annotation"] text',t),"fill",e.sheet);v(s('g[c_partid="part_import_frame_lib"] > *:not(g)',t),"stroke",e.sheet)}w(e,"busEntry")&&v(s('g[c_partid="part_busentry"] [stroke]:not([stroke=none])',t),"stroke",e.busEntry);if(w(e,"netLabel")){v(s('g[c_partid="part_netLabel_text"] [stroke]:not([stroke=none])',t),"stroke",e.netLabel);v(s('g[c_partid="part_netLabel_text"] [fill]:not([fill=none])',t),"fill",e.netLabel);v(s('g[c_partid="part_netLabel_netPort"] [stroke]:not([stroke=none])',t),"stroke",e.netLabel);v(s('g[c_partid="part_netLabel_netPort"] [fill]:not([fill=none])',t),"fill",e.netLabel)}if(w(e,"voltageProbe")){v(s('g[c_partid="part_netLabel_volProbe"] [stroke]:not([stroke=none])',t),"stroke",e.voltageProbe);v(s('g[c_partid="part_netLabel_volProbe"] [fill]:not([fill=none])',t),"fill",e.voltageProbe)}if(w(e,"netFlag")){v(s('g[c_partid^="part_netLabel"]:not([c_partid="part_netLabel_volProbe"]):not([c_partid="part_netLabel_text"]):not([c_partid="part_netLabel_netPort"]) [stroke]:not([stroke=none])',t),"stroke",e.netFlag);v(s('g[c_partid^="part_netLabel"]:not([c_partid="part_netLabel_volProbe"]):not([c_partid="part_netLabel_text"]):not([c_partid="part_netLabel_netPort"]) [fill]:not([fill=none])',t),"fill",e.netFlag)}w(e,"noConnect")&&v(s('g[c_partid="part_no_connect_flag"] [stroke]:not([stroke=none])',t),"stroke",e.noConnect);if(w(e,"junction")){v(s('g[c_partid="part_junction"] [stroke]:not([stroke=none])',t),"stroke",e.junction);v(s('g[c_partid="part_junction"] [fill]:not([fill=none])',t),"fill",e.junction)}n&&(t.id="")}}function Rn(){if(!e.schTheme){schTheme={activeTheme:"original-theme"};schTheme["original-theme"]={color:{background:"#FFFFFF",grid:"#CCCCCC",select:"#FF0000",wire:"#008800",bus:"#008800",busEntry:"#008800",netLabel:"#0000FF",netFlag:"#000000",noConnect:"#33CC33",voltageProbe:"#0000FF",pin:"#880000",pinName:"#0000FF",pinNumber:"#0000FF",partGraphics:"#880000",partGraphicsName:"#000080",partGraphicsPrefix:"#000080",sheet:"#880000",draw:"#000000",drawFill:"#880000",text:"#0000FF",arrow:"#333333",junction:"#CC0000"},colorSuffix:{select:"#FF0000"},activeTheme:"original-theme",changeable:!1,blockColorShow:!0,reloadBuiltInParts:!0};schTheme["white-on-black"]={color:{background:"#000000",grid:"#CCCCCC",select:"#FF0000",wire:"#FFFFFF",bus:"#FFFFFF",busEntry:"#FFFFFF",netLabel:"#FFFFFF",netFlag:"#FFFFFF",noConnect:"#FFFFFF",voltageProbe:"#FFFFFF",pin:"#FFFFFF",pinName:"#FFFFFF",pinNumber:"#FFFFFF",partGraphics:"#FFFFFF",partGraphicsName:"#FFFFFF",partGraphicsPrefix:"#FFFFFF",sheet:"#FFFFFF",draw:"#FFFFFF",drawFill:"#FFFFFF",text:"#FFFFFF",arrow:"#FFFFFF",junction:"#FFFFFF"},colorSuffix:!1,activeTheme:"white-on-black",changeable:!1,blockColorShow:!1,reloadBuiltInParts:!1};schTheme["black-on-white"]={color:{background:"#FFFFFF",grid:"#CCCCCC",select:"#FF0000",wire:"#000000",bus:"#000000",busEntry:"#000000",netLabel:"#000000",netFlag:"#000000",noConnect:"#000000",voltageProbe:"#000000",pin:"#000000",pinName:"#000000",pinNumber:"#000000",partGraphics:"#000000",partGraphicsName:"#000000",partGraphicsPrefix:"#000000",sheet:"#000000",draw:"#000000",drawFill:"#000000",text:"#000000",arrow:"#000000",junction:"#000000"},colorSuffix:!1,activeTheme:"black-on-white",changeable:!1,blockColorShow:!1,reloadBuiltInParts:!1};schTheme["user-define"]={color:{background:"#FFFFFF",grid:"#CCCCCC",select:"#FF0000",wire:"#008800",bus:"#008800",busEntry:"#008800",netLabel:"#0000FF",netFlag:"#000000",noConnect:"#33CC33",voltageProbe:"#0000FF",pin:"#880000",pinName:"#0000FF",pinNumber:"#0000FF",partGraphics:"#880000",partGraphicsName:"#000080",partGraphicsPrefix:"#000080",sheet:"#880000",draw:"#000000",drawFill:"#880000",text:"#0000FF",arrow:"#333333",junction:"#CC0000"},colorSuffix:!1,activeTheme:"user-define",changeable:!0,blockColorShow:!1,reloadBuiltInParts:!1};schTheme["my-theme"]={color:{background:"#FFFFFF",grid:"#CCCCCC",select:"#FF0000",wire:"#008800",bus:"#008800",busEntry:"#008800",netLabel:"#0000FF",netFlag:"#000000",noConnect:"#33CC33",voltageProbe:"#0000FF",pin:"#880000",pinName:"#0000FF",pinNumber:"#0000FF",partGraphics:"#880000",partGraphicsName:"#000080",partGraphicsPrefix:"#000080",sheet:"#880000",draw:"#000000",drawFill:"#880000",text:"#0000FF",arrow:"#333333",junction:"#CC0000"},colorSuffix:!1,activeTheme:"user-define",changeable:!0,blockColorShow:!1,reloadBuiltInParts:!1};_i.colors||(_i.colors={});schTheme.activeTheme=function(){function e(e,t){var r=!0;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var n in t)if(w(t,n)&&t[n].toLowerCase()!==(e[n]&&e[n].toLowerCase())){r=!1;break}return r}if(!_i.colors||0===Object.keys(_i.colors).length||e(schTheme["original-theme"].colorSuffix,_i.colors))return"original-theme";for(var t in schTheme)if("original-theme"!==t&&w(schTheme,t)&&"object"==typeof schTheme[t]&&e(_i.colors,schTheme[t].color))return t;return"user-define"}();"user-define"===schTheme.activeTheme&&ji.extend(schTheme["user-define"].color,_i.colors);Fn(_i.colors,o("gCurParts"),v);Dn(_i.colors.select);Ct("setThemeDropdownRadio",[schTheme.activeTheme]);return schTheme}}function Dn(e){o("selectStyle")&&e&&(o("selectStyle").innerHTML=".hover, g.hover * {stroke:"+e+";}\t\t.active, .active * {stroke:"+e+";}\t\t.selected, .selected * {stroke:"+e+";}\t\ttext.hover, .hover text, tspan.hover, .hover tspan {stroke:none;fill:"+e+";}\t\ttext.active, svg.active text, g.active text, tspan.active, svg.active tspan, g.active tspan {stroke:none;fill:"+e+";}\t\ttext.selected, .selected text, tspan.selected, .selected tspan {stroke:none;fill:"+e+";}\t\t.wire-hover {stroke:"+e+";}")}function Hn(e){return"6,6"==e?1:"3,10"==e?2:0}function jn(e){return"Verdana"==e?"":e}function Un(e){return"7pt"==e?"":e}function zn(e){var t=e.shapeType,r="part_"+t,n=o(r);if(n&&"import_tmpl"!=t&&"junction"!=t){var i=n.cloneNode(!0);v(i,{id:ji.newId(),c_shapetype:"group",c_etype:"pinpart"});m(i,"pointer-events");Jn.appendChild(i);for(var a,c=s("g text[c_note]",i),l=0;l<c.length;l++){a=c[l].textContent;a.indexOf("?")>0&&(c[l].textContent=li.getNewPre(a))}it(i);w(e,"x")&&w(e,"y")&&Et(i,e.x,e.y);e.rotation&&mr([i],e.rotation,!0);if("part_pin"==r){var d=+n.childNodes[2].textContent+1+"";n.childNodes[2].textContent=d;n.childNodes[3].textContent=d;v(n,{c_spicepin:d})}else"part_netLabel_volProbe"==r&&(i.childNodes[1].firstChild.nodeValue=$r());var h={name:"attr-netLabel-name",color:"attr-netLabel-color","font-family":"attr-netLabel-font-family","font-size":"attr-netLabel-font-size"},f={no_connect_flag:{stroke:"attr-no-connect-flag-color"},noconnectflag:{stroke:"attr-no-connect-flag-color"},arrowhead:{color:"attr-fill-color",size:"attr-arrowhead-size"},busentry:{},netlabel:h,junction:{size:"attr-part-junction-size",color:"attr-part-junction-color"},pin:{length:"attr-pinpart-length",name:"attr-pinpart-name",number:"attr-pinpart-number",spicepin:"attr-pinpart-spicepin","name-display":"attr-pinpart-name-display","number-display":"attr-pinpart-number-display",color:"attr-pinpart-color",dot:"attr-pinpart-dot",clk:"attr-pinpart-clk",show:"attr-pinpart-show",elec:"attr-pinpart-elec","font-family":"attr-pinpart-font-family","font-size":"attr-pinpart-font-size"},annotation:{text:"attr-text-text",color:"attr-text-fill-color","text-type":"attr-text-type","font-family":"attr-text-font-family","font-size":"attr-text-font-size","font-weight":"attr-text-font-weight","font-style":"attr-text-font-style"}},u={},p=0===t.indexOf("netLabel_")?h:f[t];if(p){!function(e,t,r){if(r)for(var n in r)if(w(r,n))if(w(e,n))t[r[n]]=e[n];else{var i=ji.camelize(n);w(e,i)&&(t[r[n]]=e[i])}}(e,u,p);Object.keys(u).length>0&&En(i,u,"NotSaveHistory")}di.updateOne(i);if("part_pin"!=r){bi.solveItem(i);bi.solveTodoList();xi.save(bi.batHistoryCmd(["add",i.id]))}else xi.save(["add",i.id]);return i}}function Xn(e){function r(e,t){var r=t.points;Array.isArray(r)&&(r=r.reduce(function(e,t){return(e?e+" ":"")+t.x+" "+t.y},""));var n=yn(e,{points:r,id:ji.newId()});return Jn.appendChild(n)}function n(e){var t=yn("path",{d:e.d});return Jn.appendChild(t)}function i(e,t){var r={solid:"",dashed:"6,6",dotted:"3,10"};t["stroke-style"]&&r[t["stroke-style"]]&&v(e,{"stroke-dasharray":r[t["stroke-style"]]});v(e,{stroke:t.stroke||_i.canvas.fgcolor,"stroke-width":t["stroke-width"]||"1",fill:t.fill||"none",c_shapetype:"line"})}var a,s,c=e.shapeType;if(!(["text","image","wire","bus","rect","polyline","polygon","circle","ellipse","line","path","bezier","arc","pie"].indexOf(c)<0)){switch(c){case"wire":!function(e){e.stroke||(e.stroke=_i.canvas.schWireStrokeColor||"#008800");var t=r("polyline",e.points);i(t,e);v(t,{c_etype:"wire"});var n=["add",t.id,ji.node.getRefId(t)],a=oa.simplifyWire(t);switch(a.status){case"merge":p(t);t=o(a.wireId);n=["node",t.id,a.oldNode,t.cloneNode(!0)];break;case"invalidWire":p(t);t=null}if(t){di.updateOne(t);bi.solveItem(t);bi.solveTodoList();xi.save(bi.batHistoryCmd(n))}}(e);return;case"bus":e["stroke-width"]||(e["stroke-width"]="2");a=r("polyline",e);v(a,{c_etype:"bus"});break;case"text":a=function(e){var r=yn("text",{id:ji.newId(),x:e.x,y:e.y,stroke:e.stroke||"none",fill:e.fill||e.color||_i.canvas.fgcolor,"font-family":e["font-family"]||"Verdana","font-size":e["font-size"]||"9pt","font-weight":e["font-weight"]||"","font-style":e["font-style"]||"",c_shapetype:"line"}),n=(e.text||"TEXT").trim();if(n.match(/[\r\n]/))for(var i,a=n.replace(/\r\n?/g,"\n").split("\n"),o={x:e.x,dy:"0","xml:space":"preserve"},s=0;s<a.length;s++){s>0&&(o.dy="1em");o.id=ji.newId();i=yn("tspan",o);i.appendChild(t.createTextNode(a[s]||" "));n.appendChild(i)}else r.appendChild(t.createTextNode(n));e.type&&En(r,{"attr-text-type":e.type},"NotSaveHistory");Jn.appendChild(r);e.rotation&&ta.rotate(r,e.rotation);return r}(e);break;case"image":a=function(e){var t,r,n=e.src;if(e.src){t=e.width||e.height||100;r=e.height||e.width||100}else{n=ci.src;t=ci.width;r=ci.height}var i=yn("image",{id:ji.newId(),x:e.x,y:e.y,width:t,height:r,preserveAspectRatio:"none","xlink:href":n,c_shapetype:"line",c_rotation:0});Jn.appendChild(i);e.rotation&&ta.rotate(i,e.rotation);return i}(e);break;case"polyline":case"polygon":a=r(c,e);break;case"rect":a=Jn.appendChild(yn(c,{x:e.x,y:e.y,width:e.width,height:e.height,rx:e["round-radius"]||"",ry:e["round-radius"]||""}));break;case"circle":isFinite(e.cx)||(e.cx=500);isFinite(e.cy)||(e.cy=500);isFinite(e.r)||(e.r=50);a=Jn.appendChild(yn(c,{cx:e.cx,cy:e.cy,r:e.r}));break
;case"ellipse":isFinite(e.cx)||(e.cx=500);isFinite(e.cy)||(e.cy=500);isFinite(e.rx)||(e.rx=100);isFinite(e.ry)||(e.ry=50);a=Jn.appendChild(yn(c,{cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry}));break;case"line":if(!(isFinite(e.x1)&&isFinite(e.x2)&&isFinite(e.y1)&&isFinite(e.y2)))break;a=Jn.appendChild(yn(c,{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}));break;case"path":(e.d||e.pathString)&&(a=n({d:e.d||e.pathString}));break;case"bezier":if(e.controls){s=function(e){if(!(e.length<4)){for(var t="M"+e[0].x+" "+e[0].y,r=3;r<e.length;r+=3)t+="C"+e[r-2].x+" "+e[r-2].y+" "+e[r-1].x+" "+e[r-1].y+" "+e[r].x+" "+e[r].y;return t}}(e.controls);s&&(a=n({d:s}))}break;case"arc":case"pie":s=function(e){function t(t){return w(e,t)}function r(t){return e[t]}w(e,"angle")||(e.angle=0);!w(e,"rx")&&w(e,"r1")&&(e.rx=e.r1);!w(e,"ry")&&w(e,"r2")&&(e.ry=e.r2);var n,i,a=["x1","y1","x2","y2","rx","ry","angle","largeArcFlag","sweepFlag"],o=["cx","cy","rx","ry","x1","y1","x2","y2"],s=["x1","y1","x2","y2","x3","y3"],c=["cx","cy","rx","ry","a1","a2","sweepFlag"],l=e.shapeType,d="pie"==l;if(a.every(t)){i="A"+e.rx+" "+e.ry+" "+(e.angle||0)+" "+(e.largeArcFlag?1:0)+" "+(e.sweepFlag?1:0)+" "+e.x2+" "+e.y2;if(d){var h=ji.arc.getCenterParam(e.x1,e.y1,e.x2,e.y2,e.largeArcFlag,e.sweepFlag,e.rx,e.ry,e.angle||0);h&&(i="M"+h.cx+" "+h.cy+"L"+e.x1+" "+e.y1+i+"Z")}else i="M"+e.x1+" "+e.y1+i}else if(o.every(t)){n=ji.arc.getArcParams.apply(null,o.map(r));i="A"+e.rx+" "+e.ry+" 0 "+n.fa+" "+n.fs+" "+n.x2+" "+n.y2;i=d?"M"+e.cx+" "+e.cy+"L"+n.x1+" "+n.y1+i+"Z":"M"+n.x1+" "+n.y1+i}else if(s.every(t)){n=ji.arc.getArcParamsBy3Points.apply(null,s.map(r));i="A"+n.r1+" "+n.r2+" "+n.angle+" "+n.largeArcFlag+" "+n.sweepFlag+" "+n.x+" "+n.y;i=d?"M"+n.cx+" "+n.cy+"L"+e.x1+" "+e.y1+i+"Z":"M"+e.x1+" "+e.y1+i}else if(c.every(t)){n=ji.arc.getArcParamsByCRA.apply(null,c.map(r));i="A"+e.rx+" "+e.ry+" 0 "+n.fa+" "+n.fs+" "+n.x2+" "+n.y2;i=d?"M"+e.cx+" "+e.cy+"L"+n.x1+" "+n.y1+i+"Z":"M"+n.x1+" "+n.y1+i}return i}(e);s&&(a=n({d:s}));break;default:return}if(a){a.id||(a.id=ji.newId());"text"!=c&&"image"!=c&&i(a,e);di.updateOne(a);xi.save(["add",a.id,ji.node.getRefId(a)])}}}function Yn(e){var t=o(e.id);if(t&&e.svg&&t.parentNode==Jn){var r=e.id,n=t,i=vn(e.svg);if(i){var a=s("*",n),c=s("*:not(.hitbox)",i);i.id=r;for(var l=0;l<c.length;l++)c[l].id=a[l]&&a[l].id||ji.newId();n=n.parentNode.replaceChild(i,n);Ft(ya)&&"schlib"==ee(i)&&at(i);di.updateOne(i);xi.save(["node",r,i.cloneNode(!0),n])}}}function Wn(){return function(){var e=[Hi._xaxis.name];for(var t in Hi.series)w(Hi.series,t)&&e.push(t);return e.join("\t")}()+"\n"+function(){var e=[],t=Hi._xaxis.data.length,r=[];for(var n in Hi.series)w(Hi.series,n)&&r.push(n);for(var i=0;i<t;i++){for(var a=[Hi._xaxis.data[i]],o=0,s=r.length;o<s;o++)a.push(Hi.series[r[o]].data[i]);e.push(a.join("\t"))}return e.join("\n")}()}!function(){function e(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,n,i,a,o;i=2147483648&e;a=2147483648&t;r=1073741824&e;n=1073741824&t;o=(1073741823&e)+(1073741823&t);return r&n?2147483648^o^i^a:r|n?1073741824&o?3221225472^o^i^a:1073741824^o^i^a:o^i^a}function n(e,t,r){return e&t|~e&r}function i(e,t,r){return e&r|t&~r}function a(e,t,r){return e^t^r}function o(e,t,r){return t^(e|~r)}function s(e,i,a,o,s,c,l){e=r(e,r(r(n(i,a,o),s),l));return r(t(e,c),i)}function c(e,n,a,o,s,c,l){e=r(e,r(r(i(n,a,o),s),l));return r(t(e,c),n)}function l(e,n,i,o,s,c,l){e=r(e,r(r(a(n,i,o),s),l));return r(t(e,c),n)}function d(e,n,i,a,s,c,l){e=r(e,r(r(o(n,i,a),s),l));return r(t(e,c),n)}function h(e){var t,r,n="",i="";for(r=0;r<=3;r++){t=e>>>8*r&255;i="0"+t.toString(16);n+=i.substr(i.length-2,2)}return n}var f,u,p,g,y,v,x,m,_,b=Array();e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n<128)t+=String.fromCharCode(n);else if(n>127&&n<2048){t+=String.fromCharCode(n>>6|192);t+=String.fromCharCode(63&n|128)}else{t+=String.fromCharCode(n>>12|224);t+=String.fromCharCode(n>>6&63|128);t+=String.fromCharCode(63&n|128)}}return t}(e);b=function(e){for(var t,r=e.length,n=r+8,i=(n-n%64)/64,a=16*(i+1),o=Array(a-1),s=0,c=0;c<r;){t=(c-c%4)/4;s=c%4*8;o[t]=o[t]|e.charCodeAt(c)<<s;c++}t=(c-c%4)/4;s=c%4*8;o[t]=o[t]|128<<s;o[a-2]=r<<3;o[a-1]=r>>>29;return o}(e);v=1732584193;x=4023233417;m=2562383102;_=271733878;for(f=0;f<b.length;f+=16){u=v;p=x;g=m;y=_;v=s(v,x,m,_,b[f+0],7,3614090360);_=s(_,v,x,m,b[f+1],12,3905402710);m=s(m,_,v,x,b[f+2],17,606105819);x=s(x,m,_,v,b[f+3],22,3250441966);v=s(v,x,m,_,b[f+4],7,4118548399);_=s(_,v,x,m,b[f+5],12,1200080426);m=s(m,_,v,x,b[f+6],17,2821735955);x=s(x,m,_,v,b[f+7],22,4249261313);v=s(v,x,m,_,b[f+8],7,1770035416);_=s(_,v,x,m,b[f+9],12,2336552879);m=s(m,_,v,x,b[f+10],17,4294925233);x=s(x,m,_,v,b[f+11],22,2304563134);v=s(v,x,m,_,b[f+12],7,1804603682);_=s(_,v,x,m,b[f+13],12,4254626195);m=s(m,_,v,x,b[f+14],17,2792965006);x=s(x,m,_,v,b[f+15],22,1236535329);v=c(v,x,m,_,b[f+1],5,4129170786);_=c(_,v,x,m,b[f+6],9,3225465664);m=c(m,_,v,x,b[f+11],14,643717713);x=c(x,m,_,v,b[f+0],20,3921069994);v=c(v,x,m,_,b[f+5],5,3593408605);_=c(_,v,x,m,b[f+10],9,38016083);m=c(m,_,v,x,b[f+15],14,3634488961);x=c(x,m,_,v,b[f+4],20,3889429448);v=c(v,x,m,_,b[f+9],5,568446438);_=c(_,v,x,m,b[f+14],9,3275163606);m=c(m,_,v,x,b[f+3],14,4107603335);x=c(x,m,_,v,b[f+8],20,1163531501);v=c(v,x,m,_,b[f+13],5,2850285829);_=c(_,v,x,m,b[f+2],9,4243563512);m=c(m,_,v,x,b[f+7],14,1735328473);x=c(x,m,_,v,b[f+12],20,2368359562);v=l(v,x,m,_,b[f+5],4,4294588738);_=l(_,v,x,m,b[f+8],11,2272392833);m=l(m,_,v,x,b[f+11],16,1839030562);x=l(x,m,_,v,b[f+14],23,4259657740);v=l(v,x,m,_,b[f+1],4,2763975236);_=l(_,v,x,m,b[f+4],11,1272893353);m=l(m,_,v,x,b[f+7],16,4139469664);x=l(x,m,_,v,b[f+10],23,3200236656);v=l(v,x,m,_,b[f+13],4,681279174);_=l(_,v,x,m,b[f+0],11,3936430074);m=l(m,_,v,x,b[f+3],16,3572445317);x=l(x,m,_,v,b[f+6],23,76029189);v=l(v,x,m,_,b[f+9],4,3654602809);_=l(_,v,x,m,b[f+12],11,3873151461);m=l(m,_,v,x,b[f+15],16,530742520);x=l(x,m,_,v,b[f+2],23,3299628645);v=d(v,x,m,_,b[f+0],6,4096336452);_=d(_,v,x,m,b[f+7],10,1126891415);m=d(m,_,v,x,b[f+14],15,2878612391);x=d(x,m,_,v,b[f+5],21,4237533241);v=d(v,x,m,_,b[f+12],6,1700485571);_=d(_,v,x,m,b[f+3],10,2399980690);m=d(m,_,v,x,b[f+10],15,4293915773);x=d(x,m,_,v,b[f+1],21,2240044497);v=d(v,x,m,_,b[f+8],6,1873313359);_=d(_,v,x,m,b[f+15],10,4264355552);m=d(m,_,v,x,b[f+6],15,2734768916);x=d(x,m,_,v,b[f+13],21,1309151649);v=d(v,x,m,_,b[f+4],6,4149444226);_=d(_,v,x,m,b[f+11],10,3174756917);m=d(m,_,v,x,b[f+2],15,718787259);x=d(x,m,_,v,b[f+9],21,3951481745);v=r(v,u);x=r(x,p);m=r(m,g);_=r(_,y)}return(h(v)+h(x)+h(m)+h(_)).toLowerCase()}function t(t){return t?e(t+"_^&!Aa1"):""}var r="undefined"!=typeof exports?exports:this;r.MD5=e;r.ourMD5=t}();!function(){"use strict";if(!("SVGPathSeg"in e)){e.SVGPathSeg=function(e,t,r){this.pathSegType=e;this.pathSegTypeAsLetter="z"==t?"Z":t;this._owningPathSegList=r};SVGPathSeg.prototype.classname="SVGPathSeg";SVGPathSeg.PATHSEG_UNKNOWN=0;SVGPathSeg.PATHSEG_CLOSEPATH=1;SVGPathSeg.PATHSEG_MOVETO_ABS=2;SVGPathSeg.PATHSEG_MOVETO_REL=3;SVGPathSeg.PATHSEG_LINETO_ABS=4;SVGPathSeg.PATHSEG_LINETO_REL=5;SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6;SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9;SVGPathSeg.PATHSEG_ARC_ABS=10;SVGPathSeg.PATHSEG_ARC_REL=11;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13;SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14;SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19;SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)};e.SVGPathSegClosePath=function(e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CLOSEPATH,"z",e)};SVGPathSegClosePath.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"};SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter};SVGPathSegClosePath.prototype.clone=function(){return new SVGPathSegClosePath(void 0)};e.SVGPathSegMovetoAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_ABS,"M",e);this._x=t;this._y=r};SVGPathSegMovetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"};SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoAbs.prototype.clone=function(){return new SVGPathSegMovetoAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegMovetoRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_REL,"m",e);this._x=t;this._y=r};SVGPathSegMovetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"};SVGPathSegMovetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoRel.prototype.clone=function(){return new SVGPathSegMovetoRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_ABS,"L",e);this._x=t;this._y=r};SVGPathSegLinetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"};SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoAbs.prototype.clone=function(){return new SVGPathSegLinetoAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_REL,"l",e);this._x=t;this._y=r};SVGPathSegLinetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"};SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoRel.prototype.clone=function(){return new SVGPathSegLinetoRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicAbs=function(e,t,r,n,i,a,o){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",e);this._x=t;this._y=r;this._x1=n;this._y1=i;this._x2=a;this._y2=o};SVGPathSegCurvetoCubicAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"};SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicAbs(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicRel=function(e,t,r,n,i,a,o){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",e);this._x=t;this._y=r;this._x1=n;this._y1=i;this._x2=a;this._y2=o};SVGPathSegCurvetoCubicRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"};SVGPathSegCurvetoCubicRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicRel(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticAbs=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",e);this._x=t;this._y=r;this._x1=n;this._y1=i};SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticAbs]"};SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticAbs(void 0,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticRel=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",e);this._x=t;this._y=r;this._x1=n;this._y1=i};SVGPathSegCurvetoQuadraticRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"};SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticRel(void 0,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegArcAbs=function(e,t,r,n,i,a,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_ABS,"A",e);this._x=t;this._y=r;this._r1=n;this._r2=i;this._angle=a;this._largeArcFlag=o;this._sweepFlag=s};SVGPathSegArcAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"};SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcAbs.prototype.clone=function(){return new SVGPathSegArcAbs(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(e){this._r1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(e){this._r2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegArcRel=function(e,t,r,n,i,a,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_REL,"a",e);this._x=t;this._y=r;this._r1=n;this._r2=i;this._angle=a;this._largeArcFlag=o;this._sweepFlag=s};SVGPathSegArcRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"};SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcRel.prototype.clone=function(){return new SVGPathSegArcRel(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(e){this._r1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(e){this._r2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoHorizontalAbs=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,"H",e);this._x=t};SVGPathSegLinetoHorizontalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"};SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new SVGPathSegLinetoHorizontalAbs(void 0,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoHorizontalRel=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",e);this._x=t};SVGPathSegLinetoHorizontalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"};SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalRel.prototype.clone=function(){return new SVGPathSegLinetoHorizontalRel(void 0,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoVerticalAbs=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",e);this._y=t};SVGPathSegLinetoVerticalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"};SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new SVGPathSegLinetoVerticalAbs(void 0,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoVerticalRel=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",e);this._y=t};SVGPathSegLinetoVerticalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"};SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new SVGPathSegLinetoVerticalRel(void 0,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicSmoothAbs=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",e);this._x=t;this._y=r;this._x2=n;this._y2=i};SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"};SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,this._x,this._y,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicSmoothRel=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",e);this._x=t;this._y=r;this._x2=n;this._y2=i};SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"};SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothRel(void 0,this._x,this._y,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticSmoothAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",e);this._x=t;this._y=r};SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"};SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticSmoothRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",e);this._x=t;this._y=r};SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"};SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new SVGPathSegClosePath(void 0)};SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(e,t){return new SVGPathSegMovetoAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegMovetoRel=function(e,t){return new SVGPathSegMovetoRel(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(e,t){return new SVGPathSegLinetoAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegLinetoRel=function(e,t){return new SVGPathSegLinetoRel(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(e,t,r,n,i,a){return new SVGPathSegCurvetoCubicAbs(void 0,e,t,r,n,i,a)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(e,t,r,n,i,a){return new SVGPathSegCurvetoCubicRel(void 0,e,t,r,n,i,a)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(e,t,r,n){return new SVGPathSegCurvetoQuadraticAbs(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(e,t,r,n){return new SVGPathSegCurvetoQuadraticRel(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegArcAbs=function(e,t,r,n,i,a,o){return new SVGPathSegArcAbs(void 0,e,t,r,n,i,a,o)};SVGPathElement.prototype.createSVGPathSegArcRel=function(e,t,r,n,i,a,o){return new SVGPathSegArcRel(void 0,e,t,r,n,i,a,o)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(e){return new SVGPathSegLinetoHorizontalAbs(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(e){return new SVGPathSegLinetoHorizontalRel(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(e){return new SVGPathSegLinetoVerticalAbs(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(e){return new SVGPathSegLinetoVerticalRel(void 0,e)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(e,t,r,n){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(e,t,r,n){return new SVGPathSegCurvetoCubicSmoothRel(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(e,t){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(e,t){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,e,t)};"getPathSegAtLength"in SVGPathElement.prototype||(SVGPathElement.prototype.getPathSegAtLength=function(e){if(void 0===e||!isFinite(e))throw"Invalid arguments.";var r=t.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",this.getAttribute("d"));var n=r.pathSegList.numberOfItems-1;if(n<=0)return 0;do{r.pathSegList.removeItem(n);if(e>r.getTotalLength())break;n--}while(n>0);return n})}if(!("SVGPathSegList"in e&&"appendItem"in e.SVGPathSegList.prototype)){e.SVGPathSegList=function(e){this._pathElement=e;this._list=this._parsePath(this._pathElement.getAttribute("d"));this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]};this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};SVGPathSegList.prototype.classname="SVGPathSegList";Object.defineProperty(SVGPathSegList.prototype,"numberOfItems",{get:function(){this._checkPathSynchronizedToList();return this._list.length},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"pathSegList",{get:function(){this._pathSegList||(this._pathSegList=new SVGPathSegList(this));return this._pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"normalizedPathSegList",{get:function(){
return this.pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0});SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())};SVGPathSegList.prototype._updateListFromPathMutations=function(e){if(this._pathElement){var t=!1;e.forEach(function(e){"d"==e.attributeName&&(t=!0)});t&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}};SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect();this._pathElement.setAttribute("d",SVGPathSegList._pathSegArrayAsString(this._list));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};SVGPathSegList.prototype.segmentChanged=function(e){this._writeListToPath()};SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList();this._list.forEach(function(e){e._owningPathSegList=null});this._list=[];this._writeListToPath()};SVGPathSegList.prototype.initialize=function(e){this._checkPathSynchronizedToList();this._list=[e];e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype._checkValidIndex=function(e){if(isNaN(e)||e<0||e>=this.numberOfItems)throw"INDEX_SIZE_ERR"};SVGPathSegList.prototype.getItem=function(e){this._checkPathSynchronizedToList();this._checkValidIndex(e);return this._list[e]};SVGPathSegList.prototype.insertItemBefore=function(e,t){this._checkPathSynchronizedToList();t>this.numberOfItems&&(t=this.numberOfItems);e._owningPathSegList&&(e=e.clone());this._list.splice(t,0,e);e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype.replaceItem=function(e,t){this._checkPathSynchronizedToList();e._owningPathSegList&&(e=e.clone());this._checkValidIndex(t);this._list[t]=e;e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype.removeItem=function(e){this._checkPathSynchronizedToList();this._checkValidIndex(e);var t=this._list[e];this._list.splice(e,1);this._writeListToPath();return t};SVGPathSegList.prototype.appendItem=function(e){this._checkPathSynchronizedToList();e._owningPathSegList&&(e=e.clone());this._list.push(e);e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList._pathSegArrayAsString=function(e){var t="",r=!0;e.forEach(function(e){if(r){r=!1;t+=e._asPathString()}else t+=" "+e._asPathString()});return t};SVGPathSegList.prototype._parsePath=function(e){if(!e||0==e.length)return[];var t=this,r=function(){this.pathSegList=[]};r.prototype.appendSegment=function(e){this.pathSegList.push(e)};var n=function(e){this._string=e;this._currentIndex=0;this._endIndex=this._string.length;this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN;this._skipOptionalSpaces()};n.prototype._isCurrentSpace=function(){var e=this._string[this._currentIndex];return e<=" "&&(" "==e||"\n"==e||"\t"==e||"\r"==e||"\f"==e)};n.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex};n.prototype._skipOptionalSpacesOrDelimiter=function(){if(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!=this._string.charAt(this._currentIndex))return!1;if(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","==this._string.charAt(this._currentIndex)){this._currentIndex++;this._skipOptionalSpaces()}return this._currentIndex<this._endIndex};n.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex};n.prototype.peekSegmentType=function(){var e=this._string[this._currentIndex];return this._pathSegTypeFromChar(e)};n.prototype._pathSegTypeFromChar=function(e){switch(e){case"Z":case"z":return SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return SVGPathSeg.PATHSEG_LINETO_REL;case"C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return SVGPathSeg.PATHSEG_ARC_ABS;case"a":return SVGPathSeg.PATHSEG_ARC_REL;case"H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}};n.prototype._nextCommandHelper=function(e,t){return("+"==e||"-"==e||"."==e||e>="0"&&e<="9")&&t!=SVGPathSeg.PATHSEG_CLOSEPATH?t==SVGPathSeg.PATHSEG_MOVETO_ABS?SVGPathSeg.PATHSEG_LINETO_ABS:t==SVGPathSeg.PATHSEG_MOVETO_REL?SVGPathSeg.PATHSEG_LINETO_REL:t:SVGPathSeg.PATHSEG_UNKNOWN};n.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return!0;var e=this.peekSegmentType();return e==SVGPathSeg.PATHSEG_MOVETO_ABS||e==SVGPathSeg.PATHSEG_MOVETO_REL};n.prototype._parseNumber=function(){var e=0,t=0,r=1,n=0,i=1,a=1,o=this._currentIndex;this._skipOptionalSpaces();if(this._currentIndex<this._endIndex&&"+"==this._string.charAt(this._currentIndex))this._currentIndex++;else if(this._currentIndex<this._endIndex&&"-"==this._string.charAt(this._currentIndex)){this._currentIndex++;i=-1}if(!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&"."!=this._string.charAt(this._currentIndex))){for(var s=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!=s)for(var c=this._currentIndex-1,l=1;c>=s;){t+=l*(this._string.charAt(c--)-"0");l*=10}if(this._currentIndex<this._endIndex&&"."==this._string.charAt(this._currentIndex)){this._currentIndex++;if(this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";){r*=10;n+=(this._string.charAt(this._currentIndex)-"0")/r;this._currentIndex+=1}}if(this._currentIndex!=o&&this._currentIndex+1<this._endIndex&&("e"==this._string.charAt(this._currentIndex)||"E"==this._string.charAt(this._currentIndex))&&"x"!=this._string.charAt(this._currentIndex+1)&&"m"!=this._string.charAt(this._currentIndex+1)){this._currentIndex++;if("+"==this._string.charAt(this._currentIndex))this._currentIndex++;else if("-"==this._string.charAt(this._currentIndex)){this._currentIndex++;a=-1}if(this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";){e*=10;e+=this._string.charAt(this._currentIndex)-"0";this._currentIndex++}}var d=t+n;d*=i;e&&(d*=Math.pow(10,a*e));if(o!=this._currentIndex){this._skipOptionalSpacesOrDelimiter();return d}}};n.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var e=!1,t=this._string.charAt(this._currentIndex++);if("0"==t)e=!1;else{if("1"!=t)return;e=!0}this._skipOptionalSpacesOrDelimiter();return e}};n.prototype.parseSegment=function(){var e=this._string[this._currentIndex],r=this._pathSegTypeFromChar(e);if(r==SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==SVGPathSeg.PATHSEG_UNKNOWN)return null;r=this._nextCommandHelper(e,this._previousCommand);if(r==SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;this._previousCommand=r;switch(r){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:this._skipOptionalSpaces();return new SVGPathSegClosePath(t);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(t,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(t,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(t,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(t,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(t,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(t,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_ARC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(t,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);case SVGPathSeg.PATHSEG_ARC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcAbs(t,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);default:throw"Unknown path seg type."}};var i=new r,a=new n(e);if(!a.initialCommandIsMoveTo())return[];for(;a.hasMoreData();){var o=a.parseSegment();if(!o)return[];i.appendSegment(o)}return i.pathSegList}}}();SVGPathElement.prototype.getPathData&&SVGPathElement.prototype.setPathData||function(){function t(e,t){var r=o(e.getAttribute("d")||"");if(t&&t.normalize){return l(c(r))}return r}function r(e,t){var r="path"===e.tagName?"d":"points";if(0===t.length)a?this.setAttribute(r,""):this.removeAttribute(r);else{for(var n="",i=0,o=t.length;i<o;i+=1){var s=t[i];i>0&&(n+=" ");n+="d"===r?s.type:"";s.values&&(n+=("d"===r?" ":"")+s.values.join(" "))}e.setAttribute(r,n)}}var n={Z:"Z",M:"M",L:"L",C:"C",Q:"Q",A:"A",H:"H",V:"V",S:"S",T:"T",z:"Z",m:"m",l:"l",c:"c",q:"q",a:"a",h:"h",v:"v",s:"s",t:"t"},i=function(e){this._string=e;this._currentIndex=0;this._endIndex=this._string.length;this._prevCommand=null;this._skipOptionalSpaces()},a=-1!==e.navigator.userAgent.indexOf("MSIE ");i.prototype={parseSegment:function(){var e=this._string[this._currentIndex],t=n[e]?n[e]:null;if(null===t){if(null===this._prevCommand)return null;t=("+"===e||"-"===e||"."===e||e>="0"&&e<="9")&&"Z"!==this._prevCommand?"M"===this._prevCommand?"L":"m"===this._prevCommand?"l":this._prevCommand:null;if(null===t)return null}else this._currentIndex+=1;this._prevCommand=t;var r=null,i=t.toUpperCase();if("H"===i||"V"===i)r=[this._parseNumber()];else if("M"===i||"L"===i||"T"===i)r=[this._parseNumber(),this._parseNumber()];else if("S"===i||"Q"===i)r=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()];else if("C"===i)r=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()];else if("A"===i)r=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseArcFlag(),this._parseArcFlag(),this._parseNumber(),this._parseNumber()];else if("Z"===i){this._skipOptionalSpaces();r=[]}return null===r||r.indexOf(null)>=0?null:{type:t,values:r}},hasMoreData:function(){return this._currentIndex<this._endIndex},peekSegmentType:function(){var e=this._string[this._currentIndex];return n[e]?n[e]:null},initialCommandIsMoveTo:function(){if(!this.hasMoreData())return!0;var e=this.peekSegmentType();return"M"===e||"m"===e},_isCurrentSpace:function(){var e=this._string[this._currentIndex];return e<=" "&&(" "===e||"\n"===e||"\t"===e||"\r"===e||"\f"===e)},_skipOptionalSpaces:function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex+=1;return this._currentIndex<this._endIndex},_skipOptionalSpacesOrDelimiter:function(){if(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!==this._string[this._currentIndex])return!1;if(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","===this._string[this._currentIndex]){this._currentIndex+=1;this._skipOptionalSpaces()}return this._currentIndex<this._endIndex},_parseNumber:function(){var e=0,t=0,r=1,n=0,i=1,a=1,o=this._currentIndex;this._skipOptionalSpaces();if(this._currentIndex<this._endIndex&&"+"===this._string[this._currentIndex])this._currentIndex+=1;else if(this._currentIndex<this._endIndex&&"-"===this._string[this._currentIndex]){this._currentIndex+=1;i=-1}if(this._currentIndex===this._endIndex||(this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")&&"."!==this._string[this._currentIndex])return null;for(var s=this._currentIndex;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";)this._currentIndex+=1;if(this._currentIndex!==s)for(var c=this._currentIndex-1,l=1;c>=s;){t+=l*(this._string[c]-"0");c-=1;l*=10}if(this._currentIndex<this._endIndex&&"."===this._string[this._currentIndex]){this._currentIndex+=1;if(this._currentIndex>=this._endIndex||this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")return null;for(;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";){n+=(this._string[this._currentIndex]-"0")*(r*=.1);this._currentIndex+=1}}if(this._currentIndex!==o&&this._currentIndex+1<this._endIndex&&("e"===this._string[this._currentIndex]||"E"===this._string[this._currentIndex])&&"x"!==this._string[this._currentIndex+1]&&"m"!==this._string[this._currentIndex+1]){this._currentIndex+=1;if("+"===this._string[this._currentIndex])this._currentIndex+=1;else if("-"===this._string[this._currentIndex]){this._currentIndex+=1;a=-1}if(this._currentIndex>=this._endIndex||this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")return null;for(;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";){e*=10;e+=this._string[this._currentIndex]-"0";this._currentIndex+=1}}var d=t+n;d*=i;e&&(d*=Math.pow(10,a*e));if(o===this._currentIndex)return null;this._skipOptionalSpacesOrDelimiter();return d},_parseArcFlag:function(){if(this._currentIndex>=this._endIndex)return null;var e=0,t=this._string[this._currentIndex];this._currentIndex+=1;if("0"===t)e=0;else{if("1"!==t)return null;e=1}this._skipOptionalSpacesOrDelimiter();return e}};var o=function(e){if(!e||0===e.length)return[];var t=new i(e),r=[];if(t.initialCommandIsMoveTo())for(;t.hasMoreData();){var n=t.parseSegment();if(null===n)break;r.push(n)}return r},s=function(e,t,r,n,i,a,o,c,l,d){var h,f,u,p,g=function(e,t,r){return{x:e*Math.cos(r)-t*Math.sin(r),y:e*Math.sin(r)+t*Math.cos(r)}},y=function(e){return Math.PI*e/180}(o),v=[];if(d){h=d[0];f=d[1];u=d[2];p=d[3]}else{var x=g(e,t,-y);e=x.x;t=x.y;var m=g(r,n,-y);r=m.x;n=m.y;var _=(e-r)/2,b=(t-n)/2,S=_*_/(i*i)+b*b/(a*a);if(S>1){S=Math.sqrt(S);i*=S;a*=S}var C;C=c===l?-1:1;var P=i*i,w=a*a,N=P*w-P*b*b-w*_*_,A=P*b*b+w*_*_,k=C*Math.sqrt(Math.abs(N/A));u=k*i*b/a+(e+r)/2;p=k*-a*_/i+(t+n)/2;h=Math.asin(((t-p)/a).toFixed(9));f=Math.asin(((n-p)/a).toFixed(9));e<u&&(h=Math.PI-h);r<u&&(f=Math.PI-f);h<0&&(h=2*Math.PI+h);f<0&&(f=2*Math.PI+f);l&&h>f&&(h-=2*Math.PI);!l&&f>h&&(f-=2*Math.PI)}var O=f-h;if(Math.abs(O)>120*Math.PI/180){var T=f,L=r,I=n;f=l&&f>h?h+120*Math.PI/180*1:h+120*Math.PI/180*-1;r=u+i*Math.cos(f);n=p+a*Math.sin(f);v=s(r,n,L,I,i,a,o,0,l,[f,T,u,p])}O=f-h;var E=Math.cos(h),M=Math.sin(h),V=Math.cos(f),B=Math.sin(f),G=Math.tan(O/4),F=4/3*i*G,R=4/3*a*G,D=[e,t],H=[e+F*M,t-R*E],j=[r+F*B,n-R*V],U=[r,n];H[0]=2*D[0]-H[0];H[1]=2*D[1]-H[1];if(d)return[H,j,U].concat(v);v=[H,j,U].concat(v).join().split(",");var z=[],X=[];v.forEach(function(e,t){t%2?X.push(g(v[t-1],v[t],y).y):X.push(g(v[t],v[t+1],y).x);if(6===X.length){z.push(X);X=[]}});return z},c=function(e){var t=[],r=null,n=null,i=null,a=null;e.forEach(function(e){var o=e.type;if("M"===o){var s=e.values[0],c=e.values[1];t.push({type:"M",values:[s,c]});i=s;a=c;r=s;n=c}else if("m"===o){var s=r+e.values[0],c=n+e.values[1];t.push({type:"M",values:[s,c]});i=s;a=c;r=s;n=c}else if("L"===o){var s=e.values[0],c=e.values[1];t.push({type:"L",values:[s,c]});r=s;n=c}else if("l"===o){var s=r+e.values[0],c=n+e.values[1];t.push({type:"L",values:[s,c]});r=s;n=c}else if("C"===o){var l=e.values[0],d=e.values[1],h=e.values[2],f=e.values[3],s=e.values[4],c=e.values[5];t.push({type:"C",values:[l,d,h,f,s,c]});r=s;n=c}else if("c"===o){var l=r+e.values[0],d=n+e.values[1],h=r+e.values[2],f=n+e.values[3],s=r+e.values[4],c=n+e.values[5];t.push({type:"C",values:[l,d,h,f,s,c]});r=s;n=c}else if("Q"===o){var l=e.values[0],d=e.values[1],s=e.values[2],c=e.values[3];t.push({type:"Q",values:[l,d,s,c]});r=s;n=c}else if("q"===o){var l=r+e.values[0],d=n+e.values[1],s=r+e.values[2],c=n+e.values[3];t.push({type:"Q",values:[l,d,s,c]});r=s;n=c}else if("A"===o){var s=e.values[5],c=e.values[6];t.push({type:"A",values:[e.values[0],e.values[1],e.values[2],e.values[3],e.values[4],s,c]});r=s;n=c}else if("a"===o){var s=r+e.values[5],c=n+e.values[6];t.push({type:"A",values:[e.values[0],e.values[1],e.values[2],e.values[3],e.values[4],s,c]});r=s;n=c}else if("H"===o){var s=e.values[0];t.push({type:"H",values:[s]});r=s}else if("h"===o){var s=r+e.values[0];t.push({type:"H",values:[s]});r=s}else if("V"===o){var c=e.values[0];t.push({type:"V",values:[c]});n=c}else if("v"===o){var c=n+e.values[0];t.push({type:"V",values:[c]});n=c}else if("S"===o){var h=e.values[0],f=e.values[1],s=e.values[2],c=e.values[3];t.push({type:"S",values:[h,f,s,c]});r=s;n=c}else if("s"===o){var h=r+e.values[0],f=n+e.values[1],s=r+e.values[2],c=n+e.values[3];t.push({type:"S",values:[h,f,s,c]});r=s;n=c}else if("T"===o){var s=e.values[0],c=e.values[1];t.push({type:"T",values:[s,c]});r=s;n=c}else if("t"===o){var s=r+e.values[0],c=n+e.values[1];t.push({type:"T",values:[s,c]});r=s;n=c}else if("Z"===o||"z"===o){t.push({type:"Z",values:[]});r=i;n=a}});return t},l=function(e){var t=[],r=null,n=null,i=null,a=null,o=null,c=null,l=null;e.forEach(function(e){if("M"===e.type){var d=e.values[0],h=e.values[1];t.push({type:"M",values:[d,h]});c=d;l=h;a=d;o=h}else if("C"===e.type){var f=e.values[0],u=e.values[1],p=e.values[2],g=e.values[3],d=e.values[4],h=e.values[5];t.push({type:"C",values:[f,u,p,g,d,h]});n=p;i=g;a=d;o=h}else if("L"===e.type){var d=e.values[0],h=e.values[1];t.push({type:"L",values:[d,h]});a=d;o=h}else if("H"===e.type){var d=e.values[0];t.push({type:"L",values:[d,o]});a=d}else if("V"===e.type){var h=e.values[0];t.push({type:"L",values:[a,h]});o=h}else if("S"===e.type){var y,v,p=e.values[0],g=e.values[1],d=e.values[2],h=e.values[3];if("C"===r||"S"===r){y=a+(a-n);v=o+(o-i)}else{y=a;v=o}t.push({type:"C",values:[y,v,p,g,d,h]});n=p;i=g;a=d;o=h}else if("T"===e.type){var f,u,d=e.values[0],h=e.values[1];if("Q"===r||"T"===r){f=a+(a-n);u=o+(o-i)}else{f=a;u=o}var y=a+2*(f-a)/3,v=o+2*(u-o)/3,x=d+2*(f-d)/3,m=h+2*(u-h)/3;t.push({type:"C",values:[y,v,x,m,d,h]});n=f;i=u;a=d;o=h}else if("Q"===e.type){var f=e.values[0],u=e.values[1],d=e.values[2],h=e.values[3],y=a+2*(f-a)/3,v=o+2*(u-o)/3,x=d+2*(f-d)/3,m=h+2*(u-h)/3;t.push({type:"C",values:[y,v,x,m,d,h]});n=f;i=u;a=d;o=h}else if("A"===e.type){var _=e.values[0],b=e.values[1],S=e.values[2],C=e.values[3],P=e.values[4],d=e.values[5],h=e.values[6];if(0===_||0===b){t.push({type:"C",values:[a,o,d,h,d,h]});a=d;o=h}else if(a!==d||o!==h){var w=s(a,o,d,h,_,b,S,C,P);w.forEach(function(e){t.push({type:"C",values:e});a=d;o=h})}}else if("Z"===e.type){t.push(e);a=c;o=l}r=e.type});return t};SVGPathElement.prototype.getPathData=function(e){return t(this,e)};SVGPathElement.prototype.setPathData=function(e){r(this,e)};SVGPolylineElement.prototype.getPathData=function(e){var r=this.getAttribute("points")||"";return t(yn("path",{d:r?"M"+r:""}),e)};SVGPolygonElement.prototype.getPathData=function(e){var r=this.getAttribute("points")||"";return t(yn("path",{d:r?"M"+r:""}),e)};SVGPolylineElement.prototype.setPathData=function(e){r(this,e)};SVGPolygonElement.prototype.setPathData=function(e){r(this,e)}}();!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error;e.prototype.name="InvalidCharacterError";t.btoa||(t.btoa=function(t){for(var n,i,a=String(t),o=0,s=r,c="";a.charAt(0|o)||(s="=",o%1);c+=s.charAt(63&n>>8-o%1*8)){i=a.charCodeAt(o+=.75);if(i>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|i}return c});t.atob||(t.atob=function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,a,o=0,s=0,c="";a=n.charAt(s++);~a&&(i=o%4?64*i+a:a,o++%4)?c+=String.fromCharCode(255&i>>(-2*o&6)):0)a=r.indexOf(a);return c})}();!function(e){var t=["concat","every","filter","forEach","includes","indexOf","lastIndexOf","map","pop","push","reduce","reduceRight","reverse","shift","slice","some","sort","splice","unshift"],r={};Array.prototype.toArray||(Array.prototype.toArray=function(){return this.slice()});for(var n=0;n<e.length;n++){e[n].toArray||(e[n].toArray=function(){return Array.prototype.slice.call(this)});for(var i=0;i<t.length;i++){var a=t[i];e[n][a]||(e[n][a]=function(e){return r[e]||(r[e]=function(){var t=this.toArray();return t[e].apply(t,arguments)})}(a))}}}([HTMLCollection.prototype,NodeList.prototype]);e.SVGElement&&!SVGElement.prototype.getTransformToElement&&(SVGElement.prototype.getTransformToElement=function(e){return e.getScreenCTM().inverse().multiply(this.getScreenCTM())});e.SVGElement&&!SVGElement.prototype.contains&&(SVGElement.prototype.contains=function(e){return(20&this.compareDocumentPosition(e))>0});!e.SVGElement||"children"in SVGElement.prototype||Object.defineProperty(SVGElement.prototype,"children",{get:function(){for(var e=this.childNodes,t=e.length,r=[],n=0;n<t;n++)1===e[n].nodeType&&r.push(e[n]);return r}});!e.SVGElement||"outerHTML"in SVGElement.prototype||Object.defineProperty(SVGElement.prototype,"outerHTML",{get:function(){var e=this,t=(new XMLSerializer).serializeToString(e);"svg"!=e.tagName&&(t=t.replace(/ xmlns="http:\/\/www\.w3\.org\/2000\/svg"/g,""));return t}});!e.SVGSVGElement||"checkEnclosure"in SVGSVGElement.prototype||Object.defineProperties(SVGSVGElement.prototype,{getIntersectionList:{get:function(e,t){return[]}},getEnclosureList:{get:function(e,t){return[]}},checkIntersection:{get:function(e,t){return!1}},checkEnclosure:{get:function(e,t){return!1}}});!function(e){e.forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),r=t.createDocumentFragment();e.forEach(function(e){var n=e instanceof Node;r.appendChild(n?e:t.createTextNode(String(e)))});this.appendChild(r)}})})}([Element.prototype,Document.prototype,DocumentFragment.prototype]);!function(){function t(e,t){return e.hasOwnProperty(t)}var r="object"==typeof localStorage;if(r)try{var n="_"+Math.random();localStorage.setItem(n,"_");localStorage.removeItem(n)}catch(e){r=!1}if(!r){var i={},a={getItem:function(e){return t(i,e)?i[e]:null},setItem:function(e,t){i[e]=String(t)},removeItem:function(e){t(i,e)&&delete i[e]},clear:function(){for(var e in i)t(i,e)&&delete i[e]}};if("object"!=typeof localStorage)e.localStorage=a;else for(var o in a)t(a,o)&&(localStorage[o]=a[o])}}();String.prototype.codePointAt||function(){"use strict";var e=function(e){if(null===this)throw TypeError();var t=String(this),r=t.length,n=e?Number(e):0;n!=n&&(n=0);if(!(n<0||n>=r)){var i,a=t.charCodeAt(n);if(a>=55296&&a<=56319&&r>n+1){i=t.charCodeAt(n+1);if(i>=56320&&i<=57343)return 1024*(a-55296)+i-56320+65536}return a}};Object.defineProperty?Object.defineProperty(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();String.fromCodePoint||function(){var e=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),t=String.fromCharCode,r=Math.floor,n=function(){var e,n,i=[],a=-1,o=arguments.length;if(!o)return"";for(var s="";++a<o;){var c=Number(arguments[a]);if(!isFinite(c)||c<0||c>1114111||r(c)!=c)throw RangeError("Invalid code point: "+c);if(c<=65535)i.push(c);else{c-=65536;e=55296+(c>>10);n=c%1024+56320;i.push(e,n)}if(a+1==o||i.length>16384){s+=t.apply(null,i);i.length=0}}return s};e?e(String,"fromCodePoint",{value:n,configurable:!0,writable:!0}):String.fromCodePoint=n}();Object.values||(Object.values=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t});"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(void 0!==i&&null!==i)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a])}return r},writable:!0,configurable:!0});!function(){function t(e,t){var r=[];t=t||4;I=[];e.forEach(function(e){r.push(new S(e[0],e[1]))});n(r,r.length,t);return I}function r(e,t){I.push(t)}function n(e,t,r){var n=new C,a=new C;n=u(e,0);a=p(e,t-1);i(e,0,t-1,n,a,r)}function i(e,t,n,s,c,l){var d,h,f,u,p,x,m=[],_=[],b=new C;p=l*l;u=n-t+1;if(2!==u){m=y(e,t,n);d=a(e,t,n,m,s,c);var S=v(e,t,n,d,m,f);h=S.maxError;f=S.splitPoint;if(h<l)r(3,d);else{if(h<p)for(x=0;x<4;x++){_=o(e,t,n,m,d);d=a(e,t,n,_,s,c);S=v(e,t,n,d,_,f);h=S.maxError;f=S.splitPoint;if(h<l){r(3,d);return}m=_}b=g(e,f);i(e,t,f,s,b,l);b=N(b);i(e,f,n,b,c,l)}}else{var P=L(e[n],e[t])/3;d=[];d[0]=e[t];d[3]=e[n];s=k(s,P);c=k(c,P);d[1]=O(d[0],s);d[2]=O(d[3],c);r(3,d)}}function a(e,t,r,n,i,a){var o,s,c,u,p,g,y,v,b=[],S=[[],[]],P=[],w=new C;v=[];s=r-t+1;for(o=0;o<s;o++){var N=new C(i.x,i.y),A=new C(a.x,a.y);N=k(N,d(n[o]));A=k(A,h(n[o]));b[o]=[];b[o][0]=N;b[o][1]=A}S[0][0]=0;S[0][1]=0;S[1][0]=0;S[1][1]=0;P[0]=0;P[1]=0;for(o=0;o<s;o++){S[0][0]+=T(b[o][0],b[o][0]);S[0][1]+=T(b[o][0],b[o][1]);S[1][0]=S[0][1];S[1][1]+=T(b[o][1],b[o][1]);w=_(e[t+o],x(m(e[t],l(n[o])),x(m(e[t],d(n[o])),x(m(e[r],h(n[o])),m(e[r],f(n[o]))))));P[0]+=T(b[o][0],w);P[1]+=T(b[o][1],w)}c=S[0][0]*S[1][1]-S[1][0]*S[0][1];u=S[0][0]*P[1]-S[1][0]*P[0];p=P[0]*S[1][1]-P[1]*S[0][1];g=0===c?0:p/c;y=0===c?0:u/c;var I=L(e[r],e[t]),E=1e-6*I;if(g<E||y<E){var M=I/3;v[0]=e[t];v[3]=e[r];v[1]=O(v[0],k(i,M));v[2]=O(v[3],k(a,M));return v}v[0]=e[t];v[3]=e[r];v[1]=O(v[0],k(i,g));v[2]=O(v[3],k(a,y));return v}function o(e,t,r,n,i){var a,o=[],c=[new S(i[0].x,i[0].y),new S(i[1].x,i[1].y),new S(i[2].x,i[2].y),new S(i[3].x,i[3].y)];for(a=t;a<=r;a++)o[a-t]=s(c,e[a],n[a-t]);return o}function s(e,t,r){var n,i,a,o,s=[new S,new S,new S],l=[new S,new S],d=new S,h=new S,f=new S,u=[new S(e[0].x,e[0].y),new S(e[1].x,e[1].y),new S(e[2].x,e[2].y),new S(e[3].x,e[3].y)],p=new S(t.x,t.y);d=c(3,u,r);for(o=0;o<=2;o++){s[o].x=3*(u[o+1].x-u[o].x);s[o].y=3*(u[o+1].y-u[o].y)}for(o=0;o<=1;o++){l[o].x=2*(s[o+1].x-s[o].x);l[o].y=2*(s[o+1].y-s[o].y)}h=c(2,s,r);f=c(1,l,r);n=(d.x-p.x)*h.x+(d.y-p.y)*h.y;i=h.x*h.x+h.y*h.y+(d.x-p.x)*f.x+(d.y-p.y)*f.y;if(0===i)return r;a=r-n/i;return a}function c(e,t,r){var n,i,a,o=[];for(n=0;n<=e;n++)o[n]=new S(t[n].x,t[n].y);for(n=1;n<=e;n++)for(i=0;i<=e-n;i++){o[i].x=(1-r)*o[i].x+r*o[i+1].x;o[i].y=(1-r)*o[i].y+r*o[i+1].y}a=new S(o[0].x,o[0].y);return a}function l(e){var t=1-e;return t*t*t}function d(e){var t=1-e;return 3*e*(t*t)}function h(e){return 3*e*e*(1-e)}function f(e){return e*e*e}function u(e,t){var r=new C;r=_(e[t+1],e[t]);r=A(r);return r}function p(e,t){var r=new C;r=_(e[t-1],e[t]);r=A(r);return r}function g(e,t){var r=new C,n=new C,i=new C;r=_(e[t-1],e[t]);n=_(e[t],e[t+1]);i.x=(r.x+n.x)/2;i.y=(r.y+n.y)/2;i=A(i);return i}function y(e,t,r){var n,i;i=[];i[0]=0;for(n=t+1;n<=r;n++)i[n-t]=i[n-t-1]+L(e[n],e[n-1]);for(n=t+1;n<=r;n++)i[n-t]=i[n-t]/i[r-t];return i}function v(e,t,r,n,i,a){var o,s,l,d=new S,h=new C;a=(r-t+1)/2;s=0;for(o=t+1;o<r;o++){d=c(3,n,i[o-t]);h=_(d,e[o]);l=P(h);if(l>=s){s=l;a=o}}return{maxError:s,splitPoint:a}}function x(e,t){var r=new C;r.x=e.x+t.x;r.y=e.y+t.y;return r}function m(e,t){var r=new C;r.x=e.x*t;r.y=e.y*t;return r}function _(e,t){var r=new C;r.x=e.x-t.x;r.y=e.y-t.y;return r}function b(e,t){this.x="number"==typeof e?e:0;this.y="number"==typeof t?t:0}function S(e,t){b.call(this,e,t)}function C(e,t){b.call(this,e,t)}function P(e){return e.x*e.x+e.y*e.y}function w(e){return Math.sqrt(P(e))}function N(e){var t=new S;t.x=-e.x;t.y=-e.y;return t}function A(e){var t=new S,r=w(e);if(0!==r){t.x=e.x/r;t.y=e.y/r}return t}function k(e,t){var r=new S,n=w(e);if(0!==n){r.x=e.x*t/n;r.y=e.y*t/n}return r}function O(e,t){var r=new S;r.x=e.x+t.x;r.y=e.y+t.y;return r}function T(e,t){return e.x*t.x+e.y*t.y}function L(e,t){var r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}var I=[];"undefined"!=typeof module?module.exports=t:e.polyline2bezier=t}();var Jn,$n="6.1.34",Kn={0:0,90:1,180:0,270:-1},qn={0:1,90:0,180:-1,270:0},Qn=[1,10,100,1e3],Zn=function(){var e="http://www.w3.org/2000/svg",t="http://www.w3.org/1999/xlink",r="http://www.w3.org/XML/1998/namespace",n="https://easyeda.com/",i={svg:e,xlink:t,xml:r,c:n};i[e]="svg";i[t]="xlink";i[r]="xml";i[n]="c";return i}(),ei=0,ti=2,ri={A4L:{W:1169,H:827},A4P:{W:827,H:1169},A3L:{W:1654,H:1169},A3P:{W:1169,H:1654},A2L:{W:2339,H:1654},A2P:{W:1654,H:2339},A1L:{W:3311,H:2339},A1P:{W:2339,H:3311}},ni=function(){var e,t={TOPLAYER:1,BOTTOMLAYER:2,TOPSILKLAYER:3,BOTTOMSILKLAYER:4,TOPPASTERLAYER:5,BOTTOMPASTERLAYER:6,TOPSOLDERLAYER:7,BOTTOMSOLDERLAYER:8,RATLINES:9,BOARDOUTLINE:10,ALL:11,DOCUMENT:12,TOPASSEMBLY:13,BOTTOMASSEMBLY:14,MECHANICAL:15,TOPCOMPONENT:16,BOTTOMCOMPONENT:17,SUBSTRATE:18};for(e=21;e<53;e++)t["INNER"+(e-20)]=e;for(e=53;e<85;e++)t["BOARD"+(e-52)]=e;return t}(),ii={SCH:"1",SCHLIB:"2",PCB:"3",PCBLIB:"4",PRJ:"5",SUBPART:"6",SPICESYMBOL:"7",SUBCKT:"8",NETLIST:"9",WAVEFORM:"10",SCHLIB3D:"11",
PHOTOVIEW:"12",SCHMODULE:"13",PCBMODULE:"14",VIEW3D:"15",PCBLIB3D:"16"},ai=function(){var e,t={};for(e in ii)t[ii[e]]=e;return t}(),oi="~",si="`",ci={src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA1MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB4PSIxIiB5PSIxIiB3aWR0aD0iNDgiIGhlaWdodD0iMzgiIGZpbGw9IiNGRkYiIHN0cm9rZT0iI0NDQyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBvbHlsaW5lIHBvaW50cz0iMS41LDIzLDE2LDEzLDM0LDI2LDQ4LjUsMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0NDQyIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iMzUiIGN5PSIxMiIgcj0iNCIgZmlsbD0iI0NDQyIgc3Ryb2tlPSJub25lIi8+PC9zdmc+",width:50,height:40},li={data:{}},di={dots:{},wires:{},junctions:{},gJsonCache:{head:{}},lastHoverWire:null},hi=t.getElementById("root"),fi=null,ui=[],pi=[],gi=[],yi="",vi="",xi={},mi={},_i={adsorbGrid:{visible:!0,gridSize:10,enabled:!0,distanceX:10,distanceY:10,altSnapSize:5},canvas:{originX:400,originY:300,strokeWidth:1,unit:"pixel",bgcolor:"#FFFFFF",fgcolor:"#000000"},colors:{}},bi={_todoList:[],_historyList:{add:[],del:[]}},mi={},Si={},Ci={_messageBarHeight:20,_paneTopPadding:30,_paneLeftPadding:70,_paneBottonPadding:35,_paneRightPadding:70,_width:null,_height:null,_paneHeight:0,isZoomViaSelectBox:!1,isDrawingSelectBox:!1},Pi={fixedDecimal:!1,decimalPlaces:2,decimalPlacesShow:2,schDecimalPlaces:2,schDecimalPlacesShow:2,pcbDecimalPlaces:4,pcbDecimalPlacesShow:3,pcbServersFonts:["NotoSerifCJKsc-Medium","NotoSansCJKjp-DemiLight"],pcbFontsRegExp:/[^!"\\#\$%&'`\(\)\*\+,\-\.\/a-zA-z0-9:<;\=\?>@\[\]\^_\{\|\}~°\s\t\r\n]/,checkNotificationInterval:12e4,checkUpdateInterval:36e5,saveFileTimeout:3e5,autoSaveMaxCount:1e3,autoSaveMaxBackupLevel:10,autoGzipAjaxPostSize:1e4,cooperationSites:["elektroda","amobbs","allaboutcircuits","diyaudio","hifidiy","edaboard"],cushionShape:null,cushionShapeFor:null,fileOperationAPI:"/EditorBridge/fileOperation",svgFileAPI:"/EditorBridge/svgFile",treeDataAPI:"/EditorBridge/treeData",anonymousPid:"441bd07389f646ac82c8d1dbc45a6021",version:"V"+$n,buildDate:"04/29/2019",lcscUUID:"0819f05c4eef4c71ace90d822a990e87",easyedaUUID:"4251c6ae97414f38bb1d929da02c4173",winWidth:e.innerWidth||t.documentElement.clientWidth,winHeight:e.innerHeight||t.documentElement.clientHeight,ignoreConfirmClose:!1,globalVariableCookieData:{},teams:[],networkWarn:"Network Error! Please check your network and try again!",updatePcbFileInfo:[],multiSelect:!1,copperNetRelation:{},isSaving:!1,pasteCount:0,pasteFrom:null,canvasStrTolerance:10,apis:{projects:{create:"/api/projects/add",my_projects:"/api/projects",common:"/api/users/0819f05c4eef4c71ace90d822a990e87/public_project",update:"/api/projects/{uuid}/update",share:"/api/projects/{uuid}/share",stick:"/api/projects/{uuid}/stick",cancelStick:"/api/projects/{uuid}/unstick",addVersion:"/api/projects/{uuid}/version",showVersion:"/api/projects/{uuid}/version",toggleVersion:"/api/projects/{uuid}/version/{newUuid}/change",sheetOrder:"api/projects/{uuid}/update_sort"},document:{create:"/api/documents/create",ajaxDetail:"/api/documents/{uuid}",schematics:"/api/projects/schematic",updateCanvas:"/api/documents/{uuid}/update_canvas",modify:"/api/documents/{uuid}/update",tag:"/api/histories/{uuid}",share:"/api/documents/{uuid}/share",duplicate:"/api/documents/{uuid}/copy",delete:"/api/documents/{uuid}/delete",simulation:"/api/documents/{uuid}/simulate",spiceNetlist:"/api/documents/{uuid}/spiceNetlist",simulatedSpice:"/api/documents/{uuid}/simulatedSpice",importThirdDocOrLibs:"/analyzer/api/convert/from/{from}/to/{to}",histories:"/api/documents/{uuid}/histories",datastrid:"/api/documents/{uuid}/datastrid"},components:{myComponents:"/api/user/component_tags",myModules:"/api/user/model_tags",ajaxLists:"/api/components",create:"/api/components/add",ajaxDetail:"/api/components/{uuid}",ajaxDetailByLcscId:"/api/products/{lcscid}/components",ajaxComponentInfo:"/api/components/componentInfo",updateCanvas:"/api/components/{uuid}/update_canvas",modify:"/api/components/{uuid}/update",delete:"/api/components/{uuid}/delete",duplicate:"/api/components/{uuid}/copy",subpart:"/api/components/{uuid}/add_subpart",contribute:"/api/components/contribute",getSubckt:"/api/components/getSubckt",updateSubckt:"/api/components/updateSubckt",search:"/api/components/search",searchByIds:"/api/components/searchByIds",searchByIdAndPre:"/api/components/searchByIdAndPre",searchPCBAndModules:"/api/components/search/PCBAndModules",packageDetail:"/api/components/packages",tags:"/api/components/tags",uuid:"/api/packages/uuid",reportError:"/api/components/{uuid}/report"},others:{bugReport:"/api/client/bugs",userInfo:"/api/user",getLcscPrice:"/api/getPrices",buyComponentFromLcsc:"/api/v1/buy",addFavorite:"/api/components/{uuid}/star",checkPackagesAvaliable:"/api/packagesExists",pcbOperate:"/api/PCB/operate",teams:"/api/teams",startPage:"/api/page/editor-start-page",versionPage:"/api/page/editor-v",notification:"/api/notifications/unread-count",getVersion:"/version",getPackageNewestTitle:"/api/components/check-different",preference:"/api/user/preference",getPcbFabricationPrice:"/api/pcb_order/{uuid}/get_price",orderAtJLCPCB:"/api/pcb_order/{uuid}/save",gerberView:"/api/pcb_order/{uuid}/gerber_view",gerberDownloadStatistic:"/api/documents/{uuid}/download_gerber",postUserBehaviorData:"/api/data/postdata",getFontPath:"/api/getFontPath",gerberDialogShow:"/api/page/editor-gerber-dialog-show"}}},wi=function(){var e=location.hostname;return e.indexOf("lceda")>-1?"lceda":(e.indexOf("easyeda"),"easyeda")}();(function(){var e=location.hostname,t=e.split(".");t.length>2&&(3!==t.length||"www"!==t[0]&&t[0])})(),t.querySelector('head meta[name="STATIC"]').getAttribute("content");r.hooks={};r.wildcardHooks={};r.registerHook=function(e,t){if("string"==typeof e)if(e.indexOf("*")>=0){var n="^"+e.replace(/\*/g,".*")+"$";r.wildcardHooks[n]=t}else r.hooks[e]=t;else if(e instanceof RegExp)r.wildcardHooks[e]=t;else for(var i in e)w(e,i)&&r.registerHook(i,e[i])};var Ni,Ai,ki,Oi,Ti,Li,Ii=n("Mac OS")>0,Ei=n("chromeframe")>0||n("x-clock")>0,Mi=(n("MSIE")>0||n("Trident")>=0)&&!Ei,Vi=Mi&&n("MSIE 9.0")>0,Bi=n("Edge/")>0,Gi=0===n("Opera/"),Fi=n("Firefox/")>0,Ri=(Fi&&navigator.userAgent.match(/Firefox\/(\d+(\.\d+)?)/)[1],n("AppleWebKit"),n("Chrome/")>0&&!Mi&&!Bi&&!Gi&&!Fi),Di=(Ri&&navigator.userAgent.match(/Chrome\/(\d+(\.\d+)?)/)[1],n("Safari/"),n("Electron/"),{getCacheObj:function(e){var t=N(J("easyeda.preferences")||J("preferences")||"{}");return t?t[e]:void 0}}),Hi={},ji={},Ui=null,zi={on:!1,targets:null,bind:!1},Xi={},Yi=t.createDocumentFragment(),Wi=1,Ji=100,$i=4;(function(){var e={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24],HOLLOWRECT:[3,4,12,13,14,15],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[5,6,3,4,1,2,7,8,10,12,13,14,15,21,22,23,24],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[5,6,3,4,1,2,7,8,10,12,13,14,15,21,22,23,24],DIMENSION:[3,4,12,13,14,15],IMAGE:[3,4,1,2,7,8,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15]};e["3D"]=function(){for(var e=[16,3,7,5,1],t=21;t<52;t++)e.push(t+32,t);e.push(2,6,8,4,17);return e}();var t,r,n;for(t in e)if(e.hasOwnProperty(t)){n=e[t];if(n.indexOf(21)>0&&-1===n.indexOf(25))for(r=25;r<=52;r++)n.push(r)}})(),function(){var e,t={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents"};for(e=21;e<53;e++)t[e]="Inner"+(e-20);for(e=53;e<85;e++)t[e]="Substrate"+(e-52)}();if(t.querySelector("#worker_main"))var Ki=new Worker(t.querySelector("#worker_main").value),qi=function(){Ki.terminate();Ki=new Worker(t.querySelector("#worker_main").value)};e.gClipboard=t.createDocumentFragment();e.easyeda={};e.callCommand=r;var Qi='<?xml version="1.0" encoding="utf-8" standalone="no"?><svg id="root" width="800" height="600" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>entry port sch</title><g c_partid="part_annotation" c_origin="0,0"><text x="0" y="0" font-family="Verdana" font-size="9pt" fill="#0000FF" text-anchor="start" type="comment">Text</text></g><g c_partid="part_pin" c_show="show" c_elec="0" c_spicepin="1" c_origin="0,0"><text x="-22" y="3" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="end" c_pinname="1">1</text><text x="-15" y="-1" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="start" c_pinnumber="1">1</text><circle c_pindot="true" class="pindot" cx="0" cy="0" r="2" fill="#4F4F4F" stroke="none" /><path d="M0,0 h-20" fill="none" stroke="#880000" stroke-width="1"/><circle cx="-17" cy="0" r="3" fill="none" stroke="#880000" stroke-width="1" display="none" /><path d="M-20,-3 L-23,0 -20,3" fill="none" stroke="#880000" stroke-width="1" display="none" /></g><g c_partid="part_junction" c_etype="pinpart" c_origin="220,200"><circle c_pindot="true" class="pindot" cx="220" cy="200" r="2" fill="#4F4F4F" stroke="none" /><circle cx="220" cy="200" r="2.5" fill="#CC0000" stroke-width="1"/></g><g c_partid="part_netLabel_text" c_etype="pinpart" c_origin="220,200"><circle c_pindot="true" class="pindot" cx="220" cy="200" r="1" fill="#ff0000" stroke="none" /><text x="222" y="197.5" font-family="Times New Roman" font-size="7pt" fill="#0000ff" text-anchor="start">netLabel?</text></g><g c_partid="part_netLabel_netPort" c_etype="pinpart" c_origin="420,310"><circle c_pindot="true" class="pindot" cx="420" cy="310" r="2" fill="#ff0000" stroke="none" /><g c_partid="part_annotation" c_shapetype="group"><text x="398.5" y="315" font-family="Times New Roman" font-size="8pt" fill="#0000FF" text-anchor="end">label?</text></g><polyline points="420 310 415 315 400 315 400 305 415 305 420 310" stroke="#0000FF" stroke-width="1" fill="none" /></g><g c_partid="part_netLabel_volProbe" c_etype="pinpart" c_origin="0,0"><circle c_pindot="true" class="pindot" cx="0" cy="0" r="2" fill="#ff0000" stroke="none" /><g c_partid="part_annotation" c_shapetype="group"><text x="13" y="-4" font-family="Times New Roman" font-size="9pt" fill="#0000FF" text-anchor="start" c_note="note_netflag">volProbe</text></g><path d="M0 0 6 -6 L 8 -10 18 -20 20 -18 10 -8 6 -6M19 -19 C 28 -29 27 -14 38 -23" stroke="#000000" stroke-width="1" fill="none" /></g><g c_partid="part_netLabel_VCC" c_etype="pinpart" c_origin="400,310"><circle c_pindot="true" class="pindot" cx="400" cy="310" r="1" fill="#4F4F4F" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text x="388" y="298" c_note="note_netflag" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start">VCC</text></g><polyline points="400 300 400 310" stroke="#000000" stroke-width="1" fill="none" /><polyline points="395 300 405 300" stroke="#000000" stroke-width="1" fill="none" /></g><g c_partid="part_netLabel_+5V" c_etype="pinpart" c_origin="400,310"><circle c_pindot="true" class="pindot" cx="400" cy="310" r="1" fill="#4F4F4F" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text c_note="note_netflag" x="390" y="298" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start">+5V</text></g><polyline points="400 300 400 310" stroke="#000000" stroke-width="1" fill="none" /><polyline points="395 300 405 300" stroke="#000000" stroke-width="1" fill="none" /></g><g c_partid="part_netLabel_-5V" c_etype="pinpart" c_origin="400,300"><circle c_pindot="true" class="pindot" cx="400" cy="300" r="1" fill="#000000" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text x="391" y="321" c_note="note_netflag" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start">-5V</text></g><polyline points="400 300 400 310" stroke="#000000" stroke-width="1" fill="none" /><polyline points="395 310 405 310" stroke="#000000" stroke-width="1" fill="none"/></g><g c_partid="part_netLabel_VEE" c_etype="pinpart" c_origin="400,300"><circle c_pindot="true" class="pindot" cx="400" cy="300" r="1" fill="#000000" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text x="388" y="321" c_note="note_netflag" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start">VEE</text></g><polyline points="400 300 400 310" stroke="#000000" stroke-width="1" fill="none" /><polyline points="395 310 405 310" stroke="#000000" stroke-width="1" fill="none"/></g><g c_partid="part_netLabel_Bar" c_etype="pinpart" c_origin="400,310"><circle c_pindot="true" class="pindot" cx="400" cy="310" r="1" fill="none" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text c_note="note_netflag" x="380" y="288" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start" dominant-baseline="central" display="">netName</text></g><path d="M 400 300 v 10" fill="none" stroke="#000000" stroke-width="1"/><ellipse cx="400" cy="297" rx="3" ry="3" stroke="#000000" stroke-width="1" fill="none" /></g><g c_partid="part_netLabel_gnD" c_etype="pinpart" c_origin="400,290"><circle c_pindot="true" class="pindot" cx="400" cy="290" r="1" fill="#4F4F4F" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text c_note="note_netflag" x="387" y="316" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start" display="">GND</text></g><polyline points="400 300 400 290" stroke="#000000" stroke-width="1" fill="none" /><polyline points="391,300 409,300" stroke="#000000" stroke-width="1" fill="none" /><polyline points="394,302 406,302" stroke="#000000" stroke-width="1" fill="none" /><polyline points="397,304 403,304" stroke="#000000" stroke-width="1" fill="none" /><polyline points="399,306 401,306" stroke="#000000" stroke-width="1" fill="none" /></g><g c_partid="part_netLabel_GnD" c_etype="pinpart" c_origin="400,290"><circle c_pindot="true" class="pindot" cx="400" cy="290" r="1" fill="#4F4F4F" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text c_note="note_netflag" x="385" y="318" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start" dominant-baseline="central" display="">GND</text></g><polyline points="400 290 400 300 395 310" stroke="#000000" stroke-width="1" fill="none" /><polyline points="385 310 390 300 410 300 405 310" stroke="#000000" stroke-width="1" fill="none" /></g><g c_partid="part_netLabel_gNd" c_etype="pinpart" c_origin="400,290"><circle c_pindot="true" class="pindot" cx="400" cy="290" r="1" fill="#4F4F4F" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text c_note="note_netflag" x="387" y="312" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start" display="">GND</text></g><rect x="390" y="300" width="20" height="1" stroke="#000000" stroke-width="1" fill="#000000" c_shapetype="line" class=""></rect><polyline points="400 290 400 300" stroke="#000000" stroke-width="1" fill="none" c_shapetype="line"></polyline></g><g c_partid="part_netLabel_GNd" c_etype="pinpart" c_origin="400,290"><circle c_pindot="true" class="pindot" cx="400" cy="290" r="1" fill="#4F4F4F" stroke="none"/><g c_partid="part_annotation" c_shapetype="group"><text c_note="note_netflag" x="387" y="315" font-family="Times New Roman" font-size="9pt" fill="#000000" text-anchor="start" display="">GND</text></g><polyline points="400 300 400 290" stroke="#000000" stroke-width="1" fill="none" /><polyline points="400 300 410 300 400 306 390 300 400 300" stroke="#000000" stroke-width="1" fill="none" /></g><g c_partid="part_busentry" c_origin="0,0"><circle c_pindot="true" class="pindot" cx="0" cy="0" r="2" fill="#4F4F4F" stroke="none" /><circle c_pindot="true" class="pindot" cx="10" cy="-10" r="2" fill="#4F4F4F" stroke="none" /><line x1="0" y1="0" x2="10" y2="-10" stroke="#008800" stroke-width="1"/></g><g c_origin="160,410" c_para="" c_partid="part_import_tmpl" id="part_import_tmpl" c_shapetype="group" c_etype="pinpart" xmlns="http://www.w3.org/2000/svg" class=""><g xmlns="http://www.w3.org/2000/svg" c_partid="part_annotation" id="tmplName"><text c_note="note_name" x="165" y="423" font-family="Times New Roman" font-size="7pt" fill="#000080" text-anchor="start">470NF</text></g><g xmlns="http://www.w3.org/2000/svg" c_partid="part_annotation" id="tmplPre"><text c_note="note_pre" x="165" y="397" font-family="Times New Roman" font-size="7pt" fill="#000080" text-anchor="start">C1</text></g></g><g c_partid="part_arrowhead" c_origin="15,0" arrowtype="3" arrowsize="15" c_rotation="0"><path d="M15,0 L0,7.5 3.75,0 0,-7.5Z" fill="#000000" stroke="none" style="shape-rendering:auto;"/></g><g c_partid="part_no_connect_flag" c_origin="0,0"><path d="M-4 -4L4 4M4 -4L-4 4" stroke="#33cc33" fill="none" stroke-width="1" style="shape-rendering:auto;"/></g></svg>';!function(){if(!e.console){var t=function(){};return{log:t,info:t,warn:t,error:t}}var r={};["log","info","warn","error"].forEach(function(t){r[t]=e.console[t].bind(e.console)})}();li.ini=li.removeOne=li.clear=li.setPreData=function(){};li.getNewPre=function(e){if(e&&(e.length||e.pre)&&(Ft(ya)||ya==ii.SCHMODULE)){return Ct("project_getNewPre",[e,!1])}return e};li.getNewPreArr=function(e,t){return e&&e.length&&(Ft(ya)||ya==ii.SCHMODULE)?Ct("project_getNewPre",[e,t]):e};li.isUsed=function(e,t){return Ct("checkPreIsUsed",[e,t])};li.checkPreDuplicate=function(e){return Ct("checkPreDuplicate",[e])};li._sortByCols=function(e,t){var r=e.x-t.x;0===r&&(r=e.y-t.y);return r};li._sortByRows=function(e,t){var r=e.y-t.y;0===r&&(r=e.x-t.x);return r};li._getPreArr=function(e){var t=di.gJsonCache.schlib,r=[];for(var n in t)if(w(t,n)){if(0===n.indexOf("frame_"))continue;var i=null;for(var a in t[n].annotation)if(w(t[n].annotation,a)&&"P"==t[n].annotation[a].mark){i=t[n].annotation[a];break}if(i){var o=(i.string||"").trim();r.push({pre:"keepOld"==e||o.indexOf("?")>=0?o:(o||"").replace(/\d+/,"?"),schlibId:n,preId:a,x:+t[n].head.x||1,y:+t[n].head.y||1})}}return r};li._setNewPre=function(e,t,r){var n=o(r);if(n){Ye(n.childNodes[0],e);n=di.gJsonCache.schlib[t].annotation[r];n.string=e}};li.annotion=function(e){if(e&&e.length){for(var t=[],r=di.gJsonCache.schlib,n=0;n<e.length;n++){var i=e[n],a=i.preId,s=i.preNew,l=i.schlibId,d=r[l],h=d&&d.annotation&&d.annotation[a];if(h&&h.string!=s){var f=o(a),u=c("#"+a+' > text[c_note="note_pre"]',f);if(!f||!f.id||!u)continue;var p=f.cloneNode(!0);Ye(u,s);var g=f.cloneNode(!0);t.push(["node",f.id,p,g]);h.string=s}}t.length&&xi.save(t);return t.length}};var Zi={uplock:!0,findPointInArr:function(e,t,r){for(var n=0,i=r?r.length:0;n<i;n++)if(r[n].x==e&&r[n].y==t)return n;return-1},findWires:function(e){if(!e||e.length<2)return!1;var t,r,n,i=e.length,a=di.getWires(),o={},s=[];for(t in a)if(w(a,t)&&a[t]){s=a[t];for(r=0;r<i;r+=2){n=Zi.findPointInArr(e[r],e[r+1],s);if(n>-1){o[t]=n;break}}}return o},deleteWires:function(e){var t=Zi.findWires(e);for(var n in t){var i=o(n);i&&l(i,"selected",!0)}r("delete")},calFollowing:function(e){var t,r,n,i,a,s,c,l,d,h,f,u=e.length,p={},g={},y=[],x={},m={},_={},b={};for(t=0;t<u;t++){a=e[t];s=v(a,"c_etype");if("wire"===s)p[a.id]=1;else if("pinpart"===s){g[a.id]=1;y.push(a)}}for(t=0,u=y.length;t<u;t++){a=y[t];c=di.getPinDots(a);n=[];i=[];for(r=1;r<c.length;r+=2){l=Zi.findWires([c[r-1],c[r]]);for(d in l)if(w(l,d))if(w(p,d))delete l[d];else if(o(d))x[d]=1;else{delete x[d];delete l[d]}n.push(l);h=Zi.findNoConnectFlags([c[r-1],c[r]]);for(f in h)if(w(h,f))if(w(g,f))delete h[f];else if(o(f))m[f]=1;else{delete m[f];delete h[f]}i.push(h)}_[a.id]=n;b[a.id]=i}return{followingMap:_,followingWireIds:x,followingMapFlag:b,followingNoConnectFlagIds:m}},moveFollowing:function(e){var t,r,n,i,s,c,l,d,h,f,u,p,g,y,x,m;for(t in e)if(w(e,t)){r=di.getPinDots(o(t));n=e[t];if(!r||!n)continue;for(d=0,h=n.length;d<h;d++){i=n[d];u=r[2*d];p=r[2*d+1];g={x:u,y:p};for(s in i)if(w(i,s)&&!aa.isLocked(o(s))){c=i[s];l=di.getWires(s);if(!l)continue;l=A(l);if(oa.isPointEqual(l[c],g));else if(l.length>=3){y=l[c];x=l[c-1];m=l[c+1];var _=null,b=null;if(x)if(x.x==y.x){c-1==0&&x.x!=u&&(_={x:x.x,y:x.y});x.x=u}else if(x.y==y.y){c-1==0&&x.y!=p&&(_={x:x.x,y:x.y});x.y=p}if(m)if(m.x==y.x){c+1===l.length-1&&m.x!=u&&(b={x:m.x,y:m.y});m.x=u}else if(m.y==y.y){c+1===l.length-1&&m.y!=p&&(b={x:m.x,y:m.y});m.y=p}y.x=u;y.y=p;b&&l.push(b);_&&l.unshift(_)}else{y=l[0];x=l[1];if(!this.uplock||y.x!=x.x&&y.y!=x.y)this.uplock=!1;else{y.x,y.y,x.x,x.y;y.x==x.x?u!=y.x&&l.splice(1,0,new a(y.x,p)):y.y==x.y&&p!=y.y&&l.splice(1,0,new a(u,y.y));l.length>2&&c>0&&c++}l[c].x=u;l[c].y=p}f=E(l);f.indexOf("NaN")>=0||v(o(s),{points:f})}}}},dragWires:function(e,t,r,n){var i=e.length;if(i<2)return!1;var a,s,c=N(n),l="",d=[];if(c)for(var h in c)if(w(c,h)&&c[h]){d=di.getWires(h);for(var f=0;f<i;f+=2){s=Zi.findPointInArr(e[f],e[f+1],d);if(s>-1){d[s].x-=-t;d[s].y-=-r;l=E(d);a=o(h);v(a,{points:l});break}}}},findNoConnectFlags:function(e){if(!e||e.length<2)return!1;var t,r,n,i=e.length,a=di.getNoConnectFlags(),o={},s=[];for(t in a)if(w(a,t)&&a[t]){s=[a[t]];for(r=0;r<i;r+=2){n=Zi.findPointInArr(e[r],e[r+1],s);n>-1&&(o[t]=n)}}return o},moveFollowingNoConnectFlags:function(e){var t,r,n,i,a,s,c,l,d,h;for(t in e)if(w(e,t)){r=di.getPinDots(o(t));n=e[t];if(!r||!n)continue;for(c=0,l=n.length;c<l;c++){i=n[c];for(a in i)if(w(i,a)){s=di.getNoConnectFlags(a);if(!s)continue;s.x=r[2*c];s.y=r[2*c+1];d=o(a);if(aa.isLocked(d))continue;noConnectFlagKeyObjChildren=d.children;v(d,{c_origin:r[2*c]+","+r[2*c+1]});if(noConnectFlagKeyObjChildren&&"path"===noConnectFlagKeyObjChildren[0].tagName){h="M "+String(r[2*c]-4)+" "+String(r[2*c+1]-4)+" L "+String(r[2*c]+4)+" "+String(r[2*c+1]+4)+" M "+String(r[2*c]+4)+" "+String(r[2*c+1]-4)+" L "+String(r[2*c]-4)+" "+String(r[2*c+1]+4);v(noConnectFlagKeyObjChildren[0],{d:h})}}}}}};ji.camelize=function(e){return e.replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()})};ji.dasherize=function(e){return e.replace(/[a-z][A-Z]/g,function(e){return e.charAt(0)+"-"+e.charAt(1).toLowerCase()})};ji.extractDocType=function(e){return"string"==typeof e?e.split(oi)[0]:e.docType};ji.json2EntitiedStr=function(e){return(JSON.stringify(e)||"").replace(/"/g,"&quot;")};ji.newId=function(){return"gge"+ ++$i};ji.toHexColor=function(e){if(/^#.{6}$/.text(e))return e.toUpperCase();if(/^#...$/.text(e))return e.replace(/[^#]/g,"$&$&").toUpperCase();if(/^rgb\((\d+).+(\d+).+(\d+)\)$/.text(e)){e="#"+(+RegExp.$1+256).toString(16)+(+RegExp.$2+256).toString(16)+(+RegExp.$3+256).toString(16);return e.replace(/1(..)/g,"$1").toUpperCase()}return e};ji.isValidImageURL=function(e){return e&&(/^(https?:)?\/\/[\w.-]+\/[^\s#?"]+\.(jpg|jpeg|png|gif|svg)$/i.test(e)||/^data:image\/(jpeg|png|gif|svg\+xml);base64,/.test(e)||/^\/assets\/static\/images\//.test(e))};ji.numberlistToArray=function(e,t){if(!e)return[];var r,n=e.trim().split(t||/[\s,]+/g);for(r=0;r<n.length;r++)n[r]=+n[r];return n};ji.extend=function(){var e,t=0,r=arguments,n=r.length,i=!1;if(n<1)return{};if("boolean"==typeof r[0]){i=r[0];e=r[1];t=1}else if("boolean"==typeof r[n-1]){i=r[n-1];e=r[0];n--}else e=r[0];(!e||"object"!=typeof e&&"function"!=typeof e)&&(e={});for(;t<n;t++){var a=r[t];if(a&&"object"==typeof a){if(a==e)continue;for(var o in a)w(a,o)&&(i&&a[o]&&"object"==typeof a[o]?e[o]=ji.extend({},a[o]):e[o]=a[o])}}return e};ji.cloneJSON=function(e){return e&&"object"==typeof e?N(JSON.stringify(e)):e};ji.getVendorProperty=function(e,t){if(w(e,t))return e[t];var r=t.charAt(0).toUpperCase()+t.substr(1);return e["webkit"+r]||e["moz"+r]||e["o"+r]||e["ms"+r]};ji.getErrorInfo=function(t){var r="",n=navigator,i=t.stack||t.error&&t.error.stack;"object"==typeof Pi&&(r+="#build: "+Pi.version+", "+Pi.buildDate+";\n");var a=q();a&&(r+="#browser: "+a+";\n");r+="#userAgent: "+n.userAgent+";\n";n.platform&&(r+="#platform: "+n.platform+";\n");n.language&&(r+="#language: "+n.language+";");n.languages&&(r+=" langs:"+n.languages+";");n.systemLanguage&&(r+=" sysLang:"+n.systemLanguage+";");n.userLanguage&&(r+=" userLang:"+n.userLanguage+";");n.browserLanguage&&(r+=" browserLang:"+n.browserLanguage+";");r+="\n";"object"==typeof Locale&&Locale&&Locale._curr&&(r+="#Locale._curr: "+Locale._curr+";\n");var o=location.protocol+"//"+location.host;r+="#location: "+location.href.replace(o,"")+";\n";try{if(e!=top)r+="#top.location: "+top.location.href.replace(o,"")+";\n";else{var s=$("#tabbar_bodies .editframe").toArray();s.length&&(r+="#iframes: "+s.map(function(e){return e.getAttribute("src")}).join("  ")+"\n")}}catch(e){}r+="#tostring: "+t.toString()+";\n";t.toString()!=Object.prototype.toString.call(t)&&(r+="#tostring2: "+Object.prototype.toString.call(t)+";\n");t.type&&(r+="#type: "+t.type+";\n");var c=t.filename||t.fileName||t.error&&t.error.filename||t.error&&t.error.fileName||"";c=c.replace(/[^#?]+\//,"");var l=t.lineno||t.lineNumber||t.error&&t.error.lineno||t.error&&t.error.lineNumber||"",d=t.colno||t.columnNumber||t.error&&t.error.colno||t.error&&t.error.columnNumber||"";if(!c&&i)if(i.match(/\/([^\/]+):(\d+):(\d+)\)/)){c=RegExp.$1;l=RegExp.$2;d=RegExp.$3}else if(i.match(/\/([^\/]+):(\d+)\)/)){c=RegExp.$1;l=RegExp.$2}r+="#file: "+c+"; #line:"+l+"; #col:"+d+";\n";t.message?r+="#message: "+t.message+";\n":t.description?r+="#message: "+t.description+";\n":t.error&&t.error.message?r+="#message: "+t.error.message+";\n":t.error&&t.error.description&&(r+="#message: "+t.error.description+";\n");if(i){o=o.replace(/[\/:]/g,"\\$&");i=i.replace(new RegExp(o,"g"),"");i=i.replace(/\n(\S)/g,"\n  $1");r+="#stack: "+i+";\n";if(i.indexOf("this.get(...).querySelectorAll")>0){if(!top._querySelectorAll_err&&top.$&&top.$.messager&&top.$.messager.error){top._querySelectorAll_err=1;setTimeout(function(){"function"==typeof notifyReportBug?notifyReportBug():Ct("notifyReportBug")},500)}for(var h=[[Element,"Element","innerHTML","__INNERHTML_DESCRIPTOR"],[Node,"Node","textContent","__TEXTCONTENT_DESCRIPTOR"]],f=0;f<h.length;f++){var u=h[f],p=u[1],g=u[2],y=e[u[3]];if(y)try{var v,x;v=Object.getOwnPropertyDescriptor(u.prototype,g);if(!v||v.set!=y.set){x={}.toString.call(v.set);r+="-----------------------\n"+p+" "+g+" set was overide:\n"+x+"\n";x.indexOf("[native code]")<0&&Object.defineProperty(u.prototype,g,y)}}catch(e){}}}}return{detail:r,file:c,lineno:l,colno:d}};ji.submitJsError=function(e){try{if(!(e&&e.file&&e.lineno&&e.colno))return;if(e.detail.indexOf("https://embed.tawk.to/")>0)return;var t=e.detail.match(/#file:.+\n#message:.+\n#stack:.*\n.*(?:\n.*)?/);t||(t=e.detail.match(/#file:.+\n#message:.+/));if(!t||!t[0])return;e.key=MD5(t[0]);errKeys||(errKeys={});if(w(errKeys,e.key))return;var r={};$.extend(r,{keyId:e.key,file:e.file,detail:e.detail});$.extend(r,{locale:Locale._curr,build:Pi.version+","+Pi.buildDate,login:0|isLogined()});$.extend(r,ji.getEnvInfo());$.postJSON({url:Pi.apis.others.bugReport,data:{bugInfo:JSON.stringify(r)},timeout:6e4}).then(function(e){e&&e.success})}catch(e){}};ji.reportError=function(e){if(e&&"object"==typeof e)try{var t=ji.getErrorInfo(e);t.file&&t.lineno&&t.colno&&(void 0!==Ct?Ct("triggerEvent",["error",t]):ji.submitJsError(t))}catch(e){}};ji.getEnvInfo=function(){var r=navigator,n=r.userAgent.replace(/Mozilla\/\S*|AppleWebKit\/\S*|KHTML, like Gecko|/,""),i=t.body,a={os:[["Windows 10",/Windows NT (?:10\.|6\.4)/],["Windows 8.1",/Windows (?:8\.1|NT 6\.3)/],["Windows 8",/Windows (?:8|NT 6\.2)/],["Windows 7",/Windows (?:7|NT 6\.1)/],["Windows Phone",/Windows Phone/],["$1",/((?:Windows (?:NT )?|WinNT) \d+\.?\d*)/],["Mac OS",/Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh/],["$&",/iPhone|iPad|iPod|OpenBSD|FreeBSD|Ubuntu|Linux|Unix|BlackBerry|OS\/2|Android/]],browser:[["IEMobile $1",/ IEMobile\/(\d+)/],["IE 11",/Edge\/12|Trident\/7.* rv:11/],["IE 10",/MSIE 10|Trident\/6/],["IE 9",/MSIE 9|Trident\/5/],["IE $1",/MSIE (\d+)/],["Firefox $1",/Firefox\/(\d+)/],["Opera $1",/Opera\/.*Version\/(\d+)/],["Chrome $1",/Chrome\/(\d+)/],["Safari $1",/Version\/(\d+).* Safari/,/Android/]]},o={platform:r.platform||"",language:r.language||r.userLanguage||"",os:"other",browser:"other",screen:{width:screen.width,height:screen.height,devicePixelRatio:e.devicePixelRatio||1,touch:0|("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)},features:{applicationCache:0|!!e.applicationCache,IndexedDB:0|!!ji.getVendorProperty(e,"indexedDB"),FileSystem:0|!!ji.getVendorProperty(e,"requestFileSystem"),WebWorker:0|!!e.Worker,history:"pushState"in e.history|0,hashchange:"onhashchange"in e|0,draganddrop:0|("draggable"in i||"ondragstart"in i&&"ondrop"in i)}};a.os.some(function(e){var t,r=e[0],i=e[1],a=e[2];if(t=n.match(i)){r=r.indexOf("$")<0?r:"$&"==r?t[0]:r.replace("$1",t[1]);if(!a||!a.test(n)){o.os=r;return!0}}});a.browser.some(function(e){var t,r=e[0],i=e[1],a=e[2];if(t=n.match(i)){r=r.indexOf("$")<0?r:"$&"==r?t[0]:r.replace("$1",t[1]);if(!a||!a.test(n)){o.browser=r;return!0}}});return o};ji.c_paraToJson=function(e){if(!e)return{};if("string"!=typeof e)return e;for(var t=e.split(si),r={},n=0,i=t.length-1;n<i;n+=2)t[n]&&(r[z(t[n])]=z(F(t[n+1]||"")));return r};ji.jsonToC_para=function(e){var t="";if("string"==typeof e)return e;for(var r in e)if(r&&w(e,r)&&0!==r.indexOf("attr-")){var n=""+e[r];t+=U(r)+si+U(n)+si}return t};ji.sortC_paraJson=function(e){var t=["name","package","Package Display","pre","BOM_Supplier","BOM_Supplier Part","BOM_Manufacturer","BOM_Manufacturer Part"],r=["Contributor"],n={};t.forEach(function(t){w(e,t)&&(n[t]=e[t])});for(var i in e)w(e,i)&&-1===t.indexOf(i)&&-1===r.indexOf(i)&&(n[i]=e[i]);r.forEach(function(t){w(e,t)&&(n[t]=e[t])});return n};ji.getSCHCmdKey=function(e){if(!e||!e.tagName||e==Jn||e.contains(Jn))return"";var t=Je(e);if("object"!=typeof t)return"";var r=t.c_partid,n=function(e){return e?0===e.indexOf("part_annotation")?"annotation":0===e.indexOf("part_pin")?"pin":0===e.indexOf("part_junction")?"junction":0===e.indexOf("part_busentry")?"busentry":0===e.indexOf("part_netLabel_text")?"netlabel":0===e.indexOf("part_netLabel_")?"netflag":0===e.indexOf("part_import_")?"schlib":0===e.indexOf("part_arrowhead")?"arrowhead":0===e.indexOf("part_no_connect_flag")?"noconnectflag":0===e.indexOf("part_svg")?"svgnode":0===e.indexOf("part_image")?"pimage":"":""}(r);if(n)return n;var i=e.tagName;if("polyline"==i&&"wire"==t.c_etype)n="wire";else if("polyline"==i&&"bus"==t.c_etype)n="bus";else{n=i||"";"path"==n&&(n="arc1"==t.c_helper_type||"pie1"==t.c_helper_type?"arc":"path")}return n.toLowerCase()};ji.getPCBCmdKey=function(e){if(!e||!e.tagName||e==Jn||e.contains(Jn))return"";var t=e.tagName,r=v(e,"c_partid")||"",n="";switch(t){case"g":if(!e.childNodes.length)return"";switch(r){case"part_pad":n="PAD";break;case"part_via":n="VIA";break;case"part_hole":n="HOLE";break;case"part_pcbtext":n="TEXT";break;case"part_svg":n="SVGNODE";break;case"part_plane":n="PLANEZONE";break;case"":e.id&&e.id.match(/^layer_/)||(n="SVGNODE");break;default:n=0===r.indexOf("part_import_")?"FOOTPRINT":""}break;case"polyline":n="TRACK";break;case"path":v(e,"attachedcopperid")?n="":-1!=["cutout","npth","solid"].indexOf(v(e,"type"))?n="SOLIDREGION":v(e,"thermal")&&v(e,"keepIsland")&&v(e,"copper")?n="COPPERAREA":"group"==v(e,"c_shapetype")?n="DIMENSION":"protractor"==v(e,"c_shapetype")?n="PROTRACTOR":"none"!=v(e,"stroke")||v(e,"fill")?(v(e,"d")||"").indexOf("A")>0&&(n="ARC"):n="SVGNODE";break;case"line":n="RATLINE";break;case"rect":n="RECT";break;case"circle":n="CIRCLE";break;case"text":n="SVGNODE";break;default:n=(t||"").toUpperCase();w(ga,n)||(n=t.match(/^(ellipse|image|a)$/)?"SVGNODE":"")}return n};ji.createPolylineForOvalPad=function(e,t,r,n,i){e=+e;t=+t;r=+r;n=+n;i=i||0;i=+i;var o=new a(0,0),s=new a(0,0),c=0,l=(r>n?n:r)/2;if(r<n){o.x=s.x=e;c=n/2-l;o.y=t-c;s.y=t+c}else{o.y=s.y=t;c=r/2-l;o.x=e-c;s.x=e+c}var d=[o.x,o.y,s.x,s.y];d=ye(d,(360-i)%360,e,t);return d};ji.convertRect2Polygon=function(e,t,r,n){return[+e,+t,+e+r,+t,+e+r,+t+n,+e,+t+n]};ji.Dots={eachAdd:function(e,t,r){var n
;for(n=0;n<e.length-1;n+=2){e[n]+=t;e[n+1]+=r}return e}};ji.units={decimals:{pixel:2,mil:3,mm:3,inch:3},isUnit:function(e){return/^(pixel|mil|mm|inch)$/i.test(e)},changeElementsUnit:function(e,t,r){if(t!=r&&ji.units.isUnit(t)&&ji.units.isUnit(r))for(var n,i,a,o=0;o<e.length;o++){n=e[o].getAttribute("oldval")||e[o].value.toLowerCase();a=n.replace(/\D+$/,"");if(a&&isFinite(a)){i=ji.units.convert(+a,t,r);e[o].value=ji.formatLengthShow(i)+r;e[o].setAttribute("oldval",i+r)}}},convert:function(e,t,r){if(t==r)return 1*e;if("string"==typeof e){if(2==arguments.length){r=t;t=e.replace(/^[-+.\d\s]+/,"");e=e.replace(/[^-+.\d\s]+$/,"")}e=+e}if("number"!=typeof e||!isFinite(e))throw Error("Invalid value for unit convert");t=t.toLowerCase();r=r.toLowerCase();if("cm"==t){t="mm";e*=10}else"px"==t&&(t="pixel");if("cm"==r){r="mm";e*=.1}else"px"==r&&(r="pixel");if(t==r)return 1*e;if(!ji.units.isUnit(t)||!ji.units.isUnit(r))throw Error("Not supported unit convert "+t+" to "+r);switch(t+"2"+r){case"mil2pixel":return.1*e;case"mil2mm":return.0254*e;case"mil2inch":return.001*e;case"mm2pixel":return e/.254;case"mm2mil":return e/.0254;case"mm2inch":return e/25.4;case"pixel2mil":return 10*e;case"pixel2mm":return.254*e;case"pixel2inch":return.01*e;case"inch2pixel":return 100*e;case"inch2mil":return 1e3*e;case"inch2mm":return 25.4*e}throw Error("Not supported unit convert "+t+" to "+r)}};ji.formatDate=function(e,t){if(e&&"[object Date]"==Object.prototype.toString.call(e)){var r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));/(Z+)/.test(t)&&(t=t.replace(RegExp.$1,function(e,t){var r=15*-Math.round(e.getTimezoneOffset()/15),n=~~(r/60),i=~~r%60,a="+";r<0&&(a="-");return a+("00"+n).substr((""+n).length)+t+("00"+i).substr((""+i).length)}(e,1==RegExp.$1.length?":":"")));for(var n in r)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return t}};ji.formatLengthShow=function(e,t){t=t||Pi;return ji.toFixed(e,t.decimalPlacesShow,t.fixedDecimal)};ji.formatLengthSave=function(e,t){t=t&&"number"==typeof t.decimalPlaces?t:Pi;return ji.toFixed(e,t.decimalPlaces)};a.prototype={toString:function(){return ji.toFixed(this.x,4)+"_"+ji.toFixed(this.y,4)}};ji.arc={c_helper_lines:[{type:"path_arc"},{from:0,to:1},{type:"rect_center_corner",center:0,corner:1},{from:0,to:2,ray:1},{from:0,to:3,ray:1}],c_helper_lines_pie1:[{type:"path_arc"},{from:0,to:1},{type:"rect_center_corner",center:0,corner:1},{from:2,to:0,ray:-1},{from:3,to:0,ray:-1}],getDotByAngle:function(e,t,r){var n=Math.PI,i=.5*n,a=n+n;r%=a;r<0&&(r+=a);if(0===r)return{x:e,y:0};if(r==i)return{x:0,y:t};if(r==n)return{x:-e,y:0};if(r==1.5*n)return{x:0,y:-t};var o=Math.tan(r),s=Math.sqrt(1/(1/(e*e)+o*o/(t*t)));r>i&&r<1.5*n&&(s=-s);var c=s?s*o:r<n?t:-t;r>n!=c<0&&(c=-c);return{x:s,y:c}},getAngle:function(e,t){if(0===e&&0===t)return null;var r=Math.atan2(t,e);return r<0?r+Math.PI+Math.PI:r},getArcParams:function(e,t,r,n,i,a,o,s){var c={fa:1,fs:0,angle:0},l=ji.arc.getAngle(i-e,a-t),d=ji.arc.getAngle(o-e,s-t);if(null===l||null===d)return null;var h=ji.arc.getDotByAngle(r,n,l),f=ji.arc.getDotByAngle(r,n,d);c.x1=e+h.x;c.y1=t+h.y;c.x2=e+f.x;c.y2=t+f.y;c.a1=l;c.a2=d;var u=Math.PI,p=u+u,g=(d<l?p:0)+d-l;c.fa=g>=u?1:0;c.fs=1;return c},getArcParamsByCRA:function(e,t,r,n,i,a,o){var s={angle:0,fa:1,fs:0},c=ji.arc.getDotByAngle(r,n,i),l=ji.arc.getDotByAngle(r,n,a);s.x1=e+c.x;s.y1=t+c.y;s.x2=e+l.x;s.y2=t+l.y;s.rx=r;s.ry=n;var d=Math.PI,h=d+d,f=(a-i)%h;f<0&&(f+=h);s.fs=o?1:0;s.fa=o?f>=d?1:0:f>=d?0:1;return s},convertSvgParam2CanvasParam:function(e){e=F(e.replace(/[^0-9\., \-]/gi," "));var t=e.split(/[ ,]+/g);return 9!==t.length?null:ji.arc.getCenterParam(+t[0],+t[1],+t[7],+t[8],+t[5],+t[6],+t[2],+t[3],+t[4])||null},getCenterParam:function(e,t,r,n,i,a,o,s,c){function l(e,t,r,n){var i=e*r+t*n,a=Math.sqrt((e*e+t*t)*(r*r+n*n)),o=Math.acos(i/a);e*n-t*r<0&&(o=-o);return o}function d(e){for(;e>=y;)e-=y;for(;e<0;)e+=y;return e}function h(e){e.rx=o;e.ry=s;e.startAngle=e.theta1;e.endAngle=d(e.theta1+e.delta_theta);return e}var f,u,p,g,y=2*Math.PI;o<0&&(o=-o);s<0&&(s=-s);o==s&&(c=0);var v=Math.sin(c),x=Math.cos(c),m=(e-r)/2,_=(t-n)/2,b=(e+r)/2,S=(t+n)/2;if(o<1e-5||s<1e-5){p=l(1,0,r-e,n-t);return h({cx:b,cy:S,theta1:p,delta_theta:Math.PI})}var C=x*m+v*_,P=x*_-v*m,w=C*C/(o*o)+P*P/(s*s);if(w>1){o*=Math.sqrt(w);s*=Math.sqrt(w)}var N=o*s,A=o*P,k=s*C,O=A*A+k*k;if(!O)return h({cx:b,cy:S,theta1:0,delta_theta:0});var T=(N*N-O)/O;T=Math.sqrt(Math.abs(T));i==a&&(T=-T);var L=T*A/s,I=-T*k/o;f=x*L-v*I+b;u=v*L+x*I+S;var E=(C-L)/o,M=(C+L)/o,V=(P-I)/s,B=(P+I)/s;p=l(1,0,E,V);g=l(E,V,-M,-B);for(;g>y;)g-=y;for(;g<0;)g+=y;!1!==a&&0!==a||(g-=y);return h({cx:f,cy:u,theta1:p,delta_theta:g})},calculateArcHelperDots:function(e){var t,r,n,i,a,o,s,c,l,d,h,f=e.pathSegList,u=f.numberOfItems,p=u>0&&f.getItem(0),g=u>1&&f.getItem(1),y=u>2&&f.getItem(2);if(u<2)return[];if(2==u&&"A"==g.pathSegTypeAsLetter){h=g;t=p.x;r=p.y}else{if(!(u>=3&&"L"==g.pathSegTypeAsLetter&&"A"==y.pathSegTypeAsLetter))return[];h=y;t=g.x;r=g.y}n=h.x,i=h.y,a=h.largeArcFlag,o=h.sweepFlag,s=h.r1,c=h.r2,l=h.angle,d=l*Math.PI/180;var v=ji.arc.getCenterParam(t,r,n,i,a,o,s,c,d),x=ji.toFixed(v.cx,2),m=ji.toFixed(v.cy,2),_=l%180==90||l%180==-90,b=x+(_?c:s),S=m+(_?s:c),C=[x,m,b,S,t,r,n,i];C.path_arc=["M"+t,r+"A"+s,c,l,1-a,1-o,n,i].join(" ");return C},getArcParamsBy3Points:function(e,t,r,n,i,a){function o(e,t,r){var n=Math.acos(e/r);return t>=0?n:2*Math.PI-n}var s=r-e,c=i-e,l=n-t,d=a-t,h=e*e,f=r*r,u=i*i,p=t*t,g=n*n,y=a*a,v=(l*(y-p+u-h)-d*(g-p+f-h))/(2*c*l-2*s*d),x=(s*(u-h+y-p)-c*(f-h+g-p))/(2*d*s-2*l*c);if(isFinite(v)&&isFinite(x)){var m=Math.sqrt((e-v)*(e-v)+(t-x)*(t-x)),_=[e-i,t-a],b=[r-i,n-a],S=_[0]*b[0]+_[1]*b[1],C=S<0?0:1,P=o(e-v,t-x,m),w=o(r-v,n-x,m),N=o(i-v,a-x,m),A=0;N>P?(w>N||w<P)&&(A=1):w>N&&w<P&&(A=1);return{r1:m,r2:m,angle:0,largeArcFlag:C,sweepFlag:A,x:r,y:n,cx:v,cy:x}}},getCenterPoint:function(e,t,r,n,i,a,o,s,c){var l=ji.arc.getCenterParam(e,t,r,n,i,a,o,s,c);return{x:l.cx,y:l.cy}}};ji.fileType={getIcon:function(e){var t="";switch(e+""){case ii.SCH:case ii.SCHMODULE:t="icon-eda-sch";break;case ii.SCHLIB:case ii.SUBPART:t="icon-eda-eelib";break;case ii.PCB:case ii.PCBMODULE:t="icon-eda-pcb";break;case ii.PCBLIB:t="icon-pcblib";break;case ii.SPICESYMBOL:t="icon-spicesymbol";break;case ii.SUBCKT:t="icon-subckt";break;case ii.WAVEFORM:t="icon-waveform";break;case ii.PHOTOVIEW:t="icon-eda-pcb";break;case ii.PRJ:t="icon-prj";break;case ii.PCBLIB3D:t="icon-3d"}return t},getNewTitle:function(e){var t="New";switch(e+""){case ii.PRJ:t="New Project";break;case ii.SCH:case ii.SUBCKT:t="Sheet";break;case ii.SCHMODULE:t="New Schematic Module";break;case ii.SUBCKT:t="Sheet";break;case ii.SCHLIB:t="New Schematic Lib";break;case ii.SPICESYMBOL:t="New_Spice_Symbol";break;case ii.PCB:t="NEW_PCB";break;case ii.PCBMODULE:t="New PCB Module";break;case ii.PCBLIB:t="NEWPCBLIB";break;case ii.WAVEFORM:t="WaveForm";break;case ii.PHOTOVIEW:t=Locale.i18n("Photo View");break;case ii.VIEW3D:t=Locale.i18n("3D View")}return t},getSaveAsDlgTitle:function(e){var t="Save as";switch(e+""){case ii.PRJ:t="Save as a new project";break;case ii.SCH:t="Save as a schematic";break;case ii.SCHLIB:t="Save as a schematic Lib";break;case ii.SPICESYMBOL:t="Save as a spice Symbol";break;case ii.SUBCKT:t="Save as a spice subckt";break;case ii.PCB:t="Save as a PCB file";break;case ii.PCBLIB:t="Save as a PCB Lib";break;case ii.PHOTOVIEW:t="Save as a Photo View";break;case ii.WAVEFORM:t="Save as a WaveForm";break;case ii.SCHMODULE:t="Save as a Schematic Module";break;case ii.PCBMODULE:t="Save as a PCB Module"}return t},getAbstractFileType:function(e){switch(e+""){case ii.SCH:case ii.SUBCKT:case ii.SCHMODULE:return"sch";case ii.SCHLIB:case ii.SUBPART:case ii.SPICESYMBOL:return"schlib";case ii.PCB:case ii.PCBMODULE:return"pcb";case ii.PCBLIB:return"pcblib";case ii.WAVEFORM:return"waveform";case ii.PHOTOVIEW:return"photoview";case ii.VIEW3D:return"3Dview";default:return}},mergeFileType:function(e){return e==ii.PCB||e==ii.PCBLIB||e==ii.PHOTOVIEW?"pcb_pcblib":"sch_schlib_waveform"},isLib:function(e){var t=ji.fileType.getAbstractFileType(e);return"schlib"==t||"pcblib"==t},isModule:function(e){return e==ii.SCHMODULE||e==ii.PCBMODULE},isComponent:function(e){return ji.fileType.isLib(e)||ji.fileType.isModule(e)},isDocument:function(e){return Ft(e)||e==ii.PCB||e==ii.WAVEFORM},getApi:function(e,t){var r;switch(e+""){case ii.PRJ:r=Pi.apis.projects;break;case ii.SCH:case ii.SUBCKT:case ii.PCB:case ii.WAVEFORM:r=Pi.apis.document;break;case ii.SCHLIB:case ii.SUBPART:case ii.SPICESYMBOL:case ii.SCHMODULE:case ii.PCBMODULE:case ii.PCBLIB:case ii.PCBLIB3D:r=Pi.apis.components;break;case ii.PHOTOVIEW:}if(r&&!t)return r;if(!r||!t||!r[t])throw Error("No such api");return r[t]},needProject:function(e){return Ft(e)||e==ii.PCB||e==ii.WAVEFORM}};ji.toFixed=function(e,t,r){"number"!=typeof e&&(e=+e);if(isNaN(e))return NaN;t|=0;if(t<=0||!e&&!r)return Math.round(e);var n=Qn[t]||Math.pow(10,t)||10;if(r){var i=e<0?"-":"";e=e<0?-e:e;e=Math.round(e*n)+"";for(;e.length<=t;)e="0"+e;e=e.slice(0,-t)+"."+e.slice(-t);return i+e}return Math.round(e*n+1e-10)/n};ji.fixLongNumberString=function(e,t){if(!e||"string"!=typeof e)return"";var r=/\d+\.\d{12,}/g,n=Qn[t]||Math.pow(10,t)||10;return e.replace(r,function(e){return Math.round(e*n+1e-10)/n})};ji.isDotInRect=function(e,t,r){return 3==arguments.length?e>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height:ji.isDotInRect(e.x,e.y,t)};ji.isDotInArea=function(e,t,r,n,i,a){if(r>i){var o=r;r=i;i=o}if(n>a){var s=n;n=a;a=s}return e>=r&&e<=i&&t>=n&&t<=a};ji.bbox2Polygon=function(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]};ji.isRectInRect=function(e,t){return ji.isDotInRect(e.x,e.y,t)&&ji.isDotInRect(e.x+e.width,e.y,t)&&ji.isDotInRect(e.x,e.y+e.height,t)&&ji.isDotInRect(e.x+e.width,e.y+e.height,t)};ji.combineBox=function(e,t){var r=Math.max(e.x+e.width,t.x+t.width),n=Math.max(e.y+e.height,t.y+t.height),i=Math.min(e.x,t.x),a=Math.min(e.y,t.y);return{x:i,y:a,width:r-i,height:n-a}};ji.combineMultiBox=function(e){if(G(e)){for(var t=[],r=[],n=[],i=[],a=0;a<e.length;a++){t.push(e[a].x+e[a].width);r.push(e[a].y+e[a].height);n.push(e[a].x);i.push(e[a].y)}var o=Math.max.apply(null,t),s=Math.max.apply(null,r),c=Math.min.apply(null,n),l=Math.min.apply(null,i);return{x:c,y:l,width:o-c,height:s-l}}};ji.isRectTouchRect=function(e,t){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y};ji.isPolylineTouchRect=function(e,t){for(var r=e.points,n=r.length||r.numberOfItems,i=0;i<n;i++)if(ji.isDotInRect(r.getItem(i).x,r.getItem(i).y,t))return!0;var a,o,s,c,l,d,h,f,u={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};for(i=1;i<n;i++){a={x1:r.getItem(i-1).x,y1:r.getItem(i-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y};o=a.x2-a.x1;s=a.y2-a.y1;c={};if(o>0){c.x1=a.x1;c.x2=a.x2}else{c.x1=a.x2;c.x2=a.x1}if(s>0){c.y1=a.y1;c.y2=a.y2}else{c.y1=a.y2;c.y2=a.y1}if(!(c.x1>u.x2||c.x2<u.x1||c.y1>u.y2||c.y2<u.y1)){l=s*(u.x1-a.x1)-o*(u.y1-a.y1);d=s*(u.x1-a.x1)-o*(u.y2-a.y1);h=s*(u.x2-a.x1)-o*(u.y1-a.y1);f=s*(u.x2-a.x1)-o*(u.y2-a.y1);if(!(l>0&&d>0&&h>0&&f>0||l<0&&d<0&&h<0&&f<0))return!0}}return!1};ji.isPolygonTouchRect=function(e,t){for(var r=e.points,n=r.length||r.numberOfItems,i=0;i<n;i++)if(ji.isDotInRect(r.getItem(i).x,r.getItem(i).y,t))return!0;var a,o,s,c,l,d,h,f,u={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};for(i=0;i<n;i++){a=0===i?{x1:r.getItem(n-1).x,y1:r.getItem(n-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y}:{x1:r.getItem(i-1).x,y1:r.getItem(i-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y};o=a.x2-a.x1;s=a.y2-a.y1;c={};if(o>0){c.x1=a.x1;c.x2=a.x2}else{c.x1=a.x2;c.x2=a.x1}if(s>0){c.y1=a.y1;c.y2=a.y2}else{c.y1=a.y2;c.y2=a.y1}if(!(c.x1>u.x2||c.x2<u.x1||c.y1>u.y2||c.y2<u.y1)){l=s*(u.x1-a.x1)-o*(u.y1-a.y1);d=s*(u.x1-a.x1)-o*(u.y2-a.y1);h=s*(u.x2-a.x1)-o*(u.y1-a.y1);f=s*(u.x2-a.x1)-o*(u.y2-a.y1);if(!(l>0&&d>0&&h>0&&f>0||l<0&&d<0&&h<0&&f<0))return!0}}return!1};ji.svg={getRefPoint:function(e){var t;switch(e&&e.tagName){case"path":var r=e.pathSegList.getItem(0);r&&"M"==r.pathSegTypeAsLetter&&(t=[r.x,r.y]);break;case"svg":case"text":case"rect":case"image":t=[+v(e,"x"),+v(e,"y")];break;case"circle":case"ellipse":t=[+v(e,"cx"),+v(e,"cy")];break;case"line":t=[+v(e,"x1"),+v(e,"y1")];break;case"polygon":case"polyline":var n=e.points.getItem(0);n&&(t=[n.x,n.y]);break;case"g":var i=v(e,"c_origin");if(i){i=i.replace(/\s+/g,"").split(/,/);i[0]-=0;i[1]-=0;t=i}else{var a=c("g[c_origin], svg, path, text, rect, image, circle, ellipse, line, polygon, polyline",e);a&&(t=ji.svg.getRefPoint(a))}}if(t)return{x:t[0],y:t[1]}},transformPoint:function(e,t){return{x:e.x*t.a+e.y*t.c+t.e,y:e.x*t.b+e.y*t.d+t.f}},transformBox:function(e,t){for(var r,n=[e.x,e.x+e.width,e.x,e.x+e.width],i=[e.y,e.y,e.y+e.height,e.y+e.height],a=0;a<4;a++){r=ji.svg.transformPoint({x:n[a],y:i[a]},t);n[a]=r.x;i[a]=r.y}var o=Math.min.apply(0,n),s=Math.min.apply(0,i);return{x:o,y:s,width:Math.max.apply(0,n)-o,height:Math.max.apply(0,i)-s}},isZeroBox:function(e){return!(e.x||e.y||e.width||e.height)},getPlainBBox:function(e){if(v(e,"c_partid")&&v(e,"c_partid").match(/part_import_/)){var t=s('[c_partid="part_annotation"]',e),r=s('[c_partid="part_pcbtext"]',e),n=c('[c_etype="outline3D"]',e),i=[],a=[],o=n&&"none"!==n.style.display;o&&(n.style.display="none");t.length&&t.forEach(function(e){if("none"!==e.style.display){i.push(e);e.style.display="none"}});r.length&&r.forEach(function(e){if("none"!==e.style.display){a.push(e);e.style.display="none"}});var l=ji.svg.getBBox(e);o&&(n.style.display="");i.length&&i.forEach(function(e){e.style.display=""});a.length&&a.forEach(function(e){e.style.display=""});return l}return ji.svg.getBBox(e)},getBBox:function(e){function t(e){var t,r;try{r=e.cloneNode(!0);hi.appendChild(r);r.style.display="inline";var n=r.getBBox();r.style.display="";t={x:n.x,y:n.y,width:n.width,height:n.height};p(r)}catch(e){if(r){r.style.display="";p(r)}t={x:0,y:0,width:0,height:0}}return t}var r,n;try{n=e.getBBox();r={x:n.x,y:n.y,width:n.width,height:n.height}}catch(n){r=t(e)}try{r.x||r.y||r.width||r.height||20==o("root").compareDocumentPosition(e)||(r=t(e))}catch(e){}return r},getBBoxAbout:function(e){var t,r=e.tagName;if("none"==v(e,"display"))return null;var n=function(e,t){return parseFloat(v(e,t))};switch(r){case"text":t=[n(e,"x"),n(e,"y"),1,1];break;case"image":case"rect":t=[n(e,"x"),n(e,"y"),n(e,"width"),n(e,"height")];t[2]+=t[0];t[3]+=t[1];break;case"circle":case"ellipse":var i,a,o=n(e,"cx"),s=n(e,"cy");if("circle"==r)i=a=n(e,"r");else{i=n(e,"rx");a=n(e,"ry")}t=[o-i,s-a,o+i,s+a];break;case"line":var l=n(e,"x1"),d=n(e,"y1"),h=n(e,"x2"),f=n(e,"y2");t=[Math.min(l,h),Math.min(d,f),Math.max(l,h),Math.max(d,f)];break;case"polyline":case"polygon":t=function(e){var t,r,n,i,a=I(e);if(!a.length)return null;t=n=a[0].x;r=i=a[0].y;for(var o=1;o<a.length;o++){var s=a[o];t-s.x>0&&(t=s.x);r-s.y>0&&(r=s.y);n-s.x<0&&(n=s.x);i-s.y<0&&(i=s.y)}return[t,r,n,i]}(v(e,"points"));break;case"path":var u=e.getPathData({normalize:!0});t=function(e){if(!e.length)return null;for(var t,r=0;r<e.length;r++){var n=e[r].values,i=e[r].type;if(t)switch(i){case"M":case"L":t[0]-n[0]>0&&(t[0]=n[0]);t[1]-n[1]>0&&(t[1]=n[1]);t[2]-n[0]<0&&(t[2]=n[0]);t[3]-n[1]<0&&(t[3]=n[1]);break;case"C":t[0]-n[4]>0&&(t[0]=n[4]);t[1]-n[5]>0&&(t[1]=n[5]);t[2]-n[4]<0&&(t[2]=n[4]);t[3]-n[5]<0&&(t[3]=n[5])}else{if("M"!=i)return null;t=n.concat(n)}}return t}(u);break;default:for(var p=e.children,g=0;g<p.length;g++)if("none"!=v(p[g],"display")){var y=ji.svg.getBBoxSimple(p[g]);if(y){var x={l:y.x,t:y.y,r:y.x+y.width,b:y.y+y.height};if(t){isFinite(x.l)&&t.l-x.l>0&&(t.l=x.l);isFinite(x.t)&&t.t-x.t>0&&(t.t=x.t);isFinite(x.r)&&t.r-x.r<0&&(t.r=x.r);isFinite(x.b)&&t.b-x.b<0&&(t.b=x.b)}else t=x}}t=t&&[t.l,t.t,t.r,t.b]}if(!t||!isFinite(t[0])||!isFinite(t[1]))return null;isFinite(t[2])||(t[2]=t[0]);isFinite(t[3])||(t[3]=t[1]);if(v(e,"transform")){var m=e.getCTM(),_="object"==typeof hi?hi:c("svg"),b=_.createSVGPoint();b.x=t[0];b.y=t[1];b.matrixTransform(m);t[0]=b.x;t[1]=b.y;b.x=t[2];b.y=t[3];b.matrixTransform(m);t[2]=b.x;t[3]=b.y}return function(e){var t={x:e[0],y:e[1],width:e[2]-e[0],height:e[3]-e[1]};if(t.width<0){t.x=e[2];t.width=-t.width}if(t.height<0){t.y=e[3];t.height=-t.height}return t}(t)},getBBoxMerged:function(e,t){if(!e||!e.length)return{x:0,y:0,width:0,height:0};for(var r,n=0;n<e.length;n++)if(e[n]){var i=ji.svg.getViewBBox(e[n],t);if(i.x||i.y||i.width||i.height)if(r){r.width=Math.max(i.x+i.width,r.x+r.width)-Math.min(i.x,r.x);r.height=Math.max(i.y+i.height,r.y+r.height)-Math.min(i.y,r.y);r.x=Math.min(i.x,r.x);r.y=Math.min(i.y,r.y)}else r=i}return r||{x:0,y:0,width:0,height:0}},getElementsCenter:function(e,t){if(!e||!e[0])return{x:0,y:0};var r=ji.svg.getBBoxMerged(e,t);return{x:ji.formatLengthSave(r.x+r.width/2),y:ji.formatLengthSave(r.y+r.height/2)}},getBBoxFixed:function(t,r){function n(t){var r=e.getComputedStyle&&getComputedStyle(t);return!r||"none"==r.display}function i(e){for(var t,r,a,c=e.children||[].filter.call(e.childNodes,function(e){return 1===e.nodeType}),l=0,d=c.length;l<d;l++){a=c[l];if(o){if("text"==a.tagName)continue;if("g"==a.tagName){var f=v(a,"c_partid");if("part_annotation"==f||"part_pcbtext"==f)continue}}if((!s||!h(a,"pindot"))&&("none"!=v(a,"display")&&"none"!=a.style.display&&!n(a))){try{r=a.getBBox();if(!(r.width||r.height||r.x||r.y))continue}catch(e){continue}"g"==a.tagName?r=i(a):"path"==a.tagName&&(r=ji.svg.getBBoxForPath(a));if(r&&(r.width||r.height)){if(v(a,"transform"))try{var u=a.getTransformToElement(e);r=ji.svg.transformBox(r,u)}catch(e){}t=t?ji.combineBox(t,r):r}}}return t||{x:0,y:0,width:0,height:0}}var a,o=r&&r.excludeText,s=r&&r.excludePindot;if("g"!=t.tagName){var c=v(t,"display")||"",l=t.style.display;v(t,"display","");t.style.display="inline !important";a="path"==t.tagName?ji.svg.getBBoxForPath(t):ji.svg.getBBox(t);v(t,"display",c);t.style.display=l;return a}a=ji.svg.getBBox(t);if(!a.width&&!a.height)return a;if((a.x||a.y)&&!o)return a;a=i(t);a.width||a.height||(a=ji.svg.getBBox(t));return a},getBBoxExcludeText:function(e){return ji.svg.getBBoxFixed(e,{excludeText:!0})},hasBBoxBugForPath:function(){var e=t.createElement("div");e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><path d="M 0 0 C 0 100 100 0 10 10"/></svg>';t.body.appendChild(e);var r=!1;try{var n=e.querySelector("path").getBBox();r=47!=(0|n.width)||44!=(0|n.height)}catch(e){}t.body.removeChild(e);return r}(),getBBoxForPath:function(e,t){var r,n,i=ji.svg.getBBox(e);if(!(i.width||i.height||i.x||i.y)){r=e.getPointAtLength(0);return{x:r.x,y:r.y,width:0,height:0}}if(!ji.svg.hasBBoxBugForPath)return i;if(!/[cqst]/i.test(v(e,"d")))return i;if(navigator.userAgent.indexOf("AppleWebKit")<0)return i;n=e.getTotalLength();if(n<=0){r=e.getPointAtLength(0);return{x:r.x,y:r.y,width:0,height:0}}("number"!=typeof t||t<=0)&&(t=5);t=Math.min(.1*n,Math.max(t,.01*n));for(var a=0,o=[],s=[];a<n;){r=e.getPointAtLength(a);o.push(r.x);s.push(r.y);a+=t}r=e.getPointAtLength(n);o.push(r.x);s.push(r.y);i.x=Math.min.apply(0,o);i.y=Math.min.apply(0,s);i.width=Math.max.apply(0,o)-i.x;i.height=Math.max.apply(0,s)-i.y;return i},getViewBBox:function(e,t){var r=ji.svg.getBBoxFixed(e,{excludeText:t});if(v(e,"transform")){var n=hi.contains(e)?hi:e.parentNode;if(n)try{var i=e.getTransformToElement(n);r=ji.svg.transformBox(r,i)}catch(e){}}r.x=ji.formatLengthSave(r.x);r.y=ji.formatLengthSave(r.y);r.width=ji.formatLengthSave(r.width);r.height=ji.formatLengthSave(r.height);return r},setTooltip:function(e,t){if(e&&e.tagName&&e.children){var r,n;for(r=0;r<e.children.length;r++)if("title"==e.children[r].tagName){n=e.children[r];break}if(t){n||(n=e.appendChild(yn("title")));ji.node.setTextContent(n,t)}else n&&e.removeChild(n)}},getPathHelperType:function(e){if(e&&"path"==e.tagName){for(var t=e.pathSegList,r=t.numberOfItems,n="",i=0;i<r&&i<5;i++)n+=t.getItem(i).pathSegTypeAsLetter;return"MA"==n?t.getItem(1).r1!=t.getItem(1).r2||ya!=ii.PCBLIB&&ya!=ii.PCB?"arc1":"arc2":/^(?:MALZ|MLAZ|MLLAZ?)$/.test(n)?ya==ii.PCBLIB||ya==ii.PCB?void 0:"pie1":void 0}},deletePathPointAtCdot:function(e,t){function r(e){return e.pathSegTypeAsLetter}function n(e){return{M:1,L:1,H:1,V:1,A:1,T:1,S:2,Q:2,C:3,Z:0}[e.toUpperCase()]||0}if(!(!e||"path"!=e.tagName||isNaN(t)||t<0)){if(!ji.svg.getPathHelperType(e))for(var i=na.get(e),a=e.pathSegList,o=a.numberOfItems,s=[],c=-1,l=0;l<o;l++){var d,h,f,u,p,g=a.getItem(l),y=r(g),v=(l&&r(a.getItem(l-1)),l+1<o?r(a.getItem(l+1)):"");f=void 0===s[l]?s[l]=n(y):s[l];v&&(u=void 0===s[l+1]?s[l+1]=n(v):s[l+1]);if("M"!=y.toUpperCase()||v&&"M"!=v.toUpperCase()&&"Z"!=v){c+=f;if(!(c<t)){if(c>t)return;switch(y.toUpperCase()){case"M":p=c+u;if("M"==y){g.x=i[2*p];g.y=i[2*p+1]}else{g.x+=i[2*p]-i[2*c];g.y+=i[2*p+1]-i[2*c+1]}var x=function(e,t,n){for(var i=e.numberOfItems,a=n||0;a<i;a++){var o=r(e.getItem(a));if("M"==o||"m"==o)return a>n?-1:a;if(o==t)return a}return-1}(a,"Z",l+1);if(x>=0){h=e.createSVGPathSegLinetoAbs(i[2*c],i[2*c+1]);a.replaceItem(h,x)}a.removeItem(l+1);return;case"L":case"H":case"V":case"T":case"A":a.removeItem(l);return;case"S":case"Q":a.removeItem(l);return;case"C":switch(y+v){case"CC":d=a.getItem(l+1);d.x1=i[2*(c-2)];d.y1=i[2*(c-2)+1];a.removeItem(l);return;case"CS":g.x2=i[2*(c+1)];g.y2=i[2*(c+1)+1];a.removeItem(l+1);return;case"Cc":d=a.getItem(l+1);d.x1=i[2*(c-2)]-i[2*(c-3)];d.y1=i[2*(c-2)+1]-i[2*(c-3)+1];d.x2=i[2*(c+2)]-i[2*(c-3)];d.y2=i[2*(c+2)+1]-i[2*(c-3)+1];d.x=i[2*(c+3)]-i[2*(c-3)];d.y=i[2*(c+3)+1]-i[2*(c-3)+1];a.removeItem(l);return;case"Cs":h=e.createSVGPathSegCurvetoCubicRel(i[2*p-2],i[2*p-1]);h.x1=i[2*(c-2)]-i[2*(c-3)];h.y1=i[2*(c-2)+1]-i[2*(c-3)+1];h.x2=i[2*(c+2)]-i[2*(c-3)];h.y2=i[2*(c+2)+1]-i[2*(c-3)+1];h.x=i[2*(c+3)]-i[2*(c-3)];h.y=i[2*(c+3)+1]-i[2*(c-3)+1];a.replaceItem(h,l);a.removeItem(l+1);return;case"cC":case"cS":case"cc":case"cs":default:a.removeItem(l)}return;default:return}}}}}},fixOperaPathDAttribute:function(e){var t,r,n,i=e.pathSegList,a=i.numberOfItems,o="";for(r=0;r<a;r++){t=i.getItem(r);n=t.pathSegTypeAsLetter;switch(n.toUpperCase()){case"M":case"L":case"T":o+=n+t.x+" "+t.y;break;case"H":o+=n+t.x;break;case"V":o+=n+t.y;break;case"C":o+=n+t.x1+" "+t.y1+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"S":o+=n+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"Q":o+=n+t.x1+" "+t.y1+" "+t.x+" "+t.y;break;case"A":o+=n+t.r1+" "+t.r2+" "+t.angle+" "+ +t.largeArcFlag+" "+ +t.sweepFlag+" "+t.x+" "+t.y;break;case"Z":o+=n}}e.setAttribute("d",o)},fixOrigin:function(e){var t=v(e,"c_origin");if(t){var r=ji.svg.getBBox(e);if(r.x||r.y||r.width||r.height){var n=t.split(","),i=+n[0],a=+n[1],o=_i.adsorbGrid.gridSize,s=r.x+r.width/2,c=r.y+r.height/2,l=0,d=0;(i<r.x-10||i>r.x+r.width+10)&&(l=Math.round((s-i)/o));(a<r.y-10||a>r.y+r.height+10)&&(d=Math.round((c-a)/o));if(l||d){v(e,"c_origin",i+l*o+","+(a+d*o));return!0}}}},isPointInBbox:function(e,t){var r=e.x,n=e.y,i=t.x,a=t.y,o=t.width,s=t.height;return void 0!=r&&void 0!=n&&void 0!=i&&void 0!=a&&void 0!=o&&void 0!=s&&!(r<i||r>i+o||n<a||n>a+s)}};ji.node={clearChildNodes:function(e){for(;e&&e.lastChild;)e.removeChild(e.lastChild)},getRefId:function(e){return e.nextElementSibling?e.nextElementSibling.id:e.parentNode?"<"+e.parentNode.id:""},isSame:function(e,t){if(!e||!t)return!1;var r=new XMLSerializer;return r.serializeToString(e)==r.serializeToString(t)},contains:function(e,t){return e.contains?e!=t&&e.contains(t):20==e.compareDocumentPosition(t)},children:function(e){return e.children||[].filter.call(e.childNodes,function(e){return 1===e.nodeType})},setTextContent:function(t,r){if(t)try{t.textContent=r}catch(t){try{var n=e.__TEXTCONTENT_DESCRIPTOR;if(n){var i={}.toString.call(n.set);i.indexOf("[native code]")<0&&Object.defineProperty(Node.prototype,"textContent",n)}}catch(e){}}}};var ea={move:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||ea[e.tagName](e,t,r)},g:function(e,t,r){"FOOTPRINT"===ee(e)&&wt();isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)&&(!e||"part_plane"!==v(e,"c_partid"))){if("outline3D"===v(e,"c_etype"))return ne(e,t,r);for(var n=e.children,i=n.length,a=0;a<i;a++)w(ea,n[a].tagName)&&ea[n[a].tagName](n[a],t,r);var o=v(e,"c_origin");if(o){o=ji.numberlistToArray(o);o[0]=ji.toFixed(o[0]+t,4);o[1]=ji.toFixed(o[1]+r,4);v(e,"c_origin",o.join(","))}}},svg:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){0!==t&&v(e,{x:+(v(e,"x")||0)+t});0!==r&&v(e,{y:+(v(e,"y")||0)+r})}},rect:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||ea.svg(e,t,r)},text:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){var n,i=+(v(e,"x")||0),a=+(v(e,"y")||0),o=v(e,"transform")||"";o&&(n=o.match(/rotate\((-?[\d.]+)[,\s].+\)/))?v(e,{x:i+t,y:a+r,transform:"rotate("+n[1]+","+(i+t)+","+(a+r)+")"}):v(e,{x:i+t,y:a+r});for(var c=s("tspan",e),l=c.length,d=0;d<l;d++)v(c[d],{x:i+t})}},image:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){var n=+(v(e,"x")||0),i=+(v(e,"y")||0),a=+v(e,"width"),o=+v(e,"height"),s=xe(e);v(e,{x:n+t,y:i+r});if(s){v(e,"transform",Le({x:n+t,y:i+r,width:a,height:o},s))}}},circle:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||v(e,{cx:+v(e,"cx")+t,cy:+v(e,"cy")+r})},ellipse:function(e,t,r){ea.circle(e,t,r)},line:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||v(e,{x1:+v(e,"x1")+t,x2:+v(e,"x2")+t,y1:+v(e,"y1")+r,y2:+v(e,"y2")+r})},polyline:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){for(var n=F(v(e,"points")).split(/[\s\,]+/g),i=0;i<n.length-1;i+=2){n[i]=ji.toFixed(+n[i]+t,4);n[i+1]=ji.toFixed(+n[i+1]+r,4)}v(e,{points:n.join(" ")})}},polygon:function(e,t,r){ea.polyline(e,t,r)},path:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){if(Gi);!function(t,r){function n(e,t,r){e[t]=ji.toFixed(e[t]+r,4)}for(var i=e.getPathData(),a=i.length,o=0;o<a;o++){var s=i[o],c=s.type,l=s.values;switch(c){case"M":case"L":case"T":n(l,0,t);n(l,1,r);break;case"H":n(l,0,t);break;case"V":n(l,0,r);break;case"C":n(l,0,t);n(l,1,r);n(l,2,t);n(l,3,r);n(l,4,t);n(l,5,r);break;case"S":case"Q":n(l,0,t);n(l,1,r);n(l,2,t);n(l,3,r);break;case"A":n(l,5,t);n(l,6,r)}}e.setPathData(i)}(t,r)}}},ta={rotate:function(e,t,r,n){var i,a;if(void 0===r||void 0===n)if("g"!==e.tagName||"part_annotation"==v(e,"c_partid")){i=ji.svg.getViewBBox(e);r=ji.toFixed(i.x+i.width/2,3);n=ji.toFixed(i.y+i.height/2,3)}else{var o=v(e,"c_origin");if(o){a=o.split(",");r=+a[0];n=+a[1];if("TEXT"===ee(e)&&Layer.front==ni.BOTTOMLAYER&&"note_pre"===v(e.childNodes[0],"c_note")){i=ji.svg.getViewBBox(e);r=ji.toFixed(i.x+i.width/2,3);n=ji.toFixed(i.y+i.height/2,3)}}else{i=ji.svg.getViewBBox(e);r=ji.toFixed(i.x+i.width/2,3);n=ji.toFixed(i.y+i.height/2,3)}}if("g"!=e.tagName||"part_annotation"!=v(e,"c_partid"))ta[e.tagName]&&ta[e.tagName](e,t,r,n);else if("note_package"===v(e.childNodes[0],"c_note")){var s=ji.svg.getPlainBBox(e.parentNode),c=ji.svg.getBBox(e),l=s.y+s.height+2,d=c.y,h=s.x-c.x,f=l-d;ea.g(e,h,f)}else ta.annotation(e,t,r,n)},groupRotate:function(e,t,r,n){var i,a,o,s,c=e.length;if(c)if(c<2)ta.rotate(e[0],t,r,n);else if(void 0===r||void 0===n){for(i=0;i<c;i++)if("text"!=e[i].tagName&&!v(e[i],"c_origin")){a=!0;break}if(a)for(i=0;i<c;i++){s=function(e){try{return e.getBBox()}catch(e){}}(e[i]);if(s)if(o){o.x=Math.min(o.x,s.x);o.y=Math.min(o.y,s.y);o.x2=Math.max(o.x2,s.x+s.width);o.y2=Math.max(o.y2,s.y+s.height)}else o={x:s.x,y:s.y,x2:s.x+s.width,y2:s.y+s.height}}else for(i=0;i<c;i++){s=function(e){if(e){var t=e.split(",");return{x:+t[0],y:+t[1]}}}(v(e[i],"c_origin"));s||"text"!=e[i].tagName||(s={x:+v(e[i],"x"),y:+v(e[i],"y")});if(s)if(o){o.x=Math.min(o.x,s.x);o.y=Math.min(o.y,s.y);o.x2=Math.max(o.x2,s.x);o.y2=Math.max(o.y2,s.y)}else o={x:s.x,y:s.y,x2:s.x,y2:s.y}}if(o){r=ji.toFixed((o.x+o.x2)/2,3);n=ji.toFixed((o.y+o.y2)/2,3);for(i=0;i<c;i++)ta.rotate(e[i],t,r,n)}}else for(i=0;i<c;i++)ta.rotate(e[i],t,r,n)},g:function(e,t,r,n){void 0===t&&(t=270);if(t%360!=0){var i,a,o,c,l=v(e,"c_origin");if(void 0===r||void 0===n)if(l){i=l.split(",");r=+i[0];n=+i[1]}else{a=e.getBBox();r=a.x+a.width/2|0;n=a.y+a.height/2|0}else if(l){i=l.split(",");o=[+i[0],+i[1]];o=ye(o,t,r,n);v(e,"c_origin",o.join(","))}if(l){c=+(v(e,"c_rotation")||0);c=be(c-t);v(e,"c_rotation",c)}if("part_pin"!=v(e,"c_partid")){if("part_plane"!=v(e,"c_partid")){for(var d,h,f,u,p,g=e.children||e.childNodes,y=g.length,x=0;x<y;x++){var m=s("[c_note]",g[x]);if((ya==ii.SCH||ya==ii.SCHMODULE||ya==ii.SUBCKT)&&"g"==g[x].tagName&&m.length>0){d=v(m[0],"c_note");if("note_pre"==d){h=m[0];continue}if("note_name"==d){f=m[0];continue}if("note_verify"==d){u=m[0];continue}if("note_mounted"==d){p=m[0];continue}}ta.rotate(g[x],t,r,n)}(h||f)&&Kr(h,f,u,p);(u||p)&&qr(u,p)}}else ta.pin(e,t,r,n)}},svg:function(e,t,r,n){var i=v(e,"x"),a=v(e,"y");if(void 0===r||void 0===n)ta.rotate(e,t,i,a);else if(null===i||null===a)for(var o=e.children||e.childNodes,s=o.length,c=0;c<s;c++)ta.hasOwnProperty(o[c].tagName)&&ta.rotate(o[c],t,r,n);else null!==i&&null!==a&&ta.image(e,t,r,n)},rect:function(e,t,r,n){v(e,ve({x:+v(e,"x"),y:+v(e,"y"),width:+v(e,"width"),height:+v(e,"height")},t,r,n))},text:function(e,t,r,n){void 0===t&&(t=270);var i,a,o=v(e,"text-anchor")||"start",c=v(e,"transform");i="end"==o?c?270:180:c?90:0;var l=c;l&&l.match(/[\d\.\-]+/)[0];a=be(i-t);var d,h,f,u;d=ji.svg.getBBox(e);if(0===d.width||0===d.height){var p={},g=+v(e,"x"),y=+v(e,"y"),x=[g,y];void 0!==r&&void 0!==n&&(x=ye(x,t,r,n));p.x=x[0];p.y=x[1];o=0===a||90==a?"start":"end";c=0===a||180==a?"":"rotate(270,"+p.x+","+p.y+")";p["text-anchor"]=o;p.transform=c;v(e,p);h=s("tspan",e);for(f=0,u=h.length;f<u;f++)v(h[f],{x:p.x})}else{var m=Te(e),_=ve(m,t,r,n),b=0===a||90==a?"start":"end",S=0===a||180==a?"":"rotate(270,"+_.x+","+_.y+")";v(e,{x:_.x,y:_.y,"text-anchor":b,transform:S});var C=Te(e),P=_.x-C.x,w=_.y-C.y,N=S?"rotate(270,"+(_.x+P)+","+(_.y+w)+")":"";v(e,{x:_.x+P,y:_.y+w,"text-anchor":b,transform:N});h=s("tspan",e);for(f=0,u=h.length;f<u;f++)v(h[f],{x:_.x+P})}},pin:function(e,t,r,n){for(var i=s("text",e),a=i[0],o=i[1],l=c("circle",e),d=v(a,"x")-v(l,"cx"),h=v(a,"y")-v(l,"cy"),f=v(o,"x")-v(l,"cx"),u=v(o,"y")-v(l,"cy"),p=e.children||e.childNodes,g=p.length,y=0;y<g;y++){var x=p[y],m=x.tagName;m&&x!=a&&x!=o&&ta[m]&&ta[m](p[y],t,r,n)}var _,b,S=+v(l,"cx"),C=+v(l,"cy"),P={},w=v(a,"text-anchor")||"start",N=v(a,"transform");_="end"==w?N?90:0:N?270:180;b=be(_-t);y=_/90|0;var A=[d,-h,-d,h][y],k=[h,d,h,d][y];y=b/90|0;var O=[A,k,-A,k][y],T=[k,-A,k,A][y],L=S+O,I=C+T;P.x=L;P.y=I;P["text-anchor"]=0===b||90==b?"end":"start";P.transform=90==b||270==b?"rotate(270,"+L+","+I+")":"";v(a,P);y=_/90|0;var E=[f,-u,-f,u][y],M=[u,f,u,f][y];y=b/90|0;var V=[E,M,-E,M][y],B=[M,-E,M,E][y],G=S+V,F=C+B;P.x=G;P.y=F;P["text-anchor"]=0===b||90==b?"start":"end";P.transform=90==b||270==b?"rotate(270,"+G+","+F+")":"";v(o,P)},image:function(e,t,r,n){if(0!==t){var i=ji.svg.getViewBBox(e);if(void 0===r||void 0===n){r=ji.toFixed(i.x+i.width/2,3);n=ji.toFixed(i.y+i.height/2,3)}var a=(v(e,"x"),v(e,"y"),+v(e,"width")||0),o=+v(e,"height")||0,s=be(xe(e)+t),c=ve(i,t,r,n),l={x:c.x,y:c.y,c_rotation:be(360-s)};i={x:l.x,y:l.y,width:a,height:o};l.transform=Le(i,s);v(e,l)}},circle:function(e,t,r,n){var i=[v(e,"cx"),v(e,"cy")];i=ye(i,t,r,n);v(e,{cx:i[0],cy:i[1]})},ellipse:function(e,t,r,n){var i=[v(e,"cx"),v(e,"cy")];i=ye(i,t,r,n);v(e,{cx:i[0],cy:i[1]});if(t%180!=0){var a=v(e,"rx");v(e,{rx:v(e,"ry"),ry:a})}},line:function(e,t,r,n){var i=[v(e,"x1"),v(e,"y1"),v(e,"x2"),v(e,"y2")];i=ye(i,t,r,n);v(e,{x1:i[0],y1:i[1],x2:i[2],y2:i[3]})},polyline:function(e,t,r,n){void 0===t&&(t=270);var i=F(v(e,"points")).split(/[\s\,]+/);i=ye(i,t,r,n);v(e,{points:i.join(" ")})},polygon:function(e,t,r,n){ta.polyline(e,t,r,n)},path:function(e,t,r,n){if(t%360!=0){t=be(t);for(var i,a,o,s,c,l,d,h,f,u=Gi,p=e.pathSegList,g=p.numberOfItems,y=0;y<g;y++){i=null
;a=p.getItem(y);o=a.pathSegType;f=o%2==0;if(0!=o&&1!=o){if(f){s=o;c=r;l=n}else{s=o-1;c=0;l=0}switch(s){case 2:case 4:i=ye([a.x,a.y],t,c,l);a.x=i[0];a.y=i[1];break;case 6:i=ye([a.x,a.y,a.x1,a.y1,a.x2,a.y2],t,c,l);a.x=i[0];a.y=i[1];a.x1=i[2];a.y1=i[3];a.x2=i[4];a.y2=i[5];break;case 8:i=ye([a.x,a.y,a.x1,a.y1],t,c,l);a.x=i[0];a.y=i[1];a.x1=i[2];a.y1=i[3];break;case 10:i=ye([a.x,a.y],t,c,l);a.x=i[0];a.y=i[1];if(a.r1!=a.r2){a.angle=(a.angle-t)%180;if(90==a.angle||-90==a.angle){a.angle=0;var x=a.r1,m=a.r2;a.r1=m;a.r2=x}}else a.angle=0;break;case 12:if(180==t)a.x=f?r+r-a.x:-a.x;else{d=Kn[t];h=f?e.createSVGPathSegLinetoVerticalAbs((a.x-r)*d+n):e.createSVGPathSegLinetoVerticalRel(a.x*d);p.replaceItem(h,y)}break;case 14:if(180==t)a.y=f?n+n-a.y:-a.y;else{d=Kn[t];h=f?e.createSVGPathSegLinetoHorizontalAbs(r-(a.y-n)*d):e.createSVGPathSegLinetoHorizontalRel(-a.y*d);p.replaceItem(h,y)}break;case 16:i=ye([a.x,a.y,a.x2,a.y2],t,c,l);a.x=i[0];a.y=i[1];a.x2=i[2];a.y2=i[3];break;case 18:i=ye([a.x,a.y],t,c,l);a.x=i[0];a.y=i[1]}}}u&&ji.svg.fixOperaPathDAttribute(e);Vi&&v(e,"d",v(e,"d"))}},annotation:function(e,t,r,n){void 0===t&&(t=270);if(t%360!=0){var i,a,o,l,d,h,f,u,p,g,y,x,m,_,b=c("text",e);a=e.getBBox();o=a.x+a.width/2;l=a.y+a.height/2;i=ye([o,l],t,r,n);r=i[0];n=i[1];y=+(v(e,"c_rotation")||0);var S,C=v(b,"transform");if(C){S=C.match(/[\d\.\-]+/)[0];S!=y&&(y=S)}y=be(y-t);v(e,"c_rotation",y);v(e,"c_origin",ji.toFixed(r,2)+","+ji.toFixed(n,2));switch(y){case 0:case 180:x="";break;case 90:x="270";break;case 270:x="90";break;default:return}v(b,"text-anchor","");v(b,"transform",x?"rotate("+x+","+v(b,"x")+","+v(b,"y")+")":"");d=e.getBBox();h=d.x+d.width/2;f=d.y+d.height/2;u=ji.toFixed(+v(b,"x")+r-h,2);p=ji.toFixed(+v(b,"y")+n-f,2);x=x?"rotate("+x+","+u+","+p+")":"";v(b,{x:u,y:p,transform:x});g=s("tspan",b);for(m=0,_=g.length;m<_;m++)v(g[m],"x",u)}}},ra={point:function(e,t,r){null!==t&&(e.x=2*t-e.x);null!==r&&(e.y=2*r-e.y)},element:function(e,t,r){e.tagName&&ra[e.tagName](e,t,r)},elementsFlipH:function(e,t){if(0!==e.length){var r,n;if(ya===ii.PCB&&!isLayerVisible("15")&&v(e[0],"layerid")==ni.MECHANICAL){var i=getStyleSheetRuleByLayerId(o("pcblayerStyle").sheet,15);i.style.display=""}if(void 0===t||null===t){var a,s,c,l,d=v(e[0],"c_origin");if(d)a=s=+d.split(",")[0];else try{l=e[0].getBBox();a=l.x;s=l.x+l.width}catch(e){a=Number.MAX_VALUE;s=-Number.MAX_VALUE}for(r=0,n=e.length;r<n;r++){d=v(e[r],"c_origin");if(d){c=+d.split(",")[0];c<a?a=c:c>s&&(s=c)}else{if("none"==e[r].style.display)continue;try{l=e[r].getBBox();l.x<a&&(a=l.x);l.x+l.width>s&&(s=l.x+l.width)}catch(e){}}}t=(a+s)/2}if(ya===ii.PCB&&!isLayerVisible("15")&&v(e[0],"layerid")==ni.MECHANICAL){i=getStyleSheetRuleByLayerId(o("pcblayerStyle").sheet,15);i.style.display="none"}for(r=0,n=e.length;r<n;r++)ra[e[r].tagName](e[r],t,null)}},elementsFlipV:function(e,t){if(e.length){var r,n;if(void 0===t||null===t){var i,a,o,s,c=v(e[0],"c_origin");if(c)i=a=+c.split(",")[1];else try{s=e[0].getBBox();i=s.y;a=s.y+s.height}catch(e){Number.MAX_VALUE;-Number.MAX_VALUE}for(r=1,n=e.length;r<n;r++){c=v(e[r],"c_origin");if(c){o=+c.split(",")[1];o<i?i=o:o>a&&(a=o)}else{if("none"==e[r].style.display)continue;try{s=e[r].getBBox();s.y<i&&(i=s.y);s.y+s.height>a&&(a=s.y+s.height)}catch(e){}}}t=(i+a)/2}for(r=0,n=e.length;r<n;r++)ra[e[r].tagName](e[r],null,t)}},flipH:function(e,t){if(e instanceof NodeList||Array.isArray(e))return ra.elementsFlipH(e,t);if(void 0===t||null===t)try{var r=e.getBBox();t=r.x+r.width/2}catch(r){var n=e.tagName;if("rect"!=n&&"image"!=n)return;t=+v(e,"x")+v(e,"width")/2}ra[e.tagName](e,t,null)},flipV:function(e,t){if(e instanceof NodeList||Array.isArray(e))return ra.elementsFlipV(e,t);if(void 0===t||null===t)try{var r=e.getBBox();t=r.y+r.height/2}catch(r){var n=e.tagName;if("rect"!=n&&"image"!=n)return;t=+v(e,"y")+v(e,"height")/2}ra[e.tagName](e,null,t)},g:function(e,t,r){var n,i,a,o,s=v(e,"c_origin");if(s){n=s.split(",");o={x:+n[0],y:+n[1]};ra.point(o,t,r);v(e,"c_origin",o.x+","+o.y)}if("part_pin"!=v(e,"c_partid")){if("part_plane"!=v(e,"c_partid")){var c=e.children||e.childNodes;a=c.length;for(i=0;i<a;i++){var l=c[i].tagName;l&&w(ta,l)&&ra[l](c[i],t,r)}v(e,"c_partid")}}else ra.pin(e,t,r)},svg:{},rect:function(e,t,r){null!==t&&v(e,"x",2*t-v(e,"x")-v(e,"width"));null!==r&&v(e,"y",2*r-v(e,"y")-v(e,"height"))},text:function(e,t,r){var n=void 0!==t&&null!==t,i=void 0!==r&&null!==r;if(n||i){var a,o=xe(e),s="text-anchor";if(n){v(e,"x",2*t-v(e,"x"));if(0===o||180==o){a=v(e,s);v(e,s,"start"!=a&&a?"start":"end")}}if(i){v(e,"y",2*r-v(e,"y"));if(270==o||90==o){a=v(e,s);v(e,s,"start"!=a&&a?"start":"end")}}v(e,"transform")&&v(e,"transform","rotate("+o+","+v(e,"x")+","+v(e,"y")+")")}},pin:function(e,t,r){var n,i=s("text",e),a=i[0],o=i[1],l=c("circle",e),d=!!v(a,"transform"),h=null!==r,f={};if(d!==h)var u=v(a,"x")-v(l,"cx"),p=v(a,"y")-v(l,"cy"),g=v(o,"x")-v(l,"cx"),y=v(o,"y")-v(l,"cy");for(var x=e.children||e.childNodes,m=x.length,_=0;_<m;_++){var b=x[_],S=b.tagName;S&&b!=a&&b!=o&&ra[S](x[_],t,r)}if(d==h){v(e,"c_rotation",be((v(e,"c_rotation")||0)-180));f["text-anchor"]="end"==v(a,"text-anchor")?"start":"end";n={x:+v(a,"x"),y:+v(a,"y")};ra.point(n,t,r);f.x=n.x;f.y=n.y;d&&(f.transform=v(a,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+f.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+f.y));v(a,f);f["text-anchor"]="end"==v(o,"text-anchor")?"start":"end";n={x:+v(o,"x"),y:+v(o,"y")};ra.point(n,t,r);f.x=n.x;f.y=n.y;d&&(f.transform=v(o,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+f.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+f.y));v(o,f)}else{var C=+v(l,"cx"),P=+v(l,"cy");f.x=C+u;f.y=P+p;d&&(f.transform=v(a,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+f.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+f.y));v(a,f);f.x=C+g;f.y=P+y;d&&(f.transform=v(o,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+f.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+f.y));v(o,f)}},image:function(e,t,r){},circle:function(e,t,r){null!==t&&v(e,"cx",2*t-v(e,"cx"));null!==r&&v(e,"cy",2*r-v(e,"cy"))},ellipse:function(e,t,r){ra.circle(e,t,r)},line:function(e,t,r){if(null!==t){v(e,"x1",2*t-v(e,"x1"));v(e,"x2",2*t-v(e,"x2"))}if(null!==r){v(e,"y1",2*r-v(e,"y1"));v(e,"y2",2*r-v(e,"y2"))}},polyline:function(e,t,r){var n,i,a=F(v(e,"points")).split(/[\s\,]+/);if(null!==t){var o=2*t;for(n=0,i=a.length-1;n<i;n+=2)a[n]=o-a[n]}if(null!==r){var s=2*r;for(n=0,i=a.length-1;n<i;n+=2)a[n+1]=s-a[n+1]}v(e,{points:a.join(" ")})},polygon:function(e,t,r){ra.polyline(e,t,r)},path:function(e,t,r){if(Gi)var n=!0;var i,a,o,s,c,l=e.pathSegList,d=l.numberOfItems,h=2*t,f=2*r;if(null!==t){for(c=0;c<d;c++){i=l.getItem(c);switch(i.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:case SVGPathSeg.PATHSEG_LINETO_ABS:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:i.x=h-i.x;break;case SVGPathSeg.PATHSEG_MOVETO_REL:case SVGPathSeg.PATHSEG_LINETO_REL:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:i.x=-i.x;break;case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:i.x=h-i.x;i.x1=h-i.x1;i.x2=h-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:i.x=-i.x;i.x1=-i.x1;i.x2=-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:i.x=h-i.x;i.x2=h-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:i.x=-i.x;i.x2=-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:i.x=h-i.x;i.x1=h-i.x1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:i.x=-i.x;i.x1=-i.x1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:i.x=h-i.x;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:i.x=-i.x;break;case SVGPathSeg.PATHSEG_ARC_ABS:i.x=h-i.x;i.sweepFlag=1-i.sweepFlag;break;case SVGPathSeg.PATHSEG_ARC_REL:i.x=-i.x;i.sweepFlag=1-i.sweepFlag}}a=v(e,"c_helper_dots");if(a){o=a.split(/[\s\,]+/);for(c=0,d=o.length-1;c<d;c+=2)o[c]=h-o[c];s=o.splice(4,2);o.push(s[0],s[1]);v(e,"c_helper_dots",o.join(","))}}if(null!==r){for(c=0;c<d;c++){i=l.getItem(c);switch(i.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:case SVGPathSeg.PATHSEG_LINETO_ABS:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:i.y=f-i.y;break;case SVGPathSeg.PATHSEG_MOVETO_REL:case SVGPathSeg.PATHSEG_LINETO_REL:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:i.y=-i.y;break;case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:i.y=f-i.y;i.y1=f-i.y1;i.y2=f-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:i.y=-i.y;i.y1=-i.y1;i.y2=-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:i.y=f-i.y;i.y2=f-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:i.y=-i.y;i.y2=-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:i.y=f-i.y;i.y1=f-i.y1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:i.y=-i.y;i.y1=-i.y1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:i.y=f-i.y;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:i.y=-i.y;break;case SVGPathSeg.PATHSEG_ARC_ABS:i.y=f-i.y;i.sweepFlag=1-i.sweepFlag;break;case SVGPathSeg.PATHSEG_ARC_REL:i.y=-i.y;i.sweepFlag=1-i.sweepFlag}}a=v(e,"c_helper_dots");if(a){o=a.split(/[\s\,]+/);for(c=0,d=o.length-1;c<d;c+=2)o[c+1]=f-o[c+1];s=o.splice(4,2);o.push(s[0],s[1]);v(e,"c_helper_dots",o.join(","))}}n&&ji.svg.fixOperaPathDAttribute(e);Vi&&v(e,"d",v(e,"d"))}},na={get:function(e){var t=e.tagName;if("path"==t&&void 0!==ya&&(ya==ii.PCB||ya==ii.PCBMODULE||ya==ii.PCBLIB)){var r=ee(e);"DIMENSION"!=r&&"PROTRACTOR"!=r||(t=r)}if("g"==t&&void 0!==ya&&(ya==ii.PCB||ya==ii.PCBMODULE||ya==ii.PCBLIB)){r=ee(e);"FOOTPRINT"==r&&(t=r)}return na[t]?na[t].get.apply(e,arguments):[]},set:function(e){var t=e.tagName;if("path"==t&&void 0!==ya&&(ya==ii.PCB||ya==ii.PCBMODULE||ya==ii.PCBLIB)){var r=ee(e);"DIMENSION"!=r&&"PROTRACTOR"!=r||(t=r)}if("g"==t&&void 0!==ya&&(ya==ii.PCB||ya==ii.PCBMODULE||ya==ii.PCBLIB)){r=ee(e);"FOOTPRINT"==r&&(t=r)}na[t]&&na[t].set.apply(e,arguments)},text:{get:function(e){var t=e.getBBox(),r=t.x,n=t.y,i=t.width,a=t.height,o=[r,n,r+i,n,r+i,n+a,r,n+a];o.onlyLines=1;o.c_helper_lines=[{type:"rect",data:t}];return o},set:function(e,t,r,n,i){ea.text(e,n,i)}},g:{get:function(e){if("part_annotation"===v(e,"c_partid"))return[];var t=e.getBBox(),r=t.x,n=t.y,i=t.width,a=t.height;return[r,n,r+i,n,r,n+a,r+i,n+a]},set:function(e,t,r,n,i){ea.g(e,n,i)}},svg:{get:function(e){return na.rect.get(e)},set:function(e,t,r,n,i){return na.rect.set(e,t,r,n,i)}},image:{get:function(e){var t=ji.svg.getViewBBox(e),r=[t.x,t.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height];r.c_helper_lines=[{from:0,to:1},{from:1,to:2},{from:2,to:3},{from:3,to:0}];return r},set:function(e,t,r,n,i){var a={x:t[0],y:t[1],width:t[2]-t[0],height:t[5]-t[1]};if(0===r||3==r){a.x+=n;a.width-=n}if(0===r||1==r){a.y+=i;a.height-=i}1!=r&&2!=r||(a.width+=n);2!=r&&3!=r||(a.height+=i);if(0!==a.width&&0!==a.height){if(a.width<0){a.width=-a.width;a.x-=a.width}if(a.height<0){a.height=-a.height;a.y-=a.height}var o=xe(e);90!=o&&270!=o||(a.width=[a.height,a.height=a.width][0]);a.transform=o?Le(a,o):"";v(e,a)}}},rect:{get:function(e){var t=+v(e,"x"),r=+v(e,"y"),n=+v(e,"width"),i=+v(e,"height");return[t,r,t+n,r,t+n,r+i,t,r+i]},set:function(e,t,r,n,i){t||(t=na.rect.get(e));var a={x:t[0],y:t[1],width:t[2]-t[0],height:t[5]-t[1]};if(0===r||3==r){a.x+=n;a.width-=n}if(0===r||1==r){a.y+=i;a.height-=i}1!=r&&2!=r||(a.width+=n);2!=r&&3!=r||(a.height+=i);if(0!==a.width&&0!==a.height){if(a.width<0){a.width=-a.width;a.x-=a.width}if(a.height<0){a.height=-a.height;a.y-=a.height}v(e,a)}}},circle:{get:function(e){var t=+v(e,"cx"),r=+v(e,"cy"),n=+v(e,"r");return[t,r,t,r-n,t,r+n,t-n,r,t+n,r]},set:function(e,t,r,n,i){t||(t=na.circle.get(e));var a={cx:t[0],cy:t[1],r:t[1]-t[3]};if(0===r){a.cx+=n;a.cy+=i}1==r&&(a.r-=i);2==r&&(a.r+=i);3==r&&(a.r-=n);4==r&&(a.r+=n);if(0!==a.r){a.r<0&&(a.r=-a.r);v(e,a)}}},ellipse_0:{get:function(e){var t=+v(e,"cx"),r=+v(e,"cy"),n=+v(e,"rx"),i=+v(e,"ry");return[t,r,t,r-i,t,r+i,t-n,r,t+n,r]},set:function(e,t,r,n,i){t||(t=na.ellipse_0.get(e));var a={cx:t[0],cy:t[1],rx:t[0]-t[6],ry:t[1]-t[3]};if(0===r){a.cx+=n;a.cy+=i}1==r&&(a.ry-=i);2==r&&(a.ry+=i);3==r&&(a.rx-=n);4==r&&(a.rx+=n);if(0!==a.rx&&0!==a.ry){a.rx<0&&(a.rx=-a.rx);a.ry<0&&(a.ry=-a.ry);v(e,a)}}},ellipse:{get:function(e){var t=+v(e,"cx"),r=+v(e,"cy"),n=+v(e,"rx"),i=+v(e,"ry");return[t-n,r-i,t+n,r-i,t-n,r+i,t+n,r+i]},set:function(e,t,r,n,i){t||(t=na.ellipse.get(e));var a={cx:(t[0]+t[2])/2,cy:(t[1]+t[5])/2,rx:(t[2]-t[0])/2,ry:(t[5]-t[1])/2};a.cx+=n/2;a.cy+=i/2;0===r||2==r?a.rx-=n/2:a.rx+=n/2;0===r||1==r?a.ry-=i/2:a.ry+=i/2;if(0!==a.rx&&0!==a.ry){a.rx<0&&(a.rx=-a.rx);a.ry<0&&(a.ry=-a.ry);v(e,a)}}},line:{get:function(e){return[+v(e,"x1"),+v(e,"y1"),+v(e,"x2"),+v(e,"y2")]},set:function(e,t,r,n,i){t||(t=na.line.get(e));var a={x1:t[0],y1:t[1],x2:t[2],y2:t[3]};if(0===r){a.x1+=n;a.y1+=i}if(1==r){a.x2+=n;a.y2+=i}v(e,a)}},polyline:{get:function(e){for(var t=F(v(e,"points")).split(/[\s\,]+/g),r=0;r<t.length;r++)t[r]=+t[r];for(r=t.length-2;r>=2;r-=2)t.splice(r,0,(t[r-2]+t[r])/2,(t[r-1]+t[r+1])/2);t.lightDots="odd";return t},set:function(e,t,r,n,i){var a=t.slice(0);a[2*r]+=n;a[2*r+1]+=i;if(r%2&&(!Se(2*a[2*r],a[2*r-2]+a[2*r+2])||!Se(2*a[2*r+1],a[2*r-1]+a[2*r+3]))){a.splice(2*r+2,0,0,0);a.splice(2*r,0,0,0)}for(var o=4,s=a.slice(0,2);o<a.length-1;o+=4)s.push(a[o],a[o+1]);for(var c=!0,l=2;l<s.length-1;l+=2)if(s[l]!=s[0]||s[l+1]!=s[1]){c=!1;break}if(!c){v(e,{points:ji.fixLongNumberString(s.join(" "))})}}},polygon:{get:function(e){for(var t=F(v(e,"points")).split(/[\s\,]+/g),r=0;r<t.length;r++)t[r]=+t[r];for(r=t.length-2;r>=2;r-=2)t.splice(r,0,(t[r-2]+t[r])/2,(t[r-1]+t[r+1])/2);r=t.length-2;t.push((t[0]+t[r])/2,(t[1]+t[r+1])/2);t.lightDots="odd";return t},set:function(e,t,r,n,i){var a,o=t.slice(0),s=2*r;o[s]+=n;o[s+1]+=i;if(r==o.length/2-1)Se(2*o[s],o[0]+o[s-2])&&Se(2*o[s+1],o[1]+o[s-1])||o.splice(s,0,0,0);else if(r%2&&(!Se(2*o[s],o[s-2]+o[s+2])||!Se(2*o[s+1],o[s-1]+o[s+3]))){o.splice(s+2,0,0,0);o.splice(s,0,0,0)}for(s=4,a=o.slice(0,2);s<o.length-1;s+=4)a.push(o[s],o[s+1]);for(var c,l={},d=[],h=0;h<a.length-1&&d.length<4;h+=2){c=a[h]+"_"+a[h+1];if(!l[c]){l[c]=!0;d.push(h)}}if(!(d.length<=2)){var f,u,p,g,y,x,m=!0;for(r=2;r<d.length;r++){f=a[d[0]],u=a[d[0]+1],p=a[d[1]],g=a[d[1]+1],y=a[d[r]],x=a[d[r]+1];if(!Se((f-p)*(x-g),(y-p)*(u-g))){m=!1;break}}if(!m){v(e,{points:ji.fixLongNumberString(a.join(" "))})}}}},path:{get:function(e){var t=ji.svg.getPathHelperType(e);if(t){var r=e.tagName+"_"+t;if(na[r]&&na[r].get)return na[r].get.apply(e,arguments)}var n,i,a,o,s,c,l,d,h,f,u=e.pathSegList,p=u.numberOfItems,g=0,y=0,v=[],x=0,m=0,_=[];for(n=0;n<p;n++){a=u.getItem(n);o=a.pathSegType;0===n&&2!=o&&3!=o&&1!=o&&v.push(g,y);i=v.length/2-1;switch(o){case 1:g=x;y=m;break;case 2:g=a.x;y=a.y;x=g;m=y;if(n+1==p)break;l=u.getItem(n+1);c=l.pathSegType;if(2==c||3==c||1==c)break;v.push(g,y);4==c&&v.push((g+l.x)/2,(y+l.y)/2);break;case 4:v.push(g=a.x,y=a.y);if(n+1==p)break;l=u.getItem(n+1);c=l.pathSegType;1==c&&(l=u.getItem(0));4!=c&&1!=c||v.push((g+l.x)/2,(y+l.y)/2);break;case 12:v.push(g=a.x,y);break;case 14:v.push(g,y=a.y);break;case 6:_.push({from:i,to:i+1},{from:i+2,to:i+3});v.push(a.x1,a.y1,g=a.x2,y=a.y2,a.x,a.y);break;case 16:_.push({from:i+1,to:i+2});v.push(a.x2,a.y2,g=a.x,y=a.y);break;case 8:_.push({from:i,to:i+1},{from:i+1,to:i+2});v.push(a.x1,a.y1,g=a.x,y=a.y);break;case 18:case 10:s=u.getItem(n-1);d=ji.arc.getCenterParam(s.x,s.y,a.x,a.y,a.largeArcFlag?1:0,a.sweepFlag?1:0,a.r1,a.r2,a.angle);h=d.cx,oy=d.cy;f=me([s.x,s.y],[h,oy],d.delta_theta/2);v.push(f[0],f[1]);v.push(g=a.x,y=a.y);if(n+1==p)break;l=u.getItem(n+1);c=l.pathSegType;1==c&&(l=u.getItem(0));4!=c&&1!=c||v.push((g+l.x)/2,(y+l.y)/2);break;case 3:g+=a.x;y+=a.y;x=g;m=y;if(n+1==p)break;c=u.getItem(n+1).pathSegType;if(2==c||3==c||1==c)break;v.push(g,y);break;case 5:v.push(g+=a.x,y+=a.y);break;case 13:v.push(g+=a.x,y);break;case 15:v.push(g,y+=a.y);break;case 7:_.push({from:i,to:i+1},{from:i+2,to:i+3});v.push(g+a.x1,y+a.y1,g+a.x2,y+a.y2,g+=a.x,y+=a.y);break;case 17:_.push({from:i+1,to:i+2});v.push(g+a.x2,y+a.y2,g+=a.x,y+=a.y);break;case 9:_.push({from:i+1,to:i+2});v.push(g+a.x1,y+a.y1,g+=a.x,y+=a.y);break;case 19:case 11:v.push(g+=a.x,y+=a.y)}a.pathSegType}_.length?v.c_helper_lines=_:v.lightDots="odd";return v},set:function(e,t,r,n,i,a){if(0!==n||0!==i){var o=ji.svg.getPathHelperType(e);if(o){var s=e.tagName+"_"+o;if(na[s]&&na[s].set){na[s].set.apply(e,arguments);return}}var c,l,d;if(/[^ahvqtsc]/i.test(a)){c=!0;l=t.slice(0);if(2*r+1<l.length){l[2*r]+=n;l[2*r+1]+=i}for(d=2;d<l.length-1;d+=2)if(l[d]!=l[0]||l[d+1]!=l[1]){c=!1;break}if(c)return}var h,f,u,p,g,y,x,m,_,b,S,C,P,w=e.pathSegList,N=w.numberOfItems,A=-1,k=r,O=v(e,"d");a&&v(e,{d:a});t.c_helper_lines||(r>>=1);if(!t.c_helper_lines&&k%2){f=w.getItem(r+1);if(10==f.pathSegType){u=w.getItem(r);g=t[2*k];y=t[2*k+1];x=se({x:u.x,y:u.y},{x:f.x,y:f.y},{x:g+n,y:y+i});x<4&&(x=4);x=Math.sqrt(x);m=f.sweepFlag;_=f.r1;b=pe(u.x,u.y,f.x,f.y);_*_-b/4;S=(f.x-u.x)*(y-u.y)-(g-u.x)*(f.y-u.y);C=(f.x-u.x)*(y+i-u.y)-(g+n-u.x)*(f.y-u.y);S*C<0&&(m^=1);_=b/(8*x)+x/2;P=_>x?0:1;_=ji.formatLengthSave(_);f.r1=_;f.r2=_;f.largeArcFlag=P;f.sweepFlag=m}else w.insertItemBefore(e.createSVGPathSegLinetoAbs(t[2*k]+n,t[2*k+1]+i),r+1)}else{e:for(h=0;h<N;h++){f=w.getItem(h);switch(f.pathSegType){case 1:break;case 2:case 3:if(h+1==N)break;p=w.getItem(h+1).pathSegType;if(2==p||3==p||1==p)break;A++;if(A==r){f.x=ji.toFixed(f.x+n,3);f.y=ji.toFixed(f.y+i,3);break e}break;case 4:case 5:A++;if(A==r){f.x=ji.toFixed(f.x+n,3);f.y=ji.toFixed(f.y+i,3);break e}break;case 12:case 13:A++;if(A==r){f.x+=n;break e}break;case 14:case 15:A++;if(A==r){f.y+=i;break e}break;case 6:case 7:A++;if(A==r){f.x1+=n;f.y1+=i;break e}A++;if(A==r){f.x2+=n;f.y2+=i;break e}A++;if(A==r){f.x+=n;f.y+=i;break e}break;case 16:case 17:A++;if(A==r){f.x2+=n;f.y2+=i;break e}A++;if(A==r){f.x+=n;f.y+=i;break e}break;case 8:case 9:A++;if(A==r){f.x1+=n;f.y1+=i;break e}A++;if(A==r){f.x+=n;f.y+=i;break e}break;case 18:case 19:case 11:case 10:A++;if(A==r){f.x+=n;f.y+=i;break e}}}var T=ee(e);"COPPERAREA"!=T&&"SOLIDREGION"!=T||jt(e)||v(e,"d",O)}}else a&&v(e,{d:a})}},path_arc1:{get:function(e){var t=ji.arc.calculateArcHelperDots(e);t.c_helper_lines=ji.arc.c_helper_lines;return t},set:function(e,t,r,n,i,a){var o,s,c,l,d=t?t.slice(0):na.path_arc1.get(e),h=!(ya==ii.PCBLIB||ya==ii.PCB);if(0===r){a&&v(e,{d:a});ji.Dots.eachAdd(d,n,i);ea.path(e,n,i)}else{d[2*r]+=n;d[2*r+1]+=i;o=Math.abs(d[0]-d[2]);s=Math.abs(d[1]-d[3]);if(0===o||0===s)return;if(h){o=Math.abs(d[0]-d[2]);s=Math.abs(d[1]-d[3])}else o=s=ge(d[0],d[1],d[2],d[3]);c=ji.arc.getArcParams(d[0],d[1],o,s,d[4],d[5],d[6],d[7]);if(null===c)return;c.x1=ji.formatLengthSave(c.x1);c.y1=ji.formatLengthSave(c.y1);o=ji.formatLengthSave(o);s=ji.formatLengthSave(s);c.x2=ji.formatLengthSave(c.x2);c.y2=ji.formatLengthSave(c.y2);l="M"+c.x1+","+c.y1+" A"+o+","+s+" 0 "+c.fa+" "+c.fs+" "+c.x2+","+c.y2;v(e,{d:l})}v(e,{c_helper_dots:d.join(",")})}},path_arc2:{get:function(e){var t,r=[],n=e.getPathData();for(t=0;t<n.length;t++)if("A"==n[t].type){var i=n[t-1].values,a=n[t].values,o=ji.arc.getCenterParam(i[0],i[1],a[5],a[6],a[3],a[4],a[0],a[1],a[2]),s=o.cx,c=o.cy,l=me([i[0],i[1]],[s,c],o.delta_theta/2);r.push(i[0],i[1],a[5],a[6],l[0],l[1]);break}return r},set:function(e,t,r,n,i,a){if(0!==n||0!==i){var o,s,c,l=t?t.slice(0):na.path_arc2.get(e);if(!(0===r&&Se(l[0]+n,l[2])&&Se(l[1]+i,l[3])||1===r&&Se(l[2]+n,l[0])&&Se(l[3]+i,l[1])||2===r&&Se((l[2]-l[0])*(l[5]+i-l[1]),(l[3]-l[1])*(l[4]+n-l[0])))){if(2===r){o=se({x:l[0],y:l[1]},{x:l[2],y:l[3]},{x:l[4]+n,y:l[5]+i});if(o<4)return;o=Math.sqrt(o)}a&&v(e,"d",a);var d=e.pathSegList.getItem(1),h=d.r1,f=+d.largeArcFlag,u=+d.sweepFlag,p=pe(l[0],l[1],l[2],l[3]),g=h*h-p/4;if(2==r){s=(l[2]-l[0])*(l[5]-l[1])-(l[4]-l[0])*(l[3]-l[1]);l[2*r]+=n;l[2*r+1]+=i;c=(l[2]-l[0])*(l[5]-l[1])-(l[4]-l[0])*(l[3]-l[1]);s*c<0&&(u^=1)}else{o=h+(f?1:-1)*(g>0?Math.sqrt(g):0);l[2*r]+=n;l[2*r+1]+=i;p=pe(l[0],l[1],l[2],l[3])}h=p/(8*o)+o/2;f=h>o?0:1;l[0]=ji.formatLengthSave(l[0]);l[1]=ji.formatLengthSave(l[1]);h=ji.formatLengthSave(h);l[2]=ji.formatLengthSave(l[2]);l[3]=ji.formatLengthSave(l[3]);v(e,"d","M"+l[0]+","+l[1]+" A"+h+","+h+" 0 "+f+" "+u+" "+l[2]+","+l[3])}}else a&&v(e,{d:a})}},path_pie1:{get:function(e){var t=ji.arc.calculateArcHelperDots(e);t.c_helper_lines=ji.arc.c_helper_lines_pie1;return t},set:function(e,t,r,n,i,a){var o=t?t.slice(0):na.path_pie1.get(e);if(0===r){a&&v(e,{d:a});ji.Dots.eachAdd(o,n,i);ea.path(e,n,i)}else{o[2*r]+=n;o[2*r+1]+=i;var s=Math.abs(o[0]-o[2]),c=Math.abs(o[1]-o[3]);if(0===s||0===c)return;var l=ji.arc.getArcParams(o[0],o[1],s,c,o[4],o[5],o[6],o[7]);if(!l)return;l.x1=ji.formatLengthSave(l.x1);l.y1=ji.formatLengthSave(l.y1);s=ji.formatLengthSave(s);c=ji.formatLengthSave(c);l.x2=ji.formatLengthSave(l.x2);l.y2=ji.formatLengthSave(l.y2);v(e,{d:"M"+o[0]+","+o[1]+" L"+l.x1+","+l.y1+" A"+s+","+c+" 0 "+l.fa+" "+l.fs+" "+l.x2+","+l.y2+"Z"})}}},DIMENSION:{get:function(e){return oa.getStartAndEndPointByDimensionElement(e)},set:function(e,t,r,n,i,a){if(!(t.length<4)){var o=t.slice(2*r,2*r+1+1),s=r>0?[t[0],t[1]]:[t[2],t[3]],c=v(e,"c_fontSize"),l=v(e,"c_unit"),d=v(e,"c_precision"),h=v(e,"layerid")==ni.BOTTOMSILKLAYER;v(e,"d",oa.getDimensionPath({fromP:{x:s[0],y:s[1]},toP:{x:o[0]+n,y:o[1]+i},fontSize:c,precision:d,unit:l,mirror:h}));Ct("updateAttrPanel")}}},PROTRACTOR:{getAngle:function(e){var t=na.PROTRACTOR.get(e),r=ge(t[0],t[1],t[2],t[3]),n=ge(t[0],t[1],t[4],t[5]),i=ge(t[2],t[3],t[4],t[5]),a=(Math.pow(n,2)+Math.pow(r,2)-Math.pow(i,2))/(2*r*n);return(180*Math.acos(a)/Math.PI).toFixed(3)},get:function(e){var t=e.getPathData();return t.length<7?[]:t[0].values.concat(t[1].values,t[3].values,t[6].values)},setAngle:function(e,t){t%=360;t>180&&(t-=180);points=na.get(e);var r=Ne({x:points[4],y:points[5]},{x:points[0],y:points[1]},{x:points[2],y:points[3]}),n=180*Math.atan((points[3]-points[1])/(points[2]-points[0]))/Math.PI,i=n>0;n=points[2]>points[0]?n:n>0?180-n:180+n;var a=t-na.PROTRACTOR.getAngle(e);"顺时针"===r&&points[2]>points[0]&&(a*=-1);points[2]<points[0]&&i&&"逆时针"===r&&(a*=-1);points[2]<points[0]&&!i&&"顺时针"===r&&(a*=-1);var o=n+a;points[2]<points[0]&&i&&(o*=-1);var s=ge(points[0],points[1],points[2],points[3]),c=Math.cos(o*Math.PI/180)*s,l=Math.sin(o*Math.PI/180)*s,d=points[0]+c,h=points[1]+l,f=d-points[2],u=h-points[3];na.PROTRACTOR.set(e,points,1,f,u);Cr(na.get(e))},set:function(e,t,r,n,i,a){var o;if(!(t.length<8)){var s=[t[0],t[1]],c=[t[2],t[3]],l=[t[4],t[5]],d=[],h=v(e,"c_fontSize"),f=v(e,"c_precision"),u=v(e,"layerid")==ni.BOTTOMSILKLAYER;if(0===r){s[0]+=n;s[1]+=i}else if(1===r){c[0]+=n;c[1]+=i}else if(2===r){l[0]+=n;l[1]+=i}else{if(3!==r)return;d[0]=t[6]+n;d[1]=t[7]+i}o=oa.getProtractorPath(s,c,l,{fontPoint:d,fontSize:h,canAdjustLineLength:!0,precision:f,mirror:u});if(o){v(e,"d",o);Ct("updateAttrPanel")}}}},FOOTPRINT:{get:function(e){if("part_annotation"===v(e,"c_partid"))return[];var t=v(e,"id"),r=v(e,"c_origin"),n=v(e,"layerid"),i=v(e,"c_rotation"),a=r.split(","),o=+a[0],s=+a[1];null==i&&(i=0);var c={};if(w(Xi,t)){if((o!==Xi[t].co.x||s!==Xi[t].co.y||Xi[t].layer!==n)&&!zi.on){ta.g(e,parseFloat(i).toFixed(2));c=ji.svg.getPlainBBox(e);l=0;e.childNodes.forEach(function(e){"part_pad"!==v(e,"c_partid")||"1"!==v(e,"layerid")&&"2"!==v(e,"layerid")||e.childNodes.forEach(function(e){"TRACK"===ee(e)&&(l=+v(e,"stroke-width")/2)})});c.x-=l;c.width+=2*l;Xi[t]=c;Xi[t].co={x:o,y:s};Xi[t].layer=n;ta.g(e,360-parseFloat(i).toFixed(2))}c=Xi[t]}else{ta.g(e,parseFloat(i).toFixed(2));c=ji.svg.getPlainBBox(e);var l=0;e.childNodes.forEach(function(e){"part_pad"!==v(e,"c_partid")||"1"!==v(e,"layerid")&&"2"!==v(e,"layerid")||e.childNodes.forEach(function(e){"TRACK"===ee(e)&&(l=+v(e,"stroke-width")/2)})});c.x-=l;c.width+=2*l;Xi[t]=c;Xi[t].co={x:o,y:s};Xi[t].layer=n;ta.g(e,360-parseFloat(i).toFixed(2))}var d={dots1:[c.x-.5,c.y-.5],centP1:[o,c.y+.5],dots2:[c.x+c.width+.5,c.y-.5],centP2:[c.x+c.width+.5,s],dots3:[c.x-.5,c.y+c.height+.5],centP3:[o,c.y+c.height+.5],dots4:[c.x+c.width+.5,c.y+c.height+.5],centP4:[c.x-.5,s]},h=[o,c.y-5],f=[o,s],u=_e(h,f,i),p=_e(d.dots1,f,parseFloat(i).toFixed(2)),g=_e(d.dots2,f,parseFloat(i).toFixed(2)),y=_e(d.dots3,f,parseFloat(i).toFixed(2)),x=_e(d.dots4,f,parseFloat(i).toFixed(2)),m=_e(d.centP1,f,parseFloat(i).toFixed(2)),_=_e(d.centP2,f,parseFloat(i).toFixed(2)),b=_e(d.centP3,f,parseFloat(i).toFixed(2)),S=_e(d.centP4,f,parseFloat(i).toFixed(2)),C=[u[0],u[1],o,s,p[0],p[1],m[0],m[1],g[0],g[1],_[0],_[1],y[0],y[1],b[0],b[1],x[0],x[1],S[0],S[1]];C.c_helper_lines=[{from:0,to:1},{from:2,to:4},{from:4,to:8},{from:8,to:6},{from:6,to:2},{from:3,to:7},{from:5,to:9}];C.visible_dots=[0,1,2,3,4,5,6,7,8,9];C.isRotate=!0;return C},set:function(e,t,r,n,i){if(0===r){v(da.children[0],{visibility:"hidden"});var a=v(e,"c_rotation")||0,o=0,s=t[0]+n,c=t[1]+i,l=s-t[2],d=c-t[3],h=Math.sqrt(Math.pow(l,2)+Math.pow(d,2)),f=l/h,u=Math.acos(f),p=180/(Math.PI/u);d>0&&(p=360-p);var g;o=360-(90-p);o=ji.toFixed(o,0);if(isNaN(o))return"";g=be(360-(parseFloat(o).toFixed(1)-parseFloat(a).toFixed(1)));ta.g(e,g);Ct("updateAttrPanel")}else{var y=v(e,"c_origin"),x=y.split(",");Et(e,Number(x[0])+n,Number(x[1])+i)}}},alwaysNotSnap:function(e,t){var r=na.getHelperType(e);return r&&(("arc1"==r||"pie1"==r)&&(2==t||3==t)||"arc2"==r&&2==t)},getHelperType:function(e){var t=v(e,"c_helper_type");if(t)return t;if("path"==e.tagName){var r=e.pathSegList,n=r.numberOfItems;if(2==n&&"A"==r.getItem(1).pathSegTypeAsLetter)return ya==ii.PCB||ya==ii.PCBLIB?"arc2":"arc1";if(4==n&&"L"==r.getItem(1).pathSegTypeAsLetter&&"A"==r.getItem(2).pathSegTypeAsLetter)return"pie1"}return""}},ia={_PCBSnapStack:[.2,.25,.5,1,1.25,2.5,5,10],altKeyEnabled:!1,getSanpSize:function(e){return ia.altKeyEnabled?+_i.adsorbGrid.altSnapSize||1:+_i.adsorbGrid["distance"+e]||1},getPCBSnapSizeList:function(){var e=_i.canvas.unit,t="";ia._PCBSnapStack.forEach(function(r){t+='<option value="'+ji.toFixed(ji.units.convert(r,"pixel",e),ji.units.decimals[e])+'">'});return t}},aa=function(){function e(){if(!n){n=!0;t=o("gControlLocks");r=t&&c("g",t);var e=function(){};for(var s in i)w(i,s)&&(a[s]=r||"function"!=typeof i[s]?i[s]:e);r&&t.addEventListener("click",function(e){var t=e.target.parentNode.id,r=t&&o(t.replace("lock",""));r&&i.unlockObjs([r])},!1)}}var t,r,n,i={attName:"locked",init:e,isLocked:function(e){return"1"===v(e,"locked")},updateOne:function(e){e&&Jn.contains(e)&&i.isLocked(e)?i.lockObjs([e]):i.unlockObjs([e])},updateMore:function(e){for(var t=0;t<e.length;t++)e[t]&&i.updateOne(e[t])},createLockUi:function(e){!e||e.length},lockObjs:function(e){aa.setLockStatus(e,!0);Ct("triggerEvent",["select_change"])},unlockObjs:function(e){aa.setLockStatus(e,!1);Ct("triggerEvent",["select_change"])},setLockStatus:function(e,r){if(1===arguments.length){r=e;e=void 0}var n=e||Ar();if(n&&n.length){var a=r?1:"",s=[].map.call(n,function(e){if(v(e,"locked")!=a)return e.id}).join(",");v(n,"locked",a);di.updateMore(n,{notCopper:!0,noRebuildPlane:!0});if(a)i.createLockUi(n);else for(var c=0;c<n.length;c++){var l=o("lock"+n[c].id,t);l&&t.removeChild(l)}xi.save(["attr",s,{locked:r?"":"1"},{locked:a}])}},resize:function(){for(var e=s('g:not([display="none"])',t),r=20/Wi,n=0;n<e.length;n++){var i=c("rect",e[n]),a={x:+v(i,"x"),y:+v(i,"y"),width:+v(i,"width"),height:+v(i,"height")};v(c("use",e[n]),{x:a.width>r?a.x:a.x+(a.width-r)/2,y:a.y-r,width:r,height:r})}}},a={};for(var l in i)w(i,l)&&("function"==typeof i[l]?a[l]=function(t,a){return function(){n||e();return r?a.apply(i,arguments):void 0}}(0,i[l]):a[l]=i[l]);return a}();!function(){function e(r){this.ready=0;this.start=0;if(r)for(var n in r)w(r,n)&&(this[n]=r[n]);e.instance=this;t.addEventListener("mousedown",this.mdown,!1)}e.prototype={mdown:function(r){var n=e.instance;1==r.button&&r.preventDefault();if((r.button===ti||1===r.button)&&!(r.ctrlKey||r.metaKey||r.shiftKey||r.altKey)&&r.target!=t.documentElement&&hi.contains(r.target)&&!n.ready){(ya==ii.PCB||ya==ii.PCBMODULE)&&Li.showAll();var i=r.clientX,a=r.clientY;n.lastX=i;n.lastY=a;n.ready=1;n.start=0;n.helperCursorBefore=vi;Ot("grabbing");t.addEventListener("mousemove",n.mmove,!1);t.addEventListener("mouseup",n.mup,!1);t.addEventListener("contextmenu",n.contextmenu,!1)}},contextmenu:function(t){var r=e.instance;r.ready&&!t.defaultPrevented&&r.mupRight(t)},mmove:function(t){var r=e.instance;if(r.ready&&(!t.buttons||6&t.buttons)){var n=t.clientX,i=t.clientY,a=n-r.lastX,o=i-r.lastY;if(!r.start){if(a*a+o*o<=36)return}r.lastX=n;r.lastY=i;if(!r.start){Pi.dragpanning=!0;r.start=1;r.rootcursor=h(hi,"cursor-none");r.ondragstart&&r.ondragstart({dx:a,dy:o,originalEvent:t})}r.ondrag&&r.ondrag({dx:a,dy:o,originalEvent:t})}},mup:function(t){var r=e.instance;t.button!==ti&&1!==t.button||r.mupRight(t)},mupRight:function(r){var n=e.instance;if(n.ready){t.removeEventListener("mousemove",n.mmove,!1);t.removeEventListener("mouseup",n.mup,!1);t.removeEventListener("contextmenu",n.contextmenu,!1);var i=n.start;n.ready=0;n.start=0;if("grabbing"==vi){var a=n.helperCursorBefore;a?n.rootcursor?Ot(a,!0):Ot(a):Ot()}i&&n.ondragend&&n.ondragend({originalEvent:r})}}};Ai=function(){Ni=new e({ondrag:function(e){var t=e.dx,r=e.dy,n=ua.getViewBox();n[0]-=t/Wi;n[1]-=r/Wi;ua.setViewBox(n)},ondragend:function(e){Pi.dragpanning=!0;setTimeout(function(){Pi.dragpanning=!1},5)}})}}();var oa={makePArrFromStr:function(e){for(var t=[],r=e.replace(/[\s,]+/g,","),n=r.split(","),i=n.length,o=0;o<i-1;o++){var s=new a(n[o],n[o+1]);t.push(s)}return t},distancePointToPoint:function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},ptOnLine:function(e,t,r){var n=Math.min,i=Math.max;return n(t.x,r.x)<=e.x&&e.x<=i(t.x,r.x)&&n(t.y,r.y)<=e.y&&e.y<=i(t.y,r.y)&&(e.x-t.x)*(r.y-t.y)==(r.x-t.x)*(e.y-t.y)},ptOnPolyline:function(e,t){if(!t||!t.length)return!1;for(var r=t.length,n=0;n<r-1;n++)if(oa.ptOnLine(e,t[n],t[n+1]))return!0;return!1},getWireByXY:function(e,t){for(var r=s("#g1>polyline[c_etype=wire]",Jn),n=r.length,i=0;i<n;i++){var a={x:e,y:t};if(oa.isPointOnPolyline(a,r[i]))return r[i]}},getLengthOfTrackAndArc:function(e,t){if(!e||!e.d&&!e.pointArr)return 0;for(var r=e.d?convertArcToTrackPoints(e,!1):e.pointArr,n=0,i=0,a=r.length-1;i<a;i++)n+=oa.distancePointToPoint(r[i],r[i+1]);t&&(n=ji.units.convert(n,"pixel",_i.canvas.unit));return ji.formatLengthSave(n)},isPointOnPolyline:function(e,t){var r=t.getBBox(),n=e.x,i=e.y;if(n<r.x||n>r.x+r.width||i<r.y||i>r.y+r.height)return!1;var a=t.points;if(n==a.getItem(0).x&&i==a.getItem(0).y)return!0;for(var o=1,s=a.length||a.numberOfItems;o<s;o++)if(oa.ptOnLine(e,a.getItem(o-1),a.getItem(o)))return!0;return!1},formatWirePoints:function(e,t,r,n,i){function o(e,t){return Math.abs(e-t)}r=+r;n=+n;if(0===t)return e.join(" ")+" "+r+" "+n;var s=e.length;if(!(s<2)){for(var c=0;c<s;c++)e[c]=+e[c];var l=new a(r,n),d=new a(e[s-2],e[s-1]),h=new a(0,0),f=o(l.x,d.x),u=o(l.y,d.y);if(90===t){if(f&&u){var p=i.points.numberOfItems-s/2,g=ge(d.x,d.y,r,n),y=!0;if(g<30/Wi)y=f>u;else if(p<=0)y=f>u;else if(p>0){var v=i.points.getItem(s/2);y=v.y==d.y}}else y=!u;if(f&&u){if(y){h.x=l.x;h.y=d.y}else{h.x=d.x;h.y=l.y}return e.concat([h.x,h.y,r,n]).join(" ")}return e.join(" ")+" "+r+" "+n}if(f>u){var x=o(l.y,d.y);h.y=d.y;l.x>d.x?h.x=l.x-x:h.x=l.x+x;return e.concat([h.x,h.y,r,n]).join(" ")}if(f<u){var m=o(l.x,d.x);h.x=d.x;l.y>d.y?h.y=l.y-m:h.y=l.y+m;return e.concat([h.x,h.y,r,n]).join(" ")}return e.join(" ")+" "+r+" "+n}},simplifyWire:function(e){var t,r,n=I(v(e,"points")),i=di.getWires();e.getBBox();for(var a in i)if(w(i,a)&&a!=e.id&&o(a)){var s=i[a],c=[],l=n[0],d=n[n.length-1],h=oa.ptOnPolyline(l,s),f=oa.ptOnPolyline(d,s);if(!h&&!f)continue;if(s.length<2)continue;if(h&&f)return{status:"invalidWire"};h&&(n=n.reverse());if(n.length>2)for(t=1,r=n.length-1;t<r;t++)oa.ptOnPolyline(n[t],s)&&c.push(n[t]);for(t=0,r=s.length;t<r;t++)oa.ptOnPolyline(s[t],n)&&c.push(s[t]);var u=!1;if(c.length>0){var p=[],g=0,y=c.length;for(t=0,r=n.length;t<r-1;t++){u=!1;p.push(n[t]);for(g=0;g<y;g++)if(oa.ptOnLine(c[g],n[t],n[t+1])){u=!0;break}if(u){p.push(c[g]);break}}n=p}
var x=oa.isPointEqual(n[n.length-1],s[0])&&!di.hasJunctionAtXY(s[0].x,s[0].y),m=oa.isPointEqual(n[n.length-1],s[s.length-1])&&!di.hasJunctionAtXY(s[s.length-1].x,s[s.length-1].y);if(u&&(x||m)){m&&s.reverse();n.pop();n=n.concat(s);var _=o(a).cloneNode(!0);v(o(a),"points",E(n));return{status:"merge",wireId:a,oldNode:_}}}v(e,"points",E(n));return{status:"add"}},isPointEqual:function(e,t){return e.x==t.x&&e.y==t.y},approximateDistancesPoint2Point:function(e,t){return pe(e.x,e.y,t.x,t.y)},distancesPoint2Point:function(e,t){return Math.sqrt(this.approximateDistancesPoint2Point(e,t))}};Ht.data={clientX:null,clientY:null,lastUpX:null,lastUpY:null,uplock:!1,currAbsX:null,currAbsY:null};t.addEventListener("click",function(e){Ct("triggerClick",[e])},!1);var sa=function(){function e(){for(var a=Date.now();r.length&&Date.now()-a<100;)r.shift()();if(t){var o=r.length&&i?1-r.length/i:1;t(o)}r.length?setTimeout(e,0):n="idle"}var t,r=[],n="idle",i=0;return{addTask:function(e){r.push(e);return sa},run:function(){if("idle"==n){n="running";i=r.length;e()}},onProgress:function(e){t=e}}}(),Jn=o("g1"),ca=o("selectBox1"),la=o("gControlDots"),da=o("gRotateHelper"),ha=o("gControlRects"),fa=o("gControlLines");o("gCopperAreaOutlineCushions"),o("gPanelizedOutlines");en.prototype={mdown:function(e){var r=ki,n=fi,i=e.originalTarget||e.target||e.srcElement;if(e.button===ei&&n&&"cdot"==v(i,"c_shapetype")&&!aa.isLocked(n)){var a=xt(e,!1);hi.style.cursor="move";r.ready=!0;r.start=!1;r.target=n;r.x0=a.x;r.y0=a.y;r.dotIndex=+v(i,"id").substr(4);r.targetX0=+v(i,"cx");r.targetY0=+v(i,"cy");r.movedX=0;r.movedY=0;r.alwaysNotSnap=na.alwaysNotSnap(n,r.dotIndex);r.unitSnap=!0;var o=ee(n);r.unitSnap="wire"==o||"bus"==o;r.effectD0=na.get(n);r.pathD0=v(n,"d")||void 0;r.attrs=_(n);t.addEventListener("mousemove",r.mmove,!1);t.addEventListener("mouseup",r.mup,!1)}},mmove:function(e){var t,r,n,i,a,o,s,c,l=ki,d=l.target;if(d&&l.ready){ia.altKeyEnabled=e.altKey;var h=xt(e,!1);t=h.x-l.x0;r=h.y-l.y0;if(l.start||!((t*t+r*r)*Wi*Wi<9)){if(_i.adsorbGrid.enabled&&!l.alwaysNotSnap){n={x:t+l.targetX0,y:r+l.targetY0};i=je(n);var f,u=v(d,"c_etype");if("wire"==u){f=di.ifFind(t+l.targetX0,r+l.targetY0);f&&f.type&&(f.wireId&&f.wireId==d.id||pe(n.x,n.y,f.X,f.Y)<=pe(n.x,n.y,i.x,i.y)&&(i={x:f.X,y:f.Y}))}a=i.x-l.targetX0;o=i.y-l.targetY0}else{a=t;o=r}if(l.unitSnap)if("path"!=d.tagName){a=Math.round(a+l.targetX0)-l.targetX0;o=Math.round(o+l.targetY0)-l.targetY0}else{a=(a+l.targetX0).toFixed(2)-l.targetX0;o=(o+l.targetY0).toFixed(2)-l.targetY0}s=a-l.movedX;c=o-l.movedY;if(s||c){l.movedX=a;l.movedY=o;if(!l.start){l.start=!0;l.ondragstart&&l.ondragstart()}na.set(d,l.effectD0,l.dotIndex,l.movedX,l.movedY,l.pathD0);Nt(d);l.ondrag&&l.ondrag()}}}},mup:function(e){var r=ki;if(e.button===ei&&r.ready){t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);r.ready=!1;hi.style.cursor="";if(r.start){r.start=!1;r.ondragend&&r.ondragend()}}}};tn.prototype={mdown:function(e){if(yi)return!1;if(!zi.on&&e.button===ei&&!e.ctrlKey&&!e.metaKey){var r=e.target;if(r!=t.documentElement&&!/^(input|textarea|button|a)/i.test(r.tagName||"")&&"cdot"!=v(r,"c_shapetype")){if(Oi.stopMove(e))return!1;3==r.nodeType&&(r=r.parentNode);"tspan"==r.tagName&&(r=r.parentNode);var n=nr(r),i=n;!i&&Ui&&(i=Ui.target);if(i){for(;i&&i.parentNode!=Jn;)i=i.parentNode;var a=v(i,"c_shapetype");if("group"==a||"line"==a){var s=Oi,c=xt(e,!1);s.ready=!0;s.start=!1;s.target=i;s.evtTarget=r;s.selectedObjs=Ar().filter(function(e){return!aa.isLocked(e)});s.x0=c.x;s.y0=c.y;s.lastX=s.x0;s.lastY=s.y0;s.lastDX=0;s.lastDY=0;s.movedX=0;s.movedY=0;delete s.oldAttrs;if(!s.onready||!1!==s.onready()){s.addWire=[];!function(){function e(e,t){function n(e,t){if(e.x===t.x&&e.y===t.y){h=yn("polyline",{points:e.x+" "+e.y+" "+e.x+" "+e.y,"stroke-width":1,stroke:"#008800",fill:"none",c_shapetype:"line",c_etype:"wire"});d=it(h);s.addWire.push(d);Jn.appendChild(h);di.updateOne(h)}}for(var i in di.gJsonCache)if(w(di.gJsonCache,i)&&("netlabel"==i||"netflag"==i||"schlib"==i))for(r in di.gJsonCache[i])if(r!==t&&w(di.gJsonCache[i],r)&&!(s.selectedObjs.indexOf(o(r))>-1))if("schlib"==i){c=di.gJsonCache[i][r].pin;for(a in c)if(w(c,a)){l=c[a].pinDot;n(e,l)}}else{l=di.gJsonCache[i][r].pinDot;n(e,l)}}var t,r,n,i,a,c,l,d,h;s.selectedObjs.forEach(function(r){var a,o,s=ee(r);if("schlib"===s||"netlabel"===s||"netflag"===s){t=r.id;if("schlib"===s){a=di.gJsonCache.schlib[t];if(a){o=a.pin;for(i in o)if(w(o,i)){n=o[i].pinDot;e(n,t)}}}else{a=di.gJsonCache[s][t];if(a){n=a.pinDot;e(n,t)}}}})}();s.atPartText="group"==a&&"text"==r.tagName&&"part_pin"==v(i,"c_partid");s.atPartNoteText="group"==a&&function(e){return e&&"text"==e.tagName&&e.parentNode&&"part_annotation"==v(e.parentNode,"c_partid")&&e.parentNode.parentNode&&e.parentNode.parentNode.parentNode==Jn&&0!=e.parentNode.id.indexOf("frame_tick_")}(r);if(!s.atPartText&&!s.atPartNoteText||!aa.isLocked(n.parentNode)){hi.style.cursor="move";s.snapped=_i.adsorbGrid.enabled;s.unitSnap=!0;"part_annotation"===v(r.parentNode,"c_partid")?s.refPoint=He(r.parentNode):s.refPoint=De(s.selectedObjs);t.addEventListener("mousemove",s.mmove,!1);t.addEventListener("mouseup",s.mup,!1)}}}}}}},mmove:function(e){var t=Oi;if(t.ready){var r=t.target,n=t.selectedObjs.filter(function(e){return!aa.isLocked(e)}),i=v(r,"c_shapetype");if(r&&("group"==i||"line"==i)){ia.altKeyEnabled=e.altKey;var a,o,s,c,l,d=xt(e,!1),h=d.x,f=d.y,u=h-t.x0,p=f-t.y0;if(!t.start){if((u*u+p*p)*Wi*Wi<9)return;t.start=!0;if(t.ondragstart){a=t.ondragstart();if(!1===a){t.ready=!1;t.start=!1;return!1}}(t.atPartText||t.atPartNoteText)&&1===n.length&&t.snapped&&!v(t.evtTarget,"dy")&&v(t.evtTarget,"dy","-1")}t.lastX=h;t.lastY=f;t.lastDX=u;t.lastDY=p;var g,y,x,m=r.getBBox(),_={x:m.x+m.width/2,y:m.y+m.height/2},b=(t.atPartNoteText||t.atPartText)&&1===n.length,S="schlib"===ee(r)&&!b;if(S)for(var C=0;C<n.length;C++){var P=n[C].id;if(di.gJsonCache.schlib[P]&&di.gJsonCache.schlib[P].pin){var w=di.gJsonCache.schlib[P].pin;for(var N in w){g=w[N].pinDot;if(g)break}}if(g)break}g||(g=t.refPoint);if(S&&1===n.length&&!t.dragCenter){if(v(n[0],"c_origin")){t.dragCenter=ji.numberlistToArray(v(n[0],"c_origin"));t.dragCenter={x:t.dragCenter[0],y:t.dragCenter[1]}}else t.dragCenter={x:_.x,y:_.y}}if(t.snapped)if(e.shiftKey&&1===n.length&&S){y={x:g.x+h-t.dragCenter.x,y:g.y+f-t.dragCenter.y};x=je(y);o=x.x-g.x;s=x.y-g.y}else if(g){y={x:g.x+u,y:g.y+p};x=je(y);o=x.x-g.x;s=x.y-g.y}else{x=je({x:u,y:p});o=x.x;s=x.y}else if(t.unitSnap)if(g){y={x:Math.round(g.x+u),y:Math.round(g.y+p)};o=y.x-g.x;s=y.y-g.y}else{o=Math.round(u);s=Math.round(p)}else{o=u;s=p}c=o-t.movedX;l=s-t.movedY;if(c||l){t.movedX=o;t.movedY=s;if((t.atPartNoteText||t.atPartText)&&1===n.length){if(aa.isLocked(nr(t.evtTarget)))return;t.atPartText?ea.move(t.evtTarget,c,l):ea.move(t.evtTarget.parentNode,c,l);t.atPartText&&function(e){var t=e.children[0];t&&"circle"==t.tagName&&v(e,{c_origin:v(t,"cx")+","+v(t,"cy")})}(t.evtTarget.parentNode)}else Xe(n,c,l);t.ondrag&&t.ondrag()}}}},mup:function(e){if(e.button===ei){var r=Oi,n=r.selectedObjs;if(r.addWire.length){var i;r.addWire.forEach(function(e){i=o(e);if(i&&i.points&&2===i.points.numberOfItems&&i.points[0].x===i.points[1].x&&i.points[0].y===i.points[1].y){p(i);di.removeOne(i)}})}t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);if(r.ready){r.ready=!1;r.dragCenter=null;hi.style.cursor="";if(r.start){r.start=!1;var a=r.evtTarget.parentNode;if((r.atPartNoteText||r.atPartText)&&1===n.length&&a!=r.target){rr();fi=a;l(fi,"active",!0);var s=Mn(fi);Ct("noneselected");Ct("show_attrpanel",[s])}r.ondragend&&r.ondragend()}}}},stopMove:function(e){var t,r=Ar();if(1===r.length&&!e.shiftKey){t=ee(r[0]);if("wire"===t||"bus"===t)return!0}return!1}};rn.prototype={mdown:function(e){if(e.button===ei&&!(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||"cdot"==v(e.target,"c_shapetype")||Ui)){var t,r=this;r.mouseIsDown=!0;if(!(r.strictMousedownTarget&&r.strictMousedownTarget!=e.target&&ya!=ii.WAVEFORM||r.mousedownTarget instanceof Function&&!0!==r.mousedownTarget(e,r))){if(r.onmousedown){t=r.onmousedown.call(r.mousedownTarget,e,r);if(!1===t)return!1}if(r.downcursor){r.oldDownCursor=r.mousedownTarget.style.cursor;r.mousedownTarget.style.cursor=r.downcursor}var n=xt(e,!1);r.ready=!0;r.x0=n.x;r.y0=n.y;r.dx=0;r.dy=0;r.x1=r.x0;r.y1=r.y0;if(r.onready){t=r.onready.call(r.mousedownTarget,e,r);if(!1===t){r.ready=!1;return!1}}r.mousedownTarget instanceof Function?hi.addEventListener("mousemove",r.e.mmove,!1):r.mousemoveTarget.addEventListener("mousemove",r.e.mmove,!1);r.mousedownTarget instanceof Function?hi.addEventListener("mouseup",r.e.mup,!1):r.mouseupTarget.addEventListener("mouseup",r.e.mup,!1);r.bind=!0}}},mmove:function(e){var t=this;if(t.mouseIsDown&&t.ready){var r,n=xt(e,!1),i=n.x,a=n.y,o=i-t.x0,s=a-t.y0;if(!t.start){if((o*o+s*s)*Wi*Wi<9)return;if(t.mousemoveTarget instanceof Function&&!0!==t.mousemoveTarget(e,t))return;if(t.ondragstart){r=t.ondragstart.call(t.mousedownTarget,e,t);if(!1===r){t.ready=!1;t.start=!1;return!1}}t.start=!0;if(t.cursor){t.oldMoveCursor=t.mousemoveTarget.style.cursor;t.mousemoveTarget.style.cursor=t.cursor}t.downcursor&&(t.mousedownTarget.style.cursor=t.oldDownCursor)}t.x1=i;t.y1=a;t.dx=o;t.dy=s;if(t.ondrag){if(t.mousemoveTarget instanceof Function&&!0!==t.mousemoveTarget(e,t))return;r=t.ondrag.call(t.mousedownTarget,e,t);if(!1===r){t.cursor&&(t.mousemoveTarget.style.cursor=t.oldMoveCursor);t.ready=!1;t.start=!1;return!1}}}},mup:function(e){var t=this;if(e.button===ei){t.mouseIsDown=!1;if(t.bind){t.mousedownTarget instanceof Function?hi.removeEventListener("mousemove",t.e.mmove,!1):t.mousemoveTarget.removeEventListener("mousemove",t.e.mmove,!1);t.mousedownTarget instanceof Function?hi.removeEventListener("mouseup",t.e.mup,!1):t.mouseupTarget.removeEventListener("mouseup",t.e.mup,!1);t.bind=!1}if(t.ready&&t.start){t.ready=!1;t.start=!1;t.start&&t.downcursor&&(t.mousedownTarget.style.cursor=t.oldDownCursor);t.cursor&&(t.mousemoveTarget.style.cursor=t.oldMoveCursor);if(t.ondragend){t.ondragend.call(t.mousedownTarget,e,t)}}}},destroy:function(){var e=this;e.mousedownTarget instanceof Function?hi.removeEventListener("mousedown",e.e.mdown,!1):e.mousedownTarget.removeEventListener("mousedown",e.e.mdown,!1);if(e.bind){e.mousedownTarget instanceof Function?hi.removeEventListener("mousemove",e.e.mmove,!1):e.mousemoveTarget.removeEventListener("mousemove",e.e.mmove,!1);e.mousedownTarget instanceof Function?hi.removeEventListener("mouseup",e.e.mup,!1):e.mouseupTarget.removeEventListener("mouseup",e.e.mup,!1);e.bind=!1}}};un.prototype={mdown:function(e){var r=e.button,n=Ii?e.metaKey:e.ctrlKey;if(r==ei&&!n){var i=e.target;if("polyline"!=i.tagName&&"polygon"!=i.tagName){if("cdot"==v(i,"c_shapetype"))return;if(!Ui||!Ui.target||"polyline"!=Ui.target.tagName&&"polygon"!=Ui.target.tagName)return;i=Ui.target}if(i.parentNode===Jn&&!(i.points.numberOfItems<2||aa.isLocked(i))){var a=un.instance,o=!1,s=Ar().filter(function(e){return!(!e||"part_pcbtext"!==v(e,"c_partid")&&e.parentNode!=Jn||aa.isLocked(e))});if(ya==ii.PCB||ya==ii.PCBLIB||ya==ii.PCBMODULE){if(e.button!==ei||e.shiftKey||a.ready||s.length>1)return;o=_i.adsorbGrid.enabled&&(ya==ii.PCB||ya==ii.PCBLIB)&&"TRACK"==ee(i)}else{if(e.button!==ei||e.shiftKey||a.ready||s.length>1)return;if(ya==ii.SCH||ya==ii.SCHLIB||ya==ii.SCHMODULE){cmd=ee(i);if("wire"!==cmd&&"bus"!==cmd)return}o=_i.adsorbGrid.enabled}var c=Ve({x:e.clientX,y:e.clientY}),l=Fe(i),d=le(c,i,9);if(!(d<0||d%2==0)){var h=d>>1,f=l[h],u=l[h+1];a.target=i;a.startX=c.x;a.startY=c.y;a.A=f;a.B=u;a.ready=1;a.start=0;a.snap=o;a.pIndex=d;a.oldPoints=l;a.polylinePoints=v(i,"points");t.addEventListener("mousemove",a.mmove,!1);t.addEventListener("mouseup",a.mup,!1)}}}},mmove:function(e){var t=un.instance,r=t.target;if(t.ready){var n=Ve({x:e.clientX,y:e.clientY}),i=Fe(r),a=t.pIndex;if(!(a<0||a%2==0)){var o,s,c=a>>1,l=t.startX,d=t.startY,h=t.A,f=t.B,u=n.x,p=n.y;if(i.length>2){o=u-t.startX;s=p-t.startY}else{var g=ge(h.x,h.y,l,d),y=ge(f.x,f.y,l,d),v=i[c],x=i[c+1],m=we(v.x,v.y,g,x.x,x.y,y);if(null==m){var _=(v.x+x.x)/2,b=(v.y+x.y)/2;o=u-_;s=p-b}else{if(ge(u,p,m[0].x,m[0].y)<ge(u,p,m[1].x,m[1].y)){o=u-m[0].x;s=p-m[0].y}else{o=u-m[1].x;s=p-m[1].y}}}if(!t.start){if(ge(l,d,u,p)*Wi<2)return;t.start=1;t.ondragstart&&t.ondragstart({target:r,x0:t.startX,y0:t.startY,x1:u,y1:p,dx:o,dy:s,originalEvent:e})}t.ondrag&&t.ondrag({target:r,x0:t.startX,y0:t.startY,x1:u,y1:p,dx:o,dy:s,originalEvent:e})}}},mup:function(e){if(e.button===ei){var r=un.instance;if(r.ready){t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);var n=r.start;r.ready=0;r.start=0;n&&r.ondragend&&r.ondragend({target:r.target,originalEvent:e});r.oldPoints=null;r.target=null}}},mover:function(e){var t=e.target;if("polyline"==t.tagName&&t===fi){if(ya==ii.PCB||ya==ii.PCBLIB){if(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey){Ot();return}}else if(!e.shiftKey){Ot();return}var r=Ve({x:e.clientX,y:e.clientY}),n=le(r,t,9);(n>0||n%2!=0)&&pn(t,n)}},mout:function(e){var t=e.target;"polyline"==t.tagName&&t===fi&&Ot()},dblclick:function(e){var t=e.target;if("polyline"==t.tagName&&t===fi){var r=v(t,"points");Be(t);var n=(v(t,"points"),Ve({x:e.clientX,y:e.clientY})),i=le(n,t,9);if(i<0)v(t,"points",r);else{0===i?i=1:i%2==0&&(i-=1);v(t,"stroke-opacity","0.5");var a=i>>1,o=t.points.getItem(a),s=t.points.getItem(a+1),c=getComputedStyle(t)||{},l=c.stroke||v(t,"stroke")||"#ffff66",d=c.strokeWidth||v(t,"stroke-width")||"1";d=d.replace(/[\D]+$/,"");var h={x1:o.x,y1:o.y,x2:s.x,y2:s.y,stroke:l,"stroke-width":1.1*d},f=un.instance;f.target=t;if(f.controlLine){h.visibility="visible";v(f.controlLine,h);v(f.controlLine2,h)}else{var u=yn("line",h);u.style.stroke=l;u.style.strokeDasharray="none";u.style.cursor="row-resize";hi.appendChild(u);f.controlLine=u;u.addEventListener("mousedown",this.mdown,!1)}}}}};bi.addJunction=function(e){var t=o("part_junction");if(t&&!di.hasJunctionAtXY(e.x,e.y)){var r=t.cloneNode(!0);v(r,{id:"gge"+ ++$i,c_shapetype:"group"});v(r,{c_origin:e.x+","+e.y});v(r,{display:""});v(r.childNodes[0],{cx:e.x,cy:e.y});v(r.childNodes[1],{cx:e.x,cy:e.y});m(r,"pointer-events");Jn.appendChild(r);di.updateOne(r);bi.logJunctionOp("add",r.id);return r}};bi.removeJunction=function(e){var t=o(e);di.removeOne(t);Yi.appendChild(t);bi.logJunctionOp("del",e);return e};bi.logJunctionOp=function(e,t){bi._historyList[e].push(t)};bi.getHistoryCmd=function(e){return[e,bi._historyList[e].join(",")]};bi.batHistoryCmd=function(e){var t=[];Array.isArray(e[0])?t=e.slice(0):t.push(e);bi._historyList.add.length>0&&t.push(bi.getHistoryCmd("add"));bi._historyList.del.length>0&&t.push(bi.getHistoryCmd("del"));bi._clear();return t};bi.solveItem=function(e,t){var r=v(e,"c_etype"),n=v(e,"c_partid");if("wire"==r){var i=F(v(e,"points")).replace(/ +/g,",");bi._todoList.push({type:"wire",id:e.id,pointArr:I(i),isOldItem:"old"==t})}else if("pinpart"==r&&-1==(n||"").indexOf("part_pin")&&"part_netLabel_text"!=n)if("part_junction"!=v(e,"c_partid")){for(var a,o=s("circle.pindot",e),c=o.length,l=[],d=0;d<c;d++){a=o[d];l.push({x:a.cx.baseVal.value,y:a.cy.baseVal.value})}l.length>0&&bi._todoList.push({type:"pinPart",id:e.id,pointArr:l,isOldItem:"old"==t})}else{var h=v(e,"c_origin").split(",");bi._todoList.push({type:"junction",id:e.id,pointArr:[{x:h[0],y:h[1]}],isOldItem:"old"==t})}};bi.solveItems=function(e,t){for(var r=e||Ar(),n=0,i=r.length;n<i;n++)bi.solveItem(r[n],t)};bi._clear=function(){bi._todoList=[];bi._historyList={add:[],del:[]}};bi.solveTodoList=function(){for(var e=0,t=bi._todoList.length;e<t;e++){var r=bi._todoList[e];switch(r.type){case"wire":bi.solveWire(r);break;case"pinPart":bi.solvePinPart(r);break;case"junction":bi.solveJunction(r)}}for(var n;n=c('g[c_partid="part_junction"] + *:not([c_partid="part_junction"])',Jn);)n.parentNode.appendChild(n.previousElementSibling)};bi.solveJunction=function(e){var t=e.pointArr;bi.checkJunctionValid(t[0]).needAddJunction&&bi.addJunction(t[0])};bi.solvePinPart=function(e){var t=e.pointArr;if(!(t.length<=0)){t.forEach(function(e){bi.checkJunctionValid(e).needAddJunction&&bi.addJunction(e)});if(t.length>=2){var r=e.id,n=di.getWires();for(var i in n)if(w(n,i))for(var a=n[i],o=0,s=0;s<t.length;s++)if(oa.ptOnPolyline(t[s],a)){o++;if(o>=2){bi.splitWireByParts({id:i,pointArr:a},[r]);break}}}}};bi.splitByTwoPoints=function(e,t,r,n){if(oa.isPointEqual(t,r))return null;e=A(e);var i,a,o,s,c=(e.length,function(t){for(var r=e.length-1;r>=0;r--)if(oa.isPointEqual(t,e[r]))return{index:r,insert:!1};for(r=e.length-1;r>0;r--)if(oa.ptOnLine(t,e[r],e[r-1])){e.splice(r,0,t);return{index:r,insert:!0}}return{index:-1,insert:!1}});i=c(t);o=i.index;if(o<0)return null;a=c(r);s=a.index;if(s<0)return null;a.insert&&s<=o&&o++;s<o&&(o=[s,s=o][0]);for(var l=o+1;l<s;l++)if(!oa.ptOnLine(e[l],t,r))return null;n&&function(){for(var t=0;t<n.length;t++)for(var r=n[t],i=o;i<s;i++)if(!oa.isPointEqual(r,e[i])&&!oa.isPointEqual(r,e[i+1])&&oa.ptOnLine(r,e[i],e[i+1]))return null}();return 0===o&&s===e.length-1?[]:0===o?[e.slice(s)]:s===e.length-1?[e.slice(0,o+1)]:[e.slice(0,o+1),e.slice(s)]};bi.solveWire=function(e){var t=di.getWires(),r=di.getPinDots(),n=di.junctions,i={},a=e.pointArr,s=[];if(!(a.length<2)){i[M(a[0])]=a[0];i[M(a[a.length-1])]=a[a.length-1];for(var c in t)if(w(t,c)&&t[c]&&c!=e.id){s=t[c];var l=s[0],d=s[s.length-1];oa.ptOnPolyline(l,a)&&(i[M(l)]=l);oa.ptOnPolyline(d,a)&&(i[M(d)]=d)}for(var h in n)w(n,h)&&oa.ptOnPolyline(n[h],a)&&(i[M(n[h])]=n[h]);var f,u,p={};for(var g in r)if(w(r,g)&&oa.ptOnPolyline(r[g],a)){i[M(r[g])]=r[g];u=g.split("_")[0];p[u]=(p[u]||0)+1}f=Object.keys(p).filter(function(e){return p[e]>=2});var y=[],v={};for(var x in i)if(w(i,x)){var m=bi.checkJunctionValid(i[x]);m.needAddJunction&&bi.addJunction(i[x]);m.needJunction&&(v[x]=i[x])}var _=o(e.id);_&&_.parentNode==Jn&&t[e.id]&&!e.isOldItem&&bi.splitWireByParts(e,f);y.forEach(function(e){e&&bi.addJunction(e)})}};bi.splitWireByParts=function(e,t){var r=e.pointArr,n={},i=function(e){var t=e.x+","+e.y;w(n,t)||(n[t]=e)},a=di.junctions,s=[];for(var c in a)if(w(a,c)&&oa.ptOnPolyline(a[c],r)){i(a[c]);s.push(a[c])}i(r[0]);i(r[r.length-1]);var l=function(e,t){var r=function(t){var r,n,i,a,o,s,c=di.gJsonCache.schlib[t],l=c&&c.pin||{},d=Object.keys(l),h=d.length;if(h<2)return[];for(var f=d.map(function(t){return oa.ptOnPolyline(l[t].pinDot,e)}),u=0;u<h;u++)if(f[u]){r=l[d[u]];i=r.configure.rotation%180==0;o=i?[]:[r.pinDot];s=i?[r.pinDot]:[];for(var p=u+1;p<h;p++)if(f[p]){n=l[d[p]];a=n.configure.rotation%180==0;i&&a&&r.pinDot.y==n.pinDot.y?s.push(n.pinDot):i||a||r.pinDot.x!=n.pinDot.x||o.push(n.pinDot)}if(o.length>1)return o;if(s.length>1)return s}return[]},n={};t.forEach(function(e){var t=r(e);t.length>=2&&(n[e]=t)});return n}(r,t);Object.values||(Object.values=function(e){var t=[];for(var r in e)w(e,r)&&t.push(e[r]);return t});var d=function(e,t,r){var n,i,a,o,s,c,l=[e];for(a=0;a<t.length;a++){s=t[a][0];c=t[a][1];for(o=0;o<l.length;o++){n=bi.splitByTwoPoints(l[o],s,c,r);if(n)if(0===n.length){l.splice(o,1);o--;i=!0}else if(1===n.length){l[o]=n[0];i=!0}else{l.splice.apply(l,[o,1].concat(n));o+=n.length-1;i=!0}}}return i?l:null}(r,Object.values(l),s);if(d&&d.length){var h=o(e.id);if(!h)return;di.removeOne(h);Yi.appendChild(h);bi.logJunctionOp("del",e.id);for(var f=0;f<d.length;f++){var u=h.cloneNode(!1);v(u,{points:E(d[f]),id:ji.newId(),class:""});Jn.appendChild(u);di.updateOne(u);bi.logJunctionOp("add",u.id)}h==fi&&rr()}Object.keys(n).forEach(function(e){var t=n[e];bi.checkJunctionValid(t).needAddJunction&&bi.addJunction(t)})};bi.checkJunctionValid=function(e){var t=di.getWires(),r=di.getPinDots(),n=di.junctions,i=[],a=0,o=0,s=0;for(var c in t)if(w(t,c)){i=t[c];if(!i)continue;var l=i[0],d=i[i.length-1];if(oa.ptOnPolyline(e,i)){if(oa.isPointEqual(e,l)||oa.isPointEqual(e,d)){!0;o++}else a++;if(o>=3&&a>=1)break}}for(var h in n)if(w(n,h)&&oa.isPointEqual(e,n[h])){s=h;break}for(var f in r)if(w(r,f)&&oa.isPointEqual(e,r[f])){o++;!0;if(o>=3)break}var u=bi.needJunction(o,a),p=!!s;p&&!u&&bi.removeJunction(s);return{needJunction:u,hasJunction:p,removed:!u&&p,needAddJunction:u&&!p}};bi.needJunction=function(e,t){return e>=3||e>=1&&t>=1};var ua={clear:function(e){var t=!!kr();qt();rr();var r,n="NotSaveHistory"==e,i=Jn.childNodes,a=i.length,o=[];di.removeAll();for(var s=[];--a>=0;){r=i[a];if(r&&r.id&&ee(r))if(aa.isLocked(r))s.push(r);else if(n)Jn.removeChild(r);else{o.push(r.id);Yi.appendChild(r)}}di.updateMore(s);if(!n){o=o.join(",");xi.save(["del",o])}t&&Ct("triggerEvent",["select_change"])},getCanvasAttrs:function(){var e,t,r,n={};e=ua.getViewBox();r=e[2];t=e[3];n["attr-canvas-width"]=r;n["attr-canvas-height"]=t;n["attr-canvas-bgcolor"]=v(o("gridBg"),"fill")||"#000000";n["attr-canvas-grid-visible"]="none"==v(o("grid1"),"display")?"none":"yes";n["attr-canvas-grid-color"]=v(o("gridCell"),"fill");n["attr-canvas-grid-style"]="url(#gridPattern)"==v(o("grid1"),"fill")?"dot":"line";n["attr-canvas-grid-size"]=_i.adsorbGrid.gridSize;n["attr-canvas-snap-size"]=_i.adsorbGrid.distanceX;n["attr-canvas-alt-snap-size"]=_i.adsorbGrid.altSnapSize;n["attr-canvas-snap"]=_i.adsorbGrid.enabled?"yes":"none";n["attr-canvas-frame-size"]=Xr(r,t);n["attr-canvas-origin-x"]=_i.canvas.originX;n["attr-canvas-origin-y"]=_i.canvas.originY;var i=v(Jn,"c_para")||"",a=ji.c_paraToJson(i),s=ji.fileType.getAbstractFileType(ya);if("schlib"==s){w(a,"package")||(a.package="");w(a,"name")||(a.name="");w(a,"pre")||(a.pre="");w(a,"Contributor")||(a.Contributor="");i=ji.jsonToC_para(a)}else if("sch"==s){w(a,"Prefix Start")||(a["Prefix Start"]=1);i=ji.jsonToC_para(a)}n.c_para=i;return n},modify_canvas:function(e){var n,i;for(i in e)if(w(e,i)){n=e[i];if("attr-canvas-width"==i);else if("attr-canvas-height"==i);else if("attr-canvas-bgcolor"==i){n=n.toUpperCase();v(o("gridBg"),{fill:n});t.body.style.backgroundColor=n;_i.canvas.bgcolor=n;var a=parseInt(n.substr(1),16),s=a>>16,c=a>>8&255,l=255&a;_i.canvas.fgcolor=.213*s+.715*c+.072*l<128?"#FFFFFF":"#000000";var d=v(o("gridCell"),"fill");if(d==n){v(o("gridCell"),{fill:_i.canvas.fgcolor});v(o("gridCell2"),{stroke:_i.canvas.fgcolor})}}else if("attr-canvas-grid-visible"==i){_i.adsorbGrid.visible="none"!==n;v(o("grid1"),"display","none"==n?n:"")}else if("attr-canvas-grid-color"==i){v(o("gridCell"),{fill:n});v(o("gridCell2"),{stroke:n})}else if("attr-canvas-grid-size"==i){if(+n<1)continue;for(var h=+n;h*Wi<5;)h*=h*Wi*2>=5?2:h*Wi*5>=5?5:10;v([o("gridPattern"),o("gridPattern2")],{width:h,height:h});v(o("gridCell2"),{d:"M10 0V10H-10".replace(/10/g,h)});_i.adsorbGrid.gridSize=+n}else if("attr-canvas-snap-size"==i){n=n||10;_i.adsorbGrid.distanceX=_i.adsorbGrid.distanceY=+n;w(e,"attr-canvas-snap")||(_i.adsorbGrid.enabled=n>1e-4)}else if("attr-canvas-snap"==i)_i.adsorbGrid.enabled="yes"==n;else if("attr-canvas-alt-snap-size"==i)_i.adsorbGrid.altSnapSize=+n||1;else if("attr-canvas-grid-style"==i)v(o("grid1"),"fill","dot"==n?"url(#gridPattern)":"url(#gridPattern2)");else if("c_para"==i)v(Jn,{c_para:n});else{if((i+n).indexOf(si)>=0)continue;if(ji.fileType.isLib(ya)&&"pre"==i&&!n.trim()){parent.$.messager.error("This field can't be removed!");continue}Vn(Jn,i,n);Ct("updateAttrPanel")}}w(e,"attr-canvas-unit")&&gt();if(w(e,"attr-canvas-origin-x")||w(e,"attr-canvas-origin-y")){var f=_i.canvas.originX,u=_i.canvas.originY;w(e,"attr-canvas-origin-x")&&(f=+e["attr-canvas-origin-x"]);w(e,"attr-canvas-origin-y")&&(u=+e["attr-canvas-origin-y"]);isFinite(f)&&isFinite(u)&&r("setOriginXY",[{x:f,y:u}])}},getViewBox:function(){return v(hi,"viewBox").split(" ").map(parseFloat)},setViewBox:function(){var e=o("gridBg"),t=o("grid1"),r=o("gridOH"),n=o("gridOV");return function(i){v(hi,"viewBox",i.join(" "));var a={x:i[0],y:i[1],width:i[2],height:i[3]};v(e,a);v(t,a);v(r,{x1:i[0],x2:i[0]+i[2]});v(n,{y1:i[1],y2:i[1]+i[3]});Ct("updateRuler",[{vbX:i[0],vbY:i[1]}])}}()},pa={version:1,readyed:!1,started:!1,dots:[],line:null,mockX:null,mockY:null,STATUSEXIT:1,ready:function(){var e=yi;if(!pa.readyed){pa.readyed=!0;pa.forcedPixelSnap=!1;t.addEventListener("mousedown",pa.mousedown,!1);t.addEventListener("mousemove",pa.mousemove,!1);t.addEventListener("mouseup",pa.mouseup,!1);l(Jn,"events-none",!0);Ot("draw.freedraw"==yi?"cursor-freedraw":"cross-red");0===yi.indexOf("place.part_")&&(e="place.part");pa[e]&&"function"==typeof pa[e].ready&&pa[e].ready()}},mousedown:function(e){e.button==ei&&pa.mousedownLeft(e)},mousedownLeft:function(e){pa[yi]&&"function"==typeof pa[yi].mousedownLeft&&pa[yi].mousedownLeft(e)},mouseup:function(e){e.button==ei?pa.mouseupLeft(e):e.button==ti&&pa.mouseupRight(e)},mouseupLeft:function(e){var r=pa;if(Gi||e.target!=t.documentElement&&e.target!=t.body){var n=r.dots;evtXY=xt(e);!_i.adsorbGrid.enabled||"draw.arc"!=yi&&"draw.pie"!=yi||4!=n.length&&6!=n.length||evtXY.x!=n[0]&&evtXY.y!=n[1]&&(evtXY=xt(e,!1));x=evtXY.x;y=evtXY.y;rr();if(!r.started){r.started=!0;n.length=0}if(pa[yi]&&"function"==typeof pa[yi].mouseupLeft){if(pa[yi].mouseupLeft(e)===pa.STATUSEXIT)return}if("draw.wire"==yi||"place.part_pin"==yi||"place.part_import"==yi){x=Math.round(x);y=Math.round(y)}r.draw(x,y,!0);yi||r.end()}},mouseupRight:function(e){var r,n,i,a=pa;if((Gi||e.target!=t.documentElement&&e.target!=t.body)&&!Pi.dragpanning){var o=a.dots;r=xt(e);!_i.adsorbGrid.enabled||"draw.arc"!=yi&&"draw.pie"!=yi||4!=o.length&&6!=o.length||r.x!=o[0]&&r.y!=o[1]&&(r=xt(e,!1));n=r.x;i=r.y;pa[yi]&&"function"==typeof pa[yi].mouseupRight&&pa[yi].mouseupRight(e);rr();if(yi&&a.started&&0!==yi.indexOf("place.part_")&&"draw.freedraw"!==yi&&"draw.image"!==yi&&0!==a.dots.length)a.next(n,i);else{a.end();Kt()}Pi.contextmenuDisableOnce=!0;setTimeout(function(){Pi.contextmenuDisableOnce=!1},5)}},mousemove:function(e){var r,n,i,a=pa;if(a.started&&("object"!=typeof Ni||!Ni.ready)){var o,s;if(!_i.adsorbGrid.enabled&&pa.forcedPixelSnap){o=ji.extend({},_i.adsorbGrid);ji.extend(_i.adsorbGrid,{distanceX:1,distanceY:1,enabled:!0});s=function(){ji.extend(_i.adsorbGrid,o)}}if(Gi||e.target!=t.documentElement&&e.target!=t.body){if(pa[yi]&&"function"==typeof pa[yi].mousemove){if(pa[yi].mousemove(e)===pa.STATUSEXIT){s&&s();return}}var c=a.dots;r=xt(e);!_i.adsorbGrid.enabled||"draw.arc"!=yi&&"draw.pie"!=yi||4!=c.length&&6!=c.length||r.x!=c[0]&&r.y!=c[1]&&(r=xt(e,!1));n=r.x;i=r.y;if(c.length>0&&a.mockX==n&&a.mockY==i)s&&s();else{if("draw.wire"==yi||"place.part_pin"==yi||"place.part_import"==yi){n=Math.round(n);i=Math.round(i)}a.draw(n,i,!1);a.mockX=n;a.mockY=i;s&&s()}}else{if(0===yi.indexOf("place.part_")){Et(yi.substr(6))}s&&s()}}},draw:function(e,t,r){var n=pa,i=n.dots,a=i.length,o=yi;n.lastX=e;n.lastY=t;if(e!=i[a-2]||t!=i[a-1]){r&&n.dots.push(e,t);0===yi.indexOf("place.part_")&&(o="place.part");pa[o]&&"function"==typeof pa[o].draw&&pa[o].draw(e,t,r);n.target&&!n.target.id&&v(n.target,{id:ji.newId()})}},next:function(e,t){var r=pa,n=r.dots,i=o("pdot0"),a=void 0!==e&&void 0!==t;a&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(a=!1);i&&"none"!=v(i,"display")&&v(i,"display","none");pa[yi]&&"function"==typeof pa[yi].next&&pa[yi].next(e,t);r.target=null;r.dots.length=0;r.mockX=null;r.mockY=null},end:function(e){var r=pa,n=yi;0===yi.indexOf("place.part_")&&(n="place.part");pa[n]&&"function"==typeof pa[n].end&&pa[n].end(e);r.mockX=null;r.mockY=null;r.target=null;r.started=!1;r.dots.length=0;r.readyed=!1;t.removeEventListener("mousedown",r.mousedown,!1);t.removeEventListener("mouseup",r.mouseup,!1);t.removeEventListener("mousemove",r.mousemove,!1);l(Jn,"events-none",!1);Ot();var i=o("pdot0");i&&"none"!=v(i,"display")&&v(i,"display","none")},restart:function(e){var t=pa;if(yi)if(t.started&&t.dots.length){var r=yi;t.end(27);yi="";Jt(r)}else{t.end(27);yi=""}},canBackStep:function(){var e=pa,t=yi;return e.started&&("draw.polyline"==t||"draw.polygon"==t||"draw.bezier"==t||"draw.wire"==t||"draw.bus"==t||"draw.track"==t)&&e.dots.length>=4},backStep:function(){var e=pa;if(e.canBackStep()){e.dots.length-=2;e.draw(e.lastX,e.lastY)}}};!function(e){e.nameObj={};e.cancelNextName=function(){function t(t){if(e.nameObj[yi+t]&&e.nameObj[yi+t].match(/\d$/)){var r=e.resolveNextName(e.nameObj[yi+t]),n=r.num,i=r.name;e.nameObj[yi+t]=i+(n-1)}}if("place.part_pin"==yi){t(0);t(1)}else t("")};e.updateNextDrawLineName=function(t,r){e.nameObj[t]&&r.match(/\d$/)&&(e.nameObj[t]=r)};e.resolveNextName=function(e){var t,r=e.match(/\d+$/)[0],n=e.match(/(.*?)\d+$/)?e.match(/(.*?)\d+$/)[1]:"";if(!isNaN(r)){var i=r.match(/^0+/);r*=1;if(i){t=i[0];String(r+1).length!=String(r).length&&(t=t.substr(0,t.length-1));n+=t}}return{name:n,num:r}};e.getNextName=function(t){void 0===t&&(t="");var r,n,i="";if(e.nameObj[yi+t]){if(e.nameObj[yi+t].match(/\d$/)){n=e.resolveNextName(e.nameObj[yi+t]);r=n.num;i=n.name;e.nameObj[yi+t]=i+(r+1)}else if(!e.nameObj[yi+t].match(/\d$/))return e.nameObj[yi+t]}else if("place.part_pin"==yi||"place.part_netLabel_text"==yi||"place.part_netLabel_netPort"==yi||"place.part_netLabel_volProbe"==yi||"place.part_pad"==yi){"place.part_netLabel_text"==yi?i="netLabel":"place.part_netLabel_netPort"==yi?i="netPort":"place.part_netLabel_volProbe"==yi&&(i="volProbe");var a,o,c,l=yi.split(".")[1],d=s("#g1 > g[c_partid="+l+"]",hi).filter(function(t){return t!=e.target}),h=0;for(a=0;a<d.length;a++){if("part_pad"===l){o=d[a];c=o&&v(o,"number")}else{o=d[a].childNodes["part_pin"===l?t||0:1];c=o&&o.textContent}if(c){r=c.match(/\d+$/)?c.match(/\d+$/)[0]:"";if(r&&r>h){n=e.resolveNextName(c);r=n.num;h=r}}}h+=1;e.nameObj[yi+t]=i+h}return e.nameObj[yi+t]}}(pa);pa["draw.wire"]={ready:function(){pa.started=!0;pa.forcedPixelSnap=!0},mouseupLeft:function(e){var t=pa,r=xt(e),n=r.x,i=r.y,a=di.ifFind(n,i);if(a.type){Ot("cross-red",a.X,a.Y);if(t.dots.length>=2){if(a.X===t.dots[t.dots.length-2]&&a.Y===t.dots[t.dots.length-1])return pa.STATUSEXIT;t.next(a.X,a.Y)}else t.draw(a.X,a.Y,!0);return pa.STATUSEXIT}},draw:function(e,t,r){var n,i,a,o,s=pa,c=s.dots;if(c.length>=2){var l=di.ifFind(e,t);if(l.type){e=l.X;t=l.Y;Ot("cross-red",e,t)}n=r?c.join(" "):c.join(" ")+" "+e+" "+t;if(s.target){if(!r){n=oa.formatWirePoints(c,90,e,t,s.target);v(s.target,{points:n})}a=I(v(s.target,"points"));i=a.length;r&&c.length+2==2*i&&c.splice(c.length-2,0,a[i-2].x,a[i-2].y)}else{o="polyline";var d={points:n,stroke:_i.colors&&_i.colors.wire||"#008800","stroke-width":_i.canvas.strokeWidth,fill:"none",id:ji.newId(),c_shapetype:"line"};d.c_etype="wire";s.target=yn(o,d);Jn.appendChild(s.target)}}di.checkShow(e,t)},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);if(r.started&&r.target){Be(r.target);if(r.target.points.numberOfItems<2){p(r.target);r.target=null}}if(r.started&&r.target){hist=["add",r.target.id];calline=r.target;var a=oa.simplifyWire(calline);switch(a.status){case"merge":p(calline);calline=o(a.wireId);hist=["node",calline.id,a.oldNode,calline.cloneNode(!0)];break;case"invalidWire":p(calline);calline=null;return}if(calline){di.updateOne(calline);bi.solveItem(calline);bi.solveTodoList();xi.save(bi.batHistoryCmd(hist))}}r.started=!0},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target);if(di.lastHoverWire){u(di.lastHoverWire,"wire-hover");di.lastHoverWire=null}}}};pa["draw.bus"]={ready:function(){pa.started=!0;pa.forcedPixelSnap=!0},mouseupLeft:function(e){var t=pa,r=xt(e),n=r.x,i=r.y,a=di.ifFind(n,i);if(a.type){Ot("cross-red",a.X,a.Y);if(t.dots.length>=2){if(a.X===t.dots[t.dots.length-2]&&a.Y===t.dots[t.dots.length-1])return;t.next(a.X,a.Y)}else t.draw(a.X,a.Y,!0)}else;},draw:function(e,t,r){var n,i,a,o,s=pa,c=s.dots;if(c.length>=2){var l=di.ifFind(e,t);if(l.type){e=l.X;t=l.Y;Ot("cross-red",e,t)}n=r?c.join(" "):c.join(" ")+" "+e+" "+t;if(s.target){r||v(s.target,{points:n});a=I(v(s.target,"points"));i=a.length;r&&c.length+2==2*i&&c.splice(c.length-2,0,a[i-2].x,a[i-2].y)}else{o="polyline";var d={points:n,stroke:_i.colors&&_i.colors.bus||"#008800","stroke-width":_i.canvas.strokeWidth,fill:"none",id:ji.newId(),c_shapetype:"line"};d["stroke-width"]="2";d.c_etype="bus";s.target=yn(o,d);Jn.appendChild(s.target)
}}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);if(r.started&&r.target){Be(r.target);if(r.target.points.numberOfItems<2){p(r.target);r.target=null}}if(r.started&&r.target)if(n.length<4)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!0},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target);if(di.lastHoverWire){u(di.lastHoverWire,"wire-hover");di.lastHoverWire=null}}}};pa["draw.polyline"]={ready:null,mouseupLeft:function(e){var t=xt(e);On(t.x,t.y)},mouseupRight:function(e){var t=xt(e);On(t.x,t.y)},draw:function(e,t,r){var n,i,a=pa,o=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000",s=a.dots;if(s.length>=2){n=r?s.join(" "):s.join(" ")+" "+e+" "+t;if(a.target)v(a.target,{points:n});else{i="polyline";a.target=yn(i,{points:n,stroke:o,"stroke-width":_i.canvas.strokeWidth,fill:"none"});v(a.target,{c_shapetype:"line"});Jn.appendChild(a.target)}}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);if(r.started&&r.target)if(n.length<4)p(r.target);else{Be(r.target);if(r.target.points.numberOfItems<2)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}}r.started=!1},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target)}}};pa["draw.polygon"]={draw:function(e,t,r){var n,i,a=pa,o=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000",s=a.dots;if(s.length>=2){n=s.join(" ")+" "+e+" "+t;if(a.target)v(a.target,{points:n});else{i="polygon";a.target=yn(i,{points:n,stroke:o,"stroke-width":_i.canvas.strokeWidth,fill:"none"});v(a.target,{c_shapetype:"line"});Jn.appendChild(a.target)}}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);if(r.started&&r.target)if(n.length<6)p(r.target);else{Be(r.target);if(r.target.points.numberOfItems<3)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}}r.started=!1},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target)}}};pa["draw.ellipse"]={draw:function(e,t,r){var n,i,a,o,s,c=pa,l=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000",d=r?c.dots.length-2>0?c.dots.slice(0,c.dots.length-2):[]:c.dots;n=d.length;if(d.length>=2){e==d[n-2]||t==d[n-1]?(i=(e+d[n-2])/2,a=(t+d[n-1])/2,o=Math.abs(e-d[n-2])/2,s=Math.abs(t-d[n-1])/2,Math.max(o,s)):(i=(e+d[n-2])/2,a=(t+d[n-1])/2,o=Math.abs(e-d[n-2])/2,s=Math.abs(t-d[n-1])/2);if(c.target)v(c.target,{cx:i,cy:a,rx:o,ry:s});else{c.target=yn("ellipse",{cx:i,cy:a,rx:o,ry:s,stroke:l,"stroke-width":"1",fill:"none"});v(c.target,{c_shapetype:"line"});Jn.appendChild(c.target)}r&&c.next()}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);if(r.started&&r.target)if(n.length<4)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!1},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target)}}};pa["draw.rect"]={draw:function(e,t,r){var n,i,a,o=pa,s=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000",c=r?o.dots.length-2>0?o.dots.slice(0,o.dots.length-2):[]:o.dots;n=c.length;if(c.length>=2){var l=Math.min(e,c[n-2]),d=Math.min(t,c[n-1]);i=Math.max(e,c[n-2])-l;a=Math.max(t,c[n-1])-d;0!==i&&0!==a||(i=a=Math.max(i,a));if(o.target)v(o.target,{x:l,y:d,width:i,height:a});else{o.target=yn("rect",{x:l,y:d,width:i,height:a,stroke:s,"stroke-width":"1",fill:"none"});v(o.target,{c_shapetype:"line"});Jn.appendChild(o.target)}r&&o.next()}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);if(r.started&&r.target)if(n.length<4)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!1},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target)}}};pa["draw.roundrect"]={draw:function(e,t,r){var n,i,a,o,s=pa,c=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000",l=r?s.dots.length-2>0?s.dots.slice(0,s.dots.length-2):[]:s.dots;n=l.length;if(l.length>=2){var d=Math.min(e,l[n-2]),h=Math.min(t,l[n-1]);a=Math.max(e,l[n-2])-d;o=Math.max(t,l[n-1])-h;0!==a&&0!==o||(a=o=Math.max(a,o));if(s.target)v(s.target,{x:d,y:h,width:a,height:o});else{s.target=yn("rect",{x:d,y:h,width:a,height:o,stroke:c,"stroke-width":"1",fill:"none"});v(s.target,{c_shapetype:"line"});Jn.appendChild(s.target)}i=Math.min(10,Math.min(a,o)/2);v(s.target,{rx:i,ry:i});r&&s.next()}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);if(r.started&&r.target)if(n.length<4)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!1},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target)}}};pa["draw.freedraw"]={ready:null,mousedownLeft:function(e){var t=pa,r=xt(e,!1);t.startX=ji.toFixed(r.x,2);t.startY=ji.toFixed(r.y,2);t.started=!0;t.draw(t.startX,t.startY,!0)},mouseupLeft:function(e){pa.next();return pa.STATUSEXIT},mousemove:function(e){var t=pa;if(e.button==ei){var r=xt(e,!1),n=ji.toFixed(r.x,2),i=ji.toFixed(r.y,2);t.draw(n,i,!0);return pa.STATUSEXIT}},draw:function(e,t,r){var n=pa,i=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000";if(n.dots.length>=2)if(n.target)v(n.target,{d:v(n.target,"d")+" "+e+" "+t});else{n.target=yn("path",{d:"M"+n.startX+" "+n.startY+"L"+e+" "+t,stroke:i,"stroke-width":_i.canvas.strokeWidth,fill:"none",c_shapetype:"line",c_etype:"freedraw"});n.target.style.shapeRendering="auto";n.target.style.strokeLinejoin="round";Jn.appendChild(n.target)}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);if(r.started&&r.target)if(n.length<4)p(r.target);else{Oe(r.target,r.dots);di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!1}};pa["draw.bezier"]={draw:function(e,t,r){var n,i,a,o=pa,s=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000",c=o.dots;i=r?o.dots.length-2>0?o.dots.length-2:0:o.dots.length;if(i>=2){var l=c.slice(0);r||l.push(e,t);var d=l.length;if(d%6==0){l.push(l[d-2],l[d-1]);l[d-2]=l[d-4];l[d-1]=l[d-3]}else d%6==4&&l.push(l[d-2],l[d-1],l[d-2],l[d-1]);n="M"+l[0]+" "+l[1]+" C"+l.slice(2).join(" ");if(o.target)v(o.target,{d:n});else{a="path";o.target=yn(a,{d:n,stroke:s,"stroke-width":_i.canvas.strokeWidth,fill:"none",c_shapetype:"line"});Jn.appendChild(o.target)}Nt(o.target)}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);wt();if(r.started&&r.target)if(n.length<6)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!1},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target)}wt()}};pa["draw.arc"]={draw:function(e,t,r){var n,i,a,o,s,c,l,d=pa,h=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000",f=r?d.dots.length-2>0?d.dots.slice(0,d.dots.length-2):[]:d.dots;i=f.length;if(f.length>=2){a=f[0],o=f[1];var u;if(i>=2){if(e==a&&t==o)return;if(2==i)s=Math.abs(e-a),c=Math.abs(t-o);else{s=Math.abs(f[0]-f[2]);c=Math.abs(f[1]-f[3])}}switch(i){case 2:u=f.concat(e,t);u.c_helper_lines=[{from:0,to:1}];Cr(u);if(d.target)v(d.target,{rx:s,ry:c});else{d.target=yn("ellipse",{cx:a,cy:o,rx:s,ry:c,"stroke-dasharray":"3,3",stroke:h,"stroke-width":"1",fill:"none"});Jn.appendChild(d.target)}break;case 4:l=ji.arc.getArcParams(a,o,s,c,e,t,e,t);if(!l)return;u=f.concat(l.x1,l.y1);u.c_helper_lines=[{from:0,to:1},{from:0,to:2,ray:1}];Cr(u);break;case 6:if(ji.arc.getAngle(f[4]-a,f[5]-o)==ji.arc.getAngle(e-a,t-o))return;l=ji.arc.getArcParams(a,o,s,c,f[4],f[5],e,t);if(!l)return;n="M"+l.x1+","+l.y1+" A"+s+","+c+" 0 "+l.fa+" "+l.fs+" "+l.x2+","+l.y2;if("ellipse"==d.target.tagName){var p=yn("path",{d:n,c_shapetype:"line",stroke:h,"stroke-width":"1",fill:"none"});Jn.replaceChild(p,d.target);d.target=p}else v(d.target,{d:n});if(r){v(d.target,{c_helper_type:"arc1"});d.next();return}u=ji.arc.calculateArcHelperDots(d.target);u.c_helper_lines=ji.arc.c_helper_lines;Cr(u)}}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);wt();if(r.started&&r.target)if(n.length<8)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!1},end:function(){var e=pa;if(e.target){di.removeOne(e.target);p(e.target)}wt()}};pa["draw.pie"]={draw:function(e,t,r){var n,i,a,o,s,c,l,d=pa,h=_i.colors&&_i.colors.draw||_i.canvas.fgcolor||"#000000",f=r?d.dots.length-2>0?d.dots.slice(0,d.dots.length-2):[]:d.dots;i=f.length;if(f.length>=2){a=f[0],o=f[1];var u;if(i>=2){if(e==a&&t==o)return;if(2==i)s=Math.abs(e-a),c=Math.abs(t-o);else{s=Math.abs(f[0]-f[2]);c=Math.abs(f[1]-f[3])}}switch(i){case 2:u=f.concat(e,t);u.c_helper_lines=[{from:0,to:1}];Cr(u);if(d.target)v(d.target,{rx:s,ry:c});else{d.target=yn("ellipse",{cx:a,cy:o,rx:s,ry:c,"stroke-dasharray":"3,3",stroke:h,"stroke-width":"1",fill:"none"});Jn.appendChild(d.target)}break;case 4:l=ji.arc.getArcParams(a,o,s,c,e,t,e,t);if(!l)return;u=f.concat(l.x1,l.y1);u.c_helper_lines=[{from:0,to:1},{from:0,to:2,ray:1}];Cr(u);break;case 6:if(ji.arc.getAngle(f[4]-a,f[5]-o)==ji.arc.getAngle(e-a,t-o))return;l=ji.arc.getArcParams(a,o,s,c,f[4],f[5],e,t);if(!l)return;n="M"+a+","+o+" L"+l.x1+","+l.y1+" A"+s+","+c+" 0 "+l.fa+" "+l.fs+" "+l.x2+","+l.y2+"Z";if("ellipse"==d.target.tagName){var p=yn("path",{d:n,c_shapetype:"line",stroke:h,"stroke-width":"1",fill:"none"});Jn.replaceChild(p,d.target);d.target=p}else v(d.target,{d:n});if(r){v(d.target,{c_helper_type:"pie1"});d.next();return}u=ji.arc.calculateArcHelperDots(d.target);u.c_helper_lines=ji.arc.c_helper_lines_pie1;Cr(u)}}},next:function(e,t){var r=pa,n=r.dots,i=void 0!==e&&void 0!==t;i&&n.length>1&&e==n[n.length-2]&&t==n[n.length-1]&&(i=!1);i&&r.draw(e,t,!0);wt();if(r.started&&r.target)if(n.length<8)p(r.target);else{di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!1},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target)}wt()}};pa["draw.image"]={ready:function(){pa.started=!0},draw:function(e,t,r){var n,i,a,o=pa;if(r&&o.target){a=o.target.cloneNode(!0);a.id=ji.newId();o.next();Jn.appendChild(a);o.target=a}else if(!r){n=ci.width;i=ci.height;if(o.target){v(o.target,{x:e,y:t});Ee(pa.target,0)}else{o.target=yn("image",{x:e,y:t,width:n,height:i,preserveAspectRatio:"none"});v(o.target,{"xlink:href":ci.src,c_shapetype:"line",id:ji.newId(),c_rotation:0});Jn.appendChild(o.target);o.target&&!o.target.id&&v(o.target,{id:ji.newId()})}}},next:function(e,t){var r=pa;if(r.started&&r.target){di.updateOne(r.target);xi.save(["add",r.target.id])}r.started=!0},end:function(e){var t=pa;if(t.target){di.removeOne(t.target);p(t.target)}}};pa["draw.origin"]={ready:function(){pa.forcedPixelSnap=!0;pa.started=!0;pa.preOrigin={offsetX:0,offsetY:0}},draw:function(e,t,n){var i=pa;if(n){i.preOrigin.offsetX=e-_i.canvas.originX;i.preOrigin.offsetY=t-_i.canvas.originY;r("setOriginXY",[{x:e,y:t}]);i.end();Kt();Ct("setTabUnsaved");xi.save(["originXY","set.origin",i.preOrigin])}}};pa["place.part"]={cloneTemplate:function(){if(!yi)return Kt();var e=yi.substr(6);"place.part_import_frame_lib"==yi&&(e="part_frame_lib");this.template=o(e);if("place.part_pin"==yi||"place.part_netLabel_text"==yi||"place.part_netLabel_netPort"==yi||"place.part_netLabel_volProbe"==yi){var t=pa.getNextName();if("place.part_pin"==yi){t=pa.getNextName(0);this.template.childNodes[0].textContent=t;v(this.template.childNodes[0],"c_pinname",t);t=pa.getNextName(1);this.template.childNodes[1].textContent=t;v(this.template.childNodes[1],"c_pinnumber",t);v(this.template,{c_spicepin:t.match(/\d+$/)?t.match(/\d+$/)[0]:0})}else"place.part_netLabel_volProbe"==yi||"place.part_netLabel_netPort"==yi?this.template.childNodes[1].childNodes[0].textContent=t:this.template.childNodes[1].textContent=t}pa.target=this.template.cloneNode(!0);"place.part_import"===yi&&v(pa.target,"bindPCBId",te());Jn.appendChild(pa.target);it(pa.target)},ready:function(){this.cloneTemplate();pa.started=!0;pa.forcedPixelSnap=!0;var e=Di.getCacheObj("AutoAnnotatePre");void 0===e&&(e=!0);"place.part_import_frame_lib"==yi&&Dr(pa.target,{date:"?",product:"?"})},draw:function(e,t,r){var n,i,a,o,l,d=pa.target,h=[];if(d){var f=Di.getCacheObj("AutoAnnotatePre");void 0===f&&(f=!0);if(r){if(v(d,"c_module")){var u=[].slice.call(d.children||d.childNodes,0).filter(function(e){return 1===e.nodeType}),p=u.map(function(e){return e.id}).join(",");for(n=0;n<u.length;n++){Jn.appendChild(u[n]);"place.part_netLabel_volProbe"==yi&&(u[n].childNodes[1].firstChild.nodeValue=$r(u[n].childNodes[1].firstChild.nodeValue));if("g"==u[n].tagName){a=c('text[c_note="note_pre"]',u[n]);if(a){o=c('g text[c_note="note_name"]',a.parentNode.parentNode);o=o&&o.textContent;i=a.textContent;if(i.indexOf("?")>=0)/\.\d+$/.test(i)&&o&&(i={pre:i,name:o});else if(/\.\d+$/.test(i)){/\d+(\D*\.\d+)$/.test(i)&&(i=i.replace(/\d+(\D*\.\d+)$/,"?$1"));o&&(i={pre:i,name:o})}else i=i.replace(/\d+(\D*)$/,"?$1");(i.pre||i).indexOf("?")>=0&&h.push({pre:i,preNode:a})}}}if(h.length){l=li.getNewPre(h.map(function(e){return e.pre}));for(n=0;n<l.length;n++)h[n].preNode.textContent=l[n]}di.updateMore(u);bi.solveItems(u);bi.solveTodoList();xi.save(bi.batHistoryCmd(["add",p]))}else{if(s('#g1>g[c_partid="'+v(d,"c_partid")+'"][c_origin="'+v(d,"c_origin")+'"]').filter(function(e){return e!=pa.target}).length)return;v(d,{c_shapetype:"group"});m(d,"pointer-events");!function(e){var t=v(e,"eelibtitle"),r=v(e,"c_para"),n=J("easyeda.preferences");if(t&&r&&n){r=ji.c_paraToJson(r);n=N(n);var i=n&&n["eelib-package"]||{},a=r.package,o=i[t];a&&v(e,"package-default",a);if(a&&i&&o&&o!=a){r.package=o;r=ji.jsonToC_para(r);v(e,"c_para",r)}}}(d);v(d,{c_etype:"pinpart"});a=c('g text[c_note="note_pre"]',d);if(a&&f){i=a.textContent;o=c('g text[c_note="note_name"]',a.parentNode.parentNode);o=o&&o.textContent;if(i.indexOf("?")>=0)/\.\d+$/.test(i)&&o&&(i={pre:i,name:o});else if(/\.\d+$/.test(i)){i=i.replace(/\d+(\D*\.\d+)$/,"?$1");o&&(i={pre:i,name:o})}else i=i.replace(/\d+(\D*)$/,"?$1");(i.pre||i).indexOf("?")>=0&&(a.textContent=li.getNewPre(i))}if(a){i=a.textContent;var g=!1;if(/\.\d+$/.test(a.textContent)){var y,x=Ct("getAllJson");for(n=0;n<x.length;n++){y=x[n].json.schlib;var _=Ct("getTabById",[x[n].fid]).contentWindow.document;for(var b in y)if(!(b.indexOf("frame_lib")>=0)){var S=[];for(var C in y[b].annotation)S.push(y[b].annotation[C]);var P=S[1].string.indexOf(".");if(P>=1&&S[1].string.substr(0,P)===i.substr(0,P)){0===S[0].visible&&v(Vt("name",d),"display","none");0===S[1].visible&&v(Vt("pre",d),"display","none");if(S[2]){mn(d,!0)}var w=_.getElementById(y[b].head.gId),A=JSON.parse(JSON.stringify(v(w,"c_para"))),k=ji.jsonToC_para(A);v(d,"c_para",k);g=!0;break}}if(!0===g)break}}}var O=!!c('[id^="frame_"]',d);if(O){d.id="frame_lib_?";v(Vt("pre",d),"display","none");v(Vt("name",d),"display","none");Dr(d,{date:"?",product:"?"})}it(d);di.updateOne(d);bi.solveItem(d);bi.solveTodoList();xi.save(bi.batHistoryCmd(["add",d.id]));if(O){this.end(!0)}"place.part_import"==yi&&Yt("mounted",d)}this.cloneTemplate()}else{"none"==v(d,"display")&&v(d,"display","");var T=Di.getCacheObj("PackageDis");void 0===T&&(T=!1);T&&Vn(d,"Package Display","Yes");Et(d,e,t)}}},end:function(e){Et(this.template.id);pa.target&&pa.target.parentNode&&!e&&pa.target.parentNode.removeChild(pa.target);s('[c_from="importDxf"]').forEach(function(e){p(e)});pa.cancelNextName();this.template=null;Kt()}};xi.records=[];xi.timestamps=[];xi._queueBatchRecords=[];xi.maxLength=120;xi.index=-1;xi.savedIndex=-1;xi.fileWaitingforSaving=!1;xi.logs=[];xi.log=function(e){xi.logs.push(e);xi.logs.length>xi.maxLength&&xi.logs.shift()};xi.getLogs=function(){return{index:xi.index,records:JSON.parse(JSON.stringify(xi.records,function(e,t){return t instanceof Element?serializeNode(t):t}))}};xi.log("begin");xi.XMLSerializer=e.XMLSerializer?new XMLSerializer:{serializeToString:function(){}};xi.DOMParser=e.DOMParser?new DOMParser:{parseFromString:function(){}};xi.save=function(e,t){if(Array.isArray(e))if(xi.batchState)Array.isArray(e)&&Array.isArray(e[0])?[].push.apply(xi._queueBatchRecords,e):xi._queueBatchRecords.push(e);else{xi.log(e.concat(t?"mergeSource:"+t:[]));if(t&&t===xi.lastMergeSource){var r=xi.records[xi.index],n=r[0],i=r[1],a=r[2];if(n===e[0]&&i===e[1]){xi.records.pop();xi.index--;e[2]=a}}else xi.lastMergeSource=t||"";var o=xi.records.length;if(xi.index>=xi.maxLength-1){xi.records.shift();xi.savedIndex>-1&&(xi.savedIndex-=1)}else xi.index++;xi.timestamps[xi.index]=Date.now();xi.records[xi.index]=e;xi.records.length=xi.index+1;var s=xi.needSetUnSaved();(o>xi.records.length||o==xi.records.length&&o!=xi.maxLength)&&(xi.fileWaitingforSaving=!0);Ct("triggerEvent",["history_change",xi.records.length,xi.index,s,xi.fileWaitingforSaving]);xi.walkRecord(e,function(e){var t=xi.ids2elems(e[1]);if(t&&t[0]){var r=e[0];"del"!=r&&"add"!=r||1===t.length&&!e[2]&&Jn.contains(t[0])&&(e[2]=ji.node.getRefId(t[0]))}})}else ji.reportError(new Error("History.save :: first argument is not an array"))};xi.walkRecord=function(e,t){Array.isArray(e[0])?e.forEach(t):t(e)};xi.needSetUnSaved=function(){if(xi.index!=xi.savedIndex){for(var e=Math.min(xi.index,xi.savedIndex),t=Math.max(xi.index,xi.savedIndex),r=e+1;r<=t;r++){var n=xi.records[r];if(!n||n&&void 0!=n[n.length-1]&&!n[n.length-1].notChangeSaveState)return!0}return!1}return!1};xi.startBatch=function(){xi.batchState=xi.batchState+1||1};xi.saveBatch=function(){xi.batchState>0&&(xi.batchState-=1);if(!xi.batchState&&xi._queueBatchRecords.length){xi.save(xi._queueBatchRecords.slice(0));xi._queueBatchRecords.length=0}};xi.clear=function(e){var t=e&&!1===e.saved;xi.logs.length=0;xi.log("clear");xi.timestamps.length=0;xi.records.length=0;xi.index=-1;xi.savedIndex=t?-2:xi.index;xi.fileWaitingforSaving=t;xi.batchState=void 0;Ct("triggerEvent",["history_change",xi.records.length,xi.index,t,xi.fileWaitingforSaving]);for(;Yi.lastChild;)Yi.removeChild(Yi.lastChild)};xi.goTo=function(e){var t;if(e>=-1&&e!==xi.index&&e<xi.records.length){if(e>xi.index)for(t=xi.index+1;t<=e;t++)xi.doCmdBatch("redo",xi.records[t]);else for(t=xi.index;t>e;t--)xi.doCmdBatch("undo",xi.records[t]);xi.index=e;var r=xi.needSetUnSaved();Ct("triggerEvent",["history_change",xi.records.length,xi.index,r,xi.fileWaitingforSaving]);Ct("triggerEvent",["select_change"])}};xi.go=function(e){try{xi.log(1===e?"redo":-1===e?"undo":"go("+e+")");xi.goTo(xi.index+e)}catch(e){ji.reportError(e);xi.clear()}};xi.doCmdBatch=function(e,t){function r(e){if(e){var t=v(e,"net");t&&i.nets.indexOf(t)<0&&i.nets.push(t);for(var r=s("[net]",e),n=0;n<r.length;n++){t=v(r[n],"net");t&&i.nets.indexOf(t)<0&&i.nets.push(t)}}}function n(t){var o,l,d;if(t&&G(t)&&t.length)if(G(t[0]))for(o=0,l=t.length;o<l;o++)n(t[o]);else{var h=t[1].split(",");for(o=0,l=h.length;o<l;o++){"add"==t[0]&&"undo"==e||"del"==t[0]&&"redo"==e?i.removeIds.indexOf(h[o])<0&&i.removeIds.push(h[o]):i.updateIds.push(h[o]);if(a)if("add"==t[0]&&"redo"==e||"del"==t[0]&&"undo"==e){d=s("#"+h[o],Yi);d=d&&d.length&&d[d.length-1];r(d)}else if("node"==t[0]){d=c("#"+h[o],Jn);r(d);d="undo"==e?t[2]:t[3];r(d)}else{d=c("#"+h[o],Jn);r(d)}}}}var i={updateIds:[],removeIds:[],nets:[],copper:[]},a=ya==ii.PCB;ii.PCB;n(t);!function(){var e,t,r;for(e=0,t=i.removeIds.length;e<t;e++){r=o(i.removeIds[e]);di.gJsonCache.panelize&&"panelizedOutline"===v(r,"c_outlinetype")&&delete di.gJsonCache.panelize;di.removeOne(r)}}();"redo"==e?xi.redoOne(t):xi.undoOne(t);rr();!function(){var e,t,r,n,a,s,c=[],l=[];for(e=0,t=i.updateIds.length;e<t;e++){r=o(i.updateIds[e]);n=ee(r);a=ya==ii.PCB||ya==ii.PCBLIB?"TEXT":"text";if("COPPERAREA"===n){c.push(i.updateIds[e]);s=i.nets.indexOf(v(r,"net"));s>-1&&i.nets.splice(s,1)}"PLANEZONE"===n&&l.push(i.updateIds[e]);n==a&&r.parentNode!=Jn&&(r=r.parentNode);if(r){r.tagName&&"circle"===r.tagName&&isNetCircleLayer(parseInt(v(r,"layerid")))&&circleToArcForJsonCatch(r);di.updateOne(r,{notCopper:!0,notUpdateElement:!0})}}var d,h=[];if(l.length){for(e=0;e<l.length;e++){d=di.gJsonCache.PLANEZONE[l[e]];d&&d.layerid&&-1===h.indexOf(d.layerid)&&h.push(d.layerid)}copperAreaMgr.rebuildPlane(h)}}();a&&function(){ya==ii.PCB&&i.nets.length&&ratLineMgr.buildGroupNets(i.nets)}();a&&ratLineMgr.historyHandler()};xi._undoRedos=[];xi.defineUndoRedo=function(e,t){xi._undoRedos[e]=t};xi.undoOne=function(e){if(G(e)){var t=[];if(G(e[0])){for(var r=e.length-1;r>=0;r--)e[r]&&"del"==e[r][0]&&t.push(e[r]);for(r=e.length-1;r>=0;r--)e[r]&&"del"!=e[r][0]&&t.push(e[r]);t.forEach(function(e){xi.undoOne(e)})}else{var n=xi._undoRedos[e[0]];n&&n.undo&&n.undo(e)}}};xi.redoOne=function(e){if(G(e)){var t=[];if(G(e[0])){for(var r=0,n=e.length;r<n;r++)e[r]&&"add"==e[r][0]&&t.push(e[r]);for(r=0,n=e.length;r<n;r++)e[r]&&"add"!=e[r][0]&&t.push(e[r]);t.forEach(function(e){xi.redoOne(e)})}else{var i=xi._undoRedos[e[0]];i&&i.redo&&i.redo(e)}}};xi.ids2elems=function(e){return e&&e!=Jn.id&&"config.colors"!=e&&"set.origin"!=e&&"set.target"!=e?s("#"+e.replace(/\,/g,",#"),Jn):[]};xi.defineUndoRedo("add",{undo:function(e){var t,r,n;e[0];n=e[1].split(",");for(r=n.length;--r>=0;){t=o(n[r]);t&&Yi.appendChild(t)}},redo:function(e){var t,r,n,i,a,c,d;e[0];d=e[2]&&/^</.test(e[2]);c=(e[2]||"").replace(/^</,"");a=c?o(c):null;i=e[1].split(",");for(r=0,n=i.length;r<n;r++){t=s("#"+i[r],Yi);t=t&&t.length&&t[t.length-1];if(t){h(t,"active")&&l(t,"active",!1);a&&d?a.appendChild(t):a&&a.parentNode?a.parentNode.insertBefore(t,a):ya==ii.PCB||ya==ii.PCBLIB||ya==ii.WAVEFORM?Layer.appendElement(t):Jn.appendChild(t);xi.updateCache(t,v(t,"net")||"")}}}});xi.defineUndoRedo("del",{undo:function(e){var t,r,n,i,a,c;e[0];c=e[2]&&/^</.test(e[2]);a=(e[2]||"").replace(/^</,"");i=a?o(a):null;n=e[1].split(",");for(r=n.length;--r>=0;){t=s("#"+n[r],Yi);t=t&&t.length&&t[t.length-1];if(t){h(t,"active")&&l(t,"active",!1);i&&c?i.appendChild(t):i&&i.parentNode?i.parentNode.insertBefore(t,i):ya==ii.PCB||ya==ii.PCBLIB||ya==ii.WAVEFORM?Layer.appendElement(t):Jn.appendChild(t);xi.updateCache(t,v(t,"net")||"")}}},redo:function(e){var t,r,n;e[0];n=e[1].split(",");for(r=n.length;--r>=0;){t=o(n[r]);t&&Yi.appendChild(t)}}});xi.defineUndoRedo("attr",{undo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]!=Jn.id)if("panelize"!==e[1]){r=s("#"+e[1].replace(/\,/g,",#"),Jn);for(n=0;n<r.length;n++){t=r[n];if(t){if(ya==ii.PCB){i="net";a=v(t,i);a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");w(e[2],i)&&o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");w(e[3],i)&&o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}v(t,e[2]);xi.updateCache(t,o)}}}else applyPanelize(e[2],!1);else v(Jn,e[2])},redo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]!=Jn.id)if("panelize"!==e[1]){r=s("#"+e[1].replace(/\,/g,",#"),Jn);for(n=0;n<r.length;n++){t=r[n];if(t){if(ya==ii.PCB){i="net";a=v(t,i);a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");w(e[2],i)&&o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");w(e[3],i)&&o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}v(t,e[3]);xi.updateCache(t,o)}}}else applyPanelize(e[3],!1);else v(Jn,e[3])}});xi.defineUndoRedo("attrpanel",{undo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]==Jn.id){En("canvas",e[2],"NotSaveHistory");Ct("updateAttrPanel")}else{r=s("#"+e[1].replace(/\,/g,",#"),Jn);for(n=0;n<r.length;n++){t=r[n];if(t){if(ya==ii.PCB){a=v(t,"net");a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");for(i in e[2])if(w(e[2],i)&&"-net"==i.substr(i.length-4)){o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}}En(t||e[1],e[2],"NotSaveHistory");t&&xi.updateCache(t,o)}}}},redo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]==Jn.id){En("canvas",e[3],"NotSaveHistory");Ct("updateAttrPanel")}else{r=s("#"+e[1].replace(/\,/g,",#"),Jn);for(n=0;n<r.length;n++){t=r[n];if(t){if(ya==ii.PCB){a=v(t,"net");a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");for(i in e[2])if(w(e[2],i)&&"-net"==i.substr(i.length-4)){o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}}En(t,e[3],"NotSaveHistory");xi.updateCache(t,o)}}}}});xi.defineUndoRedo("node",{undo:function(e){var t,r,n,i=(e[0],"\0");t=o(e[1]);if(t){var a=Jn.id,s=e[2].cloneNode(!0);if(ya==ii.PCB&&t.id!==a){var c=v(s,"net"),d=v(t,"net");c&&i.indexOf("\0"+c+"\0")<0&&(i+=c+"\0");d&&i.indexOf("\0"+d+"\0")<0&&(i+=d+"\0")}t.parentNode.replaceChild(s,t);h(s,"active")&&l(s,"active",!1);if(t.id===a){Jn=o(a);r=s.childNodes.filter(function(e){return h(e,"active")});n=r[0]&&r[0].id;fi=o(n)}else xi.updateCache(s,i)}},redo:function(e){var t,r=(e[0],"\0");t=o(e[1]);if(t){var n=Jn.id,i=e[3].cloneNode(!0);if(ya==ii.PCB&&t.id!==n){var a=v(i,"net"),s=v(t,"net");a&&r.indexOf("\0"+a+"\0")<0&&(r+=a+"\0");s&&r.indexOf("\0"+s+"\0")<0&&(r+=s+"\0")}h(i,"active")&&l(i,"active",!1);t.parentNode.replaceChild(i,t);if(t.id===n){Jn=o(n);activeNode=i.childNodes.filter(function(e){return h(e,"active")});activeId=activeNode[0]&&activeNode[0].id;fi=o(activeId)}else xi.updateCache(i,r)}}});xi.defineUndoRedo("text",{undo:function(e){var t=o(e[1]);if(t&&e[2]){Ye(t,e[2]);xi.updateCache(t)}},redo:function(e){var t=o(e[1]);if(t&&e[3]){Ye(t,e[3]);xi.updateCache(t)}}});xi.defineUndoRedo("move",{undo:function(e){var t;e[0];t=s("#"+e[1].replace(/\,/g,",#"),Jn);Xe(t,-e[2],-e[3]);xi.updateCache(t)},redo:function(e){var t;e[0];t=s("#"+e[1].replace(/\,/g,",#"),Jn);Xe(t,e[2],e[3]);xi.updateCache(t)}});xi.defineUndoRedo("rotate",{undo:function(e){var t;e[0];t=s("#"+e[1].replace(/\,/g,",#"),Jn);_r(t,be(-e[2]));xi.updateCache(t)},redo:function(e){var t;e[0];t=s("#"+e[1].replace(/\,/g,",#"),Jn);mr(t,e[2]);xi.updateCache(t)}});xi.defineUndoRedo("copperArea",{undo:function(e){},redo:function(e){}});xi.defineUndoRedo("variable",{undo:function(e){var t=e[2],r=e[3],n=e[4],i=e[6];switch(typeof n){case"object":G(n)&&[];t[r]=ji.extend({},n);break;case"string":case"number":case"boolean":case"function":t[r]=n}i&&i("undo",t,r,n)},redo:function(e){var t=e[2],r=e[3],n=e[5],i=e[6];switch(typeof n){case"object":G(n)&&[];t[r]=ji.extend({},n);break;case"string":case"number":case"function":t[r]=n}i&&i("redo",t,r,n)}});xi.defineUndoRedo("originXY",{undo:function(e){var t=e[2];if((t.offsetX||0==t.offsetX)&&(t.offsetY||0==t.offsetY)){ops={};ops.x=_i.canvas.originX-t.offsetX;ops.y=_i.canvas.originY-t.offsetY;r("setOriginXY",[{x:ops.x,y:ops.y}])}},redo:function(e){var t=e[2];if((t.offsetX||0==t.offsetX)&&(t.offsetY||0==t.offsetY)){ops={};ops.x=_i.canvas.originX+t.offsetX;ops.y=_i.canvas.originY+t.offsetY;r("setOriginXY",[{x:ops.x,y:ops.y}])}}});xi.defineUndoRedo("targetEdit",{undo:function(e){var t=e[2],r=e[3];r&&r("undo",t)},redo:function(e){var t=e[2],r=e[3];r&&r("redo",t)}});xi.defineUndoRedo("elePosition",{undo:function(e){var t,r,n,i;e[0];i=e[1].split(",");r=e[2].split(",");for(n=i.length;--n>=0;){t=o(i[n]);t&&ie(t.parentNode,t,r[n])}},redo:function(e){var t,r,n,i;e[0];i=e[1].split(",");r=e[3].split(",");for(n=i.length;--n>=0;){t=o(i[n]);t&&ie(t.parentNode,t,r[n])}}});xi.removeCache=function(e){};xi.updateCache=function(e,t){};xi.canRedo=function(){return xi.index<xi.records.length-1};xi.canUndo=function(e){return xi.index>=0};xi.allRecordsToString=function(){for(var e=[],t=0,r=xi.records,n=r.length;t<n;t++)e[t]=xi.recordToString(r[t]);return e};xi.recordToString=function(e){if(!e||!e[0])return"";if(Array.isArray(e[0]))return xi.recordToString(e[0])+(e.length>1?"...["+e.length+"]":"");if("string"!=typeof e[1])return e[0];var t=e[0],r="#"+e[1].replace(/\,/g,",#"),n=t+" : "+r;switch(t){case"add":case"del":e[2]&&(n+=" ; next_sibling : #"+e[2]);break;case"attr":case"attrpanel":n+=" ; old:"+JSON.stringify(e[2])+"; new:"+JSON.stringify(e[3]);break;case"node":break;case"text":n+=" ; old: "+X(e[2])+"; new: "+X(e[3]);break;case"move":n+=" ; dx:"+e[2]+"; dy:"+e[3];break;case"rotate":n+=" ; degree : "+e[2]}return n};xi.recordToPlainObject=function(e,t){function r(e){if(!e)return"<null/>";var t;if(e.children[0]){t=xi.XMLSerializer.serializeToString(e.cloneNode(!1));t=t.replace(/\/?>.*/,">...</"+e.tagName+">")}else t=xi.XMLSerializer.serializeToString(e);t=t.replace(/ xmlns="[^"]*"/g,"");return t}function n(e){return e.split(",").map(function(e){if(!e)return"<null/>";try{var t=e==Jn.id?Jn:Jn.querySelector("#"+e);return t?r(t):"<null/>"}catch(e){return"<ERROR/>"}})}function i(e){for(var t,n=e.split(","),i=[],a=0,o=n.length;a<o;a++)if(n[a]){t=s("#"+n[a],Yi);t=t&&t.length&&t[t.length-1];if(t)try{i.push(r(t))}catch(e){i.push("<null/>")}else i.push("<null/>")}else i.push("<null/>");return i}function a(e){if(Array.isArray(e[0]))return e.map(a);var t=e.slice(),o=t[0];if("node"==o){t[2]=r(t[2]);t[3]=r(t[3])}else"add"==o?t.push(n(t[1])):"del"==o&&t.push(i(t[1]));return t}return e&&e[0]&&Array.isArray(e)?a(e):""};Ln.prototype.deleteItemAt=function(e){this.hist.splice(e,1);this.nodes.splice(e,1)};Ln.prototype.update=function(){for(var e=this.hist,t=this.nodes,r=0,n=t.length;r<n;r++)e[r][3]=t[r].cloneNode(!0)};Ln.prototype.updateAndSave=function(){this.update();this.hist.length>0&&xi.save(this.hist)};r.registerHook({getHistory:function(){return{index:xi.index,records:xi.allRecordsToString()}},getHistoryTimestamp:function(){var e=xi.index,t={};e>=0&&(t.undo=xi.timestamps[e]);e<xi.records.length-1&&(t.redo=xi.timestamps[e+1]);return t},consoleHistory:function(){},clearHistory:function(){xi.clear()},cacheHistory:function(){xi.startBatch()},flushHistory:function(){xi.saveBatch()}});r.registerHook({setColors:Gn});di.eleCacheUpdate=function(e){ji.fileType.isLib(ya)||ya==ii.WAVEFORM||("schlib"==e||"busentry"==e||"netflag"==e?di._rebuildDotsCache():"junction"==e?di._rebuildJunctionsCache():"wire"==e&&di._rebuildWiresCache())};di.ifFind=function(e,t){var r,n={type:"",X:0,Y:0},i=[],o=new a(e,t),s=ia.getSanpSize("X")/2;for(r in di.dots){if(e==di.dots[r].x&&t==di.dots[r].y){n.type=1;n.X=e;n.Y=t;return n}if(Math.abs(e-di.dots[r].x)<=s&&Math.abs(t-di.dots[r].y)<=s){n.type=2;n.X=di.dots[r].x;n.Y=di.dots[r].y;return n}}for(r in di.wires)if(w(di.wires,r)){i=di.wires[r];var c=fe(o,i,4);if(c){n.type=3;n.X=parseInt(c.point.x,10);n.Y=parseInt(c.point.y,10);n.wireId=r;return n}}return n};di.checkShow=function(e,t){var r=o("pdot0"),n="wire-hover",i=di.ifFind(e,t),a="none"!=v(r,"display");if(i.type)if(3==i.type){var s=o(i.wireId);if(s){di.lastHoverWire&&s!=di.lastHoverWire&&u(di.lastHoverWire,n);f(di.lastHoverWire=s,n)}else di.lastHoverWire&&u(di.lastHoverWire,n);a&&v(r,"display","none")}else v(r,{display:"",cx:i.X,cy:i.Y});else{di.lastHoverWire&&u(di.lastHoverWire,n);a&&v(r,"display","none")}};di.getPinDots=function(e){if(e){for(var t,r=s("circle.pindot",e),n=r.length,i=[],a=0;a<n;a++){t=r[a];i.push(t.cx.baseVal.value,t.cy.baseVal.value)}return i}return di.dots};di.getWires=function(e){return e?di.wires[e]:di.wires};di.getNoConnectFlags=function(e){if(di.gJsonCache&&di.gJsonCache.noconnectflag){return e?di.gJsonCache.noconnectflag[e]:di.gJsonCache.noconnectflag}};di.hasJunctionAtXY=function(e,t){var r=di.junctions,n=!1;for(var i in r)if(w(r,i)&&e==r[i].x&&t==r[i].y){n=!0;break}return n};di.removeOne=function(e){if(e){"image"===e.tagName&&e.parentNode&&"part_image"===v(e.parentNode,"c_partid")&&(e=e.parentNode);var t=v(e,"id"),r=ee(e),n=di.gJsonCache[r];e.parentNode&&e.parentNode.id.indexOf("frame_lib_")>-1&&(n=di.gJsonCache.schlib[e.parentNode.id][r]);if(n){delete n[t];di.eleCacheUpdate(r)}}};di.removeAll=function(){di.wires={};di.dots={};di.junctions={};var e={head:1,canvas:1,BBox:1,zoom:1,itemOrder:1,importFlag:1,title:1};di.gJsonCache.itemOrder=[];for(var t in di.gJsonCache)!w(di.gJsonCache,t)||t in e||(di.gJsonCache[t]={})};di.updateOne=function(e){if(e&&(!e.parentNode||"gCurParts"!=e.parentNode.id)&&e.tagName&&Jn.contains(e)){e=It(e);if(e&&3!=e.nodeType){var t=v(e,"id"),r=ee(e);if(ga[r]){var n=ga.toObj(e);di.gJsonCache[r]||(di.gJsonCache[r]={});di.gJsonCache[r][t]=n;di.eleCacheUpdate(r)}}}};di.updateMore=function(e){if(e&&e.length)for(var t=0,r=e.length;t<r;t++)di.updateOne(e[t])};di.calAll=function(){
var e=Jn.childNodes;di.removeAll();di.updateMore(e)};di._rebuildWiresCache=function(){di.wires={};if(di.gJsonCache.wire)for(var e in di.gJsonCache.wire)if(w(di.gJsonCache.wire,e)){di.wires[e]=di.gJsonCache.wire[e].pointArr;di.wires[e]||delete di.wires[e]}};di._rebuildDotsCache=function(){di.dots={};var e,t,r;if(di.gJsonCache.schlib)for(e in di.gJsonCache.schlib)if(w(di.gJsonCache.schlib,e)){t=di.gJsonCache.schlib[e];if(!t||!t.pin)continue;for(r in t.pin)w(t.pin,r)&&"show"==t.pin[r].configure.display&&(di.dots[e+"_"+r]=t.pin[r].pinDot)}if(di.gJsonCache.busentry)for(e in di.gJsonCache.busentry)if(w(di.gJsonCache.busentry,e)){t=di.gJsonCache.busentry[e];di.dots[e+"_0"]={x:+t.x1,y:+t.y1};di.dots[e+"_1"]={x:+t.x2,y:+t.y2}}if(di.gJsonCache.netflag)for(e in di.gJsonCache.netflag)if(w(di.gJsonCache.netflag,e)){t=di.gJsonCache.netflag[e];di.dots[e+"_0"]=t.pinDot}};di._rebuildJunctionsCache=function(){di.junctions={};var e,t;if(di.gJsonCache.junction)for(e in di.gJsonCache.junction)if(w(di.gJsonCache.junction,e)){t=di.gJsonCache.junction[e];di.junctions[e]=t.pinDot}};var ga={toObj:function(e){if(!e)return!1;var t=ee(e);return!!ga[t]&&ga[t](e)},_lineCommonObj:function(e){var t=1===e.nodeType?Je(e):e;return{gId:t.id,strokeColor:t.stroke,strokeWidth:t["stroke-width"],strokeStyle:Hn(t["stroke-dasharray"]),fillColor:t.fill||"",locked:t.locked||0}},polyline:function(e){var t=Je(e),r=ga._lineCommonObj(t);r.pointArr=I(t.points);return r.pointArr.length>=2&&r},wire:function(e){return ga.polyline(e)},bus:function(e){return ga.polyline(e)},rect:function(e){if("hitbox"!=e.className.baseVal){var t=Je(e),r=ga._lineCommonObj(t);r.x=t.x;r.y=t.y;r.rx=t.rx||"";r.ry=t.ry||"";r.width=t.width;r.height=t.height;return r}},image:function(e){var t=Je(e),r=xe(e);r&&(r=360-r);return{gId:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:r,href:H((t["xlink:href"]||t.href).replace(/~/g,"%7E")),locked:t.locked||0}},circle:function(e){var t=Je(e),r=ga._lineCommonObj(t);r.cx=t.cx;r.cy=t.cy;r.r=t.r||1;return r},ellipse:function(e){var t=Je(e),r=ga._lineCommonObj(t);r.cx=t.cx;r.cy=t.cy;r.rx=t.rx||1;r.ry=t.ry||1;return r},line:function(e){var t=Je(e),r=ga._lineCommonObj(t);r.x1=t.x1||1;r.y1=t.y1||1;r.x2=t.x2||1;r.y2=t.y2||1;return r},polygon:function(e){return ga.polyline(e)},path:function(e){var t=Je(e),r=ga._lineCommonObj(t);r.pathString=t.d;return r},arc:function(e){var t=ga.path(e);t.helperDots="";return t},annotation:function(e){var t=Je(e.childNodes[0]),r="L";if(!t)return!1;"note_name"==t.c_note?r="N":"note_pre"==t.c_note?r="P":"note_package"==t.c_note&&(r="PK");var n=xe(e.childNodes[0]),i=v(e,"display"),a=We(e.childNodes[0],"\\n")||"";a=U(a);"P"==r&&(a=a.toUpperCase());if(!a){if("N"!=r&&"P"!=r)return!1;a=" "}return{gId:e.id,mark:r,x:t.x,y:t.y,rotation:n,fillColor:t.fill||"",fontFamily:jn(t["font-family"]),fontSize:Un(t["font-size"]),fontWeight:t["font-weight"]||"",fontStyle:t["font-style"]||"",dominantBaseline:t["dominant-baseline"]||"",type:t.type||"comment",string:a,visible:"none"==i?0:1,textAnchor:t["text-anchor"],locked:v(e,"locked")||0}},pimage:function(e){var t=Je(e.childNodes[0]),r="L";if(!t)return!1;"note_name"==t.c_note?r="N":"note_pre"==t.c_note&&(r="P");var n=(xe(e.childNodes[0]),v(e,"display")),i=ga.image(e.childNodes[0]);return{gId:e.id,mark:r,visible:"none"==n?0:1,locked:i.locked||0,imgid:i.gId,imgx:i.x,imgy:i.y,imgwidth:i.width,imgheight:i.height,imghref:H((i["xlink:href"]||i.href).replace(/~/g,"%7E"))}},pin:function(e){return{configure:function(e){var t=Je(e),r=t.c_origin.split(",");return{display:t.c_show,electric:t.c_elec,spicePin:U(t.c_spicepin),x:r[0]||0,y:r[1]||0,rotation:t.c_rotation,gId:t.id,locked:t.locked||0}},pinDot:function(e){var t=Je(e);return new a(t.cx,t.cy)},path:function(e){var t=Je(e);return{pathString:F(t.d),pinColor:t.stroke}},name:function(e){var t=Je(e);return{visible:"none"==t.display?0:1,x:t.x,y:t.y,rotation:xe(e),text:Y(e.textContent),textAnchor:t["text-anchor"],fontFamily:jn(t["font-family"]),fontSize:Un(t["font-size"]),fillColor:t.fill}},num:function(e){e.textContent=Y(e.textContent);return this.name(e)},dot:function(e){if(!e)return{};var t=Je(e);return{visible:"none"==t.display?0:1,x:t.cx||0,y:t.cy||0}},clock:function(e){if(!e)return{};var t=Je(e);return{visible:"none"==t.display?0:1,pathString:t.d||""}},all:function(e){return{configure:this.configure(e),pinDot:this.pinDot(e.childNodes[2]),path:this.path(e.childNodes[3]),name:this.name(e.childNodes[0]),num:this.num(e.childNodes[1]),dot:this.dot(e.childNodes[4]),clock:this.clock(e.childNodes[5])}}}.all(e)},junction:function(e){var t=Je(e.childNodes[1]);return{pinDot:new a(t.cx,t.cy),r:t.r||1,fillColor:t.fill,gId:e.id,locked:t.locked||0}},netlabel:function(e){var t=xe(e.childNodes[1]),r=Je(e.childNodes[1]),n=Je(e.childNodes[0]);return{gId:e.id,pinDot:new a(n.cx,n.cy),rotation:t,fillColor:r.fill||"#000080",name:U(H(e.childNodes[1].textContent)),textAnchor:r["text-anchor"],x:r.x,y:r.y,fontFamily:r["font-family"],fontSize:r["font-size"],locked:v(e,"locked")||0}},netflag:function(e){return{configure:function(e){var t=Je(e),r=t.c_origin.split(",");return{gId:t.id,partId:t.c_partid,x:r[0]||0,y:r[1]||0,rotation:t.c_rotation||"0",locked:t.locked||0}},pinDot:function(e){var t=Je(e);return new a(t.cx,t.cy)},mark:function(e){var t;t="text"!==e.tagName?e.children[0]:e;var r=Je(t),n=(r.transform||"").match(/^rotate.\-?\d+/)||"0";n="0"==n?"0":(n+"").replace("rotate(","");return{netFlagString:(U(H(e.textContent))||"").trim(),fillColor:r.fill,x:r.x,y:r.y,rotation:n,textAnchor:r["text-anchor"],visible:"none"==r.display?0:1,fontFamily:jn(r["font-family"]),fontSize:Un(r["font-size"])}},all:function(e){for(var t=e.childNodes.length,r={configure:this.configure(e),pinDot:this.pinDot(e.childNodes[0]),mark:this.mark(e.childNodes[1]),shapes:{}},n=2;n<t;n++){var i=e.childNodes[n];if(3!=i.nodeType){var a=ga.toObj(i),o=ee(i);if(a){r.shapes[o]||(r.shapes[o]={});r.shapes[o][a.gId]=a}}}return r}}.all(e)},busentry:function(e){var t=v(e,"c_rotation")||"0",r=Je(e.childNodes[2]);return{gId:e.id,x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,rotation:t,locked:v(e,"locked")||0}},schlib:function(e){for(var t=e.childNodes,r=Je(e),n=r.c_origin.split(","),i={head:{gId:e.id,x:n[0]||0,y:n[1]||1,c_para:r.c_para,rotation:r.c_rotation,importFlag:0,puuid:r.puuid,uuid:r.uuid,locked:r.locked||0,bindPCBId:r.bindPCBId||""},itemOrder:[]},a=0,o=t.length;a<o;a++){var s=t[a];if(3!=s.nodeType){var c=ga.toObj(s),l=ee(s);if(c){i[l]||(i[l]={});var d="pin"==l?c.configure.gId:c.gId;i[l][d]=c;i.itemOrder.push(d)}}}return i},arrowhead:function(e){var t=Je(e),r=t.c_origin.split(",");return{partType:t.c_partid,x:r[0]||0,y:r[1]||1,gId:t.id,rotation:t.c_rotation,pathString:v(e.childNodes[0],"d"),fillColor:v(e.childNodes[0],"fill")||"",locked:t.locked||0,arrowtype:t.arrowtype||"3",arrowsize:t.arrowsize||15}},noconnectflag:function(e){var t=Je(e),r=t.c_origin.split(",");return{x:r[0]||0,y:r[1]||1,gId:t.id,pathString:v(e.childNodes[0],"d"),strokeColor:v(e.childNodes[0],"stroke")||"",locked:t.locked||0}},svgnode:function(e){if(1===e.nodeType){var t=Je(e),r={gId:t.id,nodeName:e.nodeName,nodeType:e.nodeType};delete t.class;delete t.xmlns;r.attrs=t;var n=0,i=e.childNodes,a=i.length;if(a){r.childNodes=[];for(;n<a;n++)r.childNodes[n]=ga.svgnode(i[n])}return r}return{nodeName:e.nodeName,nodeType:e.nodeType,nodeValue:e.nodeValue}}},ya=e.frameElement?e.frameElement.getAttribute("c_doctype"):"1";if(Ft(ya)||ya==ii.SCHMODULE){_i.canvas.originX=0;_i.canvas.originY=0;_i.adsorbGrid.gridSize=5;_i.adsorbGrid.distanceX=5;_i.adsorbGrid.distanceY=5}!function(){e.doctype=ya;r.registerHook({getJsonCache:function(){return di.gJsonCache},gCanvas:function(){return Jn},getLogs:function(){return xi.getLogs()},selectedObj:function(){return kr()},setCustomPara:function(e,t){var r=Ar(),n=r.length;1===n?nt(r[0],e,t):n>1?r.forEach(function(r){nt(r,e,t)}):nt(Jn,e,t)},changeCanvasUnit:function(){Ct("changeCanvasUnit")},setPinMap:function(){return Mr.apply(null,arguments)},importDocEdit:function(){return xn.apply(null,arguments)},importPart:function(){return bn.apply(null,arguments)},importModule:function(){return Sn.apply(null,arguments)},importShape:function(){return Cn.apply(null,arguments)},placePart:function(e){return zn(e)},drawShape:function(e){return Xn(e)},updateShape:function(){return Yn.apply(null,arguments)},setToolbarCmd:function(){return Jt.apply(null,arguments)},zoom:function(){return er.apply(null,arguments)},getDocStatus:function(){return tr.apply(null,arguments)},getViewStatus:function(){return vt()},getCanvas:function(){return An()},getBBox:function(){var t,r;try{t=Jn.getBBox()}catch(n){r=e.frameElement.parentNode;if("none"!=r.style.display)throw"getBBox error";r.style.display="";try{t=Jn.getBBox()}catch(e){}r.style.display="none"}if(t&&0===t.x&&0===t.y&&0===t.width&&0===t.height){r=e.frameElement.parentNode;if("none"==r.style.display){r.style.display="";try{t=Jn.getBBox()}catch(e){}r.style.display="none"}}if(t)return{x:ji.toFixed(t.x,1),y:ji.toFixed(t.y,1),width:ji.toFixed(t.width,1),height:ji.toFixed(t.height,1)}},getPackage:function(){return ji.c_paraToJson(v(Jn,"c_para")).package},getComponents:function(){return ir()},findComponent:function(e,t,r,n,i){return or(e,t,r,n,i)},getPadsByFootprintId:function(e){return getPadsByFootprintId(e)},updateSaveIndex:function(){xi.savedIndex=xi.index;xi.fileWaitingforSaving=!1},checkPrefixNamesAndNetNames:function(e,t,r,n,i){if(!(e&&e.length||t&&t.length||r&&Object.keys(r).length))return!1;var a=i&&i.toString()||ya;if(a===ii.SCH||a===ii.PCB){var o,s,c,l,d=n||di.gJsonCache;if(d.schlib){o=d.schlib;s="annotation";c="mark";l=ii.SCH}else if(d.FOOTPRINT){o=d.FOOTPRINT;s="TEXT";c="type";l=ii.PCB}if(o&&e&&e.length>0)for(var h in o)if(w(o,h)){var f=o[h][s];for(var u in f)if(w(f,u)){var p=f[u];if("P"==p[c]&&-1!==e.indexOf(l===ii.PCB?p.text:p.string.split(".")[0]))return!0}}if(a===ii.PCB){if(t&&t.length>0)for(h in d){var g=d[h];if("TRACK"==h||"PAD"==h||"ARC"==h||"VIA"==h||"HOLD"==h&&eleJson){for(var y in g)if(w(g,y)&&t.indexOf(g[y].net)>-1)return!0}else if("FOOTPRINT"==h){g=d[h];for(y in g)if(w(g,y)){var v=g[y];for(var x in v){var m=v[x];if("TRACK"==x||"PAD"==x||"ARC"==x||"VIA"==x||"HOLD"==x&&m)for(var _ in m)if(w(m,_)&&t.indexOf(m[_].net)>-1)return!0}}}}}else if(a===ii.SCH&&r&&Object.keys(r).length>0&&o)for(var b in o){var S=o[b];f=S.annotation;for(u in f)if(w(f,u)){p=f[u];var C=p.string.split(".")[0];if("P"==p.mark&&r[C]&&S.pin)for(var P in S.pin){var N=S.pin[P];if(w(N,"num")&&N.num.text==r[C])return!0}}}return!1}},setSymbolInfo:function(e){ht(e)},groupSymbol:function(){return Pr.apply(null,arguments)},isPreUsed:function(e){return e.indexOf("?")<0&&li.isUsed(e)},saveHistory:function(e){xi.save(e)},undo:function(){pa.started&&pa.dots.length||zi.on&&zi.waitingSave||nn()||e.routeLengthTuning&&routeLengthTuning.status&&routeLengthTuning.status.ready||(Ft(ya)?Ct("project_undo"):xi.go(-1))},redo:function(){pa.started&&pa.dots.length||zi.on&&zi.waitingSave||nn()||e.routeLengthTuning&&routeLengthTuning.status&&routeLengthTuning.status.ready||(Ft(ya)?Ct("project_redo"):xi.go(1))},sheet_undo:function(){pa.started&&pa.dots.length||zi.on&&zi.waitingSave||nn()||e.routeLengthTuning&&routeLengthTuning.status&&routeLengthTuning.status.ready||xi.go(-1)},sheet_redo:function(){pa.started&&pa.dots.length||zi.on&&zi.waitingSave||nn()||e.routeLengthTuning&&routeLengthTuning.status&&routeLengthTuning.status.ready||xi.go(1)},changeTrackWidth:function(){"draw.track"===yi&&Ct("toggleTrackWidthPanel",[Ht.data])},cut:function(){!nn()&&hr()},pasteRepeatedly:function(){nn()||pasteFromSelectedObjs()},copyByRefPoint:function(){nn()||copyByRefPoint()},copy:function(){var e=!1;if(!nn()){e=fr();if(e){copyByRefPoint.fn.position=!1;copyByRefPoint.fn.started=!1}}},paste:function(){!nn()&&pr()},pasteCloseRatLines:function(){!nn()&&pasteFromClipboardAfterCloseRatline()},paste_xdoc:function(){!nn()&&pr()},clone:function(){var e=arguments[0];if("object"==typeof e&&e.ids){var t=e.ids;if(!Array.isArray(t))return;var r=t.map(function(e){return o(e)});r=r.filter(function(e){return e&&e.parentNode==Jn});if(r.length)return yr(r)}},select_all:function(){!nn()&&Tr()},select_none:function(){rr()},getSelectedIds:function(){return Mt()},getSelectAttrJson:function(){var e=Ar();return e.length>=1?Je(e[0]):{}},select:function(){var e=arguments[0];if("object"==typeof e&&e.ids){var t=e.ids;if(!Array.isArray(t))return;var r=t.map(function(e){return o(e)});r=r.filter(function(e){return e&&e.parentNode==Jn});if(r.length)return Lr(r)}},clear_canvas:function(){ua.clear()},move:function(){cr.apply(null,arguments)},moveTo:function(){lr.apply(null,arguments)},drag:function(){},bring_to_front:function(){br()},send_to_back:function(){Sr()},ctrlTab:function(){Ct("ctrlTab")},ctrlTabReverse:function(){Ct("ctrlTabReverse")},openLayerOptionsSet:function(){Ct("openLayerOptionsSetDlg")},toggleActiveLayerVisible:function(){Ct("toggleActiveLayerVisible",[Layer.getActiveLayer()])},changeRouteConflictWay:function(){Ct("changeRouteConflictWay")},align_left:function(e){xr("align_left",e)},align_right:function(e){xr("align_right",e)},align_top:function(e){xr("align_top",e)},align_bottom:function(e){xr("align_bottom",e)},align_horizontal_center:function(e){xr("align_horizontal_center",e)},align_vertical_center:function(e){xr("align_vertical_center",e)},align_horizontal_equidistant:function(e){xr("align_horizontal_equidistant",e)},align_vertical_equidistant:function(e){xr("align_vertical_equidistant",e)},align_left_side_edge_equidistant:function(e){xr("align_left_side_edge_equidistant",e)},align_top_side_edge_equidistant:function(e){xr("align_top_side_edge_equidistant",e)},align_grid:function(e){xr("align_grid",e)},rotate_left:function(){var e=arguments[0];"object"==typeof e&&e.ids?r("rotate",[{ids:e.ids,degree:270}]):r("rotate",[270])},rotate_right:function(){var e=arguments[0];"object"==typeof e&&e.ids?r("rotate",[{ids:e.ids,degree:90}]):r("rotate",[90])},fliph:function(){var e,t=arguments[0];if("object"==typeof t&&t.ids){e=t.ids;if(!Array.isArray(e))return;var r=e.map(function(e){return o(e)});r=r.filter(function(e){return e&&e.parentNode==Jn&&!aa.isLocked(e)});r.length&&vr(1,r)}else vr(1)},flipv:function(){var e,t=arguments[0];if("object"==typeof t&&t.ids){e=t.ids;if(!Array.isArray(e))return;var r=e.map(function(e){return o(e)});r=r.filter(function(e){return e&&e.parentNode==Jn&&!aa.isLocked(e)});r.length&&vr(0,r)}else vr(0)},lock:function(){aa.lockObjs()},unlock:function(){aa.unlockObjs()},unlockAll:function(){aa.unlockObjs(s('[locked="1"]',Jn))},fitview:function(){rt()},cross_cursor:function(e){!1===e&&Tt(!1)},canvas_config:function(){return A(_i.canvas)},getConfig:function(){return A(_i)},config:function(){return _i},attrpanel_apply:function(e,t,r,n,i){En(e,t,r,n,i)},attrpanel_data:function(){return Mn()},realTimeNetLengthHandler:function(){Ct("realTimeNetLengthHandler",[{type:"updateConfig"}])},getCanvasAttr:function(){return ua.getCanvasAttrs()},size:function(){return{width:+v(hi,"width"),height:+v(hi,"height")}},currZoom:function(){return Ji},getSelected:function(){return Ar()},getSelectedObjs:function(){return Ar(!0)},deletePathNode:function(e){e&&Ir(e.target[0])},delete_segment:function(e){dt(e.target[0],{x:e.x,y:e.y})},convert_to_NPTH:function(e){convertToNPTH(e.target)},convert_to_pad:function(e){convertToPolygonPad(e.target)},editorShowAttrDialog:function(){Gt()},updatePackageUuid:function(e,t){if(e&&Object.keys(e).length){var r,n,i,a=di.gJsonCache,s=a.schlib||a.FOOTPRINT;for(i in e)if(w(e,i))for(r in s)if(w(s,r)&&!r.match(/frame_lib_/)){n=ji.c_paraToJson(s[r].head.c_para);if(n.package==i)if(t==ii.PCB||t==ii.PCBMODULE){s[r].head.uuid=e[i].uuid;s[r].head.utime=e[i].updateTime||"";v(o(r),{uuid:e[i].uuid,utime:e[i].updateTime||""})}else{s[r].head.puuid=e[i].uuid;v(o(r),{puuid:e[i].uuid})}}a.head.hasIdFlag=!0}},getNearestGridPoint:function(){return he(arguments[0],arguments[1])},dragMoveSwitch:on,dragMoveCheck:sn,getSnappedPoint:je,getDecimalConfig:function(){return{fixedDecimal:Pi.fixedDecimal,decimalPlaces:Pi.decimalPlaces,decimalPlacesShow:Pi.decimalPlacesShow}},getElementInfoById:function(e){return Je(o(e))},getLibInfoById:function(e){var t=o(e),r=Je(t),n=di.gJsonCache,i={ele:[t],attr:r,bbox:ji.svg.getBBox(t),uuid:v(t,"uuid")};if(n.schlib)i.schlib=n.schlib[e];else if(n.FOOTPRINT){i.FOOTPRINT=n.FOOTPRINT[e];var a=n.FOOTPRINT[e].PAD,s={};if(a){for(var c in a)w(a,c)&&(s[a[c].number]=a[c].net);i.nets=s}}return i},findSimilar:function(e){e?Dt(e):Ct("showFindSimilarDlg")},distributeItems:function(e){Rt(e)},removeCustomAttr:function(e){var t;t=ya==ii.SCHLIB||ya==ii.PCBLIB||ya==ii.SUBPART?[o("g1")]:Ar();var r,n;if(1===t.length&&/\.\d+$/.test(Vt("pre",t[0]).textContent))for(var i=Ct("getAllJson"),a=Vt("pre",t[0]).textContent,s=0;s<i.length;s++){var c=i[s].json.schlib,l=Ct("getTabById",[i[s].fid]).contentWindow.document;for(var d in c)if(!(d.indexOf("frame_lib")>=0)){var h=[];for(var f in c[d].annotation)h.push(c[d].annotation[f]);var u=h[1].string.indexOf(".");if(u>=1&&h[1].string.substr(0,u)===a.substr(0,u)){var p=l.getElementById(c[d].head.gId);r=v(p,"c_para");n=ji.c_paraToJson(r);delete n[e];v(p,"c_para",ji.jsonToC_para(n));di.updateOne(p)}}}t.forEach(function(t){r=v(t,"c_para");n=ji.c_paraToJson(r);delete n[e];v(t,"c_para",ji.jsonToC_para(n));di.updateOne(t)});Ct("setTabUnsaved")},setPrePosition:function(e){zt(e)},show_drawing_attr_dlg:function(e,t){if("TRACK"===e||"ARC"===e||"CIRCLE"===e)var r=v(t,"stroke-width");Ct("show_drawing_attr_dlg",[e,"",r])},modify_drawing_attr:function(e,t){var n={},i=ee(pa.target);""===i&&pa.controlLine&&(i=ee(pa.controlLine));if(pa.started&&pa.target||"origin"===i){switch(e){case"name":switch(i){case"schlib":n["attr-part-common-name"]=t;break;case"FOOTPRINT":n["attr-footprint-name"]=t;break;case"netflag":case"netlabel":n["attr-netLabel-name"]=t;break;case"pin":n["attr-pinpart-name"]=t;break;case"annotation":n["attr-text-text"]=t;break;case"TEXT":n["attr-pcbtext-text"]=t}break;case"width":switch(i){case"TRACK":n["attr-track-width"]=t;break;case"CIRCLE":n["attr-pcbcircle-width"]=t;break;case"ARC":n["attr-pcbarc-width"]=t}break;case"number":if("pin"===i){t=t.replace(/[^\x20-\x7E]+/g,"");n["attr-pinpart-number"]=t;n["attr-pinpart-spicepin"]=t}else if("PAD"===i){n["attr-pad-number"]=t;pa.nameObj[yi]=t}break;case"net":n["attr-via-net"]=t}if("origin"===i&&"object"==typeof e){var a={offsetX:e.x-_i.canvas.originX,offsetY:e.y-_i.canvas.originY};r("setOriginXY",[e]);pa.end();Kt();Ct("setTabUnsaved");xi.save(["originXY","set.origin",a])}else{En(pa.target,n,"NotSaveHistory","NotUpdateJsonCache");"TRACK"!==i&&"ARC"!==i||!pa.controlLine||En(pa.controlLine,n,"NotSaveHistory","NotUpdateJsonCache")}}},getPreOrNameNode:function(e,t){return Vt(e,t)},initVerifyAndMounted:function(e,t){return Xt(e,t)},getActiveElement:function(){return fi},componentFoundHighLight:function(e){ar(e)},updateSymbolCache:function(e,t){return Wt(e,t)},terminalWorker:function(){qi()},setOriginByCenter:function(e){var t,n,i={x:_i.canvas.originX,y:_i.canvas.originY},a={offsetX:0,offsetY:0},o=ji.fileType.getAbstractFileType(ya);if("pcblib"==o){var c,l,d,h,f=di.gJsonCache.PAD;if(f&&Object.keys(f).length>0){var u=Object.values(f)[0];c=l=u.x;d=h=u.y;for(var g in f){c=f[g].x>c?f[g].x:c;d=f[g].y>d?f[g].y:d;l=f[g].x<l?f[g].x:l;h=f[g].y<h?f[g].y:h}t=(c+l)/2;n=(d+h)/2;a={offsetX:t-i.x,offsetY:n-i.y};r("setOriginXY",[{x:t,y:n}]);Ct("setTabUnsaved");xi.save(["originXY","set.origin",a]);return}}else if("schlib"==o){for(var y=Jn.cloneNode(!0),v=s("text",y),x=0;x<v.length;x++)p(v[x]);var m=ji.svg.getBBox(y);if(0!==m.width||0!==m.height){t=m.x+m.width/2;n=m.y+m.height/2;var _=he({x:t-i.x,y:n-i.y});a={offsetX:_.x,offsetY:_.y};r("setOriginXY",[{x:_.x+i.x,y:_.y+i.y}]);Ct("setTabUnsaved");xi.save(["originXY","set.origin",a]);return}}if(("pcblib"==o||"schlib"==o)&&1==e){m=ji.svg.getBBox(Jn);t=m.x+m.width/2;n=m.y+m.height/2;a={offsetX:t-i.x,offsetY:n-i.y};r("setOriginXY",[{x:t,y:n}]);Ct("setTabUnsaved");xi.save(["originXY","set.origin",a])}},offsetElements:function(e,t){var r=Ar();ya!=ii.SCH&&ya!=ii.SCHLIB||bi.solveItems(r);Xe(r,e,t);di.updateMore(r);1===r.length?Nt(r[0]):wt();if(ya==ii.SCH||ya==ii.SCHLIB){bi.solveItems(r);bi.solveTodoList()}var n=r.map(function(r){return["move",r.id,e,t]});ya==ii.SCH||ya==ii.SCHLIB?xi.save(bi.batHistoryCmd(n)):xi.save(n)},toggleBottomTopLayer:function(e){var t=Ar(),r={ARC:"attr-pcbarc-layerid",CIRCLE:"attr-pcbcircle-layerid",COPPERAREA:"attr-copperArea-layerid",DIMENSION:"attr-dimension-layerid",FOOTPRINT:"attr-footprint-layerid",PAD:"attr-pad-layerid",PROTRACTOR:"attr-protractor-layerid",RECT:"attr-pcbrect-layerid",SOLIDREGION:"attr-solidRegion-layerid",SVGNODE:"attr-pcbsvgimage-layerid",TEXT:"attr-pcbtext-layerid",TRACK:"attr-track-layerid"};t=t.filter(function(e){return"FOOTPRINT"===ee(e)});if(t.length){t.forEach(function(t){var n=ee(t),i={};i[r[n]]=e;En(t,i)});di.updateMore(t);Ct("updateAttrPanel");return!1}return!0},set_fullscreen:function(){var t=e.parent.document.documentElement;(t.requestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen).call(t)},showDrawingAttrDlg:function(){Ct("show_drawing_attr_dlg",["origin","setToolbarCmd"])},moveRelatively:function(){moveRelatively.setRelativePoint()},highlight_net:function(){var e,t,r=ya==ii.PCB||ya==ii.PCBMODULE,n=ya==ii.SCH||ya==ii.SCHMODULE;if(fi){e=v(fi,"net");t=v(fi,"id")}else{var i=Ar();if(i&&i[0]){e=v(i[0],"net");t=v(i[0],"id")}}if(r&&(ratLineMgr.hasHighlightedNets("highlight-h")||ratLineMgr.hasHighlightedNets("selected-h"))){setUnselectedByClassName("selected-h");ratLineMgr.cancelHighlightNets(!0);if(ratLineMgr.lastHighlightNet===e)return}if(r&&e){highlightNet(e,{scroll:!1,fromHotKey:!0});ratLineMgr.lastHighlightNet=e}else if(n&&t){var a=o(t);"wire"===ee(a)&&Ct("schCreateNet",[a])}},setPartElements:function(e,t,r){for(var n=Ar(),i=n.length,a=yn("g"),o=-1;++o<i;)a.appendChild(n[o]);hi.appendChild(a);var c,l,d=a.getBBox(),h=_i.canvas,u={x:d.x+d.width/2,y:d.y+d.height/2};if(1===i){u.x=+v(n[0],"c_origin").split(",")[0];u.y=+v(n[0],"c_origin").split(",")[1]}if(ya===ii.PCB){l=t+h.originY-u.y;c=e+h.originX-u.x}else{c=e-u.x;l=t-u.y}Xe(n,c,l);var p={};if(ya!==ii.SCH)for(o=0,i=n.length;o<i;o++){var g=n[o];it(g);Layer.appendElement(g);f(g,"selected");var y=v(g,"c_etype");if("pinpart"==y){var x=g.querySelector("path[c_note=note_pre]");if(x){var m=v(x,"c_text")||"",_=li.getNewPre2(m,!0,!0,p);_!=m&&Bn(x.parentNode,{text:_});p[_]=1}}if("COPPERAREA"==ji.getPCBCmdKey(g)&&(ya==ii.PCBLIB||ya==ii.PCBMODULE||ya==ii.PCB)){var b,S=di.gJsonCache.COPPERAREA||{},C=[];for(var P in S)C.push(S[P].order);if(C.length){b=Math.max.apply(null,C);var w=v(g,"order")}else{b=0;w=0}v(g,"order",Number(b)+Number(w))}}else{if("sch"==ji.fileType.getAbstractFileType(ya)){var N=s("text[c_note=note_pre]",a);if(N.length){var A=[];for(o=0,i=N.length;o<i;o++)A[o]=F(N[o].textContent).toUpperCase();var k=li.getNewPreArr(A,!0);for(o=0,i=N.length;o<i;o++)k[o]&&k[o]!=A[o]&&ji.node.setTextContent(N[o],k[o])}}it(a);for(o=-1;++o<n.length;){f(n[o],"selected");Jn.appendChild(n[o])}}hi.removeChild(a);var O="";for(o=0;o<n.length;o++)O+=","+n[o].id;xi.save(["add",O]);dn()},rotatePartSvg:function(e,t){var r=e.id;Jn.appendChild(e);mr([e],t);return o(r)},updateBindId:function(){var e=[];if(ya==ii.SCH)e=s("g[bindPCBId]",Jn);else{if(ya!=ii.PCB)return;e=s("g[bindSCHId]",Jn)}e.forEach(function(e,t){v(e,ya==ii.SCH?"bindPCBId":"bindSCHId",te(t));di.updateOne(e,{noRebuildPlane:!0})})},updateSheetText:function(e,t){Dr(e,t)},setSheetSize:function(e,t){jr(e,t)},jsonMgr_updateOne:function(e){di.updateOne(e)},changeLogo:function(){var e=null;e="lceda"===wi?s('#part_frame_lib g[c_partid="part_image"] image[logotype="en"]')[0]:s('#part_frame_lib g[c_partid="part_image"] image[logotype="zh"]')[0];e&&e.remove()},getHoleLengthOfPad:function(){var e=Ar();if(e&&e[0]&&"PAD"===ee(e[0])){var t=e[0],r=+v(t.querySelectorAll(":not([c_padid]):not(title)")[1],"stroke-width"),n=I(v(t.querySelectorAll(":not([c_padid]):not(title)")[1],"points")),i=ji.formatLengthSave(oa.distancePointToPoint(n[0],n[1])+r),a=_i.canvas.unit;return{pixelVal:i,showVal:ji.formatLengthShow(ji.units.convert(i,"pixel",a))+a}}},modify_drawing_track_width:function(e){var n=pa,i=n.dots.length;if(!e&&!isNaN(parseFloat(e))||v(n.target,"stroke-width")==e)return!1;if(2===i)r.hooks.modify_drawing_attr.apply(null,["width",e]);else if(i>2&&"draw.track"===yi){_i.canvas.modifyLineWidth=!0;var a=n.dots[i-2],o=n.dots[i-1],s=n.moveEndX,c=n.moveEndY;n.next();var l=new MouseEvent("mouseup",{button:0});n.draw(a,o,!0,l);var d=new MouseEvent("mousemove",{clientX:s,clientY:c});t.dispatchEvent(d);n.draw(n.mockX,n.mockY,!1,d);isNaN(parseFloat(e))||ua.modify_canvas({"attr-pcbcanvas-routing-size":e||"1"});_i.canvas.modifyLineWidth=!1;return!0}},getPinStrFromModule:function(e){var t,r,n,i,a="",c=s('g[c_partid="part_pin"]',o("g1")).toArray(),l=0,d=c.length,h={},f=[],u=1;for(l=0;l<d;l++){t=s("text[text-anchor]",c[l]);if(t.length<1)break;if(v(t[0],"c_pinname")){n=t[0].textContent||"";r=t[1].textContent||""}else{n=t[1].textContent||"";r=t[0].textContent||""}r=r.replace(/[\s|,]/g,"");n=n.replace(/[\s|,]/g,"");if(void 0!==h[r]){i=r;for(;void 0!==h[r]||100===u;){r=i+"_"+u;u++}u=1}h[r]=n;f.push(r)}f.sort(function(e,t){return parseInt(e)-parseInt(t)});for(l=0;l<f.length;l++){r=f[l];n=h[r];a+=r+", "+n+"\n"}return a},createSchlibPackageText:function(e){mn(e,arguments[1])},rebuildPlane:function(e){copperAreaMgr.rebuildPlane(e)},getShapeLength:function(){return o("g1").childNodes.filter(function(e){return e.id&&!e.id.match(/^layer_[^_]+_(begin|end)/)}).length},buildSignals:function(){di.buildSignals()},releaseActive:function(e){return rr(e)},"jsonMgr.calAll":function(){di.calAll()}});e.addEventListener("error",ji.reportError,!1);Ct("triggerEvent",["history_change",0,-1,!0]);Zr()}();r.registerHook({getSVG:function(e){var t=_i.canvas.bgcolor,n=r("getBBox"),i=e||50,a=n.x-i|0,o=n.y-i|0,s=0|Math.max(n.width+2*i,100),c=0|Math.max(n.height+2*i,100);return'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+s+'" height="'+c+'" viewBox="'+a+" "+o+" "+s+" "+c+'"><title>'+X(Ct("getTitle"))+'</title><style type="text/css">\npath, polyline, polygon {stroke-linejoin:round;}\npath, polyline, polygon, line {stroke-linecap:round;}\n</style>\n<rect x="'+a+'" y="'+o+'" width="'+s+'" height="'+c+'" fill="'+t+'" stroke="none"/>'+function(){if("undefined"!=typeof XMLSerializer){var e=(new XMLSerializer).serializeToString(Jn);e.search(/[^\x00-\x7f]/)>=0&&(e=e.replace(/[^\x00-\x7f]/g,function(e){return"&#"+e.charCodeAt(0)+";"}));e=e.replace(/<circle [^>]*c_pindot="true"[^>]*(?:\/>|><\/circle>)/g,"").replace(/<rect [^>]*class="hitbox"[^>]*(?:\/>|><\/rect>)/g,"").replace(/<g(\s[^>]*)?\/>/g,"").replace(/ xmlns="http:\/\/www\.w3\.org\/2000\/svg"/g,"").replace(/ xmlns:xlink="http:\/\/www\.w3\.org\/1999\/xlink"/g,"");for(var t=["id","class","title","net","number","c_\\w+"],r=0;r<t.length;r++)for(var n=new RegExp("(<\\w+[^>]*)\\s"+t[r]+'=\\"[^\\"]*\\"',"g");n.test(e);)e=e.replace(n,"$1");e=e.replace(/<g\s*>\s*<\/g>/g,"");e=e.replace(/( xlink:href=")(\/\/)/g,"$1"+location.protocol+"$2");e=e.replace(/( xlink:href=")(\/[^\/"][^"]*)/g,"$1"+location.protocol+"//"+location.host+"$2");return e}return"gCanvasToXML error! "}()+"</svg>"},updateJsonCache:function(e){if(e)"all"===e?di.calAll():di.gJsonCache=e;else{var t=Ar();di.updateMore(t)}},updateLibCanvasAttr:function(e){v(o("g1"),"c_para",e)},gJsonCache:function(e){if(e&&(e.id||e.gId)){var t=o(e.id||e.gId);if(!t)return;var n=e.cmdKey||ee(t),i=di.gJsonCache[n],a=i&&i[e.id];return a?A(a):null}di.gJsonCache.head.docType=ya;di.gJsonCache.head.c_para=v(Jn,"c_para");di.gJsonCache.head.c_spiceCmd=v(Jn,"c_spiceCmd");di.gJsonCache.BBox=r("getBBox");di.gJsonCache.canvas=An();di.gJsonCache.itemOrder=O();di.gJsonCache.colors=_i.colors;if(function(){var e=di.gJsonCache.wire||{},t=!0;for(var r in e)if(w(e,r)){if(!e[r].strokeColor){t=!1;var n=o(r);if(n&&v(n,"stroke")){di.calAll();e=di.gJsonCache.wire;e&&e[r]&&e[r].strokeColor&&(t=!0)}break}break}return t}())return A(di.gJsonCache)},highlightItems:function(e,t){At(e,t)},crossProbe:function(e){var t=e.selectObjPrefixs,r=e.selectedObjWireNetNodes,n=e.selectObjPadNets;if(t&&t.length>0||r&&0!==Object.keys(r).length||n&&0!==Object.keys(n).length){rr();for(var i,a=[],c=[],d=0;d<t.length;d++){var h=t[d].pre;h=h.toUpperCase();for(var f,u=s("#g1>g>g text[c_note]",Jn),p=0;p<u.length;p++){f=u[p].textContent;f=F(f||"").toUpperCase();if(f==h){i=u[p].parentNode.parentNode;c.push(i);break}if(f.split(".")[0]==h&&a.indexOf(f)<0){t.push({pre:f});a.push(f)}}i&&l(i,"selected",!0)}for(var g in r){var y=r[g];for(p=0;p<y.length;p++){var v=y[p].gId;if(v){i=o(v,Jn);if(i){l(i,"selected",!0);c.push(i)}}}}for(h in n){var x=di.gJsonCache.schlib;h=h.toUpperCase();for(var m in x){var _=x[m],b=_?_.annotation:"";if(b)for(var S in b)if(w(b,S)){var C=b[S];if("P"==C.mark&&(C.string==h||C.string.split(".")[0]==h)){var P=_.pin;for(var N in P)if(w(P,N)&&P[N].num&&P[N].num.text==n[h]){At({pin:{gId:N}});c.push(o(N))}}}}}if(1==c.length)Ke(i);else if(c.length>1){var A=c.map(function(e){return ji.svg.getBBox(e)}),k=ji.combineMultiBox(A);k&&qe(k)}Ct("triggerEvent",["select_change"])}},globalDelete:function(e){var t,r=[];e.deleteComponents&&(t=di.gJsonCache.schlib)&&(r=r.concat(Object.keys(t).map(function(e){return o(e)}).filter(function(e){return"part_import_frame_lib"!=v(e,"c_partid")})));e.deleteTexts&&(t=di.gJsonCache.annotation)&&(r=r.concat(Object.keys(t).map(function(e){return o(e)})));if(e.deleteWires){t=di.gJsonCache.wire;t&&(r=r.concat(Object.keys(t).map(function(e){return o(e)})));t=di.gJsonCache.bus;t&&(r=r.concat(Object.keys(t).map(function(e){return o(e)})));t=di.gJsonCache.busentry;t&&(r=r.concat(Object.keys(t).map(function(e){return o(e)})));t=di.gJsonCache.noconnectflag;t&&(r=r.concat(Object.keys(t).map(function(e){return o(e)})))}if(e.deleteNetlabelAndnetFlag){var n=di.gJsonCache.netflag,i=di.gJsonCache.netlabel;n&&(r=r.concat(Object.keys(n).map(function(e){return o(e)})));i&&(r=r.concat(Object.keys(i).map(function(e){return o(e)})))}if(e.deleteDrawings){var a=di.gJsonCache.arc,s=di.gJsonCache.arrowhead,c=di.gJsonCache.ellipse,l=di.gJsonCache.image,d=di.gJsonCache.path,h=di.gJsonCache.polygon,f=di.gJsonCache.polyline,u=di.gJsonCache.rect,p=di.gJsonCache.pin,g=di.gJsonCache.schlib;a&&(r=r.concat(Object.keys(a).map(function(e){return o(e)})));g&&(r=r.concat(Object.keys(g).filter(function(e){return e.match(/frame_lib_/)}).map(function(e){return o(e)})));s&&(r=r.concat(Object.keys(s).map(function(e){return o(e)})));c&&(r=r.concat(Object.keys(c).map(function(e){return o(e)})));l&&(r=r.concat(Object.keys(l).map(function(e){return o(e)})));d&&(r=r.concat(Object.keys(d).map(function(e){return o(e)})));h&&(r=r.concat(Object.keys(h).map(function(e){return o(e)})));f&&(r=r.concat(Object.keys(f).map(function(e){return o(e)})));u&&(r=r.concat(Object.keys(u).map(function(e){return o(e)})));p&&(r=r.concat(Object.keys(p).map(function(e){return o(e)})))}r.length&&dr(r)},getSelectPrefixNamesAndNetNames:function(){var e=Ar(),t=di.gJsonCache.schlib||{},r=di.gJsonCache.wire||{},n={prefixNames:[],wireNetNames:[]};if(t||r)for(var i=0;i<e.length;i++){var a=e[i].id;if(t[a]){var o=t[a],s=o.annotation;for(var c in s)if(w(s,c)){var l=s[c];"P"==l.mark&&n.prefixNames.push({pre:l.string.split(".")[0],rotation:o.head.rotation,x:o.head.x,y:o.head.y})}}else if(r[a]){o=r[a];var d=o.pointArr&&Ct("getWireNetName",[o.pointArr[0]]);d&&-1==n.wireNetNames.indexOf(d)&&n.wireNetNames.push(d)}}return n},isPrefixDuplicated:function(e){var t,r=Ar();r&&r[0]&&(t=Vt("pre",r[0]));return!(!t||!t.childNodes[0])&&(e.indexOf("?")<0&&li.isUsed(e,{except:t.id}))},delete:function(){if(pa.started&&pa.canBackStep())pa.backStep();else if(!nn()){var e,t,r,n=arguments[0],i=arguments[1];if(!i){Ct("delete",[n,!0]);return}if("object"==typeof n){if(n.ids){e=n.ids;if(!Array.isArray(e))return;t=e.map(function(e){return o(e)})
}else n.target&&(t=n.target);n.force&&(r=n.force);t=t.filter(function(e){var t=v(e.firstChild,"c_note"),r="schlib"===ee(e.parentNode)&&("note_name"===t||"note_pre"===t||"note_package"===t);return e&&(e.parentNode==Jn||r)});t.length&&dr(t,r)}else dr()}},undoDraw:function(){pa.started&&pa.canBackStep()&&pa.backStep()},getPinNextText:function(){if(pa.target)return{name:c("text[c_pinname]",pa.target).textContent,number:c("text[c_pinnumber]",pa.target).textContent}},rotate:function(){var e=Oi&&Oi.start,t=e;if(!nn()||e){var r,n,i,a,s,c=arguments[0];if("number"==typeof c)n=c;else if("string"==typeof c)isNaN(+c)||(n=+c);else if("object"==typeof c&&c.ids){a=c.ids;n=c.degree;if(!Array.isArray(a))return}void 0===n&&(n=270);if(a){r=a.map(function(e){return o(e)});r=r.filter(function(e){return e&&e.parentNode==Jn});if(r.length){s=new Ln(r);_r(r,n);s.update();!t&&xi.save(bi.batHistoryCmd(s.hist));Ct("updateAttrPanel")}}else if("draw.image"==yi&&pa.target)Ee(pa.target,n);else if(vi&&yi&&0===yi.indexOf("place.part_")){var d=yi.substr(6),h=o(d);pa.target&&mr([pa.target],n);h&&mr([h],n)}else{if(!zi.pasting){if(fi){var f=fi,u=ee(f);if("annotation"==u&&f.parentNode!=Jn){if(aa.isLocked(nr(f)))return;l(f,"active",!1);_r([f],n);!t&&xi.save(["rotate",f.id,n]);l(f,"active",!0);if(!e){var p=Mn(f);Ct("noneselected");Ct("show_attrpanel",[p])}return}}r=Ar().filter(function(e){return!aa.isLocked(e)});if(r.length){if(t)_r(r,n);else{s=new Ln(r);_r(r,n);s.update();xi.save(bi.batHistoryCmd(s.hist))}Ct("updateAttrPanel");return!0}return!1}r=zi.targets;if(r.length>1){i=ji.svg.getElementsCenter(r,!0);i=he(i);for(var g=0,y=r.length;g<y;g++){ji.svg.fixOrigin(r[g]);ta.rotate(r[g],n,i.x,i.y)}}else{ta.rotate(r[0],n);ji.svg.fixOrigin(r[0])}}}},visible_grid:function(){var e=v(o("grid1"),"display");e="none"==e?"":"none";v(o("grid1"),{display:e});_i.adsorbGrid.visible=!e},snap_grid:function(){_i.adsorbGrid.enabled=!_i.adsorbGrid.enabled},setOriginXY:function(e){e.x=isFinite(e.x)&&null!==e.x?+e.x:_i.canvas.originX;e.y=isFinite(e.y)&&null!==e.y?+e.y:_i.canvas.originY;e.x=Math.round(e.x);e.y=Math.round(e.y);_i.canvas.originX=e.x;_i.canvas.originY=e.y;var t=.5/Wi,r=ji.toFixed(1/Wi+1e-5,5);v(o("gridOH"),{y1:e.y+t,y2:e.y+t});v(o("gridOV"),{x1:e.x+t,x2:e.x+t});v(o("gridPattern"),{x:e.x,y:e.y});v(o("gridPattern2"),{x:e.x+r,y:e.y+r});gt()}});r.registerHook({HasSimualtionAnalyse:function(){for(var e=["AC","dc","DISTO","NOISE","op","pz","SENS","TF","TRAN","PSS"],t=0,r=0;r<e.length;r++)Jr(e[r])&&t++;return t},getPinMapInfo:function(){return Br.apply(null,arguments)},getSheetInfo:function(){return Fr()},getSymbolInfo:function(){return Vr()},hasGround:function(){for(var e=s("g[c_partid^=part_netLabel_]",Jn),t=e.length,r=!1,n=0;n<t;n++){var i=v(e[n],"c_partid")||"";if(/part_netLabel_gnd/i.test(i)){r=!0;break}if("part_netLabel_text"==i&&2==e[n].childNodes.length&&/gnd/i.test(e[n].childNodes[1].textContent))return!0}r||(r=Jr("gnd"));return r},hasProbe:function(){return!!(Yr().length||Wr()||Jr("probe"))},modifyName:function(e){var t=v(Jn,"c_para")||"`name``";t=t.replace("`name``","`name`"+e+"`");v(Jn,"c_para",t)},getNetLabelOfPlacingElement:function(){return pa.target.children[1].textContent||""},setSheetInfo:function(e){return Rr(e)},annotion:function(e){return li.annotion(e)},getSchThemeConfig:function(){return e.schTheme?ji.extend({},schTheme):null},initSchTheme:function(){return Rn()},storeImageData:function(e){ci=e},isSubPart:function(e){return Qr(e)}});e.addEventListener("load",function(){var n=q();l(hi,"bw-"+n,!0);Pi.decimalPlaces=Pi.schDecimalPlaces;Pi.decimalPlacesShow=Pi.schDecimalPlacesShow;Pi.fixedDecimal=!1;ya==ii.WAVEFORM?e.addEventListener("resize",Ci.resizeToFitWindow,!1):e.addEventListener("resize",function(){var e=t.documentElement.clientWidth||9,r=t.documentElement.clientHeight||9,n=ua.getViewBox(),i=[n[0]+.5*n[2]-.5*e/Wi,n[1]+.5*n[3]-.5*r/Wi,e/Wi,r/Wi];v(hi,{width:e,height:r});ua.setViewBox(i)},!1);!function(){var e=t.documentElement.clientWidth||9,r=t.documentElement.clientHeight||9,n=_i.canvas.originX,i=_i.canvas.originY;if(ji.fileType.isLib(ya)){n-=e/Wi/2;i-=r/Wi/2}v(hi,{width:e,height:r,viewBox:[n,i,e/Wi,r/Wi].join(" ")})}();t.addEventListener("mouseover",Qt,!1);t.addEventListener("mouseout",Qt,!1);t.addEventListener("mousedown",Qt,!1);t.addEventListener("mouseup",Qt,!1);t.addEventListener("click",function(e){var t=e.altKey;-function(e){e&&r("highlight_net")}(t)},!1);t.addEventListener("contextmenu",mt,!1);if(ya==ii.WAVEFORM)t.addEventListener("dblclick",Ci.restoreCanvas,!1);else{t.addEventListener(!Fi||"onwheel"in t?"wheel":"MozMousePixelScroll",_t,{passive:!1});t.addEventListener("mousemove",yt,!1);t.addEventListener("scroll",gt,!1)}t.addEventListener("mousemove",Ht,!1);t.addEventListener("mouseup",Ht,!1);t.addEventListener("mouseout",function(){Ht.data.uplock=!0},!1);t.addEventListener("drop",function(e){Ct("editor_drop",[e]);e.preventDefault()},!1);kt();pt(hi);an();gn();ya!=ii.WAVEFORM&&Ai();In();ut();Ke(Jn);gt();Ct("showDocTip");wr();Ct("buildVersionCheck",[Pi.version+","+Pi.buildDate]);e.loaded=!0;Ct("triggerEvent",["select_change"]);Ct("triggerEvent",["editor_load"]);Rn()},!1);!function(){function e(e){if(""!==yi)return!1;var r=e.target,i=r.tagName,a=o("textInputBox");if(!a){a=t.createElement("textarea");t.body.appendChild(a);a.id="textInputBox";a.className="textInputBox";a.style.width="200px";a.style.height="100px";v(a,"min-ofw",a.offsetWidth);v(a,"min-ofh",a.offsetHeight);a.addEventListener("change",function(e){var t=n,r=this.value,a="tspan"==i?t.parentNode:t,o=a.parentNode==Jn?a:a.parentNode,s=o.cloneNode(!0);Bn("part_pin"===v(o,"c_partid")?t:o,r,function(){var e=o.cloneNode(!0);di.updateOne(o);xi.save(["node",o.id,s,e])});Ct("addUserBehaviorRecord",["text-edit-submit",{text:r}])},!1);a.addEventListener("blur",function(e){this.style.display="none"},!1);a.addEventListener("keydown",function(e){32==e.keyCode&&e.stopPropagation();if(27==e.keyCode){e.stopPropagation();this.value=this.oldValue;this.style.display="none"}},!1);void 0!==a.style.resize||function(e){function r(r){if(r.button===ei){l&&i();if(r.offsetX>e.offsetWidth-16&&r.offsetY>e.offsetHeight-16){r.preventDefault();e.style.cursor="nwse-resize";t.addEventListener("mousemove",n,!1);t.addEventListener("mouseup",i,!1);l=!0;a=r.pageX;o=r.pageY;s=parseInt(e.style.width,10);c=parseInt(e.style.height,10)}}}function n(t){var r=s+t.pageX-a,n=c+t.pageY-o;e.style.width=Math.min(Math.max(r,100),1200)+"px";e.style.height=Math.min(Math.max(n,100),1e3)+"px"}function i(r){if(l){e.style.cursor="";t.removeEventListener("mousemove",n,!1);t.removeEventListener("mouseup",i,!1);l=!1}}var a=0,o=0,s=0,c=0,l=!1;e.addEventListener("mousedown",r,!1);e.addEventListener("blur",i,!1)}(a)}var s=e.pageX,c=e.pageY;a.style.display="";a.style.top=Math.max(c-5,5)+"px";a.style.left=Math.max(s-5,5)+"px";"tspan"==i&&(r=r.parentNode);var l=We(r);a.value=F(l);a.oldValue=l;a.select();a.focus();n=r;Ct("addUserBehaviorRecord",["text-edit-dbclick",{text:l}]);!function(e){for(var t=e.value.replace(/[^\x00-\xff]/g,"**").split(/\r\n|\r|\n/),r=t.length,n=0,i=0;i<t.length;i++)n=Math.max(t[i].length,n);v(a,"rows",r);v(a,"cols",n);a.style.width="";a.style.height="";a.style.width=200+Math.max(0,a.offsetWidth-v(a,"min-ofw"))+"px";a.style.height=100+Math.max(0,a.offsetHeight-v(a,"min-ofh"))+"px"}(a)}function r(e){if(""===yi){var t=e.target;e.ctrlKey||e.altKey||e.shiftKey||Ir(t)}}var n;t.addEventListener("dblclick",function(t){var n=t.target,i=n.tagName;n.parentNode==la?r(t):"text"!==i&&"tspan"!==i||"note_mounted"!==v(n,"c_note")&&"note_package"!==v(n,"c_note")&&n.parentNode&&0!=n.parentNode.id.indexOf("frame_tick_")&&e(t)},!1)}();Si.bestFormatString=function(e){var t;e=Math.abs(e);if(e>=10)t="%d";else if(e>1)t=e===parseInt(e,10)?"%d":"%.1f";else{var r=-Math.floor(Math.log(e)/Math.LN10);t="%."+r+"f"}return t};Si.bestInterval=function(e,t){t=t||7;var r,n=e/(t-1),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;r=i<1?a>5?10*i:a>2?5*i:a>1?2*i:i:a>5?10*i:a>4?5*i:a>3?4*i:a>2?3*i:a>1?2*i:i;return r};Si.bestLinearInterval=function(e,t){t=t||1;var r,n=Math.floor(Math.log(e)/Math.LN10),i=Math.pow(10,n),a=e/i;a/=t;r=a<=.38?.1:a<=1.6?.2:a<=4?.5:a<=8?1:a<=16?2:5;return r*i};Si.LinearTickGenerator=function(e,t,r,n){e===t&&(t=t?0:1);r=r||1;if(t<e){var i=t;t=e;e=i}var a=[],o=Si.bestLinearInterval(t-e,r);Si.getSignificantFigures;if(null===n){a[0]=Math.floor(e/o)*o;a[1]=Math.ceil(t/o)*o;a[2]=Math.round((a[1]-a[0])/o+1);a[3]=Si.bestFormatString(o);a[4]=o}else{var s=[];s[0]=Math.floor(e/o)*o;s[1]=Math.ceil(t/o)*o;s[2]=Math.round((s[1]-s[0])/o+1);s[3]=Si.bestFormatString(o);s[4]=o;if(s[2]===n)a=s;else{var c=Si.bestInterval(s[1]-s[0],n);a[0]=s[0];a[2]=n;a[4]=c;a[3]=Si.bestFormatString(c);a[1]=a[0]+(a[2]-1)*a[4]}}return a};Si.createTicks=function(e,t,r,n,i,a){var o="x"==i?e:t;this._scalefact=(Math.max(o,31)-30)/600;var s=a;"y2"==i&&(s=a);var c=n-r,l=Si.LinearTickGenerator(r,n,this._scalefact,s,!1,!1);l[2];this.padMin=1.01;this.padMax=1.01;var d=null!==this.min&&void 0!==this.min?r:r+c*(this.padMin-1),h=null!==this.max&&void 0!==this.max?n:n-c*(this.padMax-1);if(r<d||n>h){d=null!==this.min&&void 0!==this.min?r:r-c*(this.padMin-1);h=null!==this.max&&void 0!==this.max?n:n+c*(this.padMax-1);l=Si.LinearTickGenerator(d,h,this._scalefact,s,!1,!1)}return{min:l[0],max:l[1],numberTicks:l[2],autoFormatString:l[3],tickInterval:l[4]}};Ci.ini=function(){Ci._gWaveForm=o("g1");var e=t.documentElement.clientWidth,r=t.documentElement.clientHeight;Hi._width=Math.max(e,600);Hi._height=Math.max(r,400);Ci._width=Hi._width;Ci._height=Hi._height;Hi._xaxis.plotData=Hi._xaxis.data.slice(0);for(var n in Hi.series)w(Hi.series,n)&&(Hi.series[n].plotData=Hi.series[n].data.slice(0))};Ci.rebuild=function(){di.removeAll();Ci._clean();Ci._resetCanvas();Ci._createBackground();Ci._iniMessageBar();Ci._createPanes()};Ci.resizeToFitWindow=function(){Ci.ini();Ci.rebuild()};Ci._iniMessageBar=function(){var e=o("gMessageBar");e.style.backgroundColor=Hi._paneBackground;e.style.color=Hi._gridSetting.gridColor};Ci._clean=function(){for(var e=Ci._gWaveForm.childNodes,t=e.length-1;t>=0;t--)e[t]&&Ci._gWaveForm.removeChild(e[t])};Ci._resetCanvas=function(){v(hi,{width:Ci._width,height:Ci._height,viewBox:"0 0 "+Ci._width+" "+Ci._height})};Ci._createBackground=function(){var e=yn("rect",{x:0,y:0,width:Ci._width,height:Ci._height,stroke:Hi._paneBackground,"stroke-width":"1",id:ji.newId(),fill:Hi._paneBackground});Ci._addGrapItem(e)};Ci._addGrapItem=function(e){Ci._gWaveForm.appendChild(e);di.updateOne(e)};Ci._createPanes=function(){Ci._setXAxis();var e=Hi.panes.length;if(e){Ci._paneHeight=(Ci._height-Ci._messageBarHeight)/e;for(var t,r=0;r<e;r++){Ci.isZoomViaSelectBox||Ci._setYAxes(r);t=Ci._messageBarHeight+r*Ci._paneHeight;Hi.panes[r].topLeftY=t;Ci._createLegend(t,r);Ci._createGrid(t,r);Ci._createWave(t,r)}}};Ci._getGridWidth=function(){return Ci._width-Ci._paneLeftPadding-Ci._paneRightPadding};Ci._getGridHeight=function(){return Ci._paneHeight-Ci._paneTopPadding-Ci._paneBottonPadding};Ci._createLegend=function(e,t){var r=e+Ci._paneTopPadding-10,n=Hi.panes[t].serieNames,i=Ci._width/n.length,a=20-i;n.forEach(function(e){a+=i;var t=Hi.series[e],n=Ci._createAnnotationNode({x:a,y:r-10,stroke:"none","text-anchor":"start",fill:t.color,"font-size":"12pt"},e);Ci._addGrapItem(n)})};Ci._createGrid=function(e,t){var r=Hi.panes[t],n=Ci._paneLeftPadding,i=e+Ci._paneTopPadding,a=Ci._width-Ci._paneRightPadding,o=Ci._getGridWidth(),s=Ci._getGridHeight(),c=Ci._getGridBBox(t),l=yn("rect",{x:c.x,y:c.y,width:c.width,height:c.height,id:ji.newId(),stroke:Hi._gridSetting.gridColor,"stroke-width":"1",fill:Hi._gridSetting.gridBackground});Ci._addGrapItem(l);var d=0,h={},f={},u=null;if(Hi._xaxis.isDecade){var p=Math.floor(Hi._xaxis.dataMin),g=Math.ceil(Hi._xaxis.dataMax);g=Math.min(10,g);g=Math.max(1,g);u={min:p,max:g,numberTicks:g-p+1,tickInterval:1}}else u=Si.createTicks(o,s,Hi._xaxis.dataMin,Hi._xaxis.dataMax,"x",null);Hi._xaxis.max=u.max;Hi._xaxis.min=u.min;Hi._xaxis.numberTicks=u.numberTicks;var y=o/(u.numberTicks-1),v="";for(d=0;d<Hi._xaxis.numberTicks;d++){v=Ci._friendSuffix(u.min+d*u.tickInterval,Hi._xaxis.isDecade,Hi._xaxis.unit);h.x=n+d*y;f.x=n+d*y;h.y=i;f.y=i+s;if(0!==d){var x=yn("polyline",{points:[h.x,h.y,f.x,f.y].join(" "),stroke:Hi._gridSetting.gridColor,"stroke-width":1,"stroke-dasharray":"2,8",fill:"none",id:ji.newId(),class:"px1"});Ci._addGrapItem(x)}var m=Ci._createAnnotationNode({x:f.x,y:f.y+17,stroke:"none","text-anchor":"middle",fill:Hi._gridSetting.gridColor,"font-size":"12pt"},v);Ci._addGrapItem(m)}u=Si.createTicks(o,s,r.y1.dataMin,r.y1.dataMax,"y1",null);r.y1.max=u.max;r.y1.min=u.min;r.y1.numberTicks=u.numberTicks;var _=s/(u.numberTicks-1);for(d=0;d<r.y1.numberTicks;d++){v=Ci._friendSuffix(u.max-d*u.tickInterval,!1,r.y1.unit);h.x=n;f.x=n+o;h.y=i+d*_;f.y=i+d*_;if(0!==d){var b=yn("polyline",{points:[h.x,h.y,f.x,f.y].join(" "),stroke:Hi._gridSetting.gridColor,"stroke-width":1,"stroke-dasharray":"2,8",fill:"none",id:ji.newId(),class:"px1"});Ci._addGrapItem(b)}var S=Ci._createAnnotationNode({x:h.x-5,y:h.y,stroke:"none","text-anchor":"end",fill:Hi._gridSetting.gridColor,"font-size":"12pt"},v);Ci._addGrapItem(S)}if(r.isDoubleYaxes){u=Si.createTicks(o,s,r.y2.dataMin,r.y2.dataMax,"y2",u.numberTicks);r.y2.max=u.max;r.y2.min=u.min;r.y2.numberTicks=u.numberTicks;_=s/(u.numberTicks-1);for(d=0;d<r.y2.numberTicks;d++){v=Ci._friendSuffix(u.max-d*u.tickInterval,!1,r.y2.unit);h.x=a+10;h.y=i+d*_;S=Ci._createAnnotationNode({x:h.x,y:h.y,stroke:"none","text-anchor":"start",fill:Hi._gridSetting.gridColor,"font-size":"12pt"},v);Ci._addGrapItem(S)}}};Ci._getGridBBox=function(e){var t=Ci._messageBarHeight+e*Ci._paneHeight;return{x:Ci._paneLeftPadding,y:t+Ci._paneTopPadding,width:Ci._getGridWidth(),height:Ci._getGridHeight()}};Ci._createWave=function(e,t){var r=Hi.panes[t].serieNames,n=Hi._xaxis.plotData,i=Ci._paneLeftPadding,a=e+Ci._paneTopPadding,o=Ci._getGridWidth(),s=Ci._getGridHeight(),c=o/(Hi._xaxis.max-Hi._xaxis.min);r.forEach(function(e){for(var r=[],o=Hi.series[e],l=o.plotData,d=s/(Hi.panes[t][o.yaxisIndex].max-Hi.panes[t][o.yaxisIndex].min),h=0,f=l.length;h<f;h++){var u=i+(n[h]-Hi._xaxis.min)*c,p=a+s-(l[h]-Hi.panes[t][o.yaxisIndex].min)*d;r.push(ji.toFixed(u,8));r.push(ji.toFixed(p,8))}var g={points:r.join(" "),stroke:o.color,"stroke-width":1,fill:"none",id:ji.newId(),class:"px1"};"dash"==o.style&&(g["stroke-dasharray"]="1,3");var y=yn("polyline",g);Ci._addGrapItem(y)})};Ci._getRang=function(e,t){var r=-1/0,n=1/0;if("x"==e){r=Math.max.apply(Math,Hi._xaxis.plotData);n=Math.min.apply(Math,Hi._xaxis.plotData)}else{Hi.panes[t].serieNames.forEach(function(t){if(Hi.series[t].yaxisIndex==e){var i=Math.max.apply(Math,Hi.series[t].plotData);r=Math.max(i,r);var a=Math.min.apply(Math,Hi.series[t].plotData);n=Math.min(a,n)}})}return{min:n,max:r}};Ci._setYAxes=function(e){var t=Hi.panes[e].serieNames,r=Ci._iniYAxis(t),n=Ci._getRang("y1",e),i={unit:r[0],dataMin:n.min,dataMax:n.max};Hi.panes[e].y1=i;if(r[1]){n=Ci._getRang("y2",e);i={unit:r[1],dataMin:n.min,dataMax:n.max};Hi.panes[e].y2=i;Hi.panes[e].isDoubleYaxes=!0}};Ci._iniYAxis=function(e){var t,r=null;t=Hi.series[e[0]].unit;for(var n=0;n<e.length;n++){Hi.series[e[n]].yaxisIndex="y1";t!=Hi.series[e[n]].unit&&(r=r||Hi.series[e[n]].unit)}if(r)for(n=0;n<e.length;n++){var i=Hi.series[e[n]].type,a=Hi.series[e[n]].unit;if("current"==i||"phase"==i||"notype"==i){Hi.series[e[n]].yaxisIndex="y2";if(a==t){var o=t;t=r;r=o}}}return[t,r]};Ci._setXAxis=function(){var e=Ci._getRang("x");Hi._xaxis.dataMin=e.min;Hi._xaxis.dataMax=e.max};Ci._friendSuffix=function(e,t,r){var n=0,i="",a=e<0;e=Math.abs(e);if(t){e=Math.pow(10,e);if(a){e=1/e;a=!1}}for(var o=[[1e12,"T"],[1e9,"G"],[1e6,"M"],[1e3,"K"],[1,""],[.001,"m"],[1e-6,"u"],[1e-9,"n"],[1e-12,"p"]],s=0,c=o.length;s<c&&0!==e;s++)if(e>=o[s][0]){n=e/o[s][0];i=o[s][1];break}return(a?"-":"")+ji.toFixed(n,3)+i+r};Ci.zoomViaSelectBox=function(e){Ci.isDrawingSelectBox=!1;!0===Ci.computePlotDataViaSelectBox(e)&&Ci.rebuild()};Ci.computePlotDataViaSelectBox=function(e){var t=Hi.panes.length||1;if(!Hi._xaxis.plotData){Ci.ini();return!1}var r=Hi._xaxis.plotData.slice(0),n=Ci._paneLeftPadding,i=Ci._getGridWidth(),a=(Ci._getGridHeight(),0);if(null===Ci._getPaneIndexViaSelectBox(e))return!1;var o=i/(Hi._xaxis.max-Hi._xaxis.min),s=0,c=r.length;for(a=1;a<r.length;a++){var l=n+(r[a]-Hi._xaxis.min)*o;!s&&l>=e.x&&(s=a);if(s&&l>=e.x+e.width){c=a;break}}if(c-s<3)return!1;Hi._xaxis.plotData=[];for(a=s;a<c;a++)Hi._xaxis.plotData.push(r[a]);for(var d=0;d<t;d++){Hi.panes[d].serieNames.forEach(function(e){var t=Hi.series[e],r=t.plotData.slice(0);t.plotData=[];for(a=s;a<c;a++)t.plotData.push(r[a])})}return!0};Ci._getPaneIndexViaSelectBox=function(e){var t=(Ci._paneLeftPadding,Ci._getGridWidth(),Ci._getGridHeight(),0),r=0,n=null;for(t=0,r=Hi.panes.length;t<r;t++){var i=Ci._getGridBBox(t);if(ji.isRectTouchRect(i,e)){n=t;break}}return n};Ci._getPaneIndexViaPoint=function(e){var t=(Ci._paneLeftPadding,Ci._getGridWidth(),Ci._getGridHeight(),0),r=0,n=null;if(!Hi.panes)return null;for(t=0,r=Hi.panes.length;t<r;t++){var i=Ci._getGridBBox(t);if(ji.isDotInRect(e.x,e.y,i)){n=t;break}}return n};Ci.updateMessageBarInfo=function(e){function t(e){o("gMessageBar").innerHTML=e}if("object"==typeof e){var r=Ci._paneLeftPadding,n=Ci._getGridWidth(),i=Ci._getGridHeight(),a=null;if(Ci.isDrawingSelectBox&&e.width)a=Ci._getPaneIndexViaSelectBox(e);else{if(Ci.isDrawingSelectBox||e.width)return;a=Ci._getPaneIndexViaPoint(e)}if(null!==a){var s=Ci._messageBarHeight+a*Ci._paneHeight+Ci._paneTopPadding,c="";if(Ci.isDrawingSelectBox){var l=r+n,d=s+i,h=e.x>r?e.x:r,f=e.x+e.width>l?l:e.x+e.width,u=e.y<s?s:e.y,p=e.y+e.height>d?d:e.y+e.height,g=f-h,y=p-u,v=0,x="";v=Hi._xaxis.isDecade?Math.pow(10,(Hi._xaxis.max-Hi._xaxis.min)/n*(f-r)+Hi._xaxis.min)-Math.pow(10,(Hi._xaxis.max-Hi._xaxis.min)/n*(u-r)+Hi._xaxis.min):(Hi._xaxis.max-Hi._xaxis.min)/n*g;x=Ci._friendSuffix(v,!1,Hi._xaxis.unit);var m=(Hi.panes[a].y1.max-Hi.panes[a].y1.min)/i*y,_=Hi.panes[a].isDoubleYaxes?(Hi.panes[a].y2.max-Hi.panes[a].y2.min)/i*y:"";c="dx = "+x+("S"==Hi._xaxis.unit?"("+Ci._friendSuffix(1/v,!1,"Hz")+") ":"")+" dy = "+Ci._friendSuffix(m,!1,Hi.panes[a].y1.unit);c+=Hi.panes[a].isDoubleYaxes?", "+Ci._friendSuffix(_,!1,Hi.panes[a].y2.unit):"";t(c)}else{var b=(Hi._xaxis.max-Hi._xaxis.min)/n*(e.x-r)+Hi._xaxis.min,S=Hi.panes[a].y1.max-(Hi.panes[a].y1.max-Hi.panes[a].y1.min)/i*(e.y-s),C=Hi.panes[a].isDoubleYaxes?Hi.panes[a].y2.max-(Hi.panes[a].y2.max-Hi.panes[a].y2.min)/i*(e.y-s):"";c="x = "+Ci._friendSuffix(b,Hi._xaxis.isDecade,Hi._xaxis.unit)+"  y = "+Ci._friendSuffix(S,!1,Hi.panes[a].y1.unit);c+=Hi.panes[a].isDoubleYaxes?", "+Ci._friendSuffix(C,!1,Hi.panes[a].y2.unit):"";t(c)}}else t("")}};Ci.restoreCanvas=function(){Ci.isDrawingSelectBox=!1;Ci.ini();Ci.rebuild()};Ci.removePlotData=function(){Hi._xaxis.plotData=null;for(var e in Hi.series)w(Hi.series,e)&&(Hi.series[e].plotData=null)};Ci._createAnnotationNode=function(e,r){var n=yn("g",{c_partid:"part_annotation",id:ji.newId(),c_origin:e.x+","+e.y}),i=yn("text",e);r=t.createTextNode(r);i.appendChild(r);n.appendChild(i);return n};r.registerHook({getWaveFormObj:function(){Ci.removePlotData();return Hi},setWaveFormObj:function(e){Hi=e;Ci.ini();Ci.rebuild()},getWaveFormCSV:function(){return Wn()}})}(window,document);
//# sourceMappingURL=editorSCH.min.map