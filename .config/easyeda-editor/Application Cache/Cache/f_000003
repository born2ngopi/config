/**** v6.1.34, build: 04/29/2019 ****/
!function(e,t){function r(){this.anchorPoint=void 0;this.reverse=!1;this.points=[]}function a(e,t){if(a.hooks[e])return t?a.hooks[e].apply(null,t):a.hooks[e].apply();if(0===e.indexOf("draw.")||0===e.indexOf("place.")){wr(e);return!0}var r=a.wildcardHooks;for(var n in r)if(new RegExp(n).test(e))return r[n](e,t);return!1}function o(e){return navigator.userAgent.indexOf(e)}function c(e,t){this.x=+e||0;this.y=+t||0}function d(e){return e?t.getElementById(e):null}function p(e,r){if(!e||"#"==e)return[];try{return(r||t).querySelectorAll(e)}catch(e){return[]}}function h(e,r){if(!e||"#"==e)return null;try{return(r||t).querySelector(e)}catch(e){return null}}function u(e,t,r){if(e&&t){var n,i,a,o,s;a=t?t.split(/\s+/):[];s=r?"add":!1===r?"remove":"toggle";if(e.classList&&e.classList.toggle)for(n=0;n<a.length;n++)a[n]&&e.classList[s](a[n]);else{var l="object"==typeof e.className,c=l?e.className.baseVal:e.className;i=c?c.split(/\s+/):[];for(n=0;n<a.length;n++)if(a[n]){o=i.indexOf(a[n]);o<0?"remove"!=s&&i.push(a[n]):"add"!=s&&i.splice(o,1)}c=i.join(" ");l?e.className.baseVal=c:e.className=c}}}function f(e,t){if(e.classList)return e.classList.contains(t);var r="object"==typeof e.className?e.className.baseVal:e.className;return t&&r&&r.split(/\s+/).indexOf(t)>=0}function g(e,t){if(e&&t){var r,n=t?t.split(/\s+/):[];if(e.classList)for(r=0;r<n.length;r++)n[r]&&e.classList.add(n[r]);else{var i="object"==typeof e.className,a=i?e.className.baseVal:e.className,o=a?a.trim().split(/\s+/):[];for(r=0;r<n.length;r++)n[r]&&o.indexOf(n[r])<0&&o.push(n[r]);a=o.join(" ");i?e.className.baseVal=a:e.className=a}}}function y(e,t){var r,n,i=t?t.split(/\s+/):[];if(e.classList)for(r=0;r<i.length;r++)i[r]&&e.classList.remove(i[r]);else{var a="object"==typeof e.className,o=a?e.className.baseVal:e.className,s=o?o.trim().split(/\s+/):[];for(r=0;r<i.length;r++){n=s.indexOf(i[r]);n>=0&&s.splice(n,1)}o=s.join(" ");a?e.className.baseVal=o:e.className=o}}function v(e){if(e&&e.parentNode)return e.parentNode.removeChild(e)}function x(e,t){return e&&e.cloneNode(!1!==t)}function m(e,t,r){if(!e)return null;var n,i,a,o,s=arguments.length;if(e.tagName){if("string"==typeof t){if(2===s)return e.getAttribute(t);if(t.indexOf(":")>0){i=t.substr(0,t.indexOf(":"));if(i in to){a=t.substr(i.length+1);Ao?e.setAttributeNS(to[i],t,r):e.setAttributeNS(to[i],a,r)}}else{e.setAttribute(t,r);if(""===r||null===r||void 0===r){"transform"===t&&e.setAttribute(t,"");e.removeAttribute(t)}}return e}for(n in t)if(S(t,n))if(n.indexOf(":")>0){i=n.substr(0,n.indexOf(":"));if(i in to){a=n.substr(i.length+1);""===t[n]?e.hasAttributeNS(to[i],a)&&e.removeAttributeNS(to[i],a):Ao?e.setAttributeNS(to[i],n,t[n]):e.setAttributeNS(to[i],a,t[n])}}else if(""===t[n]){if(e.hasAttribute(n)){"transform"===n&&e.setAttribute(n,"");e.removeAttribute(n)}}else e.setAttribute(n,t[n]);return e}if(Array.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection||_o&&"number"==typeof e.length){if("string"==typeof t&&2==s)return e[0]?m(e[0],t):null;if(2==s)for(o=0;o<e.length;o++)m(e[o],t);else if(s>=3)for(o=0;o<e.length;o++)m(e[o],t,r);return e}}function C(e,t){if(!e||!t)return e;if(e.removeAttribute)e.removeAttribute(t);else if(e.length)for(var r=0,n=e.length;r<n;r++)e[r]&&e[r].removeAttribute&&e[r].removeAttribute(t)}function L(e){var t,r,n;for(t=e.childNodes,r=t.length-1,n="";r>=0;r--){n=t[r].tagName;if(!n||n.indexOf(":")>0||"script"===n||"metadata"===n)e.removeChild(t[r]);else{_(t[r]);t[r].childNodes.length>0&&"text"!==n&&"tspan"!==n&&L(t[r])}}}function _(e){var t,r=e.attributes,n=r.length,i={};for(t=n-1;t>=0;t--)if(r[t].nodeName.indexOf(":")>0){var a=r[t].namespaceURI;if(a in to){if(!1===/^c:|^xlink:|^xml:|^xmlns:/.test(r[t].nodeName))try{if(a===NS_c){if(r[t].prefix!==to[NS_c]){i[to[NS_c]+":"+r[t].localName]=r[t].nodeValue;e.removeAttributeNode(r[t])}}else e.removeAttributeNode(r[t])}catch(e){parent.$.messager.alert(e.message)}}else e.removeAttributeNode(r[t])}else if(0===r[t].nodeName.indexOf("on"))try{e.removeAttributeNode(r[t])}catch(e){parent.$.messager.alert(e.description)}m(e,i)}function P(e,t){for(var r,n=[],i=[],a=[],o=0,s=e.length;o<s;o++){n[o]=o;r=t?e[o][t]:e[o];i[o]=r.toUpperCase().match(/\D+|\d+(?:\.\d+)?/g);a[o]=[];if(i[o])for(var l=0;l<i[o].length;l++)a[o][l]=i[o][l].match(/\d/)?1:2}var c=function(e,t){var r=i[e],n=i[t],o=a[e],s=a[t];if(!r||!n)return r==n?0:r?1:-1;for(var l=0,c=Math.max(r.length,n.length);l<c;l++){if(!r[l])return-1;if(!n[l])return 1;if(r[l]!=n[l])return o[l]!=s[l]?1==o[l]?-1:1:1==o[l]?r[l]-n[l]:r[l]<n[l]?-1:1}return 0};n.sort(c);var d=[];for(o=0;o<s;o++)d[o]=e[n[o]];return d}function A(e){return t.createTextNode(e||"")}function b(r,n){if(t.createEvent)try{var i=t.createEvent("CustomEvent");i.initCustomEvent(r,!1,!0,n);return i}catch(e){}if(!mo&&e.CustomEvent)try{return new CustomEvent(r,n)}catch(e){}throw"Your browser does not support CustomEvent"}function S(e,t){return!!e&&e.hasOwnProperty(t)}function E(e){try{return JSON.parse(e)}catch(e){return null}}function O(e){try{return e?JSON.parse(JSON.stringify(e)):e}catch(t){return e}}function I(e,t){if(!e)return null;t=!0===t;try{var r=(new DOMParser).parseFromString(e,"text/xml");if(!r||r.querySelector("parsererror")){!t&&(parent.$||self.$).messager.error("ERROR: svg parsererror");return null}return r}catch(e){!t&&(parent.$||self.$).messager.error("ERROR: svg parsererror");return null}}function T(){for(var e=[],t=Ka.children,r=Is==ao.PCB||Is==ao.PCBLIB||Is==ao.PCBMODULE,n=0,i=t.length;n<i;n++){var a=t[n];if(1===a.nodeType&&a.id){if(r){var o=Z(a);if(!o||"RATLINE"==o)continue}e.push(a.id)}}return e}function R(){for(var e=p("[id]",Ka),t=0,r=/^[^\d]*(\d+)$/,n=0,i=e.length;n<i;n++)if(r.test(e[n].id)){var a=+RegExp.$1;a&&(t=Math.max(t,a))}return t}function w(e){return(e||"").replace(/[ ,]{2,}| /g,",").split(",")}function N(e){for(var t=[],r=w(e),n=r.length-1,i=0;i<n;i+=2)t[i/2]=new c(+r[i],+r[i+1]);return t}function k(e,t){var r;t&&t.match(/^PCB/i)&&(r={decimalPlaces:4});if(e&&e.length>=2){for(var n=[],i=0;i<e.length;i++)e[i]&&n.push(Eo.formatLengthSave(e[i].x,r),Eo.formatLengthSave(e[i].y,r));return n.join(" ")}return""}function M(){}function B(e){return Array.isArray(e)||e&&"object"==typeof e&&"[object String]"!=Object.prototype.toString.call(e)&&"number"==typeof e.length&&e.length>=0&&e.length<4294967296&&e.length%1==0}function D(e){return Array.isArray(e)}function V(e){return e?e.trim?e.trim():e.replace(/^\s+|\s+$/g,""):""}function F(e){for(var t,r=e;r!=t;){t=r;r=t.replace(/~|\^\^|#@\$|`|#sheet#/gi,"")}return r}function G(e,t){var r;for(var n in t)if(S(t,n)&&-1!==e.indexOf(n)){r=!0;break}return r}function Y(e){function t(e){return r[e]}if("string"!=typeof e)return e;if(void 0===e||null===e)return"";var r={"~":"&#126;","^":"&#94;","#@$":"&#35;&#64;&#36;","`":"&#96;"};return G(e,r)?e.replace(/(\~|\^|#@\$|\`)/g,t):e}function j(e){function t(e){return r[e]}if("string"!=typeof e)return e;if(void 0===e||null===e)return"";var r={"&#126;":"~","&#94;":"^","&#35;&#64;&#36;":"#@$","&#96;":"`","&apos;":"'","&APOS;":"'"};return void 0===e||null===e?"":G(e,r)?(e+"").replace(/(&#96;|&#126;|&#94;|&#35;&#64;&#36;|&apos;)/gi,t):e}function H(e){function t(e){return r[e]}if("string"!=typeof e)return e;if(void 0===e||null===e)return"";var r={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","&":"&amp;","&#039;":"'"};return void 0===e||null===e?"":G(e,r)?(e+"").replace(/[<>'"&]/g,t):e}function X(e){if(lo.lsCache)return S(lo.lsCache,String(e))?lo.lsCache[e]:null;try{return localStorage.getItem(e)}catch(e){return null}}function U(){function e(e){return navigator.userAgent.indexOf(e)}return e("chromeframe")>0||e("x-clock")>0?"chromeframe":e("MSIE")>0||e("Trident")>=0?"ie":e("Edge/")>0?"edge":e("Electron/")>0?"electron":e("Firefox/")>0?"firefox":0===e("Opera/")?"opera":0===e("Chrome/")?"chrome":0===e("Safari/")?"safari":"other"}function J(e,t,r){return"M"+(e-r-1)+","+(t-r-1)+"L"+(e+r+1)+","+(t+r+1)+"M"+(e-r-1)+","+(t+r+1)+"L"+(e+r+1)+","+(t-r-1)}function z(e,t){var r=+e;t="-"!=t?"+":"-";if(r<=0||isNaN(r))return"100";if(r<.1||.1==r&&"-"==t)return"0.1";if(r>1e5||1e5==r&&"+"==t)return"100000";e=r<1?(10+r+"").substr(1):r+"";e=e.replace(/([1-9]\.?\d)(.*)/,function(e,t,r){return t+r.replace(/[1-9]/g,"0")});e.match(/[1-9]$/)&&(e=e.indexOf(".")<0?e+".0":e+"0");var n,i,a=e.match(/([1-9])\.?(\d)/),o=a[1]+a[2],s="--,10,14,20,27,38,54,75,AA".split(",");vo&&(s="--,10,12,15,17,20,25,30,35,40,50,60,80,90,AA".split(","));for(n=1;n<s.length;n++){if(o==s[n]){i=s["+"==t?n+1:n-1];break}if(o<s[n]){i=s["+"==t?n:n-1];break}}if("AA"==i){i=s[1];e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);e=function(e){return e.indexOf(".")<0?e+"0":e.replace(/\.(\d)/,"$1.").replace(/^0+(?!\.)/,"").replace(/\.$/,"")}(e)}else if("--"==i){i=s[s.length-2];e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);e=function(e){return e.indexOf(".")<0?e.replace(/\d$/,".$&").replace(/^\./,"0."):e.replace(/(\d)\./,".$1").replace(/^\./,"0.")}(e)}else e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);return function(e){return e.indexOf(".")>0?e.replace(/\.?0*$/,""):e}(e)}function W(e,t){if("canvas"!==t.cmdKey){var r,n=["attr-topic","groupAttr","cmdKey","attr-selected-count","sameType"];t.c_para&&(t.c_para=Eo.c_paraToJson(t.c_para));if(!t)return!1;e.sameType=!S(e,"sameType")||e.sameType;t.cmdKey!==e.cmdKey&&(e.sameType=!1);for(r in e){S(e,r)&&!S(t,r)&&-1===n.indexOf(r)&&delete e[r];e[r]!==t[r]&&"c_para"!==r&&-1===n.indexOf(r)&&(e[r]="<...>")}if(e.c_para)if(t.c_para){e.c_para||(e.c_para={});for(r in t.c_para)S(t.c_para,r)&&(S(e.c_para,r)?e.c_para[r]!==t.c_para[r]&&(e.c_para[r]="<...>"):e.c_para[r]="<...>")}else delete e.c_para}}function Z(e){var t=void 0!==Is;t=t?Is:getActiveDoctype();if(t){var r=Eo.fileType.getAbstractFileType(t),n=r.match(/^sch/)?Eo.getSCHCmdKey(e):Eo.getPCBCmdKey(e);Uo&&"draw.origin"===Uo&&(n="origin");return n}}function K(e){e=+e;return e>=21&&e<53}function q(e,t){function r(e,r,n){var i={text:n,x:e,y:r,fontSize:P},a={d:t?sr("getFontPath",[i]):SVGFont.getStringPath(i),"stroke-width":u,fill:"none",layerid:io.DOCUMENT,c_size:N,c_text:n,stroke:f},o=zt("g",{c_partid:"part_pcbtext",c_shapetype:"dimensionCheck",layerid:io.DOCUMENT,id:Eo.newId(),stroke:f,display:c}),s=zt("path",a);s.style.stroke=f;o.append(s);v.append(o);var l=Eo.svg.getBBox(o);m(o,{c_origin:{x:l.x,y:l.y+l.height/2}});t&&Ln(o);var d=n.split(":")[0];o.addEventListener("mouseover",function(){var e=p('[c_checkDimension_id="'+d+'"]')[0];v.append(e);s.style.stroke="red";m(e,"style","stroke: red")});o.addEventListener("mouseleave",function(){var e=p('[c_checkDimension_id="'+d+'"]')[0];s.style.stroke="#fff";m(e,"style","stroke: "+f)});t&&_.push(["add",o.id])}function n(e,r){function n(e){return e.match(/^\d+$/)?"num":e.match(/^.*\D+\d+$/)?"strNum":"str"}e=e.filter(function(e,t,r){return t<=r.indexOf(e)});for(var o=[],s=[],l=[],c=0;c<e.length;c++){var d=e[c];"num"===n(d)?o.push(d):"strNum"===n(d)?s.push(d):l.push(d)}o=o.map(function(e){return parseInt(e)});o.sort(function(e,t){return e-t});l.sort();if(l.indexOf("")>-1){l=l.filter(function(e){return""!==e});l.push("unnumbered")}if(l.indexOf("Hole")>-1){l=l.filter(function(e){return"Hole"!==e});l.push("Hole")}var p=s.map(function(e){var t=e.match(/(.*\D+)(\d+$)/);return{str:t[1],num:parseInt(t[2]),strNum:e}});p.sort(function(e,t){return e.str>t.str?1:e.str<t.str?-1:e.num-t.num});var h=i(o).concat(a(p),l),u=[r+": "+h[0]],f="",g=0,y=1;if(1===h.length)return[r+": "+h[0],y];for(c=1;c<h.length;c++){g++;var v=u.join(", ");if((t?sr("getFontsWidth",[v,P]):SVGFont.getStringWidth(v,P))<=b.width||g<5){u.push(h[c]);v=u.join(", ")}else{g=0;f+=v+"\n";y++;u=[h[c]];v=h[c]}}f+=v;return[f,y]}function i(e){if(e.length<2)return e;for(var t=[],r="",n=0;n<e.length;n++){var i=e[n-1],a=e[n],o=e[n+1];a-1!==i&&a+1!==o?t.push(a):a-1!==i?r=a:a+1!==o&&t.push(r+"~"+a)}return t}function a(e){if(e.length<2)return e;var t=[],r="";if(e.length>=2)for(var n=0;n<e.length;n++){var i=e[n-1],a=e[n],o=e[n+1];i&&a.num===i.num+1||o&&a.num===o.num-1?i&&a.num===i.num+1?o&&a.num===o.num-1||t.push(r+"~"+a.strNum):r=a.strNum:t.push(a.strNum)}return t}function o(e,r,n){var i=n.split(": ")[0],a={text:n,x:e,y:r,fontSize:P},o=t?sr("getFontPath",[a]):SVGFont.getStringPath(a),s={d:o,"stroke-width":u,fill:"none",c_size:i,stroke:f,c_text:n},l=zt("g",{c_partid:"part_pcbtext",c_shapetype:"dimensionCheck",layerid:io.DOCUMENT,id:Eo.newId(),stroke:f,display:c}),p=zt("path",s);l.append(p);v.append(l);var h=Eo.svg.getBBox(l);m(l,{c_origin:{x:h.x,y:h.y+h.height/2}});t&&Ln(l);l.addEventListener("mouseover",function(){A[i].forEach(function(e){g(d(e),"hover")});p.style.stroke="red"});l.addEventListener("mouseleave",function(){A[i].forEach(function(e){y(d(e),"hover")});p.style.stroke=f})}function s(e,t,r){var n,i,a=1;if("vertical"===r){n="A";i="x"}else{n="B";i="y"}for(var o=0,s=[E-100],d=e[0],p=1;p<e.length;p++){var h=Math.abs(e[p][i]-e[p-1][i]);if(h>.1001){if(Math.abs(o-h)>.1001){F.push({name:n+a,value:Eo.units.convert(h,"pixel",x).toFixed(3)+x});var g={d:l(d,e[p],t,n+a,r,s),"stroke-width":u,fill:"none",id:Eo.newId(),c_shapetype:"dimensionCheck",layerid:io.DOCUMENT,c_checkDimension_id:n+a,stroke:f,display:c},y=zt("path",g);y.style.stroke=f;v.append(y);o=h;a++}d=e[p]}else e[p]["vertical"===r?"y":"x"]<d["vertical"===r?"y":"x"]&&(d=e[p])}}function l(e,r,n,i,a,o){var s,l,c=t?10:5;if("vertical"===a){s={x:e.x,y:I-c};l={x:r.x,y:I-c}}else{s={x:E-c,y:e.y};l={x:E-c,y:r.y}}var d=l.x-s.x,p=s.y-l.y,h=n||6,u=fe(s.x,s.y,l.x,l.y),f=he(s.x,s.y,l.x,l.y),g=180/(Math.PI/f),y=t?sr("getFontsWidth",[i,h]):SVGFont.getStringWidth(i,h),v=(u-y)/2-1,x=Math.abs(v)*Math.cos(f),m=Math.abs(v)*Math.sin(f),C=+s.x+d/2,L=+s.y-p/2,_=0;if(y>0){if(v>0)if(d>0){C=+s.x+x;L=+s.y+m}else{C=+l.x-x;L=+l.y-m}else if(d>0){C=+s.x-x;L=+s.y-m}else{C=+l.x+x;L=+l.y+m}v-.45<0&&(_+=.27+h/2)}for(var P="vertical"===a?C:L,A=o.length,b=0;b<o.length;b++)if(P>o[b]){A=b;break}if("vertical"===a){s.y-=3*A;l.y-=3*A}else{s.x-=3*A;l.x-=3*A}c=3*A+c;o[A]=P+y+2;var S=[s.x+.45,s.y+.27,s.x,s.y,s.x+.45,s.y-.27],O=[l.x-.45,l.y+.27,l.x,l.y,l.x-.45,l.y-.27];L=+s.y-p/2;_=0;if(y>0){if(v>0)if(d>0){C=+s.x+x;L=+s.y+m}else{C=+l.x-x;L=+l.y-m}else if(d>0){C=+s.x-x;L=+s.y-m}else{C=+l.x+x;L=+l.y+m}v-.45<0&&(_+=.27+h/2)}var T=function(e,t,r,n){var i={x1:e.x,y1:e.y},a={x1:t.x,y1:t.y};if("vertical"===r){Object.assign(i,{x2:e.x,y2:I-n-.25});Object.assign(a,{x2:t.x,y2:I-n-.25})}else{Object.assign(i,{x2:E-n-.25,y2:e.y});Object.assign(a,{x2:E-n-.25,y2:t.y})}return["M",i.x1,i.y1,"L",i.x2,i.y2,"M",a.x1,a.y1,"L",a.x2,a.y2].join(" ")}(e,r,a,c),R={text:i,x:+C+1,y:+L-_,fontSize:h,degree:360-(d>0?g:g+180),rotateOriginX:+C,rotateOriginY:+L},w=t?sr("getFontPath",[R]):SVGFont.getStringPath(R),N=v-.45<0?g+180:g;S=ge(S,N,s.x,s.y);O=ge(O,N,l.x,l.y);return"M"+s.x+","+s.y+"L"+(v-.45<0?l.x+","+l.y:s.x+x+","+(s.y+m)+"M"+(l.x-x)+","+(l.y-m)+"L"+l.x+","+l.y)+"M"+S[0]+","+S[1]+"L"+S[2]+","+S[3]+"L"+S[4]+","+S[5]+"M"+O[0]+","+O[1]+"L"+O[2]+","+O[3]+"L"+O[4]+","+O[5]+w+T}var c,h=p('[c_shapetype="dimensionCheck"]'),u=.2,f="#fff",v=d(t?"g1":"footprint_r_g");c=t?"yes":$('#dlgUpdatePackage [show-to="pad_info"]').hasClass("active")?"yes":"none";if(h.length>0)zr(h);else{var x;x=t?Zo.canvas.unit||e.canvas&&e.canvas.unit||"mil":e.canvas&&e.canvas.unit||Zo.canvas.unit||"mil";var C=[],L=[],_=[],P=1.5,A={},b=Eo.svg.getBBox(v),E=b.x,O=b.x+b.width,I=b.y,T=b.y+b.height,R=Object.assign({},e.PAD,e.HOLE);for(var w in R)if(S(R,w)){var N,k,M,B=R[w];C.push(B);if(e.PAD&&e.PAD[w]){var D=B;N=Eo.units.convert(D.width,"pixel",x).toFixed(3)+" x "+Eo.units.convert(D.height,"pixel",x).toFixed(3)+x;if(D.layerid==io.ALL){M="round"===function(e){return"circle"==e.querySelectorAll(":not([c_padid]):not(title)")[1].tagName?"round":"slot"}(v.querySelector("#"+w))?2*D.holeR:D.holeLength;k=Eo.units.convert(2*D.holeR,"pixel",x).toFixed(3)+" x "+Eo.units.convert(M,"pixel",x).toFixed(3)+x;N+=" ("+k+")"}L.push({number:D.number,size:N})}else{var V=B;N=Eo.units.convert(2*V.holeR,"pixel",x).toFixed(3)+" x "+Eo.units.convert(2*V.holeR,"pixel",x).toFixed(3)+x;L.push({number:"Hole",size:N})}A[N]?A[N].push(w):A[N]=[w]}if(!(C.length<1)){var F=[];C.sort(function(e,t){return Math.abs(e.x-t.x)>1e-4?e.x-t.x:Math.abs(e.y-t.y)>1e-4?e.y-t.y:0});s(C,P,"vertical");C.sort(function(e,t){return Math.abs(e.y-t.y)>.1001?e.y-t.y:Math.abs(e.x-t.x)>.1001?e.x-t.x:0});s(C,P,"horizontal");for(var G=Math.max(1.2*P,P+4),Y=Math.max(Math.floor(b.height/G),5),j=Math.ceil(F.length/Y),H=O,X=0;X<j;X++){var U=Math.max(Y*X,0),J=Math.min(F.length,Y*(X+1)),z=F.slice(U,J),W=z.map(function(e,t){var n=e.name+": "+e.value;r(H+5,I+G*t,n);return n}).join("\n");H+=(t?sr("getFontsWidth",[W,P]):SVGFont.getStringWidth(W,P))+5}!function(e){for(var t={},r=E,i=T+5,a=0;a<e.length;a++){var s=e[a];t[s.size]?t[s.size].push(s.number):t[s.size]=[s.number]}for(var l in t){var c=n(t[l],l),d=c[0],p=c[1];o(r,i,d);i+=p*G}}(L);t&&zo.save(_)}}}function Q(e){return MD5(Date.now()+ct(!0,3,32)+e).substr(8,16)}function ee(){var e,t=/{([\d\w.]+)}/g,r=Array.prototype.slice.call(arguments),n=r.shift()+"";1==r.length&&"object"==typeof r[0]&&(r=r[0]);t.lastIndex=0;return n.replace(t,function(t,n){e=r[n];return void 0===e?t:e})}function te(e,t,r){rs.move(e.childNodes[0],t,r);var n,i,a=Eo.svg.getBBox(e),o=m(e,"transform"),s=o&&o.match(/scale\(.*?\)/)?o.match(/scale\(.*?\)/)[0]:"",l=s?1*s.match(/scale\((.*?)\)/)[1]:1,c=(o&&o.match(/translate\(.*?\)/)&&o.match(/translate\(.*?\)/)[0],wt(e)),d=c.c_origin;if(d){d=d.split(",");n=d[0];i=d[1]}else{var p=Eo.svg.getPlainBBox(e);n=p.x+p.width/2;i=p.y+p.height/2}var h=1*n+1*t,u=1*i+1*r,f=c.c_rotation||0,g=-(a.width*l-a.width)/2/l,y=-(a.height*l-a.height)/2/l;m(e,{transform:ee("rotate({rotate}) {scale} translate({translateX}, {translateY})",{scale:s,translateX:-(a.x*l-a.x)/l+g,translateY:-(a.y*l-a.y)/l+y,rotate:f+" "+h+" "+u}),c_origin:h+","+u})}function re(e,t,r){e=e||Ka;"string"==typeof r&&(r=d(r));r?e.insertBefore(t,r):e.appendChild(t)}function ne(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,p=c*c+d*d,h=((s-n)*c+(l-i)*d)/p;return{x:n+h*c,y:i+h*d}}function ie(e,t,r,n){var i=e.x,a=e.y,o=t.x,s=t.y,l=r.x,c=r.y,d=o-i,p=s-a,h=d*d+p*p;void 0===n&&(n=0);var u=((l-i)*d+(c-a)*p)/h;if(!(u>=1+n||u<=0)){var f=i+u*d,g=a+u*p,y=f-l,v=g-c;return{point:{x:f,y:g},distance2:y*y+v*v}}}function ae(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,p=c*c+d*d;if(0===p)return(s-n)*(s-n)+(l-i)*(l-i);var h=((s-n)*c+(l-i)*d)/p,u=n+h*c,f=i+h*d,g=u-s,y=f-l;return g*g+y*y}function oe(e,t,r,n){var i=e.x,a=e.y,o=t.x,s=t.y,l=r.x,c=r.y,d=n.x,p=n.y,h=o-i,u=s-a,f=l-d,g=c-p,y=u*f-h*g;return y?{x:(h*f*(c-a)-l*h*g+i*u*f)/y,y:(u*g*(l-i)-c*u*f+a*h*g)/-y}:null}function se(e,t,r){var n,i,a=e.x,o=e.y,s=-1,l=t.getAttribute("stroke-width")/2;r&&(l+=r);var c,d,p=l*l,h=t.points,u=h.numberOfItems;c=h.getItem(0);if(a==c.x&&o==c.y)return 0;for(var f=0;f<u-1;f++){c=h.getItem(f);d=h.getItem(f+1);if(a==d.x&&o==d.y)return 2*(f+1);if(c.x!=d.x||c.y!=d.y){n=ie(c,d,e);if(n&&n.distance2<=p&&(void 0===i||n.distance2<i)){i=n.distance2;s=2*f+1}}}return s}function le(e,t,r,n){function i(e,t){return e.x==t.x&&e.y==t.y}var a=i(e,r)||i(e,n)?e:i(t,r)||i(t,n)?t:null;if(a)return{x:a.x,y:a.y};var o,s,l,c,d,p,h,u,f;o=t.x-e.x;s=t.y-e.y;l=n.x-r.x;c=n.y-r.y;h=l*s-c*o;if(0===h)return!1;u=r.x-e.x;f=r.y-e.y;p=(o*f-s*u)/h;d=(l*f-c*u)/h;return p>=0&&p<=1&&d>=0&&d<=1&&{x:e.x+d*o,y:e.y+d*s}}function ce(e,t){var r={x:+e.x,y:+e.y};gridX=t||+m(d("gridPattern"),"width"),gridY=t||+m(d("gridPattern"),"height"),modx=e.x%gridX,mody=e.y%gridY;if(!gridX||!gridY)return r;if(modx){modx<0&&(modx+=gridX);r.x+=-modx+(modx<gridX/2?0:gridX)}if(mody){mody<0&&(mody+=gridY);r.y+=-mody+(mody<gridY/2?0:gridY)}r.x=Eo.toFixed(r.x,2);r.y=Eo.toFixed(r.y,2);return r}function de(e,t,r){if(!t)return null;var n,i,a,o=t.length,s=null,l=t[0].x,c=t[0].y,d=l,p=c,h=e.x,u=e.y;for(n=1;n<o;n++){i=t[n].x;a=t[n].y;l>i&&(l=i);c>a&&(c=a);d<i&&(d=i);p<a&&(p=a)}if(h<l-r||u<c-r||h>d+r||u>p+r)return null;for(n=1;n<o;n++){s=pe(e,t[n-1],t[n]);if(s.d<r)return s}return null}function pe(e,t,r){var n,i,a,o,s,l,c,d=+t.x,p=+t.y,h=+r.x,u=+r.y,f=+e.x,g=+e.y,y=h-d,v=u-p,x=f-d,m=g-p;if(0===y&&0===v)return{d:Math.sqrt(x*x+m*m),point:{x:d,y:p}};n=(x*y+m*v)/(y*y+v*v);if(n<0)return{d:Math.sqrt(x*x+m*m),point:{x:d,y:p}};if(n>1){i=f-h;a=g-u;return{d:Math.sqrt(i*i+a*a),point:{x:h,y:u}}}l=d+n*y;c=p+n*v;o=f-l;s=g-c;return{d:Math.sqrt(o*o+s*s),point:{x:l,y:c}}}function he(e,t,r,n){var i=r-e,a=n-t,o=Math.atan2(a,i);o=o<0?o+Math.PI+Math.PI:o;return o}function ue(e,t,r,n){var i=e-r,a=t-n;return i*i+a*a}function fe(e,t,r,n){return Math.sqrt(ue(e,t,r,n))}function ge(e,t,r,n){t=+t;r=+r;n=+n;if(void 0===r||void 0===n)return e.slice(0);t=Le(t);if(!t)return e.slice(0);for(var i=e.slice(0),a=i.length,o=0;o<a;o++)"number"!=typeof i[o]&&(i[o]-=0);if(!S($a,t)){$a[t]=Math.sin(t*Math.PI/180);Qa[t]=Math.cos(t*Math.PI/180)}var s=$a[t],l=Qa[t];for(o=0;o<a;o+=2){var c=i[o],d=i[o+1],p=c-r,h=d-n;i[o]=r+l*p-s*h;i[o+1]=n+l*h+s*p}return i}function ye(e,t,r,n){var i=[e.x,e.y,e.x+e.width,e.y,e.x,e.y+e.height,e.x+e.width,e.y+e.height];i=ge(i,t,r,n);var a={x:Math.min(i[0],i[2],i[4],i[6]),y:Math.min(i[1],i[3],i[5],i[7])};a.width=Math.max(i[0],i[2],i[4],i[6])-a.x;a.height=Math.max(i[1],i[3],i[5],i[7])-a.y;return a}function ve(e,t){var r,n=m(e,"transform");if(!n||n.indexOf("rotate")<0)return 0;r=t?n.match(/rotate\(([\-\+]?[\d\.]+)(?:[,\s]+([\-\+]?[\d\.]+)[,\s]+([\-\+]?[\d\.]+))?\)/):n.match(/rotate\(([\-\+]?[\d\.]+).*?\)/);if(!r)return 0;var i=r[1]%360;i<0&&(i+=360);return t?{ang:i,ox:+r[2],oy:+r[3]}:i}function xe(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=e[0]-t[0],o=e[1]-t[1];return[a*i-o*n+t[0],o*i+a*n+t[1]]}function me(e,t,r){return xe(e,t,r*Math.PI/180)}function Ce(e,t,r){if(null===r)return e;r="string"==typeof r?-parseInt(r):-r;return xe(e,t,r*Math.PI/180)}function Le(e){return e<0?(360+e%360)%360:e>=360?e%360:e}function _e(e,t,r){var n=e-t;r||(r=1e-10);return(n>0?n:-n)<r}function Pe(e,t){var r=e.x-t.x,n=e.y-t.y;return(r>0?r:-r)<.001&&(n>0?n:-n)<.001}function Ae(e,t){var r=e-t;return(r>0?r:-r)<.1}function be(e,t,r,n,i){var a,o=de({x:r,y:n},e,i+.5*t),s=null;o&&[].forEach.call(e,function(t,i){if(!s&&e[i+1]){if(Re(o.point,t,e[i+1])){s=ne(t,e[i+1],{x:r,y:n});a=fe(r,n,s.x,s.y)}}});return s&&{point:s,d:a}}function Se(e,t,r,n,i){return Math.pow(e-r,2)+Math.pow(t-n,2)<=Math.pow(i,2)}function Ee(e,t){"string"==typeof e&&(e={x:e.split(" ")[0],y:e.split(" ")[1]});for(var r=e.x,n=e.y,i=!1,a=0,o=t.length,s=o-1;a<o;s=a,a++){"string"==typeof t[a]&&(t[a]={x:t[a].split(" ")[0],y:t[a].split(" ")[1]});var l=t[a].x,c=t[a].y,d=t[s].x,p=t[s].y;if(l==r&&c==n||d==r&&p==n)return!0;if(c<n&&p>=n||c>=n&&p<n){var h=l+(n-c)*(d-l)/(p-c);if(h==r)return!0;h>r&&(i=!i)}}return i}function Oe(e,t,r,n,i,a){var o,s,l,c,d,p,h,u;d=e*e+t*t;p=2*e*r-2*n*t*t+2*i*e*t;h=r*r+2*i*r*t+t*t*(n*n+i*i-a*a);var f=lt(d,p,h);d=f.a;p=f.b;h=f.c;u=p*p-4*d*h;if(u<-.001)return[];u<0&&(u=0);u=Math.sqrt(u);o=(-p+u)/(2*d);s=(-p-u)/(2*d);if(Math.abs(t)<.1){l=Math.sqrt(a*a-Math.pow(o-n,2))+i;if(Math.abs(e*o+t*l+r-0)>.001){l=-Math.sqrt(a*a-Math.pow(o-n,2))+i;c=Math.sqrt(a*a-Math.pow(s-n,2))+i}else c=-Math.sqrt(a*a-Math.pow(s-n,2))+i}else{l=-(e*o+r)/t;c=-(e*s+r)/t}return[{x:o,y:l},{x:s,y:c}]}function Ie(e,t,r,n,i){var a={x:r,y:n};if(Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4)return(e.x-r)*(e.x-r)+(e.y-n)*(e.y-n)<1e-4?[{x:e.x,y:t.y}]:[];var o=ne(e,t,a),s=fe(r,n,o.x,o.y);if(s-i>1e-4)return[];if(Math.abs(s-i)<1e-4)return[o];if(s<1e-4)var l=Math.atan2(t.y-e.y,t.x-e.x)+Math.PI/2;else l=Math.atan2(n-o.y,r-o.x);var c=Ne(o,l),d=(Ne(a,l),Math.sqrt(i*i-s*s)),p={x:c.x,y:c.y+d},h={x:c.x,y:c.y-d};return[Ne(p,-l),Ne(h,-l)]}function Te(e,t,r,n,i){var a=(e.x,e.y,t.x,t.y,[]);arr=Ie(e,t,r,n,i);arr.forEach(function(r){Re({x:r.x,y:r.y},e,t)&&a.push({x:r.x,y:r.y})});return a}function Re(e,t,r){function n(e){if(!e)return!1;e.x=Number(e.x);e.y=Number(e.y);return!isNaN(e.x)&&!isNaN(e.y)}if(!(n(e)&&n(t)&&n(r)))return null;var i=t.x-r.x>0?t.x:r.x,a=t.y-r.y>0?t.y:r.y,o=t.x-r.x>0?r.x:t.x,s=t.y-r.y>0?r.y:t.y,l=e.x,c=e.y;return l<=i+.001&&l>=o-.001&&c<=a+.001&&c>=s-.001}function we(e,t,r,n,i,a){return e*i==n*t?null:{x:(t*a-i*r)/(e*i-n*t),y:(e*a-n*r)/(t*n-i*e)}}function Ne(e,t){var r=Math.cos(t),n=Math.sin(t);return{x:e.x*r+e.y*n,y:e.y*r-e.x*n}}function ke(e,t,r){return{x:e.x+t,y:e.y+r}}function Me(e,t){return{a:e.y-t.y,b:t.x-e.x,c:e.x*t.y-t.x*e.y}}function Be(e,t,r){for(var n,i,a=!1,o=0,s=t.length-1;o<t.length;s=o++){n=t[o];i=t[s];if(Ve(e,n,i))return!r;n.y>e.y!=i.y>e.y&&e.x<(e.y-n.y)*(n.x-i.x)/(n.y-i.y)+n.x&&(a=!a)}return a}function De(e,t,r,n,i){var a=Me(e,t),o=we(a.a,a.b,a.c,r,n,i);return o&&Ve(o,e,t)?o:null}function Ve(e,t,r){return!!Re(e,t,r)&&_e((e.x-t.x)*(r.y-t.y),(r.x-t.x)*(e.y-t.y),.001)}function Fe(e,t,r,n){if(t||r)return Math.abs(t*e.x+r*e.y+n)/Math.sqrt(t*t+r*r)}function Ge(e,t,r,n,i,a,o){void 0===o&&(o=.001);var s,l,c,d,p,h,u,f;if(Math.abs(t-i)>o){var g=(e*e-n*n+t*t-i*i+a*a-r*r)/(2*(t-i)),y=(e-n)/(t-i);s=1+y*y;l=-2*(e+(g-t)*y);c=e*e+Math.pow(g-t,2)-r*r;f=l*l-4*s*c;if(f>.001){d=(-l+Math.sqrt(f))/(2*s);p=(-l-Math.sqrt(f))/(2*s);h=g-y*d;u=g-y*p}else{if(!(Math.abs(f)<.001))return null;d=-l/(2*s);p=d;h=g-y*d;u=h}}else{if(!(Math.abs(e-n)>o))return null;d=(e*e-n*n+a*a-r*r)/(2*(e-n));p=d;s=1;l=-2*t;c=t*t-r*r+(d-e)*(d-e);f=l*l-4*s*c;if(f>.001){h=(-l+Math.sqrt(f))/(2*s);u=(-l-Math.sqrt(f))/(2*s)}else{if(!(f>-.001))return null;h=-l/(2*s);u=h}}return[{x:d,y:h},{x:p,y:u}]}function Ye(e,t,r){var n=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);if(r){n>Math.PI&&(n-=2*Math.PI);n<-Math.PI&&(n+=2*Math.PI);return n}return n}function je(e,t,r){var n=(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x);return n>0?"顺时针":n<0?"逆时针":0===n?"共线":void 0}function He(e,t,r){var n=Math.min,i=Math.max;return n(t.x,r.x)<=e.x&&e.x<=i(t.x,r.x)&&n(t.y,r.y)<=e.y&&e.y<=i(t.y,r.y)&&(e.x-t.x)*(r.y-t.y)==(r.x-t.x)*(e.y-t.y)}function Xe(e,t){return e.x==t.x&&e.y==t.y}function Ue(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}function Je(e){var t;t=e.match(/,/)?e.trim().split(","):e.trim().split(" ");return t.map(function(e,t,r){return t%2==0?{x:Number(e),y:Number(r[t+1])}:void 0}).filter(function(e){return void 0!==e})}function ze(e,t){if(!e||!e.length)return"";void 0===t&&(t=3);t=Number(t);return[].reduce.call(e,function(e,r){return e+=Eo.toFixed(r.x,t)+" "+Eo.toFixed(r.y,t)+" "},"").trim()}function We(e,t,r,n,i){i||(i=0);var a=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x),o=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x);if(a*o>=i)return!1;var s=(r.x-e.x)*(n.y-e.y)-(r.y-e.y)*(n.x-e.x);if(s*(s+a-o)>=i)return!1;var l=s/(o-a),c=l*(t.x-e.x),d=l*(t.y-e.y);return{x:e.x+c,y:e.y+d}}function Ze(e,t){var r=Ke(e),n=Ke(t);if(!r||!n)return null;var i=qe(r),a=qe(n);if(!i||!a)return null;var o=fe(i.x,i.y,r.M.x,r.M.y),s=fe(a.x,a.y,n.M.x,n.M.y);intersects=Ge(i.x,i.y,o,a.x,a.y,s);if(!intersects)return null;intersects=intersects.filter(function(e){return!(!$e(r,e,i)||!$e(n,e,a))});return intersects.length>0?2===intersects.length&&Math.abs(intersects[0].x-intersects[1].x)<.001&&Math.abs(intersects[0].y-intersects[1].y)<.001?[intersects[0]]:intersects:null}function Ke(e){e=e.trim();if("M"!==e[0])return null;var t=e.slice(1).split("A");if(2!==t.length)return null;var r=t[0].trim().split(",").reduce(function(e,t){return e.concat(t.trim().split(" "))},[]),n=t[1].trim().split(",").reduce(function(e,t){return e.concat(t.trim().split(" "))},[]);return 7!==n.length?null:n[0]!==n[1]?null:{M:{x:Number(r[0]),y:Number(r[1])},A:{rx:Number(n[0]),ry:Number(n[1]),rotation:Number(n[2]),largeArc:Number(n[3]),clockwise:Number(n[4]),x:Number(n[5]),y:Number(n[6])}}}function qe(e){"string"==typeof e&&(e=Ke(e));var t=e.M,r=e.A,n=e.A.rx,i=Math.atan2(r.y-t.y,r.x-t.x),a=Ne(t,i),o=Ne(r,i),s=fe(a.x,a.y,o.x,o.y)/2;n<s&&(n=s);var l=Math.sqrt(n*n-s*s),c=e.A.largeArc===e.A.clockwise?1:-1;return Ne({x:a.x+s,y:a.y-l*c},-i)}function $e(e,t,r,n){void 0===n&&(n=.001);"string"==typeof e&&(e=Ke(e));r||(r=qe(e));var i=Math.atan2(t.y-r.y,t.x-r.x),a=Math.atan2(e.M.y-r.y,e.M.x-r.x),o=Math.atan2(e.A.y-r.y,e.A.x-r.x);if(Math.abs(a-i)<n||Math.abs(a-i)>2*Math.PI-n||Math.abs(o-i)<n)return!0;var s=Math.abs(a-o)>Math.PI==e.A.largeArc>0;Math.abs(Math.abs(a-o)-Math.PI)<n&&(s=(a<=0&&o>=0)==(1===e.A.clockwise));return a>=o&&a>=i&&i>=o?s:a<=o&&a<=i&&i<=o?s:!s}function Qe(e,t,r){"string"==typeof e&&(e=Ke(e));if(!e||!t||!r)return null;if(e.A.rx!==e.A.ry)return null;var n=qe(e),i=fe(n.x,n.y,e.M.x,e.M.y),a=Ie(t,r,n.x,n.y,i);a=a.filter(function(i){return!(!$e(e,i,n)||!Ve(i,t,r))});return 0===a.length?null:2===a.length&&Math.abs(a[0].x-a[1].x)<.001&&Math.abs(a[0].y-a[1].y)<.001?[a[0]]:a}function et(e,t,r,n){var i,a,o={x:null,y:null},s={x:null,y:null},l=null;l=We(e,t,r,n);if(l)return{d:0,point:l};l=pe(e,r,n);a=l.d;i=1/0;if(a<i){i=a;o.x=l.point.x;o.y=l.point.y;s=e}l=pe(t,r,n);a=l.d;if(a<i){i=a;o.x=l.point.x;o.y=l.point.y;s=t}l=pe(r,e,t);a=l.d;if(a<i){i=a;o.x=l.point.x;o.y=l.point.y;s=r}l=pe(n,e,t);a=l.d;if(a<i){i=a;o.x=l.point.x;o.y=l.point.y;s=n}return{d:i,nearP1:o,nearP2:s}}function tt(e,t,r,n){if(!(e&&t&&r&&n))return null;var i=Math.atan2(t.y-e.y,t.x-e.x);i<0&&(i+=Math.PI);var a=Math.atan2(n.y-r.y,n.x-r.x);a<0&&(a+=Math.PI);return Math.abs(a-i)}function rt(e,t,r){r=Number(r);if(!e||!t||isNaN(r))return null;if(e.x===t.x&&e.y===t.y)return null;var n=Math.atan2(t.y-e.y,t.x-e.x),i=Ne(e,n),a=Ne(t,n),o=a.x-i.x>0?1:-1;return Ne({x:i.x+o*r,y:i.y},-n)}function nt(e,t,r){var n=Math.atan2(t.y-e.y,t.x-e.x),i=Ne(e,n);return Ne(r,n).x>=i.x}function it(e){var t=[];if(e){var r,n=e.replace(/[MLZz,]/g," ").trim().split(/\s+/);n.length;n.forEach(function(e,n){number=Number(e);isNaN(number);if(n%2==0)r={x:number};else{r.y=number;t.push(r)}})}return t}function at(e,t,r){function n(e,t){return Math.abs(e.x-t.x)<=r&&Math.abs(e.y-t.y)<=r}function i(e){var t=0;return{output:e.sort(function(e,t){return Math.abs(e.x-t.x)>r?e.x-t.x:e.y-t.y}).filter(function(e,r,i){if(0!==r&&n(e,i[r-1])){t++;return!1}return!0}),count:t}}if(e&&t){void 0===r&&(r=0);e=Eo.extend([],e);t=Eo.extend([],t);e=i(e).output;t=i(t).output;return i(e.concat(t)).count}}function ot(e){if(!e.length)return[];for(var t=[],r={},n=0;n<e.length;n++){var i=typeof e[n]+e[n];if(!r[i]){t.push(e[n]);r[i]=!0}}return t}function st(e,t){if(!t&&void 0!==e.clockwise)return e.clockwise;for(var r=0,n=1,i=e.length;n<i;n++)r+=(e[n].x-e[n-1].x)*(e[n].y+e[n-1].y);r+=(e[0].x-e[i-1].x)*(e[0].y+e[i-1].y);return e.clockwise=r<0}function lt(e,t,r){function n(e){function t(e){if(Math.abs(e)>=1){var t=Math.abs(e).toString();return t.indexOf("e")>=0?+t.split(/e/)[1]+1:t.split(".")[0].length}t=Math.abs(e).toString();return t.indexOf("e-")>=0?1-t.split(/e-/)[1]:-t.match(/\.0*/g)[0].length-1}e=e.filter(function(e){return 0!=e}).sort(function(e,t){return Math.abs(e)-Math.abs(t)});var r=t(e[e.length-1]),i=t(e[0]);if(r-i>10){e.shift();return n(e)}return r<=0&&i<=0||i>=1?e[0]:1}var i=[e,t,r],a=n(i);return{a:e/a,b:t/a,c:r/a}}function ct(e,t,r){t=t||1;r=r||32;var n="",i=t,a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];e&&(i=Math.round(Math.random()*(r-t))+t);for(var o=0;o<i;o++){pos=Math.round(Math.random()*(a.length-1));n+=a[pos]}return n}function dt(e,t,r,n){void 0===n&&(n=1e-4);"string"==typeof e&&(e=Ke(e));r||(r=qe(e));var i=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))/fe(r.x,r.y,e.M.x,e.M.y)-1;return!!(Math.abs(i)<n&&$e(e,t,r))}function pt(e,t){"string"==typeof e&&(e=Ke(e));var r,n,i,a,o,s,l,c,d,p,h=qe(e),u=fe(h.x,h.y,e.M.x,e.M.y),f=e.M,g={x:e.A.x,y:e.A.y},y={x:g.x-h.x||0,y:-(g.y-h.y)||0},v={x:f.x-h.x||0,y:-(f.y-h.y)||0};if(t.x==f.x&&t.y==f.y)var x="startPoint";else x=t.x==g.x&&t.y==g.y?"endPoint":"other";r=h.y-t.y;n=t.x-h.x;h.x*t.y-h.y*t.x;i=-n;a=r;o=-i*h.x-a*h.y;s=Oe(i,a,o,h.x,h.y,u);if(2==s.length){l=s[0];c=s[1];var m={x:c.x-l.x,y:-(c.y-l.y)};d="endPoint"==x?Math.atan2(m.y,m.x)-Math.atan2(v.y,v.x):Math.atan2(m.y,m.x)-Math.atan2(y.y,y.x);d>=Math.PI?d=2*Math.PI-d:d<=-Math.PI?d+=2*Math.PI:d>-Math.PI&&d<0&&(d=-d);var C={x:l.x-c.x,y:-(l.y-c.y)}
;p="endPoint"==x?Math.atan2(C.y,C.x)-Math.atan2(v.y,v.x):Math.atan2(C.y,C.x)-Math.atan2(y.y,y.x);p>=Math.PI?p=2*Math.PI-p:p<=-Math.PI?p+=2*Math.PI:p>-Math.PI&&p<0&&(p=-p);var L=1==+e.A.largeArc,_=Math.abs(d-p)<1e-4;if("endPoint"==x)if(_){if($e(e,c,h))return C;if($e(e,l,h))return m}else{if(d<p&&!L||d>p&&L)return C;if(d<p&&L||d>p&&!L)return m}else if("startPoint"==x)if(_){if($e(e,c,h))return m;if($e(e,l,h))return C}else{if(d<p&&!L||d>p&&L)return m;if(d<p&&L||d>p&&!L)return C}}}function ht(e,t){function r(e,t){return[e[0]-t[0],e[1]-t[1]]}function n(e,t){return e[0]*t[0]+e[1]*t[1]}function i(e){return e[0]*e[0]+e[1]*e[1]}function a(e,t){return i(r(e,t))}function o(e,t,s,l,c){if(!(l<=s+1)){for(var d,p,h,u,f,g=s,y=0,v=e*e,x=[t[s],t[l]],m=r(x[1],x[0]),C=i(m,m),L=s+1;L<l;L++){d=r(t[L],x[0]);u=n(d,m);if(u<=0)f=a(t[L],x[0]);else if(C<=u)f=a(t[L],x[1]);else{h=u/C;p=[x[0][0]+h*m[0],x[0][1]+h*m[1]];f=a(t[L],p)}if(!(f<=y)){g=L;y=f}}if(y>v){c[g]=1;o(e,t,s,g,c);o(e,t,g,l,c)}}}var s,l,c,d,p=e.length,h=[],u=t*t,f=[],g=[];f[0]=e[0];for(s=l=1,d=0;s<p;s++)if(!(a(e[s],e[d])<u)){f[l++]=e[s];d=s}d<p-1&&(f[l++]=e[p-1]);g[0]=g[l-1]=1;o(t,f,0,l-1,g);for(s=c=0;s<l;s++)g[s]&&(h[c++]=f[s]);return h}function ut(e,t,r){if(e&&!(t.length<=4)){for(var n,i,a=[],o=[],s=[],l=0,c=0,d=t.length;l<d;l+=2){a[c]=[t[l],t[l+1]];o[c]=t[l];s[c]=t[l+1];c++}r<0&&(r=0);if(void 0===r){n=Math.max.apply(null,o)-Math.min.apply(null,o);i=Math.max.apply(null,s)-Math.min.apply(null,s);r=Math.min(.1/wo,Math.max(.01*n,.01*i));if(!r)return}var p=ht(a,r);if(2*p.length!==d){var h=p.slice(1).join(" ").replace(/,/g," ");"path"===e.tagName?m(e,"d","M"+t[0]+" "+t[1]+" L"+h):"polyline"!==e.tagName&&"polygon"!==e.tagName||m(e,"points",t[0]+" "+t[1]+" "+h)}}}function ft(e){return Eo.svg.getViewBBox(e)}function gt(e,t){if(t%360==0)return"";var r=" rotate("+t+","+e.x+","+e.y+")";return 90==t?"translate("+e.height+",0)"+r:180==t?"translate("+e.width+","+e.height+")"+r:270==t?"translate(0,"+e.width+")"+r:""}function yt(e){return{x:+m(e,"x"),y:+m(e,"y"),width:+m(e,"width"),height:+m(e,"height")}}function vt(e,t){var r=ve(e),n=Le(r+(t||0));m(e,"transform",n?gt(yt(e),n):"");m(e,"c_rotation",n?360-n:0)}function xt(e){"string"==typeof e||e.tagName&&(e=m(e,"d"));return e.replace(/\,/g," ").replace(/(?=\S)([\+\-A-Z])/gi,"  $1").replace(/([A-Za-z])(?=\S)/g,"$1 ").replace(/^\s+|\s+$/g,"").split(/\s+/g)}function mt(e){for(var t,r=[],n=e.numberOfItems,i=0;i<n;i++){t=e.getItem(i);r[i]=new c(Eo.formatLengthSave(t.x),Eo.formatLengthSave(t.y))}return r}function Ct(e){var t=ms.getViewBox();return{x:t[0]+e.x/wo,y:t[1]+e.y/wo}}function Lt(e){return _t(e)}function _t(e){if(e&&e.points){var t,r,n,i,a,o,s,l,c,d,p,h,u,f,g=e.points,y=g.numberOfItems;for(i=y-2;i>=0;i--){t=g.getItem(i);r=g.getItem(i+1);Ae(t.x,r.x)&&Ae(t.y,r.y)&&(0===i?g.removeItem(i+1):g.removeItem(i))}y=g.numberOfItems;for(i=y-2;i>=1;i--){t=g.getItem(i-1);n=g.getItem(i);r=g.getItem(i+1);if(Ae(t.x,n.x)&&Ae(r.x,n.x)){o=t.x+r.x+n.x;s=Math.abs(o-3*r.x);l=Math.abs(o-3*n.x);o=Math.abs(o-3*t.x);c=Math.min(o,s,l);c==o?r.x=n.x=t.x:t.x=c==s?n.x=r.x:r.x=n.x;var v=(t.y+r.y+n.y)/3;o=Math.abs(t.y-v);s=Math.abs(r.y-v);l=Math.abs(n.y-v);c=Math.min(o,s,l);c==o?g.removeItem(i-1):c==s?g.removeItem(i+1):g.removeItem(i)}else if(Ae(t.y,n.y)&&Ae(r.y,n.y)){o=t.y+r.y+n.y;s=Math.abs(o-3*r.y);l=Math.abs(o-3*n.y);o=Math.abs(o-3*t.y);c=Math.min(o,s,l);c==o?r.y=n.y=t.y:t.y=c==s?n.y=r.y:r.y=n.y;g.removeItem(i)}else{o=Math.atan((t.y-n.y)/(t.x-n.x));s=Math.atan((r.y-n.y)/(r.x-n.x));Math.abs(o-s)<Math.PI/180&&g.removeItem(i)}}y=g.numberOfItems;for(i=3;i<y;i++){p=[g.getItem(i-1),g.getItem(i)];for(a=1;a<i-1;a++){h=[g.getItem(a-1),g.getItem(a)];d=le({x:p[0].x,y:p[0].y},{x:p[1].x,y:p[1].y},{x:h[0].x,y:h[0].y},{x:h[1].x,y:h[1].y});if(d){if(1===a&&i===y-1&&Pe(p[1],h[0]))continue;for(u=a;u<i;u++)g.removeItem(a);f=Go.createSVGPoint();f.x=d.x;f.y=d.y;g.insertItemBefore(f,a);i=2;y=g.numberOfItems;break}}}}}function Pt(e,t){var r,n,i=[],a=e.points,o=a.numberOfItems;for(n=0;n<o;n++){r=a.getItem(n);switch(t){case 1:i.push(r.x,r.y);break;case 2:i[n]=[r.x,r.y];break;default:i[n]={x:r.x,y:r.y}}}return i}function At(e){var t=Go.createSVGPoint();t.x=e.x;t.y=e.y;return t}function bt(e){if(e&&(e.length||e.tagName)){e.tagName&&(e=[e]);var t,r,n,i,a,o=e.length;for(n=0;n<o;n++){t=m(e[n],"c_origin");if(t){r=t.split(",");return{x:+r[0],y:+r[1]}}}for(n=0;n<o;n++){a=e[n];switch(a.tagName){case"polyline":case"polygon":var s=w(m(a,"points"));if(s.length>=4)return{x:+s[0],y:+s[1]};break;case"rect":case"image":return{x:+m(a,"x"),y:+m(a,"y")};case"circle":case"ellipse":return{x:+m(a,"cx"),y:+m(a,"cy")};case"line":return{x:+m(a,"x1"),y:+m(a,"y1")}}}for(n=0;n<o;n++){a=e[n];if("path"==a.tagName&&a.pathSegList.numberOfItems){i=a.pathSegList.getItem(0);if(i&&"M"==i.pathSegTypeAsLetter)return{x:Eo.formatLengthSave(i.x),y:Eo.formatLengthSave(i.y)}}}for(n=0;n<o;n++)if("text"==e[n].tagName)return{x:+m(e[n],"x"),y:+m(e[n],"y")};for(n=0;n<o;n++)if(e[n]&&e[n].children){var l=bt(p("*",e[n]));if(l)return l}}}function St(e){var t=Eo.svg.getBBox(e);return{x:t.x,y:t.y}}function Et(e){var t=Zo.canvas.originX,r=Zo.canvas.originY,n=os.getSanpSize("X"),i=os.getSanpSize("Y"),a=Math.round((e.x-t)/n)*n+t,o=Math.round((e.y-r)/i)*i+r;return{x:Eo.formatLengthSave(a),y:Eo.formatLengthSave(o)}}function Ot(e,t,r){var n=os.getSanpSize("X"),i=os.getSanpSize("Y"),a=Et(e);t>0&&a.x<e.x?a.x+=n:t<0&&a.x>e.x&&(a.x-=n);r>0&&a.y<e.y?a.y+=i:r<0&&a.y>e.y&&(a.y-=i);return a}function It(e,t,r){rs[e.tagName]&&rs[e.tagName](e,t,r)}function Tt(e,t,r){if(!e||!e.length)return!1;for(var n=0;n<e.length;n++)(rs[e[n].tagName]||M)(e[n],t,r);return!0}function Rt(e,t,r){if(e&&"text"==e.tagName&&"string"==typeof t){t.indexOf("\r")>=0&&(t=t.indexOf("\n")>=0?t.replace(/\r/g,""):t.replace(/\r/g,"\n"));void 0===r&&(r="\n");var n,i,a,o="line"==m(e,"c_shapetype")||e.parentNode&&"part_annotation"==m(e.parentNode,"c_partid");if(o){n=t.split(r);i=n.length;a=i>1}else{t=t.replace(/\n/g," ");n=[t];i=1;a=!1}var s=p("tspan",e),l=s.length,c=m(e,"x");if(a){0===l&&e.childNodes[0]&&e.removeChild(e.childNodes[0]);for(;l<i;){e.appendChild(zt("tspan",{x:c,dy:l?"1em":"0","xml:space":"preserve"}));l++}for(;l>i;){l--;s[l].parentNode.removeChild(s[l])}for(;i--;)e.childNodes[i].textContent=n[i]||" ";Ao&&a&&setTimeout(function(){for(var t=p("tspan",e),r=t.length,n=0;n<r;n++)t[n].textContent=t[n].textContent},1)}else{for(;e.lastChild;)e.removeChild(e.lastChild);Eo.node.setTextContent(e,t)}}}function wt(e){function t(e){return Eo.formatLengthSave(e)+""}if(!e)return null;var r,n=e.attributes,i=n?n.length:0,a={},o=/\d+\.\d{9,}/g,s=/^(?:points|d|x|y|width|height|cx|cy|r|rx|ry|x1|y1|x2|y2|dx|dy|transform|stroke-width|viewBox|c_origin|c_rotation)/;for(r=0;r<i;r++){var l=n[r].name;l.match(/[a-z]/)||(l=l.toLowerCase());s.test(l)?a[l]=n[r].value.replace(o,t):a[l]=n[r].value}return a}function Nt(e){if(e&&e.length){var t,r,n,i,a=ms.getViewBox(),o="getBoundingClientRect";for(t=0;t<e.length;t++){r=e[t];if(r){if(r[o]){n=r[o]();if(!n.width&&!n.height)continue;n=[a[0]+n.left/wo,a[1]+n.top/wo,a[0]+n.right/wo,a[1]+n.bottom/wo]}else{n=Eo.svg.getBBox(r);if(!n.width&&!n.height)continue;n=[n.x,n.y,n.x+n.width,n.y+n.height]}i=i?[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]:n.slice(0,4)}}if(i){return{x:i[0],y:i[1],width:i[2]-i[0],height:i[3]-i[1]}}}}function kt(t,r){if(!t)return!1;var n,i,a,o,s=[],l=e.frameElement,c=l&&l.parentNode,d=c&&"none"!=c.style.display;c&&!d&&(c.style.display="");if(t!=Ka){a=p("[c_note]",t);i=a.length;for(n=0;n<i;n++){s[n]=a[n].style.display;"none"!=s[n]&&(a[n].style.display="none")}o=Eo.svg.getBBox(t);for(n=0;n<i;n++)a[n].style.display=s[n]}else{o=Eo.svg.getBBox(t);if(!o.width&&!o.height){c=e.frameElement&&e.frameElement.parentNode;if(c){if(!(c.style&&"none"!=c.style.display)){c.style.display="";o=Eo.svg.getBBox(t);c.style.display="none"}}}if(!o.width&&!o.height){if(Eo.fileType.isLib(Is))Bt(Zo.canvas.originX,Zo.canvas.originY);else{var h=ms.getViewBox();h[0]=Zo.canvas.originX;h[1]=Zo.canvas.originY;ms.setViewBox(h)}return}}c&&!d&&(c.style.display="none");o&&(o.width||o.height)&&Mt(o,r)}function Mt(e,r){if(e&&(e.x||e.y||e.width||e.height)){!r||e.width||e.height||(r=0);var n=e.x+e.width/2,i=e.y+e.height/2,a=t.body.clientWidth||9,o=t.body.clientHeight||9,s=r?Math.min(a/e.width,o/e.height):wo,l=r&&isFinite(s)?z(99*s,"-"):100*wo,c=l/100,d=ms.getViewBox();if(l<.1){l=.1;c=l/100}else if(l>1e5){l=1e5;c=l/100}var p=c!=wo;d[0]=n-d[2]/2;d[1]=i-d[3]/2;ms.setViewBox(d);p&&sr("zoom",[l])}}function Bt(e,t){var r=ms.getViewBox();r[0]+=e-(r[0]+r[2]/2);r[1]+=t-(r[1]+r[3]/2);ms.setViewBox(r)}function Dt(e,t){var r=Nt(e);r&&Vt(r,t)}function Vt(e,t){var r=e.x,n=e.y,i=r+e.width,a=n+e.height,o=ms.getViewBox();t=isFinite(t)?t/wo:20/wo;r-=t;n-=t;i+=t;a+=t;var s,l;s=r<=o[0]==i>=o[0]+o[2]?0:r<=o[0]?r-o[0]:i-o[0]-o[2];l=n<=o[1]==a>=o[1]+o[3]?0:n<=o[1]?n-o[1]:a-o[1]-o[3];if(s||l){o[0]+=s;o[1]+=l;ms.setViewBox(o)}}function Ft(e,t){Vt({x:e.x,y:e.y,width:0,height:0},t)}function Gt(){kt(Ka,1)}function Yt(e,t,r){var n,i,a,o=m(e,"c_para")||"",s=o.split("`"),l=s.length;l%2&&(s[l-1]?s[l++]="":s.length=--l);t=t.replace(/[`\^~\\"]/gi,"");for(var c=0;c<l-1;c+=2){n=s[c];i=s[c+1];if(t==n){a=1;if(r==i)return o;s[c+1]=r;break}}a||s.push(t,r);var d=s.join("`");m(e,"c_para",d);Fo.updateOne(e);var p={},h={};p.c_para=o;h.c_para=d;zo.save(["attr",e.id,p,h]);return d}function jt(e){function t(e){var t=e.id;t?e.id="":t=Eo.newId();if(t.match(/^(frame_\w*?)([_\?\d]*)$/)){var r=RegExp.$1,n=1;"_"!=r.substr(-1)&&(r+="_");t=r+n;for(;d(t);)t=r+ ++n}else for(;d(t);)t=Eo.newId();e.id==t?t.match(/^gge(\d+)$/)&&+RegExp.$1>ko&&(ko=+RegExp.$1):e.id=t;return t}var r=t(e);[].forEach.call(p("*",e),t);return r}function Ht(e,t){for(var r,n,i,a,o=e.points,s=o.numberOfItems,l=-1,c=e.getAttribute("stroke-width"),d=c*c,p=s-1;p>=1;p--){r=function(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,p=c*c+d*d,h=((s-n)*c+(l-i)*d)/p;if(!(h>=1||h<=0)){var u=n+h*c,f=i+h*d,g=u-s,y=f-l;return{point:{x:u,y:f},d2:g*g+y*y}}}(o.getItem(p),o.getItem(p-1),t);if(r&&r.d2<=d&&(void 0===n||n>r.d2)){n=r.d2;l=p;i=r.point.x;a=r.point.y}}if(l>=1){var h=e.viewportElement.createSVGPoint();h.x=Eo.formatLengthSave(i);h.y=Eo.formatLengthSave(a);o.insertItemBefore(h,l);return!0}}function Xt(e,t){function r(e){e[0].type="M"}function n(e,t){i.updateAndSave();Fo.updateOne(e);t[3]={points:m(e,o)};if(a&&"wire"===Z(e)){junctionUtils.solveItem(e);junctionUtils.solveTodoList();zo.save(junctionUtils.batHistoryCmd(t))}else zo.save(t);zo.saveBatch()}zo.startBatch();var i=new Jt([e]),a=Eo.fileType.getAbstractFileType(Is).match(/^sch/),o="points";"path"===e.tagName&&(o="d");var s,l,c,d=e.getPathData(),p=d.length;for(c=p-1;c>0;c--)d[c].values.join("")===d[c-1].values.join("")&&d.splice(c-1,1);r(d);p=d.length;var h,u,f=-1,g=e.getAttribute("stroke-width"),v=g*g,x={};x[o]=m(e,o);var C=["attr",e.id,x];if(!(p<3)){for(c=p-1;c>=1;c--){s={x:d[c].values[0],y:d[c].values[1]};l={x:d[c-1].values[0],y:d[c-1].values[1]};h=function(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,p=c*c+d*d,h=((s-n)*c+(l-i)*d)/p;if(!(h>=1||h<=0)){var u=n+h*c,f=i+h*d,g=u-s,y=f-l;return{point:{x:u,y:f},d2:g*g+y*y}}}(s,l,t);if(h&&h.d2<=v&&(void 0===u||u>h.d2)){u=h.d2;f=c;h.point.x;h.point.y}}a&&"wire"===Z(e)&&junctionUtils.solveItem(e);if(1===f){d.splice(0,1);r(d);e.setPathData(d);n(e,C);dr(e)}else if(f===p-1){d.splice(p-1,1);r(d);e.setPathData(d);n(e,C);dr(e)}else if(f>1){var L=e.cloneNode(!0);y(e,"active");y(L,"active");L.id=Eo.newId();cr();var _=O(d).splice(f);r(_);e.setPathData(_);var P=O(d).splice(0,f);r(P);L.setPathData(P);e.parentNode&&e.parentNode.insertBefore(L,e.nextSibling);Fo.updateOne(e,{notCopper:!0});Fo.updateOne(L,{notCopper:!0});zo.save(["add",L.id,Eo.node.getRefId(L)]);n(e,C)}m(e,"net")&&Qo.buildOneNet(m(e,"net"),!1);return!0}zr([e]);zo.saveBatch()}function Ut(e,t){function r(e,r,a){function o(t,r,n,a){function o(e,t){var r=t.length-1;return t[r].x===e[0].x&&t[r].y===e[0].y}t===r&&(h=h.reverse());!function(t,r){if("begin"===t){o(r,h)&&h.pop();u=h.concat(r);i[e]=u;c=u[0]}else{o(h,r)&&h.shift();u=r.concat(h);i[e]=u;c=u[u.length-1]}}(t,n);l=!0;p.push(a);s(e,c,t)}function s(e,r,a){var s=i[e];if(s)for(var l=0;l<i.length;l++){h=JSON.parse(JSON.stringify(i[l]));if(l!==e)if(p.indexOf(e)>-1)d="";else if(!(p.indexOf(l)>-1)){if(n(h[0],r)<=t){o(a,"begin",s,l);break}if(n(h[h.length-1],r)<=t){o(a,"end",s,l);break}}}}var l,c,d,h,u=[];s(e,r,a);return u.length?u:d}function n(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}var i=e;t=t||0;if(!Array.isArray(e[0])){i=[];Array.isArray(e)||(e=[].slice.call(e));t||(t=e[0].getAttribute("stroke-width"));var a,o,s,l;e.forEach(function(e){a=e.getAttribute("points")||e.getAttribute("d");if(a){o=a.match(/\d+(\.\d+)?.*?\d+(\.\d+)?/g);l=[];o.forEach(function(e){s=e.match(/(\d+(\.\d+)?).*?(\d+(\.\d+)?)/);l.push({x:+s[1],y:+s[3]})});i.push(l)}})}var c,d=[],p=[],h=[],u=[];i.forEach(function(e,i){if(n(e[0],e[e.length-1])<=t){d.push(e);p.push(i)}else{u=[];c=r(i,e[0],"begin");c||(c=r(i,e[e.length-1],"end"));c?n(c[0],c[c.length-1])<=t?d.push(c):h.push(c):""===c||h.push(e);p.push(i)}});return{closed:d,notClosed:h}}function Jt(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(["node",e[r].id,e[r].cloneNode(!0)]);this.hist=t;this.nodes=[].slice.call(e)}function zt(e,r){var n=t.createElementNS("http://www.w3.org/2000/svg",e);r&&m(n,r);return n}function Wt(e){if(e){e='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e.trim()+"</svg>";var r=I(e);if(r){var n=t.importNode(r.documentElement,!0);return n.removeChild(n.childNodes[0])}}}function Zt(e){var t=un();if(!t.length)return!1;var r=t[0],n=m(r,"c_para")||"";if(0===n.length)return!1;e["Supplier Part"]=e["Supplier Part"]||e.LCSC;e.package=e.package||e.Package;e.Value=e.Value||e.Name;var i=r.cloneNode(!0),a=r.children,o=Eo.c_paraToJson(n);e.spicePre&&(o.spicePre=e.spicePre);e.package&&(o.package=e.package);e.Supplier&&(o.BOM_Supplier=e.Supplier);e.Manufacturer&&(o.BOM_Manufacturer=e.Manufacturer);e["Manufacturer Part"]&&(o["BOM_Manufacturer Part"]=e["Manufacturer Part"]);e["Supplier Part"]&&(o["BOM_Supplier Part"]=e["Supplier Part"]);e.Value&&(o.Value=e.Value);n=Eo.jsonToC_para(o);m(r,{c_para:n});e.pre&&(mr("pre",r).childNodes[0].textContent=e.pre);if(e.data){var s,l=e.data;for(var c in l)if(S(l,c)){s=a[l[c].id];if(s){m(s,{c_spicepin:l[c].spiceNum});Eo.node.setTextContent(s.children[0],l[c].name);Eo.node.setTextContent(s.children[1],l[c].num)}e.hiddenPin&&"4"==m(s,"c_elec")?m(s,{c_show:"none",display:"none"}):e.hiddenPin||m(s,{c_show:"show",display:""})}}var d=r.cloneNode(!0);Fo.updateOne(r);zo.save(["node",r.id,i,d])}function Kt(e){var t,r=e.target==Go,n=e.target,i=n.parentNode,a=m(i,"c_partid"),o="cdot"==m(e.target,"c_shapetype");m(n,"attach_libid")&&(n=d(m(n,"attach_libid")));if("part_pad"===a||"part_pcbtext"===a||"part_annotation"===a){n=n.parentNode;t=!0}else n=Yr(n);var s=un();if((!o&&!r&&"TEXTAREA"!=e.target.tagName&&(!n||!f(n,"selected"))||r)&&!s){sr("multiSelect",[!1]);sr("releaseActive")}!function(e){if(!e)return sr("triggerEvent",["select_change"]);Yo=e;u(Yo,"active",!0);sr("triggerEvent",["select_change"]);"line"==m(e,"c_shapetype")&&dr(e)}(n);var l,c=un();if(r){l="";if(0!==s.length){l=Z(c[0]);if(!l)return}else c="canvas"}else if(o&&"light"!=m(e.target,"class")){l="cdot";c=[e.target]}else if("part_import_frame_lib"==m(n,"c_partid"))l="sheet";else{if(!n)return;l=Z(n);if(!l)return}var p=rr(e,!1);0===c.length&&n&&"part_image"===m(n.parentNode,"c_partid")&&(c=[n]);var h={target:c,docType:Is,cmdKey:l,clientX:e.clientX,clientY:e.clientY,x:p.x,y:p.y};t&&n.parentNode!==Ka||(h.locked=m(n,"locked"));lo.contextmenuDisableOnce||sr("showEditorContextMenu",[h])}function qt(){if(e.frameElement){var r=frameElement.getAttribute("c_para");r&&m(Ka,{c_para:r});var n=frameElement.getAttribute("winzoom");if(Eo.fileType.isLib(Is)){Vr(+n,{clientX:(t.documentElement.clientWidth||9)>>1,clientY:(t.documentElement.clientHeight||9)>>1})}else Vr(+n,{clientX:0,clientY:0});m(d("gridOH"),{y1:Zo.canvas.originY,y2:Zo.canvas.originY});m(d("gridOV"),{x1:Zo.canvas.originX,x2:Zo.canvas.originX})}}function $t(e){var t,r=e.childNodes;if(r&&r.length>0)for(t=r.length-1;t>=0;t--)1==r[t].nodeType?"text"!=r[t].tagName&&"tspan"!=r[t].tagName&&$t(r[t]):e.removeChild(r[t])}function Qt(){var e=ms.getViewBox();sr("updateRuler",[{zoom:wo,unit:Zo.canvas.unit,vbX:e[0],vbY:e[1],originX:Zo.canvas.originX,originY:Zo.canvas.originY}])}function er(e){sr("updateRuler",[{clientX:e.clientX,clientY:e.clientY}])}function tr(){var e=t.body,r=t.documentElement;return{zoom:No,scrollLeft:Math.max(e.scrollLeft,r.scrollLeft),scrollTop:Math.max(e.scrollTop,r.scrollTop),scrollWidth:Math.max(e.scrollWidth,r.scrollWidth),scrollHeight:Math.max(e.scrollHeight,r.scrollHeight),clientWidth:r.clientWidth,clientHeight:r.clientHeight,width:Math.max(e.scrollWidth,r.scrollWidth),height:Math.max(e.scrollHeight,r.scrollHeight),canvasWidth:+m(Go,"width"),canvasHeight:+m(Go,"height"),viewBox:m(Go,"viewBox")}}function rr(e,t){var r=Ct({x:e.clientX,y:e.clientY}),n=r.x,i=r.y;return!0===t||!1!==t&&Zo.adsorbGrid.enabled?Et(r):{x:Eo.formatLengthSave(n),y:Eo.formatLengthSave(i)}}function nr(e){if("TEXTAREA"!=e.target.tagName&&"INPUT"!=e.target.tagName){e.preventDefault();""===Uo&&(po&&po.ready||lo.dragpanning||lo.drawing||Io&&Io.on||lo.contextmenuDisableOnce&&(lo.contextmenuDisableOnce=!1))}}function ir(e){if(!("TEXTAREA"==e.target.tagName||vo&&lo.dragpanning)){e.preventDefault();if(e.detail||e.deltaX||e.deltaY){var t,r,n,i,a=1===e.deltaMode,o=100;r=e.deltaX||e.wheelDeltaX/-3||0;n=e.deltaY||e.wheelDeltaY/-3||0;!e.detail||r||n||(n=e.detail);a&&(o=3);lo.wheelData=lo.wheelData||{x:0,y:0,lastFire:0,lastRealHandle:0};var s=lo.wheelData,l=Date.now();if(l-s.lastFire>500){s.x=0;s.y=0}s.x+=r;s.y+=n;s.lastFire;s.lastFire=l;if(!(Math.abs(s.x)<o&&Math.abs(s.y)<o)){s.lastRealHandle=l;i=Math.abs(s.x)>Math.abs(s.y);if(i){t=s.x>0;s.x+=s.x>0?-o:o;s.y=0}else{t=s.y>0;s.y+=s.y>0?-o:o;s.x=0}var c=bo.getCacheObj("ZoomWay");void 0===c&&(c="ScrollKey");"ScrollKey"===c?ar(e,i,t):or(e,i,t)}}}}function ar(e,t,r){if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||t){var n;n=t||e.shiftKey?r?[1,0]:[-1,0]:r?[0,1]:[0,-1];var i=ms.getViewBox(),a=20/wo;i[0]+=a*n[0];i[1]+=a*n[1];ms.setViewBox(i)}else if(!e.altKey)try{var o=z(No,r?"-":"+"),s=Is==ao.PCB||Is==ao.PCBMODULE;if(s&&yo.isWaiting()){var l={nextZoom:o,clientX:e.clientX,clientY:e.clientY};yo.setWaitingZoomOption(l)}else{Vr(o,{clientX:e.clientX,clientY:e.clientY});sr("setZoomText",[o+"%"])}}catch(e){}}function or(e,t,r){if(e.ctrlKey||e.altKey||e.metaKey||t)try{var n=z(No,r?"-":"+");if((Is==ao.PCB||Is==ao.PCBMODULE)&&yo.isWaiting()){var i={nextZoom:n,clientX:e.clientX,clientY:e.clientY};yo.setWaitingZoomOption(i)}else{Vr(n,{clientX:e.clientX,clientY:e.clientY});sr("setZoomText",[n+"%"])}}catch(e){}else if(e.shiftKey||!e.altKey){var a,o=t||e.shiftKey;a=o?r?[1,0]:[-1,0]:r?[0,1]:[0,-1];var s=ms.getViewBox(),l=20/wo;s[0]+=l*a[0];s[1]+=l*a[1];ms.setViewBox(s)}}function sr(t,r,n){var i=parent;if(i!=e){var a=r||[],o=[{args:a,uuid:n,func:t}];return i.callByEditor.apply(e,o)}}function lr(e,t,r){if(e||t){var n,i,a,o,s=e.length,l="x"==t?"y":"x";for(n=s-1;n>=0;n--)for(i=s-n;i>=0;i--)if(e[i]&&e[i-1]&&e[i][t]<e[i-1][t]){a=e[i];e[i]=e[i-1];e[i-1]=a;o=r[i];r[i]=r[i-1];r[i-1]=o}else if(e[i]&&e[i-1]&&e[i][t]==e[i-1][t]&&e[i][l]<e[i-1][l]){a=e[i];e[i]=e[i-1];e[i-1]=a;o=r[i];r[i]=r[i-1];r[i-1]=o}return{os:e,objs:r}}}function cr(){m(us,{visibility:"hidden"});m(gs,{visibility:"hidden"});m(ys,{visibility:"hidden"});fs&&m(fs.children[0],{visibility:"hidden"})}function dr(e){if(("pinpart"!=m(e,"c_etype")||0===m(e,"c_partid").indexOf("part_import"))&&(!m(e,"c_partid")||0===m(e,"c_partid").indexOf("part_import"))&&(!m(e,"c_partid")||0!==m(e,"c_partid").indexOf("part_import")||Is===ao.PCB)&&d(e.id)){var t=as.get(e);t.length>=2&&dn(t)}}function pr(e,t){function r(e,t){var n=Is==ao.PCB||Is==ao.PCBMODULE;if(!1===e||arguments.length<2){m(d("gMarkError"),"visibility","hidden");fr(!1)}else{m(d("gMarkError"),{cx:e,cy:t,visibility:"yes","stroke-width":1.5/wo});if(n){Ft({x:e,y:t},20);fr(e,t,{strokeWidth:"2",strokeLinecap:"square"});"#FFFFFF"!=Xn().background&&fr(e,t,{stroke:"#FFFFFF",strokeWidth:"2",strokeLinecap:"square"})}else{Bt(e,t);fr(e,t,{strokeWidth:"2",strokeLinecap:"square"})}setTimeout(r,1e3)}}t=t||{fromHotKey:!1};if(e.wires){var n=Nt(e.wires);if(!n)return;var i=ms.getViewBox();n.width>i[2]||n.height>i[3]?kt(e.wires[0]):Mt(n)}else if(e.pin){var a=e.pin.gId,o=d(a);if(o&&"pin"==Z(o)){var s=Eo.numberlistToArray(m(o,"c_origin"));r(s[0],s[1])}}else{e.labelFlag&&r(e.labelFlag.pinDot.x,e.labelFlag.pinDot.y);var l=Is==ao.PCB||Is==ao.PCBMODULE;if(l&&e.pad){var c=e.pad,h=Fo.gJsonCache.FOOTPRINT[c.fid],f=h&&h.PAD&&h.PAD[c.gId];c.number==f.number&&r(f.x,f.y)}else if(D(e)){!t.fromHotKey&&yn();!t.fromHotKey&&Gr();for(var g,y=[],C=0,L=e.length;C<L;C++){g=d(e[C]);g&&y.push(g)}t&&!1===t.scroll||Dt(y);for(C=0,L=y.length;C<L;C++){g=y[C];if(g){var _=t.fromHotKey?"selected-h":"selected";u(g,_,!0);if(!l){var P=x(g),A=p('[c_partid="part_annotation"]',P);for(C=0;C<A.length;C++)v(A[C]);var b=Eo.svg.getBBoxFixed(P,{excludeText:!1});r(b.x+b.width/2,b.y+b.height/2)}}}sr("triggerEvent",["select_change"])}}}function hr(){for(var e,r=d("gCursors").childNodes,n=r.length,i=0;i<n;i++)(e=r[i].id)&&(Wo[e]={trs:m(r[i],"transform")||"",width:m(r[i],"width"),height:m(r[i],"height")});t.addEventListener("mousemove",gr,!1)}function ur(e,t,r){var n=/^(grab|grabbing|row-resize|col-resize)$/;Jo&&("cross-red"==Jo?fr(!1):n.test(Jo)?y(Go,"cursor-"+Jo):m(d(Jo),{display:"none"}));if(e&&n.test(e)){g(Go,"cursor-"+e);Jo=e}else{var i=!1;if(e&&Wo[e])if("cross-red"==e)if(!1===sr("getCrossCursor")){fr(!1);i=!0}else if(arguments.length>=3){fr(t,r);i=!0}else if(Jo&&!0===t)fr(!1);else{fr(!1);i=!0}else if(arguments.length>=3)m(d(e),{x:t,y:r,display:""});else if(Jo&&!0===t)m(d(e),{display:""});else{m(d(e),{x:-1e5,y:-1e5,display:""});i=!0}else i=!0;u(Go,"cursor-none",!i);Jo=e||""}}function fr(e,t,r){if(!1===e||isFinite(e)&&isFinite(t)){var n=d("cross-x-big"),i=d("cross-y-big");if(!1!==e&&!1!==sr("getCrossCursor")){var a=ms.getViewBox(),o=1/wo,s=o/2,l=e%o,c=t%o;e=e-l+s;t=t-c+s;e=Math.round(1e6*e)/1e6;t=Math.round(1e6*t)/1e6;m(n,"d","M"+e+" "+a[1]+" v"+a[3]);m(i,"d","M"+a[0]+" "+t+" h"+a[2]);if(r&&r.stroke){m(n,"stroke",r.stroke);m(i,"stroke",r.stroke)}else{m(n,"stroke","red");m(i,"stroke","red")}if(r&&r.strokeWidth){m(n,"stroke-width",r.strokeWidth);m(i,"stroke-width",r.strokeWidth);m(n,"stroke-dasharray",2*r.strokeWidth+","+2*r.strokeWidth);m(i,"stroke-dasharray",2*r.strokeWidth+","+2*r.strokeWidth);if(r.strokeLinecap){n.style.strokeLinecap=r.strokeLinecap;i.style.strokeLinecap=r.strokeLinecap}}else{m(n,"stroke-width","1");m(i,"stroke-width","1");m(n,"stroke-dasharray","2, 2");m(i,"stroke-dasharray","2, 2");n.style.strokeLinecap="round";i.style.strokeLinecap="round"}}else{m(n,"d","M0 0");m(i,"d","M0 0")}}}function gr(e){if(Jo)if(e.target!=t.documentElement&&e.target!=t.body||_o){var r,n;if(!Zo.adsorbGrid.enabled&&Cs.forcedPixelSnap){r=Eo.extend({},Zo.adsorbGrid);Eo.extend(Zo.adsorbGrid,{distanceX:1,distanceY:1,enabled:!0});n=function(){Eo.extend(Zo.adsorbGrid,r)}}var i,a;if(Zo.adsorbGrid.enabled&&"cursor-hand"!=Jo&&"cursor-grab"!=Jo&&"cursor-freedraw"!=Jo){os.altKeyEnabled=e.altKey;var o=Et(rr(e));i=o.x;a=o.y}else{var s=rr(e,!1);i=s.x;a=s.y}"cross-red"==Jo?fr(i,a):m(d(Jo),{x:i,y:a,display:""});n&&n()}else"cross-red"==Jo?fr(!1):m(d(Jo),{display:"none"})}function yr(e,t,r){var n,i,a;if(e){n="string"==typeof e?d(e):e;if(3==arguments.length){m(n,{display:""});i=m(n,"c_origin");a=i?i.split(","):[0,0];rs.g(n,t-a[0],r-a[1]);m(n,{c_origin:t+","+r,display:""})}else m(n,{display:"none"})}}function vr(e){var t=[];e=e||un();for(var r=0,n=e.length;r<n;r++)t.push(e[r].id);return t.join(",")}function xr(e,t){var r=h('[c_etype="outline3D"]',e);t||(t=Eo.svg.getPlainBBox(e));if(r)m(r,t);else{r=zt("g",{c_width:t.width,c_height:t.height,c_rotation:0,c_etype:"outline3D",layerid:m(e,"layerid")==io.TOPLAYER?io.TOPSILKLAYER:io.BOTTOMSILKLAYER});var n=zt("polyline",{"stroke-width":.2,fill:"none",c_shapetype:"line",points:[t.x,t.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height].join(" ")});jt(n);r.appendChild(n);jt(r);e.appendChild(r)}Fo.updateOne(e)}function mr(e,t){var r="name"==e?"note_name":"note_pre",n=t.querySelector("[c_note="+r+"]");if(!n){var i=t.firstElementChild&&f(t.firstElementChild,"hitbox")?t.firstElementChild:null,a=i?i.nextElementSibling:t.firstElementChild,o=Eo.svg.getBBox(t),s=null;if(oo[Is].match(/^PCB/)){s=zt("g",{c_partid:"part_pcbtext",id:Eo.newId(),c_origin:o.x+o.width/2+","+("note_name"===r?o.y-10:o.y-5),layerid:io.TOPSILKLAYER,display:"none"});n=zt("path",{c_note:r,c_fontSize:"4.5",c_text:" ",fill:"none","text-anchor":"start","stroke-width":"0.7",d:"M0,0"});s.appendChild(n);t.insertBefore(s,a||null)}else{s=zt("g",{c_partid:"part_annotation",id:Eo.newId()});n=zt("text",{c_note:r,"font-family":"Arial","font-size":"7pt",fill:"#000080","text-anchor":"start",x:o.x+o.width/2,y:"note_name"===r?o.y-10:o.y-5});s.appendChild(n);t.insertBefore(s,a||null);"name"==e?resetPositionOfPreAndName(null,n):resetPositionOfPreAndName(n,null)}}return n.parentNode}function Cr(e,t,r){var n=mr("pre",e),i=mr("name",e);if("schlib"===r){t.pre&&("string"==typeof t.pre?h("text",n).textContent=j(t.pre):n.parentNode.replaceChild(t.pre,n));t.name&&("string"==typeof t.name?h("text",i).textContent=j(t.name):i.parentNode.replaceChild(t.name,i))}else if("pcblib"===r){t.pre&&("string"==typeof t.pre?m(n.firstChild,{c_text:j(t.pre),d:sr("getFontPath",[{fontFamily:m(n.firstChild,"c_fontFamily"),c_fontSize:m(n.firstChild,"c_fontSize"),degree:m(n,"c_rotation"),mirror:m(n,"c_mirror"),text:j(t.pre),x:m(n,"c_origin").split(",")[0],y:m(n,"c_origin").split(",")[1]}])}):n.parentNode.replaceChild(t.pre,n));t.name&&("string"==typeof t.name?m(i.firstChild,{c_text:j(t.name),d:sr("getFontPath",[{fontFamily:m(i.firstChild,"c_fontFamily"),c_fontSize:m(i.firstChild,"c_fontSize"),degree:m(i,"c_rotation"),mirror:m(i,"c_mirror"),text:j(t.name),x:m(i,"c_origin").split(",")[0],y:m(i,"c_origin").split(",")[1]}])}):i.parentNode.replaceChild(t.name,i))}}function Lr(e){if(!e){if(!Yo)return;e=Yo}var r,n=function(e){if(e==t)return null;for(;e&&e.parentNode;){if(e.parentNode==Ka||"g"===e.tagName)return e;e=e.parentNode}return null}(e),i="cdot"==m(e,"c_shapetype"),a=!n&&(e==Go||"bodyPlaceholder"===e.id);r=i&&"light"!=m(e,"class")?"cdot":"part_import_frame_lib"==m(n,"c_partid")?"sheet":Z(n);sr("showAttrDialog",[{cmdKey:r,docType:Is,targetId:a?"canvas":e.id}])}function _r(e){return e==ao.SCH||e==ao.SUBCKT}function Pr(e){function t(e,t){t.forEach(function(t){e.push(t)})}function r(e,t){var r=Z(e),n=m(e,"c_rotation");if("FOOTPRINT"===r||"schlib"===r){n&&on([e],360- -1*n);on([e],Le(360-parseInt(t,10)))}else{n&&sn([e],360- -1*n);sn([e],1*t)}}var n,i,a,o=un(),s=[],l=[],c=[],d=0,p=0,u=0;if(o.length){zo.startBatch();o.forEach(function(e){var t=Z(e);"FOOTPRINT"===t?s.push(e):"PAD"===t?l.push(e):c.push(e)});s.forEach(function(e,t){s[t]={ele:e,pre:m(h('[c_note="note_pre"]',mr("pre",e)),"c_text")}});s=P(s,"pre");s.forEach(function(e,t){s[t]=e.ele});l.forEach(function(e,t){l[t]={ele:e,number:m(e,"number")}});l=P(l,"number");l.forEach(function(e,t){l[t]=e.ele});o=[];t(o,s);t(o,l);t(o,c);var f,g;if("matrix"===e["distribute-type"])o.forEach(function(t){f=t.cloneNode(!0);e.rotation&&r(t,e.rotation);g=m(t,"c_origin");if(g){n={};g=g.split(",");n.centerX=g[0];n.centerY=g[1]}else{n=Eo.svg.getPlainBBox(t);n.centerX=n.x+n.width/2;n.centery=n.y+n.height/2}i=1*e["start-x"]+e["distance-x"]*d;a=1*e["start-y"]+e["distance-y"]*p;Ur([t],i-n.centerX,a-n.centerY,{notHistory:!0});if("row"===e["distribute-by"]){d++;if(d>=e["per-count"]){d=0;p++}}if("column"===e["distribute-by"]){p++;if(p>=e["per-count"]){p=0;d++}}Fo.updateOne(t,{noText:!0,notCopper:!0});zo.save(["node",t.id,f,t.cloneNode(!0)])});else if("circular"===e["distribute-type"]){var y=0,v=e.radius,x=0;e["start-degree"]=1*e["start-degree"]+90;o.forEach(function(t){f=t.cloneNode(!0);(e.rotation||"yes"===e["r-to-match"])&&r(t,e.rotation);g=m(t,"c_origin");if(g){n={};g=g.split(",");n.centerX=1*g[0];n.centerY=1*g[1]}else{n=Eo.svg.getPlainBBox(t);n.centerX=n.x+n.width/2;n.centery=n.y+n.height/2}y=u*e.spacing%360;x="anti-clockwise"===e.deretion?e["start-degree"]+y:e["start-degree"]-y;i=Math.sin(x*Math.PI/180)*v+1*e["center-x"];a=Math.cos(x*Math.PI/180)*v+1*e["center-y"];Ur([t],i-n.centerX,a-n.centerY,{notHistory:!0});"yes"===e["r-to-match"]&&("anti-clockwise"===e.deretion?on([t],-(90+y)):on([t],90+y));Fo.updateOne(t);zo.save(["node",t.id,f,t.cloneNode(!0)]);u++})}zo.saveBatch()}}function Ar(e){function t(e,t,r,n,i){var a=!!i;try{n===(i?"different":"same")?String(e).match(new RegExp(t,r))&&(a=!i):String(e).match(new RegExp(t,r))||(a=!i)}catch(e){}return a}function r(e,r){var n,i,a,o,s=!0,l=/\/.*?\/g?i?/;for(n in e)if(S(e,n)){i=e[n].val.match(l);if(i){a=e[n].val.split("/")[1];o=e[n].val.split("/")[2]}if("same"===e[n].type&&!S(r,n)&&!e[n].val)continue;if("any"===e[n].type)continue;if("same"===e[n].type){if(i){s=t(r[n],a,o,e[n].type,!0);if(!s)continue}else if(e[n].val!=String(r[n]).toUpperCase()){s=!1;continue}}else if("different"===e[n].type)if(i){s=t(r[n],a,o,e[n].type,!0);if(!s)continue}else if(e[n].val==String(r[n]).toUpperCase()){s=!1;continue}}return s}function n(t){var n,i,a=[],o=!0,s=!0;if(t)for(var l in t)if(S(t,l)){n=d(l);i=Aa(n);i.c_para&&(i.c_para=Eo.c_paraToJson(i.c_para));o=r(e.attr,i);S(e,"custom")&&(s=r(e.custom,i.c_para));if(o&&s){u(n,"selected",!0);a.push(n)}}return a}Gr();var i,a=O(Fo.gJsonCache);if(a.schlib)for(i in a.schlib)if(S(a.schlib,i)&&i.match(/frame_lib_/)){a.sheet||(a.sheet={});a.sheet[i]=a.schlib[i];delete a.schlib[i]}n(a[e.head.type]);"netlabel"===e.head.type&&n(a.netflag);var o,s,l;if(("prefix"===e.head.type||"name"===e.head.type||"package"===e.head.type)&&a.schlib)for(i in a.schlib)if(S(a.schlib,i)&&a.schlib[i].annotation){o=a.schlib[i].annotation;for(s in o)if(S(o,s)){l=m(d(s).querySelector("text[c_note]"),"c_note");if("prefix"===e.head.type&&"note_pre"===l||"name"===e.head.type&&"note_name"===l||"package"===e.head.type&&"note_package"===l)continue;delete o[s]}n(o)}if(("PREFIX"===e.head.type||"NAME"===e.head.type||"PAD"===e.head.type)&&a.FOOTPRINT)for(i in a.FOOTPRINT)if(S(a.FOOTPRINT,i)&&(a.FOOTPRINT[i].PAD||a.FOOTPRINT[i].TEXT))if("PAD"===e.head.type)n(a.FOOTPRINT[i].PAD);else{o=a.FOOTPRINT[i].TEXT;for(s in o)if(S(o,s)){l=m(d(s).querySelector("path[c_note]"),"c_note");if("PREFIX"===e.head.type&&"note_pre"===l||"NAME"===e.head.type&&"note_name"===l)continue;delete o[s]}n(o)}sr("triggerEvent",["select_change","multiSelect"])}function br(){for(var e="S$"+ ++ko;Ka&&Ka.querySelector('[net="'+e+'"]');)e="S$"+ ++ko;return e}function Sr(e){function t(e){e=p?Eo.units.convert(+e,"pixel",p):+e;e=Eo.formatLengthShow(e);return p?e+p:e}var r;r=Eo.fileType.getAbstractFileType(Is).match(/^pcb/)?3:6;if("mousemove"==e.type||"mouseup"==e.type){var n=rr(e,!1);if(Is!=ao.WAVEFORM){var i=e.target,a=Zo.canvas,o=Sr.data;o.clientX=e.clientX;o.clientY=e.clientY;if(null===o.lastUpX){o.lastUpX=a.originX;o.lastUpY=a.originY}var s=n.x,l=n.y,c=s-o.lastUpX,d=l-o.lastUpY;if("mouseup"==e.type&&(i==Go||i==Ka||Ka.contains(i))){o.lastUpX=s;o.lastUpY=l;o.uplock=!0;o.clientX>0&&o.clientY>0&&o.clientX<e.view.innerWidth&&o.clientY<e.view.innerHeight&&(o.uplock=!1)}var p="pixel"!=a.unit&&a.unit||"",h={x:s,y:l};h=Et(h);h.x-=a.originX;h.y-=a.originY;h.x=t(h.x);h.y=t(h.y);o.uplock&&"mousemove"==e.type&&(Math.abs(c)*wo>r||Math.abs(d)*wo>r)&&(o.uplock=!1);if(!o.uplock){h.dx=t(c);h.dy=t(d)}o.currAbsX=h.absX=n.x;o.currAbsY=h.absY=n.y;sr("updateMouseXY",[h])}else waveFormMgr.updateMessageBarInfo(n)}}function Er(e){if(!(e instanceof SVGPathElement))return!1;for(var t,r,n,i,a,o,s,l,c,d=e.getPathData(),p=d.length,h=[],u=!1,f=0;f<p;f++){t=d[f];i=t.type;o=t.values;if("M"==i||"L"==i){n=o[0]+"_"+o[1];-1==h.indexOf(n)&&h.push(n)
}else if("A"==i){u=!0;r=0===f?{}:d[f-1];a=r.type;s=r.values;l=null;c=null;if("M"==a||"L"==a){l=s[0];c=s[1]}else if("A"==a){l=s[5];c=s[6]}if(l==o[5]&&c==o[6])return!1}}var g,y,v,x,m,C,L,_=!0;if(h.length<3&&!u)return!1;if(h.length>=3){g=h[0].split("_")[0];y=h[0].split("_")[1];v=h[1].split("_")[0];x=h[1].split("_")[1];for(f=2;f<h.length;f++){L=h[f].split("_");m=L[0];C=L[1];if(!_e((g-v)*(C-x),(m-v)*(y-x))){_=!1;break}}if(_)return!1}var P,A,b,S,E,O,I,T,R;if("Z"!=d[p-1].type.toUpperCase()){P=d[0];A=P.values;E=d[p-1];O=E.type;I=E.values;b=A[0];S=A[1];if("M"==O||"L"==O){T=I[0];R=I[1]}else if("A"==O){T=I[5];R=I[6]}if(b==T&&S==R){e.pathSegList.appendItem(new SVGPathSegClosePath(void 0));return!0}return!1}return!0}function Or(e){function t(e){var t=Aa(e);t.groupAttr=!0;return t}if(!e||e.length<2)return!1;var r=t(e[0]);if(!r)return!1;r.c_para&&(r.c_para=Eo.c_paraToJson(r.c_para));for(var n=1,i=e.length;n<i;n++){W(r,t(e[n]))}r["attr-selected-count"]=e.length;return r}function Ir(e){var t=un();if(t.length){var r,n,i;zo.startBatch();t.forEach(function(t){i=Z(t);if("schlib"===i||"FOOTPRINT"===i){var a=mr("pre",t),o=Eo.svg.getPlainBBox(t),s=e;o.centerX=o.x+o.width/2;o.centerY=o.y+o.height/2;var l=Eo.svg.getBBox(a);l.centerX=l.x+l.width/2;l.centerY=l.y+l.height/2;parseFloat(m(a.firstChild,"c_fontSize")||m(a.firstChild,"font-size")||"7");r=o.centerX-l.centerX;n=o.centerY-l.centerY;m(t,"layerid")==io.BOTTOMLAYER&&("left"===s?s="right":"right"===s&&(s="left"));"top"===s?n+=-1*(o.height/2+l.height/2+3):"left"===s?r+=-1*(o.width/2+l.width/2+3):"bottom"===s?n=n+o.height/2+l.height/2+3:"right"===s&&(r=r+o.width/2+l.width/2+3);It(a,r,n);Fo.updateOne(t);zo.save(["move",a.id,r,n])}});zo.saveBatch();sr("setTabUnsaved")}}function Tr(e,t){for(var r in e){var n=e[r],i=t[r];if(i)for(var a=0;a<i.length;a++){var o=d(i[a].gid);o&&m(o,"c_issystemlib",n.isSystemLib)}}}function Rr(e,r){var n=t.getElementById(e);if(!n)return!1;var i=r,a=n.cloneNode(!0);Fo.updateOne(n);zo.save(["node",n.id,i,a])}function wr(e){if(Uo!=e&&!(uo&&uo.start||fo&&fo.start||go&&go.start)){""!==Uo&&Mr();if(e){sr("releaseActive");sr("triggerEvent",["select_change"]);a("dragMoveSwitch",[!1]);Nr(e);Cs.ready()}}}function Nr(e){return""===Uo?Uo=e:Uo}function kr(){sr("endToolbarCmd",[Uo]);Uo="";Cs.target=null}function Mr(){if(""!==Uo){Cs.end();Uo="";Cs.target=null}}function Br(e){if("mousedown"==e.type){sr("hideMenuOnMouseDown");sr("triggerPanelChange");zo.lastMergeSource=""}if(""===Uo&&!(uo&&uo.start||fo&&fo.start||go&&go.start||ia&&ia.instance.start)){var r=e.target,n=e.type,i=e.button,o=i===ro,s=i===no,l=vo?e.metaKey:e.ctrlKey,c=rr(e,!1),h=Ls.getActiveLayer();if(Go.contains(r)){var g,y,v=Yr(r);m(r,"attach_libid")&&(v=d(m(r,"attach_libid")));var x=v,C="cdot"==m(r,"c_shapetype");if(!x&&C){if("mousedown"==e.type&&!l&&o){uo.mdown(e);return}x=Yo}!x&&Oo&&Oo.target&&(x=Oo.target);var L=x&&x.parentNode&&"part_plane"===m(x.parentNode,"c_partid");L&&m(x.parentNode,"layerid")!=h&&(x=null);if(x&&"mouseover"==n){if(!v)return;if(Oo){u(Oo.target,"hover",!1);Oo=null}if(Dr._on){Dr._on=0;t.removeEventListener("mousemove",Dr,!1)}var _=Is==ao.PCB&&Ka.contains(r)&&function(e){var t=e.parentNode,r=t&&t.parentNode;return r&&r.parentNode==Ka&&"part_pad"==m(t,"c_partid")}(r);f(x,"active")||u(x,"hover",!_);var P=Z(r.parentNode);Is!=ao.PCB&&Is!=ao.PCBLIB||!Ka.contains(r)||"FOOTPRINT"===P||Cn(r);"path"==r.tagName&&null!==m(r,"c_text")&&"TEXT"==Z(r.parentNode)&&(r.nextElementSibling||Ln(r.parentNode))}else if("mouseout"==n){var A=e.relatedTarget||e.toElement,b=e.target||e.fromElement;m(r,"attach_libid")&&u(d(m(r,"attach_libid")),"hover",!1);if(L&&m(e.target,"layerid")!=h)return;var E=m(b,"copper_id");E&&(b=d(E));if(A&&"cdot"==m(A,"c_shapetype")){if(Oo){u(Oo.target,"hover",!1);Oo=null}if(Dr._on){Dr._on=0;t.removeEventListener("mousemove",Dr,!1)}}else if(b&&Ka.contains(b)){x=Yr(b);if(x){Oo={x:c.x,y:c.y,target:x,evtTarget:b};if(!Dr._on){Dr._on=1;t.addEventListener("mousemove",Dr,!1)}}}}else if(x||"mousedown"!=n||l||!o){if(x&&"mousedown"==n&&!l&&o){var O=m(x,"c_shapetype"),I=r==Go?x:r;if("group"==O&&I.parentNode!=Ka){y=I.parentNode;g=Z(y);if("TEXT"==g||"VIA"==g){if(Yo!=y){if(Yo){u(Yo,"active",!1);u(Yo,"selected",!1);"line"==m(Yo,"c_shapetype")&&cr()}Yo=y;u(Yo,"active",!0);sr("triggerEvent",["select_change"])}return}}if((x==Yo||f(x,"selected"))&&1!==un().length)return;yn();(!Yo||Yo!=x&&"cdot"!=O)&&(Yo=x);u(Yo,"active",!0);"line"==O?dr(x):Fo.gJsonCache.DIMENSION&&S(Fo.gJsonCache.DIMENSION,m(x,"id"))?dr(x):Fo.gJsonCache.PROTRACTOR&&S(Fo.gJsonCache.PROTRACTOR,m(x,"id"))?dr(x):"group"==O&&0===m(x,"c_partid").indexOf("part_import")?dr(x):"group"==O&&cr();"cdot"!=O&&sr("triggerEvent",["select_change"])}else if(x&&"mousedown"==n&&l&&o){if(Yo){u(Yo,"active",!1);u(Yo,"selected",!0);Yo=null;cr()}if(Is==ao.PCB){y=r.parentNode;!v&&Oo&&(y=Oo.evtTarget.parentNode);g=Z(y);if("PAD"!=g&&"TEXT"!=g||y.parentNode.parentNode!=Ka)u(x,"selected");else{u(x,"selected",!1);u(y,"selected")}}else u(x,"selected");var T=p(".selected .selected",Ka).toArray();T.forEach(function(e){u(e,"selected",!1)});sr("triggerEvent",["select_change"])}else if(x&&"mouseup"==n&&!l&&o){if(Io.on&&!Io.bind){a("dragMoveCheck",[e,[x]]);return}if(Is==ao.PCB||Is==ao.PCBMODULE){var R;y=r.parentNode;!v&&Oo&&(y=Oo.evtTarget.parentNode);g=Z(y);"PAD"==g?R="gPad":"TEXT"==g&&y.parentNode.parentNode==Ka&&(R="gPre");if(R){Gr();u(y,"active",!0);Yo=y;y.parentNode!=Ka&&sr("noneselected")}}sr("triggerEvent",["select_change"])}else if("mousedown"==n&&s)Io.on&&(lo.contextmenuDisableOnce=!0);else if("mouseup"==n&&!l&&s){if(Io.on){lo.contextmenuDisableOnce=!0;Io.bind||a("dragMoveSwitch",[!1]);return}if(lo.dragpanning)return;if(Uo)return;if(moveRelatively.started)return moveRelatively.end();if(ps.started||$r.fn.on)return;Kt(e,e.target)}}else{if(Yo){Gr();sr("triggerEvent",["select_change"])}else yn()>0&&sr("triggerEvent",["select_change"]);go.e.mdown(e)}}}}function Dr(e){if(Oo){var r=rr(e,!1);if(Math.pow((r.x-Oo.x)*wo,2)+Math.pow((r.y-Oo.y)*wo,2)>81){f(Oo.target,"active")||u(Oo.target,"hover",!1);if(Dr._on){Dr._on=0;t.removeEventListener("mousemove",Dr,!1)}Oo=null}else{Is==ao.PCB&&Ka.contains(Oo.evtTarget)&&function(e){var t=e.parentNode,r=t&&t.parentNode;return r&&r.parentNode==Ka&&"part_pad"==m(t,"c_partid")}(Oo.evtTarget)||f(Oo.target,"active")||u(Oo.target,"hover",!0)}}}function Vr(t,r){t=+t;if(!(!t||t<.1||t>1e5)){t=function(e){var t=e+"",r=t.match(/[1-9]\.?\d/);if(!r)return e;var n=t.indexOf(r[0])+r[0].length;t=t.substr(0,n)+t.substr(n).replace(/[1-9]/g,"0");return+t}(t);var n=wo,i=t>No?1:t<No?-1:0;No=t;wo=t/100;var a,o,s=Eo.toFixed(100/t+1e-5,5),l=m(Go,"viewBox").split(" ").map(parseFloat),c=+m(Go,"width"),d=+m(Go,"height");if(r&&S(r,"clientX")&&!r.uplock){var p=1/n-1/wo;o=[l[0]+r.clientX*p,l[1]+r.clientY*p,c/wo,d/wo]}else{a={x:l[0]+l[2]/2,y:l[1]+l[3]/2};o=[a.x-c/wo/2,a.y-d/wo/2,c/wo,d/wo]}e.frameElement&&e.frameElement.setAttribute("winzoom",t);yo.init({vb:o,px1:s,gZoomOld:n,zoomTowards:i});yo.runTask()}}function Fr(){for(var e=un(),t=!1,r=0,n=e.length;r<n;r++)if("FOOTPRINT"!=Z(e[r])){t=!0;break}return{showRealTimeNetLength:bo.getCacheObj("showRealTimeNetLength"),newModified:!0,canUndo:zo.canUndo(),canRedo:zo.canRedo(),selected:e.length>0,selectedObjs:e,canPaste:gClipboard.childNodes.length>0,canFlip:t,zoom:No,toolbars:"",visible_grid:Zo.adsorbGrid.visible,snap_grid:Zo.adsorbGrid.enabled,pcbNetTextVisible:!1!==lo.pcbNetTextVisible}}function Gr(e){if(Yo){u(Yo,"active",!1);Yo=null;cr()}for(var t=p("#g1>.hover"),r=t.length-1;r>=0;r--)u(t[r],"hover",!1);yn(e)}function Yr(e){var r;if(e==t)return null;for(;e&&e.parentNode;){if(e.parentNode==Ka)return e;r=m(e,"copper_id");e=r?d(r):e.parentNode}return null}function jr(){var e,t,r,n,i=[],a=Fo.gJsonCache.FOOTPRINT,o=Fo.gJsonCache.preference.hideFootprints||[];for(var s in a)if(S(a,s)){e="";r=!1;for(var l in a[s].TEXT)if(S(a[s].TEXT,l)){t=a[s].TEXT[l]||{};if("P"==t.type){e=t.text||"NO";continue}"N"==t.type&&(n=t.text||"NO")}for(var c=0;c<o.length;c++)if(o[c]==s){r=!0;break}i.push({pre:e,label:V(e+(n?" ("+n+")":"")),hide:r,gId:s})}return i}function Hr(e,t,r,n){function i(e,t){if(!1===e||arguments.length<2){m(d("gMarkError"),"visibility","hidden");fr(!1)}else{Ft({x:e,y:t},20);m(d("gMarkError"),{cx:e,cy:t,visibility:"yes","stroke-width":1.5/wo});fr(e,t,{strokeWidth:"2",strokeLinecap:"square"});"#FFFFFF"!=Xn().background&&fr(e,t,{stroke:"#FFFFFF",strokeWidth:"2",strokeLinecap:"square"});setTimeout(i,1e3)}}if(e&&"string"==typeof e){if(!t){t="prefix";r=Ka;n=0}var a,o;if("prefix"==t){var s=p('#g1>g>g path[c_note="note_pre"]',r),l=s;for(c=0;c<s.length;c++)s[c].parentNode.parentNode.id==n&&(l=s.slice(c+1));for(var c=0;c<l.length;c++){o=m(l[c],"c_text");if(V(o||"").toUpperCase()==V(e||"").toUpperCase()){a=l[c].parentNode.parentNode;break}}}else if("name"==t){var h=p('#g1>g>g path[c_note="note_name"]',r),f=h;for(c=0;c<h.length;c++)h[c].parentNode.parentNode.id==n&&(f=h.slice(c+1));for(c=0;c<f.length;c++){o=m(f[c],"c_text");if(V(o||"").toUpperCase()==V(e||"").toUpperCase()){a=f[c].parentNode.parentNode;break}}}else if("package"==t){var g=p("#g1>g",r),y=g;for(c=0;c<g.length;c++)g[c].id==n&&(y=g.slice(c+1));var C;for(c=0;c<y.length;c++){C=Eo.c_paraToJson(m(y[c],"c_para"));if(C&&V(C.package||"").toUpperCase()==V(e||"").toUpperCase()){a=y[c];break}}}if(!a)return null;yn();u(a,"selected",!0);kt(a);var L=x(a),_=p('[c_partid="part_pcbtext"]',L);for(c=0;c<_.length;c++)v(_[c]);var P=Eo.svg.getBBoxFixed(L,{excludeText:!1});i(P.x+P.width/2,P.y+P.height/2);sr("triggerEvent",["select_change"]);return a}}function Xr(e,t){if(!(uo&&uo.start||fo&&fo.start||go&&go.start)){var r,n,i=Math.max(.01,Math.round(10/wo)/10),a=os.getSanpSize("X"),o=os.getSanpSize("Y"),s=un().filter(function(e){return!ss.isLocked(e)});!s.length&&Yo&&(s=[Yo]);for(var l=0,c=s.length;l<c;l++){s[l]&&s[l].parentNode!=Ka&&"PAD"==Z(s[l])&&(s[l]=s[l].parentNode);if(s[l]&&s[l].parentNode!=Ka&&"TEXT"==Z(s[l])){var d=Yr(s[l]);ss.isLocked(d)&&s.splice(l,1)}if("TEXT"==Z(s[l])){(h('path[c_note="note_pre"]',s[l])||h('path[c_note="note_name"]',s[l]))&&m(s[l],"oldOrigin",m(s[l],"c_origin"))}}s=s.filter(function(e){return!ss.isLocked(e)});var u=Zo.adsorbGrid.enabled&&bt(s),f=u&&Ot(u,e,t);if(u&&f){r=f.x-u.x;n=f.y-u.y}if(!r&&!n){r=e*(Zo.adsorbGrid.enabled?a:i);n=t*(Zo.adsorbGrid.enabled?o:i)}r=+Eo.toFixed(r,4);n=+Eo.toFixed(n,4);if((r||n)&&!1!==Tt(s,r,n)){for(l=0;l<s.length;l++)if("TEXT"==Z(s[l])){var g=p("path[c_note=note_pre]",s[l]),y=p("path[c_note=note_name]",s[l]);if(g.length>0||y.length>0){var v=xa(g,"oldOrigin","pre"),x=xa(y,"oldOrigin","name");if(v||x){s.splice(l,1);parent.$.messager.show({title:"Warning",width:"400",msg:"The prefix or name or text too far away from the footprint, if you don't want it to show up please make it hidden.",timeout:5e3,showType:"slide"})}}}Is!=ao.PCB&&Is!=ao.PCBLIB||Fo.updateMore(s,{notCopper:!0});Is==ao.PCB&&Qo.buildRatLinesOfPCBLib(s);zo.save(["move",vr(s),r,n]);Yo&&dr(Yo);return!0}return!1}}function Ur(e,t,r,n){if("number"==typeof arguments[0]){r=arguments[1];t=arguments[0];e=un()}else e=e?[].map.call(e,function(e){return"string"==typeof e?d(e):e.gId?d(e.gId):e}):un();isFinite(t)||(t=0);isFinite(r)||(r=0);for(var i=0,a=e.length;i<a;i++)e[i]&&e[i].parentNode!=Ka&&"PAD"==Z(e[i])&&(e[i]=e[i].parentNode);e=e.filter(si);if(e&&e.length){var o=[].map.call(e,function(e){return e.id||""}).join(",");if(!1!==Tt(e,t,r)){Is!=ao.PCB&&Is!=ao.PCBLIB||Fo.updateMore(e,n.notCopper);Is==ao.PCB&&Qo.buildRatLinesOfPCBLib(e);n&&!n.notHistory&&zo.save(["move",o,t,r]);Yo&&dr(Yo);sr("buildCopper");return!0}return!1}}function Jr(e,t,r){if("number"==typeof arguments[0]){r=arguments[1];t=arguments[0];e=un()}else e=e?[].map.call(e,function(e){return"string"==typeof e?d(e):e.gId?d(e.gId):e}):un();for(var n=0,i=e.length;n<i;n++)e[n]&&e[n].parentNode!=Ka&&"PAD"==Z(e[n])&&(e[n]=e[n].parentNode);e=e.filter(si);if(e&&e.length){zo.startBatch();var a=isFinite(t),o=isFinite(r);for(n=0,i=e.length;n<i;n++){var s=e[n],l=s&&s.id,c=s&&Z(s),p=0,h=0;if(l){var u=Fo.gJsonCache[c]&&Fo.gJsonCache[c][l];switch(c){case"PAD":case"VIA":case"HOLE":if(u){a&&(p=t-u.x);o&&(h=r-u.y)}break;case"CIRCLE":if(u){a&&(p=t-u.cx);o&&(h=r-u.cy)}break;case"FOOTPRINT":if(u&&u.head){a&&(p=t-u.head.x);o&&(h=r-u.head.y)}break;default:var f=Eo.svg.getBBox(s);a&&(p=t-(f.x+f.width/2));o&&(h=r-(f.y+f.height/2))}Ur([s],p,h)}}zo.saveBatch();Is!=ao.PCB&&Is!=ao.PCBLIB||Fo.updateMore(e);Is==ao.PCB&&Qo.buildRatLinesOfPCBLib(e);Yo&&dr(Yo)}}function zr(e,t){!e||D(e)||B(e)||(e=[e]);var r,n,i,a=(e||un()).filter(function(e){return si(e)&&(!ss.isLocked(e)||ss.isLocked(e)&&t)}),o=a.length,s=[],l=(e||un()).filter(function(e){return!((!ss.isLocked(e)||ss.isLocked(e)&&t)&&(!m(e,"c_partid")||!m(e.childNodes[0],"c_note")))}),c={};for(r=0;r<l.length;r++){n=l[r];if(n){u(n,"active",!1);i=m(n.childNodes[0],"c_note")||"";switch(i){case"note_name":c["attr-footprint-name-display"]="none";break;case"note_pre":c["attr-footprint-prefix-display"]="none";break;default:c=!1}n.parentNode&&c&&La(n.parentNode,c)}}if(1==o&&m(a[0],"c_partid")&&m(a[0].childNodes[0],"c_note")){if(Is!=ao.PCBLIB){parent.$.messager.error("This field can't be removed!");return}a[0].remove()}if(o>0){var d,f=[];Gr();Is==ao.PCB&&(s=Sn(a));var g=[];for(r=0;r<o;r++){n=a[r];d=Z(n);f.push(["del",n.id,Eo.node.getRefId(n)]);if("TRACK"===d)f=f.concat(Ha({wire:n.id},!0));else if("PAD"===d||"VIA"===d)f=f.concat(Ha({pad:n.id},!0));else if("FOOTPRINT"===d){var y=p('polyline[c_shapetype="line"]',n);for(var v in y)f=f.concat(Ha({wire:y[v].id},!0));var x=p('g[c_partid="part_pad"]',n).concat(Object.assign([],p('g[c_partid="part_via"]',n)));for(v in x)f=f.concat(Ha({pad:x[v].id},!0))}else if("COPPERAREA"===d&&vs)vs.removeChild(h('[copper_id="'+n.id+'"]'));else if("PLANEZONE"===d){f.push(["attr",n.id,{fillStyle:m(n,"fillStyle")},{fillStyle:"none"}]);m(n,"fillStyle","none");Fo.updateOne(n)}!bi(m(n,"layerid"))||"TRACK"!==d&&"ARC"!==d||g.push(m(n,"layerid"));if("PLANEZONE"!==d){Fo.removeOne(n);Ro.appendChild(n)}}zo.save(f);sr("triggerEvent",["select_change"]);g.length>0&&qo.rebuildPlane(g);Is==ao.PCB&&s.length&&Qo.buildGroupNets(s)}}function Wr(){var t=un().filter(function(e){return si(e)&&!ss.isLocked(e)}),r=t.length;if(r&&(1!==r||"PLANEZONE"!==Z(t[0]))){gClipboard.childNodes.length>0?Eo.node.clearChildNodes(gClipboard):sr("triggerEvent",["enable_paste"]);Gr();var n,i,a=[];for(n=0;n<r;n++){i=t[n];Fo.removeOne(i);a[n]=["del",i.id,Eo.node.getRefId(i)];gClipboard.appendChild(i.cloneNode(!0));Ro.appendChild(i)}lo.pasteFrom="cut";lo.pasteCount=0;zo.save(a);sr("triggerEvent",["select_change"]);parent.globalEditorClipboard=[Is,e.frameElement.id,+new Date]}}function Zr(){var t,r,n,i=un(),a=i.length;if((1!==a||"gPre"!=i[0].id&&"gPad"!=i[0].id)&&(1!==a||"PLANEZONE"!==Z(i[0]))&&a>0){n=gClipboard.childNodes.length>0;n&&Eo.node.clearChildNodes(gClipboard);for(t=0;t<a;t++){r=i[t].cloneNode(!0);u(r,"active",!1);u(r,"hover",!1);u(r,"selected",!1);C(r,"locked");gClipboard.appendChild(r)}n||sr("triggerEvent",["enable_paste"]);lo.pasteFrom="copy";lo.pasteCount=0;parent.globalEditorClipboard=[Is,e.frameElement.id,+new Date];return!0}}function Kr(e){var t,r=gClipboard.childNodes,n=r.length,i=[];if(n){for(var a=0;a<n;a++){t=r[a];if("none"!=m(t,"display")&&!f(t,"hitbox")){"part_pcbtext"===m(t,"c_partid")&&h("[c_note]",t)&&C(h("[c_note]",t),"c_note");i.push(t.cloneNode(!0))}}tn(i,e);lo.pasteCount++}}function qr(){sr("getRatlineIndexAndTab");en(!0)}function $r(){Zr()&&$r.fn.init()}function Qr(){var e=un();if(e.length){ps.nodes=e;ps.started=!0;ur("cross-red");Gr();t.addEventListener("click",ps.clickHandler,!1);t.addEventListener("mouseup",ps.mouseUpHandler,!1);t.addEventListener("keydown",ps.keyDownHandler,!1);t.addEventListener("mousemove",ps.mouseMoveHandler,!1)}}function en(r){var n=parent.globalEditorClipboard;if(n){var i=Eo.fileType.getAbstractFileType(n[0]),a=Eo.fileType.getAbstractFileType(Is);if("pcb"===i||"pcblib"===i)if(n[1]!=e.frameElement.id){var o=e.frameElement.ownerDocument.getElementById(n[1]),s=o&&o.contentWindow;s=s&&s.gClipboard;s=s&&s.childNodes;if(s&&s.length){if(Is===ao.PCBLIB)for(var l=0;l<s.length;l++){m(s[l],"net")&&m(s[l],"net","");if("FOOTPRINT"===Z(s[l]))for(var c=0;c<s[l].childNodes.length;c++)m(s[l].childNodes[c],"net")&&m(s[l].childNodes[c],"net","")}var l,d,h,u=function(e){C(e,"style");C(e,"class");C(e,"id")},g=[];for(l=0,d=s.length;l<d;l++){h=t.importNode(s[l],!0);m(p("*[id]",h),"id","");i==a?g[l]=h:g=g.concat(function e(t){if("none"==m(t,"display")||f(t,"hitbox"))return[];var r=Z(t),n=[];u(t);switch(r){case"FOOTPRINT":for(var i=0,a=t.children,o=a.length;i<o;i++)if("part_pcbtext"!==m(a[i],"c_partid")||Is!=ao.PCBLIB||"note_pre"!==m(a[i].firstChild,"c_note")&&"note_name"!==m(a[i].firstChild,"c_note")){var s=e(a[i]);s.length&&(n=n.concat(s))}t=null;break;case"PAD":case"VIA":case"HOLE":case"TEXT":case"SVGNODE":case"TRACK":case"COPPERAREA":case"SOLIDREGION":case"DIMENSION":case"PROTRACTOR":case"ARC":case"RECT":case"CIRCLE":break;case"RATLINE":default:t=null}t&&n.push(t);return n}(h))}g.length&&tn(g,r)}}else Kr(r)}}function tn(e,r){if(e&&e.length&&!Io.on){var n,i,a,o=e.length,s="";Gr();var l=zt("g");for(n=-1;++n<o;){"circle"===e[n].tagName&&e[n].removeAttribute("transformArc");l.appendChild(e[n])}Go.appendChild(l);var c,d,p,u,f,y,v=l.getBBox(),x={x:v.x+v.width/2,y:v.y+v.height/2},C=tr();c=Ct({x:Sr.data.clientX||C.clientWidth/2,y:Sr.data.clientY||C.clientHeight/2});u=h('g[c_partid="part_pad"]',l);u||(u=h("g[c_origin]",l));var L=m(u,"c_origin");if(1===o&&"FOOTPRINT"===Z(l.children[0])){var _=m(l.children[0],"c_origin");_&&(f={x:+_.split(",")[0],y:+_.split(",")[1]})}f||(f=x);if(L){y={x:+L.split(",")[0],y:+L.split(",")[1]};var P=Et({x:c.x-f.x+y.x,y:c.y-f.y+y.y});d=P.x-y.x;p=P.y-y.y}else{var A=Et(c);d=A.x-f.x;p=A.y-f.y}$r.fn.started?$r.fn.on=!0:It(l,d,p);var b,S={};for(n=0,o=e.length;n<o;n++){i=e[n];jt(i);s+=","+i.id;Ls.appendElement(i);g(i,"selected");b=Z(i);a=m(i,"c_etype");if("pinpart"==a&&!r){var E=i.querySelector("path[c_note=note_pre]");if(E){var O=m(E,"c_text")||"",I=Vo.getNewPre2(O,!0,!0,S);I!=O&&Sa(E.parentNode,{text:I});S[I]=1}}if("COPPERAREA"==b&&(Is==ao.PCBLIB||Is==ao.PCBMODULE||Is==ao.PCB)){var T,R=Fo.gJsonCache.COPPERAREA||{},w=[];for(var N in R)w.push(R[N].order);if(w.length){T=Math.max.apply(null,w);var k=m(i,"order")}else{T=0;k=0}m(i,"order",Number(T)+Number(k))}"FOOTPRINT"==b&&("cut"===lo.pasteFrom&&lo.pasteCount>0||"cut"!==lo.pasteFrom)&&m(i,"bindSCHId",Q())}Go.removeChild(l);qi(!0);ur("cross-red",c.x,c.y);if($r.fn.position){Qi({targets:e,x:$r.fn.position.x,y:$r.fn.position.y,bbox:{x:v.x+d,y:v.y+p,width:v.width,height:v.height},hasPin:!!u});t.addEventListener("mousemove",$r.fn.mouseMoveHandler,!1)}else Qi({targets:e,x:c.x,y:c.y,bbox:{x:v.x+d,y:v.y+p,width:v.width,height:v.height},hasPin:!!u});sr("triggerEvent",["select_change"])}}function rn(e){if(e&&e.length){var t=e.map(function(e){var t=e.cloneNode(!0);e.parentNode.insertBefore(t,e.nextSibling);"object"==typeof t.className?t.className.baseVal="":t.className="";jt(t);return t});Fo.updateMore(t);Is==ao.PCB&&Qo.buildRatLinesOfPCBLib(t);var r=t.map(function(e){return e.id}),n=r.join(",");zo.save(["add",n]);return r}}function nn(e,t){if(!(Jo&&Uo||Zi())){t=(t||un()).filter(function(e){return!ss.isLocked(e)});t=t.filter(function(e){return e&&e.parentNode==Ka&&["ARC","COPPERAREA","CIRCLE","RECT","SOLIDREGION","TRACK","SVGNODE"].indexOf(Z(e))>=0});t=t.filter(si);if(t.length){var r=new Jt(t);e?is.flipH(t):is.flipV(t);Yo&&dr(Yo);Fo.updateMore(t);Is==ao.PCB&&Qo.buildRatLinesOfPCBLib(t);r.updateAndSave()}}}function an(e,t){t=t&&t.ids?t.ids:t;if(!t||Array.isArray(t)){t=t?[].map.call(t,function(e){return"string"==typeof e?d(e):e.gId?d(e.gId):e}).filter(function(e){return e&&(e.parentNode==Ka||si(e.parentNode)&&"part_pcbtext"==m(e,"c_partid"))}):un();t=t.filter(function(e){return!ss.isLocked(e)&&(si(e)||si(e.parentNode)&&"part_pcbtext"==m(e,"c_partid"))});if(t.length){var r,n,i,a,o,s,l,c,h,u,f,g,y=new Jt(t),v=[],x=0,C=Zo.adsorbGrid.gridSize;for(i=0,a=t.length;i<a;i++){var L=Eo.svg.getBBoxFixed(t[i],{excludeText:!0});if(L.width||L.height){v[i]=L;if(0===i){r=L.x;n=L.y;c=L.x;h=L.y;u=L.x+L.width;f=L.y+L.height}switch(e){case"align_left":r=void 0===r?L.x:Math.min(r,L.x);break;case"align_right":r=void 0===r?L.x+L.width:Math.max(r,L.x+L.width);break;case"align_top":n=void 0===n?L.y:Math.min(n,L.y);break;case"align_bottom":n=void 0===n?L.y+L.height:Math.max(n,L.y+L.height);break;case"align_horizontal_center":n=void 0===n?L.y:Math.min(n,L.y);f=Math.max(f,L.y+L.height);i==a-1&&(n=(f+n)/2);break;case"align_vertical_center":r=void 0===r?L.x:Math.min(r,L.x);u=Math.max(u,L.x+L.width);i==a-1&&(r=(u+r)/2);break;case"align_horizontal_equidistant":r=void 0===r?L.x:Math.min(r,L.x);u=Math.max(u,L.x+L.width);break;case"align_vertical_equidistant":n=void 0===n?L.y:Math.min(n,L.y);f=Math.max(f,L.y+L.height);break;case"align_left_side_edge_equidistant":r=void 0===r?L.x:Math.min(r,L.x);c=void 0===r?L.x:Math.max(c,L.x);break;case"align_top_side_edge_equidistant":n=void 0===n?L.y:Math.min(n,L.y);h=void 0===n?L.y:Math.max(h,L.y);break;case"align_grid":r=void 0===r?L.x:Math.min(r,L.x);i==a-1&&(r=Math.round(r/C)*C);break;default:return}}}if((void 0!==r||"align_left"!=e&&"align_right"!=e)&&(void 0!==n||"align_top"!=e&&"align_bottom"!=e)){if("align_vertical_center"==e||"align_top_side_edge_equidistant"==e||"align_vertical_equidistant"==e){var _=lr(v,"y",t);t=_.objs;v=_.os}else if("align_horizontal_center"==e||"align_left_side_edge_equidistant"==e||"align_horizontal_equidistant"==e){var P=lr(v,"x",t);t=P.objs;v=P.os}"align_left_side_edge_equidistant"==e?g=Math.abs(c-r)/(t.length-1):"align_top_side_edge_equidistant"==e&&(g=Math.abs(h-n)/(t.length-1));if("align_horizontal_equidistant"==e){g=u-r;if(v.length<=2)return;for(i=0;i<v.length;i++){g-=v[i].width;i==v.length-1&&(g/=v.length-1)}}else if("align_vertical_equidistant"==e){g=f-n;if(v.length<=2)return;for(i=0;i<v.length;i++){g-=v[i].height;i==v.length-1&&(g/=v.length-1)}}for(i=0,a=t.length,o=0;i<a;i++)if(v[i]){s=0;l=0;switch(e){case"align_left":s=r-v[i].x;break;case"align_right":s=r-v[i].x-v[i].width;break;case"align_top":l=n-v[i].y;break;case"align_bottom":l=n-v[i].y-v[i].height;break;case"align_horizontal_center":l=n-v[i].y-v[i].height/2;break;case"align_vertical_center":s=r-v[i].x-v[i].width/2;break;case"align_horizontal_equidistant":if(v[i].x+v[i].width===u&&v.length-1===i)break;s=r-v[i].x;r=r+v[i].width+g;break;case"align_vertical_equidistant":if(v[i].x+v[i].height===f)break;l=n-v[i].y;n=n+v[i].height+g;break;case"align_left_side_edge_equidistant":s=Math.round(r-v[i].x);r+=g;break;case"align_top_side_edge_equidistant":l=Math.round(n-v[i].y);n+=g;break;case"align_grid":var A=t[i].getAttribute("c_origin");A&&(A=A.split(","));var b=t[i].children;b.length&&"text"==b[0].tagName&&(A="");if(A&&A.length){s=Math.round(A[0]/C)*C-A[0];l=Math.round(A[1]/C)*C-A[1]}else if("path"==t[i].tagName){var S=xt(t[i].getAttribute("d"));s=Math.round(Number(S[1])/C)*C-S[1];l=Math.round(Number(S[2])/C)*C-S[2]}else if("ellipse"==t[i].tagName||"circle"==t[i].tagName){var E=t[i].getAttribute("cx"),O=t[i].getAttribute("cy");s=Math.round(E/C)*C-v[i].x;l=Math.round(O/C)*C-v[i].y}else if("polygon"==t[i].tagName||"polyline"==t[i].tagName){var I=Pt(t[i],1);s=Math.round(Number(I[0])/C)*C-I[0];l=Math.round(Number(I[1])/C)*C-I[1]}else{s=Math.round(v[i].x/C)*C-v[i].x;l=Math.round(v[i].y/C)*C-v[i].y}}if(s||l||"align_horizontal_equidistant"===e){if("TEXT"==Z(t[i])&&t[i].parentNode!=Ka){var T="part_pcbtext"==m(t[i],"c_partid");T&&m(t[i],"oldOrigin",m(t[i],"c_origin"))}rs.move(t[i],s,l);var R=!1;if("TEXT"==Z(t[i])&&t[i].parentNode!=Ka){var w=p("path[c_note=note_pre]",t[i]),N=p("path[c_note=note_name]",t[i]),k=!w.length&&!N.length&&"part_pcbtext"==m(t[i],"c_partid");w.length>0?R=xa(w,"oldOrigin","pre"):N.length>0?R=xa(N,"oldOrigin","name"):k&&(R=xa([t[i]],"oldOrigin","libtext"))}R?parent.$.messager.show({title:"Warning",width:"400",msg:"The prefix or name or text too far away from the footprint, if you don't want it to show up please make it hidden.",timeout:5e3,showType:"slide"}):x++}else y.deleteItemAt(i+o--)}else y.deleteItemAt(i+o--);if(x){y.updateAndSave();Fo.updateMore(t);Is==ao.PCB&&Qo.buildRatLinesOfPCBLib(t);Yo&&dr(Yo)}}}}}function on(e,t,r){void 0===t?t=270:"string"==typeof t&&(t=+t);for(var n,i=0,a=0,o=e.length;i<o;i++){var s=e[i],l=m(s,"c_origin"),c=+m(s,"c_rotation")||0;if(l)l=Eo.numberlistToArray(l);else{n=Eo.svg.getBBox(s);l=[n.x+n.width/2,n.y+n.height/2]}if(!0===r){var d=t-c;d<0&&(d+=360);ns[s.tagName](s,d,l[0],l[1])}else ns[s.tagName](s,t,l[0],l[1]);a++}return a>0}function sn(){var e,t,r=arguments;e="object"==typeof r[0]?r[0]:un();e.length>1&&(e=e.filter(function(e){return si(e)||"part_pcbtext"==m(e,"c_partid")&&si(e.parentNode)}));if(!e||!e.length)return!1;t="number"==typeof r[0]?r[0]:"number"==typeof r[1]?r[1]:270;if(e.length>1){var n,i=Eo.svg.getElementsCenter(e,!0);i=ce(i);for(var a=0,o=e.length;a<o;a++){li(e[a])&&m(e[a],"oldOrigin",m(e[a],"c_origin"));Eo.svg.fixOrigin(e[a]);ns.rotate(e[a],t,i.x,i.y);Un(e[a]);if(li(e[a])){var s=p("path[c_note=note_pre]",e[a]),l=p("path[c_note=note_name]",e[a]),c=!s.length&&!l.length;s.length>0?n=xa(s,"oldOrigin","pre"):l.length>0?n=xa(l,"oldOrigin","name"):c&&(n=xa([e[a]],"oldOrigin","libtext"));if(n){Eo.svg.fixOrigin(e[a]);ns.rotate(e[a],-t);Un(e[a]);parent.$.messager.show({title:"Warning",width:"400",msg:"The prefix or name or text too far away from the footprint, if you don't want it to show up please make it hidden.",timeout:5e3,showType:"slide"})}}}}else{Eo.svg.fixOrigin(e[0]);ns.rotate(e[0],t);Un(e[0])}var d,h,u=!0,f=[];e.forEach(function(e){d=Z(e);h=e.id;"COPPERAREA"===d&&f.push(h);Fo.gJsonCache[d]&&Fo.gJsonCache[d][h]&&(u=!1)});if(!u){Fo.updateMore(e,{notCopper:!0});f.length&&sr("buildCopper")}Is==ao.PCB&&Qo.buildRatLinesOfPCBLib(e);Yo&&"FOOTPRINT"===Z(Yo)&&!fo.start&&dr(Yo);return o>0}function ln(){var e,t,r,n,i,a=un().filter(function(e){return si(e)&&!ss.isLocked(e)}),o=a.length,s=[],l=Ls.getActiveLayer();if(o&&!bi(l)){for(e=o-1;e>=0;e--){t=a[e];r=r||function(e){var t=e.parentNode;if(t==Ka){for(var r=e.nextSibling;r&&(!r.id||0!==r.id.indexOf("layer_"));)r=r.nextSibling;return r}return t.lastElementChild}(t)||null;if(t.nextSibling!=r){n=Eo.node.getRefId(t);t.parentNode.insertBefore(t,r);i=Eo.node.getRefId(t);s.push(["elePosition",t.id,n,i])}r=t}s.length&&zo.save(s)}}function cn(){var e,t,r,n,i,a=un().filter(function(e){return si(e)&&!ss.isLocked(e)}),o=a.length,s=[],l=Ls.getActiveLayer();if(o&&!bi(l)){for(e=0;e<o;e++){t=a[e];r=r||function(e){var t=e.parentNode;if(t==Ka){for(var r=e.previousSibling;r&&(!r.id||0!==r.id.indexOf("layer_"));)r=r.previousSibling;return r}return t.firstElementChild}(t)||null;if(t.previousSibling!=r){n=Eo.node.getRefId(t);t.parentNode.insertBefore(t,r.nextSibling);i=Eo.node.getRefId(t);s.push(["elePosition",t.id,n,i])}r=t}s.length&&zo.save(s)}}function dn(e,t){function r(e,t){for(var r=Xo[e],n=e;r&&r.tagName!=t;){m(r,"id","cline"+ ++n);r=Xo[n]}if(r){if(n!=e){Xo.splice(n,1);Xo.splice(e,0,r);m(r,"id","cline"+e)}}else{r=zt(t,{fill:"none",stroke:m(Xo[0],"stroke"),"stroke-dasharray":m(Xo[0],"stroke-dasharray"),id:"cline"+e});ys.insertBefore(r,Xo[e]||null);Xo.splice(e,0,r)}return r}function n(e){var t=Ho[e];if(!t){t=gs.appendChild(x(Ho[0]));m(t,"id","crect"+e);Ho[e]=t}return t}if(Is!=ao.WAVEFORM&&Is!=ao.PHOTOVIEW){m(us,{visibility:"visible"});m(gs,{visibility:"visible"});m(ys,{visibility:"visible"});var i=e.length/2,a=jo.length;if(0===a){jo[0]=d("cdot0");jo[1]=d("cdot1");a=2}var o,s,l={},c={},p={};l.transform=c.transform=p.transform=t||"";l.visibility=c.visibility=p.visibility="";l.r=4/wo;if(!e.onlyLines){var h=e.visible_dots;for(o=0,s=Math.max(i,a);o<s;o++){l.visibility="";if(o<i&&o<a);else{if(o>=i){m(jo[o],{visibility:"hidden"});continue}jo[o]=jo[0].cloneNode(!0);l.id="cdot"+o;us.appendChild(jo[o])}l.cx=e[2*o];l.cy=e[2*o+1];if("odd"==e.lightDots&&o%2){l.class="light";if(Is==ao.PCB||Is==ao.PCBLIB||Is==ao.PCBMODULE){var u=un()[0];u&&"TRACK"==Z(u)&&oi(m(u,"layerid"))&&(l.visibility="hidden")}}else l.class="";m(jo[o],l);h&&h.length&&h.indexOf(o)>0&&m(jo[o],{visibility:"hidden"});if(e.isRotate){var f=30/(wo<=6?6:wo);wo>=20&&(f=1.5);var g=m(jo[0],"cx"),y=m(jo[0],"cy");m(fs.children[0],{x:Number(g)-f/2});m(fs.children[0],{y:Number(y)-f/2});m(fs.children[0],{width:f});m(fs.children[0],{height:f});m(fs.children[0],{visibility:"visible"})}}}var v=e.c_helper_lines;if(v){var C=Xo.length,L=Ho.length;if(0===C){Xo[0]=d("cline0");C=1}if(0===L){Ho[0]=d("crect0");L=1}o=-1;for(var _,P,A,b,S,E=-1,O=-1;++o<v.length;)if("rect_center_corner"==v[o].type){b=n(++O);_=v[o].center;P=v[o].corner;A=[e[2*_],e[2*_+1],e[2*P],e[2*P+1]];m(b,c);m(b,{x:Math.min(2*A[0]-A[2],A[2]),y:Math.min(2*A[1]-A[3],A[3]),width:2*Math.abs(A[0]-A[2]),height:2*Math.abs(A[1]-A[3])})}else if("rect_corner_corner"==v[o].type){b=n(++O);_=v[o].corner1;P=v[o].corner2;A=[e[2*_],e[2*_+1],e[2*P],e[2*P+1]];m(b,c);m(b,{x:Math.min(A[0],A[2]),y:Math.min(A[1],A[3]),width:Math.abs(A[0]-A[2]),height:Math.abs(A[1]-A[3])})}else if("rect"==v[o].type){b=n(++O);m(b,c);m(b,v[o].data)}else if("path_arc"==v[o].type){S=r(++E,"path");m(S,p);m(S,"d",e.path_arc||"")}else{S=r(++E,"line");m(S,p);_=v[o].from;P=v[o].to;A={x1:e[2*_],y1:e[2*_+1],x2:e[2*P],y2:e[2*P+1]};var I=A.x2-A.x1,T=A.y2-A.y1;if(!I&&!T){m(S,"visibility","hidden");continue}if(-1===v[o].ray){A.x2=A.x1+A.x1-A.x2;A.y2=A.y1+A.y1-A.y2}if(1===v[o].ray||-1===v[o].ray){var R=ms.getViewBox(),w=+R[0],N=+R[1],k=w+ +R[2],M=N+ +R[2];if(A.x2>w&&A.x2<k&&A.y2>N&&A.y2<M){var B=A.x2<A.x1?w:k,D=A.y2<A.y1?N:M,V=I?(B-A.x1)/I:0,F=T?(D-A.y1)/T:0,G=Math.min(V,F);A.x2=A.x1+G*I;A.y2=A.y1+G*T}}m(S,A)}for(o=E+1;o<C;o++)m(Xo[o],{visibility:"hidden"});for(o=O+1;o<L;o++)m(Ho[o],{visibility:"hidden"})}else{m(gs,{visibility:"hidden"});m(ys,{visibility:"hidden"})}}}function pn(e,t){var r,n,i,a,o,s="check-group"==e&&1===arguments.length,l=un().filter(function(e){return!ss.isLocked(e)}),c=[],p=[],u=[];if(0===l.length)return"group fail";if(1===l.length){zo.startBatch();i=l[0];if("group"==m(i,"c_shapetype")&&h('g[c_partid="part_pcbtext"] path[c_note="note_pre"]',i)){Fo.removeOne(i);var f,g=i.childNodes;for(r=0,n=g.length;r<n;r++)if(1===g[r].nodeType){f=g[r].cloneNode(!0);a=m(f,"c_shapetype");a||(a="g"==f.tagName?"group":"line");C(f,"c_shapetype");m(f,"c_shapetype",a);if("part_pcbtext"===m(f,"c_partid")){m(f,"c_etype","pinpart");C(f,"display");C(f.childNodes[0],"c_note")}Ls.appendElement(f);jt(f);Fo.updateOne(f);u.push(f.id)}u.length>0&&p.push(["add",u.join(",")]);p.push(["del",i.id]);Ro.appendChild(i);zo.save(p);zo.saveBatch();return"ungroup ok"}return"ungroup fail"}var y,v,x={PAD:1,VIA:1,TRACK:1,TEXT:1,ARC:1,DIMENSION:1,PROTRACTOR:1,CIRCLE:1,SOLIDREGION:1,HOLE:1};for(r=0,n=l.length;r<n;r++){i=l[r];m(i,"c_partid");a=m(i,"c_shapetype");m(i,"c_etype");v=Z(i);if(S(x,v)){"TEXT"==v&&"note_pre"==m(i.childNodes[0],"c_note")&&(y=m(i.firstChild,"c_text"));"TEXT"==v&&"note_name"==m(i.childNodes[0],"c_note")&&m(i.firstChild,"c_text");c.push(i)}}if(c.length<2)return"group fail";if(s){e=y||"none";return[e]}var L=d("part_import_tmpl").cloneNode(!0);L.id="gge"+ ++ko;for(r=0,n=c.length;r<n;r++){i=c[r];C(i,"class");f=i.cloneNode(!0);Fo.removeOne(f);L.appendChild(f);Ro.appendChild(i);u.push(i.id)}u.length>0&&p.push(["del",u.join(",")]);m(L,{c_para:"package`",display:""});Ls.appendElement(L);jt(L);p.push(["add",L.id]);zo.save(p);L.removeChild(L.childNodes[0]);Cr(L,{pre:e||" ",name:t||" "},"pcblib");m(mr("pre",L),"display","yes");var _=L.getBBox();o={x:_.x+_.width/2,y:_.y+_.height/2};m(L,"c_origin",o.x+","+o.y);Fo.updateOne(L);return"group ok"}function hn(){var e=I(ts);if(e)for(var r,n,i=t.adoptNode(e.documentElement),a=i.childNodes,o=a.length-1;o>=0;o--){r=m(n=a[o],"c_partid");if(r&&!d(r)){m(n,{id:r,display:"none"});d("gCurParts").appendChild(n)}}}function un(e){var t=p("#g1>.active,#g1 .selected,#g1 .active",Ka).toArray();t=t.filter(function(e){var t=e.parentNode;return(t==Ka||t.parentNode==Ka)&&"dimensionCheck"!==m(e,"c_shapetype")});if(!e)return t
;for(var r={},n=0,i=t.length;n<i;n++){var a=Z(t[n]),o=t[n].id;if(a&&o){r[a]||(r[a]={});r[a][o]=Fo.gJsonCache[a][o]}}return r}function fn(){return Ka.querySelector("#g1>.active,#g1>.selected")}function gn(e){e=e||"selected-h";var t=p("#g1 ."+e+", #g1 ."+e,Ka).toArray(),r=t.length;if(r){t.forEach(function(t){u(t,e,!1)});return r}}function yn(e){var t=e||un(),r=t.length;if(r>0){for(var n=r;--n>=0;){u(t[n],"selected",!1);u(t[n],"active",!1);u(t[n],"hover",!1)}cr()}Is==ao.PCB&&Qo.cancelHighlightNets();return r}function vn(){if(Yo){u(Yo,"active",!1);Yo=null;cr()}var e,t,r,n=p("#g1 .hover",Ka);for(e=n.length-1;e>=0;e--){u(n[e],"hover",!1);u(n[e],"wire-hover",!1)}t=p("#g1 .selected",Ka);for(e=0;e<t.length;e++)u(t[e],"selected",!1);t=p('#g1 > [c_shapetype]:not(.selected):not(.events-none):not([d=""]):not([display="none"])',Ka);var i,a=Fo.gJsonCache.objectMap,o=a.objects.Component.selected,s=!0;t=[].filter.call(t,function(e){var t=getComputedStyle(e);if("FOOTPRINT"===Z(e))return o;i=Xi(e);i&&S(a.objects,i)&&(s=a.objects[i].selected);return s?t&&"none"!=t.display&&"none"!=t["pointer-events"]:s});r=t.length;if(r>0){e=r;for(;--e>=0;)u(t[e],"selected",!0)}if(!o){var l,c,d=["Prefix","Name"];for(c=0;c<d.length;c++){s=a.objects[d[c]].selected;if(s){l=p(a.objects[d[c]].selectorText);r=l.length;if(r>0){e=r;for(;--e>=0;)u(l[e].parentNode,"selected",!0)}}}}sr("triggerEvent",["select_change"]);return r}function xn(e){Gr();e=e.filter(function(e){return e&&e.parentNode==Ka&&!f(e,"events-none")&&function(e){var t=getComputedStyle(e);return t&&"none"!=t.display}(e)});for(var t=0;t<e.length;t++)u(e[t],"selected",!0)}function mn(e){var t=e.id;if(t){var r,n,i,a,o,s=Yo;if(!ss.isLocked(s)&&s&&s.parentNode==Ka){r=d(t);if(r&&r.parentNode==us&&"light"!=m(r,"class")&&("path"==s.tagName||"polyline"==s.tagName||"polygon"==s.tagName)){n=+t.substr(4);i=us.children[1];!i||"light"!=m(i,"class")&&"hidden"!=m(i,"visibility")||(n>>=1);if("path"!=s.tagName){var l=s,c=l.points,p=c.numberOfItems;if(p<=2){Fo.removeOne(l);zo.save(["del",l.id,Eo.node.getRefId(l)]);Ro.appendChild(l);var h=m(l,"net");h&&Qo.buildOneNet(h,!1);Gr();sr("triggerEvent",["select_change"])}else if(n>=0&&n<p){a=["attr",l.id,{points:m(l,"points")}];o=Z(l);c.removeItem(n);dr(l);Fo.updateOne(l,{notCopper:!0});a[3]={points:m(l,"points")};zo.save(a);if("TRACK"==o||"ARC"==o){h=m(l,"net");h&&Qo.buildOneNet(h,!1)}}}else{if(Fo.gJsonCache.DIMENSION&&S(Fo.gJsonCache.DIMENSION,m(s,"id")))return;if(Fo.gJsonCache.PROTRACTOR&&S(Fo.gJsonCache.PROTRACTOR,m(s,"id")))return;o=Z(s);a=["attr",s.id,{d:m(s,"d")}];Eo.svg.deletePathPointAtCdot(s,n);if(("COPPERAREA"==o||"SOLIDREGION"==o)&&!Er(s)){m(s,"d",a[2].d);return}a[3]={d:m(s,"d")};if(a[2].d!=a[3].d)if(s.getTotalLength(s)<.01){m(s,"d",a[2].d);zr([s])}else{Fo.updateOne(s,{notCopper:!0});dr(s);zo.save(a)}}}}}}function Cn(e){var t,r,n;if("circle"!=e.tagName&&"polyline"!=e.tagName&&"path"!=e.tagName||!m(e,"layerid")){var i=e.parentNode;if("g"==i.tagName&&i!=Ka){n=Z(i);"PAD"!=n&&"VIA"!=n||(t=i)}}else{n=Z(e);var a=m(e,"layerid");r="TRACK"==n||"ARC"==n||"CIRCLE"==n&&Bi(parseInt(a));r&&(t=e)}if(t){var o,s=m(t,"net"),l="",c=Zo.canvas.unit;if(s)if(r){o=Eo.units.convert(+m(t,"stroke-width"),"pixel",c);o=Eo.formatLengthShow(o);l=s+"\n width = "+o+" "+c}else l=s;Eo.svg.setTooltip(t,l)}}function Ln(e){if(e&&"g"==e.tagName){var t=e.children[0],n=e.children[1];if(t&&"path"==t.tagName&&(!n||"path"==n.tagName)){var i=t.getPathData();if(i.length<2)n&&v(n);else{for(var a=new r,o=0;o<i.length;o++){var s=i[o],l=s.values;switch(s.type){case"M":case"L":a.addPoint(l[0],l[1]);break;case"C":a.addPoint(l[4],l[5]);break;case"Q":a.addPoint(l[2],l[3])}}var c=a.getHull();if(c<3)n&&v(n);else{for(var d="M"+c[0].x+" "+c[0].y+"L",p=1;p<c.length;p++)d+=" "+c[p].x+" "+c[p].y;d+="Z";if(n)m(n,"d",d);else{n=zt("path",{stroke:"none","fill-opacity":0,fill:"black",d:d});e.appendChild(n)}}}}}}function _n(e){if(e&&"path"==e.tagName){var t=m(e,"id"),r=m(e,"d");if(t&&r){var n,i=m(e,"stroke-width"),a=m(e,"layerid"),o=h('[copper_id="'+t+'"]');if(o)m(o,{d:r,copper_layerid:a});else if(vs){n=zt("path",{d:r,"stroke-width":10*i,copper_id:t,copper_layerid:a});vs.appendChild(n)}}}}function Pn(){var e=Fo.gJsonCache.FOOTPRINT,t=[],r={};for(var n in e){var i,a=[],o=e[n].TEXT;for(var s in o)if(S(o,s)){"P"===o[s].type&&a.push(o[s].text);"N"===o[s].type&&(i=o[s].text)}var l=e[n].head.c_para,c=Eo.c_paraToJson(l),d=c.package||"",p=i+"`"+d;if(S(r,p)){r[p].components+=","+a.join(",");r[p].quantity++}else r[p]={components:a.join(","),package:d,quantity:1,value:i,customPara:{LCSC:c.BOM_LCSC||"",BOM_Manufacturer:c.BOM_Manufacturer||"","BOM_Manufacturer Part":c["BOM_Manufacturer Part"]||"",BOM_Supplier:c.BOM_Supplier||""}}}for(var h in r)t.push(r[h]);return t}function An(e){var t=Fo.gJsonCache.FOOTPRINT[e],r=t&&t.PAD,n=[];for(var i in r)if(S(r,i)){var a=r[i];n.push({gId:a.gId,number:a.number,net:a.net})}return n}function bn(e){var t=Fo.gJsonCache.SIGNALS[e],r=[];if(!t)return r;for(var n=0,i=t.length;n<i;n++){var a=t[n];if(a&&"PAD"==a.cmd&&a.fid&&a.gId){var o=function(e,t){var r=Fo.gJsonCache.FOOTPRINT[e],n=r.PAD,i=r.TEXT,a="",o="";for(var s in n)if(S(n,s)&&n[s].gId==t){a=n[s].number;break}for(var l in i)if(S(i,l)&&"P"==i[l].type){o=i[l].text;break}return{pre:o,number:a}}(a.fid,a.gId);Eo.extend(o,a);o.net=e;r.push(o)}}return r}function Sn(e){if(!e||!e.length)return[];for(var t={},r=0;r<e.length;r++){var n=m(e[r],"net");n&&oi(m(e[r],"layerid"))&&(t[n]=!0);for(var i=p("[net]",e[r]),a=0;a<i.length;a++){n=m(i[a],"net");n&&oi(m(i[a],"layerid"))&&(t[n]=!0)}}return Object.keys(t)}function En(){var e,t,r,n,i={},a=Fo.getAllNetName(),o=Fo.gJsonCache.preference.hideNets||[];for(e=0,r=a.length;e<r;e++){n=!1;var s=a[e];if(s&&!(Fo.gJsonCache.SIGNALS[s].length<=0)){for(t=0;t<o.length;t++)if(o[t]==s){n=!0;break}if(!i[s]){i[s]={connect:[],pads:bn(s),checked:!n,isRouted:Qo.isRoutedOfOneNet(s)};Fo.gJsonCache.SIGNALS[s].forEach(function(e){return function(t){"PAD"==t.cmd&&t.fid||i[e].connect.push(Eo.extend({},t))}}(s))}}}return i}function On(e,t,r){var n,i,a,o,s,l,c,p=!1,h=Fo.gJsonCache.preference||{};if("component"==t){var u=h.hideFootprints||[];0===u.length&&"show"===r&&(p=!0);for(n=0,i=u.length;n<i;n++)if("show"===r){p=!0;if(e.id==u[n]){delete u[n];break}}else if("hide"===r){p=!1;if(e.id==u[n]){delete u[n];break}}else if(e.id==u[n]){p=!0;delete u[n];break}if(p)m(d(e.id),"display","");else{m(d(e.id),"display","none");u.push(e.id)}}else if("net"==t){var f=h.hideNets||[];0===f.length&&"show"===r&&(p=!0);for(n=0,i=f.length;n<i;n++)if("show"===r){p=!0;if(e.text==f[n]){delete f[n];break}}else if("hide"===r){p=!1;if(e.text==f[n]){delete f[n];break}}else if(e.text==f[n]){p=!0;delete f[n];break}p||f.push(e.text);o=d("pcbNetStyle").sheet;s=o.cssRules;l=null;c='line[net="'+e.text+'"], polyline[net="'+e.text+'"], path:not([copper])[net="'+e.text+'"]';for(n=0,a=s.length;n<a;n++)if(0===s[n].selectorText.indexOf('line[net="'+e.text+'"]')||0===s[n].selectorText.indexOf("line[net='"+e.text+"']")){l=s[n];break}var g=!p;!l&&g?o.insertRule(c+"{display:none;}",s.length):l&&(l.style.display=g?"none":"");Yo&&m(Yo,"net")==e.text&&(g?cr():dr(Yo))}}function In(e){if(Is!=ao.PCBLIB&&d("pcbNetStyle"))if(e)Tn(e);else{for(var t,r=d("pcbNetStyle").sheet,n=r.cssRules,i=0,a=n.length;i<a;i++)if(0===n[i].selectorText.indexOf("line[net]:not([net=")){t=n[i];break}if(e){var o='line[net]:not([net="'+e+'"])',s='line[net="'+e+'"][layerid="9"]:not([c_para])';if(t)t.selectorText=o;else{r.insertRule(o+"{display:none;}",i);r.insertRule(s+"{stroke: #fff;}",i+1)}}else if(t){r.deleteRule(i);r.deleteRule(i)}}}function Tn(e){if(Is!=ao.PCBLIB&&d("pcbNetStyle")){var t,r=d("pcbNetStyle").sheet,n=r.cssRules;for(t=n.length-1;t>=0;t--){var i=n[t].selectorText;(0===i.indexOf("line[net]:not([net=")||0===i.indexOf("line[net=")&&i.indexOf("polyline")<0)&&r.deleteRule(t)}if(e){var a='line[net]:not([net="'+e+'"])',o='line[net="'+e+'"][layerid="9"]',s=arguments;for(t=0;t<s.length;t++)if(s[t]){a+=':not([net="'+s[t]+'"])';o+=',line[net="'+s[t]+'"][layerid="9"]'}r.insertRule(a+"{display:none;}",n.length);r.insertRule(o+"{stroke: #fff;}",n.length)}}}function Rn(){var e,t,r,n,i=Fo.gJsonCache.FOOTPRINT,a={data:{},bindSCHId:Fo.gJsonCache.head.bindSCHId};for(var o in i)if(S(i,o)){e=i[o];n=Eo.c_paraToJson(e.head.c_para).package;t="";r="";for(var s in e.TEXT)S(e.TEXT,s)&&"P"==e.TEXT[s].type?t=e.TEXT[s].text:S(e.TEXT,s)&&"N"==e.TEXT[s].type&&(r=e.TEXT[s].text);if(t){a.data[t]={package:n,uuid:e.head.uuid||"",utime:e.head.utime||"",name:r,netNode:{},bindSCHId:e.head.bindSCHId||""};for(s in e.PAD)S(e.PAD,s)&&(a.data[t].netNode[e.PAD[s].number]=e.PAD[s].net)}}return a}function wn(e){for(var t,r,n=Fo.gJsonCache.SIGNALS[e]||[],i=0,a=[],o=[],s=[],l=[],c=0,p=n.length;c<p;c++){r=n[c];if(r&&("TRACK"==r.cmd||"VIA"==r.cmd||"ARC"==r.cmd)){t=d(r.gId);if(t&&!ss.isLocked(t)){o.push(t);a.push(["del",t.id,Eo.node.getRefId(t)]);"TRACK"==r.cmd&&l.push({wire:t.id});i++}}}s.forEach(function(e){qo.resetActiveCopperPolygons(Fo.gJsonCache.COPPERAREA[e]);es.addToRTree(Fo.gJsonCache.COPPERAREA[e],"COPPERAREA")});if(i>0){for(c=0;c<a.length;c++){t=o[c];Fo.removeOne(t);Ro.appendChild(t)}zo.save(a);Qo.buildOneNet(e,!1);for(c=0;c<l.length;c++)Ha(l[c])}return!0}function Nn(e){zo.startBatch();var t=Fo.getAllNetName()||[];D(e)&&(t=t.filter(function(t){return-1===e.indexOf(t)}));var r=t.every(wn);zo.saveBatch();return r}function kn(){var e,t,r={unit:Zo.canvas.unit},n=function(e){return Eo.units.convert(e,"pixel",Zo.canvas.unit)};for(e in Fo.gJsonCache.DRCRULE)if(S(Fo.gJsonCache.DRCRULE,e)){if("isRealtime"==e||"checkObjectToCopperarea"==e||"showDRCRangeLine"==e){r[e]=Fo.gJsonCache.DRCRULE[e];continue}if("itemBoardOutlineClearance"==e){r[e]=Eo.toFixed(n(Fo.gJsonCache.DRCRULE[e]),3);continue}for(t in Fo.gJsonCache.DRCRULE[e])if(S(Fo.gJsonCache.DRCRULE[e],t)){r[e]||(r[e]={});r[e][t]="nets"==t?Fo.gJsonCache.DRCRULE[e][t]:Eo.toFixed(n(Fo.gJsonCache.DRCRULE[e][t]),3)}}return r}function Mn(e){var t,r,n,i,a,o,s=e.unit||Zo.canvas.unit,l=function(e){return Eo.units.convert(e,s,"pixel")};if(!Eo.units.isUnit(s)){a="Invalid DRC Rule";parent.$.messager.alert(a);return!1}e:for(r in e)if(S(e,r)){t=e[r];if("unit"==r){if(!Eo.units.isUnit(t)){a="Invalid DRC Rule";break}}else if("isRealtime"==r||"checkObjectToCopperarea"==r||"showDRCRangeLine"==r){if("boolean"!=typeof t){a="Invalid DRC Rule";break}}else if("itemBoardOutlineClearance"==r){if(isNaN(t)){a="Invalid DRC Rule";break}e[r]=Eo.toFixed(l(t),lo.decimalPlaces)}else if("netRuleMap"==r);else for(n in t)if(S(t,n)&&"nets"!=n){i=t[n];i=Eo.toFixed(l(i),lo.decimalPlaces);if(!isFinite(i)){a="Invalid DRC Rule";break e}if(i<Ko.minLengthSize&&("trackWidth"==n||"clearance"==n)){o=n;break e}t[n]=i}}if(o){sr("warnDRCTooSmall",[o]);return!1}if(a){sr("messagerWarn",[a]);return!1}Fo.gJsonCache.DRCRULE={};for(n in e)S(e,n)&&"unit"!=n&&"netRuleMap"!=n&&(Fo.gJsonCache.DRCRULE[n]=e[n]);Fo.gJsonCache.netRuleMap=e.netRuleMap;Fo.gJsonCache.DRCRULE.Default||(Fo.gJsonCache.DRCRULE.Default={trackWidth:.6,clearance:1,viaHoleDiameter:2.4,viaHoleD:1.2});!function(){es.init();Ko.init();var e=function(e){var t={};for(var r in e)S(e,r)&&"function"!=typeof e[r]&&(t[r]=e[r]);return t}(Ko),t=function(){var e={},t=["ARC","PAD","VIA","SOLIDREGION","COPPERAREA","PLANEZONE"],r=function(r){for(var n=0;n<t.length;n++){var i=r[t[n]];for(var a in i)S(i,a)&&(e[a]=Eo.svg.getBBox(d(a)))}};r(Fo.gJsonCache);var n=Fo.gJsonCache.FOOTPRINT;for(var i in n)S(n,i)&&r(n[i]);return e}(),r=function(){var e={},t=function(t){var r=t.ARC;for(var n in r)if(S(r,n)){r[n].pointArr||(r[n].pointArr=pi({d:r[n].d}));e[n]=r[n].pointArr}};t(Fo.gJsonCache);var r=Fo.gJsonCache.FOOTPRINT;for(var n in r)S(r,n)&&t(r[n]);return e}();Do();Bo.onmessage=function(e){switch(e.data.type){case"DRCMgr.init":Ko.init();break;case"RTreeMgr.result":var t=e.data.data.trees;delete e.data.data.trees;Object.assign(es,e.data.data);for(var r in t)S(t,r)&&es.trees[r].fromJSON(t[r].data)}};Bo.onerror=function(){};Bo.postMessage({type:"RTreeMgr.rebuild",data:{doctype:Is,DOCTYPE:ao,LAYERTYPE:io,gJsonCache:Fo.gJsonCache,DRCMgr:e,bboxCache:t,arcPointArrCache:r,gVars:O(lo),copperAreaMgr:{copperPolygons:lo.copperNetRelation,_scaleFactor:qo._scaleFactor}},dependence:[d("pcb.rtreeMgrWorker.main").value,d("pcb.rtreeMgrWorker.dependence").value]})}();return!0}function Bn(e){if(Ko&&Ko.init&&Ko.doDRC){es.rebuild();Ko.init();return Ko.doDRC(e)}}function Dn(e){e&&Ko&&Ko._markError&&Ko._markError(e)}function Vn(e,r){var n=[],i=Eo.svg.getBBox(e);if(0==i.x&&0==i.y&&0==i.width&&0==i.height){for(var a in io){var o=p('[layerid="'+io[a]+'"]:not([c_para]):not([c_partid="part_pcbtext"])',e);n=n.concat(Array.prototype.slice.call(o))}n.forEach(function(e){e.style.display="inline"});i=Eo.svg.getBBox(e);n.forEach(function(e){e.style.display=""})}var s,l,c,d,u,f,g,y,v,x=[i.x,i.y,i.width,i.height],C=+x[0]+x[2]/2|0,L=+x[1]-3|0,_=L-5.5,P=Eo.c_paraToJson(m(e,"c_para")||"");e.id=Eo.newId();c=h("#"+e.id+' > g[c_partid="part_pcbtext"] > path[c_note="note_name"]',e);if(!c&&S(r,"name")){d=r.name?r.name:P.value?P.value:"";v={text:d,x:C,y:_,fontSize:4.5,fontFamily:""};y=sr("getFontPath",[v])||"M0,0";s='<g xmlns="http://www.w3.org/2000/svg" c_partid="part_pcbtext" c_origin="'+C+","+_+'" c_shapetype="group" layerid="3" display="none"><path c_note="note_name" c_fontSize="4.5" c_text="'+H(d)+'" d="'+y+'" fill="none" stroke-width="0.6"/></g>';g=I(s);if(g){c=t.importNode(g.documentElement,!0);e.insertBefore(c,e.firstChild)}}u=h("#"+e.id+' > g[c_partid="part_pcbtext"] > path[c_note="note_pre"]',e);if(!u&&S(r,"pre")){f=r.pre?r.pre:P.pre?P.pre:"";v={text:f,x:C,y:L,fontSize:4.5,fontFamily:""};y=sr("getFontPath",[v])||"M0,0";l='<g xmlns="http://www.w3.org/2000/svg" c_partid="part_pcbtext" c_origin="'+C+","+L+'" c_shapetype="group" layerid="3"><path c_note="note_pre" c_fontSize="4.5" c_text="'+H(f)+'" d="'+y+'" fill="none" stroke-width="0.6"/></g>';g=I(l);if(g){u=t.importNode(g.documentElement,!0);e.insertBefore(u,e.firstChild)}}e.id="";var A=Eo.svg.getBBox(u),b=x[1]-A.y-A.height,E=b-1;if(E>=.1||E<=-.1){v={text:f,x:C,y:L+E,fontSize:4.5,fontFamily:""};y=sr("getFontPath",[v])||"M0,0";m(u,"c_origin",C+","+v.y);m(u.firstChild,"d",y);v={text:d,x:C,y:_+E,fontSize:4.5,fontFamily:""};y=sr("getFontPath",[v])||"M0,0";m(c,"c_origin",C+","+v.y);m(c.firstChild,"d",y)}if(c&&lo.pcbFontsRegExp.test(d)){y=m(c.firstChild,"d");d=r.name?r.name:P.value?P.value:"";v={text:d,x:C,y:_,fontSize:4.5,fontFamily:lo.pcbServersFonts[0]};v.callback=function(r){var n,i,a,o;s='<g xmlns="http://www.w3.org/2000/svg" c_partid="part_pcbtext" c_origin="'+C+","+_+'" c_shapetype="group" layerid="3" display="none"><path c_note="note_name" c_fontSize="4.5" c_text="'+H(d)+'" d="'+r+'" stroke="none" c_fontFamily="'+lo.pcbServersFonts[0]+'" /></g>';g=I(s);if(g){n=t.importNode(g.documentElement,!0);i=Eo.svg.getBBox(u);a=i.x;o=i.y-2;It(n,a-C,o-_);c=mr("name",e);e.replaceChild(n,c)}};sr("getFontPath",[v])}}function Fn(e,t,r,n){var i=I(e);if(i){var a=i.documentElement,o={},s=Eo.c_paraToJson(m(a,"c_para")||"");r=r||Eo.svg.getBBox(a);o.area=r.width*r.height;o.footprintBBox=r;o.preObj={node:a,id:a.id};ki(a);Vn(a,{pre:t,name:n||s.value});Ls.appendElement(a);m(p("*[id]",a),"id","");jt(a);Vo.ini(t);return[o,a,r]}}function Gn(e,t){Fo.gJsonCache.DRCRULE.isRealtime=!0;t&&(Fo.gJsonCache.head.bindSCHId=t);ko=R();var r,n,i,a,o,s,l,c,d,p,h={},u=0;i=/.*?(?=\d+$)/;for(r in e)if(S(e,r)){if("maxGgei"===r)continue;try{l=e[r].footprint;s=h[l];o=s&&s.footprintBBox?s.footprintBBox:void 0;a=Fn(e[r].svgStr,r,o,e[r].name);u+=a[0].area;s||(h[l]={BBox:a[0].footprintBBox,footprints:[]});a[0].preObj.pre=r;n=+r.replace(i,"");a[0].preObj.preNumber=n;c=h[l].footprints;if(c.length){for(d=0,p=c.length;d<p;d++)if(n<c[d].preNumber){c.splice(d,0,a[0].preObj);break}d===p&&c.push(a[0].preObj)}else c.push(a[0].preObj)}catch(e){}}es.init();Yn(h,u);Fo.calAll();Qo.buildAllNet();Ls.show(io.RATLINES,!0);Zo.canvas.routeConflict=1;sr("triggerEvent",["layer_update"]);sr("updateAttrPanel");zo.clear({saved:!1})}function Yn(e,t){var r=ms.getViewBox(),n=r[0]+100/wo|0,i=r[1]+100/wo|0,a=0|Math.sqrt(2*t),o=1.5*a|0;!function(e,t,r,n,i){var a,o,s=" ",l="A"+i+s+i+" 0 0 1 ",c={"stroke-width":"1",fill:"none",c_shapetype:"line",c_etype:"wire",net:"",layerid:io.BOARDOUTLINE};if(i&&i>0){a=[e+i+s+t,e+r+s+t,e+r+s+(t+n),e+s+(t+n),e+s+(t+i)];o=[zt("polyline",{id:Eo.newId(),points:a.join(s)}),zt("path",{id:Eo.newId(),d:"M"+a[4]+l+a[0]})]}else{a=[e,t,e+r,t,e+r,t+n,e,t+n,e,t];o=[zt("polyline",{id:Eo.newId(),points:a.join(s)})]}m(o,c);for(var d=0;d<o.length;d++)Ls.appendElement(o[d])}(n,i,o,a,0);var s,l,c,p,u,f,g,y,v,x,C,L,_,P,A,b,E=0,O=0;L=+m(d("gridPattern"),"width");L<10&&(L=Math.ceil(10/L)*L);s=n;l=i+a+L;for(var I in e)if(S(e,I)){c=e[I];p=c.footprints;v=!0;for(x=0,C=p.length;x<C;x++){u=p[x].node;f=Eo.svg.getBBox(u);A=s-f.x;b=l-f.y;E=0;O=0;g=h('g[c_partid="part_pad"][c_origin]',u);g||(g=h("g[c_origin]",u));if(g){y=m(g,"c_origin");if(y){y=Eo.numberlistToArray(y);_=(y[0]+A)%L;if(_){_<0&&(_+=L);E=L-_}P=(y[1]+b)%L;if(P){P<0&&(P+=L);O=v&&P<L/2?-P:L-P}}}rs.move(u,Eo.toFixed(A+E,2),Eo.toFixed(b+O,2));l+=f.height+O;v=!1}l=i+a+L;s+=f.width+L/2+E}}function jn(t){function r(e,t){var r=_&&_[e].package;r&&t&&(P[r]=t)}function n(e){return Math.ceil(e/A+.5)*A}function i(e,t,i){var a=Fn(e,t,null,i),o=a[2];x.push({w:n(o.width),h:n(o.height+7.675),x:o.x,y:o.y,pre:t,elem:a[1]});r(t,o)}function a(e){var t=x[e],r=t.elem,n=m(r,"c_origin").split(",");n={x:+n[0],y:+n[1]};var i=Et({x:n.x+t.moveX,y:n.y+t.moveY});It(r,i.x-n.x,i.y-n.y)}function o(e,t){if(f.useBindIdCompaire&&!t)return h('#g1>g[bindSCHId="'+e+'"]');for(var r,n=p('#g1>g>g path[c_note="note_pre"]'),i=0;i<n.length;i++){r=m(n[i],"c_text");if(V(r||"").toUpperCase()==e.toUpperCase())return n[i].parentNode.parentNode}}function s(e,t){var r=o(e,"true"),n=m(r,"id");for(var i in t)for(var a=p("#"+n+' [number="'+i+'"]'),s=0;s<a.length;s++){var l=a[s];m(l,"net",t[i]);Fo.updateOne(l)}}var l,c,d,u,f=t[0],g=t[1],y=/^(.*?)(\d+(?:\.\d+)?)$/,v=Fo.gJsonCache,x=[],C=0;if(!v.FOOTPRINT||!Object.keys(v.FOOTPRINT).length){v.DRCRULE&&(v.DRCRULE.isRealtime=!0);Ls.show(io.RATLINES);sr("setVisiblePCBLayer",[io.RATLINES])}zo.clear({saved:!1});gClipboard.childNodes.length>0&&Eo.node.clearChildNodes(gClipboard);var L=parent.globalEditorClipboard;L&&L[1]==e.frameElement.id&&(parent.globalEditorClipboard=null);Gr();sr("triggerEvent",["select_change"]);m(p("#gNets > text[for^=gge]"),{for:"",display:"none"});sr("importChangesProgressUpdate",[.01]);var _=f.preCacheMap,P={},A=Math.max(Zo.adsorbGrid.gridSize,Zo.adsorbGrid.distanceX);A<10&&(A=Math.ceil(10/A)*A);ds.addTask(function(){for(var e in f.remove)if(S(f.remove,e)){var t=o(e);t&&Ka.removeChild(t)}var r=Eo.svg.getBBox(Ka);if(r.x||r.y||r.width||r.height){c=r.x+r.width+2*Zo.adsorbGrid.distanceX;d=r.y+r.height+2*Zo.adsorbGrid.distanceY}else{c=Zo.canvas.originX;d=Zo.canvas.originY}});for(l in f.add)if(S(f.add,l)&&f.packageSVG[l]&&f.packageSVG[l].svgStr){ds.addTask(i.bind(null,f.packageSVG[l].svgStr,l,f.preCacheMap[l].name));C++}ds.addTask(function(){if(x.length){u=new GrowingPacker;x.sort(function(e,t){if(e.h!=t.h)return t.h-e.h;if(e.w!=t.w)return t.w-e.w;if(e.pre[0]!=t.pre[0])return e.pre<t.pre?-1:1;var r=e.pre.match(y),n=t.pre.match(y);return r&&n&&r[1]==n[1]?r[2]-n[2]:e.pre<t.pre?-1:1});u.fit(x);x.forEach(function(e){e.moveX=c+e.fit.x-e.x;e.moveY=d+e.fit.y-e.y})}});for(;C--;)ds.addTask(a.bind(null,C));for(l in f.replace)S(f.replace,l)&&ds.addTask(Hn.bind(null,l,f.replace[l].name,f));for(l in f.changeNet)S(f.changeNet,l)&&ds.addTask(s.bind(null,l,f.changeNet[l]));ds.addTask(function(){Qo.removeAllRatline()});g&&ds.addTask(function(){for(var e in g)if(S(g,e)){var t=g[e];e=e.replace(/\\\"/g,"\\$&");var r=p('#g1 [net="'+e+'"]');r.length&&m(r,"net",t)}});ds.addTask(function(){var e=Eo.svg.getBBox(Ka);if(e.width&&e.height){var t=Eo.numberlistToArray(tr().viewBox);(e.x+e.width<t[0]||e.x>t[0]||e.y+e.height<t[1]||e.y>t[1])&&Mt(e)}});ds.addTask(function(){ko=1;[].forEach.call(p("#g1 [id^=gge]"),function(e){e.id=Eo.newId()});var e=Date.now();Fo.calAll();es.rebuild();b.calAll+=Date.now()-e});ds.addTask(function(){var e=Date.now();Qo.buildAllNet();b.buildAllNet+=Date.now()-e});ds.addTask(function(){P=null;if(Zo.isForceShowDRC||Object.keys(f.waitReplace).length)parent.$.messager.show({title:"OK",width:"150",msg:"Done",timeout:7e3,showType:"slide"});else{Zo.isForceShowDRC=!0;sr("pcb_DRC")}});ds.addTask(function(){sr("designManagerRefresh")});var b={findAndReplaceComponent:0,calAll:0,buildAllNet:0};ds.onProgress(function(e){e=Math.min(1,Math.max(e,.01));sr("importChangesProgressUpdate",[e])});ds.run();Object.keys(f.waitReplace).length&&sr("requestUpdateDlg",[f,!0])}function Hn(e,t,r){var n=Date.now(),i=r.preCacheMap,a={},o=Hr(e),s=r.packageSVG[r.replace[e].schPre],l={findAndReplaceComponent:0,calAll:0,buildAllNet:0};if(o&&s&&s.svgStr){var c=function(e){var t=i&&i[e].package;return t&&a[t]}(e),d=Fn(s.svgStr,r.replace[e].schPre,c,t);c||function(e,t){var r=i&&i[e].package;r&&t&&(a[r]=t)}(e,d[2]);if(Array.isArray(d)){var u=d[1],f=(m(o,"c_origin")||"0,0").split(","),g=(m(u,"c_origin")||"0,0").split(","),y=m(o,"c_rotation")||0;f[0]-=0;f[1]-=0;g[0]-=0;g[1]-=0;var v=f[0]-g[0],x=f[1]-g[1];ss.isLocked(o)&&m(u,"locked","1");if(m(o,"layerid")==io.BOTTOMLAYER){Ra(u,io.BOTTOMLAYER);Ls.moveElementToLayer(u,io.BOTTOMLAYER)}y%360&&ns.g(u,360-y,g[0],g[1]);!function(){var e=function(e,t){var r=h('[c_partid="part_pad"]',e),n=r&&m(r,"layerid"),i=n&&h('[c_partid="part_pad"][layerid="'+n+'"]',t);if(r&&i){var a=m(r,"c_origin").split(","),o=m(i,"c_origin").split(","),s=[o[0]-a[0],o[1]-a[1]];if(!isNaN(s[0])&&!isNaN(s[1]))return s}var l=mr("pre",e),c=mr("pre",t);l&&(l.style.display="none");c&&(c.style.display="none");var d=e.getBBox(),p=t.getBBox();l&&(l.style.display="");c&&(c.style.display="");return[p.x-d.x,p.y-d.y]}(u,o);if(e){v=e[0];x=e[1]}}();v=Eo.toFixed(v,2);x=Eo.toFixed(x,2);rs.move(u,v,x);for(var L=p("[id]",o),_=0;_<L.length;_++){var P=h('#gNets > text[for="'+L[_].id+'"]');P&&m(P,{for:"",display:"none"})}!function(){var e=mr("name",o),r=mr("name",u);if(e){var n=t||m(r.children[0],"c_text"),i={degree:+m(e,"c_rotation"),fontFamily:m(e.children[0],"c_fontFamily"),fontSize:m(e.children[0],"c_fontSize")||4.5,text:n,mirror:m(e,"c_mirror")||m(o,"layerid")==io.BOTTOMLAYER,x:m(e,"c_origin").split(",")[0],y:m(e,"c_origin").split(",")[1]};if(i.degree){i.rotateOriginX=i.x;i.rotateOriginY=i.y}if(lo.pcbServersFonts.indexOf(i.fontFamily)>-1||lo.pcbFontsRegExp.test(i.text)){i.fontFamily||(i.fontFamily=lo.pcbServersFonts[0]);i.callback=function(t){r=mr("name",u);u.replaceChild(e,r);m(e.children[0],"c_text",n);m(e.children[0],"d",t);m(e.children[0],"c_fontFamily",i.fontFamily);m(e.children[0],"stroke","none");C(e.children[0],"fill");C(e.children[0],"stroke-width")};sr("getFontPath",[i]);return}var a=sr("getFontPath",[i]);u.replaceChild(e,r);m(e.children[0],"c_text",n);m(e.children[0],"d",a)}}();Ka.removeChild(o);parent.$.messager.show({title:"OK",width:"150",msg:"Done",timeout:7e3,showType:"slide"});l.findAndReplaceComponent+=Date.now()-n}}}function Xn(){return Fo.gJsonCache.systemColor}function Un(e,t){for(var r=null,n=e.childNodes,i=null,a=null,o=0;o<n.length;o++)if("part_pcbtext"==m(n[o],"c_partid")){r=n[o];break}if(r){t&&(i=e.cloneNode(!0));var s=Number(m(e,"c_rotation")),l=Number(m(r,"c_rotation")),c=0;s>=315&&s<360||s>=0&&s<=45?c=0:s>45&&s<=135?c=90:s>135&&s<=225?c=0:s>225&&s<315&&(c=90);if(l!=c){var d=Le(360-(parseInt(c,10)-parseInt(l,10)));ns.rotate(r,d);m(r,"c_rotation",c);if(t&&i){a=e.cloneNode(!0);zo.save(["node",e.id,i,a])}}}}function Jn(e){var t=e.points,r=t.numberOfItems;if(r<2)return null;var n,i;if(Is===ao.PHOTOVIEW&&"bottomSide"===$o._side){n=Eo.svg.getBBox(Ka);i=2*n.x+n.width}for(var a=[],o=[],s=0;s<r;s++){a[s]=At(t.getItem(s));Is===ao.PHOTOVIEW&&"bottomSide"===$o._side&&(a[s].x=0-a[s].x+i);s>0?a[s].y==a[s-1].y?o[s]=o[s-1]+Math.abs(a[s].x-a[s-1].x):a[s].x==a[s-1].x?o[s]=o[s-1]+Math.abs(a[s].y-a[s-1].y):o[s]=o[s-1]+fe(a[s].x,a[s].y,a[s-1].x,a[s-1].y):o[s]=0}var l=o[r-1],c=l/2;for(s=1;s<r;s++)if(o[s]>=c&&o[s]>o[s-1]){var d=o[s]==c?.5:(o[s]-c)/(o[s]-o[s-1]),p=a[s].x-(a[s].x-a[s-1].x)*d,h=a[s].y-(a[s].y-a[s-1].y)*d,u=180*Math.atan2(a[s].y-a[s-1].y,a[s].x-a[s-1].x)/Math.PI|0;return{x:p,y:h,angle:u,len:c}}return null}function zn(){sr("updatePCBSnapSizeList",[os.getPCBSnapSizeList()])}function Wn(e,t){t=t||{fromHotKey:!1};var r;r=(Fo.gJsonCache.SIGNALS[e]||[]).map(function(e){return e.gId});pr(r,t);Is==ao.PCB&&Qo.highlightNets([e],t.fromHotKey);var n=ls.getWholeNetLength(e);n>0&&parent.$.messager.show({title:"Net Length",width:"150",msg:Eo.formatLengthShow(n)+Zo.canvas.unit,timeout:7e3,showType:"slide"})}function Zn(e){var t=function(e){return Eo.units.convert(e,"pixel",Zo.canvas.unit)},r="";e=e||h(".active",Ka);if(e&&"PAD"==Z(e)&&"POLYGON"==m(e,"c_shape")){var n=w(m(e.querySelectorAll(":not([c_padid]):not(title)")[0],"points"));if(n.length>1&&n.length%2==0){for(var i=0,a=n.length;i<a;i++)n[i]=i%2==1?Eo.toFixed(t(n[i]-Zo.canvas.originY),3):Eo.toFixed(t(n[i]-Zo.canvas.originX),3);r=n.join(" ")}}return r}function Kn(e,t){var r=function(e){return Eo.units.convert(e,Zo.canvas.unit,"pixel")},n=w(e),i=n.length;t=t||h(".active",Ka);if(t&&"PAD"==Z(t)&&"POLYGON"==m(t,"c_shape")&&i>=6){for(var a=0;a<i-1;a+=2){n[a]=Eo.toFixed(r(n[a])+Zo.canvas.originX,2);n[a+1]=Eo.toFixed(r(n[a+1])+Zo.canvas.originY,2)}e=n.join(" ");var o=t.cloneNode(!0);m(t.querySelectorAll(":not([c_padid]):not(title)")[0],"points",e);var s=Eo.svg.getBBox(t);m(t,{c_width:s.width,c_height:s.height});Fo.updateOne(t);Qo.buildOneNet(m(t,"net"),!1);var l=t.cloneNode(!0);zo.save(["node",t.id,o,l]);return!0}return!1}function qn(e){if("object"!=typeof e){var t=Fo.gJsonCache.routerRule,r=Fo.gJsonCache.DRCRULE.Default,n=Fo.gJsonCache.netRuleMap;t=t?E(JSON.stringify(t)):{};var i,a,o=Zo.canvas.unit,s=function(e){return Eo.formatLengthSave(Eo.units.convert(e,"pixel",o))},l={},c=[];r.viaHoleD=r.viaHoleDrill||r.viaHoleD;l.unit=o;l.trackWidth=s(r.trackWidth);l.trackClearance=s(r.clearance);l.viaHoleD=s(r.viaHoleD);l.viaDiameter=s(r.viaHoleDiameter);l.routerLayers="ALL";l.smdClearance=s(r.clearance);for(var d in l)S(l,d)&&!S(t,d)&&(t[d]=l[d]);if(t.unit!=o){var p=function(e){return Eo.formatLengthSave(Eo.units.convert(e,t.unit,o))};t.trackWidth=p(t.trackWidth);t.trackClearance=p(t.trackClearance);t.viaHoleD=p(t.viaHoleD);t.smdClearance=p(t.smdClearance);t.viaDiameter=p(t.viaDiameter);t.unit=o}if(D(t.specialNets)&&t.specialNets.length){for(var h=0;h<t.specialNets.length;h++)if(S(n,t.specialNets[h].net)){a=n[t.specialNets[h].net];i=Fo.gJsonCache.DRCRULE[a];t.specialNets[h].width=s(i.trackWidth);t.specialNets[h].clearance=s(i.clearance);c.push(t.specialNets[h].net)}else if(t.unit!=o){t.specialNets[h].width=p(t.specialNets[h].width);t.specialNets[h].clearance=p(t.specialNets[h].clearance)}for(var u in n)if(S(n,u)&&-1==c.indexOf(u)){a=n[u];i=Fo.gJsonCache.DRCRULE[a];i&&t.specialNets.push({net:u,width:s(i.trackWidth),clearance:s(i.clearance)})}}else t.specialNets=function(){var e,t,r=[];for(var n in Fo.gJsonCache.netRuleMap)if(S(Fo.gJsonCache.netRuleMap,n)){e=Fo.gJsonCache.netRuleMap[n];t=Fo.gJsonCache.DRCRULE[e];t&&r.push({net:n,width:s(t.trackWidth),clearance:s(t.clearance)})}return r}();t.nets=(Fo.getAllNetName()||[]).sort();t.padsCount=function(){function e(e){"PAD"==e.cmd&&n++}var t,r,n=0;r=Fo.gJsonCache.SIGNALS;for(t in r)S(r,t)&&r[t].forEach(e);return n}();return t}Fo.gJsonCache.routerRule||(Fo.gJsonCache.routerRule={});for(var f in e)S(e,f)&&("object"==typeof e[f]?Fo.gJsonCache.routerRule[f]=E(JSON.stringify(e[f])):Fo.gJsonCache.routerRule[f]=e[f])}function $n(){var e,t,r=Cs,n=r.target,i=r.controlLine;e=Ls.getActiveLayer();if("draw.track"===Uo&&n){var a,o,s,l,c=r.dots.length;if(c<4){m(n,"layerid",e);i&&m(i,"layerid",e)}else{t=m(n,"layerid");var d=n.tagName,p=!1!==bo.getCacheObj("AssignNet");if("polyline"==d){var h=n.points.numberOfItems;i.points.numberOfItems>1&&(h+=i.points.numberOfItems-1);if(2*h>c){o=n.cloneNode(!0);m(o,"points",r.dots.join(" "));m(o,"id",Eo.newId());C(o,"full_points");if(!m(o,"net")&&p&&Is!==ao.PCBLIB&&!bi(e)){s=br();m(o,"net",s);C(o,"c_auto_net");m(n,"net",s);m(n,"c_auto_net","1");i&&m(i,"net",s)}Ls.appendElement(o);Fo.updateOne(o);r.dots.splice(0,c-2);for(a=c/2-2;a>=0;a--)n.points.removeItem(a);m(n,"points",m(n,"points").replace(/,/g," "));m(n,"full_points",m(i,"points"));t!==e&&oi(t)&&oi(e)&&m(n,"c_need_via",t);m(n,"layerid",e);m(i,"layerid",e);m(n,"id",Eo.newId());r.certainPath=null;zo.save(["add",o.id,Eo.node.getRefId(o)])}else if(2*h==c){r.dots.splice(0,c-2);r.target=null;Ls.appendElement(n);s=m(n,"net")||"";if(!s&&p&&Is!==ao.PCBLIB&&!bi(e)){s=br();m(n,"net",s);i&&m(i,"net",s)}l=ei(r.dots[0],r.dots[1],s);Fo.updateOne(l);Fo.updateOne(n);r.certainPath="";zo.save(["add",n.id+","+l.id,Eo.node.getRefId(l)])}else{m(n,"layerid",e);m(i,"layerid",e)}}else if("path"==d)if(r.certainPath){m(n,"d",r.certainPath);r.certainPath="";s=m(n,"net");if(t&&!s&&p&&Is!==ao.PCBLIB&&!bi(e)){m(n,"net",br());s=m(n,"net");i&&m(i,"net",s)}var u=Eo.node.getRefId(n),f=di(n),g=f.map(function(e){return e.id}).join(",");Fo.updateMore(f);Qo.buildOneNet(s,!1);var y=["add",g,u];zo.save(y);var v=Cs.routedRealRatLine,x=r.dots.slice(-2);r.dots.length=0;r.target=null;r.draw(x[0],x[1],!0);r.draw(r.mockX,r.mockY,!1);n=r.target;if(n){t!==e&&oi(t)&&oi(e)&&m(n,"c_need_via",t);m(n,"layerid",e);p&&Is!==ao.PCBLIB&&!bi(e)&&m(n,"net",s);if(i){m(i,"layerid",e);p&&Is!==ao.PCBLIB&&!bi(e)&&m(i,"net",s)}r.draw(r.mockX,r.mockY,!1)}else{l=ei(x[0],x[1],s);Fo.updateOne(l);Fo.updateOne(n)}if(v){Cs.routedRealRatLine=v;2==Cs.routedRealRatLine[1]?m(Cs.routedRealRatLine[0],{x2:r.mockX,y2:r.mockY}):m(Cs.routedRealRatLine[0],{x1:r.mockX,y1:r.mockY})}}else{m(n,"layerid",e);m(i,"layerid",e)}}}if(("draw.copperArea"===Uo||"draw.copperArea"===Uo)&&n){m(n,"layerid",e);Ls.appendElement(n)}Uo&&Cs[Uo]&&Cs[Uo].onActiveLayerChange&&Cs[Uo].onActiveLayerChange({layeridNew:e})}function Qn(e,t,r){var n=Fo.ifFind(t,r,"",io.ALL,"TRACK");if("TRACK"==n.type||"ARC"==n.type){yr(e,n.X,n.Y);m(e,"net",n.net)}if("TRACK"==n.type){var i=ls.splitPloylineByPoint({x:n.X,y:n.Y},n.gId);if("object"==typeof i){var a=d(n.gId),o=a.cloneNode(!0),s=[];s[0]=["node",n.gId,a.cloneNode(!0),null];s[1]=["add","gge"+(ko+1)];m(a,"points",i[0]);m(o,{id:"gge"+ ++ko,points:i[1]});a.parentNode.insertBefore(o,a.nextSibling);Fo.updateOne(a);Fo.updateOne(o);s[0][3]=a.cloneNode(!0);return{history:s}}}}function ei(e,t,r){var n=d("part_via").cloneNode(!0);m(n,{id:"gge"+ ++ko,c_shapetype:"group",c_etype:"pinpart",net:r||""});C(n,"pointer-events");C(n,"display");Ls.appendElement(n);yr(n,e,t);return n}function ti(e,t){var r=e.querySelector('g path[c_note="note_pre"]');if(r){var n=m(r,"c_text");if(n&&(!(n.indexOf("?")<0)||t)){var i=m(r.parentNode,"c_origin")||"0,0",a=r.parentNode,o=+m(a,"c_rotation")||0,s=i.split(",");n=Vo.getNewPre(n);var l=m(r,"c_fontSize");m(r,"d",sr("getFontPath",[{text:n,x:s[0],y:s[1],fontSize:+l,fontFamily:"",degree:0}]));m(r,"c_text",n);var c=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER],d=+m(a,"layerid");c.indexOf(d)>=0&&is.flipH(a,s[0]);ns.rotate(a,Le(360-o),s[0],s[1]);o&&m(a,"c_rotation",o)}}}function ri(){var e=p("[layerid='"+io.BOARDOUTLINE+"']",Ka),t=d("part_board_frame");if(!t)return Eo.svg.getBBox(Ka);m(t,"display","");var r,n=0,i=e.length,a=0;if(i>=2)if("polyline"==e[0].tagName)for(a=1;a<i;a++){if("rect"!=e[0].tagName){n=0;break}n=1.1}else if("polyline"==e[i-1].tagName)for(a=0;a<i-1;a++){if("rect"!=e[0].tagName){n=0;break}n=1.2}else if(i>=3&&"path"==e[i-1].tagName&&"path"==e[i-2].tagName)for(a=0;a<i-2;a++){if("rect"!=e[0].tagName){n=0;break}n=2}else if(i>=9&&"path"==e[i-1].tagName&&"polyline"==e[i-2].tagName&&"path"==e[i-3].tagName&&"polyline"==e[i-4].tagName&&"path"==e[i-5].tagName&&"polyline"==e[i-6].tagName&&"path"==e[i-7].tagName&&"polyline"==e[i-8].tagName)for(a=0;a<i-8;a++){if("rect"!=e[0].tagName){n=0;break}n=3}else if("rect"==e[0].tagName&&"rect"==e[i-1].tagName)for(a=1;a<i-1;a++){if("rect"!=e[a].tagName){n=0;break}
n=4}else n=0;if(1.1==n)t.appendChild(e[0].cloneNode(!0));else if(4==n);else{var o=0;o=1.2==n?i-1:2==n?i-2:3==n?i-8:0;for(a=o,r=e.length;a<r;a++){var s=e[a].cloneNode(!0);C(s,"layerid");t.appendChild(s)}}var l=Eo.svg.getBBox(t);Eo.node.clearChildNodes(t);m(t,"display","none");return l}function ni(e){function t(e){var t=e.pointArr,r=t.length-1;return[t[0],t[r]]}function r(e,r){var n,i=null;for(var a in x){n=x[a];if(S(x,a)&&-1===[h,e,_.gId].indexOf(n.gId)&&n.strokeWidth==g){var o=t(n);if(!Pe(o[0],o[1])&&(Pe(r,o[0])||Pe(r,o[1]))){if(i)return null;i={track:n,point:Pe(r,o[0])?o[1]:o[0]}}}}return i}function n(e,t){return ue(e.x,e.y,t.x,t.y)}var i,a,o,s,l,c,p,h=e.id,u=m(e,"net")||"",f=m(e,"layerid"),g=m(e,"stroke-width"),y=e.points.getItem(0),v=e.points.getItem(e.points.numberOfItems-1),x=function(e){var t={},r=Fo.gJsonCache.TRACK;for(s in r)S(r,s)&&r[s].layerid===f&&r[s].net===e&&(t[s]=r[s]);return t}(u);if(!Pe(y,v)){for(s in x)if(S(x,s)&&s!=h&&x[s].layerid==f&&x[s].strokeWidth==g){l=x[s].pointArr;p=l.length-1;if(l&&p>0&&(Pe(l[0],y)&&Pe(l[p],v)||Pe(l[p],y)&&Pe(l[0],v)))return{type:"replace",track:d(s)}}var C=Fo.ifFind(y.x,y.y,u,f,"TRACK",h),L=Fo.ifFind(v.x,v.y,u,f,"TRACK",h);if(C&&L&&"TRACK"===C.type&&"TRACK"===L.type){if(C.strokeWidth!=g||L.strokeWidth!=g)return;if(C.gId!==L.gId){var _=x[C.gId],P=x[L.gId],A=function(e){for(var n=[],i=t(e),a=0;a<i.length;a++){for(var o=i[a],s=r(e.gId,o);s;){n.push(s);if(s.track.gId===P.gId){n.unshift({track:e,point:o});return n}s=r(s.track.gId,s.point)}n=[]}if(n.length<2)return!1}(_);if(A)return{type:"merge",track:A,points:function(){var t,r=d(_.gId),n=d(P.gId),i=se(y,r),a=se(v,n);t=Pe(A[0].point,r.points[0])?[].slice.call(r.points,Math.ceil(i/2)).reverse():[].slice.call(r.points,0,Math.ceil(i/2));var o;o=Pe(A[A.length-2].point,n.points[0])?[].slice.call(n.points,Math.ceil(a/2)):[].slice.call(n.points,0,Math.ceil(a/2)).reverse();var s=[];t.forEach(function(e){s.push(e.x,e.y)});s.push(m(e,"points"));o.forEach(function(e){s.push(e.x,e.y)});return Eo.fixLongNumberString(s.join(" "))}()}}}var b,E,O=Eo.svg.getBBox(e);O={x:O.x-1e-4,y:O.y-1e-4,width:O.width+2e-4,height:O.height+2e-4};for(s in x)if(S(x,s)&&s!=h&&x[s].layerid==f){i=d(s);if(!i||!Eo.isRectTouchRect(O,Eo.svg.getBBox(i)))continue;b=se(y,i);if(b<0)continue;E=se(v,i);if(E<0)continue;var I=[].slice.call(e.points,0);if(b>E){b=[E,E=b][0];I.reverse()}else if(b==E&&b%2){var T=i.points.getItem(b-1>>1);if(n(v,T)<n(y,T)){b=[E,E=b][0];I.reverse()}}b%2<1&&I.shift();E%2<1&&I.pop();if(!I.length&&(Math.abs(b-E)<2||E%2<1&&2==Math.abs(b-E)))return{type:"cancel"};a=[].slice.call(i.points,0,1+(b>>1)).concat(I,[].slice.call(i.points,E+1>>1));o=[];for(c=0;c<a.length;c++)o.push(a[c].x,a[c].y);a=Eo.fixLongNumberString(o.join(" "));return{type:"merge",track:i,points:a}}}}function ii(){if(("draw.track"==Uo||"draw.copperArea"==Uo||"draw.solidRegion"==Uo)&&Cs.target&&"0"!=Zo.canvas.angle){var e,t,r=Zo.canvas.angle,n=Cs.trackPreference[r];if(n){var i=["45-90","90-45","arc-90","90-arc","h-v","v-h","arc+","arc-"];e=i.indexOf(n);if(!(e<0)){t=e%2?i[e-1]:i[e+1];Cs.trackPreference[r]=t;Cs.draw(Cs.lastX,Cs.lastY,!1)}}}}function ai(){return p("[layerid='"+io.BOARDOUTLINE+"']",Ka)}function oi(e){e=+e;return e<io.TOPSILKLAYER||e>=io.INNER1||e==io.ALL}function si(e){return!!e&&e.parentNode==Ka}function li(e){return!!e&&"part_pcbtext"==m(e,"c_partid")&&"FOOTPRINT"==Z(e.parentNode)&&si(e.parentNode)}function ci(e){return"circle"==e.querySelectorAll(":not([c_padid]):not(title)")[1].tagName?"round":"slot"}function di(e){for(var t,r,n,i,a,o=[],s={"stroke-width":m(e,"stroke-width"),fill:"none",c_shapetype:"line",layerid:m(e,"layerid"),net:null===m(e,"net")?"":m(e,"net")},l=e.pathSegList,c=l.numberOfItems,d=[],p=0;p<c;p++){t=l.getItem(p);r=t.pathSegTypeAsLetter;if("M"==r)d=[t.x,t.y];else if("L"==r)d.push(t.x,t.y);else{if("A"!=r)throw"breakTrackPathElement invalid arguments";if(!n)throw"breakTrackPathElement invalid arguments";if(d.length>=4){i=zt("polyline",s);m(i,"points",d.join(" "));m(i,"id",Eo.newId());e.parentNode.insertBefore(i,e);o.push(i)}a="M"+n.x+" "+n.y+"A"+t.r1+" "+t.r2+" "+t.angle+" "+ +t.largeArcFlag+" "+ +t.sweepFlag+" "+t.x+" "+t.y;i=zt("path",{d:a});m(i,s);m(i,"id",Eo.newId());e.parentNode.insertBefore(i,e);o.push(i);d=[t.x,t.y]}n=t}if(d.length>=4){i=zt("polyline",s);m(i,"points",d.join(" "));m(i,"id",Eo.newId());e.parentNode.insertBefore(i,e);o.push(i)}v(e);return o}function pi(e,t){function r(e,t){return 2*Math.acos(e/(e+t))}function n(e,t){return{x:e.centerPoint.x+e.r*Math.cos(t),y:e.centerPoint.y+e.r*Math.sin(t)}}function i(e,t){var i=e.endAngle%c,a=e.startAngle%c;if(i!=a){i<0&&(i+=c);a<0&&(a+=c);for(;e.clockwise!=i>a;)i+=e.clockwise?c:-c;var o=r(e.r,s);e.clockwise||(o=-o);for(var l=a+o;o>0==l<i;l+=o)t.push(n(e,l));var d=e.endPoint?{x:e.endPoint.x,y:e.endPoint.y}:n(e,i);t.push(d)}}function a(e){return{x:Eo.formatLengthSave(e.x),y:Eo.formatLengthSave(e.y)}}var o,s=.001,l="convertArcToTrackPoints invalid arguments",c=2*Math.PI,d=e instanceof SVGPathElement,p=[];if(d||e.d)for(var h,u,f=d?e:zt("path",{d:e.d}),g=f.pathSegList,y=g.numberOfItems,v=0;v<y;v++){h=g.getItem(v);u=h.pathSegTypeAsLetter;if("M"==u||"L"==u){p.push({x:h.x,y:h.y});o={x:h.x,y:h.y}}else{if("A"!=u)throw l;if(!o)throw l;var x=function(e,t){if(t.r1!=t.r2)throw l;var r=Eo.arc.getCenterParam(+e.x,+e.y,t.x,t.y,+t.largeArcFlag,+t.sweepFlag,t.r1,t.r2,t.angle);if(!r)throw l;return{startPoint:e,endPoint:{x:t.x,y:t.y},centerPoint:{x:r.cx,y:r.cy},r:t.r1,startAngle:r.startAngle,endAngle:r.endAngle,deltaAngle:r.delta_theta,clockwise:t.sweepFlag}}(o,h);i(x,p);o={x:h.x,y:h.y}}}else{if(!(e.centerPoint&&e.endPoint&&e.r&&S(e,"startAngle")&&S(e,"endAngle")&&S(e,"clockwise")))throw l;o=e.startPoint?{x:e.startPoint.x,y:e.startPoint.y}:n(e,e.startAngle);p.push(o);i(e,p)}p=t?p.map(Ri):p.map(a);p=p.filter(function(e,t,r){return t<1||e.x!=r[t-1].x||e.y!=r[t-1].y});return p}function hi(e){var t,r,n,i,a,o,s,l,c,d,p={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"},u=/([MZLHVCSQTAmzlhvcsqta])([eE ,\-\+.\d]+)*/g,f=e.match(u),g=[];if(!f||!f.length)return[];for(t=0;t<f.length;t++){r=u.exec(e);if(Array.isArray(r)&&3===r.length&&r[2]&&r[2].trim()){a=r[2].match(/(?:[-+]?(?:(?:\d+\.\d+)|(?:(?:\d+)|(?:\.\d+)))(?:e[-+]?\d+)?)/gi);s=r[1].toLowerCase();if(p[s]&&(l=p[s])&&a.length>l){c=h[r[1]]?h[r[1]]:r[1];d=r[1];for(n=0,i=a.length;n<i;n+=l){o=a.slice(n,n+l);o.unshift(d);g.push(o);d=c}}else{a.unshift(r[1]);g.push(a)}}else{a=[r[1]];"z"==a[0]&&(a[0]="Z");g.push(a)}}return g}function ui(e,t){function r(e,t){var r=e.length-1;if(0===t)return e[0];if(1===t)return e[r];var n,i,a,o=e,s=1-t,l=s*s,c=t*t,d=0;if(2===r){o=[o[0],o[1],o[2],[0,0]];n=l;i=s*t*2;a=c}else if(3===r){n=l*s;i=l*t*3;a=s*c*3;d=t*c}return{x:n*o[0][0]+i*o[1][0]+a*o[2][0]+d*o[3][0],y:n*o[0][1]+i*o[1][1]+a*o[2][1]+d*o[3][1]}}function n(e,t){var n,i,a;if(isNaN(t)){n=0;for(i=1;i<e.length;i++)n+=fe(e[i][0],e[i][1],e[i-1][0],e[i-1][1]);t=n<1?4:(n+.5|0)*(3==e.length?2:4)}var o=[];for(a=0;a<=t;a++)o.push(r(e,a/t));return o}if("string"!=typeof e)return[];var i,a,o,s,l,c,d=null,p=null;e=hi(e);for(i=0,a=e.length;i<a;i++){l=e[i];c=l[0];switch(c){case"M":d=[{x:l[1],y:l[2]}];o=[l[1],l[2]];break;case"L":if(!D(d))return[];d.push({x:l[1],y:l[2]});o=[l[1],l[2]];break;case"H":if(!D(d))return[];d.push({x:l[1],y:o[1]});o=[l[1],o[1]];break;case"V":if(!D(d))return[];d.push({x:o[0],y:l[1]});o=[o[0],l[1]];break;case"Q":if(!D(d))return[];s=n([o,[l[1],l[2]],[l[3],l[4]]]);d.pop();d=d.concat(s);o=[l[3],l[4]];break;case"C":if(!D(d))return[];s=n([o,[l[1],l[2]],[l[3],l[4]],[l[5],l[6]]]);d.pop();d=d.concat(s);o=[l[5],l[6]];break;case"A":if(!D(d))return[];s=function(e,t){var r=+e[0],n=+e[1],i=+e[7],a=+e[8];if(Pe({x:r,y:n},{x:i,y:a}))return[{x:r,y:n},{x:i,y:a}];var o=Eo.arc.getCenterParam(r,n,i,a,+e[5],+e[6],+e[2],+e[3],+e[4]);isNaN(t)&&(t=Math.floor(Math.abs(o.delta_theta)/(2*Math.acos(o.rx/(o.rx+.001))))||1);for(var s=[],l=o.startAngle,c=o.delta_theta/t,d=0;d<=t;d++){s.push({x:o.cx+o.rx*Math.cos(l),y:o.cy+o.ry*Math.sin(l)});l+=c}var p=s[s.length-1];p&&!Pe(p,{x:i,y:a})&&s.push({x:p.x,y:p.y});return s}(o.concat(l.slice(1)),t);d.pop();d=d.concat(s);o=[l[6],l[7]];break;case"Z":case"z":!D(d)||d.length<3?d=[]:p&&p.length?p.hole&&p.hole.length?p.hole.push(d):p.hole=[d]:p=d}}!p&&d&&(p=d);return p}function fi(e,t){if(oi(e)){var r='polyline[layerid="*"], path[layerid="*"], g[c_partid="part_pad"][layerid="*"], g[c_partid="part_via"][layerid="*"]';r=r.replace(/\*/g,e);gi(p(r,Ka),void 0,t)}}function gi(t,r,n){function i(){var t=e.performance.now();V++;for(;c<u;){a(c++);if(c<u&&e.performance.now()-t>D){lo.updateNetTextTimer=setTimeout(i,30);break}}if(c>=u){lo.updateNetTextTimer=0;if(l){o.parentNode!=Go&&Go.insertBefore(o,Ka.nextSibling);lo.gNets=null}}}function a(e){for(var i,a=0;a<1;a++){f=v[e];t=y[e];var s=x[e],l=void 0===r?m(t,"net")||m(t,"number")||"":r,c=l.length*lo.netTextCharWidth||0,d=!!l&&A;if(d){var p=m(t,"layerid");d=b[p]}var u=t.netTextCache,g=!!u;h=I[s];i=void 0===h?null:O[h];if(d){var C=!0;i&&(C="none"!=m(i,"display"));if(i&&!0===n)C||m(i,"display","");else{var L,_,P=0,S=!1;if(g){L=u.x;_=u.y;P=u.angle}var E,w,N;if("PAD"==f||"VIA"==f){if(!u||$o.sideChanged){var k=+m(t,"c_width"),M=+m(t,"c_height"),B=m(t,"c_origin").split(","),D=+m(t,"c_rotation")||0;L=+B[0];_=+B[1];if(Is===ao.PHOTOVIEW&&"bottomSide"===$o._side){E=Eo.svg.getBBox(Ka);w=2*E.x+E.width;L=0-L+w}if((0===k||0===M)&&t.children.length>2){var V=Eo.svg.getBBox(t.children[2]);k=Eo.formatLengthSave(V.width);M=Eo.formatLengthSave(V.height)}if("ELLIPSE"==m(t,"c_shape"))P=0;else{P=k>=M?0:90;D&&(P-=D)}u={x:L,y:_,angle:P,len:Math.max(k,M)};t.netTextCache=u}S=(u.len-c)*wo<10;"VIA"==f&&wo>=10&&(S=!1)}else if("TRACK"==f&&t.points)if(!u||$o.sideChanged){var F=Jn(t);if(F){L=F.x;_=F.y;P=F.angle;S=!F.len||2*F.len<c}else{L=0;_=0;P=0;S=!0}u={x:L,y:_,angle:P,len:F&&F.len||0};t.netTextCache=u}else S=!u.len||2*u.len<c;else if("ARC"==f)if(!u||$o.sideChanged){N=t.getTotalLength();var G=t.getPointAtLength(N/2);L=G.x;_=G.y;var Y=t.getPointAtLength(.48*N);if(Is===ao.PHOTOVIEW&&"bottomSide"===$o._side){E=Eo.svg.getBBox(Ka);w=2*E.x+E.width;L=0-L+w;Y.x=0-Y.x+w;G.x=0-G.x+w}P=180*Math.atan2(G.y-Y.y,G.x-Y.x)/Math.PI|0;S=N<c;u={x:L,y:_,angle:P,len:N};t.netTextCache=u}else S=u.len<c;else{if("CIRCLE"!=f){if(i){m(i,{for:"",display:"none",transform:""});R.push(i)}continue}if(!u||$o.sideChanged){N=t.getTotalLength();var j=+Eo.toFixed(+m(t,"cx"),2,!0),H=+Eo.toFixed(+m(t,"cy"),2,!0),X=+Eo.toFixed(+m(t,"r"),2,!0);L=j;_=H+X;P=0;S=N<c;u={x:L,y:_,angle:P,len:N};t.netTextCache=u}else S=u.len<c}if(!i){if(R.length)i=R.pop();else if(T.length){h=T.pop();i=O[h]}if(i){m(i,"for",s);m(i,"display")&&m(i,"display","")}else{i=zt("text");m(i,"for",s);m(i,"dy","0.35em");o.appendChild(i)}}P&&(P>90?P-=180:P<=-90&&(P+=180));i.textContent=l;m(i,{x:L,y:_,transform:P?"rotate("+P+","+L+","+_+")":""});C==S&&m(i,"display",S?"none":"");if(Ao&&!S){var U=i.nextSibling;o.removeChild(i);o.insertBefore(i,U)}}}else if(i){m(i,{for:"",display:"none",transform:""});R.push(i)}}}var o=d("gNets")||lo.gNets,s="none"!=m(o,"display");if(!1===lo.pcbNetTextVisible||wo<8)m(o,"display","none");else{if(!s){m(o,"display","");s=!0}var l=void 0===t;if(l)o.parentNode==Go&&(lo.gNets=Go.removeChild(o));else if(o.parentNode!=Go){Go.insertBefore(o,Ka.nextSibling);lo.gNets=null}if(l&&""===r)m(o.children,"display","none");else{var c,h,u,f,g,y=[],v=[],x=[],C={},L='circle[net], polyline[layerid], path[layerid], g[c_partid="part_pad"][layerid], g[c_partid="part_via"][layerid]';l&&(t=p(L,Ka));if(t){B(t)||(t=[t]);for(c=0,u=t.length;c<u;c++){g=t[c];if(g&&g.id&&(g.parentNode||""===r)){f=Z(g);if("FOOTPRINT"==f){var _=p(L,g);for(h=0;h<_.length;h++)if(_[h].id){f=Z(_[h]);if("TRACK"==f||"PAD"==f||"ARC"==f||"VIA"==f){v.push(f);y.push(_[h]);x.push(_[h].id);C[_[h].id]=!0}}}else if("TRACK"==f||"PAD"==f||"ARC"==f||"VIA"==f||"CIRCLE"==f){v.push(f);y.push(g);x.push(g.id);C[g.id]=!0}}}var P=m(Go,"viewBox").split(" ").map(parseFloat),A=(P[0],P[2],P[1],P[3],wo>=8&&!1!==lo.pcbNetTextVisible),b={},E=Ls.getLayersCache();for(c in E)S(E,c)&&(b[c]=Ls.isVisible(c)&&oi(c));E=null;var O=o.children,I={},T=[],R=[],w=0,N=0,k=0;for(c=0,u=O.length;c<u;c++){var M=m(O[c],"for");if(M)if(l&&!C[M]){k++;w++;T.push(c);m(O[c],{for:"",display:"none",transform:""})}else{I[M]=c;N++}else{T.push(c);w++}}var D=20,V=0;c=0;u=y.length;e.performance.now();i()}}}}function yi(){var e,t,r,n,i=un().filter(function(t){e=Z(t);return"VIA"===e||"ARC"===e||"TRACK"===e||"RECT"===e||"SOLIDREGION"===e});if(i.length){zo.startBatch();var a=[];i.forEach(function(i){e=Z(i);r=m(i,"layerid");if(r==io.TOPLAYER||r==io.BOTTOMLAYER||"VIA"==e){t=i.cloneNode(!0);if("VIA"!==e){m(t,"layerid",r==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER);Ls.appendElement(t)}jt(t);zo.save(["add",t.id]);y(t,"active");if("TRACK"===e||"ARC"===e)m(t,{"stroke-width":1*m(t,"stroke-width")+.4,net:""});else if("RECT"===e){n=wt(i);m(t,{x:n.x-.2,y:n.y-.2,width:1*n.width+.4,height:1*n.height+.4})}else if("VIA"===e){i.parentNode.insertBefore(t,i);n=wt(i);var o=t.firstChild,s=wt(o);m(t,{c_partid:"part_pad",plated:"Y",c_width:2*s.r,c_height:2*s.r,c_shape:"ELLIPSE",layerid:io.ALL});var l=zt("ellipse",{cx:s.cx,cy:s.cy,rx:s.r,ry:s.r,stroke:"none","stroke-width":0});t.insertBefore(l,o);t.removeChild(o);zr([i],!0);a.push(n.net)}else if("SOLIDREGION"===e){m(t,{type:"solid"});C(t,"fill")}r==io.TOPLAYER?Ls.show(io.TOPSOLDERLAYER):Ls.show(io.BOTTOMSOLDERLAYER);sr("triggerEvent",["select_change"]);Fo.updateOne(t);"VIA"===e&&Qo.buildGroupNets(a)}});zo.saveBatch()}}function vi(e){if(D(e)){if(e.length>1){var t=Ut(e);t.closed.forEach(function(e){e.forEach(function(e){Pi(e)})});return sr("messagerAlert",["Does not support multiple objects to convert to Board Cutout at the same time"])}e=e[0]}var r,n=Z(e);if("TRACK"===n){var i=m(e,"points").match(/\-?\d[\.\d]*(\s+|,)\-?\d[\.\d]*/g),a=m(e,"stroke-width")/2;r=zt("path",{"stroke-width":0,c_shapetype:"line",layerid:11,type:"npth"});m(r,"d",Li(i,a))}else if("ARC"===n||"CIRCLE"===n){var o,s,l,c,d=1*m(e,"stroke-width"),p=m(e,"d");o="CIRCLE"===n?1*m(e,"r"):1*p.match(/A\s*(-?\d+[\.\d]*)/)[1];var h=o-d/2,u=o+d/2;if("CIRCLE"===n){s=1*m(e,"cx");l=1*m(e,"cy");c="M"+s+" "+(l+u)+" A"+u+","+u+" 0 1 0 "+(s-.01)+" "+(l+u)+" Z"}else{var f=p.match(/M\s*(-?\d+[.\d]*[,\s]+-?\d+[.\d]*)/)[1],g=1*f.split(/[,\s]+/)[0],y=1*f.split(/[,\s]+/)[1],v=p.match(/-?\d+[.\d]*[,\s]+-?\d+[.\d]*$/)[0],x=1*v.split(/[,\s]+/)[0],C=1*v.split(/[,\s]+/)[1],L=p.match(/\s+([01]\s+[01]\s+[01])\s+/)[1].split(/\s+/),_=Eo.arc.getCenterParam(g,y,x,C,L[1],L[2],o,o,0);s=_.cx;l=_.cy;var P=y-l,A=g-s,b=C-l,S=x-s,E=P*h/o+l,O=A*h/o+s,I=P*u/o+l,T=A*u/o+s,R=b*h/o+l,w=S*h/o+s,N=b*u/o+l,k=S*u/o+s;c="M"+O+","+E+" A"+h+","+h+" "+L[0]+" "+L[1]+" "+L[2]+" "+w+","+R+" A "+d/2+","+d/2+" "+L[0]+" 1 "+("1"==L[2]?"0":"1")+" "+k+" "+N+" A"+u+","+u+" "+L[0]+" "+L[1]+" "+("1"==L[2]?"0":"1")+" "+T+" "+I+" A"+d/2+","+d/2+" "+L[0]+" 1 "+("1"==L[2]?"0":"1")+" "+O+" "+E+" Z"}r=zt("path",{"stroke-width":0,c_shapetype:"line",layerid:"11",type:"npth",d:c})}jt(r);Ls.appendElement(r);ji(r);Fo.updateOne(r);zo.startBatch();var M=e.id;zr([e]);zo.save(["del",M]);zo.save(["add",r.id]);zo.saveBatch()}function xi(e){if(D(e)){if(e.length>1){sr("messagerAlert",["Does not support multiple objects to convert to pad at the same time"]);return}e=e[0]}var t,r=Z(e);if("TRACK"===r){t=Li(m(e,"points").match(/-?\d[.\d]*(\s+|,)-?\d[\.\d]*/g),m(e,"stroke-width")/2)}else if("ARC"===r){var n,i,a,o=1*m(e,"stroke-width"),s=m(e,"d");n=1*s.match(/A\s*-?(\d+[.\d]*)/)[1];var l=n-o/2,c=n+o/2,d=s.match(/M\s*(-?\d+[.\d]*[,\s]+-?\d+[.\d]*)/)[1],p=1*d.split(/[,\s]+/)[0],h=1*d.split(/[,\s]+/)[1],u=s.match(/-?\d+[.\d]*[,\s]+-?\d+[.\d]*$/)[0],f=1*u.split(/[,\s]+/)[0],g=1*u.split(/[,\s]+/)[1],y=s.match(/\s+([01]\s+[01]\s+[01])\s+/)[1].split(/\s+/),v=Eo.arc.getCenterParam(p,h,f,g,y[1],y[2],n,n,0);i=v.cx;a=v.cy;var x=h-a,C=p-i,L=g-a,_=f-i,P=x*l/n+a,A=C*l/n+i,b=x*c/n+a,S=C*c/n+i,E=L*l/n+a,O=_*l/n+i,I=L*c/n+a,T=_*c/n+i;t="M"+A+","+P+" A"+l+","+l+" "+y[0]+" "+y[1]+" "+y[2]+" "+O+","+E+" A "+o/2+","+o/2+" "+y[0]+" 1 "+("1"==y[2]?"0":"1")+" "+T+" "+I+" A"+c+","+c+" "+y[0]+" "+y[1]+" "+("1"==y[2]?"0":"1")+" "+S+" "+b+" A"+o/2+","+o/2+" "+y[0]+" 1 "+("1"==y[2]?"0":"1")+" "+A+" "+P+" Z"}var R,w,N,M=e.getBBox();if("TRACK"===r||"ARC"===r){var B=e.getTotalLength();R=e.getPointAtLength(B/2);N=ui(t)}else if("SOLIDREGION"===r){var V=M.x+M.width/2;N=ui(m(e,"d"));R=mi(V,N)}w=k(N);var F=Eo.newId();Uo="place.part_pad";var G=zt("g",{c_partid:"part_pad",c_type:"pinpart",number:Cs.getNextName(),layerid:"1",net:"",c_origin:R.x+","+R.y,c_rotatio:"0",c_width:M.width,c_height:M.height,c_shape:"POLYGON",id:F,c_shapetype:"group",c_etype:"pinpart",layer_front:"1",layer_show:"1"});Uo="";var Y=zt("polygon",{"stroke-width":"0.8",c_padid:F,layerid:io.TOPSOLDERLAYER,points:w}),j=zt("polygon",{"stroke-width":"0",c_padid:F,layerid:io.TOPPASTERLAYER,points:w}),H=zt("polygon",{stroke:"none","stroke-width":"0",layerid:io.TOPLAYER,points:w}),X=zt("circle",{cx:R.x,cy:R.y,r:0,stroke:"none","stroke-width":0,layerid:io.TOPLAYER});G.appendChild(Y);G.appendChild(j);G.appendChild(H);G.appendChild(X);Ls.appendElement(G);ji(G);Fo.updateOne(G);zo.startBatch();zr([e]);zo.save(["add",F]);zo.saveBatch();xn([G]);sr("updateAttrPanel")}function mi(e,t){for(var r=t.length,n=[],i=0;i<r;i++){var a=t[i],o=0===i?t[r-1]:t[i-1],s=De(o,a,1,0,-e);s&&n.push(s)}n.sort(function(e,t){return e.y-t.y});return{x:Eo.formatLengthSave(e),y:Eo.formatLengthSave((n[0].y+n[1].y)/2)}}function Ci(e,t,r,n){var i,a,o=e[t];if(o){if("string"==typeof o){var s=o.split(/(\s+|\s*,\s*)/);i=1*s[0];a=1*s[s.length-1]}else{i=1*o.x;a=1*o.y}var l,c,d,p,h,u,f,g,y,v,x,m,C,L,_,P,A=e[t+1],b=e[t-1],S=Ci(e,t-1,r,!0);if(A){if("string"==typeof A){l=A.split(/(\s+|\s*,\s*)/);c=1*l[0];d=1*l[l.length-1]}else{c=1*A.x;d=1*A.y}f=Math.atan2(a-d,i-c);g=180-180*f/Math.PI}else g=S.deg;C=Math.sin(g*Math.PI/180)*r*-1;L=Math.cos(g*Math.PI/180)*r*-1;x=C+i;m=L+a;if(!A){_=x;P=m}if(b&&A){if("string"==typeof b){p=b.split(/(\s+|\s*,\s*)/);h=1*p[0];u=1*p[p.length-1]}else{h=1*b.x;u=1*b.y}v=je({x:h,y:u},{x:i,y:a},{x:c,y:d});f=Math.atan2(u-a,h-i);y=180-180*f/Math.PI;C=Math.sin(y*Math.PI/180)*r*-1;L=Math.cos(y*Math.PI/180)*r*-1;_=C+i;P=L+a;if(!n){var E=Ci(e,t+1,r,!0),O=le({x:S.x,y:S.y},{x:_,y:P},{x:x,y:m},{x:E.x_1,y:E.y_1});if(O){x=O.x;_=O.x;m=O.y;P=O.y}}}return{x:x,y:m,x_1:_,y_1:P,deg:g,arc:O?null:v}}}function Li(e,t){function r(e){var r,n,i,a,o,s="M";e.forEach(function(l,c){a=e[c+1];o=e[c-1];l===a&&e.splice(c,1);r=Ci(e,c,t);0===c&&(n=r);c===e.length-1&&(i=r);var d="";d=o&&a&&r.arc?" "+r.x_1+" "+r.y_1+" A"+t+","+t+("顺时针"===r.arc?" 0 0 1 ":" 0 0 0 ")+r.x+" "+r.y:" "+r.x+" "+r.y;s+=d+(c===e.length-1?"":" L")});return{d:s,first:n,last:i}}var n,i=r(e),a=r(e.reverse());n=i.d+" A"+t+","+t+" 0 0 1"+a.d.replace("M","")+" A"+t+","+t+" 0 0 1 "+i.first.x+" "+i.first.y+" Z";return n}function _i(e,t){var r,n="";if("string"==typeof e){n=e;r="path"}else{e.forEach(function(e){n+=" "+e.x+" "+e.y});r="polyline"}var i=zt(r,{stroke:t||"yellow","stroke-width":.1,opacity:.8});jt(i);m(i,"path"===r?"d":"points",n);Ka.appendChild(i)}function Pi(e,t,r,n){if("object"==typeof e){var i=O(e);n=r;r=t;e=i.x;t=i.y}if(e&&t){var a=zt("circle",{cx:e,cy:t,r:.5,fill:n||"blue",title:r,opacity:.5});Ka.appendChild(a)}}function Ai(e){var t,r,n=Fo.gJsonCache.DRCRULE||{};if(!Fo.gJsonCache.SIGNALS||!Fo.gJsonCache.SIGNALS[e]){t="Default";r=Eo.extend({},n[t]);r.ruleName=t;return r}if(Fo.gJsonCache.netRuleMap&&Fo.gJsonCache.netRuleMap[e]){t=Fo.gJsonCache.netRuleMap[e];r=n[t];r=Eo.extend({},r);r.ruleName=t;return r}t="Default";r=Eo.extend({},n[t]);r.ruleName=t;r.viaHoleDrill&&!r.viaHoleD&&(r.viaHoleD=r.viaHoleDrill);delete r.viaHoleDrill;return r}function bi(e,t){if(!isNaN(+e)){if(e==io.ALL&&t)return!0;if(Fo.gJsonCache.layers[e]&&"Plane"===Fo.gJsonCache.layers[e].type&&Fo.gJsonCache.layers[e].config)return!0}return!1}function Si(e,t){if(!e||!e.cssRules)return null;for(var r,n=e.cssRules,i=0;i<n.length;i++){r=n[i].selectorText.match(/\[layerid="(\d+)"\]/);if(r&&r[1]==t)return n[i]}return null}function Ei(e,t,r){if(e&&e.cssRules&&-1!==[io.ALL,io.TOPLAYER,io.BOTTOMLAYER].indexOf(+t)){var n,i=e.cssRules;if(r)e.insertRule('g[c_partid="part_pad"] > *[c_padid][c_padlayerid="'+t+'"] {pointer-events: initial;}',e.cssRules.length);else for(var a=0;a<i.length;a++){n=i[a].selectorText.match(/\[c_padlayerid="(\d+)"\]/);if(n&&n[1]==t){e.deleteRule(a);break}}}}function Oi(e,t){var r;r=h('[layerid="'+io.BOTTOMSOLDERLAYER+'"][c_padid]',e);r&&e.removeChild(r);r=h('[layerid="'+io.TOPSOLDERLAYER+'"][c_padid]',e);r&&e.removeChild(r);r=h('[layerid="'+io.BOTTOMPASTERLAYER+'"][c_padid]',e);r&&e.removeChild(r);r=h('[layerid="'+io.TOPPASTERLAYER+'"][c_padid]',e);r&&e.removeChild(r);var n,i,a,o,s,l,c,d,u,f,g,y,v=wt(e),x=v.layerid,C=Ls.getActiveLayer(),L=isNaN(v.solderExpansion)||""===v.solderExpansion?.4:+v.solderExpansion,_=+v.pasteExpansion||0;switch(t){case"RECT":case"POLYGON":a=h("polygon",e);o=m(a,"points");if(x==io.ALL){n=[zt("polygon",{points:o,"stroke-width":2*L,c_padid:v.id,c_padlayerid:x,layerid:io.BOTTOMSOLDERLAYER}),zt("polygon",{points:o,"stroke-width":2*L,c_padid:v.id,c_padlayerid:x,layerid:io.TOPSOLDERLAYER})];e.insertBefore(n[0],io.BOTTOMSOLDERLAYER==C?null:a);e.insertBefore(n[1],io.TOPSOLDERLAYER==C?null:a)}else if(x==io.TOPLAYER||x==io.BOTTOMLAYER){i=zt("polygon",{points:o,"stroke-width":2*_,c_padid:v.id,c_padlayerid:x,layerid:x==io.TOPLAYER?io.TOPPASTERLAYER:io.BOTTOMPASTERLAYER});n=zt("polygon",{points:o,"stroke-width":2*L,c_padid:v.id,c_padlayerid:x,layerid:x==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER});e.insertBefore(n,(x==io.TOPLAYER?io.TOPPASTERLAYER:io.BOTTOMPASTERLAYER)==C?null:a);e.insertBefore(i,(x==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER)==C?null:a)}break;case"OVAL":a=h("polyline",e);o=m(a,"points");f=+m(a,"stroke-width");g=f+2*_;y=f+2*L;o=o.split(" ").reduce(function(e,t,r){return 1==r?"M"+e+" "+t:r%2==0?e+"L"+t:e+" "+t});if(x==io.ALL){n=[zt("path",{d:o,"stroke-width":y,c_padid:v.id,c_padlayerid:x,layerid:io.BOTTOMSOLDERLAYER}),zt("path",{d:o,"stroke-width":y,c_padid:v.id,c_padlayerid:x,layerid:io.TOPSOLDERLAYER})];e.insertBefore(n[0],io.BOTTOMSOLDERLAYER==C?null:a);e.insertBefore(n[1],io.TOPSOLDERLAYER==C?null:a)}else if(x==io.TOPLAYER||x==io.BOTTOMLAYER){i=zt("path",{d:o,"stroke-width":g,c_padid:v.id,c_padlayerid:x,layerid:x==io.TOPLAYER?io.TOPPASTERLAYER:io.BOTTOMPASTERLAYER});n=zt("path",{d:o,"stroke-width":y,c_padid:v.id,c_padlayerid:x,layerid:x==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER});e.insertBefore(n,(x==io.TOPLAYER?io.TOPPASTERLAYER:io.BOTTOMPASTERLAYER)==C?null:a);e.insertBefore(i,(x==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER)==C?null:a)}break;case"ELLIPSE":a=h("ellipse",e);s=+m(a,"rx");l=+m(a,"cx");c=+m(a,"cy");d=s+_;u=s+L;if(x==io.ALL){n=[zt("ellipse",{cx:l,cy:c,rx:u,ry:u,"stroke-width":0,c_padid:v.id,c_padlayerid:x,layerid:io.BOTTOMSOLDERLAYER}),zt("ellipse",{cx:l,cy:c,rx:u,ry:u,"stroke-width":0,c_padid:v.id,c_padlayerid:x,layerid:io.TOPSOLDERLAYER})];e.insertBefore(n[0],io.BOTTOMSOLDERLAYER==C?null:a);e.insertBefore(n[1],io.TOPSOLDERLAYER==C?null:a)}else if(x==io.TOPLAYER||x==io.BOTTOMLAYER){i=zt("ellipse",{cx:l,cy:c,rx:d,ry:d,"stroke-width":0,c_padid:v.id,c_padlayerid:x,layerid:x==io.TOPLAYER?io.TOPPASTERLAYER:io.BOTTOMPASTERLAYER});n=zt("ellipse",{cx:l,cy:c,rx:u,ry:u,"stroke-width":0,c_padid:v.id,c_padlayerid:x,layerid:x==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER});e.insertBefore(n,(x==io.TOPLAYER?io.TOPPASTERLAYER:io.BOTTOMPASTERLAYER)==C?null:a);e.insertBefore(i,(x==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER)==C?null:a)}break;case"CIRCLE":a=h("circle",e);s=+m(a,"r");l=+m(a,"cx");c=+m(a,"cy");d=s+_;u=s+L;if(x==io.ALL){n=[zt("ellipse",{cx:l,cy:c,rx:u,ry:u,"stroke-width":0,c_padid:v.id,c_padlayerid:x,layerid:io.BOTTOMSOLDERLAYER}),zt("ellipse",{cx:l,cy:c,rx:u,ry:u,"stroke-width":0,c_padid:v.id,c_padlayerid:x,layerid:io.TOPSOLDERLAYER})];e.insertBefore(n[0],io.BOTTOMSOLDERLAYER==C?null:a);e.insertBefore(n[1],io.TOPSOLDERLAYER==C?null:a)}else if(x==io.TOPLAYER||x==io.BOTTOMLAYER){i=zt("ellipse",{cx:l,cy:c,rx:d,ry:d,"stroke-width":0,c_padid:v.id,c_padlayerid:x,layerid:x==io.TOPLAYER?io.TOPPASTERLAYER:io.BOTTOMPASTERLAYER});n=zt("ellipse",{cx:l,cy:c,rx:u,ry:u,"stroke-width":0,c_padid:v.id,c_padlayerid:x,layerid:x==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER});e.insertBefore(n,(x==io.TOPLAYER?io.TOPPASTERLAYER:io.BOTTOMPASTERLAYER)==C?null:a);e.insertBefore(i,(x==io.TOPLAYER?io.TOPSOLDERLAYER:io.BOTTOMSOLDERLAYER)==C?null:a)}}var P=p(":not([layerid])",e);P.length&&m(P,"layerid",x)}function Ii(e){for(var t="invisible"==e?"none":"",r=p("path[attachedcopperid]",Ka),n=0,i=r.length;n<i;n++)m(r[n],"display",t)}function Ti(e,t){"string"==typeof e&&(e=ui(pointArr));var r=ClipperLib.OffsetPolyline(e.map(Ri),Ni(t)),n=[];if(r[0]&&r[0].length)for(var i=0,a=r[0].length;i<a;i++){var o=wi(r[0][i]);n.push(new c(o.x,o.y))}return n}function Ri(e){return{x:Math.round(1e4*e.x),y:Math.round(1e4*e.y)}}function wi(e){return{x:e.x/1e4,y:e.y/1e4}}function Ni(e){return Math.round(e*qo._scaleFactor)}function ki(e){if(e)for(var t=p("rect",e),r=0;r<t.length;r++){var n=t[r],i=n.nextSibling;v(n);var a=Number(m(n,"x")),o=Number(m(n,"y")),s=Number(m(n,"width")),l=Number(m(n,"height")),c=Eo.convertRect2Polygon(a,o,s,l).join(" "),d="M"+c+"Z";if("none"==m(n,"fill"))var h=zt("polyline",{points:c+" "+a+" "+o,"stroke-width":m(n,"stroke-width"),fill:"none",layerid:m(n,"layerid"),id:m(n,"id"),locked:m(n,"locked"),c_shapetype:m(n,"c_shapetype"),c_etype:"wire"});else h=zt("path",{d:d,"stroke-width":m(n,"stroke-width"),layerid:m(n,"layerid"),id:m(n,"id"),locked:m(n,"locked"),c_shapetype:m(n,"c_shapetype"),type:"solid"});e.insertBefore(h,i)}}function Mi(){p("path[attachedcopperid]").forEach(function(e){e.parentNode.removeChild(e)});lo.copperNetRelation={};Qo.buildAllNet()}function Bi(e){return!isNaN(+e)&&-1===[3,4,12,13,14,15].indexOf(parseInt(e))}function Di(e){if(e.tagName&&"circle"===e.tagName){var t=wt(e),r=+t.cx,n=+t.cy,i=+t.r,a=r-i,o=r+i,s={start:{x:a,y:n},end:{x:o,y:n},r:i,layerid:t.layerid,strokeWidth:t["stroke-width"],netId:t.net,autoNet:t.autoNet||null};return ls.getArcFromCircle(s)}}function Vi(e){if(e&&e.tagName&&"circle"===e.tagName&&Bi(parseInt(m(e,"layerid")))){var t=[];m(e,"transformArc")&&(t=m(e,"transformArc").split(","));var r=Di(e);if(r){if(2===t.length){m(r[0],"id",t[0]);m(r[1],"id",t[1])}else{var n=r[0].id+","+r[1].id;m(e,"transformArc",n);Fo.gJsonCache.CIRCLE&&S(Fo.gJsonCache.CIRCLE,e.id)&&(Fo.gJsonCache.CIRCLE[e.id].transformArc=n)}r.forEach(function(e){Ls.appendElement(e);Fo.updateOne(e,{noText:!0});v(e)})}}}function Fi(e){if(e.tagName&&"circle"===e.tagName&&Bi(parseInt(m(e,"layerid")))){var t=[];m(e,"transformArc")&&(t=m(e,"transformArc").split(","));var r=Di(e);r&&2===t.length&&Fo.gJsonCache.ARC&&r.forEach(function(e,r){if(Fo.gJsonCache.ARC[t[r]]){var n=Z(e),i=_s[n](e),a=i.d.match(/([-+]?\d+(\.\d+)?)/g);i.arcParams=a;i.pointArr=pi(e,!1);i.centerParam=Eo.arc.getCenterParam(+a[0],+a[1],+a[7],+a[8],+a[5],+a[6],+a[2],+a[3],+a[4]);i.gId=t[r];Fo.gJsonCache.ARC[t[r]]=i}})}}function Gi(e,t){if(!e||!e.cssRules)return null;for(var r=e.cssRules,n=Fo.gJsonCache.objectMap,i=0;i<r.length;i++)if(r[i].selectorText==n.objects[t].selectorText)return r[i];return null}function Yi(e){if(e){var t,r,n,i=m(e,"c_partid"),a={Prefix:'g[c_partid="part_pcbtext"] > path[c_note="note_pre"]',Name:'g[c_partid="part_pcbtext"] > path[c_note="note_name"]',Text:"path[c_text]"};if(i&&(0===i.indexOf("part_import_")||"part_pcbtext"===i)){if(0===i.indexOf("part_import_"))delete a.Text;else{delete a.Prefix;delete a.Name}var o=Fo.gJsonCache.objectMap;for(var s in a)if(S(a,s)){t=p(a[s],e);n=o.objects[s].selected;for(r=0;r<t.length;r++)t[r].parentNode.style["pointer-events"]=n?"":"none"}}}}function ji(e,t,r){if(!uo.ready&&!fo.ready){var n,i,o,s,l=Fo.gJsonCache.objectMap;if(!t){if(!e)return;t=Xi(e);if("Footprint"===t){if(0===m(e,"c_partid").indexOf("part_import_")){var c=["Component","Prefix","Name"];for(i=0;i<c.length;i++){t=c[i];if(S(l.objects,t)){n=l.objects[t].visible;if(r)a("object_show",[t,n]);else{if("Component"===t){s=p('g[c_partid^="part_import_"] > :not([c_partid="part_pcbtext"]',e);for(o=0;o<s.length;o++)s[o].setAttribute("display",n?"":"none");s=p('g[c_partid^="part_import_"] > g[c_partid="part_pad"] > *',e);for(o=0;o<s.length;o++)s[o].setAttribute("display",n?"":"none");s=p('g > g[c_partid="part_pcbtext"] > path[c_text]:not([c_note]',e);for(o=0;o<s.length;o++)s[o].parentNode.setAttribute("display",n?"":"none");s=null;continue}"Prefix"===t?h('path[c_note="note_pre"]',e)&&(s=h('path[c_note="note_pre"]',e).parentNode):"Name"===t&&h('path[c_note="note_name"]',e)&&(s=h('path[c_note="note_name"]',e).parentNode);s&&s.setAttribute("display",n?"":"none")}}}return}t="Image"}}if(S(l.objects,t)){n=l.objects[t].visible;if(r)a("object_show",[t,n]);else if("Pad"===t){s=p('g[c_partid="part_pad"] > *',e);for(o=0;o<s.length;o++)s[o].setAttribute("display",n?"":"none")}else e.setAttribute("display",n?"":"none")}}}function Hi(e){if(e&&e.length)for(var t=0,r=e.length;t<r;t++)ji(e[t])}function Xi(e){var t=Z(e);if(!t)return null;var r=t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase();"Solidregion"===r?r="Solid Region":"Svgnode"===r&&(r="Image");return r}function Ui(){function e(e){var t=e.target;t&&1!==t.nodeType&&t.parentNode&&(t=t.parentNode);if(!t||!t.tagName||"TEXTAREA"!=t.tagName.toUpperCase()){e.preventDefault();e.stopPropagation();return!1}}for(var r=["selectstart","drag","draggesture","dragstart","dragover"],n=0;n<r.length;n++)t.addEventListener(r[n],e,!1);void 0!==_o&&_o&&t.addEventListener("mousedown",function(e){if((vo?e.metaKey:e.ctrlKey)&&0===e.button){Go.currentScale=1;Go.currentTranslate.x=0;Go.currentTranslate.y=0}},!1)}function Ji(e){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.ready=!1;this.start=!1;e&&e.ondragstart&&(this.ondragstart=e.ondragstart);e&&e.ondrag&&(this.ondrag=e.ondrag);e&&e.ondragend&&(this.ondragend=e.ondragend)}function zi(e){var r=this;r.x0=0;r.y0=0;r.x1=0;r.y1=0;r.target=null;r.ready=!1;r.start=!1;if(e)for(var n in e)S(e,n)&&(r[n]=e[n]);t.addEventListener("mousedown",r.mdown,!1)}function Wi(e){var t=this;t.x0=0;t.y0=0;t.x1=0;t.y1=0;t.ready=!1;t.start=!1;t.mouseIsDown=!1;t.mousedownTarget=Go;t.mousemoveTarget=Go;t.mouseupTarget=Go;if(e&&e instanceof Object)for(var r in e)S(e,r)&&(t[r]=e[r]);t.e={};t.e.mdown=function(e){t.mdown.call(t,e)};t.e.mmove=function(e){t.mmove.call(t,e)};t.e.mup=function(e){t.mup.call(t,e)}}function Zi(){return uo&&uo.start||fo&&fo.start||go&&go.start}function Ki(){var e={rect:hs,show:function(e,t,r,n){m(hs,{display:"",width:r,height:n,x:e,y:t})},showD:function(e,t,r,n){m(hs,{display:"",width:Math.abs(r),height:Math.abs(n),x:r>0?e:e+r,y:n>0?t:t+n})},hide:function(){m(hs,{display:"none"})}};uo=new Ji({ondragstart:function(e){zo.tmpNode=this.target.cloneNode(!0)},ondrag:function(e){},ondragend:function(e){var t=this.target;"line"==m(t,"c_shapetype")&&dr(t);var r=m(t,"layerid"),n=Z(t);Fi(t);Fo.updateOne(t,{notCopper:!0});"CIRCLE"==n&&Bi(parseInt(r))&&Qo.buildOneNet(m(t,"net"),!0);"TRACK"!=n&&"ARC"!=n&&"CIRCLE"!=n||!bi(r)||qo.rebuildPlane(r);"TRACK"!=n&&"ARC"!=n&&"SOLIDREGION"!=n||Qo.buildOneNet(m(t,"net"),!0);zo.save(["node",t.id,zo.tmpNode,t.cloneNode(!0)]);zo.tmpNode=null}});fo=new zi({ondragstart:function(e){var t,r,n=this,i=n.target,a=n.selectedObjs,o=[],s=[];cr();var l=0==a.filter(function(e){return"TEXT"!=Z(e)}).length;for(t=0,r=a.length;t<r;t++)li(a[t])&&m(a[t],"oldOrigin",m(a[t],"c_origin"));if(n.atPartNoteText&&l){for(t=0,r=a.length;t<r;t++)o.push(["node",a[t].id,a[t].cloneNode(!0),null]);n.hist=o}else{if(Is==ao.PCB){n._build_duration=void 0;n._padsCount=void 0;if(a.length<2){var c=Sn(a);Qo.highlightNets(c);n._padsCount=p('g[c_partid="part_pad"]',Ka).length}var h,u,f=Ps.calFollowing(a),g=f.followingWireIds,y=Xa({pad:i.id});for(t=0;t<y.length;t++)s.push(["del",y[t].id,Eo.node.getRefId(y[t])]);Ha({pad:i.id},!0);n.tracks={};for(h in g)if(S(g,h)){u=d(h);if(u){
o.push(["node",h,u.cloneNode(!0),null]);n.tracks[h]=function(e){function t(e,t,r){function n(n){n=n||0;var i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)),o=Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)),s=180*Math.acos((a*a+i*i-o*o)/(2*a*i))/Math.PI;return Math.abs(s-n)<=1}return n(90)||n(180)?e.x===t.x?"v-h":e.y===t.y?"h-v":"45-90":Math.abs(e.x-t.x)<=1||Math.abs(e.y-t.y)<=1?"90-45":"45-90"}for(var r=e.points,n={points:[]},i=0;i<r.numberOfItems;i++){var a=r.getItem(i);n.points.push(a.x);n.points.push(a.y)}if(r.numberOfItems<3){n.start="90-45";n.end="45-90";return n}n.start=t(r.getItem(0),r.getItem(1),r.getItem(2));n.end=t(r.getItem(r.numberOfItems-3),r.getItem(r.numberOfItems-2),r.getItem(r.numberOfItems-1));return n}(u);y=Xa({wire:h});for(t=0;t<y.length;t++)s.push(["del",y[t].id,Eo.node.getRefId(y[t])]);Ha({wire:h},!0)}}n.followingInfo=f}o.wiresCount=o.length;for(t=0,r=a.length;t<r;t++)o.push(["node",a[t].id,a[t].cloneNode(!0),null]);n.hist=o;n.teardropHist=s}},ondrag:function(e){var t=this,r=t.selectedObjs,n=0==r.filter(function(e){return"TEXT"!=Z(e)}).length;if(!t.atPartNoteText||!n)if(Is==ao.PCB){Ps.moveFollowing(t.followingInfo,t.movedX,t.movedY,t.tracks);var i,a=t.followingInfo.followingWireIds;for(i in a)S(a,i)&&Fo.updateOne(d(i));Fo.updateMore(r,{notCopper:!0});if(r.length<2){var o=t._build_duration>50&&Date.now()-t._build_last<2*t._build_duration;if(o){t._timer_build&&clearTimeout(t._timer_build);t._timer_build=setTimeout(function(e){return function(){t._timer_build=0;var r=Date.now();Qo.buildRatLinesOfPCBLib(e);t._build_duration=Date.now()-r;t._build_last=Date.now()}}(r),100)}else{var s=Date.now();Qo.buildRatLinesOfPCBLib(r);t._build_duration=Date.now()-s;t._build_last=Date.now()}}}else Fo.updateMore(r,{notCopper:!0})},ondragend:function(e){var t=this,r=(t.target,t.selectedObjs),n=0==r.filter(function(e){return"TEXT"!=Z(e)}).length,i=!(!t.movedX&&!t.movedY);for(y=0,v=r.length;y<v;y++){var a=r[y];if(li(a)){var o,s=p("path[c_note=note_pre]",a),l=p("path[c_note=note_name]",a),c=!s.length&&!l.length;s.length>0?o=xa(s,"oldOrigin","pre"):l.length>0?o=xa(l,"oldOrigin","name"):c&&(o=xa([a],"oldOrigin","libtext"));o&&parent.$.messager.show({title:"Warning",width:"400",msg:"The prefix or name or text too far away from the footprint, if you don't want it to show up please make it hidden.",timeout:5e3,showType:"slide"})}}if(t.atPartNoteText&&n){Fo.updateMore(r,{notCopper:!0});if(t.hist&&i){for(y=0,v=t.hist.length;y<v;y++)t.hist[y][3]=r[y].cloneNode(!0);zo.save(t.hist);t.hist=null}}else{Is==ao.PCB&&Qo.cancelHighlightNets();if(1==r.length&&"line"==m(r[0],"c_shapetype")){Yo&&Yo!=r[0]&&Gr();dr(r[0]);Yo=r[0];u(Yo,"active",!0)}1==r.length&&sr("updateAttrPanel");var h,f,g,y,v,x,C=0,L=0,_=t.hist,P=t.teardropHist;_||(_=[]);_.wiresCount||(_.wiresCount=0);if(Is==ao.PCB&&_.wiresCount)for(y=0,v=_.wiresCount;y<v;y++){h=_[y][1];f=d(h);if(m(f,"points")!=m(_[y][2],"points")){C++;if(f.points.numberOfItems<2){g=Eo.node.getRefId(f);Fo.removeOne(f);m(f,"points",m(_[y][2],"points"));Ro.appendChild(f);_[y]=["del",h,g]}else{_[y][3]=f.cloneNode(!0);Fo.updateOne(f)}}else _[y].length=0}Fo.updateMore(r,{notCopper:!0,notUpdateElement:!0});if(Is==ao.PCB||Is==ao.PCBMODULE){var A,b=[];for(y=0,v=r.length;y<v;y++){O=Z(r[y]);if("ARC"==O||"CIRCLE"==O){A=m(r[y],"layerid");bi(A)&&b.push(A)}else if("FOOTPRINT"==O){var S=Fo.gJsonCache.FOOTPRINT[r[y].id];if(S)var E=function(e){function t(e,t){return e?t.concat(Object.keys(e).map(function(t){return e[t]})):[]}var r=[];r=t(S.ARC,r);r=t(S.VIA,r);r=t(S.PAD,r);return r}();E.forEach(function(e){A=e.layerid;bi(A)&&b.push(A)})}}b.length>0&&qo.rebuildPlane(b)}if(Is==ao.PCB){var O="";for(y=0,v=r.length;y<v;y++){O=Z(r[y]);"SOLIDREGION"==O?Qo.buildOneNet(m(r[y],"net"),!0):"FOOTPRINT"==O&&Qo.buildRatLinesOfPCBLib(r[y])}}for(y=0,v=r.length;y<v;y++){x=_[y+_.wiresCount];if(x)if(!i&&Eo.node.isSame(x[2],r[y]))x.length=0;else if("path"==r[y].tagName&&m(r[y],"attachedcopperid"))x.length=0;else{L++;x[3]=r[y].cloneNode(!0)}}sr("buildCopper");zo.startBatch();_.length&&(C||L)&&zo.save(_);P.length>0&&zo.save(P);zo.saveBatch();t.hist=null;t.teardropHist=null}}});go=new Wi({strictMousedownTarget:Go,onmousedown:function(e,t){if(Uo)return!1;if(uo.start)return!1;if(fo.start)return!1;if(Is==ao.PHOTOVIEW)return!1;if(!e.shiftKey){var r=un();if(r.length>0){Gr(r);sr("triggerEvent",["select_change"])}}},onready:function(e,t){Gr()},ondragstart:function(e,t){},ondrag:function(t,r){0!==r.dx&&0!==r.dy?Io.pasting||e.showD(r.x0,r.y0,r.dx,r.dy):e.hide()},ondragend:function(t,r){if(!Io.pasting){e.hide();var n,i,o,s,l,c,d={x:r.dx>0?r.x0:r.x0+r.dx,y:r.dy>0?r.y0:r.y0+r.dy,width:r.dx>0?r.dx:-r.dx,height:r.dy>0?r.dy:-r.dy},h=Ka.children,g=h.length,y=[],v=Fo.gJsonCache.objectMap;if(v&&!v.objects.Component.selected)for(var x="",C=0;C<h.length;C++){x=h[C].getAttribute("c_partid");x&&0===x.indexOf("part_import_")?y.push(!0):y.push(!1)}for(var L,_,P=!0,A=g;--A>=0;){l=h[A];c=getComputedStyle(l);if((!c||"none"!=c.display)&&(!c||"none"!=c.pointerEvents)){var b=m(l,"layerid");if((!b||Ls.isVisible(b))&&0!==l.id.indexOf("layer_")&&!m(l,"attachedcopperid")){try{i=ft(l)}catch(e){continue}if(i.width||i.height){_=Xi(l);P=!_||"FOOTPRINT"==_||!S(v.objects,_)||v.objects[_].selected;if(P){if(r.dx>0)o=Eo.isRectInRect(i,d);else{o=Eo.isRectTouchRect(i,d);o&&("polyline"==l.tagName?o=Eo.isPolylineTouchRect(l,d):"polygon"==l.tagName&&(o=Eo.isPolygonTouchRect(l,d)))}n=f(l,"selected");if(o!=n&&!y[A]){u(l,"selected",o);s=!0}if(y[A])for(var E=[{selected:v.objects.Prefix.selected,selectorStr:'path[c_note="note_pre"]',isParent:!0},{selected:v.objects.Name.selected,selectorStr:'path[c_note="note_name"]',isParent:!0}],O=0;O<E.length;O++)if(E[O].selected){L=p(E[O].selectorStr,h[A]);for(C=0;C<L.length;C++){l=L[C];E[O].isParent&&(l=l.parentNode);var I=m(l,"display");if("none"!==I){try{i=ft(l)}catch(e){continue}if(i.width||i.height){o=r.dx>0?Eo.isRectInRect(i,d):Eo.isRectTouchRect(i,d);n=f(l,"active");if(o!=n){u(l,"active",o);s=!0}}}}}}}}}}s&&sr("triggerEvent",["select_change"]);a("dragMoveCheck",[t])}}})}function qi(e){var r,n,i,a=Io;if(a.on!==e){if(a.on&&a.waitingSave&&a.targets){if(a.pasting)return;if(a.offsetX||a.offsetY){Fo.updateMore(a.targets);if(Is==ao.PCB){a.targets.forEach(function(e){Vi(e)});Qo.buildRatLinesOfPCBLib(a.targets)}if(a.crossProbePlaceMoves){r=a.crossProbePlaceMoves;n=[];for(i=0;i<r.length;i++)n.push(["move",r[i].id,r[i].offsetX+a.offsetX,r[i].offsetY+a.offsetY]);zo.save(n);a.crossProbePlaceMoves=null}else zo.save(["move",a.ids,a.offsetX,a.offsetY])}a.targets=null;a.ids="";a.waitingSave=0}Mr();a.on=void 0!==e?e:!a.on;!a.on&&a.targets&&(a.targets=null);ur(a.on?"grab":void 0);if(!1===e&&a.bind||null===a.targets){a.bind=!1;t.removeEventListener("mousemove",ra,!1);t.removeEventListener("mouseup",ea,!1);t.removeEventListener("keydown",na,!1);moveRelatively.end()}$r.fn.on&&!1===e&&$r.fn.cancelPaste()}}function $i(e,r){if(Io.on){Io.targets=r||un();if(!(Io.targets.length<=0)){var n=Io,i=rr(e,!1);n.startX=i.x;n.startY=i.y;n.offsetX=0;n.offsetY=0;n.hasPin=!!h('g.selected[c_partid="part_pad"], g.selected g[c_partid="part_pad"]');r||(r=n.targets);u(Ka,"hidetext",!1);for(var a=r[0].id,o=r.length,s=1;s<o;s++)a+=","+r[s].id;n.ids=a;n.waitingSave=0;ur("grabbing",n.startX,n.startY);if(!Io.bind){Io.bind=!0;t.addEventListener("mousemove",ra,!1);setTimeout(function(){t.addEventListener("mouseup",ea,!1)},1)}}}}function Qi(e){var r=Io;if(r.on&&r.pasting&&r.waitingSave&&r.targets&&(r.offsetX||r.offsetY)){Fo.updateMore(r.targets,{notCopper:!0});if(Is==ao.PCB){r.targets.forEach(function(e){Vi(e)});Qo.buildRatLinesOfPCBLib(r.targets)}if(r.crossProbePlaceMoves){var n=r.crossProbePlaceMoves,i=[];for(a=0;a<n.length;a++)i.push(["move",n[a].id,n[a].offsetX+r.offsetX,n[a].offsetY+r.offsetY]);zo.save(i);r.crossProbePlaceMoves=null}else zo.save(["move",r.ids,r.offsetX,r.offsetY])}r.pasting=!0;r.targets=e.targets;r.startX=e.x;r.startY=e.y;r.offsetX=0;r.offsetY=0;r.hasPin=e.hasPin;u(Ka,"hidetext",!1);var a,o=r.targets[0].id,s=r.targets.length;for(a=1;a<s;a++)o+=","+r.targets[a].id;r.ids=o;r.waitingSave=1;if(!r.bind){r.bind=!0;t.addEventListener("mousemove",ra,!1);t.addEventListener("keydown",na,!1);setTimeout(function(){t.addEventListener("mouseup",ea,!1)},1)}}function ea(e){var t,r,n,i=Io;if(i.on){fr(!1);if(i.pasting)ta(e);else if(e.button===ro){if(i.waitingSave&&i.targets){Fo.updateMore(i.targets,{notCopper:!0});if(Is==ao.PCB){i.targets.forEach(function(e){Vi(e)});Qo.buildRatLinesOfPCBLib(i.targets);var o=[];i.targets.forEach(function(e){var t=m(e,"layerid"),r=Z(e);bi(t)&&"TRACK"===r&&o.push(t)});qo.rebuildPlane(o)}if(i.crossProbePlaceMoves){t=i.crossProbePlaceMoves;r=[];for(n=0;n<t.length;n++)r.push(["move",t[n].id,t[n].offsetX+i.offsetX,t[n].offsetY+i.offsetY]);zo.save(r);i.waitingSave=0;i.crossProbePlaceMoves=null}else{zo.save(["move",i.ids,i.offsetX,i.offsetY]);i.waitingSave=0}}a("dragMoveSwitch",[!1]);i.on=!0;ur("grab")}else if(e.button===no){if(i.crossProbePlaceMoves){t=i.crossProbePlaceMoves;for(n=0;n<t.length;n++)It(d(t[n].id),-t[n].offsetX-i.offsetX,-t[n].offsetY-i.offsetY);i.crossProbePlaceMoves=null}else i.targets&&(i.offsetX||i.offsetY)&&Tt(i.targets,-i.offsetX,-i.offsetY);i.targets=null;i.ids="";i.waitingSave=0;cr();a("dragMoveSwitch",[!1])}}}function ta(e){var t,r=Io;if(r.on){if(e&&e.button!==ro){if(e&&e.button===no){var n=r.targets;for(t=n.length-1;t>=0;t--){v(n[t]);"COPPERAREA"==Z(n[t])&&vs&&vs.removeChild(h('[copper_id="'+n[t].id+'"]'))}sr("triggerEvent",["select_change"])}}else{$r.fn.position&&$r.fn.cancelPaste();Hi(r.targets);Fo.updateMore(r.targets,{notCopper:!0});if(Is==ao.PCB){r.targets.forEach(function(e){Vi(e)});Qo.buildRatLinesOfPCBLib(r.targets)}zo.save(["add",r.ids])}delete r.pasting;for(t=0;t<r.targets.length;t++)Yi(r.targets[t]);r.targets=null;r.ids="";r.waitingSave=0;a("dragMoveSwitch",[!1])}}function ra(e){var t=Io;t.targets=t.targets.filter(function(e){return!ss.isLocked(e)});var r=rr(e,!1),n=r.x-t.startX,i=r.y-t.startY;os.altKeyEnabled=e.altKey;if(t.hasPin||Zo.adsorbGrid.enabled){var a=os.getSanpSize("X"),o=os.getSanpSize("Y");n=Math.round(n/a)*a;i=Math.round(i/o)*o}var s=n-t.offsetX,l=i-t.offsetY;if(s||l){Tt(t.targets,s,l);t.offsetX+=s;t.offsetY+=l;Yo&&"FOOTPRINT"!==Z(Yo)&&dr(Yo);t.waitingSave=1}var c=m(t.targets[0],"c_origin");c&&!ps.started&&fr(+c.split(",")[0],+c.split(",")[1])}function na(e){if(27==e.keyCode){var t=Io;if(t.on){for(var r=t.targets,n=r.length-1;n>=0;n--){v(r[n]);"COPPERAREA"==Z(r[n])&&vs&&vs.removeChild(h('[copper_id="'+r[n].id+'"]'))}delete t.pasting;t.targets=null;t.ids="";t.waitingSave=0;a("dragMoveSwitch",[!1]);$r.fn.cancelPaste()}}}function ia(e){this.startX=0;this.startY=0;this.ready=0;this.start=0;this.target=null;this.oldPoints=[];this.pIndex=-1;if(e)for(var r in e)S(e,r)&&(this[r]=e[r]);ia.instance=this;t.addEventListener("mousedown",this.mdown,!1)}function aa(e,t){var r=e.points.getItem(t>>1),n=e.points.getItem(t+1>>1),i=r.y-n.y,a=r.x-n.x,o=Math.PI;ur((a?Math.abs(Math.atan(i/a)/o):.5)<.25?"row-resize":"col-resize")}function oa(){new ia({ondragstart:function(e){var t,r,n,i,a,o,s,l=e.target,c=e.dx,d=e.dy,p=l.points,h=p.numberOfItems,f=ia.instance;if(l!==Yo)if(Yo)Gr();else{Yo=l;u(Yo,"active",!0);dr(l);sr("triggerEvent",["select_change"])}"wire"==Z(l)&&junctionUtils.solveItem(l,"old");Lt(l);if(h!=l.points.numberOfItems){p=l.points;h=p.numberOfItems;s=9;r=se({x:e.x0,y:e.y0},l,s)}else r=f.pIndex;r<=0?r=1:r%2==0&&r--;f.pIndex=r;n=Pt(l);t=r>>1;i=n[t];a=n[t+1];i={x:i.x+c,y:i.y+d};a={x:a.x+c,y:a.y+d};if(h>2&&t===h-2){o=n[h-1];n.push({x:o.x,y:o.y});p.appendItem(At(o));h++}if(h>2&&0===t){o=n[0];n.unshift({x:o.x,y:o.y});p.insertItemBefore(At(o),0);h++;r+=2;f.pIndex=r}f.oldPoints=n},ondrag:function(e){var t,r,n,i,a,o,s,l,c,p,h,u,f,g,y,v=e.target,x=e.dx,m=e.dy,C=v.points,L=C.numberOfItems,_=ia.instance;r=_.pIndex;n=Pt(v).length>2?_.oldPoints:Pt(v);if(n&&d(v.id)){t=r>>1;i=n[t];a=n[t+1];o={x:i.x+x,y:i.y+m};s={x:a.x+x,y:a.y+m};var P,A;if(n.length>2){l=n[t-1];i=n[t];a=n[t+1];c=n[t+2];if(_.snap){p={x:e.x1,y:e.y1};h=ne(o,s,p);u=Et(h);o.x+=u.x-h.x;o.y+=u.y-h.y;s.x+=u.x-h.x;s.y+=u.y-h.y}if(ue(l.x,l.y,i.x,i.y)<1){f=oe(o,s,{x:l.x+1,y:l.y},i);f||(f=oe(o,s,{x:l.x,y:l.y+1},i))}else f=oe(o,s,l,i);if(ue(a.x,a.y,c.x,c.y)<1){g=oe(o,s,a,{x:c.x+1,y:c.y});g||(g=oe(o,s,a,{x:c.x,y:c.y+1}))}else g=oe(o,s,a,c);y=le(l,f,a,g);if(y){f=y;g=y}}else{f=o;g=s;if(_.snap){P=Et(f);A=Et(g);ue(P.x,P.y,f.x,f.y)<=ue(A.x,A.y,g.x,g.y)?A={x:g.x+P.x-f.x,y:g.y+P.y-f.y}:P={x:f.x+A.x-g.x,y:f.y+A.y-g.y};f=P;g=A}}if(t+1<L){i=C.getItem(t);a=C.getItem(t+1);i.x=f.x;i.y=f.y;a.x=g.x;a.y=g.y}if(Is==ao.PCB){var b=Z(v);if("TRACK"==b);else if("COPPERAREA"==b){Fo.updateOne(v);sr("buildCopper",[v.id])}}"object"==typeof Ko&&Ko&&Ko.doRealtimeDRC&&Yo&&Ko.doRealtimeDRC(Yo,!0);v==Yo&&dr(v)}},ondragend:function(e){var t=ia.instance,r=e.target;if(t.polylinePoints&&t.polylinePoints!==m(r,"points")){Lt(r);r==Yo&&dr(r);Fo.updateOne(r);if(Is==ao.PCB){var n=Z(r),i=m(r,"layerid");"TRACK"!=n&&"ARC"!=n||!bi(i)||qo.rebuildPlane(i);"TRACK"==n?Qo.buildOneNet(m(r,"net"),!0):"COPPERAREA"==n&&sr("buildCopper",[r.id])}else if(Is==ao.SCH||Is==ao.SCHLIB){junctionUtils.solveItem(r);junctionUtils.solveTodoList()}var a=["attr",r.id,{points:t.polylinePoints},{points:m(r,"points")}];Is==ao.SCH||Is==ao.SCHLIB?zo.save(junctionUtils.batHistoryCmd(a)):zo.save(a)}}})}function _(e){var t,r=e.attributes,n=r.length,i={};for(t=n-1;t>=0;t--)if(r[t].nodeName.indexOf(":")>0){var a=r[t].namespaceURI;r[t].localName;if(a in to){if(!1===/^c:|^xlink:|^xml:|^xmlns:/.test(r[t].nodeName))try{if(a===NS_c){if(r[t].prefix!==to[NS_c]){i[to[NS_c]+":"+r[t].localName]=r[t].nodeValue;e.removeAttributeNode(r[t])}}else e.removeAttributeNode(r[t])}catch(e){}}else e.removeAttributeNode(r[t])}else if(0===r[t].nodeName.indexOf("on"))try{e.removeAttributeNode(r[t])}catch(e){}m(e,i)}function sa(r,n){var i,o,s,l=null;if("string"==typeof r){s=r.length>3e5;var c=I(r);if(!c)return;r="";l=t.importNode(c.documentElement,!0)}else l="[object Object]"==Object.prototype.toString.call(r)?makeSVG(r.tagName||r.tag,r.attr||r.attrs):t.importNode(r,!0);if(l){Ca(m(l,"canvas")||"");var h=wt(l.firstChild);C(l.firstChild,"c_transformList");L(l);var u=l.getElementsByTagName("title");u=u[0]&&u[0].firstChild&&3===u[0].firstChild.nodeType?u[0].firstChild.nodeValue:" ";var f=Go.getElementsByTagName("title")[0];if(f){for(;f.firstChild;)f.removeChild(f.firstChild);f.appendChild(A(u))}l=l.querySelector("g")||l;ms.clear("NotSaveHistory");Eo.node.clearChildNodes(gNets);var g,y,x=ua(),_=Fo.gJsonCache.layers,P={};for(g in _)if(S(_,g)&&_[g].config&&!_[g].visible){_[g].visible=!0;y=!0;P[g]=!0}y&&Ls.updateFront();var b=e.frameElement,E=b&&b.parentNode,T=E&&"none"!=E.style.display;E&&!T&&(E.style.display="");if(l){for(var w=[];l.firstChild;){i=l.firstChild;if(1!=i.nodeType||"polyline"==i.tagName&&i.points.numberOfItems<2||"polygon"==i.tagName&&i.points.numberOfItems<3){Fo.removeOne(i);l.removeChild(i)}else{Ls.appendElement(i);w.push(i)}}for(i=0;i<w.length;i++)Eo.svg.fixOrigin(w[i])}var N,k=Fo.gJsonCache.objectMap.objects;for(N in k)if("All"!=N&&S(k,N)){if("Prefix"===N||"Name"===N)continue;a("object_show",[N,k[N].visible])}n&&S(n,"saved")?zo.clear({saved:n.saved}):zo.clear();!function(){var e,t,r,n,i,a,o=p("#g1 > [c_origin]"),s=0,l=0;for(e=o.length-1;e>=0;e--){r=o[e];t=m(r,"c_origin").split(",");t[0]=+t[0];t[1]=+t[1];(n===a||n>t[0])&&(n=t[0]);(i===a||i>t[1])&&(i=t[1])}(n>65536||n<-65536)&&(s=100-n|0);(i>65536||i<-65536)&&(l=100-i|0);if(s||l){Tt(Ka.children,s,l);Fo.calAll({notCopper:!0})}}();!function(){xa(p('#g1 > g[c_partid] > g[c_partid="part_pcbtext"] > path[c_note="note_pre"]'),"","pre")}();!function(){var e=Eo.svg.getBBox(Ka);if(e.width>1e5||e.height>1e5){var t,r,n=Ka.children;for(t=n.length-1;t>=0;t--){r=n[t];e=Eo.svg.getBBox(r);if(!e.width&&!e.height&&r.id.match(/^gge|^rep/)){Fo.removeOne(r);Ka.removeChild(r)}}}}();ko=R()+1;var M,B=p("path[c_note=note_pre]",Ka);for(i=0,o=B.length;i<o;i++)(M=m(B[i],"c_text"))&&Vo.ini(M);if(h.c_transformList){var D=h.c_transformList.split(" ");for(i=0;i<D.length-1;i+=2){var V=d(D[i]),F=D[i+1],G=0,Y="M"==F.charAt(0);if(V){if(Y){Ra(V,io.BOTTOMLAYER);G=+F.substr(1)}else{G=+F;G=360-G}if(!isNaN(G)){var j=null,H=parseInt(m(V.firstChild,"c_rotation"),10)||0;H=180==H?0:H;on([V.firstChild],H,!1);j=V.firstChild.cloneNode(!0);G&&on([V],G,!0);if(j){m(j,"c_rotation",H);V.replaceChild(j,V.firstChild)}}}}}x?va():Fo.calAll({notCopper:!0});fa();if(y){for(g in P)S(P,g)&&(_[g].visible=!1);Ls.updateFront()}Ls.initByCache();m(p("#gDrcDots > path"),"stroke",Fo.gJsonCache.systemColor.DRCError);for(i in h)S(h,i)&&m(Ka,i,h[i]||"");Fo.buildSignals();kt(Ka);if(Is==ao.PCB||Is==ao.PCBMODULE||Is==ao.PCBLIB){var X,U;if(s&&"undefined"!=typeof Worker){X=function(){return new Promise(function(e,t){es.init();Ko.init();var r=function(e){var t={};for(var r in e)S(e,r)&&"function"!=typeof e[r]&&(t[r]=e[r]);return t}(Ko),n=function(){var e={},t=["ARC","PAD","VIA","SOLIDREGION","COPPERAREA","PLANEZONE"],r=function(r){for(var n=0;n<t.length;n++){var i=r[t[n]];for(var a in i)S(i,a)&&(e[a]=Eo.svg.getBBox(d(a)))}};r(Fo.gJsonCache);var n=Fo.gJsonCache.FOOTPRINT;for(var i in n)S(n,i)&&r(n[i]);return e}(),i=function(){var e={},t=function(t){var r=t.ARC;for(var n in r)if(S(r,n)){r[n].pointArr||(r[n].pointArr=pi({d:r[n].d}));e[n]=r[n].pointArr}};t(Fo.gJsonCache);var r=Fo.gJsonCache.FOOTPRINT;for(var n in r)S(r,n)&&t(r[n]);return e}();Bo.onmessage=function(t){switch(t.data.type){case"DRCMgr.init":Ko.init();break;case"RTreeMgr.result":var r=t.data.data.trees;delete t.data.data.trees;Object.assign(es,t.data.data);for(var n in r)S(r,n)&&es.trees[n].fromJSON(r[n].data);e()}};Bo.onerror=function(e){t(e)};Bo.postMessage({type:"RTreeMgr.rebuild",data:{doctype:Is,DOCTYPE:ao,LAYERTYPE:io,gJsonCache:Fo.gJsonCache,DRCMgr:r,bboxCache:n,arcPointArrCache:i,gVars:lo,copperAreaMgr:{copperPolygons:lo.copperNetRelation,_scaleFactor:qo._scaleFactor}},dependence:[d("pcb.rtreeMgrWorker.main").value,d("pcb.rtreeMgrWorker.dependence").value]})})};U=function(){return new Promise(function(e,r){for(var n=Fo.getAllNetName(),i={},a=0,o=n.length;a<o;a++){var s=So.buildOneNet(n[a]);i[n[a]]=O(s)}Bo.onmessage=function(r){switch(r.data.type){case"ratLineMgr.buildAllNet:result":var n=r.data.data,i=t.createDocumentFragment(),a=function(e){var t,r;switch(e.op){case"remove":v(d(e.id));break;case"insert":t=e.node;if(t&&t.atts){r=zt("line",t.atts);r.id||(r.id=t.id||Eo.newId());i.appendChild(r)}break;case"attr":if(e.id&&e.atts){t=i.querySelector("#"+e.id);t&&m(t,e.atts);t=d(e.id);t&&m(t,e.atts)}}};for(var o in n)S(n,o)&&("GGEID"==o?ko=n[o]:"domChanges"==o?n[o].forEach(a):Qo[o]=n[o]);i.childNodes.length&&Ka.insertBefore(i,Ls.get("ratline_end"));e()}};Bo.onerror=function(e){r(e)};Bo.postMessage({data:{doctype:Is,DOCTYPE:ao,LAYERTYPE:io,gJsonCache:Fo.gJsonCache,GGEID:ko,allNetNames:n,routedGroupMap:i,realRatLineArr:Qo.realRatLineArr},type:"ratLineMgr.buildAllNet",dependence:d("pcb.ratLineMgrWorker.main").value})})}}else{X=function(){return new Promise(function(e,t){setTimeout(function(){try{es.rebuild();e()}catch(e){t(e)}},10)})};U=function(){return new Promise(function(e,t){setTimeout(function(){try{Qo.buildAllNet();e()}catch(e){t(e)}},20)})}}qo.rebuildPlane("all");Ii(Zo.canvas.copperZone);sr("getCopperAreaDataInIndexDB").then(function(e){if(e){var t=sr("getTabInfo",[e.uuid]),r=e?e.copperAreaData:void 0;r&&t&&r.datastrid===t.datastrid&&(lo.copperNetRelation=Eo.extend(lo.copperNetRelation,r.copperNetRelation||r.activeCopperNetRelation));var n=!r||r.datastrid!==t.datastrid||"1.0"!==r.algorithmVersion,i=!!t&&0!==t.tabid.indexOf("sheet_")&&!!t.datastrid;return{uuid:e.uuid,needRebuildCopperArea:n,storeCopperAreaInIndexDB:i}}}).then(function(e){if(e&&e.needRebuildCopperArea){sr("buildCopper",["all",e.storeCopperAreaInIndexDB],e.uuid);var t=Fo.getAllObjsOf("COPPERAREA");es.insertNodes(t,"COPPERAREA")}X().then(U).then(function(){Ls.updateNetColor(Fo.gJsonCache.netColors)})})}if(n&&S(n,"notForcePickDataOfImportDoc"))var J=n.notForcePickDataOfImportDoc;sr("triggerEvent",["import_doc_done",J]);sr("triggerEvent",["select_change"]);E&&!T&&(E.style.display="none");x&&gi();ss.createLockUi(p('[locked="1"]',Ka));setTimeout(function(){la()},60);x&&(Is!=ao.PCB&&Is!=ao.PCBMODULE||yo.rebuildRTree())}else parent.$.messager.error("import node failure")}function la(){var e=Fo.gJsonCache.FOOTPRINT;if(e){var t=d("libMasker");d("masker-topLayer")&&t.removeChild(d("masker-topLayer"));d("masker-bottomLayer")&&t.removeChild(d("masker-bottomLayer"));var r=zt("g"),n=zt("g");r.id="masker-topLayer";n.id="masker-bottomLayer";var i,a,o,s;for(var l in e)if(S(e,l)){i=d(l);a=m(i,"layerid");o=Eo.svg.getPlainBBox(i);o.fill="rgba(255,255,255,0)";o.attach_libid=l;s=zt("rect",o);a==io.TOPLAYER?r.appendChild(s):n.appendChild(s)}var c=Ls.getActiveLayer();if(c==io.BOTTOMLAYER||c==io.BOTTOMSILKLAYER){t.appendChild(r);t.appendChild(n)}else{t.appendChild(n);t.appendChild(r)}}}function ca(e,t){var r,n,i,a,o,s,l,c;ms.modify_canvas({"attr-pcbcanvas-unit":t},void 0);e[io.BOARDOUTLINE]?r=Wt(e[io.BOARDOUTLINE]):e.mask&&(r=Wt(e.mask));e[io.TOPLAYER]&&(n=Wt(e[io.TOPLAYER]));e[io.TOPSOLDERLAYER]&&(i=Wt(e[io.TOPSOLDERLAYER]));e[io.TOPSILKLAYER]&&(a=Wt(e[io.TOPSILKLAYER]));e[io.BOTTOMLAYER]&&(o=Wt(e[io.BOTTOMLAYER]));e[io.BOTTOMSOLDERLAYER]&&(s=Wt(e[io.BOTTOMSOLDERLAYER]));e[io.BOTTOMSILKLAYER]&&(l=Wt(e[io.BOTTOMSILKLAYER]));e[io.ALL]&&(c=Wt(e[io.ALL]));var p=d("patterns"),h=zt("mask");h.id="multiLayerMask";var u,f;if(r&&c){u=r.cloneNode(!0);u.setAttribute("fill","white");h.appendChild(u);c.setAttribute("fill","black");h.appendChild(c);p.appendChild(h)}var g=zt("mask");g.id="topBoardSolderMask";if(r&&e[io.BOARDOUTLINE]){u=r.cloneNode(!0);u.setAttribute("fill","white");g.appendChild(u);if(i){f=i.cloneNode(!0);f.setAttribute("fill","black");g.appendChild(f)}p.appendChild(g)}var y=zt("mask");y.id="topSignalSolderMask";if(r){u=r.cloneNode(!0);u.setAttribute("fill","white");y.appendChild(u);if(i){f=i.cloneNode(!0);f.setAttribute("fill","black");y.appendChild(f)}p.appendChild(y)}var v=zt("mask");v.id="bottomBoardSolderMask";if(r&&e[io.BOARDOUTLINE]){u=r.cloneNode(!0);u.setAttribute("fill","white");v.appendChild(u);if(s){f=s.cloneNode(!0);f.setAttribute("fill","black");v.appendChild(f)}p.appendChild(v)}var x=zt("mask");x.id="bottomSignalSolderMask";if(r){u=r.cloneNode(!0);u.setAttribute("fill","white");x.appendChild(u);if(s){f=s.cloneNode(!0);f.setAttribute("fill","black");x.appendChild(f)}p.appendChild(x)}var m=Ls.get("other_end");c&&Ka.setAttribute("mask","url(#multiLayerMask)");if(r&&e[io.BOARDOUTLINE]){var C=r.cloneNode(!0);C.id="boardOutlineReal";C.setAttribute("fill",$o._boardColor);Ka.insertBefore(C,m)}if(r&&e[io.BOARDOUTLINE]){var L=r.cloneNode(!0);L.id="topBoardSolderReal";L.setAttribute("mask","url(#topBoardSolderMask)");Ka.insertBefore(L,m)}if(n){var _=n.cloneNode(!0);_.id="topSignalReal";Ka.insertBefore(_,m)}if(n){var P=n.cloneNode(!0);P.id="topSignalSolderReal";P.setAttribute("mask","url(#topSignalSolderMask)");Ka.insertBefore(P,m)}if(a){a.id="topSilkLayer";Ka.insertBefore(a,m)}if(r&&e[io.BOARDOUTLINE]){var A=r.cloneNode(!0);A.id="bottomBoardSolderReal";A.setAttribute("mask","url(#bottomBoardSolderMask)");Ka.insertBefore(A,m)}if(o){var b=o.cloneNode(!0);b.id="bottomSignalReal";Ka.insertBefore(b,m)}if(o){var S=o.cloneNode(!0);S.id="bottomSignalSolderReal";S.setAttribute("mask","url(#bottomSignalSolderMask)");Ka.insertBefore(S,m)}if(l){l.id="bottomSilkLayer";Ka.insertBefore(l,m)}var E=d("pcblayerStyle");E&&E.remove();$o.init();kt(Ka)}function da(e,r){function n(){return"part_import_"+(1e6+(1e6*Math.random()|0)+"").substr(1)}function i(e){return[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER].indexOf(Number(e))>-1}Cs.started&&Mr();var a,o,s,l,c=null;if("string"==typeof e){e.match(/^<\w/)&&!e.match(/^<svg/)&&(e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e+"</svg>");a=I(e);if(!a)return;var u=p("g",a.documentElement)&&p("g",a.documentElement)[0];u&&ki(u);c=t.importNode(a.documentElement,!0)}else 1===e.nodeType?c=t.importNode(e,!0):e.constructor==Object&&(c=makeSVG(e.tagName||e.tag,e.attr||e.attrs));if(c){L(c);C(c,"c_maxggei");if("svg"==c.tagName)for(o=0,s=c.childNodes.length;o<s;o++)if("g"===c.childNodes[o].tagName){c=c.childNodes[o];break}if("g"!=c.tagName){var f=zt("g");if("svg"==c.tagName)for(;c.firstChild;)f.appendChild(c.firstChild);else f.appendChild(c);c=f}m(c,"bindSCHId")||m(c,"bindSCHId",r&&r.bindSCHId||Q());for(o=0,l=p("[id],[c_shapetype]",c),s=l.length;o<s;o++)m(l[o],{id:""});m(c,"c_origin")||m(c,"c_origin","0,0");m(c,"display","");var g=Eo.c_paraToJson(m(c,"c_para")||"");Vn(c,{pre:g.pre?g.pre:"",name:g.package?g.package:""});delete g.pre;var y=Eo.jsonToC_para(g);m(c,{c_para:y});var _;if(r){r.c_partid?m(c,{c_partid:r.c_partid}):C(c,"c_partid");r.id&&m(c,{id:r.id});Ls.appendElement(c)}else{var P="part_import",A=d(P);A&&v(A);_=n();m(c,{id:P,c_partid:_});d("gCurParts").appendChild(c)}Eo.svg.fixOrigin(c);var b,E,O,T,R,w,N,k,M,B,D,V,F,G;if(r){jt(c);r.rotation&&(r.layerid&&i(r.layerid)?on([c],r.rotation,!0):on([c],360-r.rotation,!0));if(S(r,"x")&&S(r,"y")){b=r.oldLib;T=+m(c,"layerid");R=+r.layerid||+m(b,"layerid");(T&&i(T)!=i(R)||!T&&i(R))&&Ra(c,R,!0);E=h('[c_partid="part_pad"]',c);O=h('[c_partid="part_pad"]',b);if(E&&O){w=m(E,"c_origin").split(",");N=m(O,"c_origin").split(",");k=[N[0]-w[0],N[1]-w[1]]}else{b=x(b);Ka.append(b);M=mr("pre",c);B=mr("pre",b);M&&(M.style.display="none");B&&(B.style.display="none");D=c.getBBox();V=b.getBBox();v(b);M&&(M.style.display="");B&&(B.style.display="");k=[V.x-D.x,V.y-D.y]}if(k){F=k[0];G=k[1]}F=Eo.formatLengthSave(F);G=Eo.formatLengthSave(G);rs.move(c,F,G)}!function(){r.locked&&m(c,{locked:"1"});m(c,{c_shapetype:"group",c_etype:"pinpart"});C(c,"pointer-events");Ls.appendElement(c);Is==ao.PCB&&ti(c);if(r.pre||r.name){_=n();m(c,{c_partid:_})}r.pre&&Cr(c,{pre:r.pre},"pcblib");r.name&&r.name&&Cr(c,{name:r.name},"pcblib");Fo.updateOne(c);if(r.nets)for(var e in r.nets)Qo.buildOneNet(r.nets[e],!0);zo.save(["add",c.id])}()}else{!function(){if(Is==ao.PCB){var e=+Ls.getActiveLayer()||1,t=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER],r=Ls.getValidLayer("FOOTPRINT",e);t.indexOf(r)>=0&&Ra(c,r,!0);C(c,"pointer-events")}}();m(c,"display","none");wr("place."+P)}return c.id}parent.$.messager.alert("import fail")}function pa(e,r){var n,i,a,o,s=null;if("string"==typeof e){e.match(/^<\w/)&&!e.match(/^<svg/)&&(e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e+"</svg>");n=I(e);if(!n)return;s=t.importNode(n.documentElement,!0)}else 1===e.nodeType?s=t.importNode(e,!0):e.constructor==Object&&(s=makeSVG(e.tagName||e.tag,e.attr||e.attrs));if(s){L(s);C(s,"c_maxggei");if("svg"==s.tagName)for(i=0,a=s.childNodes.length;i<a;i++)if("g"===s.childNodes[i].tagName){s=s.childNodes[i];break}if("g"!=s.tagName){var l=zt("g");if("svg"==s.tagName)for(;s.firstChild;)l.appendChild(s.firstChild);else l.appendChild(s);s=l}for(i=0,o=p("[id]",s),a=o.length;i<a;i++)o[i].id="";m(s,"display","");var c;if(r){C(s,"c_partid");Ls.appendElement(s)}else{var h="part_import",u=d(h);u&&v(u);c=function(){return"part_import_"+(1e6+(1e6*Math.random()|0)+"").substr(1)}();m(s,{id:h,c_partid:c});d("gCurParts").appendChild(s)}var f=d("pcblayerStyle").sheet;f.insertRule("#part_import [layerid] { display:inline}",0);var g=Eo.svg.getBBox(s),y=g.x+g.width/2|0,x=g.y+g.height/2|0;f.deleteRule(0);m(s,{c_origin:y+","+x,c_module:"1"});if(r){S(r,"x")&&S(r,"y")&&yr(s,r.x,r.y);r.rotation&&on([s],r.rotation,!0);!function(){jt(s);for(var e=[].slice.call(s.children||s.childNodes,0).filter(function(e){return 1===e.nodeType}),t=e.map(function(e){return e.id}).join(","),r=0;r<e.length;r++){Ls.appendElement(e[r]);if(Is==ao.PCB&&"g"==e[r].tagName){for(var n=p('g path[c_note="note_pre"]',e[r]),i=0;i<n.length;i++){var a=m(n[r],"c_text");a.indexOf("?")>0?m(n[r],"c_text",Vo.getNewPre(a)):a.search(/\d+/)>=0&&m(n[r],"c_text",Vo.getNewPre(a.replace(/\d+(\D*)$/,"?$1")))}ti(e[r])}Fo.updateOne(e[r])}v(s);if(t){Qo.buildAllNet();zo.save(["add",t])}}()}else{m(s,"display","none");wr("place."+h);var _=p('g path[c_note="note_pre"]',s);for(i=0;i<_.length;i++){var P=m(_[i],"c_text");P&&P.indexOf("?")<0&&P.search(/\d+/)>=0&&m(_[i],"c_text",P.replace(/\d+(\D*)$/,"?$1"))}}}else parent.$.messager.alert("import fail")}function ha(e,r){var n,i,a,o;if(B(e)){zo.startBatch();for(o=0;o<e.length;o++)ha(e[o],r);zo.saveBatch()}else if(e){o=e.indexOf(" xmlns=");(o<0||o>e.indexOf(">"))&&(e=e.replace(/\/?>/,' xmlns="http://www.w3.org/2000/svg"$&'));o=e.indexOf(" xlink:href");if(o>0){o=e.indexOf(" xmlns:xlink=");o<0&&(e=e.replace(/\/?>/,' xmlns:xlink="http://www.w3.org/1999/xlink"$&'))}n=I(e);if(n&&n.documentElement.namespaceURI==to.svg){i=t.importNode(n.documentElement,!0);if(i){a=i.tagName;if(a&&!(a.indexOf(":")>0)&&"script"!==a&&"metadata"!==a){L(i);m(i,"c_shapetype")||m(i,"c_shapetype","line");jt(i);Ls.appendElement(i);var s=Z(i);Is==ao.PCB&&"FOOTPRINT"==s&&ti(i);Fo.updateOne(i);Is==ao.PCB&&m(i,"net")&&Qo.buildOneNet(m(i,"net"),!1);"part_pad"==s&&m(i,"number",Cs.getNextName());zo.save(["add",i.id])}}else parent.$.messager.warn("import fail")}}}function ua(){var e=!0,t=sr("getJsonCache");if(t){var r=E(JSON.stringify(t));r.head.editorVersion=qa;Fo.gJsonCache.layers;for(var n in io){var i=io[n];if(S(io,n)&&!r.layers[i]&&Fo.gJsonCache.layers[i]){r.layers[i]=Fo.gJsonCache.layers[i];r.layers[i].config=!1;r.layers[i].visible=!1}}if(r.objectMap){if(r.objectMap.objects&&!r.objectMap.objects.Pad.selectorText){var a=r.objectMap.objects,o=Fo.gJsonCache.objectMap.objects;for(var s in a)S(a,s)&&S(o,s)&&(a[s].selectorText=o[s].selectorText)}}else r.objectMap=Fo.gJsonCache.objectMap;Fo.gJsonCache=r;var l;for(var c in r.CIRCLE)if(S(r.CIRCLE,c)&&r.CIRCLE[c].transformArc){l=zt("circle",r.CIRCLE[c]);Vi(l)}Fo.gJsonCache.preference||(Fo.gJsonCache.preference={hideNets:[],hideFootprints:[],unit:"mil"});Fo.gJsonCache.head&&Fo.gJsonCache.head.importedFrom&&!sr("getActiveTabInfo").datastrid&&(e=!1)}else{e=!1;es.init()}Ls.updateFront();sr("triggerEvent",["layer_update"]);return e}function fa(){if(Is==ao.PCBLIB)return!1;var e,t,r,n,i=Fo.gJsonCache.preference;if(i){i.hideFootprints=[];e=i.hideFootprints||[];for(t=0,r=e.length;t<r;t++)e[t]&&(n=d(e[t]))&&"FOOTPRINT"==Z(n)&&m(n,"display","none");e=i.hideNets||[];for(t=0,r=e.length;t<r;t++)e[t]&&ga(e[t])}}function ga(e){if(e){var t,r=d("pcbNetStyle").sheet,n=r.cssRules;e=e.replace(/[\\\"]/g,"\\$&");for(var i=0,a=n.length;i<a;i++)if(0===n[i].selectorText.indexOf('line[net="'+e+'"]')){t=n[i];t.style.display="none";return}if(!t){var o='line[net="'+e+'"], polyline[net="'+e+'"]';r.insertRule(o+"{display:none;}",n.length)}}}function ya(e,t){function r(){var e=ms.getViewBox();return{x:e[0]+e[2]/2,y:e[1]+e[3]/2}}var n=zt("g",{id:"part_svg",layerid:Ls.getActiveLayer(),c_partid:"part_svg",c_shapetype:"group"});D(e)||(e=[e]);e.forEach(function(e){var t=zt("path",{d:e,id:Eo.newId(),stroke:"none"});n.appendChild(t)});var i="partimg_import",a=d(i);a&&v(a);var o=function(){return"part_import_"+(1e6+(1e6*Math.random()|0)+"").substr(1)}();m(n,{id:i,c_partid:o});var s=Eo.svg.getBBox(n),l=s.x+s.width/2|0,c=s.y+s.height/2|0;m(n,"c_origin",l+","+c);m(n,"c_module","1");d("gCurParts").appendChild(n);m(n,"display","none");wr("place."+i);t&&"CanvasCenter"==t.position&&function(e){var t=r(),n=Eo.svg.getBBox(e),i=t.x-(n.x+n.width/2),a=t.y-(n.y+n.height/2);rs.move(e,i,a)}(n);!function(){var e=+Ls.getActiveLayer()||1,t=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER],r=m(n,"c_mirror"),i=m(n,"c_origin"),a=t.indexOf(e)>=0;if("h"==r!=a){m(n,"c_mirror",a?"h":"none");is.flipH(n,+i.split(",")[0])}}();Fo.updateOne(n);zo.save(["add",n.id])}function va(){function e(e){if("OVAL"==e.shape){var t=Na(e.x,e.y,e.width,e.height,+e.rotation);e.pointArr=t[1]}}var t=Fo.gJsonCache.FOOTPRINT
;for(var r in t)if(S(t,r))for(var n in t[r].PAD)t[r].PAD.hasOwnProperty(n)&&e(t[r].PAD[n]);var i=Fo.gJsonCache.PAD;for(n in i)S(i,n)&&e(i[n])}function xa(e,t,r){function n(e,t,r,n,i,a,o){var s=!1,l=!1,c=!1,d=0,p=0,h=100;i.x-a[0]>h?s=!0:a[0]-i.x-i.width>h&&(s=!0);i.y-a[1]>h?l=!0:a[1]-i.y-i.height>h&&(l=!0);if(s||l){if("oldOrigin"===e||"libtext"===t){var u=Eo.numberlistToArray(m(n,"oldOrigin"));if(u.length>0){d=u[0]-o[0];p=u[1]-o[1]}rs.move(n,d,p);Fo.updateOne(r);c=!0;return c}if("pre"===t){var f=m(n,"c_rotation");if("90"==f||"270"==f){s&&(d=i.x+i.width+5-o[0]|0);l&&(p=i.y+i.height/2-o[1]|0)}else{s&&(d=i.x+i.width/2-o[0]|0);l&&(p=i.y-5-o[1]|0)}rs.move(n,d,p);Fo.updateOne(r);c=!0;return c}if("name"===t){if("90"==f||"270"==f){s&&(d=i.x+i.width+13-o[0]|0);l&&(p=i.y+i.height/2-o[1]|0)}else{s&&(d=i.x+i.width/2-o[0]|0);l&&(p=i.y-13-o[1]|0)}rs.move(n,d,p);Fo.updateOne(r);c=!0;return c}}return c}var i,a,o,s,l,c,d,h,u,f,g,y,v,x,C,L,_,P,A=[],b=[],S=!1;if(0!==e.length){for(i=e.length-1;i>=0;i--){a=e[i];if("pre"===r){c=a.parentNode;l=c.parentNode;o=p('[c_note="note_name"]',l)[0];d=o&&o.parentNode}else if("name"===r){d=a.parentNode;l=d.parentNode;s=p('[c_note="note_pre"]',l)[0];c=s&&s.parentNode}else if("libtext"===r){h=a;l=h.parentNode;s=p('[c_note="note_pre"]',l)[0];c=s&&s.parentNode;o=p('[c_note="note_name"]',l)[0];d=o&&o.parentNode}for(var E in io){var O=p('[layerid="'+io[E]+'"]:not([c_para]):not([c_partid="part_pcbtext"])',l);b=b.concat(Array.prototype.slice.call(O))}u=Z(l);if("FOOTPRINT"==u){g=m(c,"c_origin");y=m(d,"c_origin");v=m(h,"c_origin");L=d&&d.style.display;if(("pre"!==r||g)&&("name"!==r||y)&&("pcbtext"!==r||v)){g=Eo.numberlistToArray(g);y=Eo.numberlistToArray(y);v=Eo.numberlistToArray(v);if(c){x=Eo.svg.getBBox(c.firstChild);C=[x.x,x.y+x.height/2];if(C[0]>0&&C[1]>0&&(Math.abs(g[0]-C[0])>20||Math.abs(g[1]-C[1])>20)){g=C;m(c,"c_origin",C.map(Eo.formatLengthSave).join(","))}}A[i]={preOrigin:g,lib:l,pre:c,svgDoms:b,nameOrigin:y,name:d,nameDisplay:L,libtext:h,libtextOrigin:v}}}}for(i=e.length-1;i>=0;i--){l=A[i].lib;_=l.children.filter(function(e){return"part_pcbtext"==m(e,"c_partid")});P=l.children.filter(function(e){return"part_pcbtext"!=m(e,"c_partid")});if(A[i]){A[i].pre&&(A[i].pre.style.display="none");A[i].name&&(A[i].name.style.display="none");A[i].libtext&&(A[i].libtext.style.display="none");P.length>0&&_.forEach(function(e){e.style.display="none"});A[i].allNonTextInLib=P}}for(i=e.length-1;i>=0;i--)if(A[i]){A[i].bbox=Eo.svg.getBBox(A[i].lib);if(!A[i].bbox.width&&!A[i].bbox.height&&A[i].svgDoms.length>0){A[i].svgDoms.forEach(function(e){e.style.display="inline"});A[i].bbox=Eo.svg.getBBox(A[i].lib);A[i].svgDoms.forEach(function(e){e.style.display=""})}}for(i=e.length-1;i>=0;i--){l=A[i].lib;_=l.children.filter(function(e){return"part_pcbtext"==m(e,"c_partid")});P=l.children.filter(function(e){return"part_pcbtext"!=m(e,"c_partid")});if(A[i]){P.length>0&&_.forEach(function(e){e.style.display=""});A[i].pre&&(A[i].pre.style.display="");A[i].name&&(A[i].name.style.display=A[i].nameDisplay);A[i].libtext&&(A[i].libtext.style.display="")}}for(i=e.length-1;i>=0;i--)if(A[i]){g=A[i].preOrigin;y=A[i].nameOrigin;v=A[i].libtextOrigin;l=A[i].lib;c=A[i].pre;d=A[i].name;h=A[i].libtext;f=A[i].bbox;P=A[i].allNonTextInLib;"pre"===r&&(S=n(t,r,l,c,f,g,g));"name"===r&&(S=n(t,r,l,d,f,y,y));if("libtext"===r){if(0===P.length){f=Eo.svg.getBBox(h);S=n(t,r,l,h,f,g,v);continue}S=n(t,r,l,h,f,v,v)}}A=null;return S}}function ma(){ms.getViewBox();return{viewWidth:1e3,viewHeight:1e3,backGround:m(d("gridBg"),"fill"),gridVisible:m(d("grid1"),"display")||"yes",gridColor:m(d("gridCell"),"fill"),gridSize:Zo.adsorbGrid.gridSize,canvasWidth:1e3,canvasHeight:1e3,gridStyle:"url(#gridPattern)"==m(d("grid1"),"fill")?"dot":"line",snapSize:Zo.adsorbGrid.distanceX,unit:Zo.canvas.unit,routingWidth:Zo.canvas.routing,routingAngle:Zo.canvas.angle,routeConflict:Zo.canvas.routeConflict,removeLoop:Zo.canvas.removeLoop,copperAreaDisplay:Zo.canvas.copperZone,altSnapSize:Zo.adsorbGrid.altSnapSize,originX:Zo.canvas.originX,originY:Zo.canvas.originY}}function Ca(e){if(e.length>10){var t=e.split(so);ms.modify_canvas({"attr-pcbcanvas-width":t[7]||1e3,"attr-pcbcanvas-height":t[8]||1e3,"attr-pcbcanvas-bgcolor":t[3]||"#000000","attr-pcbcanvas-grid-visible":t[4],"attr-pcbcanvas-grid-color":t[5],"attr-pcbcanvas-grid-size":t[6]||10,"attr-pcbcanvas-grid-style":t[9],"attr-pcbcanvas-snap-size":t[10]||5,"attr-pcbcanvas-unit":t[11]||"mil","attr-pcbcanvas-routing-size":t[12]||"1","attr-pcbcanvas-angle":t[13]||"45","attr-pcbcanvas-route-conflict":t[18]||"0","attr-pcbcanvas-remove-loop":t[19]||"yes","attr-pcbcanvas-copper-zone":t[14]||"visible","attr-pcbcanvas-alt-snap-size":t[15]||t[10]/2});if(e.length>17&&t[16]&&t[17]){var r=+t[16],n=+t[17];isFinite(r)&&isFinite(n)&&a("setOriginXY",[{x:r,y:n}])}}}function La(e,t,r,n,i){var a,o,s,l,c,u,f,g,y,v,x,C,L={},_=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER],P=function(e){return _.indexOf(+e)>=0};if(D(e)){if(1!==e.length){zo.startBatch();var A,b,E=!0;for(a=0;a<e.length;a++){b="string"==typeof e[a]?d(e[a]):e[a];A=Z(b);"COPPERAREA"!==A||t["attr-copperArea-name"]&&t["attr-locked"]||(E=!0);"COPPERAREA"===A&&(1===Object.keys(t).length&&(t["attr-copperArea-name"]||t["attr-locked"])||2===Object.keys(t).length&&t["attr-copperArea-name"]&&t["attr-locked"])&&(E=!1);La(b,t,r,n,!0);"FOOTPRINT"===A&&cr()}E&&sr("buildCopper");zo.saveBatch();return}e=e[0]}if(e&&"object"==typeof t&&("object"!=typeof e||1==e.nodeType)&&Object.keys(t).length)if("canvas"!=e){var O=m(e,"sourceId");if(O){e=d(O);if(!e)return}if("NotSaveHistory"==r&&"quickchange"==n)if(zo.quickchangeNode!=e){v=e.cloneNode(!0);zo.quickchangeNode=e;zo.quickchangeNodeClone=v}else v=zo.quickchangeNodeClone;else"NotSaveHistory"!=r&&(v=zo.quickchangeNode!=e?e.cloneNode(!0):zo.quickchangeNodeClone);f=Z(e);if(S(t,"attr-locked")){"yes"===t["attr-locked"]?ss.lockObjs([e]):ss.unlockObjs([e]);"COPPERAREA"===f&&(i=!0)}var I=Object.keys(t);if(1===I.length&&"attr-locked"===I[0])return zo.save(["node",e.id,v,e.cloneNode(!0)]);var T=(m(e,"c_partid"),m(e,"c_shapetype"),m(e,"c_helper_type"),+m(e,"c_rotation")||0);l=m(e,"c_origin");var R=wt(e),w=!1,N="",M=m(e,"net"),V=m(e,"layerid");g={};if("object"==typeof t&&Object.keys(t)[0]&&Object.keys(t)[0].match(/-layerid/)&&!ka(t[Object.keys(t)[0]]))sr("warnLayerInvisible");else{var G=[],Y="PLANEZONE"===Z(Yo);switch(f){case"ARC":for(o in t)if(S(t,o)){s=t[o];w=!0;var j=e.pathSegList,H=j.getItem(0),X=j.getItem(1),U=Eo.arc.getCenterParam(H.x,H.y,X.x,X.y,X.largeArcFlag,X.sweepFlag,X.r1,X.r2,X.angle),J=U.cx,z=U.cy;switch(o){case"attr-pcbarc-width":m(e,"stroke-width",s);Cs.controlLine&&ms.modify_canvas({"attr-pcbcanvas-routing-size":s||"1"});break;case"attr-pcbarc-layerid":bi(s)&&m(e,"net","");Ls.moveElementToLayer(e,s);Ma(e);break;case"attr-pcbarc-net":N=(s||"").toUpperCase();m(e,"net",N);break;case"attr-pcbarc-rx-size":var W=e.pathSegList.getItem(0),K=e.pathSegList.getItem(1);if(s<=0||s*s*4<ue(W.x,W.y,K.x,K.y))return;K.r1=+s;K.r2=+s;e==Yo&&dr(e);w=!1;break;case"attr-pcbarc-start-x":c=e.pathSegList.getItem(0).x;as.path_arc2.set(e,"",0,s-c,0,"");e==Yo&&dr(e);break;case"attr-pcbarc-start-y":c=e.pathSegList.getItem(0).y;as.path_arc2.set(e,"",0,0,s-c,"");e==Yo&&dr(e);break;case"attr-pcbarc-end-x":c=e.pathSegList.getItem(1).x;as.path_arc2.set(e,"",1,s-c,0,"");e==Yo&&dr(e);break;case"attr-pcbarc-end-y":c=e.pathSegList.getItem(1).y;as.path_arc2.set(e,"",1,0,s-c,"");e==Yo&&dr(e);break;case"attr-pcbarc-center-x":as.path_arc2.set(e,"",0,s-U.cx,0,"");as.path_arc2.set(e,"",1,s-U.cx,0,"");e==Yo&&dr(e);break;case"attr-pcbarc-center-y":as.path_arc2.set(e,"",0,0,s-U.cy,"");as.path_arc2.set(e,"",1,0,s-U.cy,"");e==Yo&&dr(e);break;case"attr-pcbarc-start-angle":var q=s/180*Math.PI,$=X.r1,Q={x:J+Math.cos(q)*$,y:z-Math.sin(q)*$},ee=Number(Le(-U.endAngle/Math.PI*180)),te=Number(Le(s)),re=X.largeArcFlag;if(Math.abs(ee-te)<.001)return;re=te<=180?ee>te&&ee<Le(180+te)?0:1:ee>te||ee<Le(180+te)?0:1;var ne;if(X.sweepFlag){ne=1;re=1-re}else ne=0;m(e,"d","M"+Q.x+","+Q.y+" A"+$+","+$+" 0 "+re+" "+ne+" "+X.x+","+X.y);e==Yo&&dr(e);break;case"attr-pcbarc-end-angle":q=s/180*Math.PI;$=X.r1;te=Le(-U.startAngle/Math.PI*180);ee=Le(s);re=X.largeArcFlag;if(Math.abs(ee-te)<.001)return;re=te<=180?ee>te&&ee<Le(180+te)?0:1:ee>te||ee<Le(180+te)?0:1;if(X.sweepFlag){ne=1;re=1-re}else ne=0;Q={x:J+Math.cos(q)*$,y:z-Math.sin(q)*$};m(e,"d","M"+H.x+","+H.y+" A"+$+","+$+" 0 "+re+" "+ne+" "+Q.x+","+Q.y);e==Yo&&dr(e);break;case"attr-pcbarc-rotation-direction":X.sweepFlag=!X.sweepFlag;X.largeArcFlag=!X.largeArcFlag;e==Yo&&dr(e);break;case"attr-pcbarc-length-size":var t=m(e,"d");if(s<0)return;var ie=Eo.arc.convertSvgParam2CanvasParam(t),q=360*s/(2*Math.PI*ie.rx);ne=X.sweepFlag?1:0;0===ne&&(q=360-q);var ae=[ie.cx,ie.cy],oe=[e.pathSegList.getItem(0).x,e.pathSegList.getItem(0).y],le=me(oe,ae,q),ce=2*Math.PI*ie.rx;if(s>=ce)return;re=s<=Math.PI*ie.rx?0:1;var de="M"+e.pathSegList.getItem(0).x+","+e.pathSegList.getItem(0).y+" A"+ie.rx+","+ie.ry+" 0 "+re+" "+ne+" "+le[0]+","+le[1];m(e,"d",de);e==Yo&&dr(e)}}bi(V)&&G.push(V);break;case"CIRCLE":for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-pcbcircle-width":m(e,"stroke-width",s);break;case"attr-pcbcircle-layerid":bi(s)&&m(e,"net","");Ls.moveElementToLayer(e,s);break;case"attr-pcbcircle-center-x":m(e,"cx",s);e==Yo&&dr(e);break;case"attr-pcbcircle-center-y":m(e,"cy",s);e==Yo&&dr(e);break;case"attr-pcbcircle-r-size":if(s<=0)break;m(e,"r",s);e==Yo&&dr(e);break;case"attr-pcbcircle-net":N=(s||"").toUpperCase();m(e,"net",s)}}break;case"COPPERAREA":for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-copperArea-clearance-width":m(e,"clearanceWidth",s);break;case"attr-copperArea-thermal":m(e,"thermal",s);break;case"attr-copperArea-keep-island":m(e,"keepIsland",s);break;case"attr-copperArea-fill-style":m(e,"fillStyle",s);un().length>1||"solid"!==s?sr("attrMainBtnInvisible",["batchPlaceVias",!1,"lightOrGray"]):sr("attrMainBtnInvisible",["batchPlaceVias",!0,"lightOrGray"]);break;case"attr-copperArea-layerid":Ls.moveElementToLayer(e,s);break;case"attr-copperArea-net":m(e,"net",s?s.toUpperCase():"");N=s;break;case"attr-copperArea-name":m(e,"name",s);i=!0;break;case"attr-copperArea-order":m(e,"order",s)}}break;case"PLANEZONE":w=!0;for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-planeZone-fill-style":"none"==s?m(e,"fillStyle","none"):m(e,"fillStyle","solid");break;case"attr-planeZone-net":m(e,"net",s?s.toUpperCase():"");N=s;bi(V,!0)&&G.push(V)}}break;case"SOLIDREGION":w=!0;for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-solidRegion-type":wa(e,s,R.layerid);sr("updateAttrPanel");break;case"attr-solidRegion-layerid":if("npth"==R.type&&s!=io.ALL){parent.$.messager.warn("When the solid region is Board Cutout, please set the layer to Multi-Layer.");return}Ls.moveElementToLayer(e,s);s==io.ALL&&wa(e,"npth",R.layerid);sr("updateAttrPanel");break;case"attr-solidRegion-net":if("npth"==R.type){parent.$.messager.warn("You should not try to assign a net to a Board Cutout solid region.");return}m(e,"net",s?s.toUpperCase():"");N=s}}break;case"DIMENSION":for(o in t)if(S(t,o)){s=t[o];var pe="",he=[],ge=m(e,"c_fontSize"),ye=m(e,"c_unit"),xe=m(e,"c_precision"),Ce=[io.BOTTOMSILKLAYER,io.BOTTOMASSEMBLY].indexOf(+V)>-1;switch(o){case"attr-dimension-layerid":Ce=[io.BOTTOMSILKLAYER,io.BOTTOMASSEMBLY].indexOf(+s)>-1;he=ls.getStartAndEndPointByDimensionElement(e);pe=ls.getDimensionPath({fromP:{x:he[0],y:he[1]},toP:{x:he[2],y:he[3]},fontSize:ge,mirror:Ce});m(e,{d:pe});e==Yo&&dr(e);Ls.moveElementToLayer(e,s);break;case"attr-dimension-unit":he=ls.getStartAndEndPointByDimensionElement(e);pe=ls.getDimensionPath({fromP:{x:he[0],y:he[1]},toP:{x:he[2],y:he[3]},fontSize:ge,precision:xe,unit:s,mirror:Ce});m(e,{d:pe,c_unit:s});e==Yo&&dr(e);sr("updateAttrPanel");break;case"attr-dimension-precision":s=parseInt(s);s>3?s=3:s<0&&(s=0);he=ls.getStartAndEndPointByDimensionElement(e);pe=ls.getDimensionPath({fromP:{x:he[0],y:he[1]},toP:{x:he[2],y:he[3]},fontSize:ge,precision:s,unit:ye,mirror:Ce});m(e,{d:pe,c_precision:s});e==Yo&&dr(e);sr("updateAttrPanel");break;case"attr-dimension-length-size":he=ls.getStartAndEndPointByDimensionElement(e);var _e=s-fe(he[0],he[1],he[2],he[3]);q=Math.atan2(he[3]-he[1],he[2]-he[0]);var Pe=_e*Math.cos(q),Ae=_e*Math.sin(q);pe=ls.getDimensionPath({fromP:{x:he[0],y:he[1]},toP:{x:he[2]+Pe,y:he[3]+Ae},fontSize:ge,precision:xe,unit:ye,mirror:Ce});m(e,{d:pe});e==Yo&&dr(e);sr("updateAttrPanel");break;case"attr-dimension-font-height":he=ls.getStartAndEndPointByDimensionElement(e);pe=ls.getDimensionPath({fromP:{x:he[0],y:he[1]},toP:{x:he[2],y:he[3]},fontSize:s,precision:xe,unit:ye,mirror:Ce});m(e,{d:pe,c_fontSize:s});break;case"attr-dimension-start-x":he=ls.getStartAndEndPointByDimensionElement(e);pe=ls.getDimensionPath({fromP:{x:s,y:he[1]},toP:{x:he[2],y:he[3]},fontSize:ge,precision:xe,unit:ye,mirror:Ce});m(e,{d:pe});e==Yo&&dr(e);sr("updateAttrPanel");break;case"attr-dimension-start-y":he=ls.getStartAndEndPointByDimensionElement(e);pe=ls.getDimensionPath({fromP:{x:he[0],y:s},toP:{x:he[2],y:he[3]},fontSize:ge,precision:xe,unit:ye,mirror:Ce});m(e,{d:pe});e==Yo&&dr(e);sr("updateAttrPanel");break;case"attr-dimension-end-x":he=ls.getStartAndEndPointByDimensionElement(e);pe=ls.getDimensionPath({fromP:{x:he[0],y:he[1]},toP:{x:s,y:he[3]},fontSize:ge,precision:xe,unit:ye,mirror:Ce});m(e,{d:pe});e==Yo&&dr(e);sr("updateAttrPanel");break;case"attr-dimension-end-y":he=ls.getStartAndEndPointByDimensionElement(e);pe=ls.getDimensionPath({fromP:{x:he[0],y:he[1]},toP:{x:he[2],y:s},fontSize:ge,precision:xe,unit:ye,mirror:Ce});m(e,{d:pe});e==Yo&&dr(e);sr("updateAttrPanel")}}break;case"PROTRACTOR":var be=null;for(o in t)if(S(t,o)){s=t[o];var Se=m(e,"c_fontSize"),Ee=m(e,"c_precision"),Oe=[io.BOTTOMSILKLAYER,io.BOTTOMASSEMBLY].indexOf(+m(e,"layerid"))>-1;switch(o){case"attr-protractor-layerid":ze=as.get(e);Oe=[io.BOTTOMSILKLAYER,io.BOTTOMASSEMBLY].indexOf(+s)>-1;be=ls.getProtractorPath(ze.slice(0,2),ze.slice(2,4),ze.slice(4,6),{fontSize:Se,precision:Ee,canAdjustLineLength:!0,mirror:Oe});m(e,{d:be,layerid:s});e==Yo&&dr(e);Ls.moveElementToLayer(e,s);break;case"attr-protractor-width":m(e,"stroke-width",s);break;case"attr-protractor-font-height":ze=as.get(e);be=ls.getProtractorPath(ze.slice(0,2),ze.slice(2,4),ze.slice(4,6),{fontSize:s,precision:Ee,canAdjustLineLength:!0,mirror:Oe});m(e,{d:be,c_fontSize:s});e==Yo&&dr(e);break;case"attr-protractor-precision":ze=as.get(e);be=ls.getProtractorPath(ze.slice(0,2),ze.slice(2,4),ze.slice(4,6),{fontSize:Se,precision:s,canAdjustLineLength:!0,mirror:Oe});m(e,{d:be,c_precision:s});e==Yo&&dr(e);break;case"attr-protractor-angle":as.PROTRACTOR.setAngle(e,s);break;case"attr-protractor-start-x":ze=as.get(e);It(e,s-ze[0],0);dn(as.get(e));break;case"attr-protractor-start-y":ze=as.get(e);It(e,0,s-ze[1]);dn(as.get(e))}}break;case"FOOTPRINT":"";"";L={};C=!1;var Ie=!0,Te=["attr-footprint-layerid","attr-footprint-x","attr-footprint-y","attr-footprint-rotation"];for(o in t)if(S(t,o)){s=t[o];if(o.match(/attr-footprint-3d-outline-/)){_a(e,o,s,r);continue}Te.indexOf(o)>=0&&(Ie=!1);switch(o){case"attr-footprint-prefix":var Re=mr("pre",e);if(!Re||!Re.childNodes[0])break;g.text=s;Sa(Re,g);break;case"attr-footprint-name":g.text=s;Sa(mr("name",e),g);break;case"attr-footprint-layerid":Ra(e,s);Ls.moveElementToLayer(e,s);break;case"attr-footprint-x":l=m(e,"c_origin")||"";g.x=+s;g.y=+l.split(",")[1];yr(e,g.x,g.y);w=!0;break;case"attr-footprint-y":l=m(e,"c_origin")||"";g.x=+l.split(",")[0];g.y=+s;yr(e,g.x,g.y);w=!0;break;case"attr-footprint-rotation":if(s!=T){u=Le(360-(parseFloat(s).toFixed(1)-parseFloat(T).toFixed(1)));m(e,"c_rotation","0");ns.g(e,u);m(e,"c_rotation",Le(s));Un(e);dr(e)}break;case"attr-footprint-prefix-display":m(mr("pre",e),{display:"none"==s?"none":"yes"});break;case"attr-footprint-name-display":m(mr("name",e),{display:"none"==s?"none":"yes"});break;case"attr-footprint-3d-outline":var we=h('[c_etype="outline3D"]',e);we?m(we,{display:"invisible"===s?"none":"yes"}):sr("warnOutlineNeeded");break;default:o&&!o.match(/^attr-/)&&(L[o]=s)}}for(o in L)if(S(L,o)&&o&&!o.match(/^attr-/)){s=L[o];C=!0;ba(e,o,s)}C&&sr("updateAttrPanel");break;case"IMAGE":var Ne=t["attr-pcbimage-href"];if(void 0!==Ne&&!Eo.isValidImageURL(Ne))return;if(void 0!==Ne&&F(Ne)!=Ne)return;for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-pcbimage-layerid":Ls.moveElementToLayer(e,s);break;case"attr-pcbimage-href":m(e,{"xlink:href":s});break;case"attr-pcbimage-x":m(e,{x:s});break;case"attr-pcbimage-y":m(e,{y:s});break;case"attr-pcbimage-width":m(e,{width:s});break;case"attr-pcbimage-height":m(e,{height:s});break;case"attr-pcbimage-rotation":m(e,{c_rotation:s})}}var ke=S(t,"attr-pcbimage-rotation")?Le(360-t["attr-pcbimage-rotation"]):ve(e);ke?m(e,"transform",gt(yt(e),ke)):m(e,"transform","");sr("updateAttrPanel");dr(e);break;case"SVGNODE":var Me={},Be=function(e){var t=getComputedStyle(e);if(t&&"none"!=t.display)Me=Eo.svg.getBBox(e);else{e.style.display="inline";Me=Eo.svg.getBBox(e);e.style.display=""}},De=function(e,t,r,n){if(r&&1!==r)if(B(e))for(var i=0;i<e.length;i++)De(e[i],t,r,n);else if("path"==e.tagName){var a,o,s,l,c,d,h=e.getPathData(),u={x:{M:[0],L:[0],H:[0],C:[0,2,4],S:[0,2],Q:[0,2],T:[0],A:[0,5]},y:{M:[1],L:[1],V:[0],C:[1,3,5],S:[1,3],Q:[1,3],T:[1],A:[1,6]}};for(a=0;a<h.length;a++){l=h[a].type;c=u[t]&&u[t][l];s=h[a].values;if(c&&s)for(o=0;o<c.length;o++){d=c[o];s[d]=Eo.formatLengthSave(n+(s[d]-n)*r)}}e.setPathData(h)}else{var f=p("path",e);De(f,t,r,n)}};for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-pcbsvgimage-layerid":!function(){var t=m(e,"layerid"),r=Ls.getValidLayer("SVGNODE",s);P(t)!=P(r)&&is.flipH([e]);Ls.moveElementToLayer(e,r)}();break;case"attr-pcbsvgimage-x":Be(e);rs.move(e,s-Me.x,0);break;case"attr-pcbsvgimage-y":Be(e);rs.move(e,0,s-Me.y);break;case"attr-pcbsvgimage-width":Be(e);Me.width&&De(e,"x",s/Me.width,Me.x);break;case"attr-pcbsvgimage-height":Be(e);Me.height&&De(e,"y",s/Me.height,Me.y)}}break;case"PAD":var Ve=wt(e);if("POLYGON"===Ve.c_shape)var Fe=p(":not([c_padid]):not(title)",e)[1],Ge=p(":not([c_padid]):not(title)",e)[0],Ye=Ea(Fe),je=Je(m(Ge,"points"));for(o in t)if(S(t,o)){s=t[o];var He;He=e.parentNode===Ka?Fo.gJsonCache.PAD[e.id]:Fo.gJsonCache.FOOTPRINT[e.parentNode.id].PAD[e.id];switch(o){case"attr-pad-number":g.number=s;Cs.updateNextDrawLineName("place.part_pad",s);break;case"attr-pad-shape":g.shape=s;break;case"attr-pad-points":g.points=s;break;case"attr-pad-layerid":g.layerid=s;w=!0;break;case"attr-pad-net":g.net=s?s.toUpperCase():"";N=g.net;w=!0;break;case"attr-pad-width":if(He&&s<Math.max(2*+He.holeR,+He.holeLength)){g.width=He.width;parent.$.messager.error("The size of the hole cannot exceed the size of the pad")}else g.width=s;break;case"attr-pad-height":if(He&&s<Math.max(2*+He.holeR,+He.holeLength))if(s>2*+He.holeR)g.height=s;else{g.height=He.height;parent.$.messager.error("The size of the hole cannot exceed the size of the pad")}else g.height=s;break;case"attr-pad-hole-size":if("POLYGON"===Ve.c_shape){Ye.r=s/2;if(Ia(Ye,je))g.holeR=Eo.formatLengthSave(s/2);else{g.holeR=Ye.r=He.holeR;parent.$.messager.error("The size of the hole cannot exceed the size of the pad")}}else if(He&&s>Math.min(+He.width,+He.height)){g.holeR=He.holeR;parent.$.messager.error("The size of the hole cannot exceed the size of the pad")}else g.holeR=Eo.formatLengthSave(s/2);break;case"attr-pad-x":g.x=s;S(t,"attr-pad-y")||(g.y=+Ve.c_origin.split(",")[1]);w=!0;break;case"attr-pad-y":g.y=s;S(t,"attr-pad-x")||(g.x=+Ve.c_origin.split(",")[0]);w=!0;break;case"attr-pad-paste-expansion":g.pasteExpansion=s||0;m(e,"pasteExpansion",g.pasteExpansion);break;case"attr-pad-solder-expansion":g.solderExpansion=isNaN(s)||""===s?.4:s;m(e,"solderExpansion",g.solderExpansion);break;case"attr-pad-hole-shape":g.holeType=s||"round";break;case"attr-pad-hole-y-size":if("POLYGON"===Ve.c_shape){var Xe=Oa(Ye,s-2*Ye.r,e),Ue=Ye.points;Ye.points=Xe;if(Ia(Ye,je))g.holeLength=+s;else{Ye.points=Ue;g.holeLength=He.holeLength;parent.$.messager.error("The size of the hole cannot exceed the size of the pad")}}else if(He&&s>+He.width){g.holeLength=He.holeLength;parent.$.messager.error("The size of the hole cannot exceed the size of the pad")}else g.holeLength=+s;break;case"attr-pad-plated":g.plated=s||"Y";break;case"attr-pad-rotation":if(s!=T){u=Le(360-(parseFloat(s).toFixed(1)-parseFloat(T).toFixed(1)));m(e,"c_rotation","0");ns.g(e,u);m(e,"c_rotation",Le(s))}}}Ta(e,g);sr("updateAttrPanel");break;case"RECT":for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-pcbrect-layerid":Ls.moveElementToLayer(e,s);break;case"attr-pcbrect-start-x":m(e,"x",s);e==Yo&&dr(e);break;case"attr-pcbrect-start-y":m(e,"y",s);e==Yo&&dr(e);break;case"attr-pcbrect-width":m(e,"width",s);e==Yo&&dr(e);break;case"attr-pcbrect-height":m(e,"height",s);e==Yo&&dr(e);break;case"attr-pcbrect-fillType":m(e,"fillType",s);if("none"==s){m(e,"fill","none");m(e,"stroke-width","1")}else{m(e,"fill","");m(e,"stroke-width",0)}sr("updateAttrPanel");e==Yo&&dr(e);break;case"attr-pcbrect-stroke-width":m(e,"stroke-width",s);e==Yo&&dr(e)}}break;case"TEXT":for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-pcbtext-text":g.text=s;break;case"attr-pcbtext-font-family":g.fontFamily=s;break;case"attr-pcbtext-line-width":g.lineWidth=s;break;case"attr-pcbtext-height":g.height=s;break;case"attr-pcbtext-layerid":g.layerid=s;break;case"attr-pcbtext-rotation":g.rotation=parseFloat(s).toFixed(1)}}Sa(e,g);"layerid"in g&&Ls.moveElementToLayer(e,g.layerid);break;case"TRACK":var ze=mt(e.points),We=ze.length;if(We<2)return;for(o in t)if(S(t,o)){s=t[o];w=!0;switch(o){case"attr-track-width":m(e,"stroke-width",s);ms.modify_canvas({"attr-pcbcanvas-routing-size":s||"1"});break;case"attr-track-layerid":bi(s)&&m(e,"net","");Ls.moveElementToLayer(e,s);Ma(e);break;case"attr-track-net":s&&(s=s.toUpperCase());m(e,"net",s);N=s;break;case"attr-track-start-x":ze[0].x=s;m(e,"points",k(ze));e==Yo&&dr(e);break;case"attr-track-start-y":ze[0].y=s;m(e,"points",k(ze));e==Yo&&dr(e);break;case"attr-track-end-x":ze[We-1].x=s;m(e,"points",k(ze));e==Yo&&dr(e);break;case"attr-track-end-y":ze[We-1].y=s;m(e,"points",k(ze));e==Yo&&dr(e);break;case"attr-track-length-size":var Ze=e.getTotalLength();if(s>Ze){var Ke=s-Ze+fe(ze[We-2].x,ze[We-2].y,ze[We-1].x,ze[We-1].y),qe=rt(ze[We-2],ze[We-1],Ke);ze[We-1].x=qe.x;ze[We-1].y=qe.y;m(e,"points",k(ze))}else{if(s===Ze)return;var $e=e.getPointAtLength(s),Qe=se($e,e,9)>>1;ze.length=Qe+2;ze[Qe+1].x=$e.x;ze[Qe+1].y=$e.y;m(e,"points",k(ze))}e==Yo&&dr(e);Fo.updateOne(e)}}bi(V)&&G.push(V);break;case"VIA":for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-via-net":N=s?s.toUpperCase():"";w=!0;m(e,"net",N);m(d("part_via"),"net",N);var et=d("gNets"),tt=et.querySelector("text[for="+e.id+"]");if(tt){var nt=tt.nextSibling;et.removeChild(tt);tt.innerHTML=N;et.insertBefore(tt,nt)}else et.innerHTML+='<text dy="0.35em" for="'+e.id+'" x="'+e.querySelectorAll(":not([c_padid]):not(title)")[0].attributes[0].nodeValue+'" y="'+e.querySelectorAll(":not([c_padid]):not(title)")[0].attributes[1].nodeValue+'">'+N+"</text>";break;case"attr-via-diameter-size":if(+s>0){s=Eo.formatLengthSave(s/2);m(e.querySelectorAll(":not([c_padid]):not(title)")[0],"r",s);m(d("part_via").querySelectorAll(":not([c_padid]):not(title)")[0],"r",s)}break;case"attr-via-hole-size":if(+s>=0){s=Eo.formatLengthSave(s/2);m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"display",0===s?"none":"");m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"r",s);m(d("part_via","net").querySelectorAll(":not([c_padid]):not(title)")[1],"r",s)}break;case"attr-via-x":m(e.querySelectorAll(":not([c_padid]):not(title)")[0],"cx",s);m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"cx",s);w=!0;break;case"attr-via-y":m(e.querySelectorAll(":not([c_padid]):not(title)")[0],"cy",s);m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"cy",s);w=!0}}break;case"HOLE":for(o in t)if(S(t,o)){s=t[o];switch(o){case"attr-hole-hole-size":0!=+s&&Pa("hole-size",+s,e);break;case"attr-hole-x":Pa("x",+s,e);break;case"attr-hole-y":Pa("y",+s,e)}}break;default:return}"NotUpdateJsonCache"!=n&&Fo.updateOne(e,{notCopper:i,notUpdateElement:!0,noRebuildPlane:Ie});if(G.length>0){qo.rebuildPlane(G);Y&&sr("triggerEvent",["select_change"])}w&&(N&&M&&N!=M?Qo.buildGroupNets([N,M]):(N||M)&&Qo.buildOneNet(N||M,!0));"FOOTPRINT"==f&&Qo.buildRatLinesOfPCBLib(e);"PAD"!=f&&"VIA"!=f&&"HOLE"!=f&&"ARC"!=f&&"TRACK"!=f&&"RECT"!=f||sr("updateAttrPanel");if("NotSaveHistory"!=r){x=e.cloneNode(!0);var it,at=0;for(o in t)if(S(t,o)){if(++at>1){it="";break}it=o}zo.quickchangeNode=null;zo.quickchangeNodeClone=null;v&&zo.save(["node",e.id,v,x],it)}}}else if("NotSaveHistory"!==r){var ot=Is==ao.PCBLIB,st=!1;y=ms.getCanvasAttrs();ms.modify_canvas(t,r);for(o in y){if(S(y,o)&&ot&&"c_para"==o){var lt=Eo.c_paraToJson(y[o]);for(var ct in lt)if(S(lt,ct)&&S(t,ct)){lt[ct]=t[ct];st=!0}if(st){t[o]=Eo.jsonToC_para(lt);continue}}S(y,o)&&!S(t,o)&&delete y[o]}Object.keys(y).length&&Object.keys(t).length&&zo.save(["attrpanel",Ka.id,y,t])}else ms.modify_canvas(t)}function _a(e,t,r,n){var i,a=t.split("attr-footprint-3d-outline-")[1],o=h('[c_etype="outline3D"]',e);if("force"===n&&!o){xr(e);o=h('[c_etype="outline3D"]',e)}if(o){var s=Eo.svg.getBBox(o),l=wt(o),c=l.transform,d=l.c_rotation||0,p=c&&c.match(/scale\(.*?\)/)?c.match(/scale\(.*?\)/)[0]:"";p=p&&p.match(/scale\((.*?)\)/)&&p.match(/scale\((.*?)\)/)[1];var u,f,g=c&&c.match(/translate\(.*?\)/)?c.match(/translate\(.*?\)/)[0]:"",y=(g&&g.match(/translate\((.*?)[,\s].*?\)/)[1],g&&g.match(/translate\(.*?[,\s](.*?)\)/)[1],l.c_origin.split(",")),v=y[0],x=y[1];switch(a){case"width":i=r/s.width;u=-(s.width*i-s.width)/2/i;f=-(s.height*i-s.height)/2/i;m(o,"transform",ee("rotate({rotate}) scale({scale}) translate({translateX}, {translateY})",{scale:i,translateX:-(s.x*i-s.x)/i+u,translateY:-(s.y*i-s.y)/i+f,rotate:d+" "+v+" "+x}));m(o,{c_width:r,c_height:s.height*i});sr("updateAttrPanel");break;case"height":i=r/s.height;u=-(s.width*i-s.width)/2/i;f=-(s.height*i-s.height)/2/i;m(o,"transform",ee("rotate({rotate}) scale({scale}) translate({translateX}, {translateY})",{scale:i,translateX:-(s.x*i-s.x)/i+u,translateY:-(s.y*i-s.y)/i+f,rotate:d+" "+v+" "+x}));m(o,{c_width:s.width*i,c_height:r});sr("updateAttrPanel");break;case"rotation":c?c.match(/rotate\(.*?\)/)?m(o,"transform",c.replace(/rotate\(.*?\)/,"rotate("+r+" "+v+" "+x+")")):m(o,"transform",c+" rotate("+r+" "+v+" "+x+")"):m(o,"transform","rotate("+r+" "+v+" "+x+")");m(o,"c_rotation",r);break;case"x":te(o,r-v,0);break;case"y":te(o,0,r-x);break;case"z":m(o,"z",r)}Fo.updateOne(o)}else sr("warnOutlineNeeded")}function Pa(e,t,r){var n=Fo.gJsonCache.HOLE[r.id||""];if(n){if("hole-size"==e){m(r.childNodes[1],"r",t/2);m(r.childNodes[2],"rx",t/2);m(r.childNodes[2],"ry",t/2);n.holeR=t/2}else if("x"==e){m(r.childNodes[1],"cx",t);m(r.childNodes[2],"cx",t);n.x=t}else if("y"==e){m(r.childNodes[1],"cy",t);m(r.childNodes[2],"cy",t);n.y=t}m(r.childNodes[0],"d",J(n.x,n.y,+n.holeR));m(r,"c_origin",n.x+","+n.y)}}function Aa(e){var t,r,n={},i=e?D(e)?e:[e]:un(),a=i.length>1&&Or(i);n["attr-selected-count"]=i.length;if(a)return a;if(i.length<1||i.length>1&&!a||1===i.length&&"g1"===i[0].id){n=ms.getCanvasAttrs();n["attr-selected-count"]=i.length;n.cmdKey="canvas";v(d("gPad"));v(d("gPre"));n.c_para&&(n.c_para=Eo.sortC_paraJson(Eo.c_paraToJson(n.c_para)));return n}t=i[0];n["attr-locked"]="1"===m(t,"locked")?"yes":"none";n.cmdKey=Z(t);r=wt(t);var o,s,l=Z(t);switch(l){case"ARC":var c=t.pathSegList,p=c.getItem(0),u=c.getItem(1),f=Eo.arc.getCenterParam(p.x,p.y,u.x,u.y,u.largeArcFlag,u.sweepFlag,u.r1,u.r2,u.angle);if(f){n["attr-pcbarc-center-x"]=f.cx;n["attr-pcbarc-center-y"]=f.cy}n["attr-pcbarc-rx-size"]=u.r1;n["attr-pcbarc-start-x"]=p.x;n["attr-pcbarc-start-y"]=p.y;n["attr-pcbarc-end-x"]=u.x;n["attr-pcbarc-end-y"]=u.y;n["attr-pcbarc-width"]=r["stroke-width"];n["attr-pcbarc-layerid"]=r.layerid;n["attr-pcbarc-net"]=r.net;n["attr-pcbarc-length-size"]=Eo.toFixed(ls.getLengthOfTrackAndArc(Fo.gJsonCache.ARC[t.id],!1),2);n["attr-pcbarc-start-angle"]=Number(Le(-f.startAngle/Math.PI*180)).toFixed(1);n["attr-pcbarc-end-angle"]=Number(Le(-f.endAngle/Math.PI*180)).toFixed(1);n["attr-pcbarc-rotation-direction"]=u.sweepFlag?"clockwise":"anti-clockwise";break;case"CIRCLE":n["attr-pcbcircle-width"]=parseFloat(r["stroke-width"]);n["attr-pcbcircle-layerid"]=r.layerid;n["attr-pcbcircle-center-x"]=r.cx;n["attr-pcbcircle-center-y"]=r.cy;n["attr-pcbcircle-r-size"]=r.r;Bi(parseInt(r.layerid))&&(n["attr-pcbcircle-net"]=r.net||"");break;case"COPPERAREA":n["attr-copperArea-layerid"]=r.layerid;n["attr-copperArea-net"]=r.net;n["attr-copperArea-thermal"]=r.thermal||"spoke";n["attr-copperArea-keep-island"]=r.keepIsland||"none";n["attr-copperArea-clearance-width"]=r.clearanceWidth||1;n["attr-copperArea-fill-style"]=r.fillStyle||"none";n["attr-copperArea-name"]=r.name||"";n["attr-copperArea-order"]=r.order||"";break;case"PLANEZONE":n["attr-planeZone-net"]=r.net;n["attr-planeZone-fill-style"]="none"==r.fillStyle?"none":"solid";break;case"SOLIDREGION":n["attr-solidRegion-layerid"]=r.layerid;n["attr-solidRegion-net"]=r.net;n["attr-solidRegion-type"]=r.type;break;case"DIMENSION":o=r.d||"";o.split("M");s=ls.getStartAndEndPointByDimensionElement(t);n["attr-dimension-start-x"]=s[0];n["attr-dimension-start-y"]=s[1];n["attr-dimension-end-x"]=s[2];n["attr-dimension-end-y"]=s[3];n["attr-dimension-unit"]=r.c_unit||Zo.canvas.unit;n["attr-dimension-precision"]=r.c_precision||3;n["attr-dimension-layerid"]=r.layerid;n["attr-dimension-font-height"]=r.c_fontSize||10;n["attr-dimension-length-size"]=fe(s[0],s[1],s[2],s[3]);break;case"PROTRACTOR":var g=t.getAttribute("d"),y=/M.*\d*\s\d*\s/.exec(g);s=y?y[0].substring(1).trim().split(" "):[0,0];n["attr-protractor-start-x"]=s[0];n["attr-protractor-start-y"]=s[1];n["attr-protractor-layerid"]=r.layerid;n["attr-protractor-width"]=parseFloat(t.getAttribute("stroke-width"));n["attr-protractor-font-height"]=r.c_fontSize||4.5;n["attr-protractor-precision"]=r.c_precision||0;n["attr-protractor-angle"]=as.PROTRACTOR.getAngle(t)||0;break;case"FOOTPRINT":var x=mr("pre",t),C=mr("name",t);h('[c_etype="outline3D"]',t);n["attr-footprint-prefix"]=m(x.firstChild,"c_text");n["attr-footprint-name"]=m(C.firstChild,"c_text");n["attr-footprint-name-display"]="none"==m(C,"display")?"none":"yes";n["attr-footprint-prefix-display"]="none"==m(x,"display")?"none":"yes";n["attr-footprint-layerid"]=r.layerid;n["attr-footprint-x"]=r.c_origin.split(",")[0];n["attr-footprint-y"]=r.c_origin.split(",")[1];n["attr-footprint-rotation"]=r.c_rotation||0;n["attr-footprint-id"]=r.id;n.c_para=Eo.c_paraToJson(r.c_para);n.c_para=Eo.sortC_paraJson(n.c_para);break;case"IMAGE":n["attr-pcbimage-layerid"]=r.layerid;n["attr-pcbimage-href"]=r["xlink:href"];n["attr-pcbimage-x"]=r.x;n["attr-pcbimage-y"]=r.y;n["attr-pcbimage-width"]=r.width;n["attr-pcbimage-height"]=r.height;var L=ve(t);L>0&&(L=360-L);n["attr-pcbimage-rotation"]=L;break;case"SVGNODE":n["attr-pcbsvgimage-layerid"]=r.layerid;var _,P=getComputedStyle(t),A=P&&"none"!=P.display;if(A)_=Eo.svg.getBBox(t);else{t.style.display="inline";_=Eo.svg.getBBox(t);t.style.display=""}n["attr-pcbsvgimage-x"]=Eo.toFixed(_.x,1);n["attr-pcbsvgimage-y"]=Eo.toFixed(_.y,1);n["attr-pcbsvgimage-width"]=Eo.toFixed(_.width,1);n["attr-pcbsvgimage-height"]=Eo.toFixed(_.height,1);break;case"PAD":"FOOTPRINT"==Z(t.parentNode)&&delete n["attr-locked"];n["attr-pad-number"]=r.number;n["attr-pad-shape"]=r.c_shape;n["attr-pad-layerid"]=r.layerid;n["attr-pad-net"]=r.net;if("0"===r.c_width||"0"===r.c_height){var b=Eo.svg.getBBox(t.children[2]);m(t,{c_width:r.c_width=Eo.formatLengthSave(b.width),c_height:r.c_height=Eo.formatLengthSave(b.height)});Fo.updateOne(t);sr("setTabUnsaved")}n["attr-pad-width"]=r.c_width;n["attr-pad-height"]=r.c_height;n["attr-pad-id"]=r.id;var S=wt(t);n["attr-pad-x"]=+S.c_origin.split(",")[0];n["attr-pad-y"]=+S.c_origin.split(",")[1];r.layerid!=io.ALL&&(n["attr-pad-paste-expansion"]=S.pasteExpansion||0)
;n["attr-pad-solder-expansion"]=isNaN(S.solderExpansion)||""===S.solderExpansion?.4:S.solderExpansion;n["attr-pad-points"]="POLYGON"==r.c_shape?Zn(t):"";n["attr-pad-rotation"]=r.c_rotation||0;n["attr-pad-hole-shape"]=ci(t);if("slot"==n["attr-pad-hole-shape"]){var E=+m(t.querySelectorAll(":not([c_padid]):not(title)")[1],"stroke-width"),O=N(m(t.querySelectorAll(":not([c_padid]):not(title)")[1],"points"));n["attr-pad-hole-y-size"]=+(ls.distancePointToPoint(O[0],O[1])+E);n["attr-pad-hole-size"]=+E}else{n["attr-pad-hole-size"]=2*m(t.querySelectorAll(":not([c_padid]):not(title)")[1],"r");n["attr-pad-hole-size"]=n["attr-pad-hole-size"]>1e-4?n["attr-pad-hole-size"]:0}n["attr-pad-plated"]=r.plated;if(r.layerid!=io.ALL){delete n["attr-pad-hole-shape"];delete n["attr-pad-hole-size"];delete n["attr-pad-hole-y-size"];delete n["attr-pad-plated"]}break;case"RATLINE":n["attr-ratLine-net"]=r.net;n["attr-ratLine-start-x"]=r.x1;n["attr-ratLine-start-y"]=r.y1;n["attr-ratLine-end-x"]=r.x2;n["attr-ratLine-end-y"]=r.y2;n["attr-ratLine-id"]=r.id;break;case"RECT":n["attr-pcbrect-layerid"]=r.layerid;n["attr-pcbrect-start-x"]=r.x;n["attr-pcbrect-start-y"]=r.y;n["attr-pcbrect-width"]=r.width;n["attr-pcbrect-height"]=r.height;n["attr-pcbrect-fillType"]=r.fillType||"none";n["attr-pcbrect-stroke-width"]=parseFloat(r["stroke-width"])||0;break;case"TEXT":"FOOTPRINT"==Z(t.parentNode)&&delete n["attr-locked"];var I=wt(t.firstChild);n["attr-pcbtext-text"]=(I.c_text||"").replace(/\n/g,"\\n");n["attr-pcbtext-font-family"]=I.c_fontFamily||"";n["attr-pcbtext-line-width"]=I["stroke-width"];n["attr-pcbtext-height"]=I.c_fontSize;n["attr-pcbtext-layerid"]=r.layerid;n["attr-pcbtext-rotation"]=r.c_rotation;n["attr-pcbtext-mirror"]=r.c_mirror;break;case"TRACK":var T=N(m(t,"points")),R=T.length;n["attr-track-width"]=parseFloat(r["stroke-width"]);n["attr-track-layerid"]=r.layerid;n["attr-track-net"]=r.net;n["attr-track-start-x"]=R>0?T[0].x:0;n["attr-track-start-y"]=R>0?T[0].y:0;n["attr-track-end-x"]=R>0?T[R-1].x:0;n["attr-track-end-y"]=R>0?T[R-1].y:0;n["attr-track-id"]=r.id;"path"!=t.tagName&&"polyline"!=t.tagName&&"line"!=t.tagName&&"polygon"!=t.tagName||(n["attr-arrow-marker"]=m(t,"marker-start")?"start":m(t,"marker-end")?"end":"");Fo.gJsonCache.TRACK||(Fo.gJsonCache.TRACK={});n["attr-track-length-size"]=Eo.toFixed(ls.getLengthOfTrackAndArc(Fo.gJsonCache.TRACK[t.id],!1),2);break;case"VIA":n["attr-via-net"]=r.net;n["attr-via-diameter-size"]=2*m(t.querySelectorAll(":not([c_padid]):not(title)")[0],"r");n["attr-via-hole-size"]=2*m(t.querySelectorAll(":not([c_padid]):not(title)")[1],"r");n["attr-via-id"]=r.id;n["attr-via-x"]=m(t.querySelectorAll(":not([c_padid]):not(title)")[0],"cx");n["attr-via-y"]=m(t.querySelectorAll(":not([c_padid]):not(title)")[0],"cy");break;case"HOLE":n["attr-hole-hole-size"]=2*m(t.childNodes[1],"r");n["attr-hole-id"]=r.id;n["attr-hole-x"]=m(t.childNodes[1],"cx");n["attr-hole-y"]=m(t.childNodes[1],"cy")}return n}function ba(e,t,r){var n=m(e,"c_para")||"",i=Eo.c_paraToJson(n);if(0!==t.indexOf("attr-")){i[t]=r;for(var a in i)S(i,a)&&(i[a]||"package"==a||"BOM_Supplier"==a||delete i[a]);m(e,{c_para:Eo.jsonToC_para(i)})}}function Sa(e,t,r){var n=Yr(e),i=h("[c_text]",e),a=m(i,"c_text"),o=m(n,"c_partid"),s=o&&o.match(/^part_import_/)&&"note_pre"==m(i,"c_note"),l=o&&o.match(/^part_import_/)&&"note_name"==m(i,"c_note");if(t.text){t.text=t.text.replace(/\\n/g,"\n");t.text=t.text.replace(/\r\n/g,"\n").replace(/\r/g,"\n");t.text=t.text.replace(/^[ \t\f\v]+\n[ \t\f\v]*|\n[ \t\f\v]+$/g,"\n");t.text=V(t.text);if(s||l){s&&(t.text=t.text.replace(/[^\x20-\x7E]+/g,""));t.text=t.text.replace(/\n+/g," ")}if(t.text==a||s&&t.text.indexOf(" ")>=0)return sr("updateAttrPanel");if(!t.text){if(s||l)return sr("updateAttrPanel");t.text="void"}t.text=t.text.replace(/\n/g,"\\n");if("pcb"===Eo.fileType.getAbstractFileType(Is)&&s&&t.text.indexOf("?")<0&&Vo.isUsed(t.text.toUpperCase(),{except:e.id})){sr("warnPrefixDuplicate",[t.text,"Footprints"]);return}}var c,d=wt(e),p=e.children[0],u=S(t,"text")||S(t,"height")||S(t,"fontFamily"),f=S(t,"layerid")||S(t,"rotation"),g=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER,io.BOTTOMASSEMBLY],y=function(e){return g.indexOf(+e)>=0},v=+d.c_rotation||0,x=d.layerid,C=y(x),L=S(t,"layerid")&&C!=y(t.layerid),_=L?!C:C,P=d.c_origin.split(","),A=+P[0],b=+P[1],E=wt(p),O=S(t,"fontFamily")?t.fontFamily:E.c_fontFamily||"",I=O&&sr("isFontMissing",[O]),T=!O;S(t,"text")&&I?parent.$.messager.warn("Font is missing! You can confirm the dialog and use default font instead or cancel the dialog then upload your font and do it again."):function(e,t,r){if(u){var n=t.text||E.c_text,i=t.height||E.c_fontSize;n&&n.match(/\s|\n/)&&"note_pre"==E.c_note&&(n=n.replace(/\s|\n/g,""));var a=n.replace(/\n/g,"\\n"),o=n.replace(/\\n/g,"\n");if(I){t.fontFamily=O="";T=!0}if(!O&&lo.pcbFontsRegExp.test(o)){O=lo.pcbServersFonts[0];T=!1}var s,l={text:o,x:A,y:b,fontSize:i,fontFamily:O,degree:S(t,"rotation")?t.rotation:Le(v),mirror:_,rotateOriginX:A,rotateOriginY:b};if(lo.pcbServersFonts.indexOf(O)>-1){l.callback=function(n){if(n){m(p,{d:n,c_text:a,c_fontSize:i,c_fontFamily:O});m(p,{stroke:T?"":"none",fill:T?"none":""});S(t,"rotation")&&m(e,"c_rotation",t.rotation);m(e,"c_mirror",_?"1":"");Ln(e);r&&r()}};sr("getFontPath",[l])}else{s=sr("getFontPath",[l]);if(!s)return;m(p,{d:s,c_text:a,c_fontSize:i,c_fontFamily:O});m(p,{stroke:T?"":"none",fill:T?"none":""});S(t,"rotation")&&m(e,"c_rotation",t.rotation);m(e,"c_mirror",_?"1":"");Ln(e)}}else if(f){if(S(t,"rotation")){c=Le(360-((t.rotation||0)-v));c&&ns.rotate(e,c,A,b);m(e,"c_rotation",t.rotation)}if(L){var d=+m(e,"c_rotation")||0;if(d){ns.rotate(e,d,A,b);is.flipH([e],A);ns.rotate(e,-d,A,b)}else is.flipH([e],A);m(e,"c_mirror",_?"1":"")}Ln(e)}S(t,"layerid")&&m(e,"layerid",t.layerid);t.lineWidth&&(T?m(p,{"stroke-width":t.lineWidth}):parent.$.messager.info("Changing line width won't work for silhouette fonts."));r&&r()}(e,t,r)}function Ea(e){var t={type:"circle"===e.tagName?"round":"slot"};if("round"===t.type){t.r=+m(e,"r");t.hasHole="0"!==m(e,"r")}else{t.r=+m(e,"stroke-width")/2;t.hasHole="0"!==m(e,"stroke-width")}if(t.hasHole)if("round"===t.type){t.center={x:+m(e,"cx"),y:+m(e,"cy")};t.r=+m(e,"stroke-width")/2}else{t.points=m(e,"points");var r=t.points.split(" ").map(function(e){return parseFloat(e)});t.center={x:(r[0]+r[2])/2,y:(r[1]+r[3])/2}}return t}function Oa(e,t,r){var n=[e.center.x-t,e.center.y,e.center.x+t,e.center.y],i=+m(r,"c_rotation");n=ge(n,(360-(+m(r,"c_width")<+m(r,"c_height")?i+90:i))%360,e.center.x,e.center.y);return n.join(" ")}function Ia(e,t){if(!e.hasHole)return!0;if("round"===e.type){if(!Ee(e.center,t))return!1;for(var r=t.length,n=0;n<r;n++){var i,a=t[n];i=0===n?t[r-1]:t[n-1];if(i.x!==a.x||i.y!==a.y){var o,s=ie(i,a,e.center);o=s?s.distance2:ue(a.x,a.y,e.center.x,e.center.y);if(o<e.r*e.r)return!1}}}else{r=t.length;var l=Je(e.points);for(n=0;n<r;n++){a=t[n];i=0===n?t[r-1]:t[n-1];if(et(i,a,l[0],l[1]).d<e.r)return!1}}return!0}function Ta(e,t){function r(){if(D!=s.c_shape){R="ELLIPSE"==D?zt("ellipse",{cx:l,cy:c,rx:V,ry:V,stroke:"none","stroke-width":"0"}):"OVAL"==D?zt("polyline",{points:G,"stroke-width":V}):zt("polygon",{points:w,stroke:"none","stroke-width":"0"});if("POLYGON"!==D){a.x===l&&a.y===c||"round"===g&&m(u,{cx:l,cy:c});a={x:l,y:c}}e.replaceChild(R,e.querySelectorAll(":not([c_padid]):not(title)")[0])}else"ELLIPSE"==D?m(e.querySelectorAll(":not([c_padid]):not(title)")[0],{rx:V,ry:V}):"OVAL"==D?m(e.querySelectorAll(":not([c_padid]):not(title)")[0],{points:G,"stroke-width":V}):m(e.querySelectorAll(":not([c_padid]):not(title)")[0],"points",w);m(e,{c_width:M,c_height:B,c_rotation:h,c_shape:D})}function n(){var t=(W-2*x)/2||.01,r=[a.x-t,a.y,a.x+t,a.y];r=ge(r,(360-(+m(e,"c_width")<+m(e,"c_height")?h+90:h))%360,a.x,a.y);return r.join(" ")}function i(e){return S(e,"layerid")&&e.layerid!=io.ALL}if(e&&e.querySelectorAll(":not([c_padid]):not(title)")&&e.querySelectorAll(":not([c_padid]):not(title)")[0]){S(t,"number")&&m(e,{number:t.number});if(S(t,"net")){m(e,"net",t.net);f(e,"selected-h")&&y(e,"selected-h")}S(t,"plated")&&m(e,"plated",t.plated||"Y");S(t,"x")&&S(t,"y")&&yr(e,t.x,t.y);var a,o,s=wt(e),l=+s.c_origin.split(",")[0],c=+s.c_origin.split(",")[1],h=+s.c_rotation,u=e.querySelectorAll(":not([c_padid]):not(title)")[1],g=ci(e),v=Ai(s.net),x=0,L=0,_=t.holeType||g,P=v&&v.viaHoleD?v.viaHoleD:1.2,A=Math.max(+(.3*Math.min(t.width||s.c_width||6,t.height||s.c_height||6)).toFixed(2),P||0,0);if("slot"===g){o=Je(m(u,"points"));a={x:(o[0].x+o[1].x)/2,y:(o[0].y+o[1].y)/2}}else a={x:+m(u,"cx"),y:+m(u,"cy")};if(S(t,"layerid")&&t.layerid!=s.layerid){if(t.layerid!=io.ALL){t.holeR=0;t.holeLength=0}else if(!t.holeR)if("POLYGON"===s.c_shape){var b=e.querySelectorAll(":not([c_padid]):not(title)")[0],E=m(b,"points"),O=Je(E),I=Eo.svg.getBBox(e);a=mi(I.x+I.width/2,O);m(u,{cx:a.x,cy:a.y});var T=function(e,t){for(var r,n=t.length,i=0;i<n;i++){var a,o=t[i];a=0===i?t[n-1]:t[i-1];if(a.x!==o.x||a.y!==o.y){var s,l=ie(a,o,e);s=l?l.distance2:ue((o.x+a.x)/2,(o.y+a.y)/2,e.x,e.y);r=r?Math.min(r,s):s}}return Math.sqrt(r)}(a,O);t.holeR=.6*T}else t.holeR=A;Ls.moveElementToLayer(e,t.layerid)}var R,w,M=+(t.width||s.c_width),B=+(t.height||s.c_height),D=t.shape||s.c_shape,V=0,F=0,G=[],Y=0,j=0;if(S(t,"width")||S(t,"height")||S(t,"shape"))switch(D){case"RECT":Y=l-M/2;j=c-B/2;G=Eo.convertRect2Polygon(Y,j,M,B);w=ge(G,360-h,l,c);r();break;case"ELLIPSE":F="width"in t?M:"height"in t?B:Math.min(M,B);V=F/2;M=B=F;r();break;case"OVAL":G=Na(l,c,M,B,h);G=k(G[0]);V=Math.min(+M,+B);r();break;case"POLYGON":if("ELLIPSE"==s.c_shape){Y=l-M/2;j=c-B/2;w=Eo.convertRect2Polygon(Y,j,M,B)}else if("OVAL"==s.c_shape)w=k(Na(l,c,M,B,h)[1]);else{var H=e.querySelectorAll(":not([c_padid]):not(title)")[0],X=m(H,"points");w=(X||"").replace(/[ ,]{2,}| /g,",").split(",")}r();break;default:return}if((S(t,"layerid")?t.layerid:s.layerid)!=io.ALL)if(t.holeLength||t.holeR){t.layerid=io.ALL;Ls.moveElementToLayer(e,t.layerid);t.holeR=A;t.holeLength=0}else{t.holeR=0;t.holeLength=0}else{x="slot"==g?m(u,"stroke-width")/2:+m(u,"r");if("slot"==g){var U=+m(u,"stroke-width"),J=N(m(u,"points"));L=ls.distancePointToPoint(J[0],J[1])+U}else L=2.1*m(u,"r");if("slot"==_){0==+t.holeR&&(t.holeR=x);0==+t.holeLength&&(t.holeLength=L)}else 0==+t.holeR&&(t.holeR=x);if("slot"==_){x=t.holeR||x;t.holeLength<=2*x&&(t.holeLength=2.1*x)}}if("round"==g)x="holeR"in t?+t.holeR||0:+m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"r");else{x="holeR"in t?+t.holeR||0:+m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"stroke-width")/2;var z=N(m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"points")),W=i(t)?0:t.holeLength||ls.distancePointToPoint(z[0],z[1])+2*x;G=n()}if(g!=_)if("round"==_)x=i(t)?0:+(t.holeR||m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"stroke-width")/2);else{x=i(t)?0:+(t.holeR||m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"r"));W=i(t)?0:2.1*x;G=n()}!function(){if(_!=g){R="round"==_?zt("circle",{cx:a.x,cy:a.y,r:x,stroke:"none","stroke-width":"0",layerid:s.layerid}):zt("polyline",{points:G,"stroke-width":2*x,layerid:s.layerid});e.replaceChild(R,u);u=R}else"round"==_?m(u,{r:x}):m(u,{points:G,"stroke-width":2*x})}();var Z=e.cloneNode(!0);m(Z,"id","part_pad");C(Z,"locked");m(Z,"display","none");m(Z,"class","");m(p("[id]",Z),"id","");var K=d("gCurParts"),q=d("part_pad");q&&q.parentNode==K&&K.replaceChild(Z,q);(S(t,"width")||S(t,"height")||S(t,"shape")||S(t,"layerid")||S(t,"pasteExpansion")||S(t,"solderExpansion"))&&Oi(e,D)}}function Ra(e,t,r){function n(e){for(var t,r=0,i=e.children,o=i.length;r<o;r++){t=m(i[r],"layerid");t&&S(a,t)&&m(i[r],"layerid",a[t]);"g"==i[r].tagName&&n(i[r])}}if(!r){if(m(e,"layerid")==t)return}var i=Z(e);if("FOOTPRINT"==i||"TEXT"==i){m(e,"layerid",t);var a={};a[io.TOPLAYER]=io.BOTTOMLAYER;a[io.TOPSILKLAYER]=io.BOTTOMSILKLAYER;a[io.TOPPASTERLAYER]=io.BOTTOMPASTERLAYER;a[io.TOPSOLDERLAYER]=io.BOTTOMSOLDERLAYER;a[io.TOPASSEMBLY]=io.BOTTOMASSEMBLY;a[io.BOTTOMLAYER]=io.TOPLAYER;a[io.BOTTOMSILKLAYER]=io.TOPSILKLAYER;a[io.BOTTOMPASTERLAYER]=io.TOPPASTERLAYER;a[io.BOTTOMSOLDERLAYER]=io.TOPSOLDERLAYER;a[io.BOTTOMASSEMBLY]=io.TOPASSEMBLY;is.flipH([e]);var o=p('[layerid="'+io.DOCUMENT+'"]',e);o.length&&is.flipH(o);var s=p('[layerid="'+io.MECHANICAL+'"]',e);s.length&&is.flipH(s);var l;for(var c in io)if(S(io,c)&&/^INNER\d+$/.test(c)){l=p('[layerid="'+io[c]+'"]',e);l.length&&is.flipH(l)}var d=+m(e,"c_rotation");if(d){d=Le(360-d);m(e,"c_rotation",d)}if("FOOTPRINT"==i){p("*[c_rotation]",e).forEach(function(e){d=+m(e,"c_rotation");if(d){d=Le(360-d);m(e,"c_rotation",d)}})}if("FOOTPRINT"===i){as.FOOTPRINT.get(e);dr(e)}n(e)}}function wa(e,t,r){switch(t){case"npth":m(e,{"stroke-width":"0",type:"npth",net:"",fill:""});r=io.ALL;sr("attrMainBtnInvisible",["create-solder-mask",!1,"lightOrGray"]);break;case"solid":r=r==io.ALL?io.TOPLAYER:r;m(e,{"stroke-width":"0",type:"solid",fill:""});r!=io.TOPLAYER&&r!=io.BOTTOMLAYER||sr("attrMainBtnInvisible",["create-solder-mask",!0,"lightOrGray"]);break;case"cutout":r=r==io.ALL?io.TOPLAYER:r;m(e,{"stroke-width":"1",type:"cutout",fill:"none"});r!=io.TOPLAYER&&r!=io.BOTTOMLAYER||sr("attrMainBtnInvisible",["create-solder-mask",!0,"lightOrGray"])}Ls.moveElementToLayer(e,r)}function Na(e,t,r,n,i){var a;r=+r;n=+n;var o=Math.min(r,n)/2;a=Eo.createPolylineForOvalPad(e,t,r,n,i);var s=Ti(N(a.join(" ")),o);return[N(a.join(" ")),s]}function ka(e){return Fo.gJsonCache.layers[e]&&Fo.gJsonCache.layers[e].visible}function Ma(e){function t(e,t,r){var n=Fo.ifFind(e,t,r,io.ALL,"VIA");if(n&&n.type)return!0;n=Fo.ifFind(e,t,r,io.ALL,"PAD");return!(!n||!n.type)}var r=Z(e),n=[],i=wt(e);"TRACK"===r?n.push(e.points[0],e.points[e.points.length-1]):"ARC"===r&&n.push(e.pathSegList.getItem(0),e.pathSegList.getItem(1));if(!(n.length<2)&&oi(i.layerid)){var a=Fo.ifFind(n[0].x,n[0].y,i.net,io.ALL,"TRACK",i.id),o=Fo.ifFind(n[1].x,n[1].y,i.net,io.ALL,"TRACK",i.id);if(a&&("TRACK"===a.type||"ARC"===a.type)&&a.gId!==i.id&&a.layerid!==i.layerid&&oi(a.layerid)&&!t(n[0].x,n[0].y,i.net)){var s=ei(n[0].x,n[0].y,i.net);Fo.updateOne(s);zo.save(["add",s.id])}if(o&&("TRACK"===o.type||"ARC"===o.type)&&o.gId!==i.id&&o.layerid!==i.layerid&&oi(o.layerid)&&!t(n[1].x,n[1].y,i.net)){var l=ei(n[1].x,n[1].y,i.net);Fo.updateOne(l);zo.save(["add",l.id])}}}function Ba(e){var t=e.shapeType;if(!(["TEXT","PAD","VIA","HOLE"].indexOf(t)<0)){var r,n,i={TEXT:{layerid:"attr-pcbtext-layerid",text:"attr-pcbtext-text","line-width":"attr-pcbtext-line-width",height:"attr-pcbtext-height"},PAD:{number:"attr-pad-number",shape:"attr-pad-shape",layerid:"attr-pad-layerid",net:"attr-pad-net",width:"attr-pad-width",height:"attr-pad-height","hole-size":"attr-pad-hole-size"},VIA:{"diameter-size":"attr-via-diameter-size","hole-size":"attr-via-hole-size",net:"attr-via-net"},HOLE:{"hole-size":"attr-hole-hole-size"},FOOTPRINT:{prefix:"attr-footprint-prefix",layerid:"attr-footprint-layerid","prefix-display":"attr-footprint-prefix-display",x:"attr-footprint-x",y:"attr-footprint-y",rotation:"attr-footprint-rotation"}},a={},o=i[t];n=d("TEXT"==t?"part_pcbtext":"part_"+t.toLowerCase());if(n){r=n.cloneNode(!0);m(r,{c_shapetype:"group",c_etype:"pinpart"});C(r,"pointer-events");S(e,"x")&&S(e,"y")&&yr(r,e.x,e.y);jt(r);Ls.appendElement(r);Fo.updateOne(r);if(o){!function(e,t,r){if(r)for(var n in r)if(S(r,n))if(S(e,n))t[r[n]]=e[n];else{var i=Eo.camelize(n);S(e,i)&&(t[r[n]]=e[i])}}(e,a,o);Object.keys(a).length>0&&La(r,a,"NotSaveHistory")}"PAD"!=t&&"VIA"!=t||!m(r,"net")||Qo.buildOneNet(m(r,"net"),!1);"PAD"==t&&m(r,"number",Cs.getNextName());zo.save(["add",r.id]);return r}}}function Da(e){function t(t){if(S(e,t))return e[t];if(t.indexOf("-")>-1){var r=Eo.camelize(t);if(S(e,r))return e[r]}else{var n=Eo.dasherize(t);if(S(e,n))return e[n]}}function r(e,t){var r=t.points||t.pointArr;Array.isArray(r)&&(r=r.reduce(function(e,t){return(e?e+" ":"")+t.x+" "+t.y},""));return zt(e,{points:r,id:Eo.newId()})}function n(e){return zt("path",{d:e.d,id:Eo.newId()})}var i,a,o=e.shapeType;if(!(["TRACK","DIMENSION","COPPERAREA","SOLIDREGION","RECT","CIRCLE","ARC"].indexOf(o)<0)){var s={TRACK:{width:"attr-track-width",net:"attr-track-net"},DIMENSION:{},COPPERAREA:{"clearance-width":"attr-copperArea-clearance-width",thermal:"attr-copperArea-thermal","keep-island":"attr-copperArea-keep-island","fill-style":"attr-copperArea-fill-style",net:"attr-copperArea-net"},SOLIDREGION:{type:"attr-solidRegion-type",layerid:"attr-solidRegion-layerid",net:"attr-solidRegion-net"},RECT:{fillType:"attr-pcbrect-fillType",strokeWidth:"attr-pcbrect-stroke-width"},CIRCLE:{width:"attr-pcbcircle-width"},ARC:{width:"attr-pcbarc-width",net:"attr-pcbarc-net"}},l=e.layerid||Ls.getActiveLayer();l=Ls.getValidLayer(o,l);switch(o){case"TRACK":i=function(e){e.strokeWidth||(e.strokeWidth=Zo.canvas.routing);var t=e.points||e.pointArr,n=e.layerid||Ls.getActiveLayer(),i=e.net||"";n=Ls.getValidLayer("TRACK",n);i||(i=br());var a=r("polyline",t);m(a,{c_shapetype:"line",c_etype:"wire",layerid:n,net:i});return a}(e);break;case"DIMENSION":a=ls.getDimensionPath({fromP:{x:t("start-x"),y:t("start-y")},toP:{x:t("end-x"),y:t("end-y")}});i=n({d:a});m(i,{"stroke-width":"1",fill:"none",c_shapetype:"group"});break;case"COPPERAREA":i=r("polygon",e);m(i,{fill:"none","stroke-width":2,"stroke-dasharray":"3,3",clearanceWidth:"1",thermal:"spoke",keepIsland:"none",net:"GND",name:"",order:"1"});break;case"SOLIDREGION":i=r("polygon",e);m(i,{"stroke-width":"0.2",type:"solid"});break;case"RECT":i=zt("rect",{id:Eo.newId(),x:e.x,y:e.y,width:e.width,height:e.height,rx:e["round-radius"]||"",ry:e["round-radius"]||""});break;case"CIRCLE":i=zt("circle",{id:Eo.newId(),cx:e.cx,cy:e.cy,r:e.r});break;case"ARC":a=function(e){function t(t){return S(e,t)}function r(t){return e[t]}S(e,"angle")||(e.angle=0);!S(e,"rx")&&S(e,"r1")&&(e.rx=e.r1);!S(e,"ry")&&S(e,"r2")&&(e.ry=e.r2);var n,i,a=["x1","y1","x2","y2","rx","ry","angle","largeArcFlag","sweepFlag"],o=["cx","cy","rx","ry","x1","y1","x2","y2"],s=["x1","y1","x2","y2","x3","y3"],l=["cx","cy","rx","ry","a1","a2","sweepFlag"],c=e.shapeType,d="pie"==c;if(a.every(t)){i="A"+e.rx+" "+e.ry+" "+(e.angle||0)+" "+(e.largeArcFlag?1:0)+" "+(e.sweepFlag?1:0)+" "+e.x2+" "+e.y2;if(d){var p=Eo.arc.getCenterParam(e.x1,e.y1,e.x2,e.y2,e.largeArcFlag,e.sweepFlag,e.rx,e.ry,e.angle||0);p&&(i="M"+p.cx+" "+p.cy+"L"+e.x1+" "+e.y1+i+"Z")}else i="M"+e.x1+" "+e.y1+i}else if(o.every(t)){n=Eo.arc.getArcParams.apply(null,o.map(r));i="A"+e.rx+" "+e.ry+" 0 "+n.fa+" "+n.fs+" "+n.x2+" "+n.y2;i=d?"M"+e.cx+" "+e.cy+"L"+n.x1+" "+n.y1+i+"Z":"M"+n.x1+" "+n.y1+i}else if(s.every(t)){n=Eo.arc.getArcParamsBy3Points.apply(null,s.map(r));i="A"+n.r1+" "+n.r2+" "+n.angle+" "+n.largeArcFlag+" "+n.sweepFlag+" "+n.x+" "+n.y;i=d?"M"+n.cx+" "+n.cy+"L"+e.x1+" "+e.y1+i+"Z":"M"+e.x1+" "+e.y1+i}else if(l.every(t)){n=Eo.arc.getArcParamsByCRA.apply(null,l.map(r));i="A"+e.rx+" "+e.ry+" 0 "+n.fa+" "+n.fs+" "+n.x2+" "+n.y2;i=d?"M"+e.cx+" "+e.cy+"L"+n.x1+" "+n.y1+i+"Z":"M"+n.x1+" "+n.y1+i}return i}(e);if(a){i=n({d:a});m(i,{"stroke-width":"1"})}}if(i){m(i,"layerid",l);Ls.appendElement(i,o);Fo.updateOne(i);var c=s[o];a={};if(c){!function(e,t,r){if(r)for(var n in r)if(S(r,n))if(S(e,n))t[r[n]]=e[n];else{var i=Eo.camelize(n);S(e,i)&&(t[r[n]]=e[i])}}(e,a,c);Object.keys(a).length>0&&La(i,a,"NotSaveHistory")}zo.save(["add",i.id])}}}function Va(e){var t=d(e.id);if(t&&e.svg&&t.parentNode==Ka){var r=e.id,n=t,i=Wt(e.svg);if(i){var a=Z(i);if(a==Z(n)){var o=p("*",n),s=p("*:not(.hitbox)",i);i.id=r;for(var l=0;l<s.length;l++)s[l].id=o[l]&&o[l].id||Eo.newId();var c=function(e){for(var t=e;t&&t.parentNode!=Ka;)t=t.parentNode;return t!=e&&t}(n),h=(c||n).cloneNode(!0);n=n.parentNode.replaceChild(i,n);Is==ao.PCB&&"FOOTPRINT"==a&&ti(i);if(Is==ao.PCB&&"TEXT"==a){var u=+m(i,"c_rotation");if(u){m(i,"c_rotation","0");ns.rotate(i,360-u)}}var f=(c||i).cloneNode(!0);Fo.updateOne(i);Is==ao.PCB&&m(i,"net")&&Qo.buildOneNet(m(i,"net"),!1);zo.save(["node",f.id,f,h])}}}}function Fa(e,t,r){function n(e,r,n,i){var a,o,d,p,h,u,f,v=m(t,"stroke-width")-0,x=i;a=be([e,r],v,s,l,c);f=i+g(y(c,2)-y(n,2)/4);if(f<a.d)return null;o=g(f*f-y(a.d,2));d=Te(a.point,r,a.point.x,a.point.y,o);if(0===d.length){d=[r];x=fe(r.x,r.y,s,l)-g(c*c-y(n/2,2))}p=d[0];h=Te(p,{x:s,y:l},p.x,p.y,x)[0];if(!h)return null;u=function(){f=Me({x:s,y:l},p);var t=f.a*h.y-f.b*h.x,n=f.b,i=-f.a,a=Oe(n,i,t,s,l,c);if(2!==a.length)return!1;var o=e.y-r.y,d=r.x-e.x,u=e.x*r.y-r.x*e.y,m=u+v/2*g(y(o,2)+y(d,2)),C=u-v/2*g(y(o,2)+y(d,2)),L=function(){var e=t+x*g(y(n,2)+y(i,2)),r=t-x*g(y(n,2)+y(i,2));return _e(0,n*p.x+i*p.y+e,.001)?e:_e(0,n*p.x+i*p.y+r,.001)?r:void 0}(),_=we(n,i,L,o,d,m),P=we(n,i,L,o,d,C);if(_&&P){var A=a[a.length-1];ue(A.x,A.y,_.x,_.y)>ue(A.x,A.y,P.x,P.y)?a.push(P,_):a.push(_,P)}return a}();return u}function i(e,r,n,i,s){function l(e,t,r){var n=Math.atan2(e.next.y-e.prev.y,e.next.x-e.prev.x),i=Ne(t,n),a=Ne(e.crossPoint,n),o=Ne(e.prev,n),s=Ne(e.next,n),l=a.x-i.x>0?1:-1,c=Math.abs(o.x-i.x)>Math.abs(s.x-i.x)?o:s;return fe(c.x,c.y,i.x,i.y)<r?Ne(c,-n):Ne({x:i.x+l*r,y:i.y},-n)}function c(e,t){var r,n=1/0,i=null;e.forEach(function(e){r=ue(e.crossPoint.x,e.crossPoint.y,t.x,t.y);if(r<n){n=r;i=e}});return i}var d=Me(e,r),p=m(t,"stroke-width")-0,h=d.c+p/2*g(y(d.a,2)+y(d.b,2)),u=d.c-p/2*g(y(d.a,2)+y(d.b,2)),f=a(d.a,d.b,h),v=a(d.a,d.b,u),x=c(f,r),C=c(v,r);if(!x||!C)return null;var L=fe(x.crossPoint.x,x.crossPoint.y,C.crossPoint.x,C.crossPoint.y);if(L>i)return null;if(o(x.prev,C.prev)&&o(x.next,C.next)){rad=Math.atan2(x.next.y-x.prev.y,x.next.x-x.prev.x);var _=Ne(n,rad),P=Ne(x.prev,rad),A=Ne(x.next,rad);if(P.x>A.x){var b=P;P=A;A=b}var S={x:_.x-.5*i,y:_.y},E={x:_.x+.5*i,y:_.y};S.x<P.x&&(S=P);E.x>A.x&&(E=A);var O=Ne(S,-rad),I=Ne(E,-rad)}else{var T=Me(x.prev,x.next),R=Me(C.prev,C.next),w=we(T.a,T.b,T.c,R.a,R.b,R.c),N=i/L*fe(w.x,w.y,x.crossPoint.x,x.crossPoint.y),k=i/L*fe(w.x,w.y,C.crossPoint.x,C.crossPoint.y);O=l(x,w,N);I=l(C,w,k)}var M,B,D=Me(O,I);if(Fe(r,D.a,D.b,D.c)>s){var V=D.c+s*g(y(D.a,2)+y(D.b,2)),F=D.c-s*g(y(D.a,2)+y(D.b,2));B=Fe(r,D.a,D.b,V)<Fe(r,D.a,D.b,F)?V:F}else{B=-D.a*r.x-D.b*r.y;M=!0}var G=we(D.a,D.b,B,d.a,d.b,h),Y=we(D.a,D.b,B,d.a,d.b,u);if(G&&Y){if(M){var j=Math.atan2(r.y-e.y,r.x-e.x),H=Ne(e,j),X=Ne(r,j),U=Ne(G,j),J=Ne(Y,j);(U.x>H.x&&U.x>X.x||U.x<H.x&&U.x<X.x)&&(U.x=X.x);(J.x>H.x&&J.x>X.x||J.x<H.x&&J.x<X.x)&&(J.x=X.x);G=Ne(U,-j);Y=Ne(J,-j)}var z=Ye({x:O.x-I.x,y:O.y-I.y},{x:G.x-I.x,y:G.y-I.y},!0),W=Ye({x:O.x-I.x,y:O.y-I.y},{x:Y.x-I.x,y:Y.y-I.y},!0);return Math.abs(z)>Math.abs(W)?[O,I,G,Y]:[O,I,Y,G]}}function a(e,t,r){var n=u[u.length-1],i=[];[].forEach.call(u,function(a){var o=De(n,a,e,t,r);o&&i.push({crossPoint:o,prev:n,next:a});n=a});return i}function o(e,t){return e.x===t.x&&e.y===t.y}var s,l,c,d,h,u,f=Array.prototype.slice.call(arguments,3),g=Math.sqrt,y=Math.pow;switch(e){case"round":var v=null;h=0;if("part_pad"===m(r,"c_partid")){d=p("ellipse:not([c_padid])",r);s=d[0].cx.baseVal.value;l=d[0].cy.baseVal.value;c=d[0].rx.baseVal.value}else if("part_via"===m(r,"c_partid")){p("circle",r).forEach(function(e){if(e.r.baseVal.value>h){h=e.r.baseVal.value;v=e}});s=v.cx.baseVal.value;l=v.cy.baseVal.value;c=v.r.baseVal.value}!function(e){function i(e,t){var r;r=n(e,t,o,d);return r?r.map(function(e){return ke({x:e.x,y:e.y},p,h)}):null}var a,o,d,p,h,u,f,g=e[0],y=e[1],v=m(t,"stroke-width")-0,x=m(t,"net"),C=m(t,"layerid");Math.sqrt,Math.pow;if(!(v>=2*c)){o=2*c*g/100,d=2*c*y/100;p=s;h=l;f=ke({x:s,y:l},-p,-h);s=f.x;l=f.y;u=[].map.call(t.points,function(e){return ke({x:e.x,y:e.y},-p,-h)});if(!be(u,v,s,l,c))return null;a=Ga(u,s,l,c);a.forEach(function(e){var n,a,o;if(e.passThrough){o=Te(u[e.index1],u[e.index2],s,l,c);if(2!==o.length)return;n=(o[0].x+o[1].x)/2;a=(o[0].y+o[1].y)/2;f=i({x:n,y:a},u[e.index1]);f&&Ya(f,x,r.id,t.id,C);f=i({x:n,y:a},u[e.index2]);f&&Ya(f,x,r.id,t.id,C)}else{f=i(u[e.inside],u[e.outside]);f&&Ya(f,x,r.id,t.id,C)}})}}(f);break;case"rectangle":u=p("polygon",r)[0].points;f.push(u);!function(e){var n=e[2],a=t.points,s=m(t,"stroke-width")-0,l=m(t,"net"),c=m(t,"layerid"),d=(Math.sqrt,Math.pow,s*e[0]/100),p=s*e[1]/100,h=function(){var e=1/0,t=-1/0,r=1/0,i=-1/0;[].forEach.call(n,function(n){n.x<e&&(e=n.x);n.x>t&&(t=n.x);n.y<r&&(r=n.y);n.y>i&&(i=n.y)});return{x:e,y:r,height:i-r,width:t-e}}();if(Eo.isPolylineTouchRect(t,h)){var u=null;[].forEach.call(a,function(e){if(u){var a=[],s=n[n.length-1];[].forEach.call(n,function(t){var r=le(u,e,s,t);r&&a.push({crossPoint:r,p1:s,p2:t});s=t});a=a.filter(function(e,t){var r=a[t+1];if(!r){if(!(a.length>=3))return!0;r=a[0]}return!o(e.crossPoint,r.crossPoint)});if(1===a.length||2===a.length&&o(a[0].crossPoint,a[1].crossPoint)){var h=Be(u,n),f=Be(e,n);h&&f&&(h=Be(u,n,!0));var g=h?u:e;Ya(i(g,h?e:u,a[0].crossPoint,d,p),l,r.id,t.id,c)}else if(2===a.length){g={x:(a[0].crossPoint.x+a[1].crossPoint.x)/2,y:(a[0].crossPoint.y+a[1].crossPoint.y)/2};if(ue(e.x,e.y,a[0].crossPoint.x,a[0].crossPoint.y)>ue(e.x,e.y,a[1].crossPoint.x,a[1].crossPoint.y))var y=i(e,u,a[0].crossPoint,d,p),v=i(g,e,a[1].crossPoint,d,p);else{y=i(e,u,a[1].crossPoint,d,p);v=i(g,e,a[0].crossPoint,d,p)}Ya(y,l,r.id,t.id,c);Ya(v,l,r.id,t.id,c)}u=e}else u=e})}}(f);break;case"oval":u=function(){var e=p("polyline",r)[0],t=e.points,n=(m(e,"stroke-width")-0)/2,i=Math.atan2(t[1].y-t[0].y,t[1].x-t[0].x),a=Ne(t[0],i),o=Ne(t[1],i),s=a.x-o.x>0?-1:1,l={x:a.x-s*n,y:a.y+n},c={x:a.x-s*n,y:a.y-n},d={x:o.x+s*n,y:o.y-n},h={x:o.x+s*n,y:o.y+n};return[Ne(l,-i),Ne(c,-i),Ne(d,-i),Ne(h,-i)]}();f.push(u);!function(e){function a(e,t,i){function a(e,t){var r=f[0]*g/100,n=fe(s,l,e.x,e.y)+c;r>n&&(r=n);var i=Ge(s,l,c,e.x,e.y,r);return ue(i[0].x,i[0].y,t.x,t.y)>ue(i[1].x,i[1].y,t.x,t.y)?i[1]:i[0]}if(!e)return null;var o=p("polyline",r)[0],h=m(o,"stroke-width")-0,u=function(){var e=o.points[0],t=o.points[1],r=Math.atan2(t.y-e.y,t.x-e.x),n=Ne(e,r),i=Ne(t,r),a={x:n.x,y:n.y-h/2},s={x:n.x,y:n.y+h/2},l={x:i.x,y:i.y+h/2},c={x:i.x,y:i.y-h/2};return[Ne(a,-r),Ne(s,-r),Ne(l,-r),Ne(c,-r)]}(),y=u[u.length-1],v=e[0],x=e[1],C=!1,L=!1;u.forEach(function(e){Ve(v,y,e)&&(C=!0);Ve(x,y,e)&&(L=!0);y=e});if(C&&L)return e;c=h/2;var _,P=o.points,A=1/0,b=[];Array.prototype.forEach.call(P,function(e,t){var r=ue(e.x,e.y,v.x,v.y),n=ue(e.x,e.y,x.x,x.y);b.push(r>n);var i=C?n:r;if(i<A){A=i;_=e}});s=_.x;l=_.y;if(C||L){if(C){var S=a(v,x);return[v,S,e[2],e[3]]}S=a(x,v);return[S,x,e[2],e[3]]}b=b.every(function(e){return e===b[0]});if(b){var E=f[0]*g/100,O=f[1]*g/100;E>2*c&&(E=2*c);d=ne(t,i,{x:s,y:l});return n(d,i,E,O)}var I,T,R=1/0,w=1/0;u.forEach(function(e){var t=ue(v.x,v.y,e.x,e.y);if(t<R){R=t;I=e}t=ue(x.x,x.y,e.x,e.y);if(t<w){w=t;T=e}});return[I,T,e[2],e[3]]}var d,h=e[2],u=t.points,g=m(t,"stroke-width")-0,y=m(t,"net"),v=m(t,"layerid"),x=(Math.sqrt,Math.pow,g*e[0]/100),C=g*e[1]/100,L=function(){var e=1/0,t=-1/0,r=1/0,n=-1/0;[].forEach.call(h,function(i){i.x<e&&(e=i.x);i.x>t&&(t=i.x);i.y<r&&(r=i.y);i.y>n&&(n=i.y)});return{x:e,y:r,height:n-r,width:t-e}}();if(Eo.isPolylineTouchRect(t,L)){var _=null;[].forEach.call(u,function(e){if(_){var n=[],s=h[h.length-1];[].forEach.call(h,function(t){var r=le(_,e,s,t);r&&n.push({crossPoint:r,p1:s,p2:t});s=t});n=n.filter(function(e,t){var r=n[t+1];if(!r){if(!(n.length>=3))return!0;r=n[0]}return!o(e.crossPoint,r.crossPoint)});if(1===n.length||2===n.length&&o(n[0].crossPoint,n[1].crossPoint)){var l=Be(_,h),c=l?_:e,d=l?e:_,p=i(c,d,n[0].crossPoint,x,C);p=a(p,c,d);Ya(p,y,r.id,t.id,v)}else if(2===n.length){c={x:(_.x+e.x)/2,y:(_.y+e.y)/2};if(ue(e.x,e.y,n[0].crossPoint.x,n[0].crossPoint.y)>ue(e.x,e.y,n[1].crossPoint.x,n[1].crossPoint.y))var u=i(c,_,n[0].crossPoint,x,C),f=i(c,e,n[1].crossPoint,x,C);else{u=i(c,_,n[1].crossPoint,x,C);f=i(c,e,n[0].crossPoint,x,C)}u=a(u,c,_);f=a(f,c,e);Ya(u,y,r.id,t.id,v);Ya(f,y,r.id,t.id,v)}_=e}else _=e})}}(f)}}function Ga(e,t,r,n){var i,a,o=null,s=null,l=[];[].forEach.call(e,function(e,c){i=Se(e.x,e.y,t,r,n);o!==i&&null!==o&&l.push(i?{inside:c,outside:c-1}:{inside:c-1,outside:c});if(s&&!1===i&&!1===o){a=ie(e,s,{x:t,y:r});a&&a.distance2<Math.pow(n,2)&&l.push({passThrough:!0,index1:c,index2:c-1})}o=i;s=e});return l}function Ya(e,t,r,n,i,a,o){var s,l,c="";if(e&&!(e.length<3)){for(l=0;l<e.length;l++)if(isNaN(e[l].x)||isNaN(e[l].x))return;e.forEach(function(e){c+=(""===c?"M":"L")+Eo.toFixed(e.x,5)+","+Eo.toFixed(e.y,5)});c+="Z";s=zt("path",{d:c,"stroke-width":"0",type:"solid",layerid:i,c_shapetype:"line",net:t,c_targetpad:r,c_targetwire:n,c_teardrop:"1"});m(s,{id:Eo.newId()});Ls.appendElement(s,"SOLIDREGION");Fo.updateOne(s,{notRealtimeDRC:!0});var d=Ko.checkNodeForError(s);if(!o&&d.hasError&&"solidregion2copperarea"!==d.errObj.errorStr){Fo.removeOne(s);v(s)}else a||zo.save(["add",s.id,Eo.node.getRefId(s)])}}function ja(e,t,r,n){function i(e){setTimeout(function(){P+=C;var t=Math.round(P);if(t>A){_.length&&parent.$.data(_[0],"progressbar")&&_.progressbar("setValue",t);A=t}if(!v.is(":visible")&&e<L-2)return a();b[e]&&b[e].func(b[e].el,e);if(e===L-1||!b[e])return a();i(e+1)},0)}function a(){v&&v.dialog("close");zo.saveBatch();sr("buildCopper",["all"]);"function"==typeof g[g.length-1]&&g[g.length-1]()}function o(e,t){return 11===Number(m(e,"layerid"))||m(e,"layerid")===m(t,"layerid")}var s=[1,2,21,22,23,24],l=p('#g1 g[c_partid="part_pad"][c_shape="ELLIPSE"]'),c=p('#g1 g[c_partid="part_pad"][c_shape="RECT"]'),d=p('#g1 g[c_partid="part_pad"][c_shape="POLYGON"]'),h=p('#g1 g[c_partid="part_pad"][c_shape="OVAL"]'),f=p('#g1 g[c_partid="part_via"]'),g=arguments,y=p('#g1 polyline[c_shapetype="line"]'),v=parent.$.messager.progress({title:parent.Locale.i18n("Applying Teardrops"),interval:0,value:0,text:parent.Locale.i18n("Progressing..."),closable:!0}),x=function(e){var t=0;e.length&&e.forEach(function(e){t+=e.length});return t>0?{percent:100/t,count:t}:{percent:100,count:0}}([l,c,d,h,f]),C=x.percent,L=x.count,_=parent.$.messager.progress("bar",v),P=0,A=0,b=[];_.progressbar("options").text="{value}%";u(Yo,"active",!1);Yo=null;sr("triggerEvent",["select_change"]);cr();y=y.filter(function(e){var t=Number(m(e,"layerid"));return!bi(t)&&s.indexOf(t)>=0});zo.startBatch();Ha(null,null,!0,function(s){if(1==s)return a();l.forEach(function(r){b.push({el:r,func:function(r){p("ellipse",r).length>0&&y.forEach(function(n){if(o(r,n))try{Fa("round",n,r,e,t)}catch(e){}})}})});f.forEach(function(r){b.push({el:r,func:function(r){y.forEach(function(n){if(o(r,n))try{Fa("round",n,r,e,t)}catch(e){}})}})});c.forEach(function(e){b.push({el:e,func:function(e){y.forEach(function(t){if(o(e,t))try{Fa("rectangle",t,e,r,n)}catch(e){}})}})});d.forEach(function(e){b.push({el:e,func:function(e){y.forEach(function(t){if(o(e,t))try{Fa("rectangle",t,e,r,n)}catch(e){}})}})});h.forEach(function(e){b.push({el:e,func:function(e){y.forEach(function(t){if(o(e,t))try{Fa("oval",t,e,r,n)}catch(e){}})}})});i(0)})}function Ha(e,t,r,n){function i(e,r,o){setTimeout(function(){f+=c;var p=Math.round(f);if(p>g){u.length&&parent.$.data(u[0],"progressbar")&&u.progressbar("setValue",p);g=p}if(l.is(":visible")||!(h<d-2)){r(e[o],o);h+=1;return h===d?a():i(e,r,o+1)}l&&l.dialog("close");t||zo.save(s);n&&n(!0)},0)}function a(){l&&l.dialog("close");t||zo.save(s);n&&n()}var o=[],s=[];e?e.pad?o=p('#g1 path[c_teardrop="1"][c_targetpad="'+e.pad+'"]'):e.wire&&(o=p('#g1 path[c_teardrop="1"][c_targetwire="'+e.wire+'"]')):o=p('#g1 path[c_teardrop="1"]');if(!r){o.forEach(function(e,t){if("1"!==m(e,"locked")){s.push(["del",e.id,Eo.node.getRefId(e)]);Fo.removeOne(e);Ro.appendChild(e)}});t||zo.save(s);n&&n();return s}if(o.length){var l=parent.$.messager.progress({title:parent.Locale.i18n("Removing Teardrops"),interval:0,value:0,text:parent.Locale.i18n("Progressing..."),closable:!0}),c=100/o.length,d=o.length,h=0,u=parent.$.messager.progress("bar",l),f=0,g=0;u.progressbar("options").text="{value}%";i(o,function(e,t){if("1"!==m(e,"locked")){s.push(["del",e.id,Eo.node.getRefId(e)]);Fo.removeOne(e);Ro.appendChild(e)}},0)}else n&&n()}function Xa(e){var t=[];e?e.pad?t=p('#g1 path[c_teardrop="1"][c_targetpad="'+e.pad+'"]'):e.wire&&(t=p('#g1 path[c_teardrop="1"][c_targetwire="'+e.wire+'"]')):t=p('#g1 path[c_teardrop="1"]');return t}function Ua(e){if(e){Os.config=e
;Os.config.activeLineArr=Yo?[Yo]:Eo.extend([],p("#g1 .selected",Ka));t.addEventListener("mousemove",Os.events.mmove,!1);t.addEventListener("mouseup",Os.events.mup,!1);u(Ka,"events-none",!0);Uo="DrawRouteLengthTuning"}}function Ja(e,t,r,n,i,a,o){function s(e){return e?e.reduce(function(t,r,n){return n<=0?0:r.path&&"A"===r.path[0]?t+=ls.getLengthOfTrackAndArc({d:"M "+e[n-1].x+" "+e[n-1].y+" "+r.path}):t+=fe(r.x,r.y,e[n-1].x,e[n-1].y)},0):0}r=Number(r);n=Number(n);null!==i&&(i=Number(i));var l,c,d=[],p=0,h=0,u=!0,f=!0,g=!0,y={string:"",terminalPoint:e},v=fe(e.x,e.y,t.x,t.y),x={MITERED_WITH_NONE:{getSnake:function(i,a,o,l){var c=i?1:-1,d=Math.atan2(t.y-e.y,t.x-e.x),p=Ne(a,d),h=[];h.push(p,{x:p.x,y:p.y-c*n},{x:p.x+r,y:p.y-c*n},{x:p.x+r,y:p.y});h=h.map(function(e){return Ne(e,-d)});return new Os.Snake(h,"polyline",s(h),o,l)},getSingleSnakeWidth:function(e,t){return r}},MITERED_WITH_LINE:{getSnake:function(i,a,o,l){var c=Number(Zo.canvas.routing),d=i?1:-1,p=Math.atan2(t.y-e.y,t.x-e.x),h=Ne(a,p),u=[];u.push(Eo.extend({},h));if(o){var f={x:h.x+c,y:h.y-d*c};u.push(f);h.x=f.x}u.push({x:h.x,y:h.y-d*(n-c)},{x:h.x+c,y:h.y-d*n},{x:h.x+r-c,y:h.y-d*n},{x:h.x+r,y:h.y-d*(n-c)},{x:h.x+r,y:h.y});if(l){var g=u.pop();u.push({x:g.x,y:g.y-d*c},{x:g.x+c,y:g.y})}u=u.map(function(e){return Ne(e,-p)});return new Os.Snake(u,"polyline",s(u),o,l)},getSingleSnakeWidth:function(e,t){var n=Number(Zo.canvas.routing),i=r;e&&(i+=n);t&&(i+=n);return i}},MITERED_WITH_ARC:{getSnake:function(i,a,o,l){function c(e,t){var r=e[e.length-1];r&&Math.abs(t.x-r.x)<d&&Math.abs(t.y-r.y)<d||e.push(t)}var d=.001,p=r/2,h=i?1:-1,u=Math.atan2(t.y-e.y,t.x-e.x),f=Ne(a,u),g=[];g.push(Eo.extend({},f));if(o){var y={x:f.x+p,y:f.y-h*p,path:"A "+p+" "+p+" 0 0 0 $x $y"};g.push(y);f.x=y.x}c(g,{x:f.x,y:f.y-h*(n-p),path:"L $x $y"});c(g,{x:f.x+r,y:f.y-h*(n-p),path:"A "+p+" "+p+" 0 0 "+(i?1:0)+" $x $y"});c(g,{x:f.x+r,y:f.y,path:"L $x $y"});if(l){var v=g.pop();c(g,{x:v.x,y:v.y-h*p,path:"L $x $y"});c(g,{x:v.x+p,y:v.y,path:"A "+p+" "+p+" 0 0 "+(i?0:1)+" $x $y"})}g=g.map(function(e){var t=Ne(e,-u);e.path&&(t.path=e.path.replace(/\$x/g,t.x).replace(/\$y/g,t.y));return t});return new Os.Snake(g,"path",s(g),o,l)},getSingleSnakeWidth:function(e,t){var n=r/2,i=r;e&&(i+=n);t&&(i+=n);return i}}};x[a];for(;h+x[a].getSingleSnakeWidth(f,g)<v;){g=h+x[a].getSingleSnakeWidth(f,!1)+x[a].getSingleSnakeWidth(!1,!0)>v;y=x[a].getSnake(u,y.terminalPoint,f,g);l=x[a].getSingleSnakeWidth(f,g);lastSnakeWidth=x[a].getSingleSnakeWidth(f,!0);lastSnake=x[a].getSnake(!u,y.terminalPoint,f,!0);if(null!==i&&p+(lastSnake.length-lastSnakeWidth)>i){if(d.length>0&&!d[d.length-1].isLastSnake){d.pop();if(0===d.length){c=e;f=!0}else c=d[d.length-1].terminalPoint;d.push(x[a].getSnake(!u,c,f,!0))}break}p+=y.length-l;d.push(y);h+=l;u=!u;f=!1}return o?0===d.length?"M "+e.x+" "+e.y+" L "+t.x+" "+t.y:"M "+d.join("L ")+" L "+t.x+" "+t.y:0===d.length?e.x+" "+e.y+" "+t.x+" "+t.y:d.join(" ")+" "+t.x+" "+t.y}function za(e,t){function r(e,t){return{x:2*t.x-e.x,y:2*t.y-e.y}}function n(e){var t=Eo.units.convert("2mm","pixel"),r=t/2,n=e.x,i=e.y,a=d("part_hole").cloneNode(!0);m(a,{display:"",id:Eo.newId(),c_origin:n+","+i,c_outlinetype:"panelizedOutline"});m(a.childNodes[0],"d",J(n,i,r));m(a.childNodes[1],{r:r,cx:n,cy:i});m(a.childNodes[2],{rx:r,ry:r,cx:n,cy:i});return a}function i(e){var t=Eo.units.convert("1mm","pixel"),r=t/2,n=e.x,i=e.y;return["BOTTOM","TOP"].map(function(e){var a=zt("g"),o=Eo.newId(),s=zt("ellipse",{cx:n,cy:i,rx:r+3.937,ry:r+3.937,layerid:io[e+"SOLDERLAYER"],"stroke-width":0,c_padid:o}),l=zt("ellipse",{cx:n,cy:i,rx:r,ry:r,layerid:io[e+"PASTERLAYER"],"stroke-width":0,c_padid:o}),c=zt("ellipse",{cx:n,cy:i,rx:r,ry:r,layerid:io[e+"LAYER"],stroke:"none",id:Eo.newId()}),d=zt("circle",{cx:n,cy:i,r:0,layerid:io[e+"LAYER"],stroke:"none",id:Eo.newId()});a.appendChild(s);a.appendChild(l);a.appendChild(c);a.appendChild(d);m(a,{id:o,layerid:io[e+"LAYER"],display:"",c_partid:"part_pad",c_origin:n+","+i,c_outlinetype:"panelizedOutline",number:"",c_width:t,c_height:t,c_shape:"ELLIPSE",c_shapeType:"group",c_rotation:0,c_type:"pinpart",c_etype:"pinpart",solderExpansion:3.937});return a})}function a(e){var t=zt("rect",{x:e.x,y:e.y,width:e.width,height:e.height,"stroke-width":"1",fill:"none",layerid:io.BOARDOUTLINE,c_outlinetype:"panelizedOutline"});m(t,{id:Eo.newId()});return t}var o=Zo.canvas.unit,s=e.row,l=e.column;!e.columnSpacing&&(e.columnSpacing=0);!e.rowSpacing&&(e.rowSpacing=0);var c=Eo.units.convert(e.columnSpacing,"pixel",o).toFixed(3)+o,h=Eo.units.convert(e.rowSpacing,"pixel",o).toFixed(3)+o,u=e.columnSpacing>1e-4||e.rowSpacing>1e-4;Fo.gJsonCache.panelize||(Fo.gJsonCache.panelize={row:1,column:1,rowSpacing:0,columnSpacing:0,createBorder:!1});var f=JSON.parse(JSON.stringify(Fo.gJsonCache.panelize));Fo.gJsonCache.panelize=e;!function(){(p('[c_outlinetype="panelizedOutline"]')||[]).forEach(function(e){e.remove()})}();if(1!==s||1!==l){var y=ri();if(0!==y.height||0!==y.width){for(var v=p('[layerid="'+io.BOARDOUTLINE+'"]:not([c_outlinetype="panelizedOutline"])'),x=0;x<s;x++)for(var C=0;C<l;C++)0===x&&0===C||v.forEach(function(t){var r=t.cloneNode();It(r,C*(y.width+e.columnSpacing),x*(y.height+e.rowSpacing));m(r,{id:Eo.newId(),c_outlinetype:"panelizedOutline"});xs.appendChild(r)});var L=function(t,r,n,i,a){function o(e,t,r){return sr("getFontPath",[{text:"V-CUT",x:e,y:t,degree:r||0,fontSize:6}])}var s,l,c,d;if(e.createBorder)if("topBottom"===e.borderPosition){l=n.x;s=n.x+n.width*t+e.columnSpacing*(t-1)+32;c=n.y-e.borderHeight;d=n.y+n.height*r+e.borderHeight+e.rowSpacing*(r-1)+32}else{l=n.x-e.borderHeight;s=n.x+n.width*t+e.borderHeight+e.columnSpacing*(t-1)+32;c=n.y;d=n.y+n.height*r+e.rowSpacing*(r-1)+32}else{l=n.x;s=n.x+n.width*t+e.columnSpacing*(t-1)+32;c=n.y;d=n.y+n.height*r+e.rowSpacing*(r-1)+32}for(var p,h,u,f,g=[],y=1;y<r;y++){u=n.y+y*n.height+i*(y-1);g.push(["M",l,u,"L",s,u].join(" ")+o(s-28,u-5));if(i>1e-4){f=u+i;g.push(["M",l,f,"L",s,f].join(" ")+o(s-28,f-5))}}for(var v=1;v<t;v++){p=n.x+v*n.width+a*(v-1);g.push(["M",p,c,"L",p,d].join(" ")+o(p-5,d,90));if(a>1e-4){h=p+a;g.push(["M",h,c,"L",h,d].join(" ")+o(h-5,d,90))}}return zt("path",{d:g.join(" "),"stroke-width":"1",fill:"none",layerid:io.BOARDOUTLINE,c_outlinetype:"panelizedOutline",id:Eo.newId()})}(l,s,y,e.rowSpacing,e.columnSpacing);xs.appendChild(L);var _={x:y.x,y:"topBottom"===e.borderPosition?y.y-e.borderHeight-50:y.y-50};!function(e,t,r,n,i){var a,o={"stroke-width":.5,fill:"none",id:Eo.newId(),c_shapetype:"line",layerid:io.DOCUMENT,c_outlinetype:"panelizedOutline"},s={stroke:"none",id:Eo.newId(),c_shapetype:"line",layerid:io.DOCUMENT,c_outlinetype:"panelizedOutline"};if("zh-hans"===sr("getLanguage")){
s.d="M 1.22 9.11 C 1.48 8.88 1.79 8.55 2.04 8.23 C 2.2 8.24 2.29 8.19 2.32 8.1 L 1.55 7.8 C 1.4 8.25 1.23 8.74 1.1 9.03 Z M -1.12 7.94 C -0.9 8.19 -0.66 8.63 -0.63 8.99 C -0.13 9.4 0.41 8.39 -1.03 7.88 Z M 1.44 12.15 C 1.32 12.59 1.14 12.97 0.89 13.31 C 0.57 13.21 0.17 13.13 -0.33 13.08 C -0.16 12.81 0.05 12.47 0.23 12.15 Z M 1.79 11.59 L 1.43 11.92 L 0.36 11.92 C 0.44 11.78 0.51 11.63 0.56 11.53 C 0.8 11.55 0.88 11.48 0.91 11.39 L 0.24 11.16 L 0.33 11.16 C 0.55 11.16 0.81 11.03 0.81 10.97 L 0.81 9.77 C 1.16 10.07 1.54 10.52 1.68 10.87 C 2.28 11.23 2.66 10.07 0.81 9.6 L 0.81 9.46 L 2.46 9.46 C 2.57 9.46 2.65 9.42 2.67 9.33 C 2.42 9.09 2.01 8.77 2.01 8.77 L 1.67 9.23 L 0.81 9.23 L 0.81 7.86 C 1.01 7.83 1.08 7.75 1.1 7.65 L 0.22 7.55 L 0.22 9.23 L -1.42 9.23 L -1.36 9.46 L -0.05 9.46 C -0.37 10.11 -0.89 10.72 -1.52 11.18 L -1.44 11.31 C -0.79 10.99 -0.22 10.59 0.22 10.09 L 0.22 11.15 L 0.08 11.11 C 0 11.3 -0.14 11.59 -0.31 11.92 L -1.45 11.92 L -1.38 12.15 L -0.42 12.15 C -0.63 12.55 -0.86 12.95 -1.03 13.19 C -0.56 13.28 0.03 13.47 0.54 13.71 C 0.07 14.18 -0.56 14.54 -1.4 14.8 L -1.34 14.93 C -0.36 14.72 0.38 14.39 0.93 13.93 C 1.18 14.07 1.39 14.23 1.53 14.39 C 2 14.55 2.22 13.95 1.36 13.5 C 1.67 13.14 1.91 12.71 2.08 12.23 C 2.24 12.23 2.33 12.2 2.39 12.13 Z M 4.6 9.61 C 4.52 10.65 4.33 11.58 3.93 12.39 C 3.56 11.75 3.3 11.02 3.12 10.22 C 3.21 10.02 3.3 9.83 3.38 9.61 Z M 5.83 9.61 C 5.94 9.61 6.01 9.57 6.04 9.48 C 5.76 9.22 5.29 8.85 5.29 8.85 L 4.88 9.38 L 3.47 9.38 C 3.62 8.94 3.76 8.47 3.87 7.98 C 4.04 7.98 4.14 7.9 4.16 7.79 L 3.18 7.58 C 3.03 9 2.64 10.48 2.16 11.48 L 2.28 11.55 C 2.55 11.25 2.78 10.89 2.98 10.5 C 3.13 11.35 3.35 12.15 3.67 12.86 C 3.19 13.63 2.49 14.28 1.48 14.83 L 1.54 14.92 C 2.6 14.53 3.37 13.99 3.93 13.35 C 4.31 13.98 4.78 14.52 5.41 14.94 C 5.5 14.65 5.71 14.49 6 14.44 L 6.02 14.36 C 5.29 13.99 4.72 13.51 4.28 12.91 C 4.89 12.01 5.17 10.91 5.31 9.61 Z M 11.85 8.25 L 11.85 8.8 L 8.55 8.8 L 8.55 8.25 Z M 8.55 9.62 L 8.55 9.04 L 11.85 9.04 L 11.85 9.62 Z M 8.55 9.85 L 11.85 9.85 L 11.85 10.13 L 11.96 10.13 C 12.16 10.13 12.48 10 12.49 9.95 L 12.49 8.36 C 12.65 8.33 12.78 8.27 12.84 8.2 L 12.11 7.65 L 11.77 8.02 L 8.6 8.02 L 7.92 7.72 L 7.92 10.2 L 8 10.2 C 8.26 10.2 8.55 10.06 8.55 10 Z M 13.6 10.6 C 13.72 10.6 13.79 10.56 13.8 10.47 C 13.54 10.22 13.08 9.87 13.08 9.87 L 12.69 10.37 L 6.64 10.37 L 6.7 10.6 Z M 8.48 12.8 L 8.48 12.19 L 9.88 12.19 L 9.88 12.8 Z M 9.88 11.35 L 9.88 11.95 L 8.48 11.95 L 8.48 11.35 Z M 11.96 11.35 L 11.96 11.95 L 10.52 11.95 L 10.52 11.35 Z M 10.52 12.8 L 10.52 12.19 L 11.96 12.19 L 11.96 12.8 Z M 12.68 14.53 L 10.52 14.53 L 10.52 13.87 L 13.12 13.87 C 13.23 13.87 13.31 13.83 13.33 13.75 C 13.06 13.49 12.62 13.15 12.62 13.15 L 12.23 13.63 L 10.52 13.63 L 10.52 13.03 L 11.96 13.03 L 11.96 13.26 L 12.06 13.26 C 12.26 13.26 12.6 13.12 12.6 13.07 L 12.6 11.48 C 12.76 11.45 12.9 11.38 12.96 11.31 L 12.2 10.75 L 11.88 11.12 L 8.52 11.12 L 7.84 10.83 L 7.84 13.41 L 7.92 13.41 C 8.2 13.41 8.48 13.27 8.48 13.21 L 8.48 13.03 L 9.88 13.03 L 9.88 13.63 L 7.22 13.63 L 7.28 13.87 L 9.88 13.87 L 9.88 14.53 L 6.61 14.53 L 6.68 14.75 L 13.66 14.75 C 13.77 14.75 13.85 14.71 13.87 14.63 C 13.58 14.37 13.09 13.99 13.09 13.99 Z M 16.16 10.9 C 16.48 10.9 16.71 10.65 16.71 10.35 C 16.71 10.05 16.48 9.8 16.16 9.8 C 15.84 9.8 15.6 10.05 15.6 10.35 C 15.6 10.65 15.84 10.9 16.16 10.9 Z M 16.16 14.01 C 16.48 14.01 16.71 13.76 16.71 13.47 C 16.71 13.16 16.48 12.91 16.16 12.91 C 15.84 12.91 15.6 13.16 15.6 13.47 C 15.6 13.76 15.84 14.01 16.16 14.01 Z M 3.95 23.63 L 0.49 23.63 L 0 23.4 C 0.88 23.19 1.68 22.91 2.39 22.54 C 2.96 22.84 3.59 23.09 4.26 23.28 Z M 2.55 26.2 L 2.55 25.14 L 4.03 25.14 L 4.03 26.2 Z M 0.44 25.14 L 1.96 25.14 L 1.96 26.2 L 0.44 26.2 Z M 1.96 24.91 L 0.44 24.91 L 0.44 23.86 L 1.96 23.86 Z M 4.03 24.91 L 2.55 24.91 L 2.55 23.86 L 4.03 23.86 Z M 3.74 20.73 C 3.36 21.18 2.89 21.6 2.32 21.97 C 1.71 21.71 1.17 21.37 0.77 20.97 C 0.84 20.89 0.91 20.81 0.98 20.73 Z M 4.3 20.1 L 3.82 20.49 L 1.18 20.49 C 1.33 20.3 1.48 20.11 1.59 19.92 C 1.8 19.94 1.86 19.91 1.9 19.82 L 0.92 19.55 C 0.48 20.55 -0.41 21.78 -1.26 22.47 L -1.17 22.55 C -0.53 22.2 0.11 21.67 0.64 21.11 C 0.97 21.55 1.4 21.92 1.88 22.24 C 0.9 22.81 -0.28 23.27 -1.52 23.56 L -1.46 23.69 C -1.03 23.63 -0.6 23.55 -0.2 23.46 L -0.2 23.46 L -0.2 26.94 L -0.1 26.94 C 0.16 26.94 0.44 26.79 0.44 26.72 L 0.44 26.43 L 4.03 26.43 L 4.03 26.89 L 4.13 26.89 C 4.35 26.89 4.67 26.75 4.68 26.71 L 4.68 23.97 C 4.84 23.94 4.96 23.87 5 23.81 L 4.35 23.31 C 4.71 23.4 5.08 23.49 5.47 23.56 C 5.55 23.24 5.74 23.03 6.02 22.96 L 6.04 22.87 C 5 22.76 3.92 22.55 2.97 22.22 C 3.6 21.83 4.16 21.38 4.6 20.87 C 4.82 20.85 4.92 20.83 4.98 20.75 Z M 9.96 19.63 C 10.38 19.98 10.84 20.55 10.97 21.05 C 11.68 21.49 12.14 20 10.04 19.57 Z M 7.09 19.79 C 7.44 20.04 7.86 20.5 8 20.9 C 8.68 21.26 9.05 19.93 7.16 19.72 Z M 6.52 21.55 C 6.86 21.78 7.27 22.19 7.39 22.57 C 8.04 22.94 8.43 21.64 6.6 21.47 Z M 8.88 20.88 C 7.44 24.21 7.44 24.21 7.28 24.5 C 7.2 24.67 7.16 24.67 7.07 24.67 L 6.7 24.67 L 6.7 24.84 C 6.88 24.85 7 24.88 7.11 24.96 C 7.28 25.07 7.33 25.73 7.21 26.54 C 7.24 26.8 7.36 26.94 7.52 26.94 C 7.83 26.94 8.01 26.71 8.03 26.35 C 8.06 25.7 7.8 25.35 7.79 24.99 C 7.79 24.79 7.84 24.51 7.92 24.26 C 8.03 23.84 8.68 21.94 9.02 20.92 Z M 12.81 26.4 L 11.49 26.4 L 11.49 23.87 L 13.45 23.87 C 13.57 23.87 13.65 23.83 13.67 23.74 C 13.4 23.48 12.95 23.12 12.95 23.12 L 12.55 23.63 L 11.49 23.63 L 11.49 21.55 L 13.66 21.55 C 13.77 21.55 13.84 21.51 13.87 21.43 C 13.6 21.16 13.12 20.79 13.12 20.79 L 12.72 21.32 L 8.92 21.32 L 8.98 21.55 L 10.84 21.55 L 10.84 23.63 L 8.93 23.63 L 9 23.87 L 10.84 23.87 L 10.84 26.4 L 8.46 26.4 L 8.52 26.64 L 13.77 26.64 C 13.88 26.64 13.96 26.6 13.98 26.51 C 13.7 26.24 13.22 25.86 13.22 25.86 Z M 16.16 22.9 C 16.48 22.9 16.71 22.65 16.71 22.35 C 16.71 22.05 16.48 21.8 16.16 21.8 C 15.84 21.8 15.6 22.05 15.6 22.35 C 15.6 22.65 15.84 22.9 16.16 22.9 Z M 16.16 26.01 C 16.48 26.01 16.71 25.76 16.71 25.47 C 16.71 25.16 16.48 24.91 16.16 24.91 C 15.84 24.91 15.6 25.16 15.6 25.47 C 15.6 25.76 15.84 26.01 16.16 26.01 Z M 28.18 20.51 L 28.18 23.45 L 24.32 23.45 L 24.32 20.51 Z M 24.32 23.68 L 28.18 23.68 L 28.18 24.19 L 28.28 24.19 C 28.5 24.19 28.84 24.05 28.84 23.99 L 28.84 20.63 C 29 20.59 29.12 20.53 29.18 20.47 L 28.44 19.9 L 28.1 20.29 L 24.36 20.29 L 23.65 19.98 L 23.65 24.29 L 23.76 24.29 C 24.04 24.29 24.32 24.15 24.32 24.07 Z M 22.53 26.94 C 23.77 26.44 24.92 25.55 25.56 24.82 C 25.74 24.86 25.8 24.82 25.85 24.74 L 25 24.27 C 24.5 25.1 23.48 26.17 22.46 26.84 Z M 26.98 24.46 C 27.76 25.03 28.78 26.01 29.12 26.79 C 29.93 27.24 30.21 25.48 27.06 24.39 Z M 36.26 19.55 C 36.09 20.16 35.85 20.83 35.65 21.23 L 35.76 21.31 C 36.15 20.99 36.56 20.51 36.9 20.03 C 37.06 20.04 37.16 19.98 37.2 19.89 Z M 33.69 19.64 C 33.97 20.01 34.28 20.59 34.3 21.07 C 34.91 21.59 35.52 20.29 33.78 19.59 Z M 34.77 23.49 L 34.77 23.33 L 34.77 21.62 L 35.92 21.62 L 35.92 23.49 Z M 36.9 23.49 L 36.56 23.49 L 36.56 21.62 L 37.65 21.62 C 37.76 21.62 37.84 21.58 37.86 21.49 C 37.59 21.23 37.13 20.87 37.13 20.87 L 36.74 21.39 L 33.28 21.39 C 33.04 21.15 32.76 20.91 32.76 20.91 L 32.41 21.41 L 32.28 21.41 L 32.28 19.87 C 32.48 19.85 32.56 19.77 32.57 19.65 L 31.67 19.55 L 31.67 21.41 L 30.53 21.41 L 30.6 21.64 L 31.67 21.64 L 31.67 23.25 C 31.12 23.41 30.66 23.54 30.41 23.59 L 30.69 24.39 C 30.77 24.37 30.85 24.29 30.88 24.19 C 31.16 24.05 31.42 23.91 31.67 23.79 L 31.67 26.03 C 31.67 26.15 31.63 26.19 31.5 26.19 C 31.36 26.19 30.67 26.14 30.67 26.14 L 30.67 26.26 C 30.99 26.31 31.16 26.38 31.27 26.48 C 31.36 26.58 31.4 26.74 31.42 26.93 C 32.19 26.85 32.28 26.58 32.28 26.08 L 32.28 23.46 C 32.72 23.22 33.08 23.01 33.38 22.84 L 33.35 22.74 C 32.99 22.85 32.62 22.96 32.28 23.07 L 32.28 21.64 L 33.2 21.64 C 33.24 21.64 33.28 21.63 33.32 21.62 L 34.13 21.62 L 34.13 23.34 L 34.13 23.49 L 32.88 23.49 L 32.95 23.72 L 34.12 23.72 C 34.08 24.87 33.79 25.96 32.54 26.86 L 32.63 26.95 C 34.36 26.15 34.71 24.91 34.76 23.72 L 35.92 23.72 L 35.92 26.93 L 36.03 26.93 C 36.36 26.93 36.56 26.78 36.56 26.74 L 36.56 23.72 L 37.79 23.72 C 37.9 23.72 37.98 23.68 38 23.59 C 37.73 23.35 37.28 22.98 37.28 22.98 Z M 42.65 19.59 C 42.88 19.81 43.12 20.21 43.14 20.55 C 43.71 20.99 44.28 19.84 42.72 19.53 Z M 45.56 20.9 C 45.68 20.9 45.74 20.86 45.76 20.77 C 45.51 20.52 45.08 20.19 45.08 20.19 L 44.72 20.67 L 41.18 20.67 L 41.24 20.9 Z M 41.89 21.07 C 42.09 21.4 42.33 21.91 42.36 22.32 C 42.87 22.79 43.46 21.72 41.98 21.02 Z M 41.23 22.75 L 45.65 22.75 C 45.76 22.75 45.84 22.71 45.86 22.63 C 45.6 22.37 45.14 22.03 45.14 22.03 L 44.76 22.51 L 43.83 22.51 C 44.18 22.17 44.53 21.76 44.75 21.43 C 44.91 21.43 45.01 21.37 45.04 21.27 L 44.14 21.03 C 44.03 21.47 43.81 22.07 43.6 22.51 L 41.11 22.51 L 41.15 22.69 C 40.83 22.82 40.51 22.95 40.2 23.05 L 40.2 21.62 L 41.15 21.62 C 41.26 21.62 41.34 21.58 41.36 21.49 C 41.12 21.24 40.73 20.9 40.73 20.9 L 40.39 21.39 L 40.2 21.39 L 40.2 19.87 C 40.4 19.84 40.48 19.76 40.5 19.65 L 39.6 19.55 L 39.6 21.39 L 38.49 21.39 L 38.56 21.62 L 39.6 21.62 L 39.6 23.28 C 39.08 23.47 38.64 23.63 38.4 23.7 L 38.75 24.45 C 38.83 24.41 38.89 24.33 38.91 24.23 C 39.16 24.09 39.38 23.95 39.6 23.82 L 39.6 25.98 C 39.6 26.09 39.56 26.13 39.42 26.13 C 39.27 26.13 38.56 26.07 38.56 26.07 L 38.56 26.2 C 38.89 26.25 39.07 26.32 39.18 26.44 C 39.27 26.54 39.31 26.71 39.33 26.92 C 40.11 26.84 40.2 26.54 40.2 26.04 L 40.2 23.44 C 40.62 23.18 40.96 22.95 41.24 22.78 Z M 44.14 24.02 C 44 24.59 43.77 25.06 43.42 25.44 C 43.05 25.34 42.62 25.23 42.12 25.15 C 42.32 24.82 42.54 24.41 42.74 24.02 Z M 44.8 23.79 L 42.86 23.79 C 42.96 23.59 43.05 23.41 43.12 23.27 C 43.35 23.27 43.42 23.2 43.45 23.11 L 42.57 22.87 C 42.49 23.08 42.34 23.42 42.17 23.79 L 40.73 23.79 L 40.8 24.02 L 42.06 24.02 C 41.85 24.46 41.61 24.91 41.43 25.19 C 42.02 25.36 42.58 25.57 43.07 25.79 C 42.49 26.25 41.69 26.58 40.6 26.82 L 40.64 26.95 C 41.98 26.79 42.91 26.48 43.56 26.01 C 44.14 26.29 44.62 26.58 44.96 26.84 C 45.56 27.19 46.31 26.4 44.01 25.63 C 44.4 25.2 44.67 24.67 44.85 24.02 L 45.71 24.02 C 45.82 24.02 45.9 23.98 45.92 23.89 C 45.65 23.63 45.2 23.28 45.2 23.28 Z M 48.9 25.51 C 50.62 24.59 51.08 23.02 51.21 21.58 L 52.77 21.58 C 52.71 23.33 52.57 24.46 52.35 24.67 C 52.27 24.74 52.2 24.76 52.05 24.76 C 51.88 24.76 51.34 24.71 51.01 24.68 L 51 24.82 C 51.32 24.87 51.63 24.95 51.75 25.06 C 51.86 25.15 51.89 25.31 51.89 25.51 C 52.27 25.51 52.57 25.41 52.8 25.2 C 53.16 24.86 53.33 23.7 53.4 21.67 C 53.57 21.65 53.67 21.61 53.72 21.54 L 53.05 20.97 L 52.69 21.35 L 51.23 21.35 C 51.25 21.06 51.26 20.79 51.26 20.51 L 51.26 19.9 C 51.47 19.87 51.52 19.79 51.54 19.68 L 50.64 19.59 L 50.64 20.5 C 50.64 20.77 50.64 21.05 50.63 21.35 L 48.96 21.35 L 49.04 21.58 L 50.61 21.58 C 50.52 22.93 50.16 24.39 48.81 25.4 Z M 47 19.75 C 47.36 20.2 47.84 20.9 47.99 21.43 C 48.66 21.91 49.15 20.54 47.08 19.7 Z M 48.32 22.58 C 48.55 22.54 48.67 22.48 48.72 22.42 L 47.95 21.79 L 47.6 22.24 L 46.55 22.24 L 46.6 22.48 L 47.72 22.48 L 47.72 25.3 C 47.34 25.54 46.81 25.93 46.44 26.16 L 46.96 26.91 C 47.03 26.87 47.05 26.79 47.03 26.71 C 47.32 26.31 47.83 25.7 48.01 25.46 C 48.11 25.34 48.19 25.32 48.28 25.46 C 49 26.43 49.75 26.74 51.27 26.74 L 53.47 26.74 C 53.51 26.46 53.67 26.23 53.94 26.18 L 53.94 26.07 C 53.06 26.11 52.35 26.11 51.48 26.11 C 49.97 26.12 49.1 25.96 48.41 25.21 C 48.38 25.18 48.35 25.15 48.32 25.14 Z M 60.88 26.18 L 57.99 26.18 L 57.99 20.45 L 61.61 20.45 C 61.73 20.45 61.8 20.41 61.83 20.32 C 61.55 20.06 61.1 19.71 61.1 19.71 L 60.7 20.21 L 58.12 20.21 L 57.37 19.87 L 57.37 21.54 C 57.12 21.28 56.75 20.97 56.75 20.97 L 56.38 21.46 L 56.27 21.46 L 56.27 19.85 C 56.48 19.82 56.54 19.75 56.56 19.63 L 55.68 19.53 L 55.68 21.46 L 54.52 21.46 L 54.59 21.69 L 55.56 21.69 C 55.36 22.88 55.01 24.1 54.44 25.03 L 54.56 25.13 C 55.03 24.61 55.4 24.01 55.68 23.35 L 55.68 26.95 L 55.8 26.95 C 56.01 26.95 56.27 26.8 56.27 26.72 L 56.27 22.61 C 56.48 22.93 56.69 23.35 56.75 23.67 C 57.24 24.09 57.75 23.1 56.27 22.39 L 56.27 21.69 L 57.19 21.69 C 57.27 21.69 57.34 21.67 57.37 21.62 L 57.37 26.14 C 57.28 26.19 57.2 26.26 57.15 26.31 L 57.82 26.75 L 58.04 26.41 L 61.8 26.41 C 61.91 26.41 61.99 26.37 62.01 26.28 C 61.73 26.03 61.28 25.67 61.28 25.67 Z M 58.24 24.96 L 58.3 25.19 L 61.56 25.19 C 61.67 25.19 61.74 25.15 61.76 25.07 C 61.5 24.81 61.08 24.47 61.08 24.47 L 60.69 24.96 L 60.08 24.96 L 60.08 23.29 L 61.27 23.29 C 61.38 23.29 61.45 23.25 61.48 23.16 C 61.24 22.91 60.83 22.57 60.83 22.57 L 60.48 23.06 L 60.08 23.06 L 60.08 21.57 L 61.38 21.57 C 61.49 21.57 61.57 21.53 61.59 21.44 C 61.32 21.19 60.89 20.85 60.89 20.85 L 60.5 21.34 L 58.31 21.34 L 58.37 21.57 L 59.49 21.57 L 59.49 23.06 L 58.46 23.06 L 58.52 23.29 L 59.49 23.29 L 59.49 24.96 Z M 62.9 27.92 C 63.78 27.51 64.07 26.71 64.07 26.07 C 64.07 25.6 63.82 25.28 63.43 25.28 C 63.08 25.28 62.87 25.54 62.87 25.83 C 62.87 26.27 63.3 26.42 63.64 26.54 C 63.6 26.89 63.4 27.36 62.77 27.71 Z M 73.18 21.84 L 73.18 23.69 L 71.72 23.69 C 71.74 23.36 71.74 23.03 71.74 22.74 L 71.74 21.84 Z M 73.18 23.93 L 73.18 24.39 L 73.28 24.39 C 73.48 24.39 73.78 24.27 73.79 24.21 L 73.79 21.96 C 73.96 21.93 74.08 21.86 74.13 21.79 L 73.43 21.26 L 73.1 21.61 L 71.74 21.61 L 71.74 20.62 C 72.45 20.5 73.21 20.3 73.72 20.15 C 73.92 20.22 74.06 20.21 74.14 20.14 L 73.43 19.55 C 73.04 19.8 72.33 20.15 71.7 20.42 L 71.12 20.23 L 71.12 22.73 C 71.12 24.12 71.1 25.65 70.48 26.87 L 70.6 26.96 C 71.39 26.11 71.63 24.99 71.71 23.93 Z M 76.86 22.21 L 75.17 22.21 L 75.17 20.58 C 75.98 20.5 76.84 20.35 77.41 20.23 C 77.62 20.31 77.78 20.31 77.86 20.23 L 77.1 19.54 C 76.68 19.78 75.94 20.09 75.24 20.33 L 74.55 20.1 L 74.55 22.35 C 74.55 23.95 74.33 25.55 73.05 26.85 L 73.16 26.95 C 74.94 25.75 75.16 23.92 75.17 22.44 L 76.28 22.44 L 76.28 26.89 L 76.39 26.89 C 76.72 26.89 76.92 26.74 76.92 26.7 L 76.92 22.44 L 77.77 22.44 C 77.88 22.44 77.96 22.4 77.99 22.31 C 77.71 22.06 77.27 21.7 77.27 21.7 Z M 84 22.45 L 84 23.47 L 81.03 23.47 L 81.03 22.45 Z M 81.03 24.72 L 81.03 23.69 L 84 23.69 L 84 24.72 Z M 84.65 20.83 L 81.79 20.83 C 81.94 20.54 82.07 20.25 82.18 19.97 C 82.4 19.99 82.47 19.93 82.5 19.83 L 81.53 19.53 C 81.41 19.95 81.25 20.39 81.05 20.83 L 78.6 20.83 L 78.66 21.07 L 80.94 21.07 C 80.4 22.2 79.59 23.31 78.52 24.09 L 78.6 24.19 C 79.29 23.83 79.88 23.35 80.39 22.83 L 80.39 26.93 L 80.5 26.93 C 80.82 26.93 81.03 26.77 81.03 26.72 L 81.03 24.95 L 84 24.95 L 84 25.99 C 84 26.11 83.96 26.15 83.81 26.15 C 83.64 26.15 82.8 26.1 82.8 26.1 L 82.8 26.22 C 83.18 26.27 83.38 26.35 83.5 26.46 C 83.61 26.56 83.66 26.72 83.68 26.93 C 84.54 26.85 84.64 26.55 84.64 26.07 L 84.64 22.59 C 84.82 22.56 84.96 22.48 85.01 22.41 L 84.24 21.83 L 83.91 22.22 L 81.12 22.22 L 80.96 22.15 C 81.24 21.79 81.47 21.43 81.67 21.07 L 85.68 21.07 C 85.79 21.07 85.87 21.03 85.88 20.94 C 85.59 20.67 85.08 20.29 85.08 20.29 Z M 88.82 20.77 C 89.87 20.77 90.34 21.27 90.34 22.16 C 90.34 23.01 89.9 23.59 88.8 23.59 L 88.24 23.59 L 88.24 23.15 C 88.24 22.35 88.24 21.55 88.26 20.77 Z M 88.71 23.95 C 90.48 23.95 91.16 23.14 91.16 22.16 C 91.16 21.12 90.44 20.43 88.96 20.43 L 86.61 20.43 L 86.61 20.73 L 87.43 20.82 C 87.44 21.59 87.44 22.36 87.44 23.15 L 87.44 23.58 C 87.44 24.36 87.44 25.13 87.43 25.9 L 86.61 25.99 L 86.61 26.29 L 89.09 26.29 L 89.09 25.99 L 88.26 25.89 C 88.24 25.23 88.24 24.59 88.24 23.95 Z M 96.07 24.71 L 95.85 25.82 C 95.52 25.98 95.17 26.03 94.84 26.03 C 93.59 26.03 92.71 25.11 92.71 23.35 C 92.71 21.61 93.67 20.67 94.88 20.67 C 95.17 20.67 95.47 20.74 95.77 20.89 L 95.99 22.01 L 96.47 22.01 L 96.45 20.72 C 95.88 20.39 95.28 20.29 94.78 20.29 C 93.07 20.29 91.8 21.56 91.8 23.35 C 91.8 25.18 93.01 26.42 94.78 26.42 C 95.4 26.42 95.99 26.29 96.53 25.99 L 96.55 24.71 Z M 98.96 25.94 C 98.94 25.15 98.94 24.35 98.94 23.43 L 99.44 23.43 C 100.66 23.43 101.19 23.86 101.19 24.7 C 101.19 25.5 100.63 25.94 99.53 25.94 Z M 99.57 20.77 C 100.49 20.77 100.94 21.1 100.94 21.88 C 100.94 22.7 100.46 23.07 99.4 23.07 L 98.94 23.07 C 98.94 22.3 98.94 21.52 98.96 20.77 Z M 97.31 20.43 L 97.31 20.73 L 98.12 20.82 C 98.14 21.59 98.14 22.35 98.14 23.13 L 98.14 23.55 C 98.14 24.34 98.14 25.12 98.12 25.9 L 97.31 25.99 L 97.31 26.29 L 99.7 26.29 C 101.37 26.29 102.02 25.49 102.02 24.69 C 102.02 23.97 101.52 23.39 100.33 23.23 C 101.32 23.03 101.72 22.46 101.72 21.85 C 101.72 21.02 101.06 20.43 99.81 20.43 Z M 104.61 21.68 L 105.68 21.68 C 105.79 21.68 105.87 21.64 105.88 21.55 C 105.64 21.3 105.23 20.95 105.23 20.95 L 104.86 21.44 L 104.61 21.44 L 104.61 19.85 C 104.82 19.82 104.88 19.75 104.9 19.63 L 104.01 19.53 L 104.01 21.44 L 102.72 21.44 L 102.79 21.68 L 103.88 21.68 C 103.67 22.89 103.28 24.12 102.65 25.04 L 102.76 25.14 C 103.28 24.59 103.7 23.98 104.01 23.29 L 104.01 26.95 L 104.13 26.95 C 104.36 26.95 104.61 26.8 104.61 26.72 L 104.61 22.56 C 104.87 22.9 105.13 23.36 105.2 23.73 C 105.73 24.17 106.27 23.07 104.61 22.39 Z M 108.83 22.35 C 108.68 23.19 108.43 23.98 108.03 24.67 C 107.6 24.08 107.28 23.31 107.11 22.35 Z M 109.16 21.74 L 108.78 22.11 L 106.63 22.11 L 106.63 20.59 C 107.46 20.57 108.66 20.45 109.55 20.27 C 109.68 20.33 109.78 20.32 109.86 20.27 L 109.28 19.59 C 108.43 19.91 107.43 20.21 106.65 20.39 L 106.01 20.12 L 106.01 22.4 C 106.01 23.92 105.9 25.55 105 26.85 L 105.12 26.93 C 106.51 25.67 106.63 23.81 106.63 22.39 L 106.63 22.35 L 106.93 22.35 C 107.07 23.47 107.34 24.39 107.75 25.13 C 107.26 25.82 106.61 26.39 105.75 26.83 L 105.81 26.94 C 106.76 26.59 107.46 26.11 108 25.55 C 108.41 26.15 108.94 26.6 109.58 26.92 C 109.63 26.63 109.85 26.41 110.17 26.31 L 110.18 26.21 C 109.47 25.96 108.87 25.61 108.38 25.11 C 108.96 24.33 109.28 23.43 109.5 22.44 C 109.68 22.43 109.76 22.4 109.82 22.32 Z M 116.8 20.36 L 112.3 20.36 L 111.54 20.06 L 111.54 22.38 C 111.54 23.87 111.47 25.51 110.71 26.83 L 110.82 26.9 C 112.11 25.63 112.19 23.77 112.19 22.38 L 112.19 20.59 L 117.83 20.59 C 117.95 20.59 118.02 20.55 118.04 20.47 C 117.74 20.19 117.23 19.8 117.23 19.8 Z M 123.93 22.75 C 123.59 23.49 123.08 24.16 122.46 24.75 C 121.76 24.22 121.2 23.55 120.83 22.75 Z M 124.38 22.13 L 123.94 22.52 L 122.72 22.52 L 122.72 21.13 L 125.77 21.13 C 125.88 21.13 125.96 21.1 125.99 21.01 C 125.68 20.73 125.17 20.34 125.17 20.34 L 124.72 20.91 L 122.72 20.91 L 122.72 19.88 C 122.91 19.85 122.99 19.77 123 19.65 L 122.05 19.56 L 122.05 20.91 L 118.84 20.91 L 118.91 21.13 L 122.05 21.13 L 122.05 22.52 L 119.37 22.52 L 119.44 22.75 L 120.67 22.75 C 120.99 23.67 121.48 24.43 122.1 25.06 C 121.19 25.81 120.04 26.4 118.72 26.8 L 118.77 26.94 C 120.28 26.62 121.5 26.1 122.48 25.4 C 123.31 26.1 124.34 26.59 125.5 26.91 C 125.6 26.61 125.83 26.42 126.12 26.37 L 126.13 26.28 C 124.96 26.05 123.84 25.65 122.92 25.07 C 123.66 24.44 124.24 23.71 124.68 22.88 C 124.89 22.87 124.98 22.85 125.04 22.77 Z M 129.81 21.09 L 131.32 21.09 L 131.32 22.28 L 129.25 22.28 L 129.32 22.52 L 133.96 22.52 C 134.07 22.52 134.15 22.48 134.17 22.39 C 133.89 22.12 133.42 21.75 133.42 21.75 L 133.01 22.28 L 131.96 22.28 L 131.96 21.09 L 133.57 21.09 C 133.68 21.09 133.76 21.05 133.79 20.96 C 133.51 20.7 133.05 20.32 133.05 20.32 L 132.64 20.86 L 131.96 20.86 L 131.96 19.92 C 132.16 19.88 132.24 19.8 132.25 19.69 L 131.32 19.6 L 131.32 20.86 L 129.75 20.86 Z M 129.76 22.75 C 129.32 22.89 128.88 23.02 128.48 23.15 L 128.48 21.64 L 129.61 21.64 C 129.72 21.64 129.8 21.6 129.82 21.51 C 129.58 21.25 129.17 20.9 129.17 20.9 L 128.81 21.41 L 128.48 21.41 L 128.48 19.87 C 128.67 19.85 128.75 19.77 128.77 19.65 L 127.87 19.55 L 127.87 21.41 L 126.71 21.41 L 126.77 21.64 L 127.87 21.64 L 127.87 23.32 C 127.31 23.48 126.85 23.61 126.6 23.67 L 126.88 24.47 C 126.96 24.43 127.04 24.35 127.07 24.26 C 127.35 24.12 127.62 23.99 127.87 23.87 L 127.87 26.03 C 127.87 26.15 127.83 26.19 127.69 26.19 C 127.56 26.19 126.87 26.14 126.87 26.14 L 126.87 26.26 C 127.19 26.31 127.36 26.38 127.46 26.48 C 127.56 26.58 127.6 26.74 127.62 26.93 C 128.39 26.85 128.48 26.58 128.48 26.08 L 128.48 23.55 C 129 23.28 129.44 23.05 129.79 22.86 Z M 129.91 24.28 C 130.24 24.59 130.61 25.1 130.69 25.54 C 131.36 26 131.9 24.63 129.98 24.23 Z M 133.12 23.64 L 132.84 23.64 L 132.84 23.04 C 133.02 23.01 133.1 22.95 133.12 22.83 L 132.21 22.74 L 132.21 23.64 L 129.31 23.64 L 129.37 23.87 L 132.21 23.87 L 132.21 26.04 C 132.21 26.16 132.17 26.2 132.03 26.2 C 131.84 26.2 130.9 26.14 130.9 26.14 L 130.9 26.26 C 131.32 26.31 131.53 26.39 131.66 26.49 C 131.8 26.59 131.84 26.75 131.86 26.94 C 132.73 26.86 132.84 26.58 132.84 26.08 L 132.84 23.87 L 133.94 23.87 C 134.04 23.87 134.12 23.83 134.14 23.75 C 133.9 23.5 133.48 23.14 133.48 23.14 Z M 138.82 19.6 C 139.07 19.9 139.34 20.39 139.42 20.77 C 140.04 21.24 140.63 20.03 138.9 19.55 Z M 135.3 19.66 C 135.61 20.01 136.03 20.59 136.15 21.03 C 136.76 21.46 137.24 20.2 135.39 19.6 Z M 137.51 24.46 C 137.15 24.73 136.8 25 136.48 25.23 L 136.48 22.05 C 136.64 22.02 136.75 21.95 136.79 21.9 L 136.19 21.4 L 135.88 21.71 L 134.72 21.71 L 134.8 21.95 L 135.88 21.95 L 135.88 25.41 C 135.88 25.57 135.84 25.63 135.56 25.78 L 136 26.52 C 136.08 26.47 136.17 26.37 136.22 26.21 C 136.82 25.54 137.32 24.88 137.59 24.55 Z M 141.03 23.04 C 140.04 24.89 138.63 25.99 136.95 26.79 L 137 26.93 C 138.2 26.52 139.24 25.98 140.12 25.21 C 140.62 25.67 141.21 26.31 141.44 26.82 C 142.16 27.23 142.52 25.86 140.28 25.07 C 140.76 24.65 141.17 24.16 141.56 23.59 C 141.76 23.63 141.84 23.6 141.91 23.51 Z M 141.08 20.93 L 137 20.93 L 137.06 21.16 L 138.74 21.16 C 138.51 21.66 137.96 22.51 137.52 22.83 C 137.47 22.87 137.32 22.9 137.32 22.9 L 137.59 23.65 C 137.66 23.63 137.72 23.58 137.78 23.5 C 138.44 23.38 139.05 23.24 139.53 23.14 C 138.9 24.07 138.12 24.8 137.21 25.39 L 137.29 25.51 C 138.8 24.81 139.96 23.77 140.83 22.31 C 141.01 22.34 141.09 22.31 141.14 22.22 L 140.28 21.81 C 140.11 22.19 139.92 22.56 139.7 22.89 C 138.99 22.92 138.31 22.94 137.85 22.95 C 138.41 22.55 139.03 21.99 139.38 21.55 C 139.54 21.56 139.64 21.5 139.67 21.43 L 139 21.16 L 142 21.16 C 142.12 21.16 142.2 21.12 142.22 21.03 C 141.94 20.77 141.48 20.41 141.48 20.41 Z M 148.44 19.55 C 148.27 20.16 148.03 20.83 147.83 21.23 L 147.94 21.31 C 148.32 20.99 148.74 20.51 149.08 20.03 C 149.24 20.04 149.34 19.98 149.37 19.89 Z M 145.87 19.64 C 146.15 20.01 146.45 20.59 146.48 21.07 C 147.08 21.59 147.7 20.29 145.96 19.59 Z M 146.95 23.49 L 146.95 23.33 L 146.95 21.62 L 148.1 21.62 L 148.1 23.49 Z M 149.08 23.49 L 148.74 23.49 L 148.74 21.62 L 149.83 21.62 C 149.94 21.62 150.01 21.58 150.04 21.49 C 149.76 21.23 149.31 20.87 149.31 20.87 L 148.92 21.39 L 145.45 21.39 C 145.22 21.15 144.94 20.91 144.94 20.91 L 144.59 21.41 L 144.45 21.41 L 144.45 19.87 C 144.65 19.85 144.73 19.77 144.75 19.65 L 143.84 19.55 L 143.84 21.41 L 142.71 21.41 L 142.77 21.64 L 143.84 21.64 L 143.84 23.25 C 143.29 23.41 142.84 23.54 142.59 23.59 L 142.87 24.39 C 142.95 24.37 143.03 24.29 143.05 24.19 C 143.33 24.05 143.6 23.91 143.84 23.79 L 143.84 26.03 C 143.84 26.15 143.8 26.19 143.68 26.19 C 143.53 26.19 142.84 26.14 142.84 26.14 L 142.84 26.26 C 143.16 26.31 143.33 26.38 143.44 26.48 C 143.54 26.58 143.58 26.74 143.6 26.93 C 144.36 26.85 144.45 26.58 144.45 26.08 L 144.45 23.46 C 144.89 23.22 145.26 23.01 145.56 22.84 L 145.52 22.74 C 145.16 22.85 144.8 22.96 144.45 23.07 L 144.45 21.64 L 145.37 21.64 C 145.42 21.64 145.46 21.63 145.5 21.62 L 146.31 21.62 L 146.31 23.34 L 146.31 23.49 L 145.06 23.49 L 145.12 23.72 L 146.3 23.72 C 146.25 24.87 145.96 25.96 144.72 26.86 L 144.8 26.95 C 146.53 26.15 146.88 24.91 146.94 23.72 L 148.1 23.72 L 148.1 26.93 L 148.2 26.93 C 148.53 26.93 148.73 26.78 148.74 26.74 L 148.74 23.72 L 149.96 23.72 C 150.08 23.72 150.16 23.68 150.18 23.59 C 149.91 23.35 149.46 22.98 149.46 22.98 Z M 152.61 21.68 L 153.68 21.68 C 153.79 21.68 153.87 21.64 153.88 21.55 C 153.64 21.3 153.23 20.95 153.23 20.95 L 152.86 21.44 L 152.61 21.44 L 152.61 19.85 C 152.82 19.82 152.88 19.75 152.9 19.63 L 152.01 19.53 L 152.01 21.44 L 150.72 21.44 L 150.79 21.68 L 151.88 21.68 C 151.67 22.89 151.28 24.12 150.65 25.04 L 150.76 25.14 C 151.28 24.59 151.7 23.98 152.01 23.29 L 152.01 26.95 L 152.13 26.95 C 152.36 26.95 152.61 26.8 152.61 26.72 L 152.61 22.56 C 152.87 22.9 153.13 23.36 153.2 23.73 C 153.73 24.17 154.27 23.07 152.61 22.39 Z M 156.83 22.35 C 156.68 23.19 156.43 23.98 156.03 24.67 C 155.6 24.08 155.28 23.31 155.11 22.35 Z M 157.16 21.74 L 156.78 22.11 L 154.63 22.11 L 154.63 20.59 C 155.46 20.57 156.66 20.45 157.55 20.27 C 157.68 20.33 157.78 20.32 157.86 20.27 L 157.28 19.59 C 156.43 19.91 155.43 20.21 154.65 20.39 L 154.01 20.12 L 154.01 22.4 C 154.01 23.92 153.9 25.55 153 26.85 L 153.12 26.93 C 154.51 25.67 154.63 23.81 154.63 22.39 L 154.63 22.35 L 154.93 22.35 C 155.07 23.47 155.34 24.39 155.75 25.13 C 155.26 25.82 154.61 26.39 153.75 26.83 L 153.81 26.94 C 154.76 26.59 155.46 26.11 156 25.55 C 156.41 26.15 156.94 26.6 157.58 26.92 C 157.63 26.63 157.85 26.41 158.17 26.31 L 158.18 26.21 C 157.47 25.96 156.87 25.61 156.38 25.11 C 156.96 24.33 157.28 23.43 157.5 22.44 C 157.68 22.43 157.76 22.4 157.82 22.32 Z M 161.56 19.56 C 161.94 19.91 162.36 20.48 162.46 20.95 C 163.14 21.43 163.66 20 161.64 19.51 Z M 164.82 21.19 L 158.73 21.19 L 158.8 21.42 L 161.16 21.42 C 161.1 23.69 160.67 25.51 158.86 26.87 L 158.93 26.97 C 160.73 26.06 161.44 24.72 161.75 23 L 164.12 23 C 164.03 24.64 163.85 25.83 163.6 26.07 C 163.51 26.15 163.44 26.16 163.28 26.16 C 163.09 26.16 162.44 26.11 162.07 26.07 L 162.06 26.2 C 162.41 26.26 162.78 26.36 162.92 26.47 C 163.04 26.56 163.08 26.73 163.08 26.92 C 163.49 26.92 163.8 26.82 164.04 26.61 C 164.44 26.24 164.66 24.98 164.76 23.1 C 164.93 23.07 165.04 23.03 165.09 22.97 L 164.41 22.39 L 164.04 22.77 L 161.78 22.77 C 161.85 22.35 161.89 21.89 161.92 21.42 L 165.87 21.42 C 165.97 21.42 166.05 21.38 166.08 21.29 C 165.77 21.01 165.26 20.63 165.26 20.63 Z M 171.92 19.87 C 172.26 20.09 172.69 20.48 172.86 20.8 C 173.49 21.1 173.8 19.91 172 19.8 Z M 169.19 23.19 L 170.58 23.19 C 170.69 23.19 170.77 23.15 170.8 23.07 C 170.51 22.81 170.05 22.45 170.05 22.45 L 169.64 22.96 L 167.08 22.96 L 167.14 23.19 L 168.54 23.19 L 168.54 25.67 C 167.81 25.83 167.21 25.96 166.86 26.03 L 167.29 26.76 C 167.37 26.74 167.44 26.67 167.48 26.58 C 169.06 26.01 170.18 25.55 171 25.21 L 170.96 25.08 C 170.35 25.23 169.74 25.39 169.19 25.51 Z M 173.96 24.89 L 173.88 24.87 C 173.76 25.19 173.59 25.59 173.48 25.8 C 173.4 25.94 173.35 25.95 173.23 25.83 C 172.09 24.99 171.64 23.35 171.5 21.56 L 173.85 21.56 C 173.96 21.56 174.04 21.52 174.07 21.43 C 173.77 21.16 173.27 20.79 173.27 20.79 L 172.84 21.33 L 171.48 21.33 C 171.45 20.87 171.44 20.39 171.45 19.92 C 171.64 19.89 171.72 19.79 171.73 19.7 L 170.76 19.59 C 170.76 20.19 170.78 20.77 170.83 21.33 L 166.76 21.33 L 166.84 21.56 L 170.84 21.56 C 171.02 23.66 171.56 25.42 172.86 26.48 C 173.21 26.79 173.76 27.05 174 26.76 C 174.1 26.67 174.06 26.51 173.82 26.14 Z"
;u&&(s.d+="M 5.44 -15.45 C 5.55 -15.45 5.64 -15.49 5.65 -15.57 C 5.37 -15.83 4.92 -16.2 4.92 -16.2 L 4.51 -15.69 L 1.69 -15.69 L 1.76 -15.45 Z M 0.47 -16.42 C 0.1 -15.76 -0.68 -14.8 -1.4 -14.17 L -1.32 -14.09 C -0.42 -14.56 0.47 -15.3 0.99 -15.85 C 1.16 -15.82 1.24 -15.85 1.29 -15.93 Z M 0.54 -14.77 C 0.13 -13.93 -0.72 -12.69 -1.56 -11.88 L -1.48 -11.79 C -1.04 -12.07 -0.6 -12.41 -0.22 -12.77 L -0.22 -9.06 L -0.1 -9.06 C 0.15 -9.06 0.4 -9.2 0.42 -9.25 L 0.42 -13.13 C 0.56 -13.15 0.63 -13.21 0.66 -13.27 L 0.39 -13.37 C 0.66 -13.67 0.9 -13.95 1.08 -14.21 C 1.28 -14.17 1.36 -14.21 1.4 -14.29 Z M 4.83 -13.84 L 1.25 -13.84 L 1.32 -13.61 L 3.84 -13.61 L 3.84 -10.04 C 3.84 -9.92 3.79 -9.86 3.62 -9.86 C 3.4 -9.86 2.25 -9.94 2.25 -9.94 L 2.25 -9.82 C 2.75 -9.76 3.01 -9.68 3.17 -9.57 C 3.32 -9.47 3.39 -9.31 3.4 -9.1 C 4.35 -9.17 4.49 -9.53 4.49 -10.01 L 4.49 -13.61 L 5.77 -13.61 C 5.88 -13.61 5.96 -13.65 5.98 -13.73 C 5.71 -14 5.23 -14.37 5.23 -14.37 Z M 7.53 -15.61 L 9.01 -15.61 L 9.01 -13.99 L 7.53 -13.99 Z M 8.63 -12.04 L 9.72 -12.04 C 9.84 -12.04 9.91 -12.08 9.93 -12.17 C 9.71 -12.41 9.31 -12.74 9.31 -12.74 L 8.97 -12.27 L 8.63 -12.27 L 8.63 -13.76 L 9.01 -13.76 L 9.01 -13.45 L 9.1 -13.45 C 9.29 -13.45 9.58 -13.56 9.59 -13.6 L 9.59 -15.51 C 9.75 -15.54 9.87 -15.61 9.92 -15.66 L 9.24 -16.19 L 8.93 -15.85 L 7.64 -15.85 L 6.96 -16.19 L 6.96 -13.35 L 7.05 -13.35 C 7.34 -13.35 7.53 -13.49 7.53 -13.54 L 7.53 -13.76 L 8.06 -13.76 L 8.06 -10.32 C 7.86 -10.28 7.67 -10.25 7.48 -10.21 L 7.48 -12.55 C 7.64 -12.57 7.71 -12.64 7.72 -12.73 L 6.96 -12.81 L 6.96 -10.13 C 6.76 -10.1 6.6 -10.08 6.47 -10.06 L 6.81 -9.28 C 6.89 -9.3 6.97 -9.37 7 -9.48 C 8.28 -9.87 9.2 -10.25 9.91 -10.58 L 9.88 -10.7 C 9.47 -10.61 9.04 -10.51 8.63 -10.43 Z M 12.67 -13.77 L 12.67 -11.98 L 10.76 -11.98 L 10.76 -13.77 Z M 12.9 -9.77 L 10.76 -9.77 L 10.76 -11.75 L 12.67 -11.75 L 12.67 -11.31 L 12.8 -11.31 C 13.03 -11.31 13.28 -11.43 13.29 -11.47 L 13.29 -13.67 C 13.42 -13.69 13.53 -13.75 13.59 -13.81 L 12.98 -14.33 L 12.68 -14.01 L 12.67 -14.01 L 12.67 -14 L 10.76 -14 L 10.76 -15.5 L 13.63 -15.5 C 13.74 -15.5 13.81 -15.54 13.84 -15.63 C 13.57 -15.89 13.12 -16.25 13.12 -16.25 L 12.72 -15.73 L 10.88 -15.73 L 10.14 -16.13 L 10.14 -9.81 C 10.05 -9.75 9.96 -9.69 9.92 -9.63 L 10.59 -9.2 L 10.81 -9.53 L 13.79 -9.53 C 13.91 -9.53 13.98 -9.57 14 -9.66 C 13.73 -9.93 13.29 -10.32 13.29 -10.32 Z M 16.16 -13.1 C 16.48 -13.1 16.71 -13.35 16.71 -13.65 C 16.71 -13.95 16.48 -14.2 16.16 -14.2 C 15.84 -14.2 15.6 -13.95 15.6 -13.65 C 15.6 -13.35 15.84 -13.1 16.16 -13.1 Z M 16.16 -9.99 C 16.48 -9.99 16.71 -10.24 16.71 -10.53 C 16.71 -10.84 16.48 -11.09 16.16 -11.09 C 15.84 -11.09 15.6 -10.84 15.6 -10.53 C 15.6 -10.24 15.84 -9.99 16.16 -9.99 Z M 1.84 -3.73 L -1.4 -3.73 L -1.34 -3.51 L 0.16 -3.51 C -0.06 -2.23 -0.7 -0.79 -1.55 0.23 L -1.46 0.31 C -1.01 -0.05 -0.61 -0.48 -0.27 -0.96 C 0.04 -0.65 0.36 -0.22 0.44 0.14 C 1.03 0.56 1.53 -0.61 -0.16 -1.11 C 0.03 -1.38 0.2 -1.66 0.35 -1.96 L 1.9 -1.96 C 1.46 0.03 0.45 1.83 -1.36 2.83 L -1.29 2.95 C 1.02 1.99 2.04 0.17 2.58 -1.85 C 2.76 -1.87 2.84 -1.89 2.91 -1.97 L 2.24 -2.58 L 1.86 -2.18 L 0.46 -2.18 C 0.67 -2.61 0.84 -3.06 0.96 -3.51 L 2.82 -3.51 C 2.93 -3.51 3.01 -3.55 3.04 -3.64 C 2.74 -3.9 2.26 -4.29 2.26 -4.29 Z M 3.87 -3.47 C 4.05 -3.5 4.11 -3.57 4.13 -3.68 L 3.28 -3.76 L 3.28 1.22 L 3.4 1.22 C 3.61 1.22 3.87 1.08 3.87 1.02 Z M 4.87 -4.26 L 4.87 2.01 C 4.87 2.13 4.82 2.18 4.67 2.18 C 4.48 2.18 3.57 2.11 3.57 2.11 L 3.57 2.24 C 3.98 2.29 4.2 2.37 4.32 2.48 C 4.44 2.59 4.49 2.74 4.52 2.94 C 5.39 2.85 5.49 2.56 5.49 2.06 L 5.49 -3.94 C 5.69 -3.97 5.77 -4.05 5.79 -4.17 Z M 7.53 -3.61 L 9.01 -3.61 L 9.01 -1.99 L 7.53 -1.99 Z M 8.63 -0.04 L 9.72 -0.04 C 9.84 -0.04 9.91 -0.08 9.93 -0.17 C 9.71 -0.41 9.31 -0.74 9.31 -0.74 L 8.97 -0.27 L 8.63 -0.27 L 8.63 -1.76 L 9.01 -1.76 L 9.01 -1.45 L 9.1 -1.45 C 9.29 -1.45 9.58 -1.56 9.59 -1.6 L 9.59 -3.51 C 9.75 -3.54 9.87 -3.61 9.92 -3.66 L 9.24 -4.19 L 8.93 -3.85 L 7.64 -3.85 L 6.96 -4.19 L 6.96 -1.35 L 7.05 -1.35 C 7.34 -1.35 7.53 -1.49 7.53 -1.54 L 7.53 -1.76 L 8.06 -1.76 L 8.06 1.68 C 7.86 1.72 7.67 1.75 7.48 1.79 L 7.48 -0.55 C 7.64 -0.57 7.71 -0.64 7.72 -0.73 L 6.96 -0.81 L 6.96 1.87 C 6.76 1.9 6.6 1.92 6.47 1.94 L 6.81 2.72 C 6.89 2.7 6.97 2.63 7 2.52 C 8.28 2.13 9.2 1.75 9.91 1.42 L 9.88 1.3 C 9.47 1.39 9.04 1.49 8.63 1.57 Z M 12.67 -1.77 L 12.67 0.02 L 10.76 0.02 L 10.76 -1.77 Z M 12.9 2.23 L 10.76 2.23 L 10.76 0.25 L 12.67 0.25 L 12.67 0.69 L 12.8 0.69 C 13.03 0.69 13.28 0.57 13.29 0.53 L 13.29 -1.67 C 13.42 -1.69 13.53 -1.75 13.59 -1.81 L 12.98 -2.33 L 12.68 -2.01 L 12.67 -2.01 L 12.67 -2 L 10.76 -2 L 10.76 -3.5 L 13.63 -3.5 C 13.74 -3.5 13.81 -3.54 13.84 -3.63 C 13.57 -3.89 13.12 -4.25 13.12 -4.25 L 12.72 -3.73 L 10.88 -3.73 L 10.14 -4.13 L 10.14 2.19 C 10.05 2.25 9.96 2.31 9.92 2.37 L 10.59 2.8 L 10.81 2.47 L 13.79 2.47 C 13.91 2.47 13.98 2.43 14 2.34 C 13.73 2.07 13.29 1.68 13.29 1.68 Z M 16.16 -1.1 C 16.48 -1.1 16.71 -1.35 16.71 -1.65 C 16.71 -1.95 16.48 -2.2 16.16 -2.2 C 15.84 -2.2 15.6 -1.95 15.6 -1.65 C 15.6 -1.35 15.84 -1.1 16.16 -1.1 Z M 16.16 2.01 C 16.48 2.01 16.71 1.76 16.71 1.47 C 16.71 1.16 16.48 0.91 16.16 0.91 C 15.84 0.91 15.6 1.16 15.6 1.47 C 15.6 1.76 15.84 2.01 16.16 2.01 Z");var l=zt("path",s);xs.appendChild(l);It(l,e.x,e.y+13);[n,i,t+" x "+r].forEach(function(t,r){if(u||!(r<2)){o.d=sr("getFontPath",[{text:t,x:e.x+24,y:e.y+12.14*r+.6,fontSize:6}]);var n=zt("path",o);xs.appendChild(n)}})}else{var c=u?["Row Spacing:",n,"\nColumn Spacing:",i,"\nCount:",t,"x",r,"\nRemark: Only panelize the board outline, all PCB factories support this panelized file"].join(" "):["\n","\nCount:",t,"x",r,"\nRemark: Only panelize the board outline, all PCB factories support this panelized file"].join(" "),d={text:c,x:e.x,y:e.y-20,fontSize:8};o.d=sr("getFontPath",[d]);a=zt("path",o);xs.appendChild(a)}}(_,l,s,c,h);var P={x:y.x,y:y.y,width:y.width*l+e.columnSpacing*(l-1),height:y.height*s+e.rowSpacing*(s-1)},A=[a({x:P.x,y:P.y,width:P.width,height:P.height})];if(e.createBorder){P.center={x:P.x+P.width/2,y:P.y+P.height/2};"topBottom"===e.borderPosition?A.push(a({x:P.x,y:P.y-e.borderHeight,width:P.width,height:P.height+2*e.borderHeight})):A.push(a({x:P.x-e.borderHeight,y:P.y,width:P.width+2*e.borderHeight,height:P.height}));var b,S,E,O,I=Eo.units.convert("5mm","pixel");if("topBottom"===e.borderPosition){E={x:P.x+I,y:P.y-e.borderHeight/2};O={x:E.x+I,y:E.y}}else{E={x:P.x-e.borderHeight/2,y:P.y+I};O={x:E.x,y:E.y+I}}if(e.createHoles){b=E;var T=r(b,P.center);Fo.gJsonCache.panelize.holesPos=[b,T];A.push(n(b));A.push(n(T));e.createMarks&&(S=O)}else e.createMarks&&(S=E);if(e.createMarks){var R=r(S,P.center);Fo.gJsonCache.panelize.marksPos=[S,R];[S,R].forEach(function(e){var t=i(e);A.push(t[0]);A.push(t[1])})}}A.forEach(function(e){xs.appendChild(e)});t&&zo.save(["attr","panelize",f,e]);p('[c_outlinetype="panelizedOutline"]').forEach(function(e){g(e,"events-none")})}else{Object.assign(Fo.gJsonCache.panelize,{row:1,column:1});parent.$.messager.error("Please create board outline first.")}}}function Wa(){function e(e){var t={"Ctrl+Shift+R":!0,"Ctrl+Shift+O":!0,"Ctrl+Shift+B":!0,"Ctrl+Shift+G":!0,"Ctrl+L":!0,"Ctrl+Tab":function(){return!0},"Ctrl+Shift+H":!0,"Shift+Alt+H":!0,"Ctrl+Shift+E":!0,"Ctrl+Shift+C":!0};return!(!e||e.split("+").length<2)&&("function"==typeof t[e]?t[e]():t[e])}function r(e){var t=e.metaKey,r=e.ctrlKey,n=e.shiftKey,i=e.altKey,a=e.keyCode,o="",s=l[a];t&&(o+="Cmd+");r&&(o+="Ctrl+");n&&(o+="Shift+");i&&(o+="Alt+");a>=48&&a<=57||a>=65&&a<=90?o+=String.fromCharCode(a):"Cmd"!=s&&"Ctrl"!=s&&"Shift"!=s&&"Alt"!=s&&S(l,a)&&(o+=l[a]);o&&/[^+]\+$/.test(o)&&(o=o.substring(0,o.length-1));return o}function n(t){os.altKeyEnabled=t.altKey;if(t.target.tagName){var n=t.target.tagName.toUpperCase();if("TEXTAREA"==n||"INPUT"==n&&"text"==t.target.type)return}if("keydown"===t.type){var i,l=r(t),c=Is==ao.PCB||Is==ao.PCBLIB||Is==ao.PCBMODULE?"PCB":"SCH",d=sr("getHotkeyConfig");if(d&&d[c]){d[c].hasOwnProperty(l)?i=d[c][l]:S(d.ALL,l)&&(i=d.ALL[l]);i||"R"!=l||(i="rotate");var p=["draw.wire","draw.bus","cmd.groupSymbol"],h=["left","right","up","down","zoom_in","zoom_out","fitview"],u=["file_save"],f=["draw.connect","draw.copperArea","draw.rect","cmd.groupSymbol"],g=Eo.fileType.getAbstractFileType(Is);if(i){sr("addUserBehaviorRecord",["hotkey-down",{cmd:i,fileType:g,target:un().map(function(e){return e.id}).join(",")}]);if("schlib"==g&&(-1!==p.indexOf(i)||/^place.part_(?!pin$)(?!annotation$)/.test(i))){t.preventDefault();t.stopPropagation();return}if("photoview"==g&&-1===h.indexOf(i)){t.preventDefault();t.stopPropagation();return}if("waveform"==g&&-1===u.indexOf(i)){t.preventDefault();t.stopPropagation();return}if("pcblib"==g&&-1!==f.indexOf(i)){t.preventDefault();t.stopPropagation();return}if(S(s,i)){if(!1===s[i](t)&&("Up"==l||"Down"==l||"Left"==l||"Right"==l)){var y={Up:[0,-1],Down:[0,1],Left:[-1,0],Right:[1,0]},v=ms.getViewBox(),x=10/wo;v[0]+=x*y[l][0];v[1]+=x*y[l][1];ms.setViewBox(v);t.preventDefault();t.stopPropagation();return}}else a(i)}if(e(l)||o.test(l)||vo&&"Delete"==l){t.preventDefault();t.stopPropagation()}t.altKey&&t.preventDefault()}}}function i(t){if("keyup"===t.type){if(t.target.tagName){var n=t.target.tagName.toUpperCase();if("TEXTAREA"==n||"INPUT"==n&&"text"==t.target.type)return}var i=r(t);(o.test(i)||vo&&"Delete"==i||e(i))&&t.preventDefault();if("Esc"===i){if(Io.on){a("dragMoveSwitch",[!1]);a("undo")}sr("triggerEvent",["keyup",t])}"Backspace"===i&&a("undoDraw")}}var o=/^(Backspace|Space|F1|Home|End|(?:Ctrl|Cmd|Shift)\+[\-+AOSFRDG])$/,s={left:function(){return Xr(-1,0)},right:function(){return Xr(1,0)},up:function(){return Xr(0,-1)},down:function(){return Xr(0,1)},zoom_in:function(){return sr("zoom_in",[Sr.data])},zoom_out:function(){return sr("zoom_out",[Sr.data])},draw_end:function(e){if("draw.track"!==Uo||27!==e.keyCode||!sr("trackWidthPanelStatus")){if(0===Uo.indexOf("place.part_")){Cs.end(l.ESC);return!0}if(Uo){Cs.restart(!0);return!0}return!1}},file_save:function(){return sr("file_save")},editSymbol:function(){return sr("symbolTool")},snap_grid:function(){return sr("snap_grid",[!Zo.adsorbGrid.enabled])},change_route_angle:function(){var e=Zo.canvas.angle+"",t=["45","90","0","ARC"];return sr("updateAttrByHotkey",[{cmd:"pcbcanvas-angle",value:t[(t.indexOf(e)+1)%t.length]}])},decrease_routing_width:function(){var e=+Zo.canvas.routing;if(e>=.4){return sr("updateAttrByHotkey",[{cmd:"pcbcanvas-routing-size",value:Eo.toFixed(Eo.units.convert(e-.2,"pixel",Zo.canvas.unit),Eo.units.decimals[Zo.canvas.unit])}])}},increase_routing_width:function(){var e=+Zo.canvas.routing;return sr("updateAttrByHotkey",[{cmd:"pcbcanvas-routing-size",value:Eo.toFixed(Eo.units.convert(e+.2,"pixel",Zo.canvas.unit),Eo.units.decimals[Zo.canvas.unit])}])},decrease_snap_size:function(){var e=+Zo.adsorbGrid.distanceX;if(e>=.6){return sr("updateAttrByHotkey",[{cmd:"pcbcanvas-snap-size",value:Eo.toFixed(Eo.units.convert(e-.1,"pixel",Zo.canvas.unit),Eo.units.decimals[Zo.canvas.unit])}])}},increase_snap_size:function(){var e=+Zo.adsorbGrid.distanceX;return sr("updateAttrByHotkey",[{cmd:"pcbcanvas-snap-size",value:Eo.toFixed(Eo.units.convert(e+.1,"pixel",Zo.canvas.unit),Eo.units.decimals[Zo.canvas.unit])}])},remove_all_copper_area:function(){Mi();sr("setTabUnsaved")},rebuild_all_copper_area:function(){sr("buildCopper",["all"]);var e=Fo.getAllObjsOf("COPPERAREA");es.insertNodes(e,"COPPERAREA");var t=Fo.getAllObjsOf("PLANEZONE");es.insertNodes(t,"PLANEZONE");sr("setTabUnsaved")},findComponent:function(){return sr("findComponent")},findLibs:function(){sr("findLibs")},crossProbe:function(){return sr("crossProbe")},crossProbeAndPlace:function(){return sr("crossProbeAndPlace")},designManager:function(){return sr("designManager")},runDocSimulation:function(){return sr("runDocSimulation")},exploreFindComponents:function(){return sr("exploreFindComponents")},show_drawing_attr_dlg:function(e){if(Cs.started){var t=Z(Cs.target);""===t&&Cs.controlLine&&(t=Z(Cs.controlLine));a("show_drawing_attr_dlg",[t,Cs.target]);e.preventDefault();e.stopPropagation()}else if(Io.on)un()&&sr("showOffsetElementsByPastDlg");else{var r=un();if(r.length>0){sr("showOffsetElementsDlg");e.preventDefault();e.stopPropagation()}}},"Open the FAQ page":function(){return sr("OpenFAQPage")}},l=function(){var e,t={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Esc:27,Space:32,PageUp:33,PageDn:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,"`":192,"-":Po?173:189,"+":Po?61:187,"[":219,"]":221,"\\":220,";":Po?59:186,"'":222,",":188,".":190,"/":191,"*":106};for(e=1;e<=12;e++)t["F"+e]=111+e;var r=Object.keys(t);for(e=0;e<r.length;e++){var n=t[r[e]];S(t,n)||(t[n]=r[e])}if(vo){if(Po)t[224]="Cmd";else{t[91]="Cmd";t[93]="Cmd"}delete t.Backspace;t[8]="Delete";t.Delete=8}var i={107:"+107",109:"-109"};return Object.assign({},t,i)}();a.registerHook({transferKeydown:n,transferKeypress:n});t.addEventListener("keydown",n,!1);t.addEventListener("keyup",i,!1);!function(){if(_o){var e=function(e){if((e.keyCode==l["+"]||e.keyCode==l["-"])&&(vo?e.metaKey:e.ctrlKey)){e.preventDefault();e.stopPropagation();return!1}};t.addEventListener("keydown",e,!1)}}()}function Za(e){var t,r,n;if(Array.isArray(e)){t=new Array(e.length);for(var i=0,a=e.length;i<a;i++){n=e[i];t[i]=null!==n&&"object"==typeof n?Za(n):n}return t}t={};for(r in e)S(e,r)&&(t[r]="object"==typeof e[r]&&null!==e[r]?Za(e[r]):e[r]);return t}!function(){function e(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,n,i,a,o;i=2147483648&e;a=2147483648&t;r=1073741824&e;n=1073741824&t;o=(1073741823&e)+(1073741823&t);return r&n?2147483648^o^i^a:r|n?1073741824&o?3221225472^o^i^a:1073741824^o^i^a:o^i^a}function n(e,t,r){return e&t|~e&r}function i(e,t,r){return e&r|t&~r}function a(e,t,r){return e^t^r}function o(e,t,r){return t^(e|~r)}function s(e,i,a,o,s,l,c){e=r(e,r(r(n(i,a,o),s),c));return r(t(e,l),i)}function l(e,n,a,o,s,l,c){e=r(e,r(r(i(n,a,o),s),c));return r(t(e,l),n)}function c(e,n,i,o,s,l,c){e=r(e,r(r(a(n,i,o),s),c));return r(t(e,l),n)}function d(e,n,i,a,s,l,c){e=r(e,r(r(o(n,i,a),s),c));return r(t(e,l),n)}function p(e){var t,r,n="",i="";for(r=0;r<=3;r++){t=e>>>8*r&255;i="0"+t.toString(16);n+=i.substr(i.length-2,2)}return n}var h,u,f,g,y,v,x,m,C,L=Array();e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n<128)t+=String.fromCharCode(n);else if(n>127&&n<2048){t+=String.fromCharCode(n>>6|192);t+=String.fromCharCode(63&n|128)}else{t+=String.fromCharCode(n>>12|224);t+=String.fromCharCode(n>>6&63|128);t+=String.fromCharCode(63&n|128)}}return t}(e);L=function(e){for(var t,r=e.length,n=r+8,i=(n-n%64)/64,a=16*(i+1),o=Array(a-1),s=0,l=0;l<r;){t=(l-l%4)/4;s=l%4*8;o[t]=o[t]|e.charCodeAt(l)<<s;l++}t=(l-l%4)/4;s=l%4*8;o[t]=o[t]|128<<s;o[a-2]=r<<3;o[a-1]=r>>>29;return o}(e);v=1732584193;x=4023233417;m=2562383102;C=271733878;for(h=0;h<L.length;h+=16){u=v;f=x;g=m;y=C;v=s(v,x,m,C,L[h+0],7,3614090360);C=s(C,v,x,m,L[h+1],12,3905402710);m=s(m,C,v,x,L[h+2],17,606105819);x=s(x,m,C,v,L[h+3],22,3250441966);v=s(v,x,m,C,L[h+4],7,4118548399);C=s(C,v,x,m,L[h+5],12,1200080426);m=s(m,C,v,x,L[h+6],17,2821735955);x=s(x,m,C,v,L[h+7],22,4249261313);v=s(v,x,m,C,L[h+8],7,1770035416);C=s(C,v,x,m,L[h+9],12,2336552879);m=s(m,C,v,x,L[h+10],17,4294925233);x=s(x,m,C,v,L[h+11],22,2304563134);v=s(v,x,m,C,L[h+12],7,1804603682);C=s(C,v,x,m,L[h+13],12,4254626195);m=s(m,C,v,x,L[h+14],17,2792965006);x=s(x,m,C,v,L[h+15],22,1236535329);v=l(v,x,m,C,L[h+1],5,4129170786);C=l(C,v,x,m,L[h+6],9,3225465664);m=l(m,C,v,x,L[h+11],14,643717713);x=l(x,m,C,v,L[h+0],20,3921069994);v=l(v,x,m,C,L[h+5],5,3593408605);C=l(C,v,x,m,L[h+10],9,38016083);m=l(m,C,v,x,L[h+15],14,3634488961);x=l(x,m,C,v,L[h+4],20,3889429448);v=l(v,x,m,C,L[h+9],5,568446438);C=l(C,v,x,m,L[h+14],9,3275163606);m=l(m,C,v,x,L[h+3],14,4107603335);x=l(x,m,C,v,L[h+8],20,1163531501);v=l(v,x,m,C,L[h+13],5,2850285829);C=l(C,v,x,m,L[h+2],9,4243563512);m=l(m,C,v,x,L[h+7],14,1735328473);x=l(x,m,C,v,L[h+12],20,2368359562);v=c(v,x,m,C,L[h+5],4,4294588738);C=c(C,v,x,m,L[h+8],11,2272392833);m=c(m,C,v,x,L[h+11],16,1839030562);x=c(x,m,C,v,L[h+14],23,4259657740);v=c(v,x,m,C,L[h+1],4,2763975236);C=c(C,v,x,m,L[h+4],11,1272893353);m=c(m,C,v,x,L[h+7],16,4139469664);x=c(x,m,C,v,L[h+10],23,3200236656);v=c(v,x,m,C,L[h+13],4,681279174);C=c(C,v,x,m,L[h+0],11,3936430074);m=c(m,C,v,x,L[h+3],16,3572445317);x=c(x,m,C,v,L[h+6],23,76029189);v=c(v,x,m,C,L[h+9],4,3654602809);C=c(C,v,x,m,L[h+12],11,3873151461);m=c(m,C,v,x,L[h+15],16,530742520);x=c(x,m,C,v,L[h+2],23,3299628645);v=d(v,x,m,C,L[h+0],6,4096336452);C=d(C,v,x,m,L[h+7],10,1126891415);m=d(m,C,v,x,L[h+14],15,2878612391);x=d(x,m,C,v,L[h+5],21,4237533241);v=d(v,x,m,C,L[h+12],6,1700485571);C=d(C,v,x,m,L[h+3],10,2399980690);m=d(m,C,v,x,L[h+10],15,4293915773);x=d(x,m,C,v,L[h+1],21,2240044497);v=d(v,x,m,C,L[h+8],6,1873313359);C=d(C,v,x,m,L[h+15],10,4264355552);m=d(m,C,v,x,L[h+6],15,2734768916);x=d(x,m,C,v,L[h+13],21,1309151649);v=d(v,x,m,C,L[h+4],6,4149444226);C=d(C,v,x,m,L[h+11],10,3174756917);m=d(m,C,v,x,L[h+2],15,718787259);x=d(x,m,C,v,L[h+9],21,3951481745);v=r(v,u);x=r(x,f);m=r(m,g);C=r(C,y)}return(p(v)+p(x)+p(m)+p(C)).toLowerCase()}function t(t){return t?e(t+"_^&!Aa1"):""}var r="undefined"!=typeof exports?exports:this;r.MD5=e;r.ourMD5=t}();!function(){"use strict";if(!("SVGPathSeg"in e)){e.SVGPathSeg=function(e,t,r){this.pathSegType=e;this.pathSegTypeAsLetter="z"==t?"Z":t;this._owningPathSegList=r};SVGPathSeg.prototype.classname="SVGPathSeg";SVGPathSeg.PATHSEG_UNKNOWN=0;SVGPathSeg.PATHSEG_CLOSEPATH=1;SVGPathSeg.PATHSEG_MOVETO_ABS=2;SVGPathSeg.PATHSEG_MOVETO_REL=3;SVGPathSeg.PATHSEG_LINETO_ABS=4;SVGPathSeg.PATHSEG_LINETO_REL=5;SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6;SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9;SVGPathSeg.PATHSEG_ARC_ABS=10;SVGPathSeg.PATHSEG_ARC_REL=11;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13;SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14;SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19;SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)};e.SVGPathSegClosePath=function(e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CLOSEPATH,"z",e)};SVGPathSegClosePath.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"};SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter};SVGPathSegClosePath.prototype.clone=function(){return new SVGPathSegClosePath(void 0)};e.SVGPathSegMovetoAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_ABS,"M",e);this._x=t;this._y=r};SVGPathSegMovetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"};SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoAbs.prototype.clone=function(){return new SVGPathSegMovetoAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegMovetoRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_REL,"m",e);this._x=t;this._y=r};SVGPathSegMovetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"};SVGPathSegMovetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoRel.prototype.clone=function(){return new SVGPathSegMovetoRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_ABS,"L",e);this._x=t;this._y=r};SVGPathSegLinetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"};SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoAbs.prototype.clone=function(){return new SVGPathSegLinetoAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_REL,"l",e);this._x=t;this._y=r};SVGPathSegLinetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"};SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoRel.prototype.clone=function(){return new SVGPathSegLinetoRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicAbs=function(e,t,r,n,i,a,o){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",e);this._x=t;this._y=r;this._x1=n;this._y1=i;this._x2=a;this._y2=o};SVGPathSegCurvetoCubicAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"};SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicAbs(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicRel=function(e,t,r,n,i,a,o){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",e);this._x=t;this._y=r;this._x1=n;this._y1=i;this._x2=a;this._y2=o};SVGPathSegCurvetoCubicRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"};SVGPathSegCurvetoCubicRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicRel(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticAbs=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",e);this._x=t;this._y=r;this._x1=n;this._y1=i};SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticAbs]"};SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticAbs(void 0,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticRel=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",e);this._x=t;this._y=r;this._x1=n;this._y1=i};SVGPathSegCurvetoQuadraticRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"};SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticRel(void 0,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegArcAbs=function(e,t,r,n,i,a,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_ABS,"A",e);this._x=t;this._y=r;this._r1=n;this._r2=i;this._angle=a;this._largeArcFlag=o;this._sweepFlag=s};SVGPathSegArcAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"};SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcAbs.prototype.clone=function(){return new SVGPathSegArcAbs(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(e){this._r1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(e){this._r2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegArcRel=function(e,t,r,n,i,a,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_REL,"a",e);this._x=t;this._y=r;this._r1=n;this._r2=i;this._angle=a;this._largeArcFlag=o;this._sweepFlag=s};SVGPathSegArcRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"};SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcRel.prototype.clone=function(){return new SVGPathSegArcRel(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(e){this._r1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(e){this._r2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoHorizontalAbs=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,"H",e);this._x=t};SVGPathSegLinetoHorizontalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"};SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x}
;SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new SVGPathSegLinetoHorizontalAbs(void 0,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoHorizontalRel=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",e);this._x=t};SVGPathSegLinetoHorizontalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"};SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalRel.prototype.clone=function(){return new SVGPathSegLinetoHorizontalRel(void 0,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoVerticalAbs=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",e);this._y=t};SVGPathSegLinetoVerticalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"};SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new SVGPathSegLinetoVerticalAbs(void 0,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoVerticalRel=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",e);this._y=t};SVGPathSegLinetoVerticalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"};SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new SVGPathSegLinetoVerticalRel(void 0,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicSmoothAbs=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",e);this._x=t;this._y=r;this._x2=n;this._y2=i};SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"};SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,this._x,this._y,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicSmoothRel=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",e);this._x=t;this._y=r;this._x2=n;this._y2=i};SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"};SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothRel(void 0,this._x,this._y,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticSmoothAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",e);this._x=t;this._y=r};SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"};SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticSmoothRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",e);this._x=t;this._y=r};SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"};SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new SVGPathSegClosePath(void 0)};SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(e,t){return new SVGPathSegMovetoAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegMovetoRel=function(e,t){return new SVGPathSegMovetoRel(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(e,t){return new SVGPathSegLinetoAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegLinetoRel=function(e,t){return new SVGPathSegLinetoRel(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(e,t,r,n,i,a){return new SVGPathSegCurvetoCubicAbs(void 0,e,t,r,n,i,a)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(e,t,r,n,i,a){return new SVGPathSegCurvetoCubicRel(void 0,e,t,r,n,i,a)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(e,t,r,n){return new SVGPathSegCurvetoQuadraticAbs(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(e,t,r,n){return new SVGPathSegCurvetoQuadraticRel(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegArcAbs=function(e,t,r,n,i,a,o){return new SVGPathSegArcAbs(void 0,e,t,r,n,i,a,o)};SVGPathElement.prototype.createSVGPathSegArcRel=function(e,t,r,n,i,a,o){return new SVGPathSegArcRel(void 0,e,t,r,n,i,a,o)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(e){return new SVGPathSegLinetoHorizontalAbs(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(e){return new SVGPathSegLinetoHorizontalRel(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(e){return new SVGPathSegLinetoVerticalAbs(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(e){return new SVGPathSegLinetoVerticalRel(void 0,e)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(e,t,r,n){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(e,t,r,n){return new SVGPathSegCurvetoCubicSmoothRel(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(e,t){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(e,t){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,e,t)};"getPathSegAtLength"in SVGPathElement.prototype||(SVGPathElement.prototype.getPathSegAtLength=function(e){if(void 0===e||!isFinite(e))throw"Invalid arguments.";var r=t.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",this.getAttribute("d"));var n=r.pathSegList.numberOfItems-1;if(n<=0)return 0;do{r.pathSegList.removeItem(n);if(e>r.getTotalLength())break;n--}while(n>0);return n})}if(!("SVGPathSegList"in e&&"appendItem"in e.SVGPathSegList.prototype)){e.SVGPathSegList=function(e){this._pathElement=e;this._list=this._parsePath(this._pathElement.getAttribute("d"));this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]};this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};SVGPathSegList.prototype.classname="SVGPathSegList";Object.defineProperty(SVGPathSegList.prototype,"numberOfItems",{get:function(){this._checkPathSynchronizedToList();return this._list.length},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"pathSegList",{get:function(){this._pathSegList||(this._pathSegList=new SVGPathSegList(this));return this._pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"normalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0});SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())};SVGPathSegList.prototype._updateListFromPathMutations=function(e){if(this._pathElement){var t=!1;e.forEach(function(e){"d"==e.attributeName&&(t=!0)});t&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}};SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect();this._pathElement.setAttribute("d",SVGPathSegList._pathSegArrayAsString(this._list));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};SVGPathSegList.prototype.segmentChanged=function(e){this._writeListToPath()};SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList();this._list.forEach(function(e){e._owningPathSegList=null});this._list=[];this._writeListToPath()};SVGPathSegList.prototype.initialize=function(e){this._checkPathSynchronizedToList();this._list=[e];e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype._checkValidIndex=function(e){if(isNaN(e)||e<0||e>=this.numberOfItems)throw"INDEX_SIZE_ERR"};SVGPathSegList.prototype.getItem=function(e){this._checkPathSynchronizedToList();this._checkValidIndex(e);return this._list[e]};SVGPathSegList.prototype.insertItemBefore=function(e,t){this._checkPathSynchronizedToList();t>this.numberOfItems&&(t=this.numberOfItems);e._owningPathSegList&&(e=e.clone());this._list.splice(t,0,e);e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype.replaceItem=function(e,t){this._checkPathSynchronizedToList();e._owningPathSegList&&(e=e.clone());this._checkValidIndex(t);this._list[t]=e;e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype.removeItem=function(e){this._checkPathSynchronizedToList();this._checkValidIndex(e);var t=this._list[e];this._list.splice(e,1);this._writeListToPath();return t};SVGPathSegList.prototype.appendItem=function(e){this._checkPathSynchronizedToList();e._owningPathSegList&&(e=e.clone());this._list.push(e);e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList._pathSegArrayAsString=function(e){var t="",r=!0;e.forEach(function(e){if(r){r=!1;t+=e._asPathString()}else t+=" "+e._asPathString()});return t};SVGPathSegList.prototype._parsePath=function(e){if(!e||0==e.length)return[];var t=this,r=function(){this.pathSegList=[]};r.prototype.appendSegment=function(e){this.pathSegList.push(e)};var n=function(e){this._string=e;this._currentIndex=0;this._endIndex=this._string.length;this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN;this._skipOptionalSpaces()};n.prototype._isCurrentSpace=function(){var e=this._string[this._currentIndex];return e<=" "&&(" "==e||"\n"==e||"\t"==e||"\r"==e||"\f"==e)};n.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex};n.prototype._skipOptionalSpacesOrDelimiter=function(){if(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!=this._string.charAt(this._currentIndex))return!1;if(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","==this._string.charAt(this._currentIndex)){this._currentIndex++;this._skipOptionalSpaces()}return this._currentIndex<this._endIndex};n.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex};n.prototype.peekSegmentType=function(){var e=this._string[this._currentIndex];return this._pathSegTypeFromChar(e)};n.prototype._pathSegTypeFromChar=function(e){switch(e){case"Z":case"z":return SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return SVGPathSeg.PATHSEG_LINETO_REL;case"C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return SVGPathSeg.PATHSEG_ARC_ABS;case"a":return SVGPathSeg.PATHSEG_ARC_REL;case"H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}};n.prototype._nextCommandHelper=function(e,t){return("+"==e||"-"==e||"."==e||e>="0"&&e<="9")&&t!=SVGPathSeg.PATHSEG_CLOSEPATH?t==SVGPathSeg.PATHSEG_MOVETO_ABS?SVGPathSeg.PATHSEG_LINETO_ABS:t==SVGPathSeg.PATHSEG_MOVETO_REL?SVGPathSeg.PATHSEG_LINETO_REL:t:SVGPathSeg.PATHSEG_UNKNOWN};n.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return!0;var e=this.peekSegmentType();return e==SVGPathSeg.PATHSEG_MOVETO_ABS||e==SVGPathSeg.PATHSEG_MOVETO_REL};n.prototype._parseNumber=function(){var e=0,t=0,r=1,n=0,i=1,a=1,o=this._currentIndex;this._skipOptionalSpaces();if(this._currentIndex<this._endIndex&&"+"==this._string.charAt(this._currentIndex))this._currentIndex++;else if(this._currentIndex<this._endIndex&&"-"==this._string.charAt(this._currentIndex)){this._currentIndex++;i=-1}if(!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&"."!=this._string.charAt(this._currentIndex))){for(var s=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!=s)for(var l=this._currentIndex-1,c=1;l>=s;){t+=c*(this._string.charAt(l--)-"0");c*=10}if(this._currentIndex<this._endIndex&&"."==this._string.charAt(this._currentIndex)){this._currentIndex++;if(this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";){r*=10;n+=(this._string.charAt(this._currentIndex)-"0")/r;this._currentIndex+=1}}if(this._currentIndex!=o&&this._currentIndex+1<this._endIndex&&("e"==this._string.charAt(this._currentIndex)||"E"==this._string.charAt(this._currentIndex))&&"x"!=this._string.charAt(this._currentIndex+1)&&"m"!=this._string.charAt(this._currentIndex+1)){this._currentIndex++;if("+"==this._string.charAt(this._currentIndex))this._currentIndex++;else if("-"==this._string.charAt(this._currentIndex)){this._currentIndex++;a=-1}if(this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";){e*=10;e+=this._string.charAt(this._currentIndex)-"0";this._currentIndex++}}var d=t+n;d*=i;e&&(d*=Math.pow(10,a*e));if(o!=this._currentIndex){this._skipOptionalSpacesOrDelimiter();return d}}};n.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var e=!1,t=this._string.charAt(this._currentIndex++);if("0"==t)e=!1;else{if("1"!=t)return;e=!0}this._skipOptionalSpacesOrDelimiter();return e}};n.prototype.parseSegment=function(){var e=this._string[this._currentIndex],r=this._pathSegTypeFromChar(e);if(r==SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==SVGPathSeg.PATHSEG_UNKNOWN)return null;r=this._nextCommandHelper(e,this._previousCommand);if(r==SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;this._previousCommand=r;switch(r){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:this._skipOptionalSpaces();return new SVGPathSegClosePath(t);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(t,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(t,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(t,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(t,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(t,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(t,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_ARC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(t,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);case SVGPathSeg.PATHSEG_ARC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcAbs(t,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);default:throw"Unknown path seg type."}};var i=new r,a=new n(e);if(!a.initialCommandIsMoveTo())return[];for(;a.hasMoreData();){var o=a.parseSegment();if(!o)return[];i.appendSegment(o)}return i.pathSegList}}}();SVGPathElement.prototype.getPathData&&SVGPathElement.prototype.setPathData||function(){function t(e,t){var r=o(e.getAttribute("d")||"");if(t&&t.normalize){return c(l(r))}return r}function r(e,t){var r="path"===e.tagName?"d":"points";if(0===t.length)a?this.setAttribute(r,""):this.removeAttribute(r);else{for(var n="",i=0,o=t.length;i<o;i+=1){var s=t[i];i>0&&(n+=" ");n+="d"===r?s.type:"";s.values&&(n+=("d"===r?" ":"")+s.values.join(" "))}e.setAttribute(r,n)}}var n={Z:"Z",M:"M",L:"L",C:"C",Q:"Q",A:"A",H:"H",V:"V",S:"S",T:"T",z:"Z",m:"m",l:"l",c:"c",q:"q",a:"a",h:"h",v:"v",s:"s",t:"t"},i=function(e){this._string=e;this._currentIndex=0;this._endIndex=this._string.length;this._prevCommand=null;this._skipOptionalSpaces()},a=-1!==e.navigator.userAgent.indexOf("MSIE ");i.prototype={parseSegment:function(){var e=this._string[this._currentIndex],t=n[e]?n[e]:null;if(null===t){if(null===this._prevCommand)return null;t=("+"===e||"-"===e||"."===e||e>="0"&&e<="9")&&"Z"!==this._prevCommand?"M"===this._prevCommand?"L":"m"===this._prevCommand?"l":this._prevCommand:null;if(null===t)return null}else this._currentIndex+=1;this._prevCommand=t;var r=null,i=t.toUpperCase();if("H"===i||"V"===i)r=[this._parseNumber()];else if("M"===i||"L"===i||"T"===i)r=[this._parseNumber(),this._parseNumber()];else if("S"===i||"Q"===i)r=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()];else if("C"===i)r=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()];else if("A"===i)r=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseArcFlag(),this._parseArcFlag(),this._parseNumber(),this._parseNumber()];else if("Z"===i){this._skipOptionalSpaces();r=[]}return null===r||r.indexOf(null)>=0?null:{type:t,values:r}},hasMoreData:function(){return this._currentIndex<this._endIndex},peekSegmentType:function(){var e=this._string[this._currentIndex];return n[e]?n[e]:null},initialCommandIsMoveTo:function(){if(!this.hasMoreData())return!0;var e=this.peekSegmentType();return"M"===e||"m"===e},_isCurrentSpace:function(){var e=this._string[this._currentIndex];return e<=" "&&(" "===e||"\n"===e||"\t"===e||"\r"===e||"\f"===e)},_skipOptionalSpaces:function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex+=1;return this._currentIndex<this._endIndex},_skipOptionalSpacesOrDelimiter:function(){if(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!==this._string[this._currentIndex])return!1;if(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","===this._string[this._currentIndex]){this._currentIndex+=1;this._skipOptionalSpaces()}return this._currentIndex<this._endIndex},_parseNumber:function(){var e=0,t=0,r=1,n=0,i=1,a=1,o=this._currentIndex;this._skipOptionalSpaces();if(this._currentIndex<this._endIndex&&"+"===this._string[this._currentIndex])this._currentIndex+=1;else if(this._currentIndex<this._endIndex&&"-"===this._string[this._currentIndex]){this._currentIndex+=1;i=-1}if(this._currentIndex===this._endIndex||(this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")&&"."!==this._string[this._currentIndex])return null;for(var s=this._currentIndex;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";)this._currentIndex+=1;if(this._currentIndex!==s)for(var l=this._currentIndex-1,c=1;l>=s;){t+=c*(this._string[l]-"0");l-=1;c*=10}if(this._currentIndex<this._endIndex&&"."===this._string[this._currentIndex]){this._currentIndex+=1;if(this._currentIndex>=this._endIndex||this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")return null;for(;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";){n+=(this._string[this._currentIndex]-"0")*(r*=.1);this._currentIndex+=1}}if(this._currentIndex!==o&&this._currentIndex+1<this._endIndex&&("e"===this._string[this._currentIndex]||"E"===this._string[this._currentIndex])&&"x"!==this._string[this._currentIndex+1]&&"m"!==this._string[this._currentIndex+1]){this._currentIndex+=1;if("+"===this._string[this._currentIndex])this._currentIndex+=1;else if("-"===this._string[this._currentIndex]){this._currentIndex+=1;a=-1}if(this._currentIndex>=this._endIndex||this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")return null;for(;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";){e*=10;e+=this._string[this._currentIndex]-"0";this._currentIndex+=1}}var d=t+n;d*=i;e&&(d*=Math.pow(10,a*e));if(o===this._currentIndex)return null;this._skipOptionalSpacesOrDelimiter();return d},_parseArcFlag:function(){if(this._currentIndex>=this._endIndex)return null;var e=0,t=this._string[this._currentIndex];this._currentIndex+=1;if("0"===t)e=0;else{if("1"!==t)return null;e=1}this._skipOptionalSpacesOrDelimiter();return e}};var o=function(e){if(!e||0===e.length)return[];var t=new i(e),r=[];if(t.initialCommandIsMoveTo())for(;t.hasMoreData();){var n=t.parseSegment();if(null===n)break;r.push(n)}return r},s=function(e,t,r,n,i,a,o,l,c,d){var p,h,u,f,g=function(e,t,r){return{x:e*Math.cos(r)-t*Math.sin(r),y:e*Math.sin(r)+t*Math.cos(r)}},y=function(e){return Math.PI*e/180}(o),v=[];if(d){p=d[0];h=d[1];u=d[2];f=d[3]}else{var x=g(e,t,-y);e=x.x;t=x.y;var m=g(r,n,-y);r=m.x;n=m.y;var C=(e-r)/2,L=(t-n)/2,_=C*C/(i*i)+L*L/(a*a);if(_>1){_=Math.sqrt(_);i*=_;a*=_}var P;P=l===c?-1:1;var A=i*i,b=a*a,S=A*b-A*L*L-b*C*C,E=A*L*L+b*C*C,O=P*Math.sqrt(Math.abs(S/E));u=O*i*L/a+(e+r)/2;f=O*-a*C/i+(t+n)/2;p=Math.asin(((t-f)/a).toFixed(9));h=Math.asin(((n-f)/a).toFixed(9));e<u&&(p=Math.PI-p);r<u&&(h=Math.PI-h);p<0&&(p=2*Math.PI+p);h<0&&(h=2*Math.PI+h);c&&p>h&&(p-=2*Math.PI);!c&&h>p&&(h-=2*Math.PI)}var I=h-p;if(Math.abs(I)>120*Math.PI/180){var T=h,R=r,w=n;h=c&&h>p?p+120*Math.PI/180*1:p+120*Math.PI/180*-1;r=u+i*Math.cos(h);n=f+a*Math.sin(h);v=s(r,n,R,w,i,a,o,0,c,[h,T,u,f])}I=h-p;var N=Math.cos(p),k=Math.sin(p),M=Math.cos(h),B=Math.sin(h),D=Math.tan(I/4),V=4/3*i*D,F=4/3*a*D,G=[e,t],Y=[e+V*k,t-F*N],j=[r+V*B,n-F*M],H=[r,n];Y[0]=2*G[0]-Y[0];Y[1]=2*G[1]-Y[1];if(d)return[Y,j,H].concat(v);v=[Y,j,H].concat(v).join().split(",");var X=[],U=[];v.forEach(function(e,t){t%2?U.push(g(v[t-1],v[t],y).y):U.push(g(v[t],v[t+1],y).x);if(6===U.length){X.push(U);U=[]}});return X},l=function(e){var t=[],r=null,n=null,i=null,a=null;e.forEach(function(e){var o=e.type;if("M"===o){var s=e.values[0],l=e.values[1];t.push({type:"M",values:[s,l]});i=s;a=l;r=s;n=l}else if("m"===o){var s=r+e.values[0],l=n+e.values[1];t.push({type:"M",values:[s,l]});i=s;a=l;r=s;n=l}else if("L"===o){var s=e.values[0],l=e.values[1];t.push({type:"L",values:[s,l]});r=s;n=l}else if("l"===o){var s=r+e.values[0],l=n+e.values[1];t.push({type:"L",values:[s,l]});r=s;n=l}else if("C"===o){var c=e.values[0],d=e.values[1],p=e.values[2],h=e.values[3],s=e.values[4],l=e.values[5];t.push({type:"C",values:[c,d,p,h,s,l]});r=s;n=l}else if("c"===o){var c=r+e.values[0],d=n+e.values[1],p=r+e.values[2],h=n+e.values[3],s=r+e.values[4],l=n+e.values[5];t.push({type:"C",values:[c,d,p,h,s,l]});r=s;n=l}else if("Q"===o){var c=e.values[0],d=e.values[1],s=e.values[2],l=e.values[3];t.push({type:"Q",values:[c,d,s,l]});r=s;n=l}else if("q"===o){var c=r+e.values[0],d=n+e.values[1],s=r+e.values[2],l=n+e.values[3];t.push({type:"Q",values:[c,d,s,l]});r=s;n=l}else if("A"===o){var s=e.values[5],l=e.values[6];t.push({type:"A",values:[e.values[0],e.values[1],e.values[2],e.values[3],e.values[4],s,l]});r=s;n=l}else if("a"===o){var s=r+e.values[5],l=n+e.values[6];t.push({type:"A",values:[e.values[0],e.values[1],e.values[2],e.values[3],e.values[4],s,l]});r=s;n=l}else if("H"===o){var s=e.values[0];t.push({type:"H",values:[s]});r=s}else if("h"===o){var s=r+e.values[0];t.push({type:"H",values:[s]});r=s}else if("V"===o){var l=e.values[0];t.push({type:"V",values:[l]});n=l}else if("v"===o){var l=n+e.values[0];t.push({type:"V",values:[l]});n=l}else if("S"===o){var p=e.values[0],h=e.values[1],s=e.values[2],l=e.values[3];t.push({type:"S",values:[p,h,s,l]});r=s;n=l}else if("s"===o){var p=r+e.values[0],h=n+e.values[1],s=r+e.values[2],l=n+e.values[3];t.push({type:"S",values:[p,h,s,l]});r=s;n=l}else if("T"===o){var s=e.values[0],l=e.values[1];t.push({type:"T",values:[s,l]});r=s;n=l}else if("t"===o){var s=r+e.values[0],l=n+e.values[1];t.push({type:"T",values:[s,l]});r=s;n=l}else if("Z"===o||"z"===o){t.push({type:"Z",values:[]});r=i;n=a}});return t},c=function(e){var t=[],r=null,n=null,i=null,a=null,o=null,l=null,c=null;e.forEach(function(e){if("M"===e.type){var d=e.values[0],p=e.values[1];t.push({type:"M",values:[d,p]});l=d;c=p;a=d;o=p}else if("C"===e.type){var h=e.values[0],u=e.values[1],f=e.values[2],g=e.values[3],d=e.values[4],p=e.values[5];t.push({type:"C",values:[h,u,f,g,d,p]});n=f;i=g;a=d;o=p}else if("L"===e.type){var d=e.values[0],p=e.values[1];t.push({type:"L",values:[d,p]});a=d;o=p}else if("H"===e.type){var d=e.values[0];t.push({type:"L",values:[d,o]});a=d}else if("V"===e.type){var p=e.values[0];t.push({type:"L",values:[a,p]});o=p}else if("S"===e.type){var y,v,f=e.values[0],g=e.values[1],d=e.values[2],p=e.values[3];if("C"===r||"S"===r){y=a+(a-n);v=o+(o-i)}else{y=a;v=o}t.push({type:"C",values:[y,v,f,g,d,p]});n=f;i=g;a=d;o=p}else if("T"===e.type){var h,u,d=e.values[0],p=e.values[1];if("Q"===r||"T"===r){h=a+(a-n);u=o+(o-i)}else{h=a;u=o}var y=a+2*(h-a)/3,v=o+2*(u-o)/3,x=d+2*(h-d)/3,m=p+2*(u-p)/3;t.push({type:"C",values:[y,v,x,m,d,p]});n=h;i=u;a=d;o=p}else if("Q"===e.type){var h=e.values[0],u=e.values[1],d=e.values[2],p=e.values[3],y=a+2*(h-a)/3,v=o+2*(u-o)/3,x=d+2*(h-d)/3,m=p+2*(u-p)/3;t.push({type:"C",values:[y,v,x,m,d,p]});n=h;i=u;a=d;o=p}else if("A"===e.type){var C=e.values[0],L=e.values[1],_=e.values[2],P=e.values[3],A=e.values[4],d=e.values[5],p=e.values[6]
;if(0===C||0===L){t.push({type:"C",values:[a,o,d,p,d,p]});a=d;o=p}else if(a!==d||o!==p){var b=s(a,o,d,p,C,L,_,P,A);b.forEach(function(e){t.push({type:"C",values:e});a=d;o=p})}}else if("Z"===e.type){t.push(e);a=l;o=c}r=e.type});return t};SVGPathElement.prototype.getPathData=function(e){return t(this,e)};SVGPathElement.prototype.setPathData=function(e){r(this,e)};SVGPolylineElement.prototype.getPathData=function(e){var r=this.getAttribute("points")||"";return t(zt("path",{d:r?"M"+r:""}),e)};SVGPolygonElement.prototype.getPathData=function(e){var r=this.getAttribute("points")||"";return t(zt("path",{d:r?"M"+r:""}),e)};SVGPolylineElement.prototype.setPathData=function(e){r(this,e)};SVGPolygonElement.prototype.setPathData=function(e){r(this,e)}}();!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error;e.prototype.name="InvalidCharacterError";t.btoa||(t.btoa=function(t){for(var n,i,a=String(t),o=0,s=r,l="";a.charAt(0|o)||(s="=",o%1);l+=s.charAt(63&n>>8-o%1*8)){i=a.charCodeAt(o+=.75);if(i>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|i}return l});t.atob||(t.atob=function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,a,o=0,s=0,l="";a=n.charAt(s++);~a&&(i=o%4?64*i+a:a,o++%4)?l+=String.fromCharCode(255&i>>(-2*o&6)):0)a=r.indexOf(a);return l})}();!function(e){var t=["concat","every","filter","forEach","includes","indexOf","lastIndexOf","map","pop","push","reduce","reduceRight","reverse","shift","slice","some","sort","splice","unshift"],r={};Array.prototype.toArray||(Array.prototype.toArray=function(){return this.slice()});for(var n=0;n<e.length;n++){e[n].toArray||(e[n].toArray=function(){return Array.prototype.slice.call(this)});for(var i=0;i<t.length;i++){var a=t[i];e[n][a]||(e[n][a]=function(e){return r[e]||(r[e]=function(){var t=this.toArray();return t[e].apply(t,arguments)})}(a))}}}([HTMLCollection.prototype,NodeList.prototype]);e.SVGElement&&!SVGElement.prototype.getTransformToElement&&(SVGElement.prototype.getTransformToElement=function(e){return e.getScreenCTM().inverse().multiply(this.getScreenCTM())});e.SVGElement&&!SVGElement.prototype.contains&&(SVGElement.prototype.contains=function(e){return(20&this.compareDocumentPosition(e))>0});!e.SVGElement||"children"in SVGElement.prototype||Object.defineProperty(SVGElement.prototype,"children",{get:function(){for(var e=this.childNodes,t=e.length,r=[],n=0;n<t;n++)1===e[n].nodeType&&r.push(e[n]);return r}});!e.SVGElement||"outerHTML"in SVGElement.prototype||Object.defineProperty(SVGElement.prototype,"outerHTML",{get:function(){var e=this,t=(new XMLSerializer).serializeToString(e);"svg"!=e.tagName&&(t=t.replace(/ xmlns="http:\/\/www\.w3\.org\/2000\/svg"/g,""));return t}});!e.SVGSVGElement||"checkEnclosure"in SVGSVGElement.prototype||Object.defineProperties(SVGSVGElement.prototype,{getIntersectionList:{get:function(e,t){return[]}},getEnclosureList:{get:function(e,t){return[]}},checkIntersection:{get:function(e,t){return!1}},checkEnclosure:{get:function(e,t){return!1}}});!function(e){e.forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),r=t.createDocumentFragment();e.forEach(function(e){var n=e instanceof Node;r.appendChild(n?e:t.createTextNode(String(e)))});this.appendChild(r)}})})}([Element.prototype,Document.prototype,DocumentFragment.prototype]);!function(){function t(e,t){return e.hasOwnProperty(t)}var r="object"==typeof localStorage;if(r)try{var n="_"+Math.random();localStorage.setItem(n,"_");localStorage.removeItem(n)}catch(e){r=!1}if(!r){var i={},a={getItem:function(e){return t(i,e)?i[e]:null},setItem:function(e,t){i[e]=String(t)},removeItem:function(e){t(i,e)&&delete i[e]},clear:function(){for(var e in i)t(i,e)&&delete i[e]}};if("object"!=typeof localStorage)e.localStorage=a;else for(var o in a)t(a,o)&&(localStorage[o]=a[o])}}();String.prototype.codePointAt||function(){"use strict";var e=function(e){if(null===this)throw TypeError();var t=String(this),r=t.length,n=e?Number(e):0;n!=n&&(n=0);if(!(n<0||n>=r)){var i,a=t.charCodeAt(n);if(a>=55296&&a<=56319&&r>n+1){i=t.charCodeAt(n+1);if(i>=56320&&i<=57343)return 1024*(a-55296)+i-56320+65536}return a}};Object.defineProperty?Object.defineProperty(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();String.fromCodePoint||function(){var e=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),t=String.fromCharCode,r=Math.floor,n=function(){var e,n,i=[],a=-1,o=arguments.length;if(!o)return"";for(var s="";++a<o;){var l=Number(arguments[a]);if(!isFinite(l)||l<0||l>1114111||r(l)!=l)throw RangeError("Invalid code point: "+l);if(l<=65535)i.push(l);else{l-=65536;e=55296+(l>>10);n=l%1024+56320;i.push(e,n)}if(a+1==o||i.length>16384){s+=t.apply(null,i);i.length=0}}return s};e?e(String,"fromCodePoint",{value:n,configurable:!0,writable:!0}):String.fromCodePoint=n}();Object.values||(Object.values=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t});"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(void 0!==i&&null!==i)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a])}return r},writable:!0,configurable:!0});r.prototype={constructor:r,Point:function(e,t){this.x=e;this.y=t},_findPolarAngle:function(e,t){var r,n;if(!e||!t)return 0;r=t.x-e.x;n=t.y-e.y;if(0===r&&0===n)return 0;var i=57.295779513082*Math.atan2(n,r);this.reverse?i<=0&&(i+=360):i>=0&&(i+=360);return i},addPoint:function(e,t){if(void 0===this.anchorPoint||this.anchorPoint.y>t||this.anchorPoint.y===t&&this.anchorPoint.x>e){void 0!==this.anchorPoint&&this.points.push(new this.Point(this.anchorPoint.x,this.anchorPoint.y));this.anchorPoint=new this.Point(e,t)}else this.points.push(new this.Point(e,t))},_sortPoints:function(){var e=this;return this.points.sort(function(t,r){var n=e._findPolarAngle(e.anchorPoint,t),i=e._findPolarAngle(e.anchorPoint,r);return n<i?-1:n>i?1:0})},_checkPoints:function(e,t,r){var n,i=this._findPolarAngle(e,t),a=this._findPolarAngle(e,r);if(i>a){n=i-a;return n<=180}if(i<a){n=a-i;return n>180}return!0},getHull:function(){var e,t,r=[];this.reverse=this.points.every(function(e){return e.x<0&&e.y<0});e=this._sortPoints();t=e.length;if(t<3){e.unshift(this.anchorPoint);return e}r.push(e.shift(),e.shift());for(;;){var n,i,a;r.push(e.shift());n=r[r.length-3];i=r[r.length-2];a=r[r.length-1];this._checkPoints(n,i,a)&&r.splice(r.length-2,1);if(0===e.length){if(t==r.length){var o=this.anchorPoint;r=r.filter(function(e){return!!e});r.some(function(e){return e.x==o.x&&e.y==o.y})||r.unshift(this.anchorPoint);return r}e=r;t=e.length;r=[];r.push(e.shift(),e.shift())}}}};"function"==typeof define&&define.amd&&define(function(){return r});"undefined"!=typeof module&&(module.exports=r);!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r;r=void 0!==e?e:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;r.rbush=t()}}(function(){return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[o]={exports:{}};t[o][0].call(d.exports,function(e){var r=t[o][1][e];return i(r||e)},d,d.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";function n(e,t){if(!(this instanceof n))return new n(e,t);this._maxEntries=Math.max(4,e||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));t&&this._initFormat(t);this.clear()}function i(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function a(e,t){o(e,0,e.children.length,t,e)}function o(e,t,r,n,i){i||(i=y(null));i.minX=1/0;i.minY=1/0;i.maxX=-1/0;i.maxY=-1/0;for(var a,o=t;o<r;o++){a=e.children[o];s(i,e.leaf?n(a):a)}return i}function s(e,t){e.minX=Math.min(e.minX,t.minX);e.minY=Math.min(e.minY,t.minY);e.maxX=Math.max(e.maxX,t.maxX);e.maxY=Math.max(e.maxY,t.maxY);return e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function d(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function p(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function u(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,a-n)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function y(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(e,t,r,n,i){for(var a,o=[t,r];o.length;){r=o.pop();t=o.pop();if(!(r-t<=n)){a=t+Math.ceil((r-t)/n/2)*n;x(e,a,t,r,i);o.push(t,a,a,r)}}}t.exports=n;t.exports.default=n;var x=e("quickselect");n.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],n=this.toBBox;if(!g(e,t))return r;for(var i,a,o,s,l=[];t;){for(i=0,a=t.children.length;i<a;i++){o=t.children[i];s=t.leaf?n(o):o;g(e,s)&&(t.leaf?r.push(o):f(e,s)?this._all(o,r):l.push(o))}t=l.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!g(e,t))return!1;for(var n,i,a,o,s=[];t;){for(n=0,i=t.children.length;n<i;n++){a=t.children[n];o=t.leaf?r(a):a;if(g(e,o)){if(t.leaf||f(e,o))return!0;s.push(a)}}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n;n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){e&&this._insert(e,this.data.height-1);return this},clear:function(){this.data=y([]);return this},remove:function(e,t){if(!e)return this;for(var r,n,a,o,s=this.data,l=this.toBBox(e),c=[],d=[];s||c.length;){if(!s){s=c.pop();n=c[c.length-1];r=d.pop();o=!0}if(s.leaf){a=i(e,s.children,t);if(-1!==a){s.children.splice(a,1);c.push(s);this._condense(c);return this}}if(o||s.leaf||!f(s,l))if(n){r++;s=n.children[r];o=!1}else s=null;else{c.push(s);d.push(r);r=0;n=s;s=s.children[0]}}return this},toBBox:function(e){return e},compareMinX:l,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(e){this.data=e;return this},_all:function(e,t){for(var r=[];e;){e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children);e=r.pop()}return t},_build:function(e,t,r,n){var i,o=r-t+1,s=this._maxEntries;if(o<=s){i=y(e.slice(t,r+1));a(i,this.toBBox);return i}if(!n){n=Math.ceil(Math.log(o)/Math.log(s));s=Math.ceil(o/Math.pow(s,n-1))}i=y([]);i.leaf=!1;i.height=n;var l,c,d,p,h=Math.ceil(o/s),u=h*Math.ceil(Math.sqrt(s));v(e,t,r,u,this.compareMinX);for(l=t;l<=r;l+=u){d=Math.min(l+u-1,r);v(e,l,d,h,this.compareMinY);for(c=l;c<=d;c+=h){p=Math.min(c+h-1,d);i.children.push(this._build(e,c,p,n-1))}}a(i,this.toBBox);return i},_chooseSubtree:function(e,t,r,n){for(var i,a,o,s,l,c,p,u;;){n.push(t);if(t.leaf||n.length-1===r)break;p=u=1/0;for(i=0,a=t.children.length;i<a;i++){o=t.children[i];l=d(o);c=h(e,o)-l;if(c<u){u=c;p=l<p?l:p;s=o}else if(c===u&&l<p){p=l;s=o}}t=s||t.children[0]}return t},_insert:function(e,t,r){var n=this.toBBox,i=r?e:n(e),a=[],o=this._chooseSubtree(i,this.data,t,a);o.children.push(e);s(o,i);for(;t>=0&&a[t].children.length>this._maxEntries;){this._split(a,t);t--}this._adjustParentBBoxes(i,a,t)},_split:function(e,t){var r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=y(r.children.splice(o,r.children.length-o));s.height=r.height;s.leaf=r.leaf;a(r,this.toBBox);a(s,this.toBBox);t?e[t-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(e,t){this.data=y([e,t]);this.data.height=e.height+1;this.data.leaf=!1;a(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var n,i,a,s,l,c,p,h;c=p=1/0;for(n=t;n<=r-t;n++){i=o(e,0,n,this.toBBox);a=o(e,n,r,this.toBBox);s=u(i,a);l=d(i)+d(a);if(s<c){c=s;h=n;p=l<p?l:p}else if(s===c&&l<p){p=l;h=n}}return h},_chooseSplitAxis:function(e,t,r){var n=e.leaf?this.compareMinX:l,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)},_allDistMargin:function(e,t,r,n){e.children.sort(n);var i,a,l=this.toBBox,c=o(e,0,t,l),d=o(e,r-t,r,l),h=p(c)+p(d);for(i=t;i<r-t;i++){a=e.children[i];s(c,e.leaf?l(a):a);h+=p(c)}for(i=r-t-1;i>=t;i--){a=e.children[i];s(d,e.leaf?l(a):a);h+=p(d)}return h},_adjustParentBBoxes:function(e,t,r){for(var n=r;n>=0;n--)s(t[n],e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)if(0===e[r].children.length)if(r>0){t=e[r-1].children;t.splice(t.indexOf(e[r]),1)}else this.clear();else a(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0]));this.compareMinY=new Function("a","b",t.join(e[1]));this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},{quickselect:2}],2:[function(e,t,r){"use strict";function n(e,t,r,n,a){i(e,t,r||0,n||e.length-1,a||o)}function i(e,t,r,n,o){for(;n>r;){if(n-r>600){var s=n-r+1,l=t-r+1,c=Math.log(s),d=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*d*(s-d)/s)*(l-s/2<0?-1:1);i(e,t,Math.max(r,Math.floor(t-l*d/s+p)),Math.min(n,Math.floor(t+(s-l)*d/s+p)),o)}var h=e[t],u=r,f=n;a(e,r,t);o(e[n],h)>0&&a(e,r,n);for(;u<f;){a(e,u,f);u++;f--;for(;o(e[u],h)<0;)u++;for(;o(e[f],h)>0;)f--}if(0===o(e[r],h))a(e,r,f);else{f++;a(e,f,n)}f<=t&&(r=f+1);t<=f&&(n=f-1)}}function a(e,t,r){var n=e[t];e[t]=e[r];e[r]=n}function o(e,t){return e<t?-1:e>t?1:0}t.exports=n;t.exports.default=n},{}]},{},[1])(1)});!function(){function r(e,t,r){et.biginteger_used=1;if(null!=e)if("number"==typeof e)this.fromString(Math.floor(e).toString(),10);else if(null==t&&"string"!=typeof e)this.fromString(e,256);else{-1!=e.indexOf(".")&&(e=e.substring(0,e.indexOf(".")));this.fromString(e,t)}}function n(){return new r(null)}function i(e,t,r,n,i,a){for(;--a>=0;){var o=t*this[e++]+r[n]+i;i=Math.floor(o/67108864);r[n++]=67108863&o}return i}function a(e,t,r,n,i,a){for(var o=32767&t,s=t>>15;--a>=0;){var l=32767&this[e],c=this[e++]>>15,d=s*l+c*o;l=o*l+((32767&d)<<15)+r[n]+(1073741823&i);i=(l>>>30)+(d>>>15)+s*c+(i>>>30);r[n++]=1073741823&l}return i}function o(e,t,r,n,i,a){for(var o=16383&t,s=t>>14;--a>=0;){var l=16383&this[e],c=this[e++]>>14,d=s*l+c*o;l=o*l+((16383&d)<<14)+r[n]+i;i=(l>>28)+(d>>14)+s*c;r[n++]=268435455&l}return i}function s(e){return lt.charAt(e)}function l(e,t){var r=ct[e.charCodeAt(t)];return null==r?-1:r}function c(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t;e.s=this.s}function d(e){this.t=1;this.s=e<0?-1:0;e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function p(e){var t=n();t.fromInt(e);return t}function h(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t){this.fromRadix(e,t);return}n=2}this.t=0;this.s=0;for(var i=e.length,a=!1,o=0;--i>=0;){var s=8==n?255&e[i]:l(e,i);if(s<0)"-"==e.charAt(i)&&(a=!0);else{a=!1;if(0==o)this[this.t++]=s;else if(o+n>this.DB){this[this.t-1]|=(s&(1<<this.DB-o)-1)<<o;this[this.t++]=s>>this.DB-o}else this[this.t-1]|=s<<o;o+=n;o>=this.DB&&(o-=this.DB)}}if(8==n&&0!=(128&e[0])){this.s=-1;o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)}this.clamp();a&&r.ZERO.subTo(this,this)}function u(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function f(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,a="",o=this.t,l=this.DB-o*this.DB%t;if(o-- >0){if(l<this.DB&&(r=this[o]>>l)>0){i=!0;a=s(r)}for(;o>=0;){if(l<t){r=(this[o]&(1<<l)-1)<<t-l;r|=this[--o]>>(l+=this.DB-t)}else{r=this[o]>>(l-=t)&n;if(l<=0){l+=this.DB;--o}}r>0&&(i=!0);i&&(a+=s(r))}}return i?a:"0"}function g(){var e=n();r.ZERO.subTo(this,e);return e}function y(){return this.s<0?this.negate():this}function v(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;t=r-e.t;if(0!=t)return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0}function x(e){var t,r=1;if(0!=(t=e>>>16)){e=t;r+=16}if(0!=(t=e>>8)){e=t;r+=8}if(0!=(t=e>>4)){e=t;r+=4}if(0!=(t=e>>2)){e=t;r+=2}if(0!=(t=e>>1)){e=t;r+=1}return r}function m(){return this.t<=0?0:this.DB*(this.t-1)+x(this[this.t-1]^this.s&this.DM)}function C(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e;t.s=this.s}function L(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0);t.s=this.s}function _(e,t){var r,n=e%this.DB,i=this.DB-n,a=(1<<i)-1,o=Math.floor(e/this.DB),s=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r){t[r+o+1]=this[r]>>i|s;s=(this[r]&a)<<n}for(r=o-1;r>=0;--r)t[r]=0;t[o]=s;t.t=this.t+o+1;t.s=this.s;t.clamp()}function P(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,a=(1<<n)-1;t[0]=this[r]>>n;for(var o=r+1;o<this.t;++o){t[o-r-1]|=(this[o]&a)<<i;t[o-r]=this[o]>>n}n>0&&(t[this.t-r-1]|=(this.s&a)<<i);t.t=this.t-r;t.clamp()}}function A(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;){n+=this[r]-e[r];t[r++]=n&this.DM;n>>=this.DB}if(e.t<this.t){n-=e.s;for(;r<this.t;){n+=this[r];t[r++]=n&this.DM;n>>=this.DB}n+=this.s}else{n+=this.s;for(;r<e.t;){n-=e[r];t[r++]=n&this.DM;n>>=this.DB}n-=e.s}t.s=n<0?-1:0;n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n);t.t=r;t.clamp()}function b(e,t){var n=this.abs(),i=e.abs(),a=n.t;t.t=a+i.t;for(;--a>=0;)t[a]=0;for(a=0;a<i.t;++a)t[a+n.t]=n.am(0,i[a],t,a,0,n.t);t.s=0;t.clamp();this.s!=e.s&&r.ZERO.subTo(t,t)}function S(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);if((e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV){e[r+t.t]-=t.DV;e[r+t.t+1]=1}}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1));e.s=0;e.clamp()}function E(e,t,i){var a=e.abs();if(!(a.t<=0)){var o=this.abs();if(o.t<a.t){null!=t&&t.fromInt(0);null!=i&&this.copyTo(i)}else{null==i&&(i=n());var s=n(),l=this.s,c=e.s,d=this.DB-x(a[a.t-1]);if(d>0){a.lShiftTo(d,s);o.lShiftTo(d,i)}else{a.copyTo(s);o.copyTo(i)}var p=s.t,h=s[p-1];if(0!=h){var u=h*(1<<this.F1)+(p>1?s[p-2]>>this.F2:0),f=this.FV/u,g=(1<<this.F1)/u,y=1<<this.F2,v=i.t,m=v-p,C=null==t?n():t;s.dlShiftTo(m,C);if(i.compareTo(C)>=0){i[i.t++]=1;i.subTo(C,i)}r.ONE.dlShiftTo(p,C);C.subTo(s,s);for(;s.t<p;)s[s.t++]=0;for(;--m>=0;){var L=i[--v]==h?this.DM:Math.floor(i[v]*f+(i[v-1]+y)*g);if((i[v]+=s.am(0,L,i,m,0,p))<L){s.dlShiftTo(m,C);i.subTo(C,i);for(;i[v]<--L;)i.subTo(C,i)}}if(null!=t){i.drShiftTo(p,t);l!=c&&r.ZERO.subTo(t,t)}i.t=p;i.clamp();d>0&&i.rShiftTo(d,i);l<0&&r.ZERO.subTo(i,i)}}}}function O(e){var t=n();this.abs().divRemTo(e,null,t);this.s<0&&t.compareTo(r.ZERO)>0&&e.subTo(t,t);return t}function I(e){this.m=e}function T(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function R(e){return e}function w(e){e.divRemTo(this.m,null,e)}function N(e,t,r){e.multiplyTo(t,r);this.reduce(r)}function k(e,t){e.squareTo(t);this.reduce(t)}function M(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;t=t*(2-(15&e)*t)&15;t=t*(2-(255&e)*t)&255;t=t*(2-((65535&e)*t&65535))&65535;t=t*(2-e*t%this.DV)%this.DV;return t>0?this.DV-t:-t}function B(e){this.m=e;this.mp=e.invDigit();this.mpl=32767&this.mp;this.mph=this.mp>>15;this.um=(1<<e.DB-15)-1;this.mt2=2*e.t}function D(e){var t=n();e.abs().dlShiftTo(this.m.t,t);t.divRemTo(this.m,null,t);e.s<0&&t.compareTo(r.ZERO)>0&&this.m.subTo(t,t);return t}function V(e){var t=n();e.copyTo(t);this.reduce(t);return t}function F(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;r=t+this.m.t;e[r]+=this.m.am(0,n,e,t,0,this.m.t);for(;e[r]>=e.DV;){e[r]-=e.DV;e[++r]++}}e.clamp();e.drShiftTo(this.m.t,e);e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function G(e,t){e.squareTo(t);this.reduce(t)}function Y(e,t,r){e.multiplyTo(t,r);this.reduce(r)}function j(){return 0==(this.t>0?1&this[0]:this.s)}function H(e,t){if(e>4294967295||e<1)return r.ONE;var i=n(),a=n(),o=t.convert(this),s=x(e)-1;o.copyTo(i);for(;--s>=0;){t.sqrTo(i,a);if((e&1<<s)>0)t.mulTo(a,o,i);else{var l=i;i=a;a=l}}return t.revert(i)}function X(e,t){var r;r=e<256||t.isEven()?new I(t):new B(t);return this.exp(e,r)}function U(){var e=n();this.copyTo(e);return e}function J(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function z(){return 0==this.t?this.s:this[0]<<24>>24}function W(){return 0==this.t?this.s:this[0]<<16>>16}function Z(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function K(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function q(e){null==e&&(e=10);if(0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),i=p(r),a=n(),o=n(),s="";this.divRemTo(i,a,o);for(;a.signum()>0;){s=(r+o.intValue()).toString(e).substr(1)+s;a.divRemTo(i,a,o)}return o.intValue().toString(e)+s}function $(e,t){this.fromInt(0);null==t&&(t=10);for(var n=this.chunkSize(t),i=Math.pow(t,n),a=!1,o=0,s=0,c=0;c<e.length;++c){var d=l(e,c);if(d<0)"-"==e.charAt(c)&&0==this.signum()&&(a=!0);else{s=t*s+d;if(++o>=n){this.dMultiply(i);this.dAddOffset(s,0);o=0;s=0}}}if(o>0){this.dMultiply(Math.pow(t,o));this.dAddOffset(s,0)}a&&r.ZERO.subTo(this,this)}function Q(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n);this.testBit(e-1)||this.bitwiseTo(r.ONE.shiftLeft(e-1),se,this);this.isEven()&&this.dAddOffset(1,0);for(;!this.isProbablePrime(t);){this.dAddOffset(2,0);this.bitLength()>e&&this.subTo(r.ONE.shiftLeft(e-1),this)}}else{var i=[],a=7&e;i.length=1+(e>>3);t.nextBytes(i);a>0?i[0]&=(1<<a)-1:i[0]=0;this.fromString(i,256)}}function ee(){var e=this.t,t=[];t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0){n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);for(;e>=0;){if(n<8){r=(this[e]&(1<<n)-1)<<8-n;r|=this[--e]>>(n+=this.DB-8)}else{r=this[e]>>(n-=8)&255;if(n<=0){n+=this.DB;--e}}0!=(128&r)&&(r|=-256);0==i&&(128&this.s)!=(128&r)&&++i;(i>0||r!=this.s)&&(t[i++]=r)}}return t}function te(e){return 0==this.compareTo(e)}function re(e){return this.compareTo(e)<0?this:e}function ne(e){return this.compareTo(e)>0?this:e}function ie(e,t,r){var n,i,a=Math.min(e.t,this.t);for(n=0;n<a;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){i=e.s&this.DM;for(n=a;n<this.t;++n)r[n]=t(this[n],i);r.t=this.t}else{i=this.s&this.DM;for(n=a;n<e.t;++n)r[n]=t(i,e[n]);r.t=e.t}r.s=t(this.s,e.s);r.clamp()}function ae(e,t){return e&t}function oe(e){var t=n();this.bitwiseTo(e,ae,t);return t}function se(e,t){return e|t}function le(e){var t=n();this.bitwiseTo(e,se,t);return t}function ce(e,t){return e^t}function de(e){var t=n();this.bitwiseTo(e,ce,t);return t}function pe(e,t){return e&~t}function he(e){var t=n();this.bitwiseTo(e,pe,t);return t}function ue(){for(var e=n(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];e.t=this.t;e.s=~this.s;return e}function fe(e){var t=n();e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t);return t}function ge(e){var t=n();e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t);return t}function ye(e){if(0==e)return-1;var t=0;if(0==(65535&e)){e>>=16;t+=16}if(0==(255&e)){e>>=8;t+=8}if(0==(15&e)){e>>=4;t+=4}if(0==(3&e)){e>>=2;t+=2}0==(1&e)&&++t;return t}function ve(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+ye(this[e]);return this.s<0?this.t*this.DB:-1}function xe(e){for(var t=0;0!=e;){e&=e-1;++t}return t}function me(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=xe(this[r]^t);return e}function Ce(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)}function Le(e,t){var n=r.ONE.shiftLeft(e);this.bitwiseTo(n,t,n);return n}function _e(e){return this.changeBit(e,se)}function Pe(e){return this.changeBit(e,pe)}function Ae(e){return this.changeBit(e,ce)}function be(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;){n+=this[r]+e[r];t[r++]=n&this.DM;n>>=this.DB}if(e.t<this.t){n+=e.s;for(;r<this.t;){n+=this[r];t[r++]=n&this.DM;n>>=this.DB}n+=this.s}else{n+=this.s;for(;r<e.t;){n+=e[r];t[r++]=n&this.DM;n>>=this.DB}n+=e.s}t.s=n<0?-1:0;n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n);t.t=r;t.clamp()}function Se(e){var t=n();this.addTo(e,t);return t}function Ee(e){var t=n();this.subTo(e,t);return t}function Oe(e){var t=n();this.multiplyTo(e,t);return t}function Ie(){var e=n();this.squareTo(e);return e}function Te(e){var t=n();this.divRemTo(e,t,null);return t}function Re(e){var t=n();this.divRemTo(e,null,t);return t}function we(e){var t=n(),r=n();this.divRemTo(e,t,r);return new Array(t,r)}function Ne(e){this[this.t]=this.am(0,e-1,this,0,0,this.t);++this.t;this.clamp()}function ke(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;this[t]+=e;for(;this[t]>=this.DV;){this[t]-=this.DV;++t>=this.t&&(this[this.t++]=0);++this[t]}}}function Me(){}function Be(e){return e}function De(e,t,r){e.multiplyTo(t,r)}function Ve(e,t){e.squareTo(t)}function Fe(e){return this.exp(e,new Me)}function Ge(e,t,r){var n=Math.min(this.t+e.t,t);r.s=0;r.t=n;for(;n>0;)r[--n]=0;var i;for(i=r.t-this.t;n<i;++n)r[n+this.t]=this.am(0,e[n],r,n,0,this.t);for(i=Math.min(e.t,t);n<i;++n)this.am(0,e[n],r,n,0,t-n);r.clamp()}function Ye(e,t,r){--t;var n=r.t=this.t+e.t-t;r.s=0;for(;--n>=0;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp();r.drShiftTo(1,r)}function je(e){this.r2=n();this.q3=n();r.ONE.dlShiftTo(2*e.t,this.r2);this.mu=this.r2.divide(e);this.m=e}function He(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=n();e.copyTo(t);this.reduce(t);return t}function Xe(e){return e}function Ue(e){e.drShiftTo(this.m.t-1,this.r2);if(e.t>this.m.t+1){e.t=this.m.t+1;e.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);for(;e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);for(;e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function Je(e,t){e.squareTo(t);this.reduce(t)}function ze(e,t,r){e.multiplyTo(t,r);this.reduce(r)}function We(e,t){var r,i,a=e.bitLength(),o=p(1);if(a<=0)return o;r=a<18?1:a<48?3:a<144?4:a<768?5:6;i=a<8?new I(t):t.isEven()?new je(t):new B(t);var s=[],l=3,c=r-1,d=(1<<r)-1;s[1]=i.convert(this);if(r>1){var h=n();i.sqrTo(s[1],h);for(;l<=d;){s[l]=n();i.mulTo(h,s[l-2],s[l]);l+=2}}var u,f,g=e.t-1,y=!0,v=n();a=x(e[g])-1;for(;g>=0;){if(a>=c)u=e[g]>>a-c&d;else{u=(e[g]&(1<<a+1)-1)<<c-a;g>0&&(u|=e[g-1]>>this.DB+a-c)}l=r;for(;0==(1&u);){u>>=1;--l}if((a-=l)<0){a+=this.DB;--g}if(y){s[u].copyTo(o);y=!1}else{for(;l>1;){i.sqrTo(o,v);i.sqrTo(v,o);l-=2}if(l>0)i.sqrTo(o,v);else{f=o;o=v;v=f}i.mulTo(v,s[u],o)}for(;g>=0&&0==(e[g]&1<<a);){i.sqrTo(o,v);f=o;o=v;v=f;if(--a<0){a=this.DB-1;--g}}}return i.revert(o)}function Ze(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r;r=n}var i=t.getLowestSetBit(),a=r.getLowestSetBit();if(a<0)return t;i<a&&(a=i);if(a>0){t.rShiftTo(a,t);r.rShiftTo(a,r)}for(;t.signum()>0;){(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t);(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r);if(t.compareTo(r)>=0){t.subTo(r,t);t.rShiftTo(1,t)}else{r.subTo(t,r);r.rShiftTo(1,r)}}a>0&&r.lShiftTo(a,r);return r}function Ke(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this[n])%e;return r}function qe(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return r.ZERO;for(var n=e.clone(),i=this.clone(),a=p(1),o=p(0),s=p(0),l=p(1);0!=n.signum();){for(;n.isEven();){n.rShiftTo(1,n);if(t){if(!a.isEven()||!o.isEven()){a.addTo(this,a);o.subTo(e,o)}a.rShiftTo(1,a)}else o.isEven()||o.subTo(e,o);o.rShiftTo(1,o)}for(;i.isEven();){i.rShiftTo(1,i);if(t){if(!s.isEven()||!l.isEven()){s.addTo(this,s);l.subTo(e,l)}s.rShiftTo(1,s)}else l.isEven()||l.subTo(e,l);l.rShiftTo(1,l)}if(n.compareTo(i)>=0){n.subTo(i,n);t&&a.subTo(s,a);o.subTo(l,o)}else{i.subTo(n,i);t&&s.subTo(a,s);l.subTo(o,l)}}if(0!=i.compareTo(r.ONE))return r.ZERO;if(l.compareTo(e)>=0)return l.subtract(e);if(!(l.signum()<0))return l;l.addTo(e,l);return l.signum()<0?l.add(e):l}function $e(e){var t,r=this.abs();if(1==r.t&&r[0]<=dt[dt.length-1]){for(t=0;t<dt.length;++t)if(r[0]==dt[t])return!0;return!1}if(r.isEven())return!1;t=1;for(;t<dt.length;){for(var n=dt[t],i=t+1;i<dt.length&&n<pt;)n*=dt[i++];n=r.modInt(n);for(;t<i;)if(n%dt[t++]==0)return!1}return r.millerRabin(e)}function Qe(e){var t=this.subtract(r.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var a=t.shiftRight(i);e=e+1>>1;e>dt.length&&(e=dt.length);for(var o=n(),s=0;s<e;++s){o.fromInt(dt[Math.floor(Math.random()*dt.length)]);var l=o.modPow(a,this);if(0!=l.compareTo(r.ONE)&&0!=l.compareTo(t)){for(var c=1;c++<i&&0!=l.compareTo(t);){l=l.modPowInt(2,this);if(0==l.compareTo(r.ONE))return!1}if(0!=l.compareTo(t))return!1}}return!0}var et={},tt=!1;if("undefined"!=typeof module&&module.exports){module.exports=et;tt=!0}else void 0!==t?e.ClipperLib=et:self.ClipperLib=et;var rt;if(tt){var nt="chrome";rt="Netscape"}else{var nt=navigator.userAgent.toString().toLowerCase();rt=navigator.appName}var it={};-1!=nt.indexOf("chrome")&&-1==nt.indexOf("chromium")?it.chrome=1:it.chrome=0;-1!=nt.indexOf("chromium")?it.chromium=1:it.chromium=0;-1!=nt.indexOf("safari")&&-1==nt.indexOf("chrome")&&-1==nt.indexOf("chromium")?it.safari=1:it.safari=0;-1!=nt.indexOf("firefox")?it.firefox=1:it.firefox=0;-1!=nt.indexOf("firefox/17")?it.firefox17=1:it.firefox17=0;-1!=nt.indexOf("firefox/15")?it.firefox15=1:it.firefox15=0;-1!=nt.indexOf("firefox/3")?it.firefox3=1:it.firefox3=0;-1!=nt.indexOf("opera")?it.opera=1:it.opera=0;-1!=nt.indexOf("msie 10")?it.msie10=1:it.msie10=0;-1!=nt.indexOf("msie 9")?it.msie9=1:it.msie9=0;-1!=nt.indexOf("msie 8")?it.msie8=1:it.msie8=0;-1!=nt.indexOf("msie 7")?it.msie7=1:it.msie7=0;-1!=nt.indexOf("msie ")?it.msie=1:it.msie=0;et.biginteger_used=null;var at;if("Microsoft Internet Explorer"==rt){r.prototype.am=a;at=30}else if("Netscape"!=rt){r.prototype.am=i;at=26}else{r.prototype.am=o;at=28}r.prototype.DB=at;r.prototype.DM=(1<<at)-1;r.prototype.DV=1<<at;r.prototype.FV=Math.pow(2,52);r.prototype.F1=52-at;r.prototype.F2=2*at-52;var ot,st,lt="0123456789abcdefghijklmnopqrstuvwxyz",ct=[];ot="0".charCodeAt(0);for(st=0;st<=9;++st)ct[ot++]=st;ot="a".charCodeAt(0);for(st=10;st<36;++st)ct[ot++]=st;ot="A".charCodeAt(0);for(st=10;st<36;++st)ct[ot++]=st;I.prototype.convert=T;I.prototype.revert=R;I.prototype.reduce=w;I.prototype.mulTo=N;I.prototype.sqrTo=k;B.prototype.convert=D;B.prototype.revert=V;B.prototype.reduce=F;B.prototype.mulTo=Y;B.prototype.sqrTo=G;r.prototype.copyTo=c;r.prototype.fromInt=d;r.prototype.fromString=h;r.prototype.clamp=u;r.prototype.dlShiftTo=C;r.prototype.drShiftTo=L;r.prototype.lShiftTo=_;r.prototype.rShiftTo=P;r.prototype.subTo=A;r.prototype.multiplyTo=b;r.prototype.squareTo=S;r.prototype.divRemTo=E;r.prototype.invDigit=M;r.prototype.isEven=j;r.prototype.exp=H;r.prototype.toString=f;r.prototype.negate=g;r.prototype.abs=y;r.prototype.compareTo=v;r.prototype.bitLength=m;r.prototype.mod=O;r.prototype.modPowInt=X;r.ZERO=p(0);r.ONE=p(1);Me.prototype.convert=Be;Me.prototype.revert=Be
;Me.prototype.mulTo=De;Me.prototype.sqrTo=Ve;je.prototype.convert=He;je.prototype.revert=Xe;je.prototype.reduce=Ue;je.prototype.mulTo=ze;je.prototype.sqrTo=Je;var dt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],pt=(1<<26)/dt[dt.length-1];r.prototype.chunkSize=Z;r.prototype.toRadix=q;r.prototype.fromRadix=$;r.prototype.fromNumber=Q;r.prototype.bitwiseTo=ie;r.prototype.changeBit=Le;r.prototype.addTo=be;r.prototype.dMultiply=Ne;r.prototype.dAddOffset=ke;r.prototype.multiplyLowerTo=Ge;r.prototype.multiplyUpperTo=Ye;r.prototype.modInt=Ke;r.prototype.millerRabin=Qe;r.prototype.clone=U;r.prototype.intValue=J;r.prototype.byteValue=z;r.prototype.shortValue=W;r.prototype.signum=K;r.prototype.toByteArray=ee;r.prototype.equals=te;r.prototype.min=re;r.prototype.max=ne;r.prototype.and=oe;r.prototype.or=le;r.prototype.xor=de;r.prototype.andNot=he;r.prototype.not=ue;r.prototype.shiftLeft=fe;r.prototype.shiftRight=ge;r.prototype.getLowestSetBit=ve;r.prototype.bitCount=me;r.prototype.testBit=Ce;r.prototype.setBit=_e;r.prototype.clearBit=Pe;r.prototype.flipBit=Ae;r.prototype.add=Se;r.prototype.subtract=Ee;r.prototype.multiply=Oe;r.prototype.divide=Te;r.prototype.remainder=Re;r.prototype.divideAndRemainder=we;r.prototype.modPow=We;r.prototype.modInverse=qe;r.prototype.pow=Fe;r.prototype.gcd=Ze;r.prototype.isProbablePrime=$e;r.prototype.square=Ie;et.Math_Abs_Int64=et.Math_Abs_Int32=et.Math_Abs_Double=function(e){return Math.abs(e)};et.Math_Max_Int32_Int32=function(e,t){return Math.max(e,t)};it.msie||it.opera||it.safari?et.Cast_Int32=function(e){return 0|e}:et.Cast_Int32=function(e){return~~e};it.chrome?et.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):~~e}:it.firefox&&"function"==typeof Number.toInteger?et.Cast_Int64=function(e){return Number.toInteger(e)}:it.msie7||it.msie8?et.Cast_Int64=function(e){return parseInt(e,10)}:it.msie?et.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):0|e}:et.Cast_Int64=function(e){return e<0?Math.ceil(e):Math.floor(e)};et.Clear=function(e){e.length=0};et.MaxSteps=64;et.PI=3.141592653589793;et.PI2=6.283185307179586;et.IntPoint=function(){var e=arguments;if(1==e.length){this.x=e[0].x;this.y=e[0].y}if(2==e.length){this.x=e[0];this.y=e[1]}};et.IntRect=function(){var e=arguments;if(4==e.length){var t=e[0],r=e[1],n=e[2],i=e[3];this.left=t;this.top=r;this.right=n;this.bottom=i}else{this.left=0;this.top=0;this.right=0;this.bottom=0}};et.Polygon=function(){return[]};et.Polygons=function(){return[]};et.ExPolygons=function(){var e=[];e.exPolygons=!0;return e};et.ExPolygon=function(){this.outer=null;this.holes=null};et.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};et.PolyType={ptSubject:0,ptClip:1};et.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};et.JoinType={jtSquare:0,jtRound:1,jtMiter:2};et.EdgeSide={esLeft:1,esRight:2};et.Protects={ipNone:0,ipLeft:1,ipRight:2,ipBoth:3};et.Direction={dRightToLeft:0,dLeftToRight:1};et.TEdge=function(){this.xbot=0;this.ybot=0;this.xcurr=0;this.ycurr=0;this.xtop=0;this.ytop=0;this.dx=0;this.deltaX=0;this.deltaY=0;this.tmpX=0;this.polyType=et.PolyType.ptSubject;this.side=null;this.windDelta=0;this.windCnt=0;this.windCnt2=0;this.outIdx=0;this.next=null;this.prev=null;this.nextInLML=null;this.nextInAEL=null;this.prevInAEL=null;this.nextInSEL=null;this.prevInSEL=null};et.IntersectNode=function(){this.edge1=null;this.edge2=null;this.pt=null;this.next=null};et.LocalMinima=function(){this.y=0;this.leftBound=null;this.rightBound=null;this.next=null};et.Scanbeam=function(){this.y=0;this.next=null};et.OutRec=function(){this.idx=0;this.isHole=!1;this.FirstLeft=null;this.AppendLink=null;this.pts=null;this.bottomPt=null};et.OutPt=function(){this.idx=0;this.pt=null;this.next=null;this.prev=null};et.JoinRec=function(){this.pt1a=null;this.pt1b=null;this.poly1Idx=0;this.pt2a=null;this.pt2b=null;this.poly2Idx=0};et.HorzJoinRec=function(){this.edge=null;this.savedIdx=0};et.ClipperBase=function(){this.m_MinimaList=null;this.m_CurrentLM=null;this.m_edges=[[]];this.m_UseFullRange=!1};et.ClipperBase.horizontal=-9007199254740992;et.ClipperBase.loRange=47453132;et.ClipperBase.hiRange=0xfffffffffffff;et.ClipperBase.PointsEqual=function(e,t){return e.x==t.x&&e.y==t.y};et.ClipperBase.prototype.PointIsVertex=function(e,t){var r=t;do{if(et.ClipperBase.PointsEqual(r.pt,e))return!0;r=r.next}while(r!=t);return!1};et.ClipperBase.prototype.PointInPolygon=function(e,t,n){var i=t,a=!1;if(n)do{(i.pt.y<=e.y&&e.y<i.prev.pt.y||i.prev.pt.y<=e.y&&e.y<i.pt.y)&&new r(e.x-i.pt.x).compareTo(new r(i.prev.pt.x-i.pt.x).multiply(new r(e.y-i.pt.y)).divide(new r(i.prev.pt.y-i.pt.y)))<0&&(a=!a);i=i.next}while(i!=t);else do{(i.pt.y<=e.y&&e.y<i.prev.pt.y||i.prev.pt.y<=e.y&&e.y<i.pt.y)&&e.x-i.pt.x<(i.prev.pt.x-i.pt.x)*(e.y-i.pt.y)/(i.prev.pt.y-i.pt.y)&&(a=!a);i=i.next}while(i!=t);return a};et.ClipperBase.prototype.SlopesEqual=et.ClipperBase.SlopesEqual=function(){var e,t,n,i,a,o,s,l=arguments;if(3==l.length){e=l[0],t=l[1],s=l[2];return s?new r(e.deltaY).multiply(new r(t.deltaX)).toString()==new r(e.deltaX).multiply(new r(t.deltaY)).toString():e.deltaY*t.deltaX==e.deltaX*t.deltaY}if(4==l.length){n=l[0],i=l[1],a=l[2],s=l[3];return s?new r(n.y-i.y).multiply(new r(i.x-a.x)).toString()==new r(n.x-i.x).multiply(new r(i.y-a.y)).toString():(n.y-i.y)*(i.x-a.x)-(n.x-i.x)*(i.y-a.y)==0}if(5==l.length){n=l[0],i=l[1],a=l[2],o=l[3],s=l[4];return s?new r(n.y-i.y).multiply(new r(a.x-o.x)).toString()==new r(n.x-i.x).multiply(new r(a.y-o.y)).toString():(n.y-i.y)*(a.x-o.x)-(n.x-i.x)*(a.y-o.y)==0}};et.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var e=0;e<this.m_edges.length;++e){for(var t=0;t<this.m_edges[e].length;++t)this.m_edges[e][t]=null;et.Clear(this.m_edges[e])}et.Clear(this.m_edges);this.m_UseFullRange=!1};et.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!=this.m_MinimaList;){var e=this.m_MinimaList.next;this.m_MinimaList=null;this.m_MinimaList=e}this.m_CurrentLM=null};et.ClipperBase.prototype.AddPolygons=function(e,t){var r=!1,n=!1;if(!Array.isArray(e))return r;for(var i=0;i<e.length;++i){n=this.AddPolygon(e[i],t,!0);if(n&&"exceed"!=n)r=!0;else if("exceed"==n)break}"exceed"==n&&et.Error("Coordinate exceeds range bounds in AddPolygons().");return r};et.ClipperBase.prototype.AddPolygon=function(e,t,r){if(!Array.isArray(e))return!1;var n=e.length;if(n<3)return!1;var i=new et.Polygon;i.push(new et.IntPoint(e[0].x,e[0].y));var a,o=0,s=!1;for(a=1;a<n;++a){var l;l=this.m_UseFullRange?et.ClipperBase.hiRange:et.ClipperBase.loRange;if(et.Math_Abs_Int64(e[a].x)>l||et.Math_Abs_Int64(e[a].y)>l){if(et.Math_Abs_Int64(e[a].x)>et.ClipperBase.hiRange||et.Math_Abs_Int64(e[a].y)>et.ClipperBase.hiRange){if(void 0!==r)return"exceed";s=!0;break}l=et.ClipperBase.hiRange;this.m_UseFullRange=!0}if(!et.ClipperBase.PointsEqual(i[o],e[a])){o>0&&this.SlopesEqual(i[o-1],i[o],e[a],this.m_UseFullRange)?et.ClipperBase.PointsEqual(i[o-1],e[a])&&o--:o++;o<i.length?i[o]=e[a]:i.push(new et.IntPoint(e[a].x,e[a].y))}}s&&void 0===r&&et.Error("Coordinate exceeds range bounds in AddPolygon()");if(o<2)return!1;n=o+1;for(;n>2;){if(et.ClipperBase.PointsEqual(i[o],i[0]))o--;else if(et.ClipperBase.PointsEqual(i[0],i[1])||this.SlopesEqual(i[o],i[0],i[1],this.m_UseFullRange))i[0]=i[o--];else if(this.SlopesEqual(i[o-1],i[o],i[0],this.m_UseFullRange))o--;else{if(!this.SlopesEqual(i[0],i[1],i[2],this.m_UseFullRange))break;for(a=2;a<=o;++a)i[a-1]=i[a];o--}n--}if(n<3)return!1;var c=[];for(a=0;a<n;a++)c.push(new et.TEdge);this.m_edges.push(c);c[0].xcurr=i[0].x;c[0].ycurr=i[0].y;this.InitEdge(c[n-1],c[0],c[n-2],i[n-1],t);for(a=n-2;a>0;--a)this.InitEdge(c[a],c[a+1],c[a-1],i[a],t);this.InitEdge(c[0],c[1],c[n-1],i[0],t);var d=c[0],p=d;do{d.xcurr=d.xbot;d.ycurr=d.ybot;d.ytop<p.ytop&&(p=d);d=d.next}while(d!=c[0]);p.windDelta>0&&(p=p.next);p.dx==et.ClipperBase.horizontal&&(p=p.next);d=p;do{d=this.AddBoundsToLML(d)}while(d!=p);return!0};et.ClipperBase.prototype.InitEdge=function(e,t,r,n,i){e.next=t;e.prev=r;e.xcurr=n.x;e.ycurr=n.y;if(e.ycurr>=e.next.ycurr){e.xbot=e.xcurr;e.ybot=e.ycurr;e.xtop=e.next.xcurr;e.ytop=e.next.ycurr;e.windDelta=1}else{e.xtop=e.xcurr;e.ytop=e.ycurr;e.xbot=e.next.xcurr;e.ybot=e.next.ycurr;e.windDelta=-1}this.SetDx(e);e.polyType=i;e.outIdx=-1};et.ClipperBase.prototype.SetDx=function(e){e.deltaX=e.xtop-e.xbot;e.deltaY=e.ytop-e.ybot;0==e.deltaY?e.dx=et.ClipperBase.horizontal:e.dx=e.deltaX/e.deltaY};et.ClipperBase.prototype.AddBoundsToLML=function(e){e.nextInLML=null;e=e.next;for(;;){if(e.dx==et.ClipperBase.horizontal){if(e.next.ytop<e.ytop&&e.next.xbot>e.prev.xbot)break;e.xtop!=e.prev.xbot&&this.SwapX(e);e.nextInLML=e.prev}else{if(e.ycurr==e.prev.ycurr)break;e.nextInLML=e.prev}e=e.next}var t=new et.LocalMinima;t.next=null;t.y=e.prev.ybot;if(e.dx==et.ClipperBase.horizontal){e.xbot!=e.prev.xbot&&this.SwapX(e);t.leftBound=e.prev;t.rightBound=e}else if(e.dx<e.prev.dx){t.leftBound=e.prev;t.rightBound=e}else{t.leftBound=e;t.rightBound=e.prev}t.leftBound.side=et.EdgeSide.esLeft;t.rightBound.side=et.EdgeSide.esRight;this.InsertLocalMinima(t);for(;e.next.ytop!=e.ytop||e.next.dx==et.ClipperBase.horizontal;){e.nextInLML=e.next;e=e.next;e.dx==et.ClipperBase.horizontal&&e.xbot!=e.prev.xtop&&this.SwapX(e)}return e.next};et.ClipperBase.prototype.InsertLocalMinima=function(e){if(null==this.m_MinimaList)this.m_MinimaList=e;else if(e.y>=this.m_MinimaList.y){e.next=this.m_MinimaList;this.m_MinimaList=e}else{for(var t=this.m_MinimaList;null!=t.next&&e.y<t.next.y;)t=t.next;e.next=t.next;t.next=e}};et.ClipperBase.prototype.PopLocalMinima=function(){null!=this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.next)};et.ClipperBase.prototype.SwapX=function(e){e.xcurr=e.xtop;e.xtop=e.xbot;e.xbot=e.xcurr};et.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;for(var e=this.m_MinimaList;null!=e;){for(var t=e.leftBound;null!=t;){t.xcurr=t.xbot;t.ycurr=t.ybot;t.side=et.EdgeSide.esLeft;t.outIdx=-1;t=t.nextInLML}t=e.rightBound;for(;null!=t;){t.xcurr=t.xbot;t.ycurr=t.ybot;t.side=et.EdgeSide.esRight;t.outIdx=-1;t=t.nextInLML}e=e.next}};et.ClipperBase.prototype.GetBounds=function(){var e=new et.IntRect,t=this.m_MinimaList;if(null==t)return e;e.left=t.leftBound.xbot;e.top=t.leftBound.ybot;e.right=t.leftBound.xbot;e.bottom=t.leftBound.ybot;for(;null!=t;){t.leftBound.ybot>e.bottom&&(e.bottom=t.leftBound.ybot);for(var r=t.leftBound;;){for(var n=r;null!=r.nextInLML;){r.xbot<e.left&&(e.left=r.xbot);r.xbot>e.right&&(e.right=r.xbot);r=r.nextInLML}r.xbot<e.left&&(e.left=r.xbot);r.xbot>e.right&&(e.right=r.xbot);r.xtop<e.left&&(e.left=r.xtop);r.xtop>e.right&&(e.right=r.xtop);r.ytop<e.top&&(e.top=r.ytop);if(n!=t.leftBound)break;r=t.rightBound}t=t.next}return e};et.Clipper=function(){this.m_PolyOuts=null;this.m_ClipType=et.ClipType.ctIntersection;this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.m_IntersectNodes=null;this.m_ExecuteLocked=!1;this.m_ClipFillType=et.PolyFillType.pftEvenOdd;this.m_SubjFillType=et.PolyFillType.pftEvenOdd;this.m_Joins=null;this.m_HorizJoins=null;this.m_ReverseOutput=!1;this.m_UsingExPolygons=!1;et.ClipperBase.call(this);this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.m_IntersectNodes=null;this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_HorizJoins=[];this.m_ReverseOutput=!1;this.m_UsingExPolygons=!1};et.Clipper.prototype.Clear=function(){if(0!=this.m_edges.length){this.DisposeAllPolyPts();et.ClipperBase.prototype.Clear.call(this)}};et.Clipper.prototype.DisposeScanbeamList=function(){for(;null!=this.m_Scanbeam;){var e=this.m_Scanbeam.next;this.m_Scanbeam=null;this.m_Scanbeam=e}};et.Clipper.prototype.Reset=function(){et.ClipperBase.prototype.Reset.call(this);this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.DisposeAllPolyPts();for(var e=this.m_MinimaList;null!=e;){this.InsertScanbeam(e.y);this.InsertScanbeam(e.leftBound.ytop);e=e.next}};et.Clipper.prototype.get_ReverseSolution=function(){return this.m_ReverseOutput};et.Clipper.prototype.set_ReverseSolution=function(e){this.m_ReverseOutput=e};et.Clipper.prototype.InsertScanbeam=function(e){var t;if(null==this.m_Scanbeam){this.m_Scanbeam=new et.Scanbeam;this.m_Scanbeam.next=null;this.m_Scanbeam.y=e}else if(e>this.m_Scanbeam.y){t=new et.Scanbeam;t.y=e;t.next=this.m_Scanbeam;this.m_Scanbeam=t}else{for(var r=this.m_Scanbeam;null!=r.next&&e<=r.next.y;)r=r.next;if(e==r.y)return;t=new et.Scanbeam;t.y=e;t.next=r.next;r.next=t}};et.Clipper.prototype.Execute=function(e,t,r,n){var i;if(2==arguments.length){r=et.PolyFillType.pftEvenOdd;n=et.PolyFillType.pftEvenOdd}if(void 0===t.exPolygons){if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;et.Clear(t);this.m_SubjFillType=r;this.m_ClipFillType=n;this.m_ClipType=e;this.m_UsingExPolygons=!1;i=this.ExecuteInternal();i&&this.BuildResult(t);this.m_ExecuteLocked=!1;return i}if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;et.Clear(t);this.m_SubjFillType=r;this.m_ClipFillType=n;this.m_ClipType=e;this.m_UsingExPolygons=!0;i=this.ExecuteInternal();i&&this.BuildResultEx(t);this.m_ExecuteLocked=!1;return i};et.Clipper.prototype.PolySort=function(e,t){if(e==t)return 0;if(null==e.pts||null==t.pts)return null==e.pts!=(null==t.pts)?null==e.pts?1:-1:0;var r,n;r=e.isHole?e.FirstLeft.idx:e.idx;n=t.isHole?t.FirstLeft.idx:t.idx;var i=r-n;return 0==i&&e.isHole!=t.isHole?e.isHole?1:-1:i};et.Clipper.prototype.FindAppendLinkEnd=function(e){for(;null!=e.AppendLink;)e=e.AppendLink;return e};et.Clipper.prototype.FixHoleLinkage=function(e){var t;t=null!=e.bottomPt?this.m_PolyOuts[e.bottomPt.idx].FirstLeft:e.FirstLeft;e==t&&et.Error("HoleLinkage error");if(null!=t){null!=t.AppendLink&&(t=this.FindAppendLinkEnd(t));if(t==e)t=null;else if(t.isHole){this.FixHoleLinkage(t);t=t.FirstLeft}}e.FirstLeft=t;null==t&&(e.isHole=!1);e.AppendLink=null};et.Clipper.prototype.ExecuteInternal=function(){var e;try{this.Reset();if(null==this.m_CurrentLM)return!0;var t=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(t);et.Clear(this.m_HorizJoins);this.ProcessHorizontals();var r=this.PopScanbeam();e=this.ProcessIntersections(t,r);if(!e)break;this.ProcessEdgesAtTopOfScanbeam(r);t=r}while(null!=this.m_Scanbeam)}catch(t){e=!1}if(e){for(var n,i=0;i<this.m_PolyOuts.length;i++){n=this.m_PolyOuts[i];if(null!=n.pts){this.FixupOutPolygon(n);if(null!=n.pts){n.isHole&&this.m_UsingExPolygons&&this.FixHoleLinkage(n);(n.isHole^this.m_ReverseOutput)==this.Area(n,this.m_UseFullRange)>0&&this.ReversePolyPtLinks(n.pts)}}}this.JoinCommonEdges();this.m_UsingExPolygons&&this.m_PolyOuts.sort(this.PolySort)}et.Clear(this.m_Joins);et.Clear(this.m_HorizJoins);return e};et.Clipper.prototype.PopScanbeam=function(){var e=this.m_Scanbeam.y;this.m_Scanbeam;this.m_Scanbeam=this.m_Scanbeam.next;null;return e};et.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=0;e<this.m_PolyOuts.length;++e)this.DisposeOutRec(e);et.Clear(this.m_PolyOuts)};et.Clipper.prototype.DisposeOutRec=function(e){var t=this.m_PolyOuts[e];null!=t.pts&&this.DisposeOutPts(t.pts);t=null;this.m_PolyOuts[e]=null};et.Clipper.prototype.DisposeOutPts=function(e){if(null!=e){e.prev.next=null;for(;null!=e;){e;e=e.next;null}}};et.Clipper.prototype.AddJoin=function(e,t,r,n){var i=new et.JoinRec;i.poly1Idx=r>=0?r:e.outIdx;i.pt1a=new et.IntPoint(e.xcurr,e.ycurr);i.pt1b=new et.IntPoint(e.xtop,e.ytop);i.poly2Idx=n>=0?n:t.outIdx;i.pt2a=new et.IntPoint(t.xcurr,t.ycurr);i.pt2b=new et.IntPoint(t.xtop,t.ytop);this.m_Joins.push(i)};et.Clipper.prototype.AddHorzJoin=function(e,t){var r=new et.HorzJoinRec;r.edge=e;r.savedIdx=t;this.m_HorizJoins.push(r)};et.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){for(var t,r;null!=this.m_CurrentLM&&this.m_CurrentLM.y==e;){var n=this.m_CurrentLM.leftBound,i=this.m_CurrentLM.rightBound;this.InsertEdgeIntoAEL(n);this.InsertScanbeam(n.ytop);this.InsertEdgeIntoAEL(i);if(this.IsEvenOddFillType(n)){n.windDelta=1;i.windDelta=1}else i.windDelta=-n.windDelta;this.SetWindingCount(n);i.windCnt=n.windCnt;i.windCnt2=n.windCnt2;if(i.dx==et.ClipperBase.horizontal){this.AddEdgeToSEL(i);this.InsertScanbeam(i.nextInLML.ytop)}else this.InsertScanbeam(i.ytop);this.IsContributing(n)&&this.AddLocalMinPoly(n,i,new et.IntPoint(n.xcurr,this.m_CurrentLM.y));if(i.outIdx>=0&&i.dx==et.ClipperBase.horizontal)for(var a=0;a<this.m_HorizJoins.length;a++){t=new et.IntPoint,r=new et.IntPoint;var o=this.m_HorizJoins[a];(function(){t={Value:t};r={Value:r};var e=this.GetOverlapSegment(new et.IntPoint(o.edge.xbot,o.edge.ybot),new et.IntPoint(o.edge.xtop,o.edge.ytop),new et.IntPoint(i.xbot,i.ybot),new et.IntPoint(i.xtop,i.ytop),t,r);t=t.Value;r=r.Value;return e}).call(this)&&this.AddJoin(o.edge,i,o.savedIdx,-1)}if(n.nextInAEL!=i){i.outIdx>=0&&i.prevInAEL.outIdx>=0&&this.SlopesEqual(i.prevInAEL,i,this.m_UseFullRange)&&this.AddJoin(i,i.prevInAEL,-1,-1);var s=n.nextInAEL;t=new et.IntPoint(n.xcurr,n.ycurr);for(;s!=i;){null==s&&et.Error("InsertLocalMinimaIntoAEL: missing rightbound!");this.IntersectEdges(i,s,t,et.Protects.ipNone);s=s.nextInAEL}}this.PopLocalMinima()}};et.Clipper.prototype.InsertEdgeIntoAEL=function(e){e.prevInAEL=null;e.nextInAEL=null;if(null==this.m_ActiveEdges)this.m_ActiveEdges=e;else if(this.E2InsertsBeforeE1(this.m_ActiveEdges,e)){e.nextInAEL=this.m_ActiveEdges;this.m_ActiveEdges.prevInAEL=e;this.m_ActiveEdges=e}else{for(var t=this.m_ActiveEdges;null!=t.nextInAEL&&!this.E2InsertsBeforeE1(t.nextInAEL,e);)t=t.nextInAEL;e.nextInAEL=t.nextInAEL;null!=t.nextInAEL&&(t.nextInAEL.prevInAEL=e);e.prevInAEL=t;t.nextInAEL=e}};et.Clipper.prototype.E2InsertsBeforeE1=function(e,t){return t.xcurr==e.xcurr?t.dx>e.dx:t.xcurr<e.xcurr};et.Clipper.prototype.IsEvenOddFillType=function(e){return e.polyType==et.PolyType.ptSubject?this.m_SubjFillType==et.PolyFillType.pftEvenOdd:this.m_ClipFillType==et.PolyFillType.pftEvenOdd};et.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.polyType==et.PolyType.ptSubject?this.m_ClipFillType==et.PolyFillType.pftEvenOdd:this.m_SubjFillType==et.PolyFillType.pftEvenOdd};et.Clipper.prototype.IsContributing=function(e){var t,r;if(e.polyType==et.PolyType.ptSubject){t=this.m_SubjFillType;r=this.m_ClipFillType}else{t=this.m_ClipFillType;r=this.m_SubjFillType}switch(t){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:if(1!=et.Math_Abs_Int32(e.windCnt))return!1;break;case et.PolyFillType.pftPositive:if(1!=e.windCnt)return!1;break;default:if(-1!=e.windCnt)return!1}switch(this.m_ClipType){case et.ClipType.ctIntersection:switch(r){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:return 0!=e.windCnt2;case et.PolyFillType.pftPositive:return e.windCnt2>0;default:return e.windCnt2<0}break;case et.ClipType.ctUnion:switch(r){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:return 0==e.windCnt2;case et.PolyFillType.pftPositive:return e.windCnt2<=0;default:return e.windCnt2>=0}break;case et.ClipType.ctDifference:if(e.polyType==et.PolyType.ptSubject)switch(r){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:return 0==e.windCnt2;case et.PolyFillType.pftPositive:return e.windCnt2<=0;default:return e.windCnt2>=0}else switch(r){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:return 0!=e.windCnt2;case et.PolyFillType.pftPositive:return e.windCnt2>0;default:return e.windCnt2<0}}return!0};et.Clipper.prototype.SetWindingCount=function(e){for(var t=e.prevInAEL;null!=t&&t.polyType!=e.polyType;)t=t.prevInAEL;if(null==t){e.windCnt=e.windDelta;e.windCnt2=0;t=this.m_ActiveEdges}else if(this.IsEvenOddFillType(e)){e.windCnt=1;e.windCnt2=t.windCnt2;t=t.nextInAEL}else{t.windCnt*t.windDelta<0?et.Math_Abs_Int32(t.windCnt)>1?t.windDelta*e.windDelta<0?e.windCnt=t.windCnt:e.windCnt=t.windCnt+e.windDelta:e.windCnt=t.windCnt+t.windDelta+e.windDelta:et.Math_Abs_Int32(t.windCnt)>1&&t.windDelta*e.windDelta<0?e.windCnt=t.windCnt:t.windCnt+e.windDelta==0?e.windCnt=t.windCnt:e.windCnt=t.windCnt+e.windDelta;e.windCnt2=t.windCnt2;t=t.nextInAEL}if(this.IsEvenOddAltFillType(e))for(;t!=e;){e.windCnt2=0==e.windCnt2?1:0;t=t.nextInAEL}else for(;t!=e;){e.windCnt2+=t.windDelta;t=t.nextInAEL}};et.Clipper.prototype.AddEdgeToSEL=function(e){if(null==this.m_SortedEdges){this.m_SortedEdges=e;e.prevInSEL=null;e.nextInSEL=null}else{e.nextInSEL=this.m_SortedEdges;e.prevInSEL=null;this.m_SortedEdges.prevInSEL=e;this.m_SortedEdges=e}};et.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;this.m_SortedEdges=e;if(null!=this.m_ActiveEdges){this.m_SortedEdges.prevInSEL=null;e=e.nextInAEL;for(;null!=e;){e.prevInSEL=e.prevInAEL;e.prevInSEL.nextInSEL=e;e.nextInSEL=null;e=e.nextInAEL}}};et.Clipper.prototype.SwapPositionsInAEL=function(e,t){var r,n;if(!(null==e.nextInAEL&&null==e.prevInAEL||null==t.nextInAEL&&null==t.prevInAEL)){if(e.nextInAEL==t){r=t.nextInAEL;null!=r&&(r.prevInAEL=e);n=e.prevInAEL;null!=n&&(n.nextInAEL=t);t.prevInAEL=n;t.nextInAEL=e;e.prevInAEL=t;e.nextInAEL=r}else if(t.nextInAEL==e){r=e.nextInAEL;null!=r&&(r.prevInAEL=t);n=t.prevInAEL;null!=n&&(n.nextInAEL=e);e.prevInAEL=n;e.nextInAEL=t;t.prevInAEL=e;t.nextInAEL=r}else{r=e.nextInAEL;n=e.prevInAEL;e.nextInAEL=t.nextInAEL;null!=e.nextInAEL&&(e.nextInAEL.prevInAEL=e);e.prevInAEL=t.prevInAEL;null!=e.prevInAEL&&(e.prevInAEL.nextInAEL=e);t.nextInAEL=r;null!=t.nextInAEL&&(t.nextInAEL.prevInAEL=t);t.prevInAEL=n;null!=t.prevInAEL&&(t.prevInAEL.nextInAEL=t)}null==e.prevInAEL?this.m_ActiveEdges=e:null==t.prevInAEL&&(this.m_ActiveEdges=t)}};et.Clipper.prototype.SwapPositionsInSEL=function(e,t){var r,n;if(!(null==e.nextInSEL&&null==e.prevInSEL||null==t.nextInSEL&&null==t.prevInSEL)){if(e.nextInSEL==t){r=t.nextInSEL;null!=r&&(r.prevInSEL=e);n=e.prevInSEL;null!=n&&(n.nextInSEL=t);t.prevInSEL=n;t.nextInSEL=e;e.prevInSEL=t;e.nextInSEL=r}else if(t.nextInSEL==e){r=e.nextInSEL;null!=r&&(r.prevInSEL=t);n=t.prevInSEL;null!=n&&(n.nextInSEL=e);e.prevInSEL=n;e.nextInSEL=t;t.prevInSEL=e;t.nextInSEL=r}else{r=e.nextInSEL;n=e.prevInSEL;e.nextInSEL=t.nextInSEL;null!=e.nextInSEL&&(e.nextInSEL.prevInSEL=e);e.prevInSEL=t.prevInSEL;null!=e.prevInSEL&&(e.prevInSEL.nextInSEL=e);t.nextInSEL=r;null!=t.nextInSEL&&(t.nextInSEL.prevInSEL=t);t.prevInSEL=n;null!=t.prevInSEL&&(t.prevInSEL.nextInSEL=t)}null==e.prevInSEL?this.m_SortedEdges=e:null==t.prevInSEL&&(this.m_SortedEdges=t)}};et.Clipper.prototype.AddLocalMaxPoly=function(e,t,r){this.AddOutPt(e,r);if(e.outIdx==t.outIdx){e.outIdx=-1;t.outIdx=-1}else e.outIdx<t.outIdx?this.AppendPolygon(e,t):this.AppendPolygon(t,e)};et.Clipper.prototype.AddLocalMinPoly=function(e,t,r){var n,i;if(t.dx==et.ClipperBase.horizontal||e.dx>t.dx){this.AddOutPt(e,r);t.outIdx=e.outIdx;e.side=et.EdgeSide.esLeft;t.side=et.EdgeSide.esRight;n=e;i=n.prevInAEL==t?t.prevInAEL:n.prevInAEL}else{this.AddOutPt(t,r);e.outIdx=t.outIdx;e.side=et.EdgeSide.esRight;t.side=et.EdgeSide.esLeft;n=t;i=n.prevInAEL==e?e.prevInAEL:n.prevInAEL}null!=i&&i.outIdx>=0&&et.Clipper.TopX(i,r.y)==et.Clipper.TopX(n,r.y)&&this.SlopesEqual(n,i,this.m_UseFullRange)&&this.AddJoin(n,i,-1,-1)};et.Clipper.prototype.CreateOutRec=function(){var e=new et.OutRec;e.idx=-1;e.isHole=!1;e.FirstLeft=null;e.AppendLink=null;e.pts=null;e.bottomPt=null;return e};et.Clipper.prototype.AddOutPt=function(e,t){var r,n,i=e.side==et.EdgeSide.esLeft;if(e.outIdx<0){r=this.CreateOutRec();this.m_PolyOuts.push(r);r.idx=this.m_PolyOuts.length-1;e.outIdx=r.idx;n=new et.OutPt;r.pts=n;r.bottomPt=n;n.pt=t;n.idx=r.idx;n.next=n;n.prev=n;this.SetHoleState(e,r)}else{r=this.m_PolyOuts[e.outIdx];n=r.pts;var a;if(i&&et.ClipperBase.PointsEqual(t,n.pt)||!i&&et.ClipperBase.PointsEqual(t,n.prev.pt))return;a=new et.OutPt;a.pt=t;a.idx=r.idx;a.pt.y==r.bottomPt.pt.y&&a.pt.x<r.bottomPt.pt.x&&(r.bottomPt=a);a.next=n;a.prev=n.prev;a.prev.next=a;n.prev=a;i&&(r.pts=a)}};et.Clipper.prototype.SwapPoints=function(e,t){var r=e.Value;e.Value=t.Value;t.Value=r};et.Clipper.prototype.GetOverlapSegment=function(e,t,r,n,i,a){if(et.Math_Abs_Int64(e.x-t.x)>et.Math_Abs_Int64(e.y-t.y)){e.x>t.x&&function(){e={Value:e};t={Value:t};var r=this.SwapPoints(e,t);e=e.Value;t=t.Value;return r}.call(this);r.x>n.x&&function(){r={Value:r};n={Value:n};var e=this.SwapPoints(r,n);r=r.Value;n=n.Value;return e}.call(this);e.x>r.x?i.Value=e:i.Value=r;t.x<n.x?a.Value=t:a.Value=n;return i.Value.x<a.Value.x}e.y<t.y&&function(){e={Value:e};t={Value:t};var r=this.SwapPoints(e,t);e=e.Value;t=t.Value;return r}.call(this);r.y<n.y&&function(){r={Value:r};n={Value:n};var e=this.SwapPoints(r,n);r=r.Value;n=n.Value;return e}.call(this);e.y<r.y?i.Value=e:i.Value=r;t.y>n.y?a.Value=t:a.Value=n;return i.Value.y>a.Value.y};et.Clipper.prototype.FindSegment=function(e,t,r,n){if(null==e.Value)return!1;var i=e.Value,a=new et.IntPoint(r.Value),o=new et.IntPoint(n.Value);do{if(this.SlopesEqual(a,o,e.Value.pt,e.Value.prev.pt,t)&&this.SlopesEqual(a,o,e.Value.pt,t)&&this.GetOverlapSegment(a,o,e.Value.pt,e.Value.prev.pt,r,n))return!0;e.Value=e.Value.next}while(e.Value!=i);return!1};et.Clipper.prototype.Pt3IsBetweenPt1AndPt2=function(e,t,r){return!(!et.ClipperBase.PointsEqual(e,r)&&!et.ClipperBase.PointsEqual(t,r))||(e.x!=t.x?e.x<r.x==r.x<t.x:e.y<r.y==r.y<t.y)};et.Clipper.prototype.InsertPolyPtBetween=function(e,t,r){var n=new et.OutPt;n.pt=r;if(t==e.next){e.next=n;t.prev=n;n.next=t;n.prev=e}else{t.next=n;e.prev=n;n.next=e;n.prev=t}return n};et.Clipper.prototype.SetHoleState=function(e,t){for(var r=!1,n=e.prevInAEL;null!=n;){if(n.outIdx>=0){r=!r;null==t.FirstLeft&&(t.FirstLeft=this.m_PolyOuts[n.outIdx])}n=n.prevInAEL}r&&(t.isHole=!0)};et.Clipper.prototype.GetDx=function(e,t){return e.y==t.y?et.ClipperBase.horizontal:(t.x-e.x)/(t.y-e.y)};et.Clipper.prototype.FirstIsBottomPt=function(e,t){for(var r=e.prev;et.ClipperBase.PointsEqual(r.pt,e.pt)&&r!=e;)r=r.prev;var n=et.Math_Abs_Double(this.GetDx(e.pt,r.pt));r=e.next;for(;et.ClipperBase.PointsEqual(r.pt,e.pt)&&r!=e;)r=r.next;var i=et.Math_Abs_Double(this.GetDx(e.pt,r.pt));r=t.prev;for(;et.ClipperBase.PointsEqual(r.pt,t.pt)&&r!=t;)r=r.prev;var a=et.Math_Abs_Double(this.GetDx(t.pt,r.pt));r=t.next;for(;et.ClipperBase.PointsEqual(r.pt,t.pt)&&r!=t;)r=r.next;var o=et.Math_Abs_Double(this.GetDx(t.pt,r.pt));return n>=a&&n>=o||i>=a&&i>=o};et.Clipper.prototype.GetBottomPt=function(e){for(var t=null,r=e.next;r!=e;){if(r.pt.y>e.pt.y){e=r;t=null}else if(r.pt.y==e.pt.y&&r.pt.x<=e.pt.x)if(r.pt.x<e.pt.x){t=null;e=r}else r.next!=e&&r.prev!=e&&(t=r);r=r.next}if(null!=t)for(;t!=r;){this.FirstIsBottomPt(r,t)||(e=t);t=t.next;for(;!et.ClipperBase.PointsEqual(t.pt,e.pt);)t=t.next}return e};et.Clipper.prototype.GetLowermostRec=function(e,t){var r=e.bottomPt,n=t.bottomPt;return r.pt.y>n.pt.y?e:r.pt.y<n.pt.y?t:r.pt.x<n.pt.x?e:r.pt.x>n.pt.x?t:r.next==r?t:n.next==n?e:this.FirstIsBottomPt(r,n)?e:t};et.Clipper.prototype.Param1RightOfParam2=function(e,t){do{e=e.FirstLeft;if(e==t)return!0}while(null!=e);return!1};et.Clipper.prototype.AppendPolygon=function(e,t){var r,n=this.m_PolyOuts[e.outIdx],i=this.m_PolyOuts[t.outIdx];r=this.Param1RightOfParam2(n,i)?i:this.Param1RightOfParam2(i,n)?n:this.GetLowermostRec(n,i);var a,o,s=n.pts,l=s.prev,c=i.pts,d=c.prev;if(e.side==et.EdgeSide.esLeft){if(t.side==et.EdgeSide.esLeft){this.ReversePolyPtLinks(c);c.next=s;s.prev=c;l.next=d;d.prev=l;n.pts=d}else{d.next=s;s.prev=d;c.prev=l;l.next=c;n.pts=c}a=et.EdgeSide.esLeft}else{if(t.side==et.EdgeSide.esRight){this.ReversePolyPtLinks(c);l.next=d;d.prev=l;c.next=s;s.prev=c}else{l.next=c;c.prev=l;s.prev=d;d.next=s}a=et.EdgeSide.esRight}if(r==i){n.bottomPt=i.bottomPt;n.bottomPt.idx=n.idx;i.FirstLeft!=n&&(n.FirstLeft=i.FirstLeft);n.isHole=i.isHole}i.pts=null;i.bottomPt=null;i.AppendLink=n;var p=e.outIdx,h=t.outIdx;e.outIdx=-1;t.outIdx=-1;for(var u=this.m_ActiveEdges;null!=u;){if(u.outIdx==h){u.outIdx=p;u.side=a;break}u=u.nextInAEL}for(o=0;o<this.m_Joins.length;++o){this.m_Joins[o].poly1Idx==h&&(this.m_Joins[o].poly1Idx=p);this.m_Joins[o].poly2Idx==h&&(this.m_Joins[o].poly2Idx=p)}for(o=0;o<this.m_HorizJoins.length;++o)this.m_HorizJoins[o].savedIdx==h&&(this.m_HorizJoins[o].savedIdx=p)};et.Clipper.prototype.ReversePolyPtLinks=function(e){if(null!=e){var t,r;t=e;do{r=t.next;t.next=t.prev;t.prev=r;t=r}while(t!=e)}};et.Clipper.SwapSides=function(e,t){var r=e.side;e.side=t.side;t.side=r};et.Clipper.SwapPolyIndexes=function(e,t){var r=e.outIdx;e.outIdx=t.outIdx;t.outIdx=r};et.Clipper.prototype.DoEdge1=function(e,t,r){this.AddOutPt(e,r);et.Clipper.SwapSides(e,t);et.Clipper.SwapPolyIndexes(e,t)};et.Clipper.prototype.DoEdge2=function(e,t,r){this.AddOutPt(t,r);et.Clipper.SwapSides(e,t);et.Clipper.SwapPolyIndexes(e,t)};et.Clipper.prototype.DoBothEdges=function(e,t,r){this.AddOutPt(e,r);this.AddOutPt(t,r);et.Clipper.SwapSides(e,t);et.Clipper.SwapPolyIndexes(e,t)};et.Clipper.prototype.IntersectEdges=function(e,t,r,n){var i=0==(et.Protects.ipLeft&n)&&null==e.nextInLML&&e.xtop==r.x&&e.ytop==r.y,a=0==(et.Protects.ipRight&n)&&null==t.nextInLML&&t.xtop==r.x&&t.ytop==r.y,o=e.outIdx>=0,s=t.outIdx>=0;if(e.polyType==t.polyType)if(this.IsEvenOddFillType(e)){var l=e.windCnt;e.windCnt=t.windCnt;t.windCnt=l}else{e.windCnt+t.windDelta==0?e.windCnt=-e.windCnt:e.windCnt+=t.windDelta;t.windCnt-e.windDelta==0?t.windCnt=-t.windCnt:t.windCnt-=e.windDelta}else{this.IsEvenOddFillType(t)?e.windCnt2=0==e.windCnt2?1:0:e.windCnt2+=t.windDelta;this.IsEvenOddFillType(e)?t.windCnt2=0==t.windCnt2?1:0:t.windCnt2-=e.windDelta}var c,d,p,h;if(e.polyType==et.PolyType.ptSubject){c=this.m_SubjFillType;p=this.m_ClipFillType}else{c=this.m_ClipFillType;p=this.m_SubjFillType}if(t.polyType==et.PolyType.ptSubject){d=this.m_SubjFillType;h=this.m_ClipFillType}else{d=this.m_ClipFillType;h=this.m_SubjFillType}var u,f;switch(c){case et.PolyFillType.pftPositive:u=e.windCnt;break;case et.PolyFillType.pftNegative:u=-e.windCnt;break;default:u=et.Math_Abs_Int32(e.windCnt)}switch(d){case et.PolyFillType.pftPositive:f=t.windCnt;break;case et.PolyFillType.pftNegative:f=-t.windCnt;break;default:f=et.Math_Abs_Int32(t.windCnt)}if(o&&s)i||a||0!=u&&1!=u||0!=f&&1!=f||e.polyType!=t.polyType&&this.m_ClipType!=et.ClipType.ctXor?this.AddLocalMaxPoly(e,t,r):this.DoBothEdges(e,t,r);else if(o)0!=f&&1!=f||this.m_ClipType==et.ClipType.ctIntersection&&t.polyType!=et.PolyType.ptSubject&&0==t.windCnt2||this.DoEdge1(e,t,r);else if(s)0!=u&&1!=u||this.m_ClipType==et.ClipType.ctIntersection&&e.polyType!=et.PolyType.ptSubject&&0==e.windCnt2||this.DoEdge2(e,t,r);else if(!(0!=u&&1!=u||0!=f&&1!=f||i||a)){var g,y;switch(p){case et.PolyFillType.pftPositive:g=e.windCnt2;break;case et.PolyFillType.pftNegative:g=-e.windCnt2;break;default:g=et.Math_Abs_Int32(e.windCnt2)}switch(h){case et.PolyFillType.pftPositive:y=t.windCnt2;break;case et.PolyFillType.pftNegative:y=-t.windCnt2;break;default:y=et.Math_Abs_Int32(t.windCnt2)}if(e.polyType!=t.polyType)this.AddLocalMinPoly(e,t,r);else if(1==u&&1==f)switch(this.m_ClipType){case et.ClipType.ctIntersection:g>0&&y>0&&this.AddLocalMinPoly(e,t,r);break;case et.ClipType.ctUnion:g<=0&&y<=0&&this.AddLocalMinPoly(e,t,r);break;case et.ClipType.ctDifference:(e.polyType==et.PolyType.ptClip&&g>0&&y>0||e.polyType==et.PolyType.ptSubject&&g<=0&&y<=0)&&this.AddLocalMinPoly(e,t,r);break;case et.ClipType.ctXor:this.AddLocalMinPoly(e,t,r)}else et.Clipper.SwapSides(e,t)}if(i!=a&&(i&&e.outIdx>=0||a&&t.outIdx>=0)){et.Clipper.SwapSides(e,t);et.Clipper.SwapPolyIndexes(e,t)}i&&this.DeleteFromAEL(e);a&&this.DeleteFromAEL(t)};et.Clipper.prototype.DeleteFromAEL=function(e){var t=e.prevInAEL,r=e.nextInAEL;if(null!=t||null!=r||e==this.m_ActiveEdges){
null!=t?t.nextInAEL=r:this.m_ActiveEdges=r;null!=r&&(r.prevInAEL=t);e.nextInAEL=null;e.prevInAEL=null}};et.Clipper.prototype.DeleteFromSEL=function(e){var t=e.prevInSEL,r=e.nextInSEL;if(null!=t||null!=r||e==this.m_SortedEdges){null!=t?t.nextInSEL=r:this.m_SortedEdges=r;null!=r&&(r.prevInSEL=t);e.nextInSEL=null;e.prevInSEL=null}};et.Clipper.prototype.UpdateEdgeIntoAEL=function(e){null==e.Value.nextInLML&&et.Error("UpdateEdgeIntoAEL: invalid call");var t=e.Value.prevInAEL,r=e.Value.nextInAEL;e.Value.nextInLML.outIdx=e.Value.outIdx;null!=t?t.nextInAEL=e.Value.nextInLML:this.m_ActiveEdges=e.Value.nextInLML;null!=r&&(r.prevInAEL=e.Value.nextInLML);e.Value.nextInLML.side=e.Value.side;e.Value.nextInLML.windDelta=e.Value.windDelta;e.Value.nextInLML.windCnt=e.Value.windCnt;e.Value.nextInLML.windCnt2=e.Value.windCnt2;e.Value=e.Value.nextInLML;e.Value.prevInAEL=t;e.Value.nextInAEL=r;e.Value.dx!=et.ClipperBase.horizontal&&this.InsertScanbeam(e.Value.ytop)};et.Clipper.prototype.ProcessHorizontals=function(){for(var e=this.m_SortedEdges;null!=e;){this.DeleteFromSEL(e);this.ProcessHorizontal(e);e=this.m_SortedEdges}};et.Clipper.prototype.ProcessHorizontal=function(e){var t,r,n;if(e.xcurr<e.xtop){r=e.xcurr;n=e.xtop;t=et.Direction.dLeftToRight}else{r=e.xtop;n=e.xcurr;t=et.Direction.dRightToLeft}var i;i=null!=e.nextInLML?null:this.GetMaximaPair(e);for(var a=this.GetNextInAEL(e,t);null!=a;){var o=this.GetNextInAEL(a,t);if(null!=i||t==et.Direction.dLeftToRight&&a.xcurr<=n||t==et.Direction.dRightToLeft&&a.xcurr>=r){if(a.xcurr==e.xtop&&null==i){if(this.SlopesEqual(a,e.nextInLML,this.m_UseFullRange)){e.outIdx>=0&&a.outIdx>=0&&this.AddJoin(e.nextInLML,a,e.outIdx,-1);break}if(a.dx<e.nextInLML.dx)break}if(a==i){t==et.Direction.dLeftToRight?this.IntersectEdges(e,a,new et.IntPoint(a.xcurr,e.ycurr),0):this.IntersectEdges(a,e,new et.IntPoint(a.xcurr,e.ycurr),0);i.outIdx>=0&&et.Error("ProcessHorizontal error");return}a.dx!=et.ClipperBase.horizontal||this.IsMinima(a)||(a.xcurr,a.xtop),t==et.Direction.dLeftToRight?this.IntersectEdges(e,a,new et.IntPoint(a.xcurr,e.ycurr),this.IsTopHorz(e,a.xcurr)?et.Protects.ipLeft:et.Protects.ipBoth):this.IntersectEdges(a,e,new et.IntPoint(a.xcurr,e.ycurr),this.IsTopHorz(e,a.xcurr)?et.Protects.ipRight:et.Protects.ipBoth);this.SwapPositionsInAEL(e,a)}else if(t==et.Direction.dLeftToRight&&a.xcurr>n&&null==e.nextInSEL||t==et.Direction.dRightToLeft&&a.xcurr<r&&null==e.nextInSEL)break;a=o}if(null!=e.nextInLML){e.outIdx>=0&&this.AddOutPt(e,new et.IntPoint(e.xtop,e.ytop));(function(){e={Value:e};var t=this.UpdateEdgeIntoAEL(e);e=e.Value;return t}).call(this)}else{e.outIdx>=0&&this.IntersectEdges(e,i,new et.IntPoint(e.xtop,e.ycurr),et.Protects.ipBoth);this.DeleteFromAEL(i);this.DeleteFromAEL(e)}};et.Clipper.prototype.IsTopHorz=function(e,t){for(var r=this.m_SortedEdges;null!=r;){if(t>=Math.min(r.xcurr,r.xtop)&&t<=Math.max(r.xcurr,r.xtop))return!1;r=r.nextInSEL}return!0};et.Clipper.prototype.GetNextInAEL=function(e,t){return t==et.Direction.dLeftToRight?e.nextInAEL:e.prevInAEL};et.Clipper.prototype.IsMinima=function(e){return null!=e&&e.prev.nextInLML!=e&&e.next.nextInLML!=e};et.Clipper.prototype.IsMaxima=function(e,t){return null!=e&&e.ytop==t&&null==e.nextInLML};et.Clipper.prototype.IsIntermediate=function(e,t){return e.ytop==t&&null!=e.nextInLML};et.Clipper.prototype.GetMaximaPair=function(e){return this.IsMaxima(e.next,e.ytop)&&e.next.xtop==e.xtop?e.next:e.prev};et.Clipper.prototype.ProcessIntersections=function(e,t){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(e,t);if(null==this.m_IntersectNodes)return!0;if(!this.FixupIntersections())return!1;this.ProcessIntersectList()}catch(e){this.m_SortedEdges=null;this.DisposeIntersectNodes();et.Error("ProcessIntersections error")}return!0};et.Clipper.prototype.BuildIntersectList=function(e,t){if(null!=this.m_ActiveEdges){var r=this.m_ActiveEdges;r.tmpX=et.Clipper.TopX(r,t);this.m_SortedEdges=r;this.m_SortedEdges.prevInSEL=null;r=r.nextInAEL;for(;null!=r;){r.prevInSEL=r.prevInAEL;r.prevInSEL.nextInSEL=r;r.nextInSEL=null;r.tmpX=et.Clipper.TopX(r,t);r=r.nextInAEL}for(var n=!0;n&&null!=this.m_SortedEdges;){n=!1;r=this.m_SortedEdges;for(;null!=r.nextInSEL;){var i=r.nextInSEL,a=new et.IntPoint;if(r.tmpX>i.tmpX&&function(){a={Value:a};var e=this.IntersectPoint(r,i,a);a=a.Value;return e}.call(this)){if(a.y>e){a.y=e;a.x=et.Clipper.TopX(r,a.y)}this.AddIntersectNode(r,i,a);this.SwapPositionsInSEL(r,i);n=!0}else r=i}if(null==r.prevInSEL)break;r.prevInSEL.nextInSEL=null}this.m_SortedEdges=null}};et.Clipper.prototype.FixupIntersections=function(){if(null==this.m_IntersectNodes.next)return!0;this.CopyAELToSEL();for(var e=this.m_IntersectNodes,t=this.m_IntersectNodes.next;null!=t;){var r,n=e.edge1;if(n.prevInSEL==e.edge2)r=n.prevInSEL;else if(n.nextInSEL==e.edge2)r=n.nextInSEL;else{for(;null!=t&&t.edge1.nextInSEL!=t.edge2&&t.edge1.prevInSEL!=t.edge2;)t=t.next;if(null==t)return!1;this.SwapIntersectNodes(e,t);n=e.edge1;r=e.edge2}this.SwapPositionsInSEL(n,r);e=e.next;t=e.next}this.m_SortedEdges=null;return e.edge1.prevInSEL==e.edge2||e.edge1.nextInSEL==e.edge2};et.Clipper.prototype.ProcessIntersectList=function(){for(;null!=this.m_IntersectNodes;){var e=this.m_IntersectNodes.next;this.IntersectEdges(this.m_IntersectNodes.edge1,this.m_IntersectNodes.edge2,this.m_IntersectNodes.pt,et.Protects.ipBoth);this.SwapPositionsInAEL(this.m_IntersectNodes.edge1,this.m_IntersectNodes.edge2);this.m_IntersectNodes=null;this.m_IntersectNodes=e}};var ht=function(e){return e<0?Math.ceil(e-.5):Math.round(e)},ut=function(e){return e<0?Math.ceil(e-.5):Math.floor(e+.5)},ft=function(e){return e<0?-Math.round(Math.abs(e)):Math.round(e)},gt=function(e){if(e<0){e-=.5;return e<-2147483648?Math.ceil(e):0|e}e+=.5;return e>2147483647?Math.floor(e):0|e};it.msie?et.Clipper.Round=ht:it.chromium?et.Clipper.Round=ft:it.safari?et.Clipper.Round=gt:et.Clipper.Round=ut;et.Clipper.TopX=function(e,t){return t==e.ytop?e.xtop:e.xbot+et.Clipper.Round(e.dx*(t-e.ybot))};et.Clipper.prototype.AddIntersectNode=function(e,t,r){var n=new et.IntersectNode;n.edge1=e;n.edge2=t;n.pt=r;n.next=null;if(null==this.m_IntersectNodes)this.m_IntersectNodes=n;else if(this.ProcessParam1BeforeParam2(n,this.m_IntersectNodes)){n.next=this.m_IntersectNodes;this.m_IntersectNodes=n}else{for(var i=this.m_IntersectNodes;null!=i.next&&this.ProcessParam1BeforeParam2(i.next,n);)i=i.next;n.next=i.next;i.next=n}};et.Clipper.prototype.ProcessParam1BeforeParam2=function(e,t){var r;if(e.pt.y==t.pt.y){if(e.edge1==t.edge1||e.edge2==t.edge1){r=t.pt.x>e.pt.x;return t.edge1.dx>0?!r:r}if(e.edge1==t.edge2||e.edge2==t.edge2){r=t.pt.x>e.pt.x;return t.edge2.dx>0?!r:r}return t.pt.x>e.pt.x}return e.pt.y>t.pt.y};et.Clipper.prototype.SwapIntersectNodes=function(e,t){var r=e.edge1,n=e.edge2,i=e.pt;e.edge1=t.edge1;e.edge2=t.edge2;e.pt=t.pt;t.edge1=r;t.edge2=n;t.pt=i};et.Clipper.prototype.IntersectPoint=function(e,t,r){var n,i;if(this.SlopesEqual(e,t,this.m_UseFullRange))return!1;if(0==e.dx){r.Value.x=e.xbot;if(t.dx==et.ClipperBase.horizontal)r.Value.y=t.ybot;else{i=t.ybot-t.xbot/t.dx;r.Value.y=et.Clipper.Round(r.Value.x/t.dx+i)}}else if(0==t.dx){r.Value.x=t.xbot;if(e.dx==et.ClipperBase.horizontal)r.Value.y=e.ybot;else{n=e.ybot-e.xbot/e.dx;r.Value.y=et.Clipper.Round(r.Value.x/e.dx+n)}}else{n=e.xbot-e.ybot*e.dx;i=t.xbot-t.ybot*t.dx;var a=(i-n)/(e.dx-t.dx);r.Value.y=et.Clipper.Round(a);et.Math_Abs_Double(e.dx)<et.Math_Abs_Double(t.dx)?r.Value.x=et.Clipper.Round(e.dx*a+n):r.Value.x=et.Clipper.Round(t.dx*a+i)}if(r.Value.y<e.ytop||r.Value.y<t.ytop){if(e.ytop>t.ytop){r.Value.x=e.xtop;r.Value.y=e.ytop;return et.Clipper.TopX(t,e.ytop)<e.xtop}r.Value.x=t.xtop;r.Value.y=t.ytop;return et.Clipper.TopX(e,t.ytop)>t.xtop}return!0};et.Clipper.prototype.DisposeIntersectNodes=function(){for(;null!=this.m_IntersectNodes;){var e=this.m_IntersectNodes.next;this.m_IntersectNodes=null;this.m_IntersectNodes=e}};et.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){for(var t,r=this.m_ActiveEdges;null!=r;)if(this.IsMaxima(r,e)&&this.GetMaximaPair(r).dx!=et.ClipperBase.horizontal){t=r.prevInAEL;this.DoMaxima(r,e);r=null==t?this.m_ActiveEdges:t.nextInAEL}else{if(this.IsIntermediate(r,e)&&r.nextInLML.dx==et.ClipperBase.horizontal){if(r.outIdx>=0){this.AddOutPt(r,new et.IntPoint(r.xtop,r.ytop));for(var n=0;n<this.m_HorizJoins.length;++n){var i=new et.IntPoint,a=new et.IntPoint,o=this.m_HorizJoins[n];(function(){i={Value:i};a={Value:a};var e=this.GetOverlapSegment(new et.IntPoint(o.edge.xbot,o.edge.ybot),new et.IntPoint(o.edge.xtop,o.edge.ytop),new et.IntPoint(r.nextInLML.xbot,r.nextInLML.ybot),new et.IntPoint(r.nextInLML.xtop,r.nextInLML.ytop),i,a);i=i.Value;a=a.Value;return e}).call(this)&&this.AddJoin(o.edge,r.nextInLML,o.savedIdx,r.outIdx)}this.AddHorzJoin(r.nextInLML,r.outIdx)}(function(){r={Value:r};var e=this.UpdateEdgeIntoAEL(r);r=r.Value;return e}).call(this);this.AddEdgeToSEL(r)}else{r.xcurr=et.Clipper.TopX(r,e);r.ycurr=e}r=r.nextInAEL}this.ProcessHorizontals();r=this.m_ActiveEdges;for(;null!=r;){if(this.IsIntermediate(r,e)){r.outIdx>=0&&this.AddOutPt(r,new et.IntPoint(r.xtop,r.ytop));(function(){r={Value:r};var e=this.UpdateEdgeIntoAEL(r);r=r.Value;return e}).call(this);t=r.prevInAEL;var s=r.nextInAEL;if(null!=t&&t.xcurr==r.xbot&&t.ycurr==r.ybot&&r.outIdx>=0&&t.outIdx>=0&&t.ycurr>t.ytop&&this.SlopesEqual(r,t,this.m_UseFullRange)){this.AddOutPt(t,new et.IntPoint(r.xbot,r.ybot));this.AddJoin(r,t,-1,-1)}else if(null!=s&&s.xcurr==r.xbot&&s.ycurr==r.ybot&&r.outIdx>=0&&s.outIdx>=0&&s.ycurr>s.ytop&&this.SlopesEqual(r,s,this.m_UseFullRange)){this.AddOutPt(s,new et.IntPoint(r.xbot,r.ybot));this.AddJoin(r,s,-1,-1)}}r=r.nextInAEL}};et.Clipper.prototype.DoMaxima=function(e,t){for(var r=this.GetMaximaPair(e),n=e.xtop,i=e.nextInAEL;i!=r;){null==i&&et.Error("DoMaxima error");this.IntersectEdges(e,i,new et.IntPoint(n,t),et.Protects.ipBoth);i=i.nextInAEL}if(e.outIdx<0&&r.outIdx<0){this.DeleteFromAEL(e);this.DeleteFromAEL(r)}else e.outIdx>=0&&r.outIdx>=0?this.IntersectEdges(e,r,new et.IntPoint(n,t),et.Protects.ipNone):et.Error("DoMaxima error")};et.Clipper.ReversePolygons=function(e){for(var t=e.length,r=0;r<t;r++)Array.isArray(e[r])&&e[r].reverse()};et.Clipper.Orientation=function(e){return this.Area(e)>=0};et.Clipper.prototype.PointCount=function(e){if(null==e)return 0;var t=0,r=e;do{t++;r=r.next}while(r!=e);return t};et.Clipper.prototype.BuildResult=function(e){et.Clear(e);for(var t,r=this.m_PolyOuts.length,n=0;n<r;n++){t=this.m_PolyOuts[n];if(null!=t.pts){var i=t.pts,a=this.PointCount(i);if(!(a<3)){for(var o=new et.Polygon(a),s=0;s<a;s++){o.push(new et.IntPoint(i.pt.x,i.pt.y));i=i.prev}e.push(o)}}}};et.Clipper.prototype.BuildResultEx=function(e){et.Clear(e);for(var t=0;t<this.m_PolyOuts.length;){var r=this.m_PolyOuts[t++];if(null==r.pts)break;var n=r.pts,i=this.PointCount(n);if(!(i<3)){var a=new et.ExPolygon;a.outer=new et.Polygon;a.holes=new et.Polygons;for(var o=0;o<i;o++){a.outer.push(new et.IntPoint(n.pt.x,n.pt.y));n=n.prev}for(;t<this.m_PolyOuts.length;){r=this.m_PolyOuts[t];if(null==r.pts||!r.isHole)break;var s=new et.Polygon;n=r.pts;do{s.push(new et.IntPoint(n.pt.x,n.pt.y));n=n.prev}while(n!=r.pts);a.holes.push(s);t++}e.push(a)}}};et.Clipper.prototype.FixupOutPolygon=function(e){var t=null;e.pts=e.bottomPt;for(var r=e.bottomPt;;){if(r.prev==r||r.prev==r.next){this.DisposeOutPts(r);e.pts=null;e.bottomPt=null;return}if(et.ClipperBase.PointsEqual(r.pt,r.next.pt)||this.SlopesEqual(r.prev.pt,r.pt,r.next.pt,this.m_UseFullRange)){t=null;r==e.bottomPt&&(e.bottomPt=null);r.prev.next=r.next;r.next.prev=r.prev;r=r.prev;null}else{if(r==t)break;null==t&&(t=r);r=r.next}}if(null==e.bottomPt){e.bottomPt=this.GetBottomPt(r);e.bottomPt.idx=e.idx;e.pts=e.bottomPt}};et.Clipper.prototype.JoinPoints=function(e,t,r){t.Value=null;r.Value=null;var n=this.m_PolyOuts[e.poly1Idx],i=this.m_PolyOuts[e.poly2Idx];if(null==n||null==i)return!1;var a=n.pts,o=i.pts,s=e.pt2a,l=e.pt2b,c=e.pt1a,d=e.pt1b;if(!function(){a={Value:a};s={Value:s};l={Value:l};var e=this.FindSegment(a,this.m_UseFullRange,s,l);a=a.Value;s=s.Value;l=l.Value;return e}.call(this))return!1;if(n==i){o=a.next;if(!function(){o={Value:o};c={Value:c};d={Value:d};var e=this.FindSegment(o,this.m_UseFullRange,c,d);o=o.Value;c=c.Value;d=d.Value;return e}.call(this)||o==a)return!1}else if(!function(){o={Value:o};c={Value:c};d={Value:d};var e=this.FindSegment(o,this.m_UseFullRange,c,d);o=o.Value;c=c.Value;d=d.Value;return e}.call(this))return!1;if(!function(){s={Value:s};l={Value:l};var e=this.GetOverlapSegment(s.Value,l.Value,c,d,s,l);s=s.Value;l=l.Value;return e}.call(this))return!1;var p,h,u=a.prev;et.ClipperBase.PointsEqual(a.pt,s)?t.Value=a:et.ClipperBase.PointsEqual(u.pt,s)?t.Value=u:t.Value=this.InsertPolyPtBetween(a,u,s);et.ClipperBase.PointsEqual(a.pt,l)?r.Value=a:et.ClipperBase.PointsEqual(u.pt,l)?r.Value=u:t.Value==a||t.Value==u?r.Value=this.InsertPolyPtBetween(a,u,l):this.Pt3IsBetweenPt1AndPt2(a.pt,t.Value.pt,l)?r.Value=this.InsertPolyPtBetween(a,t.Value,l):r.Value=this.InsertPolyPtBetween(t.Value,u,l);u=o.prev;p=et.ClipperBase.PointsEqual(o.pt,s)?o:et.ClipperBase.PointsEqual(u.pt,s)?u:this.InsertPolyPtBetween(o,u,s);h=et.ClipperBase.PointsEqual(o.pt,l)?o:et.ClipperBase.PointsEqual(u.pt,l)?u:p==o||p==u?this.InsertPolyPtBetween(o,u,l):this.Pt3IsBetweenPt1AndPt2(o.pt,p.pt,l)?this.InsertPolyPtBetween(o,p,l):this.InsertPolyPtBetween(p,u,l);if(t.Value.next==r.Value&&p.prev==h){t.Value.next=p;p.prev=t.Value;r.Value.prev=h;h.next=r.Value;return!0}if(t.Value.prev==r.Value&&p.next==h){t.Value.prev=p;p.next=t.Value;r.Value.next=h;h.prev=r.Value;return!0}return!1};et.Clipper.prototype.FixupJoinRecs=function(e,t,r){for(var n=r;n<this.m_Joins.length;n++){var i=this.m_Joins[n];i.poly1Idx==e.poly1Idx&&this.PointIsVertex(i.pt1a,t)&&(i.poly1Idx=e.poly2Idx);i.poly2Idx==e.poly1Idx&&this.PointIsVertex(i.pt2a,t)&&(i.poly2Idx=e.poly2Idx)}};et.Clipper.prototype.JoinCommonEdges=function(){for(var e,t,r=0;r<this.m_Joins.length;r++){var n,i,a=this.m_Joins[r];if(function(){n={Value:n};i={Value:i};var e=this.JoinPoints(a,n,i);n=n.Value;i=i.Value;return e}.call(this)){var o=this.m_PolyOuts[a.poly1Idx],s=this.m_PolyOuts[a.poly2Idx];if(o==s){o.pts=this.GetBottomPt(n);o.bottomPt=o.pts;o.bottomPt.idx=o.idx;s=this.CreateOutRec();this.m_PolyOuts.push(s);s.idx=this.m_PolyOuts.length-1;a.poly2Idx=s.idx;s.pts=this.GetBottomPt(i);s.bottomPt=s.pts;s.bottomPt.idx=s.idx;if(this.PointInPolygon(s.pts.pt,o.pts,this.m_UseFullRange)){s.isHole=!o.isHole;s.FirstLeft=o;this.FixupJoinRecs(a,i,r+1);this.FixupOutPolygon(o);this.FixupOutPolygon(s);(s.isHole^this.m_ReverseOutput)==this.Area(s,this.m_UseFullRange)>0&&this.ReversePolyPtLinks(s.pts)}else if(this.PointInPolygon(o.pts.pt,s.pts,this.m_UseFullRange)){s.isHole=o.isHole;o.isHole=!s.isHole;s.FirstLeft=o.FirstLeft;o.FirstLeft=s;this.FixupJoinRecs(a,i,r+1);this.FixupOutPolygon(o);this.FixupOutPolygon(s);(o.isHole^this.m_ReverseOutput)==this.Area(o,this.m_UseFullRange)>0&&this.ReversePolyPtLinks(o.pts);if(this.m_UsingExPolygons&&o.isHole)for(e=0;e<this.m_PolyOuts.length;++e){t=this.m_PolyOuts[e];t.isHole&&null!=t.bottomPt&&t.FirstLeft==o&&(t.FirstLeft=s)}}else{s.isHole=o.isHole;s.FirstLeft=o.FirstLeft;this.FixupJoinRecs(a,i,r+1);this.FixupOutPolygon(o);this.FixupOutPolygon(s);if(this.m_UsingExPolygons&&null!=s.pts)for(e=0;e<this.m_PolyOuts.length;++e){t=this.m_PolyOuts[e];t.isHole&&null!=t.bottomPt&&t.FirstLeft==o&&this.PointInPolygon(t.bottomPt.pt,s.pts,this.m_UseFullRange)&&(t.FirstLeft=s)}}}else{if(this.m_UsingExPolygons)for(e=0;e<this.m_PolyOuts.length;++e)this.m_PolyOuts[e].isHole&&null!=this.m_PolyOuts[e].bottomPt&&this.m_PolyOuts[e].FirstLeft==s&&(this.m_PolyOuts[e].FirstLeft=o);this.FixupOutPolygon(o);if(null!=o.pts){o.isHole=this.Area(o,this.m_UseFullRange)<0;o.isHole&&null==o.FirstLeft&&(o.FirstLeft=s.FirstLeft)}var l=o.idx,c=s.idx;s.pts=null;s.bottomPt=null;s.AppendLink=o;for(e=r+1;e<this.m_Joins.length;e++){var d=this.m_Joins[e];d.poly1Idx==c&&(d.poly1Idx=l);d.poly2Idx==c&&(d.poly2Idx=l)}}}}};et.Clipper.FullRangeNeeded=function(e){for(var t=!1,r=0;r<e.length;r++)et.Math_Abs_Int64(e[r].x)>et.ClipperBase.hiRange||et.Math_Abs_Int64(e[r].y)>et.ClipperBase.hiRange?et.Error("Coordinate exceeds range bounds in FullRangeNeeded()."):(et.Math_Abs_Int64(e[r].x)>et.ClipperBase.loRange||et.Math_Abs_Int64(e[r].y)>et.ClipperBase.loRange)&&(t=!0);return t};et.Clipper.prototype.Area=et.Clipper.Area=function(){var e,t,n=arguments;if(1==n.length){var i=n[0],a=i.length-1;if(a<2)return 0;if(et.Clipper.FullRangeNeeded(i)){t=new r(i[a].x+i[0].x).multiply(new r(i[0].y-i[a].y));for(e=1;e<=a;++e)t=t.add(new r(i[e-1].x+i[e].x).multiply(new r(i[e].y-i[e-1].y)));return parseFloat(t.toString())/2}var o=(i[a].x+i[0].x)*(i[0].y-i[a].y);for(e=1;e<=a;++e)o+=(i[e-1].x+i[e].x)*(i[e].y-i[e-1].y);return o/2}if(2==n.length){var s=n[0],l=n[1],c=s.pts;if(null==c)return 0;if(l){t=new r(r.ZERO);do{t=t.add(new r(c.pt.x+c.prev.pt.x).multiply(new r(c.prev.pt.y-c.pt.y)));c=c.next}while(c!=s.pts);return parseFloat(t.toString())/2}t=0;do{t+=(c.pt.x+c.prev.pt.x)*(c.prev.pt.y-c.pt.y);c=c.next}while(c!=s.pts);return t/2}};et.Clipper.BuildArc=function(e,t,r,n){var i=Math.sqrt(et.Math_Abs_Double(n))*et.Math_Abs_Double(r-t);i/=4;i<6&&(i=6);i>64&&(i=et.MaxSteps);for(var a=et.Cast_Int32(i),o=new et.Polygon,s=(r-t)/(a-1),l=t,c=0;c<a;++c){o.push(new et.IntPoint(e.x+et.Clipper.Round(Math.cos(l)*n),e.y+et.Clipper.Round(Math.sin(l)*n)));l+=s}return o};et.Clipper.GetUnitNormal=function(e,t){var r=t.x-e.x,n=t.y-e.y;if(0==r&&0==n)return new et.Clipper.DoublePoint(0,0);var i=1/Math.sqrt(r*r+n*n);r*=i;n*=i;return new et.Clipper.DoublePoint(n,-r)};et.Clipper.prototype.OffsetPolygons=function(e,t,r,n,i){var a=arguments;if(4==a.length)i=!0;else if(3==a.length){n=2;i=!0}else if(2==a.length){r=et.JoinType.jtSquare;n=2;i=!0}isNaN(t)?et.Error("Delta is not a number"):isNaN(n)&&et.Error("MiterLimit is not a number");var o={};new et.Clipper.PolyOffsetBuilder(e,o,t,r,n,i);o=o.Value?o.Value:[[]];return o};et.Clipper.prototype.SimplifyPolygon=function(e,t){var r=new et.Polygons,n=new et.Clipper;n.AddPolygon(e,et.PolyType.ptSubject)&&n.Execute(et.ClipType.ctUnion,r,t,t);return r};et.Clipper.prototype.SimplifyPolygons=function(e,t){var r=new et.Polygons,n=new et.Clipper;n.AddPolygons(e,et.PolyType.ptSubject)&&n.Execute(et.ClipType.ctUnion,r,t,t);return r};var yt,vt=et.Clipper,xt=et.ClipperBase;if(void 0===Object.getOwnPropertyNames){for(yt in xt.prototype)void 0!==vt.prototype[yt]&&vt.prototype[yt]!=Object.prototype[yt]||(vt.prototype[yt]=xt.prototype[yt]);for(yt in xt)void 0===vt[yt]&&(vt[yt]=xt[yt]);vt.$baseCtor=xt}else{for(var mt=Object.getOwnPropertyNames(xt.prototype),Ct=0;Ct<mt.length;Ct++)void 0===Object.getOwnPropertyDescriptor(vt.prototype,mt[Ct])&&Object.defineProperty(vt.prototype,mt[Ct],Object.getOwnPropertyDescriptor(xt.prototype,mt[Ct]));for(yt in xt)void 0===vt[yt]&&(vt[yt]=xt[yt]);vt.$baseCtor=xt}et.Clipper.DoublePoint=function(e,t){this.x=e;this.y=t};et.Clipper.PolyOffsetBuilder=function(e,t,r,n,i,a){this.pts=null;this.currentPoly=null;this.normals=null;this.delta=0;this.m_R=0;this.m_i=0;this.m_j=0;this.m_k=0;this.botPt=null;if(0!=r){this.pts=e;this.delta=r;var o,s;if(a){for(var l=this.pts.length,c=0;c<l&&0==this.pts[c].length;)c++;if(c==l)return;this.botPt=this.pts[c][0];for(o=c;o<l;++o){this.UpdateBotPt(this.pts[o][0])&&(c=o);for(s=this.pts[o].length-1;s>0;s--)et.ClipperBase.PointsEqual(this.pts[o][s],this.pts[o][s-1])?this.pts[o].splice(s,1):this.UpdateBotPt(this.pts[o][s])&&(c=o)}et.Clipper.Orientation(this.pts[c])||et.Clipper.ReversePolygons(this.pts)}i<=1&&(i=1);var d=2/(i*i);this.normals=[];t.Value=new et.Polygons;var p;for(this.m_i=0;this.m_i<this.pts.length;this.m_i++){p=this.pts[this.m_i].length;p>1&&this.pts[this.m_i][0].x==this.pts[this.m_i][p-1].x&&this.pts[this.m_i][0].y==this.pts[this.m_i][p-1].y&&p--;if(!(0==p||p<3&&r<=0))if(1!=p){et.Clear(this.normals);for(s=0;s<p-1;++s)this.normals.push(et.Clipper.GetUnitNormal(this.pts[this.m_i][s],this.pts[this.m_i][s+1]));this.normals.push(et.Clipper.GetUnitNormal(this.pts[this.m_i][p-1],this.pts[this.m_i][0]));this.currentPoly=new et.Polygon;this.m_k=p-1;for(this.m_j=0;this.m_j<p;++this.m_j){switch(n){case et.JoinType.jtMiter:this.m_R=this.normals[this.m_j].x*this.normals[this.m_k].x+this.normals[this.m_j].y*this.normals[this.m_k].y+1;this.m_R>=d?this.DoMiter():this.DoSquare(i);break;case et.JoinType.jtRound:this.DoRound();break;case et.JoinType.jtSquare:this.DoSquare(1)}this.m_k=this.m_j}t.Value.push(this.currentPoly)}else{var h;h=et.Clipper.BuildArc(this.pts[this.m_i][p-1],0,et.PI2,r);t.Value.push(h)}}var u=new et.Clipper;u.AddPolygons(t.Value,et.PolyType.ptSubject);if(r>0)u.Execute(et.ClipType.ctUnion,t.Value,et.PolyFillType.pftPositive,et.PolyFillType.pftPositive);else{var f=u.GetBounds(),g=new et.Polygon;g.push(new et.IntPoint(f.left-10,f.bottom+10));g.push(new et.IntPoint(f.right+10,f.bottom+10));g.push(new et.IntPoint(f.right+10,f.top-10));g.push(new et.IntPoint(f.left-10,f.top-10));u.AddPolygon(g,et.PolyType.ptSubject);u.Execute(et.ClipType.ctUnion,t.Value,et.PolyFillType.pftNegative,et.PolyFillType.pftNegative);if(t.Value.length>0){t.Value.splice(0,1);for(o=0;o<t.Value.length;o++)t.Value[o].reverse()}}}else t.Value=e};et.Clipper.PolyOffsetBuilder.prototype.UpdateBotPt=function(e){if(e.y>this.botPt.y||e.y==this.botPt.y&&e.x<this.botPt.x){this.botPt=e;return!0}return!1};et.Clipper.PolyOffsetBuilder.prototype.AddPoint=function(e){this.currentPoly.push(e)};et.Clipper.PolyOffsetBuilder.prototype.DoSquare=function(e){var t=new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_k].x*this.delta)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_k].y*this.delta))),r=new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_j].x*this.delta)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_j].y*this.delta)));if((this.normals[this.m_k].x*this.normals[this.m_j].y-this.normals[this.m_j].x*this.normals[this.m_k].y)*this.delta>=0){var n=Math.atan2(this.normals[this.m_k].y,this.normals[this.m_k].x),i=Math.atan2(-this.normals[this.m_j].y,-this.normals[this.m_j].x);n=Math.abs(i-n);n>et.PI&&(n=et.PI2-n);var a=Math.tan((et.PI-n)/4)*Math.abs(this.delta*e);t=new et.IntPoint(et.Cast_Int64(t.x-this.normals[this.m_k].y*a),et.Cast_Int64(t.y+this.normals[this.m_k].x*a));this.AddPoint(t);r=new et.IntPoint(et.Cast_Int64(r.x+this.normals[this.m_j].y*a),et.Cast_Int64(r.y-this.normals[this.m_j].x*a));this.AddPoint(r)}else{this.AddPoint(t);this.AddPoint(this.pts[this.m_i][this.m_j]);this.AddPoint(r)}};et.Clipper.PolyOffsetBuilder.prototype.DoMiter=function(){if((this.normals[this.m_k].x*this.normals[this.m_j].y-this.normals[this.m_j].x*this.normals[this.m_k].y)*this.delta>=0){var e=this.delta/this.m_R;this.AddPoint(new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+(this.normals[this.m_k].x+this.normals[this.m_j].x)*e)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+(this.normals[this.m_k].y+this.normals[this.m_j].y)*e))))}else{var t=new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_k].x*this.delta)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_k].y*this.delta))),r=new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_j].x*this.delta)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_j].y*this.delta)));this.AddPoint(t);this.AddPoint(this.pts[this.m_i][this.m_j]);this.AddPoint(r)}};et.Clipper.PolyOffsetBuilder.prototype.DoRound=function(){var e=new et.IntPoint(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_k].x*this.delta),et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_k].y*this.delta)),t=new et.IntPoint(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_j].x*this.delta),et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_j].y*this.delta));this.AddPoint(e);if((this.normals[this.m_k].x*this.normals[this.m_j].y-this.normals[this.m_j].x*this.normals[this.m_k].y)*this.delta>=0){if(this.normals[this.m_j].x*this.normals[this.m_k].x+this.normals[this.m_j].y*this.normals[this.m_k].y<.985){var r=Math.atan2(this.normals[this.m_k].y,this.normals[this.m_k].x),n=Math.atan2(this.normals[this.m_j].y,this.normals[this.m_j].x);this.delta>0&&n<r?n+=et.PI2:this.delta<0&&n>r&&(n-=et.PI2);for(var i=et.Clipper.BuildArc(this.pts[this.m_i][this.m_j],r,n,this.delta),a=0;a<i.length;a++)this.AddPoint(i[a])}}else this.AddPoint(this.pts[this.m_i][this.m_j]);this.AddPoint(t)};et.Error=function(e){try{throw new Error(e)}catch(e){alert(e.message)}};et.Clone=function(e){if(!Array.isArray(e))return[];if(0==e.length)return[];if(1==e.length&&0==e[0].length)return[[]];var t=Array.isArray(e[0]);t||(e=[e]);var r,n,i,a,o=e.length,s=[];for(n=0;n<o;n++){r=e[n].length;a=[];for(i=0;i<r;i++)a.push({x:e[n][i].x,y:e[n][i].y});s.push(a)}t||(s=s[0]);return s};et.Clean=function(e,t){if(!Array.isArray(e))return[];var r=Array.isArray(e[0]),e=et.Clone(e);if("number"!=typeof t||null===t){et.Error("Delta is not a number in Clean().");return e}if(0==e.length||1==e.length&&0==e[0].length||t<0)return e;r||(e=[e]);for(var n,i,a,o,s,l,c,d=e.length,p=[],h=0;h<d;h++){i=e[h];n=i.length;if(0!=n)if(n<3){a=i;p.push(a)}else{a=i;o=t*t;s=i[0];l=1;for(c=1;c<n;c++)if(!((i[c].x-s.x)*(i[c].x-s.x)+(i[c].y-s.y)*(i[c].y-s.y)<=o)){a[l]=i[c];s=i[c];l++}s=i[l-1];(i[0].x-s.x)*(i[0].x-s.x)+(i[0].y-s.y)*(i[0].y-s.y)<=o&&l--;l<n&&a.splice(l,n-l);a.length&&p.push(a)}}!r&&p.length?p=p[0]:r||0!=p.length?r&&0==p.length&&(p=[[]]):p=[];return p};et.Lighten=function(e,t){if(!Array.isArray(e))return[];if("number"!=typeof t||null===t){et.Error("Tolerance is not a number in Lighten().");return et.Clone(e)}if(0===e.length||1==e.length&&0===e[0].length||t<0)return et.Clone(e);Array.isArray(e[0])||(e=[e]);var r,n,i,a,o,s,l,c,d,p,h,u,f,g,y,v=e.length,x=[];for(r=0;r<v;r++){i=e[r];for(a=0;a<1e6;a++){o=[];s=i.length;if(i[s-1].x!=i[0].x||i[s-1].y!=i[0].y){u=1;i.push({x:i[0].x,y:i[0].y});s=i.length}else u=0;h=[];for(n=0;n<s-2;n++){l=i[n];d=i[n+1];c=i[n+2];f=c.x-l.x;g=c.y-l.y;p=0;if(0!==f||0!==g){y=Math.sqrt(f*f+g*g);p=Math.abs((d.x-l.x)*g-(d.y-l.y)*f)/y}if(p<=t){h[n+1]=1;n++}}o.push({x:i[0].x,y:i[0].y});for(n=1;n<s-1;n++)h[n]||o.push({x:i[n].x,y:i[n].y});o.push({x:i[s-1].x,y:i[s-1].y});u&&i.pop();if(!h.length)break;i=o}s=o.length;o[s-1].x==o[0].x&&o[s-1].y==o[0].y&&o.pop();o.length>2&&x.push(o)}Array.isArray(e[0])||(x=x[0]);void 0===x&&(x=[[]]);return x};et.OffsetPoint=function(e,t){return et.OffsetPolyline([e],t)};et.OffsetPolyline=function(e,t,r){var n=new et.Polygon;e.forEach(function(e){n.push(e)});if(e.length>2)for(var i=e.length-2;i>0;i--)n.push(e[i]);return et.OffsetPolygon(n,t,r)};et.OffsetPolygon=function(e,t,r){var n=new et.Polygons;n.push(e);return(new et.Clipper).OffsetPolygons(n,t,void 0===r?et.JoinType.jtRound:r,100,!0)};et.BuildArc=et.Clipper.BuildArc}();GrowingPacker=function(){};GrowingPacker.prototype={fit:function(e){var t,r,n,i=e.length,a=i>0?e[0].w:0,o=i>0?e[0].h:0;this.root={x:0,y:0,w:a,h:o};for(t=0;t<i;t++){n=e[t];(r=this.findNode(this.root,n.w,n.h))?n.fit=this.splitNode(r,n.w,n.h):n.fit=this.growNode(n.w,n.h)}},findNode:function(e,t,r){return e.used?this.findNode(e.right,t,r)||this.findNode(e.down,t,r):t<=e.w&&r<=e.h?e:null},splitNode:function(e,t,r){e.used=!0;e.down={x:e.x,y:e.y+r,w:e.w,h:e.h-r};e.right={x:e.x+t,y:e.y,w:e.w-t,h:r};return e},growNode:function(e,t){var r=e<=this.root.w,n=t<=this.root.h,i=n&&this.root.h>=this.root.w+e,a=r&&this.root.w>=this.root.h+t;return i?this.growRight(e,t):a?this.growDown(e,t):n?this.growRight(e,t):r?this.growDown(e,t):null},growRight:function(e,t){this.root={used:!0,x:0,y:0,w:this.root.w+e,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:e,h:this.root.h}};return(node=this.findNode(this.root,e,t))?this.splitNode(node,e,t):null},growDown:function(e,t){this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+t,down:{x:0,y:this.root.h,w:this.root.w,h:t},right:this.root};return(node=this.findNode(this.root,e,t))?this.splitNode(node,e,t):null}};var Ka,qa="6.1.34",$a={0:0,90:1,180:0,270:-1},Qa={0:1,90:0,180:-1,270:0},eo=[1,10,100,1e3],to=function(){var e="http://www.w3.org/2000/svg",t="http://www.w3.org/1999/xlink",r="http://www.w3.org/XML/1998/namespace",n="https://easyeda.com/",i={svg:e,xlink:t,xml:r,c:n};i[e]="svg";i[t]="xlink";i[r]="xml";i[n]="c";return i}(),ro=0,no=2,io=function(){var e,t={TOPLAYER:1,BOTTOMLAYER:2,TOPSILKLAYER:3,BOTTOMSILKLAYER:4,TOPPASTERLAYER:5,BOTTOMPASTERLAYER:6,TOPSOLDERLAYER:7,BOTTOMSOLDERLAYER:8,RATLINES:9,BOARDOUTLINE:10,ALL:11,DOCUMENT:12,TOPASSEMBLY:13,BOTTOMASSEMBLY:14,MECHANICAL:15,TOPCOMPONENT:16,BOTTOMCOMPONENT:17,SUBSTRATE:18};for(e=21;e<53;e++)t["INNER"+(e-20)]=e;for(e=53;e<85;e++)t["BOARD"+(e-52)]=e;return t}(),ao={SCH:"1",SCHLIB:"2",PCB:"3",PCBLIB:"4",PRJ:"5",SUBPART:"6",SPICESYMBOL:"7",SUBCKT:"8",NETLIST:"9",WAVEFORM:"10",SCHLIB3D:"11",PHOTOVIEW:"12",SCHMODULE:"13",PCBMODULE:"14",VIEW3D:"15",PCBLIB3D:"16"},oo=function(){var e,t={};for(e in ao)t[ao[e]]=e;return t}(),so="~",lo={fixedDecimal:!1,decimalPlaces:2,decimalPlacesShow:2,schDecimalPlaces:2,schDecimalPlacesShow:2,pcbDecimalPlaces:4,pcbDecimalPlacesShow:3,pcbServersFonts:["NotoSerifCJKsc-Medium","NotoSansCJKjp-DemiLight"],pcbFontsRegExp:/[^!"\\#\$%&'`\(\)\*\+,\-\.\/a-zA-z0-9:<;\=\?>@\[\]\^_\{\|\}~°\s\t\r\n]/,checkNotificationInterval:12e4,checkUpdateInterval:36e5,saveFileTimeout:3e5,autoSaveMaxCount:1e3,autoSaveMaxBackupLevel:10,autoGzipAjaxPostSize:1e4,cooperationSites:["elektroda","amobbs","allaboutcircuits","diyaudio","hifidiy","edaboard"],cushionShape:null,cushionShapeFor:null,fileOperationAPI:"/EditorBridge/fileOperation",svgFileAPI:"/EditorBridge/svgFile",treeDataAPI:"/EditorBridge/treeData",anonymousPid:"441bd07389f646ac82c8d1dbc45a6021",version:"V"+qa,buildDate:"04/29/2019",lcscUUID:"0819f05c4eef4c71ace90d822a990e87",easyedaUUID:"4251c6ae97414f38bb1d929da02c4173",winWidth:e.innerWidth||t.documentElement.clientWidth,winHeight:e.innerHeight||t.documentElement.clientHeight,ignoreConfirmClose:!1,globalVariableCookieData:{},teams:[],networkWarn:"Network Error! Please check your network and try again!",updatePcbFileInfo:[],multiSelect:!1,copperNetRelation:{},isSaving:!1,pasteCount:0,pasteFrom:null,canvasStrTolerance:10,apis:{projects:{create:"/api/projects/add",my_projects:"/api/projects",common:"/api/users/0819f05c4eef4c71ace90d822a990e87/public_project",update:"/api/projects/{uuid}/update",share:"/api/projects/{uuid}/share",stick:"/api/projects/{uuid}/stick",cancelStick:"/api/projects/{uuid}/unstick",addVersion:"/api/projects/{uuid}/version",showVersion:"/api/projects/{uuid}/version",toggleVersion:"/api/projects/{uuid}/version/{newUuid}/change",sheetOrder:"api/projects/{uuid}/update_sort"},document:{create:"/api/documents/create",ajaxDetail:"/api/documents/{uuid}",schematics:"/api/projects/schematic",updateCanvas:"/api/documents/{uuid}/update_canvas",modify:"/api/documents/{uuid}/update",tag:"/api/histories/{uuid}",share:"/api/documents/{uuid}/share",duplicate:"/api/documents/{uuid}/copy",delete:"/api/documents/{uuid}/delete",simulation:"/api/documents/{uuid}/simulate",spiceNetlist:"/api/documents/{uuid}/spiceNetlist",simulatedSpice:"/api/documents/{uuid}/simulatedSpice",importThirdDocOrLibs:"/analyzer/api/convert/from/{from}/to/{to}",histories:"/api/documents/{uuid}/histories",datastrid:"/api/documents/{uuid}/datastrid"},components:{myComponents:"/api/user/component_tags",myModules:"/api/user/model_tags",ajaxLists:"/api/components",create:"/api/components/add",ajaxDetail:"/api/components/{uuid}",ajaxDetailByLcscId:"/api/products/{lcscid}/components",ajaxComponentInfo:"/api/components/componentInfo",updateCanvas:"/api/components/{uuid}/update_canvas",modify:"/api/components/{uuid}/update",delete:"/api/components/{uuid}/delete",
duplicate:"/api/components/{uuid}/copy",subpart:"/api/components/{uuid}/add_subpart",contribute:"/api/components/contribute",getSubckt:"/api/components/getSubckt",updateSubckt:"/api/components/updateSubckt",search:"/api/components/search",searchByIds:"/api/components/searchByIds",searchByIdAndPre:"/api/components/searchByIdAndPre",searchPCBAndModules:"/api/components/search/PCBAndModules",packageDetail:"/api/components/packages",tags:"/api/components/tags",uuid:"/api/packages/uuid",reportError:"/api/components/{uuid}/report"},others:{bugReport:"/api/client/bugs",userInfo:"/api/user",getLcscPrice:"/api/getPrices",buyComponentFromLcsc:"/api/v1/buy",addFavorite:"/api/components/{uuid}/star",checkPackagesAvaliable:"/api/packagesExists",pcbOperate:"/api/PCB/operate",teams:"/api/teams",startPage:"/api/page/editor-start-page",versionPage:"/api/page/editor-v",notification:"/api/notifications/unread-count",getVersion:"/version",getPackageNewestTitle:"/api/components/check-different",preference:"/api/user/preference",getPcbFabricationPrice:"/api/pcb_order/{uuid}/get_price",orderAtJLCPCB:"/api/pcb_order/{uuid}/save",gerberView:"/api/pcb_order/{uuid}/gerber_view",gerberDownloadStatistic:"/api/documents/{uuid}/download_gerber",postUserBehaviorData:"/api/data/postdata",getFontPath:"/api/getFontPath",gerberDialogShow:"/api/page/editor-gerber-dialog-show"}}},co=function(){var e=location.hostname;return e.indexOf("lceda")>-1?"lceda":(e.indexOf("easyeda"),"easyeda")}();(function(){var e=location.hostname,t=e.split(".");t.length>2&&(3!==t.length||"www"!==t[0]&&t[0])})(),t.querySelector('head meta[name="STATIC"]').getAttribute("content");a.hooks={};a.wildcardHooks={};a.registerHook=function(e,t){if("string"==typeof e)if(e.indexOf("*")>=0){var r="^"+e.replace(/\*/g,".*")+"$";a.wildcardHooks[r]=t}else a.hooks[e]=t;else if(e instanceof RegExp)a.wildcardHooks[e]=t;else for(var n in e)S(e,n)&&a.registerHook(n,e[n])};var po,ho,uo,fo,go,yo,vo=o("Mac OS")>0,xo=o("chromeframe")>0||o("x-clock")>0,mo=(o("MSIE")>0||o("Trident")>=0)&&!xo,Co=mo&&o("MSIE 9.0")>0,Lo=o("Edge/")>0,_o=0===o("Opera/"),Po=o("Firefox/")>0,Ao=(Po&&navigator.userAgent.match(/Firefox\/(\d+(\.\d+)?)/)[1],o("AppleWebKit"),o("Chrome/")>0&&!mo&&!Lo&&!_o&&!Po),bo=(Ao&&navigator.userAgent.match(/Chrome\/(\d+(\.\d+)?)/)[1],o("Safari/"),o("Electron/"),{getCacheObj:function(e){var t=E(X("easyeda.preferences")||X("preferences")||"{}");return t?t[e]:void 0}}),So={},Eo={},Oo=null,Io={on:!1,targets:null,bind:!1},To={},Ro=t.createDocumentFragment(),wo=1,No=100,ko=4,Mo=function(){var e={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24],HOLLOWRECT:[3,4,12,13,14,15],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[5,6,3,4,1,2,7,8,10,12,13,14,15,21,22,23,24],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[5,6,3,4,1,2,7,8,10,12,13,14,15,21,22,23,24],DIMENSION:[3,4,12,13,14,15],IMAGE:[3,4,1,2,7,8,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15]};e["3D"]=function(){for(var e=[16,3,7,5,1],t=21;t<52;t++)e.push(t+32,t);e.push(2,6,8,4,17);return e}();var t,r,n;for(t in e)if(e.hasOwnProperty(t)){n=e[t];if(n.indexOf(21)>0&&-1===n.indexOf(25))for(r=25;r<=52;r++)n.push(r)}return e}();!function(){var e,t={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents"};for(e=21;e<53;e++)t[e]="Inner"+(e-20);for(e=53;e<85;e++)t[e]="Substrate"+(e-52)}();if(t.querySelector("#worker_main"))var Bo=new Worker(t.querySelector("#worker_main").value),Do=function(){Bo.terminate();Bo=new Worker(t.querySelector("#worker_main").value)};e.gClipboard=t.createDocumentFragment();e.easyeda={};e.callCommand=a;var Vo={data:{}},Fo={gJsonCache:{TRACK:{},PAD:{},VIA:{},HOLE:{},TEXT:{},DIMENSION:{},PROTRACTOR:{},FOOTPRINT:{},ARC:{},RECT:{},CIRCLE:{},IMAGE:{},COPPERAREA:{},SOLIDREGION:{},SVGNODE:{},DRCRULE:{Default:{trackWidth:.6,clearance:.6,viaHoleDiameter:2.4,viaHoleD:1.2},isRealtime:!0,checkObjectToCopperarea:!0,showDRCRangeLine:!0},FABRICATION:{},SIGNALS:{},head:{},systemColor:{background:"#000000",grid:"#FFFFFF",highLight:"#FFFFFF",hole:"#222222",DRCError:"#FAD609"},netColors:{},preference:{hideNets:[],hideFootprints:[],unit:"mil"},layers:{1:{name:"TopLayer",color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0},2:{name:"BottomLayer",color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0},3:{name:"TopSilkLayer",color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0},4:{name:"BottomSilkLayer",color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0},5:{name:"TopPasteMaskLayer",color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0},6:{name:"BottomPasteMaskLayer",color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0},7:{name:"TopSolderMaskLayer",color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0},8:{name:"BottomSolderMaskLayer",color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0},9:{name:"Ratlines",color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0},10:{name:"BoardOutline",color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0},11:{name:"Multi-Layer",color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0},12:{name:"Document",color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0},13:{name:"TopAssembly",color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1},14:{name:"BottomAssembly",color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1},15:{name:"Mechanical",color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1},21:{name:"Inner1",color:"#800000",darkColor:"#660000",visible:!1,active:!1,config:!1},22:{name:"Inner2",color:"#008000",darkColor:"#006600",visible:!1,active:!1,config:!1},23:{name:"Inner3",color:"#00FF00",darkColor:"#00CC00",visible:!1,active:!1,config:!1},24:{name:"Inner4",color:"#BC8E00",darkColor:"#5E4700",visible:!1,active:!1,config:!1},25:{name:"Inner5",color:"#70DBFA",darkColor:"#386E7D",visible:!1,active:!1,config:!1},26:{name:"Inner6",color:"#00CC66",darkColor:"#006633",visible:!1,active:!1,config:!1},27:{name:"Inner7",color:"#9966FF",darkColor:"#4D3380",visible:!1,active:!1,config:!1},28:{name:"Inner8",color:"#800080",darkColor:"#400040",visible:!1,active:!1,config:!1},29:{name:"Inner9",color:"#008080",darkColor:"#004040",visible:!1,active:!1,config:!1},30:{name:"Inner10",color:"#15935F",darkColor:"#0B4A30",visible:!1,active:!1,config:!1},31:{name:"Inner11",color:"#000080",darkColor:"#000066",visible:!1,active:!1,config:!1},32:{name:"Inner12",color:"#00B400",darkColor:"#005A00",visible:!1,active:!1,config:!1},33:{name:"Inner13",color:"#2E4756",darkColor:"#17242B",visible:!1,active:!1,config:!1},34:{name:"Inner14",color:"#99842F",darkColor:"#4D4218",visible:!1,active:!1,config:!1},35:{name:"Inner15",color:"#FFFFAA",darkColor:"#808055",visible:!1,active:!1,config:!1},36:{name:"Inner16",color:"#99842F",darkColor:"#4D4218",visible:!1,active:!1,config:!1},37:{name:"Inner17",color:"#2E4756",darkColor:"#17242B",visible:!1,active:!1,config:!1},38:{name:"Inner18",color:"#3535FF",darkColor:"#1B1B80",visible:!1,active:!1,config:!1},39:{name:"Inner19",color:"#8000BC",darkColor:"#40005E",visible:!1,active:!1,config:!1},40:{name:"Inner20",color:"#43AE5F",darkColor:"#225730",visible:!1,active:!1,config:!1},41:{name:"Inner21",color:"#C3ECCE",darkColor:"#627667",visible:!1,active:!1,config:!1},42:{name:"Inner22",color:"#728978",darkColor:"#39453C",visible:!1,active:!1,config:!1},43:{name:"Inner23",color:"#39503F",darkColor:"#1D2820",visible:!1,active:!1,config:!1},44:{name:"Inner24",color:"#0C715D",darkColor:"#06392F",visible:!1,active:!1,config:!1},45:{name:"Inner25",color:"#5A8A80",darkColor:"#2D4540",visible:!1,active:!1,config:!1},46:{name:"Inner26",color:"#2B937E",darkColor:"#164A3F",visible:!1,active:!1,config:!1},47:{name:"Inner27",color:"#23999D",darkColor:"#124D4F",visible:!1,active:!1,config:!1},48:{name:"Inner28",color:"#45B4E3",darkColor:"#235A72",visible:!1,active:!1,config:!1},49:{name:"Inner29",color:"#215DA1",darkColor:"#112F51",visible:!1,active:!1,config:!1},50:{name:"Inner30",color:"#4564D7",darkColor:"#23326C",visible:!1,active:!1,config:!1},51:{name:"Inner31",color:"#6969E9",darkColor:"#353575",visible:!1,active:!1,config:!1},52:{name:"Inner32",color:"#9069E9",darkColor:"#483575",visible:!1,active:!1,config:!1}}}},So={signals:Fo.gJsonCache.SIGNALS,currentNet:1,nodes:{},routedGroup:{},nets:{}},Go=t.getElementById("root"),Yo=null,jo=[],Ho=[],Xo=[],Uo="",Jo="",zo={},Wo={},Zo={adsorbGrid:{visible:!0,gridSize:10,enabled:!0,distanceX:.5,distanceY:.5,altSnapSize:.5},canvas:{originX:4e3,originY:3e3,unit:"mil",routing:1,angle:45,routeConflict:0,removeLoop:"yes"}},Ko={_errorA:[],_padA:[],_trackA:[],_rules:{},_holeA:[],maxClearance:.4,minLengthSize:.1,checkedKeys:["CIRCLE","PAD","VIA","TRACK","ARC","HOLE","SOLIDREGION","FOOTPRINT","COPPERAREA","PLANEZONE","RECT","TEXT","SVGNODE"]},qo={_clearanceWidth:1,_scaleFactor:1e4,_copperNet:"GND",_copperLayerId:io.TOPLAYER,_copperThermal:"spoke",_copperKeepIsland:"none",_copperOutline:null,copperPolygons:{},_padOrViaHasSameNetNameWithCopperArr:[],_attachedCopperId:null,_boardOutlines:[],_activeCopperPolygons:[],_boardOutlinesInFootprint:[]},$o={},Qo={graph:[],nodeCount:0,ratLineArr:{},PADMap:[],realRatLineArr:{}},es={nodeIndex:{},trees:{},signalLayers:[],_bulkPatch:{},_isBulkMode:!1};Fo.gJsonCache.objectMap=function(){var e={All:{selected:!0,color:"#F9F9F9",visible:!1,selectorText:""},Component:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 > g[c_partid^="part_import_"] > :not([c_partid="part_pcbtext"]), #masker-topLayer, #masker-bottomLayer, #g1 > g[c_partid^="part_import_"] > g[c_partid="part_pad"] > *'},Prefix:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 g[c_partid="part_pcbtext"] > path[c_note="note_pre"]'},Name:{selected:!0,color:"#F9F9F9",visible:!1,selectorText:'#g1 g[c_partid="part_pcbtext"] > path[c_note="note_name"]'},Track:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:"#g1 > polyline"},Pad:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 > g[c_partid="part_pad"] > *'},Via:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 > g[c_partid="part_via"]'},Hole:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 > g[c_partid="part_hole"]'},"Copper Area":{selected:!0,color:"#F9F9F9",visible:!0,selectorText:"#g1 > path[copper], #gCopperAreaOutlineCushions path[copper_id]"},Circle:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:"#g1 > circle"},Arc:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 > path[fill="none"]:not([copper]):not([type]):not([stroke="none"]):not([c_shapetype="group"]):not([c_shapetype="protractor"])'},"Solid Region":{selected:!0,color:"#F9F9F9",visible:!0,selectorText:"#g1 > path[type]"},Text:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 > g[c_partid="part_pcbtext"] > path[c_text]'},Image:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 path[stroke="none"]:not([fill])'},Rect:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:"#g1 > rect"},Dimension:{selected:!0,color:"#F9F9F9",visible:!0,selectorText:'#g1 > path[c_shapetype="group"]'}},t=0,r=0,n=0,i=0,a=0,o=0,s=["Component"];for(var l in e)if(e&&e.hasOwnProperty(l)&&"All"!==l){n++;e[l].selected&&t++;e[l].visible&&r++;if(s.join("|").indexOf(l)>=0){a++;e[l].visible&&i++;e[l].selected&&o++}}e.All.selected=t==n;e.All.visible=r==n;return{objects:e,allIndex:n,selectedIndex:t,visibleIndex:r,componentIndex:i,allCompement:a,componentItems:s,componentSelectedIndex:o}}();var ts='<?xml version="1.0" encoding="utf-8" standalone="no"?><svg width="800" height="600" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>entry port pcb</title><g c_partid="part_annotation" c_layer="" c_origin="0,0"><text x="0" y="0" font-family="simplex" font-size="12mm" fill="#FFFFFF" text-anchor="start" type="comment">Text</text></g><g c_partid="part_pad" c_type="pinpart" number="0" layerid="11" net="" c_origin="400,300" c_rotation="0" c_width="6" c_height="6" c_shape="ELLIPSE"><ellipse cx="400" cy="300" rx="3" ry="3" layerid="11" stroke="none" /><circle cx="400" cy="300" r="1.8" layerid="11" stroke="none" /></g><g c_partid="part_via" c_type="pinpart" layerid="11" net="" c_origin="400,300"><circle cx="400" cy="300" r="1.2" stroke="none" /><circle cx="400" cy="300" r="0.6" stroke="none" /></g><g c_partid="part_hole" c_type="pinpart" layerid="11" c_origin="0,0"><path d="M-5,-5 L5,5 M-5,5 L5,-5" fill="none" stroke-width="0.8"/><circle cx="0" cy="0" r="4" stroke="none" /><ellipse cx="0" cy="0" rx="4" ry="4" stroke-width="0.5" fill="none" /></g><g c_partid="part_pcbtext" c_origin="10,10" c_rotation="0" c_mirror="none"><path c_text="TEXT" c_fontSize="8" d="M12.55,5.64L12.55,13.27M10,5.64L15.09,5.64M17.49,5.64L17.49,13.27M17.49,5.64L22.22,5.64M17.49,9.27L20.4,9.27M17.49,13.27L22.22,13.27M24.62,5.64L29.71,13.27M29.71,5.64L24.62,13.27M34.65,5.64L34.65,13.27M32.11,5.64L37.2,5.64" fill="none" stroke-width="0.8"/></g><g c_origin="160,410" c_para="" c_partid="part_import_tmpl" c_shapetype="group" c_etype="pinpart" layerid="1"><g c_partid="part_pcbtext" c_origin="428.6,142.23046875" layerid="3"><path c_note="note_pre" c_fontSize="4.5" c_text="U2" d="M 217 133.55L217 136.61 L217.2 137.23 L217.61 137.64 L218.23 137.84 L218.64 137.84 L219.25 137.64 L219.66 137.23 L219.86 136.61 L219.86 133.55 M 221.62 133.55L223.87 133.55 L222.65 135.18 L223.26 135.18 L223.67 135.39 L223.87 135.59 L224.08 136.2 L224.08 136.61 L223.87 137.23 L223.46 137.64 L222.85 137.84 L222.24 137.84 L221.62 137.64 L221.42 137.43 L221.21 137.02" fill="none" stroke-width="0.7"/></g></g><g c_origin="160,410" c_para="" c_partid="part_board_frame" c_shapetype="group" c_etype="pinpart"></g></svg>';!function(){if(!e.console){var t=function(){};return{log:t,info:t,warn:t,error:t}}var r={};["log","info","warn","error"].forEach(function(t){r[t]=e.console[t].bind(e.console)})}();Eo.camelize=function(e){return e.replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()})};Eo.dasherize=function(e){return e.replace(/[a-z][A-Z]/g,function(e){return e.charAt(0)+"-"+e.charAt(1).toLowerCase()})};Eo.extractDocType=function(e){return"string"==typeof e?e.split(so)[0]:e.docType};Eo.json2EntitiedStr=function(e){return(JSON.stringify(e)||"").replace(/"/g,"&quot;")};Eo.newId=function(){return"gge"+ ++ko};Eo.toHexColor=function(e){if(/^#.{6}$/.text(e))return e.toUpperCase();if(/^#...$/.text(e))return e.replace(/[^#]/g,"$&$&").toUpperCase();if(/^rgb\((\d+).+(\d+).+(\d+)\)$/.text(e)){e="#"+(+RegExp.$1+256).toString(16)+(+RegExp.$2+256).toString(16)+(+RegExp.$3+256).toString(16);return e.replace(/1(..)/g,"$1").toUpperCase()}return e};Eo.isValidImageURL=function(e){return e&&(/^(https?:)?\/\/[\w.-]+\/[^\s#?"]+\.(jpg|jpeg|png|gif|svg)$/i.test(e)||/^data:image\/(jpeg|png|gif|svg\+xml);base64,/.test(e)||/^\/assets\/static\/images\//.test(e))};Eo.numberlistToArray=function(e,t){if(!e)return[];var r,n=e.trim().split(t||/[\s,]+/g);for(r=0;r<n.length;r++)n[r]=+n[r];return n};Eo.extend=function(){var e,t=0,r=arguments,n=r.length,i=!1;if(n<1)return{};if("boolean"==typeof r[0]){i=r[0];e=r[1];t=1}else if("boolean"==typeof r[n-1]){i=r[n-1];e=r[0];n--}else e=r[0];(!e||"object"!=typeof e&&"function"!=typeof e)&&(e={});for(;t<n;t++){var a=r[t];if(a&&"object"==typeof a){if(a==e)continue;for(var o in a)S(a,o)&&(i&&a[o]&&"object"==typeof a[o]?e[o]=Eo.extend({},a[o]):e[o]=a[o])}}return e};Eo.cloneJSON=function(e){return e&&"object"==typeof e?E(JSON.stringify(e)):e};Eo.getVendorProperty=function(e,t){if(S(e,t))return e[t];var r=t.charAt(0).toUpperCase()+t.substr(1);return e["webkit"+r]||e["moz"+r]||e["o"+r]||e["ms"+r]};Eo.getErrorInfo=function(t){var r="",n=navigator,i=t.stack||t.error&&t.error.stack;"object"==typeof lo&&(r+="#build: "+lo.version+", "+lo.buildDate+";\n");var a=U();a&&(r+="#browser: "+a+";\n");r+="#userAgent: "+n.userAgent+";\n";n.platform&&(r+="#platform: "+n.platform+";\n");n.language&&(r+="#language: "+n.language+";");n.languages&&(r+=" langs:"+n.languages+";");n.systemLanguage&&(r+=" sysLang:"+n.systemLanguage+";");n.userLanguage&&(r+=" userLang:"+n.userLanguage+";");n.browserLanguage&&(r+=" browserLang:"+n.browserLanguage+";");r+="\n";"object"==typeof Locale&&Locale&&Locale._curr&&(r+="#Locale._curr: "+Locale._curr+";\n");var o=location.protocol+"//"+location.host;r+="#location: "+location.href.replace(o,"")+";\n";try{if(e!=top)r+="#top.location: "+top.location.href.replace(o,"")+";\n";else{var s=$("#tabbar_bodies .editframe").toArray();s.length&&(r+="#iframes: "+s.map(function(e){return e.getAttribute("src")}).join("  ")+"\n")}}catch(e){}r+="#tostring: "+t.toString()+";\n";t.toString()!=Object.prototype.toString.call(t)&&(r+="#tostring2: "+Object.prototype.toString.call(t)+";\n");t.type&&(r+="#type: "+t.type+";\n");var l=t.filename||t.fileName||t.error&&t.error.filename||t.error&&t.error.fileName||"";l=l.replace(/[^#?]+\//,"");var c=t.lineno||t.lineNumber||t.error&&t.error.lineno||t.error&&t.error.lineNumber||"",d=t.colno||t.columnNumber||t.error&&t.error.colno||t.error&&t.error.columnNumber||"";if(!l&&i)if(i.match(/\/([^\/]+):(\d+):(\d+)\)/)){l=RegExp.$1;c=RegExp.$2;d=RegExp.$3}else if(i.match(/\/([^\/]+):(\d+)\)/)){l=RegExp.$1;c=RegExp.$2}r+="#file: "+l+"; #line:"+c+"; #col:"+d+";\n";t.message?r+="#message: "+t.message+";\n":t.description?r+="#message: "+t.description+";\n":t.error&&t.error.message?r+="#message: "+t.error.message+";\n":t.error&&t.error.description&&(r+="#message: "+t.error.description+";\n");if(i){o=o.replace(/[\/:]/g,"\\$&");i=i.replace(new RegExp(o,"g"),"");i=i.replace(/\n(\S)/g,"\n  $1");r+="#stack: "+i+";\n";if(i.indexOf("this.get(...).querySelectorAll")>0){if(!top._querySelectorAll_err&&top.$&&top.$.messager&&top.$.messager.error){top._querySelectorAll_err=1;setTimeout(function(){"function"==typeof notifyReportBug?notifyReportBug():sr("notifyReportBug")},500)}for(var p=[[Element,"Element","innerHTML","__INNERHTML_DESCRIPTOR"],[Node,"Node","textContent","__TEXTCONTENT_DESCRIPTOR"]],h=0;h<p.length;h++){var u=p[h],f=u[1],g=u[2],y=e[u[3]];if(y)try{var v,x;v=Object.getOwnPropertyDescriptor(u.prototype,g);if(!v||v.set!=y.set){x={}.toString.call(v.set);r+="-----------------------\n"+f+" "+g+" set was overide:\n"+x+"\n";x.indexOf("[native code]")<0&&Object.defineProperty(u.prototype,g,y)}}catch(e){}}}}return{detail:r,file:l,lineno:c,colno:d}};Eo.submitJsError=function(e){try{if(!(e&&e.file&&e.lineno&&e.colno))return;if(e.detail.indexOf("https://embed.tawk.to/")>0)return;var t=e.detail.match(/#file:.+\n#message:.+\n#stack:.*\n.*(?:\n.*)?/);t||(t=e.detail.match(/#file:.+\n#message:.+/));if(!t||!t[0])return;e.key=MD5(t[0]);errKeys||(errKeys={});if(S(errKeys,e.key))return;var r={};$.extend(r,{keyId:e.key,file:e.file,detail:e.detail});$.extend(r,{locale:Locale._curr,build:lo.version+","+lo.buildDate,login:0|isLogined()});$.extend(r,Eo.getEnvInfo());$.postJSON({url:lo.apis.others.bugReport,data:{bugInfo:JSON.stringify(r)},timeout:6e4}).then(function(e){e&&e.success})}catch(e){}};Eo.reportError=function(e){if(e&&"object"==typeof e)try{var t=Eo.getErrorInfo(e);t.file&&t.lineno&&t.colno&&(void 0!==sr?sr("triggerEvent",["error",t]):Eo.submitJsError(t))}catch(e){}};Eo.getEnvInfo=function(){var r=navigator,n=r.userAgent.replace(/Mozilla\/\S*|AppleWebKit\/\S*|KHTML, like Gecko|/,""),i=t.body,a={os:[["Windows 10",/Windows NT (?:10\.|6\.4)/],["Windows 8.1",/Windows (?:8\.1|NT 6\.3)/],["Windows 8",/Windows (?:8|NT 6\.2)/],["Windows 7",/Windows (?:7|NT 6\.1)/],["Windows Phone",/Windows Phone/],["$1",/((?:Windows (?:NT )?|WinNT) \d+\.?\d*)/],["Mac OS",/Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh/],["$&",/iPhone|iPad|iPod|OpenBSD|FreeBSD|Ubuntu|Linux|Unix|BlackBerry|OS\/2|Android/]],browser:[["IEMobile $1",/ IEMobile\/(\d+)/],["IE 11",/Edge\/12|Trident\/7.* rv:11/],["IE 10",/MSIE 10|Trident\/6/],["IE 9",/MSIE 9|Trident\/5/],["IE $1",/MSIE (\d+)/],["Firefox $1",/Firefox\/(\d+)/],["Opera $1",/Opera\/.*Version\/(\d+)/],["Chrome $1",/Chrome\/(\d+)/],["Safari $1",/Version\/(\d+).* Safari/,/Android/]]},o={platform:r.platform||"",language:r.language||r.userLanguage||"",os:"other",browser:"other",screen:{width:screen.width,height:screen.height,devicePixelRatio:e.devicePixelRatio||1,touch:0|("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)},features:{applicationCache:0|!!e.applicationCache,IndexedDB:0|!!Eo.getVendorProperty(e,"indexedDB"),FileSystem:0|!!Eo.getVendorProperty(e,"requestFileSystem"),WebWorker:0|!!e.Worker,history:"pushState"in e.history|0,hashchange:"onhashchange"in e|0,draganddrop:0|("draggable"in i||"ondragstart"in i&&"ondrop"in i)}};a.os.some(function(e){var t,r=e[0],i=e[1],a=e[2];if(t=n.match(i)){r=r.indexOf("$")<0?r:"$&"==r?t[0]:r.replace("$1",t[1]);if(!a||!a.test(n)){o.os=r;return!0}}});a.browser.some(function(e){var t,r=e[0],i=e[1],a=e[2];if(t=n.match(i)){r=r.indexOf("$")<0?r:"$&"==r?t[0]:r.replace("$1",t[1]);if(!a||!a.test(n)){o.browser=r;return!0}}});return o};Eo.c_paraToJson=function(e){if(!e)return{};if("string"!=typeof e)return e;for(var t=e.split("`"),r={},n=0,i=t.length-1;n<i;n+=2)t[n]&&(r[j(t[n])]=j(V(t[n+1]||"")));return r};Eo.jsonToC_para=function(e){var t="";if("string"==typeof e)return e;for(var r in e)if(r&&S(e,r)&&0!==r.indexOf("attr-")){var n=""+e[r];t+=Y(r)+"`"+Y(n)+"`"}return t};Eo.sortC_paraJson=function(e){var t=["name","package","Package Display","pre","BOM_Supplier","BOM_Supplier Part","BOM_Manufacturer","BOM_Manufacturer Part"],r=["Contributor"],n={};t.forEach(function(t){S(e,t)&&(n[t]=e[t])});for(var i in e)S(e,i)&&-1===t.indexOf(i)&&-1===r.indexOf(i)&&(n[i]=e[i]);r.forEach(function(t){S(e,t)&&(n[t]=e[t])});return n};Eo.getSCHCmdKey=function(e){if(!e||!e.tagName||e==Ka||e.contains(Ka))return"";var t=wt(e);if("object"!=typeof t)return"";var r=t.c_partid,n=function(e){return e?0===e.indexOf("part_annotation")?"annotation":0===e.indexOf("part_pin")?"pin":0===e.indexOf("part_junction")?"junction":0===e.indexOf("part_busentry")?"busentry":0===e.indexOf("part_netLabel_text")?"netlabel":0===e.indexOf("part_netLabel_")?"netflag":0===e.indexOf("part_import_")?"schlib":0===e.indexOf("part_arrowhead")?"arrowhead":0===e.indexOf("part_no_connect_flag")?"noconnectflag":0===e.indexOf("part_svg")?"svgnode":0===e.indexOf("part_image")?"pimage":"":""}(r);if(n)return n;var i=e.tagName;if("polyline"==i&&"wire"==t.c_etype)n="wire";else if("polyline"==i&&"bus"==t.c_etype)n="bus";else{n=i||"";"path"==n&&(n="arc1"==t.c_helper_type||"pie1"==t.c_helper_type?"arc":"path")}return n.toLowerCase()};Eo.getPCBCmdKey=function(e){if(!e||!e.tagName||e==Ka||e.contains(Ka))return"";var t=e.tagName,r=m(e,"c_partid")||"",n="";switch(t){case"g":if(!e.childNodes.length)return"";switch(r){case"part_pad":n="PAD";break;case"part_via":n="VIA";break;case"part_hole":n="HOLE";break;case"part_pcbtext":n="TEXT";break;case"part_svg":n="SVGNODE";break;case"part_plane":n="PLANEZONE";break;case"":e.id&&e.id.match(/^layer_/)||(n="SVGNODE");break;default:n=0===r.indexOf("part_import_")?"FOOTPRINT":""}break;case"polyline":n="TRACK";break;case"path":m(e,"attachedcopperid")?n="":-1!=["cutout","npth","solid"].indexOf(m(e,"type"))?n="SOLIDREGION":m(e,"thermal")&&m(e,"keepIsland")&&m(e,"copper")?n="COPPERAREA":"group"==m(e,"c_shapetype")?n="DIMENSION":"protractor"==m(e,"c_shapetype")?n="PROTRACTOR":"none"!=m(e,"stroke")||m(e,"fill")?(m(e,"d")||"").indexOf("A")>0&&(n="ARC"):n="SVGNODE";break;case"line":n="RATLINE";break;case"rect":n="RECT";break;case"circle":n="CIRCLE";break;case"text":n="SVGNODE";break;default:n=(t||"").toUpperCase();S(_s,n)||(n=t.match(/^(ellipse|image|a)$/)?"SVGNODE":"")}return n};Eo.createPolylineForOvalPad=function(e,t,r,n,i){e=+e;t=+t;r=+r;n=+n;i=i||0;i=+i;var a=new c(0,0),o=new c(0,0),s=0,l=(r>n?n:r)/2;if(r<n){a.x=o.x=e;s=n/2-l;a.y=t-s;o.y=t+s}else{a.y=o.y=t;s=r/2-l;a.x=e-s;o.x=e+s}var d=[a.x,a.y,o.x,o.y];d=ge(d,(360-i)%360,e,t);return d};Eo.convertRect2Polygon=function(e,t,r,n){return[+e,+t,+e+r,+t,+e+r,+t+n,+e,+t+n]};Eo.Dots={eachAdd:function(e,t,r){var n;for(n=0;n<e.length-1;n+=2){e[n]+=t;e[n+1]+=r}return e}};Eo.units={decimals:{pixel:2,mil:3,mm:3,inch:3},isUnit:function(e){return/^(pixel|mil|mm|inch)$/i.test(e)},changeElementsUnit:function(e,t,r){if(t!=r&&Eo.units.isUnit(t)&&Eo.units.isUnit(r))for(var n,i,a,o=0;o<e.length;o++){n=e[o].getAttribute("oldval")||e[o].value.toLowerCase();a=n.replace(/\D+$/,"");if(a&&isFinite(a)){i=Eo.units.convert(+a,t,r);e[o].value=Eo.formatLengthShow(i)+r;e[o].setAttribute("oldval",i+r)}}},convert:function(e,t,r){if(t==r)return 1*e;if("string"==typeof e){if(2==arguments.length){r=t;t=e.replace(/^[-+.\d\s]+/,"");e=e.replace(/[^-+.\d\s]+$/,"")}e=+e}if("number"!=typeof e||!isFinite(e))throw Error("Invalid value for unit convert");t=t.toLowerCase();r=r.toLowerCase();if("cm"==t){t="mm";e*=10}else"px"==t&&(t="pixel");if("cm"==r){r="mm";e*=.1}else"px"==r&&(r="pixel");if(t==r)return 1*e;if(!Eo.units.isUnit(t)||!Eo.units.isUnit(r))throw Error("Not supported unit convert "+t+" to "+r);switch(t+"2"+r){case"mil2pixel":return.1*e;case"mil2mm":return.0254*e;case"mil2inch":return.001*e;case"mm2pixel":return e/.254;case"mm2mil":return e/.0254;case"mm2inch":return e/25.4;case"pixel2mil":return 10*e;case"pixel2mm":return.254*e;case"pixel2inch":return.01*e;case"inch2pixel":return 100*e;case"inch2mil":return 1e3*e;case"inch2mm":return 25.4*e}throw Error("Not supported unit convert "+t+" to "+r)}};Eo.formatDate=function(e,t){if(e&&"[object Date]"==Object.prototype.toString.call(e)){var r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));/(Z+)/.test(t)&&(t=t.replace(RegExp.$1,function(e,t){var r=15*-Math.round(e.getTimezoneOffset()/15),n=~~(r/60),i=~~r%60,a="+";r<0&&(a="-");return a+("00"+n).substr((""+n).length)+t+("00"+i).substr((""+i).length)}(e,1==RegExp.$1.length?":":"")));for(var n in r)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return t}};Eo.formatLengthShow=function(e,t){t=t||lo;return Eo.toFixed(e,t.decimalPlacesShow,t.fixedDecimal)};Eo.formatLengthSave=function(e,t){t=t&&"number"==typeof t.decimalPlaces?t:lo;return Eo.toFixed(e,t.decimalPlaces)};c.prototype={toString:function(){return Eo.toFixed(this.x,4)+"_"+Eo.toFixed(this.y,4)}};Eo.arc={c_helper_lines:[{type:"path_arc"},{from:0,to:1},{type:"rect_center_corner",center:0,corner:1},{from:0,to:2,ray:1},{from:0,to:3,ray:1}],c_helper_lines_pie1:[{type:"path_arc"},{from:0,to:1},{type:"rect_center_corner",center:0,corner:1},{from:2,to:0,ray:-1},{from:3,to:0,ray:-1}],getDotByAngle:function(e,t,r){var n=Math.PI,i=.5*n,a=n+n;r%=a;r<0&&(r+=a);if(0===r)return{x:e,y:0};if(r==i)return{x:0,y:t};if(r==n)return{x:-e,y:0};if(r==1.5*n)return{x:0,y:-t};var o=Math.tan(r),s=Math.sqrt(1/(1/(e*e)+o*o/(t*t)));r>i&&r<1.5*n&&(s=-s);var l=s?s*o:r<n?t:-t;r>n!=l<0&&(l=-l);return{x:s,y:l}},getAngle:function(e,t){if(0===e&&0===t)return null;var r=Math.atan2(t,e);return r<0?r+Math.PI+Math.PI:r},getArcParams:function(e,t,r,n,i,a,o,s){var l={fa:1,fs:0,angle:0},c=Eo.arc.getAngle(i-e,a-t),d=Eo.arc.getAngle(o-e,s-t);if(null===c||null===d)return null;var p=Eo.arc.getDotByAngle(r,n,c),h=Eo.arc.getDotByAngle(r,n,d);l.x1=e+p.x;l.y1=t+p.y;l.x2=e+h.x;l.y2=t+h.y;l.a1=c;l.a2=d;var u=Math.PI,f=u+u,g=(d<c?f:0)+d-c;l.fa=g>=u?1:0;l.fs=1;return l},getArcParamsByCRA:function(e,t,r,n,i,a,o){var s={angle:0,fa:1,fs:0},l=Eo.arc.getDotByAngle(r,n,i),c=Eo.arc.getDotByAngle(r,n,a);s.x1=e+l.x;s.y1=t+l.y;s.x2=e+c.x;s.y2=t+c.y;s.rx=r;s.ry=n;var d=Math.PI,p=d+d,h=(a-i)%p;h<0&&(h+=p);s.fs=o?1:0;s.fa=o?h>=d?1:0:h>=d?0:1;return s},convertSvgParam2CanvasParam:function(e){e=V(e.replace(/[^0-9\., \-]/gi," "));var t=e.split(/[ ,]+/g);return 9!==t.length?null:Eo.arc.getCenterParam(+t[0],+t[1],+t[7],+t[8],+t[5],+t[6],+t[2],+t[3],+t[4])||null},getCenterParam:function(e,t,r,n,i,a,o,s,l){function c(e,t,r,n){var i=e*r+t*n,a=Math.sqrt((e*e+t*t)*(r*r+n*n)),o=Math.acos(i/a);e*n-t*r<0&&(o=-o);return o}function d(e){for(;e>=y;)e-=y;for(;e<0;)e+=y;return e}function p(e){e.rx=o;e.ry=s;e.startAngle=e.theta1;e.endAngle=d(e.theta1+e.delta_theta);return e}var h,u,f,g,y=2*Math.PI;o<0&&(o=-o);s<0&&(s=-s);o==s&&(l=0);var v=Math.sin(l),x=Math.cos(l),m=(e-r)/2,C=(t-n)/2,L=(e+r)/2,_=(t+n)/2;if(o<1e-5||s<1e-5){f=c(1,0,r-e,n-t);return p({cx:L,cy:_,theta1:f,delta_theta:Math.PI})}var P=x*m+v*C,A=x*C-v*m,b=P*P/(o*o)+A*A/(s*s);if(b>1){o*=Math.sqrt(b);s*=Math.sqrt(b)}var S=o*s,E=o*A,O=s*P,I=E*E+O*O;if(!I)return p({cx:L,cy:_,theta1:0,delta_theta:0});var T=(S*S-I)/I;T=Math.sqrt(Math.abs(T));i==a&&(T=-T);var R=T*E/s,w=-T*O/o;h=x*R-v*w+L;u=v*R+x*w+_;var N=(P-R)/o,k=(P+R)/o,M=(A-w)/s,B=(A+w)/s;f=c(1,0,N,M);g=c(N,M,-k,-B);for(;g>y;)g-=y;for(;g<0;)g+=y;!1!==a&&0!==a||(g-=y);return p({cx:h,cy:u,theta1:f,delta_theta:g})},calculateArcHelperDots:function(e){var t,r,n,i,a,o,s,l,c,d,p,h=e.pathSegList,u=h.numberOfItems,f=u>0&&h.getItem(0),g=u>1&&h.getItem(1),y=u>2&&h.getItem(2);if(u<2)return[];if(2==u&&"A"==g.pathSegTypeAsLetter){p=g;t=f.x;r=f.y}else{if(!(u>=3&&"L"==g.pathSegTypeAsLetter&&"A"==y.pathSegTypeAsLetter))return[];p=y;t=g.x;r=g.y}n=p.x,i=p.y,a=p.largeArcFlag,o=p.sweepFlag,s=p.r1,l=p.r2,c=p.angle,d=c*Math.PI/180;var v=Eo.arc.getCenterParam(t,r,n,i,a,o,s,l,d),x=Eo.toFixed(v.cx,2),m=Eo.toFixed(v.cy,2),C=c%180==90||c%180==-90,L=x+(C?l:s),_=m+(C?s:l),P=[x,m,L,_,t,r,n,i];P.path_arc=["M"+t,r+"A"+s,l,c,1-a,1-o,n,i].join(" ");return P},getArcParamsBy3Points:function(e,t,r,n,i,a){function o(e,t,r){var n=Math.acos(e/r);return t>=0?n:2*Math.PI-n}var s=r-e,l=i-e,c=n-t,d=a-t,p=e*e,h=r*r,u=i*i,f=t*t,g=n*n,y=a*a,v=(c*(y-f+u-p)-d*(g-f+h-p))/(2*l*c-2*s*d),x=(s*(u-p+y-f)-l*(h-p+g-f))/(2*d*s-2*c*l);if(isFinite(v)&&isFinite(x)){var m=Math.sqrt((e-v)*(e-v)+(t-x)*(t-x)),C=[e-i,t-a],L=[r-i,n-a],_=C[0]*L[0]+C[1]*L[1],P=_<0?0:1,A=o(e-v,t-x,m),b=o(r-v,n-x,m),S=o(i-v,a-x,m),E=0;S>A?(b>S||b<A)&&(E=1):b>S&&b<A&&(E=1);return{r1:m,r2:m,angle:0,largeArcFlag:P,sweepFlag:E,x:r,y:n,cx:v,cy:x}}},getCenterPoint:function(e,t,r,n,i,a,o,s,l){var c=Eo.arc.getCenterParam(e,t,r,n,i,a,o,s,l);return{x:c.cx,y:c.cy}}};Eo.fileType={getIcon:function(e){var t="";switch(e+""){case ao.SCH:case ao.SCHMODULE:t="icon-eda-sch";break;case ao.SCHLIB:case ao.SUBPART:t="icon-eda-eelib";break;case ao.PCB:case ao.PCBMODULE:t="icon-eda-pcb";break;case ao.PCBLIB:t="icon-pcblib";break;case ao.SPICESYMBOL:t="icon-spicesymbol";break;case ao.SUBCKT:t="icon-subckt";break;case ao.WAVEFORM:t="icon-waveform";break;case ao.PHOTOVIEW:t="icon-eda-pcb";break;case ao.PRJ:t="icon-prj";break;case ao.PCBLIB3D:t="icon-3d"}return t},getNewTitle:function(e){var t="New";switch(e+""){case ao.PRJ:t="New Project";break;case ao.SCH:case ao.SUBCKT:t="Sheet";break;case ao.SCHMODULE:t="New Schematic Module";break;case ao.SUBCKT:t="Sheet";break;case ao.SCHLIB:t="New Schematic Lib";break;case ao.SPICESYMBOL:t="New_Spice_Symbol";break;case ao.PCB:t="NEW_PCB";break;case ao.PCBMODULE:t="New PCB Module";break;case ao.PCBLIB:t="NEWPCBLIB";break;case ao.WAVEFORM:t="WaveForm";break;case ao.PHOTOVIEW:t=Locale.i18n("Photo View");break;case ao.VIEW3D:t=Locale.i18n("3D View")}return t},getSaveAsDlgTitle:function(e){var t="Save as";switch(e+""){case ao.PRJ:t="Save as a new project";break;case ao.SCH:t="Save as a schematic";break;case ao.SCHLIB:t="Save as a schematic Lib";break;case ao.SPICESYMBOL:t="Save as a spice Symbol";break;case ao.SUBCKT:t="Save as a spice subckt";break;case ao.PCB:
t="Save as a PCB file";break;case ao.PCBLIB:t="Save as a PCB Lib";break;case ao.PHOTOVIEW:t="Save as a Photo View";break;case ao.WAVEFORM:t="Save as a WaveForm";break;case ao.SCHMODULE:t="Save as a Schematic Module";break;case ao.PCBMODULE:t="Save as a PCB Module"}return t},getAbstractFileType:function(e){switch(e+""){case ao.SCH:case ao.SUBCKT:case ao.SCHMODULE:return"sch";case ao.SCHLIB:case ao.SUBPART:case ao.SPICESYMBOL:return"schlib";case ao.PCB:case ao.PCBMODULE:return"pcb";case ao.PCBLIB:return"pcblib";case ao.WAVEFORM:return"waveform";case ao.PHOTOVIEW:return"photoview";case ao.VIEW3D:return"3Dview";default:return}},mergeFileType:function(e){return e==ao.PCB||e==ao.PCBLIB||e==ao.PHOTOVIEW?"pcb_pcblib":"sch_schlib_waveform"},isLib:function(e){var t=Eo.fileType.getAbstractFileType(e);return"schlib"==t||"pcblib"==t},isModule:function(e){return e==ao.SCHMODULE||e==ao.PCBMODULE},isComponent:function(e){return Eo.fileType.isLib(e)||Eo.fileType.isModule(e)},isDocument:function(e){return _r(e)||e==ao.PCB||e==ao.WAVEFORM},getApi:function(e,t){var r;switch(e+""){case ao.PRJ:r=lo.apis.projects;break;case ao.SCH:case ao.SUBCKT:case ao.PCB:case ao.WAVEFORM:r=lo.apis.document;break;case ao.SCHLIB:case ao.SUBPART:case ao.SPICESYMBOL:case ao.SCHMODULE:case ao.PCBMODULE:case ao.PCBLIB:case ao.PCBLIB3D:r=lo.apis.components;break;case ao.PHOTOVIEW:}if(r&&!t)return r;if(!r||!t||!r[t])throw Error("No such api");return r[t]},needProject:function(e){return _r(e)||e==ao.PCB||e==ao.WAVEFORM}};Eo.toFixed=function(e,t,r){"number"!=typeof e&&(e=+e);if(isNaN(e))return NaN;t|=0;if(t<=0||!e&&!r)return Math.round(e);var n=eo[t]||Math.pow(10,t)||10;if(r){var i=e<0?"-":"";e=e<0?-e:e;e=Math.round(e*n)+"";for(;e.length<=t;)e="0"+e;e=e.slice(0,-t)+"."+e.slice(-t);return i+e}return Math.round(e*n+1e-10)/n};Eo.fixLongNumberString=function(e,t){if(!e||"string"!=typeof e)return"";var r=/\d+\.\d{12,}/g,n=eo[t]||Math.pow(10,t)||10;return e.replace(r,function(e){return Math.round(e*n+1e-10)/n})};Eo.isDotInRect=function(e,t,r){return 3==arguments.length?e>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height:Eo.isDotInRect(e.x,e.y,t)};Eo.isDotInArea=function(e,t,r,n,i,a){if(r>i){var o=r;r=i;i=o}if(n>a){var s=n;n=a;a=s}return e>=r&&e<=i&&t>=n&&t<=a};Eo.bbox2Polygon=function(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]};Eo.isRectInRect=function(e,t){return Eo.isDotInRect(e.x,e.y,t)&&Eo.isDotInRect(e.x+e.width,e.y,t)&&Eo.isDotInRect(e.x,e.y+e.height,t)&&Eo.isDotInRect(e.x+e.width,e.y+e.height,t)};Eo.combineBox=function(e,t){var r=Math.max(e.x+e.width,t.x+t.width),n=Math.max(e.y+e.height,t.y+t.height),i=Math.min(e.x,t.x),a=Math.min(e.y,t.y);return{x:i,y:a,width:r-i,height:n-a}};Eo.combineMultiBox=function(e){if(D(e)){for(var t=[],r=[],n=[],i=[],a=0;a<e.length;a++){t.push(e[a].x+e[a].width);r.push(e[a].y+e[a].height);n.push(e[a].x);i.push(e[a].y)}var o=Math.max.apply(null,t),s=Math.max.apply(null,r),l=Math.min.apply(null,n),c=Math.min.apply(null,i);return{x:l,y:c,width:o-l,height:s-c}}};Eo.isRectTouchRect=function(e,t){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y};Eo.isPolylineTouchRect=function(e,t){for(var r=e.points,n=r.length||r.numberOfItems,i=0;i<n;i++)if(Eo.isDotInRect(r.getItem(i).x,r.getItem(i).y,t))return!0;var a,o,s,l,c,d,p,h,u={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};for(i=1;i<n;i++){a={x1:r.getItem(i-1).x,y1:r.getItem(i-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y};o=a.x2-a.x1;s=a.y2-a.y1;l={};if(o>0){l.x1=a.x1;l.x2=a.x2}else{l.x1=a.x2;l.x2=a.x1}if(s>0){l.y1=a.y1;l.y2=a.y2}else{l.y1=a.y2;l.y2=a.y1}if(!(l.x1>u.x2||l.x2<u.x1||l.y1>u.y2||l.y2<u.y1)){c=s*(u.x1-a.x1)-o*(u.y1-a.y1);d=s*(u.x1-a.x1)-o*(u.y2-a.y1);p=s*(u.x2-a.x1)-o*(u.y1-a.y1);h=s*(u.x2-a.x1)-o*(u.y2-a.y1);if(!(c>0&&d>0&&p>0&&h>0||c<0&&d<0&&p<0&&h<0))return!0}}return!1};Eo.isPolygonTouchRect=function(e,t){for(var r=e.points,n=r.length||r.numberOfItems,i=0;i<n;i++)if(Eo.isDotInRect(r.getItem(i).x,r.getItem(i).y,t))return!0;var a,o,s,l,c,d,p,h,u={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};for(i=0;i<n;i++){a=0===i?{x1:r.getItem(n-1).x,y1:r.getItem(n-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y}:{x1:r.getItem(i-1).x,y1:r.getItem(i-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y};o=a.x2-a.x1;s=a.y2-a.y1;l={};if(o>0){l.x1=a.x1;l.x2=a.x2}else{l.x1=a.x2;l.x2=a.x1}if(s>0){l.y1=a.y1;l.y2=a.y2}else{l.y1=a.y2;l.y2=a.y1}if(!(l.x1>u.x2||l.x2<u.x1||l.y1>u.y2||l.y2<u.y1)){c=s*(u.x1-a.x1)-o*(u.y1-a.y1);d=s*(u.x1-a.x1)-o*(u.y2-a.y1);p=s*(u.x2-a.x1)-o*(u.y1-a.y1);h=s*(u.x2-a.x1)-o*(u.y2-a.y1);if(!(c>0&&d>0&&p>0&&h>0||c<0&&d<0&&p<0&&h<0))return!0}}return!1};Eo.svg={getRefPoint:function(e){var t;switch(e&&e.tagName){case"path":var r=e.pathSegList.getItem(0);r&&"M"==r.pathSegTypeAsLetter&&(t=[r.x,r.y]);break;case"svg":case"text":case"rect":case"image":t=[+m(e,"x"),+m(e,"y")];break;case"circle":case"ellipse":t=[+m(e,"cx"),+m(e,"cy")];break;case"line":t=[+m(e,"x1"),+m(e,"y1")];break;case"polygon":case"polyline":var n=e.points.getItem(0);n&&(t=[n.x,n.y]);break;case"g":var i=m(e,"c_origin");if(i){i=i.replace(/\s+/g,"").split(/,/);i[0]-=0;i[1]-=0;t=i}else{var a=h("g[c_origin], svg, path, text, rect, image, circle, ellipse, line, polygon, polyline",e);a&&(t=Eo.svg.getRefPoint(a))}}if(t)return{x:t[0],y:t[1]}},transformPoint:function(e,t){return{x:e.x*t.a+e.y*t.c+t.e,y:e.x*t.b+e.y*t.d+t.f}},transformBox:function(e,t){for(var r,n=[e.x,e.x+e.width,e.x,e.x+e.width],i=[e.y,e.y,e.y+e.height,e.y+e.height],a=0;a<4;a++){r=Eo.svg.transformPoint({x:n[a],y:i[a]},t);n[a]=r.x;i[a]=r.y}var o=Math.min.apply(0,n),s=Math.min.apply(0,i);return{x:o,y:s,width:Math.max.apply(0,n)-o,height:Math.max.apply(0,i)-s}},isZeroBox:function(e){return!(e.x||e.y||e.width||e.height)},getPlainBBox:function(e){if(m(e,"c_partid")&&m(e,"c_partid").match(/part_import_/)){var t=p('[c_partid="part_annotation"]',e),r=p('[c_partid="part_pcbtext"]',e),n=h('[c_etype="outline3D"]',e),i=[],a=[],o=n&&"none"!==n.style.display;o&&(n.style.display="none");t.length&&t.forEach(function(e){if("none"!==e.style.display){i.push(e);e.style.display="none"}});r.length&&r.forEach(function(e){if("none"!==e.style.display){a.push(e);e.style.display="none"}});var s=Eo.svg.getBBox(e);o&&(n.style.display="");i.length&&i.forEach(function(e){e.style.display=""});a.length&&a.forEach(function(e){e.style.display=""});return s}return Eo.svg.getBBox(e)},getBBox:function(e){function t(e){var t,r;try{r=e.cloneNode(!0);Go.appendChild(r);r.style.display="inline";var n=r.getBBox();r.style.display="";t={x:n.x,y:n.y,width:n.width,height:n.height};v(r)}catch(e){if(r){r.style.display="";v(r)}t={x:0,y:0,width:0,height:0}}return t}var r,n;try{n=e.getBBox();r={x:n.x,y:n.y,width:n.width,height:n.height}}catch(n){r=t(e)}try{r.x||r.y||r.width||r.height||20==d("root").compareDocumentPosition(e)||(r=t(e))}catch(e){}return r},getBBoxAbout:function(e){var t,r=e.tagName;if("none"==m(e,"display"))return null;var n=function(e,t){return parseFloat(m(e,t))};switch(r){case"text":t=[n(e,"x"),n(e,"y"),1,1];break;case"image":case"rect":t=[n(e,"x"),n(e,"y"),n(e,"width"),n(e,"height")];t[2]+=t[0];t[3]+=t[1];break;case"circle":case"ellipse":var i,a,o=n(e,"cx"),s=n(e,"cy");if("circle"==r)i=a=n(e,"r");else{i=n(e,"rx");a=n(e,"ry")}t=[o-i,s-a,o+i,s+a];break;case"line":var l=n(e,"x1"),c=n(e,"y1"),d=n(e,"x2"),p=n(e,"y2");t=[Math.min(l,d),Math.min(c,p),Math.max(l,d),Math.max(c,p)];break;case"polyline":case"polygon":t=function(e){var t,r,n,i,a=N(e);if(!a.length)return null;t=n=a[0].x;r=i=a[0].y;for(var o=1;o<a.length;o++){var s=a[o];t-s.x>0&&(t=s.x);r-s.y>0&&(r=s.y);n-s.x<0&&(n=s.x);i-s.y<0&&(i=s.y)}return[t,r,n,i]}(m(e,"points"));break;case"path":var u=e.getPathData({normalize:!0});t=function(e){if(!e.length)return null;for(var t,r=0;r<e.length;r++){var n=e[r].values,i=e[r].type;if(t)switch(i){case"M":case"L":t[0]-n[0]>0&&(t[0]=n[0]);t[1]-n[1]>0&&(t[1]=n[1]);t[2]-n[0]<0&&(t[2]=n[0]);t[3]-n[1]<0&&(t[3]=n[1]);break;case"C":t[0]-n[4]>0&&(t[0]=n[4]);t[1]-n[5]>0&&(t[1]=n[5]);t[2]-n[4]<0&&(t[2]=n[4]);t[3]-n[5]<0&&(t[3]=n[5])}else{if("M"!=i)return null;t=n.concat(n)}}return t}(u);break;default:for(var f=e.children,g=0;g<f.length;g++)if("none"!=m(f[g],"display")){var y=Eo.svg.getBBoxSimple(f[g]);if(y){var v={l:y.x,t:y.y,r:y.x+y.width,b:y.y+y.height};if(t){isFinite(v.l)&&t.l-v.l>0&&(t.l=v.l);isFinite(v.t)&&t.t-v.t>0&&(t.t=v.t);isFinite(v.r)&&t.r-v.r<0&&(t.r=v.r);isFinite(v.b)&&t.b-v.b<0&&(t.b=v.b)}else t=v}}t=t&&[t.l,t.t,t.r,t.b]}if(!t||!isFinite(t[0])||!isFinite(t[1]))return null;isFinite(t[2])||(t[2]=t[0]);isFinite(t[3])||(t[3]=t[1]);if(m(e,"transform")){var x=e.getCTM(),C="object"==typeof Go?Go:h("svg"),L=C.createSVGPoint();L.x=t[0];L.y=t[1];L.matrixTransform(x);t[0]=L.x;t[1]=L.y;L.x=t[2];L.y=t[3];L.matrixTransform(x);t[2]=L.x;t[3]=L.y}return function(e){var t={x:e[0],y:e[1],width:e[2]-e[0],height:e[3]-e[1]};if(t.width<0){t.x=e[2];t.width=-t.width}if(t.height<0){t.y=e[3];t.height=-t.height}return t}(t)},getBBoxMerged:function(e,t){if(!e||!e.length)return{x:0,y:0,width:0,height:0};for(var r,n=0;n<e.length;n++)if(e[n]){var i=Eo.svg.getViewBBox(e[n],t);if(i.x||i.y||i.width||i.height)if(r){r.width=Math.max(i.x+i.width,r.x+r.width)-Math.min(i.x,r.x);r.height=Math.max(i.y+i.height,r.y+r.height)-Math.min(i.y,r.y);r.x=Math.min(i.x,r.x);r.y=Math.min(i.y,r.y)}else r=i}return r||{x:0,y:0,width:0,height:0}},getElementsCenter:function(e,t){if(!e||!e[0])return{x:0,y:0};var r=Eo.svg.getBBoxMerged(e,t);return{x:Eo.formatLengthSave(r.x+r.width/2),y:Eo.formatLengthSave(r.y+r.height/2)}},getBBoxFixed:function(t,r){function n(t){var r=e.getComputedStyle&&getComputedStyle(t);return!r||"none"==r.display}function i(e){for(var t,r,a,l=e.children||[].filter.call(e.childNodes,function(e){return 1===e.nodeType}),c=0,d=l.length;c<d;c++){a=l[c];if(o){if("text"==a.tagName)continue;if("g"==a.tagName){var p=m(a,"c_partid");if("part_annotation"==p||"part_pcbtext"==p)continue}}if((!s||!f(a,"pindot"))&&("none"!=m(a,"display")&&"none"!=a.style.display&&!n(a))){try{r=a.getBBox();if(!(r.width||r.height||r.x||r.y))continue}catch(e){continue}"g"==a.tagName?r=i(a):"path"==a.tagName&&(r=Eo.svg.getBBoxForPath(a));if(r&&(r.width||r.height)){if(m(a,"transform"))try{var h=a.getTransformToElement(e);r=Eo.svg.transformBox(r,h)}catch(e){}t=t?Eo.combineBox(t,r):r}}}return t||{x:0,y:0,width:0,height:0}}var a,o=r&&r.excludeText,s=r&&r.excludePindot;if("g"!=t.tagName){var l=m(t,"display")||"",c=t.style.display;m(t,"display","");t.style.display="inline !important";a="path"==t.tagName?Eo.svg.getBBoxForPath(t):Eo.svg.getBBox(t);m(t,"display",l);t.style.display=c;return a}a=Eo.svg.getBBox(t);if(!a.width&&!a.height)return a;if((a.x||a.y)&&!o)return a;a=i(t);a.width||a.height||(a=Eo.svg.getBBox(t));return a},getBBoxExcludeText:function(e){return Eo.svg.getBBoxFixed(e,{excludeText:!0})},hasBBoxBugForPath:function(){var e=t.createElement("div");e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><path d="M 0 0 C 0 100 100 0 10 10"/></svg>';t.body.appendChild(e);var r=!1;try{var n=e.querySelector("path").getBBox();r=47!=(0|n.width)||44!=(0|n.height)}catch(e){}t.body.removeChild(e);return r}(),getBBoxForPath:function(e,t){var r,n,i=Eo.svg.getBBox(e);if(!(i.width||i.height||i.x||i.y)){r=e.getPointAtLength(0);return{x:r.x,y:r.y,width:0,height:0}}if(!Eo.svg.hasBBoxBugForPath)return i;if(!/[cqst]/i.test(m(e,"d")))return i;if(navigator.userAgent.indexOf("AppleWebKit")<0)return i;n=e.getTotalLength();if(n<=0){r=e.getPointAtLength(0);return{x:r.x,y:r.y,width:0,height:0}}("number"!=typeof t||t<=0)&&(t=5);t=Math.min(.1*n,Math.max(t,.01*n));for(var a=0,o=[],s=[];a<n;){r=e.getPointAtLength(a);o.push(r.x);s.push(r.y);a+=t}r=e.getPointAtLength(n);o.push(r.x);s.push(r.y);i.x=Math.min.apply(0,o);i.y=Math.min.apply(0,s);i.width=Math.max.apply(0,o)-i.x;i.height=Math.max.apply(0,s)-i.y;return i},getViewBBox:function(e,t){var r=Eo.svg.getBBoxFixed(e,{excludeText:t});if(m(e,"transform")){var n=Go.contains(e)?Go:e.parentNode;if(n)try{var i=e.getTransformToElement(n);r=Eo.svg.transformBox(r,i)}catch(e){}}r.x=Eo.formatLengthSave(r.x);r.y=Eo.formatLengthSave(r.y);r.width=Eo.formatLengthSave(r.width);r.height=Eo.formatLengthSave(r.height);return r},setTooltip:function(e,t){if(e&&e.tagName&&e.children){var r,n;for(r=0;r<e.children.length;r++)if("title"==e.children[r].tagName){n=e.children[r];break}if(t){n||(n=e.appendChild(zt("title")));Eo.node.setTextContent(n,t)}else n&&e.removeChild(n)}},getPathHelperType:function(e){if(e&&"path"==e.tagName){for(var t=e.pathSegList,r=t.numberOfItems,n="",i=0;i<r&&i<5;i++)n+=t.getItem(i).pathSegTypeAsLetter;return"MA"==n?t.getItem(1).r1!=t.getItem(1).r2||Is!=ao.PCBLIB&&Is!=ao.PCB?"arc1":"arc2":/^(?:MALZ|MLAZ|MLLAZ?)$/.test(n)?Is==ao.PCBLIB||Is==ao.PCB?void 0:"pie1":void 0}},deletePathPointAtCdot:function(e,t){function r(e){return e.pathSegTypeAsLetter}function n(e){return{M:1,L:1,H:1,V:1,A:1,T:1,S:2,Q:2,C:3,Z:0}[e.toUpperCase()]||0}if(!(!e||"path"!=e.tagName||isNaN(t)||t<0)){if(!Eo.svg.getPathHelperType(e))for(var i=as.get(e),a=e.pathSegList,o=a.numberOfItems,s=[],l=-1,c=0;c<o;c++){var d,p,h,u,f,g=a.getItem(c),y=r(g),v=(c&&r(a.getItem(c-1)),c+1<o?r(a.getItem(c+1)):"");h=void 0===s[c]?s[c]=n(y):s[c];v&&(u=void 0===s[c+1]?s[c+1]=n(v):s[c+1]);if("M"!=y.toUpperCase()||v&&"M"!=v.toUpperCase()&&"Z"!=v){l+=h;if(!(l<t)){if(l>t)return;switch(y.toUpperCase()){case"M":f=l+u;if("M"==y){g.x=i[2*f];g.y=i[2*f+1]}else{g.x+=i[2*f]-i[2*l];g.y+=i[2*f+1]-i[2*l+1]}var x=function(e,t,n){for(var i=e.numberOfItems,a=n||0;a<i;a++){var o=r(e.getItem(a));if("M"==o||"m"==o)return a>n?-1:a;if(o==t)return a}return-1}(a,"Z",c+1);if(x>=0){p=e.createSVGPathSegLinetoAbs(i[2*l],i[2*l+1]);a.replaceItem(p,x)}a.removeItem(c+1);return;case"L":case"H":case"V":case"T":case"A":a.removeItem(c);return;case"S":case"Q":a.removeItem(c);return;case"C":switch(y+v){case"CC":d=a.getItem(c+1);d.x1=i[2*(l-2)];d.y1=i[2*(l-2)+1];a.removeItem(c);return;case"CS":g.x2=i[2*(l+1)];g.y2=i[2*(l+1)+1];a.removeItem(c+1);return;case"Cc":d=a.getItem(c+1);d.x1=i[2*(l-2)]-i[2*(l-3)];d.y1=i[2*(l-2)+1]-i[2*(l-3)+1];d.x2=i[2*(l+2)]-i[2*(l-3)];d.y2=i[2*(l+2)+1]-i[2*(l-3)+1];d.x=i[2*(l+3)]-i[2*(l-3)];d.y=i[2*(l+3)+1]-i[2*(l-3)+1];a.removeItem(c);return;case"Cs":p=e.createSVGPathSegCurvetoCubicRel(i[2*f-2],i[2*f-1]);p.x1=i[2*(l-2)]-i[2*(l-3)];p.y1=i[2*(l-2)+1]-i[2*(l-3)+1];p.x2=i[2*(l+2)]-i[2*(l-3)];p.y2=i[2*(l+2)+1]-i[2*(l-3)+1];p.x=i[2*(l+3)]-i[2*(l-3)];p.y=i[2*(l+3)+1]-i[2*(l-3)+1];a.replaceItem(p,c);a.removeItem(c+1);return;case"cC":case"cS":case"cc":case"cs":default:a.removeItem(c)}return;default:return}}}}}},fixOperaPathDAttribute:function(e){var t,r,n,i=e.pathSegList,a=i.numberOfItems,o="";for(r=0;r<a;r++){t=i.getItem(r);n=t.pathSegTypeAsLetter;switch(n.toUpperCase()){case"M":case"L":case"T":o+=n+t.x+" "+t.y;break;case"H":o+=n+t.x;break;case"V":o+=n+t.y;break;case"C":o+=n+t.x1+" "+t.y1+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"S":o+=n+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"Q":o+=n+t.x1+" "+t.y1+" "+t.x+" "+t.y;break;case"A":o+=n+t.r1+" "+t.r2+" "+t.angle+" "+ +t.largeArcFlag+" "+ +t.sweepFlag+" "+t.x+" "+t.y;break;case"Z":o+=n}}e.setAttribute("d",o)},fixOrigin:function(e){var t=m(e,"c_origin");if(t){var r=Eo.svg.getBBox(e);if(r.x||r.y||r.width||r.height){var n=t.split(","),i=+n[0],a=+n[1],o=Zo.adsorbGrid.gridSize,s=r.x+r.width/2,l=r.y+r.height/2,c=0,d=0;(i<r.x-10||i>r.x+r.width+10)&&(c=Math.round((s-i)/o));(a<r.y-10||a>r.y+r.height+10)&&(d=Math.round((l-a)/o));if(c||d){m(e,"c_origin",i+c*o+","+(a+d*o));return!0}}}},isPointInBbox:function(e,t){var r=e.x,n=e.y,i=t.x,a=t.y,o=t.width,s=t.height;return void 0!=r&&void 0!=n&&void 0!=i&&void 0!=a&&void 0!=o&&void 0!=s&&!(r<i||r>i+o||n<a||n>a+s)}};Eo.node={clearChildNodes:function(e){for(;e&&e.lastChild;)e.removeChild(e.lastChild)},getRefId:function(e){return e.nextElementSibling?e.nextElementSibling.id:e.parentNode?"<"+e.parentNode.id:""},isSame:function(e,t){if(!e||!t)return!1;var r=new XMLSerializer;return r.serializeToString(e)==r.serializeToString(t)},contains:function(e,t){return e.contains?e!=t&&e.contains(t):20==e.compareDocumentPosition(t)},children:function(e){return e.children||[].filter.call(e.childNodes,function(e){return 1===e.nodeType})},setTextContent:function(t,r){if(t)try{t.textContent=r}catch(t){try{var n=e.__TEXTCONTENT_DESCRIPTOR;if(n){var i={}.toString.call(n.set);i.indexOf("[native code]")<0&&Object.defineProperty(Node.prototype,"textContent",n)}}catch(e){}}}};var rs={move:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||rs[e.tagName](e,t,r)},g:function(e,t,r){"FOOTPRINT"===Z(e)&&cr();isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)&&(!e||"part_plane"!==m(e,"c_partid"))){if("outline3D"===m(e,"c_etype"))return te(e,t,r);for(var n=e.children,i=n.length,a=0;a<i;a++)S(rs,n[a].tagName)&&rs[n[a].tagName](n[a],t,r);var o=m(e,"c_origin");if(o){o=Eo.numberlistToArray(o);o[0]=Eo.toFixed(o[0]+t,4);o[1]=Eo.toFixed(o[1]+r,4);m(e,"c_origin",o.join(","))}}},svg:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){0!==t&&m(e,{x:+(m(e,"x")||0)+t});0!==r&&m(e,{y:+(m(e,"y")||0)+r})}},rect:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||rs.svg(e,t,r)},text:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){var n,i=+(m(e,"x")||0),a=+(m(e,"y")||0),o=m(e,"transform")||"";o&&(n=o.match(/rotate\((-?[\d.]+)[,\s].+\)/))?m(e,{x:i+t,y:a+r,transform:"rotate("+n[1]+","+(i+t)+","+(a+r)+")"}):m(e,{x:i+t,y:a+r});for(var s=p("tspan",e),l=s.length,c=0;c<l;c++)m(s[c],{x:i+t})}},image:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){var n=+(m(e,"x")||0),i=+(m(e,"y")||0),a=+m(e,"width"),o=+m(e,"height"),s=ve(e);m(e,{x:n+t,y:i+r});if(s){m(e,"transform",gt({x:n+t,y:i+r,width:a,height:o},s))}}},circle:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||m(e,{cx:+m(e,"cx")+t,cy:+m(e,"cy")+r})},ellipse:function(e,t,r){rs.circle(e,t,r)},line:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||m(e,{x1:+m(e,"x1")+t,x2:+m(e,"x2")+t,y1:+m(e,"y1")+r,y2:+m(e,"y2")+r})},polyline:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){for(var n=V(m(e,"points")).split(/[\s\,]+/g),i=0;i<n.length-1;i+=2){n[i]=Eo.toFixed(+n[i]+t,4);n[i+1]=Eo.toFixed(+n[i+1]+r,4)}m(e,{points:n.join(" ")})}},polygon:function(e,t,r){rs.polyline(e,t,r)},path:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){if(_o);!function(t,r){function n(e,t,r){e[t]=Eo.toFixed(e[t]+r,4)}for(var i=e.getPathData(),a=i.length,o=0;o<a;o++){var s=i[o],l=s.type,c=s.values;switch(l){case"M":case"L":case"T":n(c,0,t);n(c,1,r);break;case"H":n(c,0,t);break;case"V":n(c,0,r);break;case"C":n(c,0,t);n(c,1,r);n(c,2,t);n(c,3,r);n(c,4,t);n(c,5,r);break;case"S":case"Q":n(c,0,t);n(c,1,r);n(c,2,t);n(c,3,r);break;case"A":n(c,5,t);n(c,6,r)}}e.setPathData(i)}(t,r)}}},ns={rotate:function(e,t,r,n){var i,a;if(void 0===r||void 0===n)if("g"!==e.tagName||"part_annotation"==m(e,"c_partid")){i=Eo.svg.getViewBBox(e);r=Eo.toFixed(i.x+i.width/2,3);n=Eo.toFixed(i.y+i.height/2,3)}else{var o=m(e,"c_origin");if(o){a=o.split(",");r=+a[0];n=+a[1];if("TEXT"===Z(e)&&Ls.front==io.BOTTOMLAYER&&"note_pre"===m(e.childNodes[0],"c_note")){i=Eo.svg.getViewBBox(e);r=Eo.toFixed(i.x+i.width/2,3);n=Eo.toFixed(i.y+i.height/2,3)}}else{i=Eo.svg.getViewBBox(e);r=Eo.toFixed(i.x+i.width/2,3);n=Eo.toFixed(i.y+i.height/2,3)}}if("g"!=e.tagName||"part_annotation"!=m(e,"c_partid"))ns[e.tagName]&&ns[e.tagName](e,t,r,n);else if("note_package"===m(e.childNodes[0],"c_note")){var s=Eo.svg.getPlainBBox(e.parentNode),l=Eo.svg.getBBox(e),c=s.y+s.height+2,d=l.y,p=s.x-l.x,h=c-d;rs.g(e,p,h)}else ns.annotation(e,t,r,n)},groupRotate:function(e,t,r,n){var i,a,o,s,l=e.length;if(l)if(l<2)ns.rotate(e[0],t,r,n);else if(void 0===r||void 0===n){for(i=0;i<l;i++)if("text"!=e[i].tagName&&!m(e[i],"c_origin")){a=!0;break}if(a)for(i=0;i<l;i++){s=function(e){try{return e.getBBox()}catch(e){}}(e[i]);if(s)if(o){o.x=Math.min(o.x,s.x);o.y=Math.min(o.y,s.y);o.x2=Math.max(o.x2,s.x+s.width);o.y2=Math.max(o.y2,s.y+s.height)}else o={x:s.x,y:s.y,x2:s.x+s.width,y2:s.y+s.height}}else for(i=0;i<l;i++){s=function(e){if(e){var t=e.split(",");return{x:+t[0],y:+t[1]}}}(m(e[i],"c_origin"));s||"text"!=e[i].tagName||(s={x:+m(e[i],"x"),y:+m(e[i],"y")});if(s)if(o){o.x=Math.min(o.x,s.x);o.y=Math.min(o.y,s.y);o.x2=Math.max(o.x2,s.x);o.y2=Math.max(o.y2,s.y)}else o={x:s.x,y:s.y,x2:s.x,y2:s.y}}if(o){r=Eo.toFixed((o.x+o.x2)/2,3);n=Eo.toFixed((o.y+o.y2)/2,3);for(i=0;i<l;i++)ns.rotate(e[i],t,r,n)}}else for(i=0;i<l;i++)ns.rotate(e[i],t,r,n)},g:function(e,t,r,n){void 0===t&&(t=270);if(t%360!=0){var i,a,o,s,l=m(e,"c_origin");if(void 0===r||void 0===n)if(l){i=l.split(",");r=+i[0];n=+i[1]}else{a=e.getBBox();r=a.x+a.width/2|0;n=a.y+a.height/2|0}else if(l){i=l.split(",");o=[+i[0],+i[1]];o=ge(o,t,r,n);m(e,"c_origin",o.join(","))}if(l){s=+(m(e,"c_rotation")||0);s=Le(s-t);m(e,"c_rotation",s)}if("part_pin"!=m(e,"c_partid")){if("part_plane"!=m(e,"c_partid")){for(var c,d,h,u,f,g=e.children||e.childNodes,y=g.length,v=0;v<y;v++){var x=p("[c_note]",g[v]);if((Is==ao.SCH||Is==ao.SCHMODULE||Is==ao.SUBCKT)&&"g"==g[v].tagName&&x.length>0){c=m(x[0],"c_note");if("note_pre"==c){d=x[0];continue}if("note_name"==c){h=x[0];continue}if("note_verify"==c){u=x[0];continue}if("note_mounted"==c){f=x[0];continue}}ns.rotate(g[v],t,r,n)}(d||h)&&resetPositionOfPreAndName(d,h,u,f);(u||f)&&resetPositionOfVerifyAndMounted(u,f)}}else ns.pin(e,t,r,n)}},svg:function(e,t,r,n){var i=m(e,"x"),a=m(e,"y");if(void 0===r||void 0===n)ns.rotate(e,t,i,a);else if(null===i||null===a)for(var o=e.children||e.childNodes,s=o.length,l=0;l<s;l++)ns.hasOwnProperty(o[l].tagName)&&ns.rotate(o[l],t,r,n);else null!==i&&null!==a&&ns.image(e,t,r,n)},rect:function(e,t,r,n){m(e,ye({x:+m(e,"x"),y:+m(e,"y"),width:+m(e,"width"),height:+m(e,"height")},t,r,n))},text:function(e,t,r,n){void 0===t&&(t=270);var i,a,o=m(e,"text-anchor")||"start",s=m(e,"transform");i="end"==o?s?270:180:s?90:0;var l=s;l&&l.match(/[\d\.\-]+/)[0];a=Le(i-t);var c,d,h,u;c=Eo.svg.getBBox(e);if(0===c.width||0===c.height){var f={},g=+m(e,"x"),y=+m(e,"y"),v=[g,y];void 0!==r&&void 0!==n&&(v=ge(v,t,r,n));f.x=v[0];f.y=v[1];o=0===a||90==a?"start":"end";s=0===a||180==a?"":"rotate(270,"+f.x+","+f.y+")";f["text-anchor"]=o;f.transform=s;m(e,f);d=p("tspan",e);for(h=0,u=d.length;h<u;h++)m(d[h],{x:f.x})}else{var x=ft(e),C=ye(x,t,r,n),L=0===a||90==a?"start":"end",_=0===a||180==a?"":"rotate(270,"+C.x+","+C.y+")";m(e,{x:C.x,y:C.y,"text-anchor":L,transform:_});var P=ft(e),A=C.x-P.x,b=C.y-P.y,S=_?"rotate(270,"+(C.x+A)+","+(C.y+b)+")":"";m(e,{x:C.x+A,y:C.y+b,"text-anchor":L,transform:S});d=p("tspan",e);for(h=0,u=d.length;h<u;h++)m(d[h],{x:C.x+A})}},pin:function(e,t,r,n){for(var i=p("text",e),a=i[0],o=i[1],s=h("circle",e),l=m(a,"x")-m(s,"cx"),c=m(a,"y")-m(s,"cy"),d=m(o,"x")-m(s,"cx"),u=m(o,"y")-m(s,"cy"),f=e.children||e.childNodes,g=f.length,y=0;y<g;y++){var v=f[y],x=v.tagName;x&&v!=a&&v!=o&&ns[x]&&ns[x](f[y],t,r,n)}var C,L,_=+m(s,"cx"),P=+m(s,"cy"),A={},b=m(a,"text-anchor")||"start",S=m(a,"transform");C="end"==b?S?90:0:S?270:180;L=Le(C-t);y=C/90|0;var E=[l,-c,-l,c][y],O=[c,l,c,l][y];y=L/90|0;var I=[E,O,-E,O][y],T=[O,-E,O,E][y],R=_+I,w=P+T;A.x=R;A.y=w;A["text-anchor"]=0===L||90==L?"end":"start";A.transform=90==L||270==L?"rotate(270,"+R+","+w+")":"";m(a,A);y=C/90|0;var N=[d,-u,-d,u][y],k=[u,d,u,d][y];y=L/90|0;var M=[N,k,-N,k][y],B=[k,-N,k,N][y],D=_+M,V=P+B;A.x=D;A.y=V;A["text-anchor"]=0===L||90==L?"start":"end";A.transform=90==L||270==L?"rotate(270,"+D+","+V+")":"";m(o,A)},image:function(e,t,r,n){if(0!==t){var i=Eo.svg.getViewBBox(e);if(void 0===r||void 0===n){r=Eo.toFixed(i.x+i.width/2,3);n=Eo.toFixed(i.y+i.height/2,3)}var a=(m(e,"x"),m(e,"y"),+m(e,"width")||0),o=+m(e,"height")||0,s=Le(ve(e)+t),l=ye(i,t,r,n),c={x:l.x,y:l.y,c_rotation:Le(360-s)};i={x:c.x,y:c.y,width:a,height:o};c.transform=gt(i,s);m(e,c)}},circle:function(e,t,r,n){var i=[m(e,"cx"),m(e,"cy")];i=ge(i,t,r,n);m(e,{cx:i[0],cy:i[1]})},ellipse:function(e,t,r,n){var i=[m(e,"cx"),m(e,"cy")];i=ge(i,t,r,n);m(e,{cx:i[0],cy:i[1]});if(t%180!=0){var a=m(e,"rx");m(e,{rx:m(e,"ry"),ry:a})}},line:function(e,t,r,n){var i=[m(e,"x1"),m(e,"y1"),m(e,"x2"),m(e,"y2")];i=ge(i,t,r,n);m(e,{x1:i[0],y1:i[1],x2:i[2],y2:i[3]})},polyline:function(e,t,r,n){void 0===t&&(t=270);var i=V(m(e,"points")).split(/[\s\,]+/);i=ge(i,t,r,n);m(e,{points:i.join(" ")})},polygon:function(e,t,r,n){ns.polyline(e,t,r,n)},path:function(e,t,r,n){if(t%360!=0){t=Le(t);for(var i,a,o,s,l,c,d,p,h,u=_o,f=e.pathSegList,g=f.numberOfItems,y=0;y<g;y++){i=null;a=f.getItem(y);o=a.pathSegType;h=o%2==0;if(0!=o&&1!=o){if(h){s=o;l=r;c=n}else{s=o-1;l=0;c=0}switch(s){case 2:case 4:i=ge([a.x,a.y],t,l,c);a.x=i[0];a.y=i[1];break;case 6:i=ge([a.x,a.y,a.x1,a.y1,a.x2,a.y2],t,l,c);a.x=i[0];a.y=i[1];a.x1=i[2];a.y1=i[3];a.x2=i[4];a.y2=i[5];break;case 8:i=ge([a.x,a.y,a.x1,a.y1],t,l,c);a.x=i[0];a.y=i[1];a.x1=i[2];a.y1=i[3];break;case 10:i=ge([a.x,a.y],t,l,c);a.x=i[0];a.y=i[1];if(a.r1!=a.r2){a.angle=(a.angle-t)%180;if(90==a.angle||-90==a.angle){a.angle=0;var v=a.r1,x=a.r2;a.r1=x;a.r2=v}}else a.angle=0;break;case 12:if(180==t)a.x=h?r+r-a.x:-a.x;else{d=$a[t];p=h?e.createSVGPathSegLinetoVerticalAbs((a.x-r)*d+n):e.createSVGPathSegLinetoVerticalRel(a.x*d);f.replaceItem(p,y)}break;case 14:if(180==t)a.y=h?n+n-a.y:-a.y;else{d=$a[t];p=h?e.createSVGPathSegLinetoHorizontalAbs(r-(a.y-n)*d):e.createSVGPathSegLinetoHorizontalRel(-a.y*d);f.replaceItem(p,y)}break;case 16:i=ge([a.x,a.y,a.x2,a.y2],t,l,c);a.x=i[0];a.y=i[1];a.x2=i[2];a.y2=i[3];break;case 18:i=ge([a.x,a.y],t,l,c);a.x=i[0];a.y=i[1]}}}u&&Eo.svg.fixOperaPathDAttribute(e);Co&&m(e,"d",m(e,"d"))}},annotation:function(e,t,r,n){void 0===t&&(t=270);if(t%360!=0){var i,a,o,s,l,c,d,u,f,g,y,v,x,C,L=h("text",e);a=e.getBBox();o=a.x+a.width/2;s=a.y+a.height/2;i=ge([o,s],t,r,n);r=i[0];n=i[1];y=+(m(e,"c_rotation")||0);var _,P=m(L,"transform");if(P){_=P.match(/[\d\.\-]+/)[0];_!=y&&(y=_)}y=Le(y-t);m(e,"c_rotation",y);m(e,"c_origin",Eo.toFixed(r,2)+","+Eo.toFixed(n,2));switch(y){case 0:case 180:v="";break;case 90:v="270";break;case 270:v="90";break;default:return}m(L,"text-anchor","");m(L,"transform",v?"rotate("+v+","+m(L,"x")+","+m(L,"y")+")":"");l=e.getBBox();c=l.x+l.width/2;d=l.y+l.height/2;u=Eo.toFixed(+m(L,"x")+r-c,2);f=Eo.toFixed(+m(L,"y")+n-d,2);v=v?"rotate("+v+","+u+","+f+")":"";m(L,{x:u,y:f,transform:v});g=p("tspan",L);for(x=0,C=g.length;x<C;x++)m(g[x],"x",u)}}},is={point:function(e,t,r){null!==t&&(e.x=2*t-e.x);null!==r&&(e.y=2*r-e.y)},element:function(e,t,r){e.tagName&&is[e.tagName](e,t,r)},elementsFlipH:function(e,t){if(0!==e.length){var r,n;if(Is===ao.PCB&&!ka("15")&&m(e[0],"layerid")==io.MECHANICAL){var i=Si(d("pcblayerStyle").sheet,15);i.style.display=""}if(void 0===t||null===t){var a,o,s,l,c=m(e[0],"c_origin");if(c)a=o=+c.split(",")[0];else try{l=e[0].getBBox();a=l.x;o=l.x+l.width}catch(e){a=Number.MAX_VALUE;o=-Number.MAX_VALUE}for(r=0,n=e.length;r<n;r++){c=m(e[r],"c_origin");if(c){s=+c.split(",")[0];s<a?a=s:s>o&&(o=s)}else{if("none"==e[r].style.display)continue;try{l=e[r].getBBox();l.x<a&&(a=l.x);l.x+l.width>o&&(o=l.x+l.width)}catch(e){}}}t=(a+o)/2}if(Is===ao.PCB&&!ka("15")&&m(e[0],"layerid")==io.MECHANICAL){i=Si(d("pcblayerStyle").sheet,15);i.style.display="none"}for(r=0,n=e.length;r<n;r++)is[e[r].tagName](e[r],t,null)}},elementsFlipV:function(e,t){if(e.length){var r,n;if(void 0===t||null===t){var i,a,o,s,l=m(e[0],"c_origin");if(l)i=a=+l.split(",")[1];else try{s=e[0].getBBox();i=s.y;a=s.y+s.height}catch(e){Number.MAX_VALUE;-Number.MAX_VALUE}for(r=1,n=e.length;r<n;r++){l=m(e[r],"c_origin");if(l){o=+l.split(",")[1];o<i?i=o:o>a&&(a=o)}else{if("none"==e[r].style.display)continue;try{s=e[r].getBBox();s.y<i&&(i=s.y);s.y+s.height>a&&(a=s.y+s.height)}catch(e){}}}t=(i+a)/2}for(r=0,n=e.length;r<n;r++)is[e[r].tagName](e[r],null,t)}},flipH:function(e,t){if(e instanceof NodeList||Array.isArray(e))return is.elementsFlipH(e,t);if(void 0===t||null===t)try{var r=e.getBBox();t=r.x+r.width/2}catch(r){var n=e.tagName;if("rect"!=n&&"image"!=n)return;t=+m(e,"x")+m(e,"width")/2}is[e.tagName](e,t,null)},flipV:function(e,t){if(e instanceof NodeList||Array.isArray(e))return is.elementsFlipV(e,t);if(void 0===t||null===t)try{var r=e.getBBox();t=r.y+r.height/2}catch(r){var n=e.tagName;if("rect"!=n&&"image"!=n)return;t=+m(e,"y")+m(e,"height")/2}is[e.tagName](e,null,t)},g:function(e,t,r){var n,i,a,o,s=m(e,"c_origin");if(s){n=s.split(",");o={x:+n[0],y:+n[1]};is.point(o,t,r);m(e,"c_origin",o.x+","+o.y)}if("part_pin"!=m(e,"c_partid")){if("part_plane"!=m(e,"c_partid")){var l=e.children||e.childNodes;a=l.length;for(i=0;i<a;i++){var c=l[i].tagName;c&&S(ns,c)&&is[c](l[i],t,r)}m(e,"c_partid")}}else is.pin(e,t,r)},svg:{},rect:function(e,t,r){null!==t&&m(e,"x",2*t-m(e,"x")-m(e,"width"));null!==r&&m(e,"y",2*r-m(e,"y")-m(e,"height"))},text:function(e,t,r){var n=void 0!==t&&null!==t,i=void 0!==r&&null!==r;if(n||i){var a,o=ve(e),s="text-anchor";if(n){m(e,"x",2*t-m(e,"x"));if(0===o||180==o){a=m(e,s);m(e,s,"start"!=a&&a?"start":"end")}}if(i){m(e,"y",2*r-m(e,"y"));if(270==o||90==o){a=m(e,s);m(e,s,"start"!=a&&a?"start":"end")}}m(e,"transform")&&m(e,"transform","rotate("+o+","+m(e,"x")+","+m(e,"y")+")")}},pin:function(e,t,r){var n,i=p("text",e),a=i[0],o=i[1],s=h("circle",e),l=!!m(a,"transform"),c=null!==r,d={};if(l!==c)var u=m(a,"x")-m(s,"cx"),f=m(a,"y")-m(s,"cy"),g=m(o,"x")-m(s,"cx"),y=m(o,"y")-m(s,"cy");for(var v=e.children||e.childNodes,x=v.length,C=0;C<x;C++){var L=v[C],_=L.tagName;_&&L!=a&&L!=o&&is[_](v[C],t,r)}if(l==c){m(e,"c_rotation",Le((m(e,"c_rotation")||0)-180));d["text-anchor"]="end"==m(a,"text-anchor")?"start":"end";n={x:+m(a,"x"),y:+m(a,"y")};is.point(n,t,r);d.x=n.x;d.y=n.y;l&&(d.transform=m(a,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+d.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+d.y));m(a,d);d["text-anchor"]="end"==m(o,"text-anchor")?"start":"end";n={x:+m(o,"x"),y:+m(o,"y")};is.point(n,t,r);d.x=n.x;d.y=n.y;l&&(d.transform=m(o,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+d.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+d.y));m(o,d)}else{var P=+m(s,"cx"),A=+m(s,"cy");d.x=P+u;d.y=A+f;l&&(d.transform=m(a,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+d.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+d.y));m(a,d);d.x=P+g;d.y=A+y;l&&(d.transform=m(o,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+d.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+d.y));m(o,d)}},image:function(e,t,r){},circle:function(e,t,r){null!==t&&m(e,"cx",2*t-m(e,"cx"));null!==r&&m(e,"cy",2*r-m(e,"cy"))},ellipse:function(e,t,r){is.circle(e,t,r)},line:function(e,t,r){if(null!==t){m(e,"x1",2*t-m(e,"x1"));m(e,"x2",2*t-m(e,"x2"))}if(null!==r){m(e,"y1",2*r-m(e,"y1"));m(e,"y2",2*r-m(e,"y2"))}},polyline:function(e,t,r){var n,i,a=V(m(e,"points")).split(/[\s\,]+/);if(null!==t){var o=2*t;for(n=0,i=a.length-1;n<i;n+=2)a[n]=o-a[n]}if(null!==r){var s=2*r;for(n=0,i=a.length-1;n<i;n+=2)a[n+1]=s-a[n+1]}m(e,{points:a.join(" ")})},polygon:function(e,t,r){is.polyline(e,t,r)},path:function(e,t,r){if(_o)var n=!0;var i,a,o,s,l,c=e.pathSegList,d=c.numberOfItems,p=2*t,h=2*r;if(null!==t){for(l=0;l<d;l++){i=c.getItem(l);switch(i.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:case SVGPathSeg.PATHSEG_LINETO_ABS:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:i.x=p-i.x;break;case SVGPathSeg.PATHSEG_MOVETO_REL:case SVGPathSeg.PATHSEG_LINETO_REL:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:i.x=-i.x;break;case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:i.x=p-i.x;i.x1=p-i.x1;i.x2=p-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:i.x=-i.x;i.x1=-i.x1;i.x2=-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:i.x=p-i.x;i.x2=p-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:i.x=-i.x;i.x2=-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:i.x=p-i.x;i.x1=p-i.x1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:i.x=-i.x;i.x1=-i.x1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:i.x=p-i.x
;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:i.x=-i.x;break;case SVGPathSeg.PATHSEG_ARC_ABS:i.x=p-i.x;i.sweepFlag=1-i.sweepFlag;break;case SVGPathSeg.PATHSEG_ARC_REL:i.x=-i.x;i.sweepFlag=1-i.sweepFlag}}a=m(e,"c_helper_dots");if(a){o=a.split(/[\s\,]+/);for(l=0,d=o.length-1;l<d;l+=2)o[l]=p-o[l];s=o.splice(4,2);o.push(s[0],s[1]);m(e,"c_helper_dots",o.join(","))}}if(null!==r){for(l=0;l<d;l++){i=c.getItem(l);switch(i.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:case SVGPathSeg.PATHSEG_LINETO_ABS:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:i.y=h-i.y;break;case SVGPathSeg.PATHSEG_MOVETO_REL:case SVGPathSeg.PATHSEG_LINETO_REL:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:i.y=-i.y;break;case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:i.y=h-i.y;i.y1=h-i.y1;i.y2=h-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:i.y=-i.y;i.y1=-i.y1;i.y2=-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:i.y=h-i.y;i.y2=h-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:i.y=-i.y;i.y2=-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:i.y=h-i.y;i.y1=h-i.y1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:i.y=-i.y;i.y1=-i.y1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:i.y=h-i.y;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:i.y=-i.y;break;case SVGPathSeg.PATHSEG_ARC_ABS:i.y=h-i.y;i.sweepFlag=1-i.sweepFlag;break;case SVGPathSeg.PATHSEG_ARC_REL:i.y=-i.y;i.sweepFlag=1-i.sweepFlag}}a=m(e,"c_helper_dots");if(a){o=a.split(/[\s\,]+/);for(l=0,d=o.length-1;l<d;l+=2)o[l+1]=h-o[l+1];s=o.splice(4,2);o.push(s[0],s[1]);m(e,"c_helper_dots",o.join(","))}}n&&Eo.svg.fixOperaPathDAttribute(e);Co&&m(e,"d",m(e,"d"))}},as={get:function(e){var t=e.tagName;if("path"==t&&void 0!==Is&&(Is==ao.PCB||Is==ao.PCBMODULE||Is==ao.PCBLIB)){var r=Z(e);"DIMENSION"!=r&&"PROTRACTOR"!=r||(t=r)}if("g"==t&&void 0!==Is&&(Is==ao.PCB||Is==ao.PCBMODULE||Is==ao.PCBLIB)){r=Z(e);"FOOTPRINT"==r&&(t=r)}return as[t]?as[t].get.apply(e,arguments):[]},set:function(e){var t=e.tagName;if("path"==t&&void 0!==Is&&(Is==ao.PCB||Is==ao.PCBMODULE||Is==ao.PCBLIB)){var r=Z(e);"DIMENSION"!=r&&"PROTRACTOR"!=r||(t=r)}if("g"==t&&void 0!==Is&&(Is==ao.PCB||Is==ao.PCBMODULE||Is==ao.PCBLIB)){r=Z(e);"FOOTPRINT"==r&&(t=r)}as[t]&&as[t].set.apply(e,arguments)},text:{get:function(e){var t=e.getBBox(),r=t.x,n=t.y,i=t.width,a=t.height,o=[r,n,r+i,n,r+i,n+a,r,n+a];o.onlyLines=1;o.c_helper_lines=[{type:"rect",data:t}];return o},set:function(e,t,r,n,i){rs.text(e,n,i)}},g:{get:function(e){if("part_annotation"===m(e,"c_partid"))return[];var t=e.getBBox(),r=t.x,n=t.y,i=t.width,a=t.height;return[r,n,r+i,n,r,n+a,r+i,n+a]},set:function(e,t,r,n,i){rs.g(e,n,i)}},svg:{get:function(e){return as.rect.get(e)},set:function(e,t,r,n,i){return as.rect.set(e,t,r,n,i)}},image:{get:function(e){var t=Eo.svg.getViewBBox(e),r=[t.x,t.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height];r.c_helper_lines=[{from:0,to:1},{from:1,to:2},{from:2,to:3},{from:3,to:0}];return r},set:function(e,t,r,n,i){var a={x:t[0],y:t[1],width:t[2]-t[0],height:t[5]-t[1]};if(0===r||3==r){a.x+=n;a.width-=n}if(0===r||1==r){a.y+=i;a.height-=i}1!=r&&2!=r||(a.width+=n);2!=r&&3!=r||(a.height+=i);if(0!==a.width&&0!==a.height){if(a.width<0){a.width=-a.width;a.x-=a.width}if(a.height<0){a.height=-a.height;a.y-=a.height}var o=ve(e);90!=o&&270!=o||(a.width=[a.height,a.height=a.width][0]);a.transform=o?gt(a,o):"";m(e,a)}}},rect:{get:function(e){var t=+m(e,"x"),r=+m(e,"y"),n=+m(e,"width"),i=+m(e,"height");return[t,r,t+n,r,t+n,r+i,t,r+i]},set:function(e,t,r,n,i){t||(t=as.rect.get(e));var a={x:t[0],y:t[1],width:t[2]-t[0],height:t[5]-t[1]};if(0===r||3==r){a.x+=n;a.width-=n}if(0===r||1==r){a.y+=i;a.height-=i}1!=r&&2!=r||(a.width+=n);2!=r&&3!=r||(a.height+=i);if(0!==a.width&&0!==a.height){if(a.width<0){a.width=-a.width;a.x-=a.width}if(a.height<0){a.height=-a.height;a.y-=a.height}m(e,a)}}},circle:{get:function(e){var t=+m(e,"cx"),r=+m(e,"cy"),n=+m(e,"r");return[t,r,t,r-n,t,r+n,t-n,r,t+n,r]},set:function(e,t,r,n,i){t||(t=as.circle.get(e));var a={cx:t[0],cy:t[1],r:t[1]-t[3]};if(0===r){a.cx+=n;a.cy+=i}1==r&&(a.r-=i);2==r&&(a.r+=i);3==r&&(a.r-=n);4==r&&(a.r+=n);if(0!==a.r){a.r<0&&(a.r=-a.r);m(e,a)}}},ellipse_0:{get:function(e){var t=+m(e,"cx"),r=+m(e,"cy"),n=+m(e,"rx"),i=+m(e,"ry");return[t,r,t,r-i,t,r+i,t-n,r,t+n,r]},set:function(e,t,r,n,i){t||(t=as.ellipse_0.get(e));var a={cx:t[0],cy:t[1],rx:t[0]-t[6],ry:t[1]-t[3]};if(0===r){a.cx+=n;a.cy+=i}1==r&&(a.ry-=i);2==r&&(a.ry+=i);3==r&&(a.rx-=n);4==r&&(a.rx+=n);if(0!==a.rx&&0!==a.ry){a.rx<0&&(a.rx=-a.rx);a.ry<0&&(a.ry=-a.ry);m(e,a)}}},ellipse:{get:function(e){var t=+m(e,"cx"),r=+m(e,"cy"),n=+m(e,"rx"),i=+m(e,"ry");return[t-n,r-i,t+n,r-i,t-n,r+i,t+n,r+i]},set:function(e,t,r,n,i){t||(t=as.ellipse.get(e));var a={cx:(t[0]+t[2])/2,cy:(t[1]+t[5])/2,rx:(t[2]-t[0])/2,ry:(t[5]-t[1])/2};a.cx+=n/2;a.cy+=i/2;0===r||2==r?a.rx-=n/2:a.rx+=n/2;0===r||1==r?a.ry-=i/2:a.ry+=i/2;if(0!==a.rx&&0!==a.ry){a.rx<0&&(a.rx=-a.rx);a.ry<0&&(a.ry=-a.ry);m(e,a)}}},line:{get:function(e){return[+m(e,"x1"),+m(e,"y1"),+m(e,"x2"),+m(e,"y2")]},set:function(e,t,r,n,i){t||(t=as.line.get(e));var a={x1:t[0],y1:t[1],x2:t[2],y2:t[3]};if(0===r){a.x1+=n;a.y1+=i}if(1==r){a.x2+=n;a.y2+=i}m(e,a)}},polyline:{get:function(e){for(var t=V(m(e,"points")).split(/[\s\,]+/g),r=0;r<t.length;r++)t[r]=+t[r];for(r=t.length-2;r>=2;r-=2)t.splice(r,0,(t[r-2]+t[r])/2,(t[r-1]+t[r+1])/2);t.lightDots="odd";return t},set:function(e,t,r,n,i){var a=t.slice(0);a[2*r]+=n;a[2*r+1]+=i;if(r%2&&(!_e(2*a[2*r],a[2*r-2]+a[2*r+2])||!_e(2*a[2*r+1],a[2*r-1]+a[2*r+3]))){a.splice(2*r+2,0,0,0);a.splice(2*r,0,0,0)}for(var o=4,s=a.slice(0,2);o<a.length-1;o+=4)s.push(a[o],a[o+1]);for(var l=!0,c=2;c<s.length-1;c+=2)if(s[c]!=s[0]||s[c+1]!=s[1]){l=!1;break}if(!l){m(e,{points:Eo.fixLongNumberString(s.join(" "))})}}},polygon:{get:function(e){for(var t=V(m(e,"points")).split(/[\s\,]+/g),r=0;r<t.length;r++)t[r]=+t[r];for(r=t.length-2;r>=2;r-=2)t.splice(r,0,(t[r-2]+t[r])/2,(t[r-1]+t[r+1])/2);r=t.length-2;t.push((t[0]+t[r])/2,(t[1]+t[r+1])/2);t.lightDots="odd";return t},set:function(e,t,r,n,i){var a,o=t.slice(0),s=2*r;o[s]+=n;o[s+1]+=i;if(r==o.length/2-1)_e(2*o[s],o[0]+o[s-2])&&_e(2*o[s+1],o[1]+o[s-1])||o.splice(s,0,0,0);else if(r%2&&(!_e(2*o[s],o[s-2]+o[s+2])||!_e(2*o[s+1],o[s-1]+o[s+3]))){o.splice(s+2,0,0,0);o.splice(s,0,0,0)}for(s=4,a=o.slice(0,2);s<o.length-1;s+=4)a.push(o[s],o[s+1]);for(var l,c={},d=[],p=0;p<a.length-1&&d.length<4;p+=2){l=a[p]+"_"+a[p+1];if(!c[l]){c[l]=!0;d.push(p)}}if(!(d.length<=2)){var h,u,f,g,y,v,x=!0;for(r=2;r<d.length;r++){h=a[d[0]],u=a[d[0]+1],f=a[d[1]],g=a[d[1]+1],y=a[d[r]],v=a[d[r]+1];if(!_e((h-f)*(v-g),(y-f)*(u-g))){x=!1;break}}if(!x){m(e,{points:Eo.fixLongNumberString(a.join(" "))})}}}},path:{get:function(e){var t=Eo.svg.getPathHelperType(e);if(t){var r=e.tagName+"_"+t;if(as[r]&&as[r].get)return as[r].get.apply(e,arguments)}var n,i,a,o,s,l,c,d,p,h,u=e.pathSegList,f=u.numberOfItems,g=0,y=0,v=[],x=0,m=0,C=[];for(n=0;n<f;n++){a=u.getItem(n);o=a.pathSegType;0===n&&2!=o&&3!=o&&1!=o&&v.push(g,y);i=v.length/2-1;switch(o){case 1:g=x;y=m;break;case 2:g=a.x;y=a.y;x=g;m=y;if(n+1==f)break;c=u.getItem(n+1);l=c.pathSegType;if(2==l||3==l||1==l)break;v.push(g,y);4==l&&v.push((g+c.x)/2,(y+c.y)/2);break;case 4:v.push(g=a.x,y=a.y);if(n+1==f)break;c=u.getItem(n+1);l=c.pathSegType;1==l&&(c=u.getItem(0));4!=l&&1!=l||v.push((g+c.x)/2,(y+c.y)/2);break;case 12:v.push(g=a.x,y);break;case 14:v.push(g,y=a.y);break;case 6:C.push({from:i,to:i+1},{from:i+2,to:i+3});v.push(a.x1,a.y1,g=a.x2,y=a.y2,a.x,a.y);break;case 16:C.push({from:i+1,to:i+2});v.push(a.x2,a.y2,g=a.x,y=a.y);break;case 8:C.push({from:i,to:i+1},{from:i+1,to:i+2});v.push(a.x1,a.y1,g=a.x,y=a.y);break;case 18:case 10:s=u.getItem(n-1);d=Eo.arc.getCenterParam(s.x,s.y,a.x,a.y,a.largeArcFlag?1:0,a.sweepFlag?1:0,a.r1,a.r2,a.angle);p=d.cx,oy=d.cy;h=xe([s.x,s.y],[p,oy],d.delta_theta/2);v.push(h[0],h[1]);v.push(g=a.x,y=a.y);if(n+1==f)break;c=u.getItem(n+1);l=c.pathSegType;1==l&&(c=u.getItem(0));4!=l&&1!=l||v.push((g+c.x)/2,(y+c.y)/2);break;case 3:g+=a.x;y+=a.y;x=g;m=y;if(n+1==f)break;l=u.getItem(n+1).pathSegType;if(2==l||3==l||1==l)break;v.push(g,y);break;case 5:v.push(g+=a.x,y+=a.y);break;case 13:v.push(g+=a.x,y);break;case 15:v.push(g,y+=a.y);break;case 7:C.push({from:i,to:i+1},{from:i+2,to:i+3});v.push(g+a.x1,y+a.y1,g+a.x2,y+a.y2,g+=a.x,y+=a.y);break;case 17:C.push({from:i+1,to:i+2});v.push(g+a.x2,y+a.y2,g+=a.x,y+=a.y);break;case 9:C.push({from:i+1,to:i+2});v.push(g+a.x1,y+a.y1,g+=a.x,y+=a.y);break;case 19:case 11:v.push(g+=a.x,y+=a.y)}a.pathSegType}C.length?v.c_helper_lines=C:v.lightDots="odd";return v},set:function(e,t,r,n,i,a){if(0!==n||0!==i){var o=Eo.svg.getPathHelperType(e);if(o){var s=e.tagName+"_"+o;if(as[s]&&as[s].set){as[s].set.apply(e,arguments);return}}var l,c,d;if(/[^ahvqtsc]/i.test(a)){l=!0;c=t.slice(0);if(2*r+1<c.length){c[2*r]+=n;c[2*r+1]+=i}for(d=2;d<c.length-1;d+=2)if(c[d]!=c[0]||c[d+1]!=c[1]){l=!1;break}if(l)return}var p,h,u,f,g,y,v,x,C,L,_,P,A,b=e.pathSegList,S=b.numberOfItems,E=-1,O=r,I=m(e,"d");a&&m(e,{d:a});t.c_helper_lines||(r>>=1);if(!t.c_helper_lines&&O%2){h=b.getItem(r+1);if(10==h.pathSegType){u=b.getItem(r);g=t[2*O];y=t[2*O+1];v=ae({x:u.x,y:u.y},{x:h.x,y:h.y},{x:g+n,y:y+i});v<4&&(v=4);v=Math.sqrt(v);x=h.sweepFlag;C=h.r1;L=ue(u.x,u.y,h.x,h.y);C*C-L/4;_=(h.x-u.x)*(y-u.y)-(g-u.x)*(h.y-u.y);P=(h.x-u.x)*(y+i-u.y)-(g+n-u.x)*(h.y-u.y);_*P<0&&(x^=1);C=L/(8*v)+v/2;A=C>v?0:1;C=Eo.formatLengthSave(C);h.r1=C;h.r2=C;h.largeArcFlag=A;h.sweepFlag=x}else b.insertItemBefore(e.createSVGPathSegLinetoAbs(t[2*O]+n,t[2*O+1]+i),r+1)}else{e:for(p=0;p<S;p++){h=b.getItem(p);switch(h.pathSegType){case 1:break;case 2:case 3:if(p+1==S)break;f=b.getItem(p+1).pathSegType;if(2==f||3==f||1==f)break;E++;if(E==r){h.x=Eo.toFixed(h.x+n,3);h.y=Eo.toFixed(h.y+i,3);break e}break;case 4:case 5:E++;if(E==r){h.x=Eo.toFixed(h.x+n,3);h.y=Eo.toFixed(h.y+i,3);break e}break;case 12:case 13:E++;if(E==r){h.x+=n;break e}break;case 14:case 15:E++;if(E==r){h.y+=i;break e}break;case 6:case 7:E++;if(E==r){h.x1+=n;h.y1+=i;break e}E++;if(E==r){h.x2+=n;h.y2+=i;break e}E++;if(E==r){h.x+=n;h.y+=i;break e}break;case 16:case 17:E++;if(E==r){h.x2+=n;h.y2+=i;break e}E++;if(E==r){h.x+=n;h.y+=i;break e}break;case 8:case 9:E++;if(E==r){h.x1+=n;h.y1+=i;break e}E++;if(E==r){h.x+=n;h.y+=i;break e}break;case 18:case 19:case 11:case 10:E++;if(E==r){h.x+=n;h.y+=i;break e}}}var T=Z(e);"COPPERAREA"!=T&&"SOLIDREGION"!=T||Er(e)||m(e,"d",I)}}else a&&m(e,{d:a})}},path_arc1:{get:function(e){var t=Eo.arc.calculateArcHelperDots(e);t.c_helper_lines=Eo.arc.c_helper_lines;return t},set:function(e,t,r,n,i,a){var o,s,l,c,d=t?t.slice(0):as.path_arc1.get(e),p=!(Is==ao.PCBLIB||Is==ao.PCB);if(0===r){a&&m(e,{d:a});Eo.Dots.eachAdd(d,n,i);rs.path(e,n,i)}else{d[2*r]+=n;d[2*r+1]+=i;o=Math.abs(d[0]-d[2]);s=Math.abs(d[1]-d[3]);if(0===o||0===s)return;if(p){o=Math.abs(d[0]-d[2]);s=Math.abs(d[1]-d[3])}else o=s=fe(d[0],d[1],d[2],d[3]);l=Eo.arc.getArcParams(d[0],d[1],o,s,d[4],d[5],d[6],d[7]);if(null===l)return;l.x1=Eo.formatLengthSave(l.x1);l.y1=Eo.formatLengthSave(l.y1);o=Eo.formatLengthSave(o);s=Eo.formatLengthSave(s);l.x2=Eo.formatLengthSave(l.x2);l.y2=Eo.formatLengthSave(l.y2);c="M"+l.x1+","+l.y1+" A"+o+","+s+" 0 "+l.fa+" "+l.fs+" "+l.x2+","+l.y2;m(e,{d:c})}m(e,{c_helper_dots:d.join(",")})}},path_arc2:{get:function(e){var t,r=[],n=e.getPathData();for(t=0;t<n.length;t++)if("A"==n[t].type){var i=n[t-1].values,a=n[t].values,o=Eo.arc.getCenterParam(i[0],i[1],a[5],a[6],a[3],a[4],a[0],a[1],a[2]),s=o.cx,l=o.cy,c=xe([i[0],i[1]],[s,l],o.delta_theta/2);r.push(i[0],i[1],a[5],a[6],c[0],c[1]);break}return r},set:function(e,t,r,n,i,a){if(0!==n||0!==i){var o,s,l,c=t?t.slice(0):as.path_arc2.get(e);if(!(0===r&&_e(c[0]+n,c[2])&&_e(c[1]+i,c[3])||1===r&&_e(c[2]+n,c[0])&&_e(c[3]+i,c[1])||2===r&&_e((c[2]-c[0])*(c[5]+i-c[1]),(c[3]-c[1])*(c[4]+n-c[0])))){if(2===r){o=ae({x:c[0],y:c[1]},{x:c[2],y:c[3]},{x:c[4]+n,y:c[5]+i});if(o<4)return;o=Math.sqrt(o)}a&&m(e,"d",a);var d=e.pathSegList.getItem(1),p=d.r1,h=+d.largeArcFlag,u=+d.sweepFlag,f=ue(c[0],c[1],c[2],c[3]),g=p*p-f/4;if(2==r){s=(c[2]-c[0])*(c[5]-c[1])-(c[4]-c[0])*(c[3]-c[1]);c[2*r]+=n;c[2*r+1]+=i;l=(c[2]-c[0])*(c[5]-c[1])-(c[4]-c[0])*(c[3]-c[1]);s*l<0&&(u^=1)}else{o=p+(h?1:-1)*(g>0?Math.sqrt(g):0);c[2*r]+=n;c[2*r+1]+=i;f=ue(c[0],c[1],c[2],c[3])}p=f/(8*o)+o/2;h=p>o?0:1;c[0]=Eo.formatLengthSave(c[0]);c[1]=Eo.formatLengthSave(c[1]);p=Eo.formatLengthSave(p);c[2]=Eo.formatLengthSave(c[2]);c[3]=Eo.formatLengthSave(c[3]);m(e,"d","M"+c[0]+","+c[1]+" A"+p+","+p+" 0 "+h+" "+u+" "+c[2]+","+c[3])}}else a&&m(e,{d:a})}},path_pie1:{get:function(e){var t=Eo.arc.calculateArcHelperDots(e);t.c_helper_lines=Eo.arc.c_helper_lines_pie1;return t},set:function(e,t,r,n,i,a){var o=t?t.slice(0):as.path_pie1.get(e);if(0===r){a&&m(e,{d:a});Eo.Dots.eachAdd(o,n,i);rs.path(e,n,i)}else{o[2*r]+=n;o[2*r+1]+=i;var s=Math.abs(o[0]-o[2]),l=Math.abs(o[1]-o[3]);if(0===s||0===l)return;var c=Eo.arc.getArcParams(o[0],o[1],s,l,o[4],o[5],o[6],o[7]);if(!c)return;c.x1=Eo.formatLengthSave(c.x1);c.y1=Eo.formatLengthSave(c.y1);s=Eo.formatLengthSave(s);l=Eo.formatLengthSave(l);c.x2=Eo.formatLengthSave(c.x2);c.y2=Eo.formatLengthSave(c.y2);m(e,{d:"M"+o[0]+","+o[1]+" L"+c.x1+","+c.y1+" A"+s+","+l+" 0 "+c.fa+" "+c.fs+" "+c.x2+","+c.y2+"Z"})}}},DIMENSION:{get:function(e){return ls.getStartAndEndPointByDimensionElement(e)},set:function(e,t,r,n,i,a){if(!(t.length<4)){var o=t.slice(2*r,2*r+1+1),s=r>0?[t[0],t[1]]:[t[2],t[3]],l=m(e,"c_fontSize"),c=m(e,"c_unit"),d=m(e,"c_precision"),p=m(e,"layerid")==io.BOTTOMSILKLAYER;m(e,"d",ls.getDimensionPath({fromP:{x:s[0],y:s[1]},toP:{x:o[0]+n,y:o[1]+i},fontSize:l,precision:d,unit:c,mirror:p}));sr("updateAttrPanel")}}},PROTRACTOR:{getAngle:function(e){var t=as.PROTRACTOR.get(e),r=fe(t[0],t[1],t[2],t[3]),n=fe(t[0],t[1],t[4],t[5]),i=fe(t[2],t[3],t[4],t[5]),a=(Math.pow(n,2)+Math.pow(r,2)-Math.pow(i,2))/(2*r*n);return(180*Math.acos(a)/Math.PI).toFixed(3)},get:function(e){var t=e.getPathData();return t.length<7?[]:t[0].values.concat(t[1].values,t[3].values,t[6].values)},setAngle:function(e,t){t%=360;t>180&&(t-=180);points=as.get(e);var r=je({x:points[4],y:points[5]},{x:points[0],y:points[1]},{x:points[2],y:points[3]}),n=180*Math.atan((points[3]-points[1])/(points[2]-points[0]))/Math.PI,i=n>0;n=points[2]>points[0]?n:n>0?180-n:180+n;var a=t-as.PROTRACTOR.getAngle(e);"顺时针"===r&&points[2]>points[0]&&(a*=-1);points[2]<points[0]&&i&&"逆时针"===r&&(a*=-1);points[2]<points[0]&&!i&&"顺时针"===r&&(a*=-1);var o=n+a;points[2]<points[0]&&i&&(o*=-1);var s=fe(points[0],points[1],points[2],points[3]),l=Math.cos(o*Math.PI/180)*s,c=Math.sin(o*Math.PI/180)*s,d=points[0]+l,p=points[1]+c,h=d-points[2],u=p-points[3];as.PROTRACTOR.set(e,points,1,h,u);dn(as.get(e))},set:function(e,t,r,n,i,a){var o;if(!(t.length<8)){var s=[t[0],t[1]],l=[t[2],t[3]],c=[t[4],t[5]],d=[],p=m(e,"c_fontSize"),h=m(e,"c_precision"),u=m(e,"layerid")==io.BOTTOMSILKLAYER;if(0===r){s[0]+=n;s[1]+=i}else if(1===r){l[0]+=n;l[1]+=i}else if(2===r){c[0]+=n;c[1]+=i}else{if(3!==r)return;d[0]=t[6]+n;d[1]=t[7]+i}o=ls.getProtractorPath(s,l,c,{fontPoint:d,fontSize:p,canAdjustLineLength:!0,precision:h,mirror:u});if(o){m(e,"d",o);sr("updateAttrPanel")}}}},FOOTPRINT:{get:function(e){if("part_annotation"===m(e,"c_partid"))return[];var t=m(e,"id"),r=m(e,"c_origin"),n=m(e,"layerid"),i=m(e,"c_rotation"),a=r.split(","),o=+a[0],s=+a[1];null==i&&(i=0);var l={};if(S(To,t)){if((o!==To[t].co.x||s!==To[t].co.y||To[t].layer!==n)&&!Io.on){ns.g(e,parseFloat(i).toFixed(2));l=Eo.svg.getPlainBBox(e);c=0;e.childNodes.forEach(function(e){"part_pad"!==m(e,"c_partid")||"1"!==m(e,"layerid")&&"2"!==m(e,"layerid")||e.childNodes.forEach(function(e){"TRACK"===Z(e)&&(c=+m(e,"stroke-width")/2)})});l.x-=c;l.width+=2*c;To[t]=l;To[t].co={x:o,y:s};To[t].layer=n;ns.g(e,360-parseFloat(i).toFixed(2))}l=To[t]}else{ns.g(e,parseFloat(i).toFixed(2));l=Eo.svg.getPlainBBox(e);var c=0;e.childNodes.forEach(function(e){"part_pad"!==m(e,"c_partid")||"1"!==m(e,"layerid")&&"2"!==m(e,"layerid")||e.childNodes.forEach(function(e){"TRACK"===Z(e)&&(c=+m(e,"stroke-width")/2)})});l.x-=c;l.width+=2*c;To[t]=l;To[t].co={x:o,y:s};To[t].layer=n;ns.g(e,360-parseFloat(i).toFixed(2))}var d={dots1:[l.x-.5,l.y-.5],centP1:[o,l.y+.5],dots2:[l.x+l.width+.5,l.y-.5],centP2:[l.x+l.width+.5,s],dots3:[l.x-.5,l.y+l.height+.5],centP3:[o,l.y+l.height+.5],dots4:[l.x+l.width+.5,l.y+l.height+.5],centP4:[l.x-.5,s]},p=[o,l.y-5],h=[o,s],u=Ce(p,h,i),f=Ce(d.dots1,h,parseFloat(i).toFixed(2)),g=Ce(d.dots2,h,parseFloat(i).toFixed(2)),y=Ce(d.dots3,h,parseFloat(i).toFixed(2)),v=Ce(d.dots4,h,parseFloat(i).toFixed(2)),x=Ce(d.centP1,h,parseFloat(i).toFixed(2)),C=Ce(d.centP2,h,parseFloat(i).toFixed(2)),L=Ce(d.centP3,h,parseFloat(i).toFixed(2)),_=Ce(d.centP4,h,parseFloat(i).toFixed(2)),P=[u[0],u[1],o,s,f[0],f[1],x[0],x[1],g[0],g[1],C[0],C[1],y[0],y[1],L[0],L[1],v[0],v[1],_[0],_[1]];P.c_helper_lines=[{from:0,to:1},{from:2,to:4},{from:4,to:8},{from:8,to:6},{from:6,to:2},{from:3,to:7},{from:5,to:9}];P.visible_dots=[0,1,2,3,4,5,6,7,8,9];P.isRotate=!0;return P},set:function(e,t,r,n,i){if(0===r){m(fs.children[0],{visibility:"hidden"});var a=m(e,"c_rotation")||0,o=0,s=t[0]+n,l=t[1]+i,c=s-t[2],d=l-t[3],p=Math.sqrt(Math.pow(c,2)+Math.pow(d,2)),h=c/p,u=Math.acos(h),f=180/(Math.PI/u);d>0&&(f=360-f);var g;o=360-(90-f);o=Eo.toFixed(o,0);if(isNaN(o))return"";g=Le(360-(parseFloat(o).toFixed(1)-parseFloat(a).toFixed(1)));ns.g(e,g);sr("updateAttrPanel")}else{var y=m(e,"c_origin"),v=y.split(",");yr(e,Number(v[0])+n,Number(v[1])+i)}}},alwaysNotSnap:function(e,t){var r=as.getHelperType(e);return r&&(("arc1"==r||"pie1"==r)&&(2==t||3==t)||"arc2"==r&&2==t)},getHelperType:function(e){var t=m(e,"c_helper_type");if(t)return t;if("path"==e.tagName){var r=e.pathSegList,n=r.numberOfItems;if(2==n&&"A"==r.getItem(1).pathSegTypeAsLetter)return Is==ao.PCB||Is==ao.PCBLIB?"arc2":"arc1";if(4==n&&"L"==r.getItem(1).pathSegTypeAsLetter&&"A"==r.getItem(2).pathSegTypeAsLetter)return"pie1"}return""}},os={_PCBSnapStack:[.2,.25,.5,1,1.25,2.5,5,10],altKeyEnabled:!1,getSanpSize:function(e){return os.altKeyEnabled?+Zo.adsorbGrid.altSnapSize||1:+Zo.adsorbGrid["distance"+e]||1},getPCBSnapSizeList:function(){var e=Zo.canvas.unit,t="";os._PCBSnapStack.forEach(function(r){t+='<option value="'+Eo.toFixed(Eo.units.convert(r,"pixel",e),Eo.units.decimals[e])+'">'});return t}},ss=function(){function e(){if(!n){n=!0;t=d("gControlLocks");r=t&&h("g",t);var e=function(){};for(var o in i)S(i,o)&&(a[o]=r||"function"!=typeof i[o]?i[o]:e);r&&t.addEventListener("click",function(e){var t=e.target.parentNode.id,r=t&&d(t.replace("lock",""));r&&i.unlockObjs([r])},!1)}}var t,r,n,i={attName:"locked",init:e,isLocked:function(e){return"1"===m(e,"locked")},updateOne:function(e){e&&Ka.contains(e)&&i.isLocked(e)?i.lockObjs([e]):i.unlockObjs([e])},updateMore:function(e){for(var t=0;t<e.length;t++)e[t]&&i.updateOne(e[t])},createLockUi:function(e){!e||e.length},lockObjs:function(e){ss.setLockStatus(e,!0);sr("triggerEvent",["select_change"])},unlockObjs:function(e){ss.setLockStatus(e,!1);sr("triggerEvent",["select_change"])},setLockStatus:function(e,r){if(1===arguments.length){r=e;e=void 0}var n=e||un();if(n&&n.length){var a=r?1:"",o=[].map.call(n,function(e){if(m(e,"locked")!=a)return e.id}).join(",");m(n,"locked",a);Fo.updateMore(n,{notCopper:!0,noRebuildPlane:!0});if(a)i.createLockUi(n);else for(var s=0;s<n.length;s++){var l=d("lock"+n[s].id,t);l&&t.removeChild(l)}zo.save(["attr",o,{locked:r?"":"1"},{locked:a}])}},resize:function(){for(var e=p('g:not([display="none"])',t),r=20/wo,n=0;n<e.length;n++){var i=h("rect",e[n]),a={x:+m(i,"x"),y:+m(i,"y"),width:+m(i,"width"),height:+m(i,"height")};m(h("use",e[n]),{x:a.width>r?a.x:a.x+(a.width-r)/2,y:a.y-r,width:r,height:r})}}},a={};for(var o in i)S(i,o)&&("function"==typeof i[o]?a[o]=function(t,a){return function(){n||e();return r?a.apply(i,arguments):void 0}}(0,i[o]):a[o]=i[o]);return a}();!function(){function e(r){this.ready=0;this.start=0;if(r)for(var n in r)S(r,n)&&(this[n]=r[n]);e.instance=this;t.addEventListener("mousedown",this.mdown,!1)}e.prototype={mdown:function(r){var n=e.instance;1==r.button&&r.preventDefault();if((r.button===no||1===r.button)&&!(r.ctrlKey||r.metaKey||r.shiftKey||r.altKey)&&r.target!=t.documentElement&&Go.contains(r.target)&&!n.ready){(Is==ao.PCB||Is==ao.PCBMODULE)&&yo.showAll();var i=r.clientX,a=r.clientY;n.lastX=i;n.lastY=a;n.ready=1;n.start=0;n.helperCursorBefore=Jo;ur("grabbing");t.addEventListener("mousemove",n.mmove,!1);t.addEventListener("mouseup",n.mup,!1);t.addEventListener("contextmenu",n.contextmenu,!1)}},contextmenu:function(t){var r=e.instance;r.ready&&!t.defaultPrevented&&r.mupRight(t)},mmove:function(t){var r=e.instance;if(r.ready&&(!t.buttons||6&t.buttons)){var n=t.clientX,i=t.clientY,a=n-r.lastX,o=i-r.lastY;if(!r.start){if(a*a+o*o<=36)return}r.lastX=n;r.lastY=i;if(!r.start){lo.dragpanning=!0;r.start=1;r.rootcursor=f(Go,"cursor-none");r.ondragstart&&r.ondragstart({dx:a,dy:o,originalEvent:t})}r.ondrag&&r.ondrag({dx:a,dy:o,originalEvent:t})}},mup:function(t){var r=e.instance;t.button!==no&&1!==t.button||r.mupRight(t)},mupRight:function(r){var n=e.instance;if(n.ready){t.removeEventListener("mousemove",n.mmove,!1);t.removeEventListener("mouseup",n.mup,!1);t.removeEventListener("contextmenu",n.contextmenu,!1);var i=n.start;n.ready=0;n.start=0;if("grabbing"==Jo){var a=n.helperCursorBefore;a?n.rootcursor?ur(a,!0):ur(a):ur()}i&&n.ondragend&&n.ondragend({originalEvent:r})}}};ho=function(){po=new e({ondrag:function(e){var t=e.dx,r=e.dy,n=ms.getViewBox();n[0]-=t/wo;n[1]-=r/wo;ms.setViewBox(n)},ondragend:function(e){lo.dragpanning=!0;setTimeout(function(){lo.dragpanning=!1},5)}})}}();zo.records=[];zo.timestamps=[];zo._queueBatchRecords=[];zo.maxLength=120;zo.index=-1;zo.savedIndex=-1;zo.fileWaitingforSaving=!1;zo.logs=[];zo.log=function(e){zo.logs.push(e);zo.logs.length>zo.maxLength&&zo.logs.shift()};zo.getLogs=function(){return{index:zo.index,records:JSON.parse(JSON.stringify(zo.records,function(e,t){return t instanceof Element?serializeNode(t):t}))}};zo.log("begin");zo.XMLSerializer=e.XMLSerializer?new XMLSerializer:{serializeToString:function(){}};zo.DOMParser=e.DOMParser?new DOMParser:{parseFromString:function(){}};zo.save=function(e,t){if(Array.isArray(e))if(zo.batchState)Array.isArray(e)&&Array.isArray(e[0])?[].push.apply(zo._queueBatchRecords,e):zo._queueBatchRecords.push(e);else{zo.log(e.concat(t?"mergeSource:"+t:[]));if(t&&t===zo.lastMergeSource){var r=zo.records[zo.index],n=r[0],i=r[1],a=r[2];if(n===e[0]&&i===e[1]){zo.records.pop();zo.index--;e[2]=a}}else zo.lastMergeSource=t||"";var o=zo.records.length;if(zo.index>=zo.maxLength-1){zo.records.shift();zo.savedIndex>-1&&(zo.savedIndex-=1)}else zo.index++;zo.timestamps[zo.index]=Date.now();zo.records[zo.index]=e;zo.records.length=zo.index+1;var s=zo.needSetUnSaved();(o>zo.records.length||o==zo.records.length&&o!=zo.maxLength)&&(zo.fileWaitingforSaving=!0);sr("triggerEvent",["history_change",zo.records.length,zo.index,s,zo.fileWaitingforSaving]);zo.walkRecord(e,function(e){var t=zo.ids2elems(e[1]);if(t&&t[0]){var r=e[0];"del"!=r&&"add"!=r||1===t.length&&!e[2]&&Ka.contains(t[0])&&(e[2]=Eo.node.getRefId(t[0]))}})}else Eo.reportError(new Error("History.save :: first argument is not an array"))};zo.walkRecord=function(e,t){Array.isArray(e[0])?e.forEach(t):t(e)};zo.needSetUnSaved=function(){if(zo.index!=zo.savedIndex){for(var e=Math.min(zo.index,zo.savedIndex),t=Math.max(zo.index,zo.savedIndex),r=e+1;r<=t;r++){var n=zo.records[r];if(!n||n&&void 0!=n[n.length-1]&&!n[n.length-1].notChangeSaveState)return!0}return!1}return!1};zo.startBatch=function(){zo.batchState=zo.batchState+1||1};zo.saveBatch=function(){zo.batchState>0&&(zo.batchState-=1);if(!zo.batchState&&zo._queueBatchRecords.length){zo.save(zo._queueBatchRecords.slice(0));zo._queueBatchRecords.length=0}};zo.clear=function(e){var t=e&&!1===e.saved;zo.logs.length=0;zo.log("clear");zo.timestamps.length=0;zo.records.length=0;zo.index=-1;zo.savedIndex=t?-2:zo.index;zo.fileWaitingforSaving=t;zo.batchState=void 0;sr("triggerEvent",["history_change",zo.records.length,zo.index,t,zo.fileWaitingforSaving]);for(;Ro.lastChild;)Ro.removeChild(Ro.lastChild)};zo.goTo=function(e){var t;if(e>=-1&&e!==zo.index&&e<zo.records.length){if(e>zo.index)for(t=zo.index+1;t<=e;t++)zo.doCmdBatch("redo",zo.records[t]);else for(t=zo.index;t>e;t--)zo.doCmdBatch("undo",zo.records[t]);zo.index=e;var r=zo.needSetUnSaved();sr("triggerEvent",["history_change",zo.records.length,zo.index,r,zo.fileWaitingforSaving]);sr("triggerEvent",["select_change"])}};zo.go=function(e){try{zo.log(1===e?"redo":-1===e?"undo":"go("+e+")");zo.goTo(zo.index+e)}catch(e){Eo.reportError(e);zo.clear()}};zo.doCmdBatch=function(e,t){function r(e){if(e){var t=m(e,"net");t&&i.nets.indexOf(t)<0&&i.nets.push(t);for(var r=p("[net]",e),n=0;n<r.length;n++){t=m(r[n],"net");t&&i.nets.indexOf(t)<0&&i.nets.push(t)}}}function n(t){var o,s,l;if(t&&D(t)&&t.length)if(D(t[0]))for(o=0,s=t.length;o<s;o++)n(t[o]);else{var c=t[1].split(",");for(o=0,s=c.length;o<s;o++){"add"==t[0]&&"undo"==e||"del"==t[0]&&"redo"==e?i.removeIds.indexOf(c[o])<0&&i.removeIds.push(c[o]):i.updateIds.push(c[o]);if(a)if("add"==t[0]&&"redo"==e||"del"==t[0]&&"undo"==e){l=p("#"+c[o],Ro);l=l&&l.length&&l[l.length-1];r(l)}else if("node"==t[0]){l=h("#"+c[o],Ka);r(l);l="undo"==e?t[2]:t[3];r(l)}else{l=h("#"+c[o],Ka);r(l)}}}}var i={updateIds:[],removeIds:[],nets:[],copper:[]},a=Is==ao.PCB;ao.PCB;n(t);!function(){var e,t,r;for(e=0,t=i.removeIds.length;e<t;e++){r=d(i.removeIds[e]);Fo.gJsonCache.panelize&&"panelizedOutline"===m(r,"c_outlinetype")&&delete Fo.gJsonCache.panelize;Fo.removeOne(r)}}();"redo"==e?zo.redoOne(t):zo.undoOne(t);Gr();!function(){var e,t,r,n,a,o,s=[],l=[];for(e=0,t=i.updateIds.length;e<t;e++){r=d(i.updateIds[e]);n=Z(r);a=Is==ao.PCB||Is==ao.PCBLIB?"TEXT":"text";if("COPPERAREA"===n){s.push(i.updateIds[e]);o=i.nets.indexOf(m(r,"net"));o>-1&&i.nets.splice(o,1)}"PLANEZONE"===n&&l.push(i.updateIds[e]);n==a&&r.parentNode!=Ka&&(r=r.parentNode);if(r){r.tagName&&"circle"===r.tagName&&Bi(parseInt(m(r,"layerid")))&&Vi(r);Fo.updateOne(r,{notCopper:!0,notUpdateElement:!0})}}var c,p=[];if(l.length){for(e=0;e<l.length;e++){c=Fo.gJsonCache.PLANEZONE[l[e]];c&&c.layerid&&-1===p.indexOf(c.layerid)&&p.push(c.layerid)}qo.rebuildPlane(p)}}();a&&function(){Is==ao.PCB&&i.nets.length&&Qo.buildGroupNets(i.nets)}();a&&Qo.historyHandler()};zo._undoRedos=[];zo.defineUndoRedo=function(e,t){zo._undoRedos[e]=t};zo.undoOne=function(e){if(D(e)){var t=[];if(D(e[0])){for(var r=e.length-1;r>=0;r--)e[r]&&"del"==e[r][0]&&t.push(e[r]);for(r=e.length-1;r>=0;r--)e[r]&&"del"!=e[r][0]&&t.push(e[r]);t.forEach(function(e){zo.undoOne(e)})}else{var n=zo._undoRedos[e[0]];n&&n.undo&&n.undo(e)}}};zo.redoOne=function(e){if(D(e)){var t=[];if(D(e[0])){for(var r=0,n=e.length;r<n;r++)e[r]&&"add"==e[r][0]&&t.push(e[r]);for(r=0,n=e.length;r<n;r++)e[r]&&"add"!=e[r][0]&&t.push(e[r]);t.forEach(function(e){zo.redoOne(e)})}else{var i=zo._undoRedos[e[0]];i&&i.redo&&i.redo(e)}}};zo.ids2elems=function(e){return e&&e!=Ka.id&&"config.colors"!=e&&"set.origin"!=e&&"set.target"!=e?p("#"+e.replace(/\,/g,",#"),Ka):[]};zo.defineUndoRedo("add",{undo:function(e){var t,r,n;e[0];n=e[1].split(",");for(r=n.length;--r>=0;){t=d(n[r]);t&&Ro.appendChild(t)}},redo:function(e){var t,r,n,i,a,o,s;e[0];s=e[2]&&/^</.test(e[2]);o=(e[2]||"").replace(/^</,"");a=o?d(o):null;i=e[1].split(",");for(r=0,n=i.length;r<n;r++){t=p("#"+i[r],Ro);t=t&&t.length&&t[t.length-1];if(t){f(t,"active")&&u(t,"active",!1);a&&s?a.appendChild(t):a&&a.parentNode?a.parentNode.insertBefore(t,a):Is==ao.PCB||Is==ao.PCBLIB||Is==ao.WAVEFORM?Ls.appendElement(t):Ka.appendChild(t);zo.updateCache(t,m(t,"net")||"")}}}});zo.defineUndoRedo("del",{undo:function(e){var t,r,n,i,a,o;e[0];o=e[2]&&/^</.test(e[2]);a=(e[2]||"").replace(/^</,"");i=a?d(a):null;n=e[1].split(",");for(r=n.length;--r>=0;){t=p("#"+n[r],Ro);t=t&&t.length&&t[t.length-1];if(t){f(t,"active")&&u(t,"active",!1);i&&o?i.appendChild(t):i&&i.parentNode?i.parentNode.insertBefore(t,i):Is==ao.PCB||Is==ao.PCBLIB||Is==ao.WAVEFORM?Ls.appendElement(t):Ka.appendChild(t);zo.updateCache(t,m(t,"net")||"")}}},redo:function(e){var t,r,n;e[0];n=e[1].split(",");for(r=n.length;--r>=0;){t=d(n[r]);t&&Ro.appendChild(t)}}});zo.defineUndoRedo("attr",{undo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]!=Ka.id)if("panelize"!==e[1]){r=p("#"+e[1].replace(/\,/g,",#"),Ka);for(n=0;n<r.length;n++){t=r[n];if(t){if(Is==ao.PCB){i="net";a=m(t,i);a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");S(e[2],i)&&o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");S(e[3],i)&&o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}m(t,e[2]);zo.updateCache(t,o)}}}else za(e[2],!1);else m(Ka,e[2])},redo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]!=Ka.id)if("panelize"!==e[1]){r=p("#"+e[1].replace(/\,/g,",#"),Ka);for(n=0;n<r.length;n++){t=r[n];if(t){if(Is==ao.PCB){i="net";a=m(t,i);a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");S(e[2],i)&&o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");S(e[3],i)&&o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}m(t,e[3]);zo.updateCache(t,o)}}}else za(e[3],!1);else m(Ka,e[3])}});zo.defineUndoRedo("attrpanel",{undo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]==Ka.id){La("canvas",e[2],"NotSaveHistory");sr("updateAttrPanel")}else{r=p("#"+e[1].replace(/\,/g,",#"),Ka);for(n=0;n<r.length;n++){t=r[n];if(t){if(Is==ao.PCB){a=m(t,"net");a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");for(i in e[2])if(S(e[2],i)&&"-net"==i.substr(i.length-4)){o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}}La(t||e[1],e[2],"NotSaveHistory");t&&zo.updateCache(t,o)}}}},redo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]==Ka.id){La("canvas",e[3],"NotSaveHistory");sr("updateAttrPanel")}else{r=p("#"+e[1].replace(/\,/g,",#"),Ka);for(n=0;n<r.length;n++){t=r[n];if(t){if(Is==ao.PCB){a=m(t,"net");a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");for(i in e[2])if(S(e[2],i)&&"-net"==i.substr(i.length-4)){o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}}La(t,e[3],"NotSaveHistory");zo.updateCache(t,o)}}}}});zo.defineUndoRedo("node",{undo:function(e){var t,r,n,i=(e[0],"\0");t=d(e[1]);if(t){var a=Ka.id,o=e[2].cloneNode(!0);if(Is==ao.PCB&&t.id!==a){var s=m(o,"net"),l=m(t,"net");s&&i.indexOf("\0"+s+"\0")<0&&(i+=s+"\0");l&&i.indexOf("\0"+l+"\0")<0&&(i+=l+"\0")}t.parentNode.replaceChild(o,t);f(o,"active")&&u(o,"active",!1);if(t.id===a){Ka=d(a);r=o.childNodes.filter(function(e){return f(e,"active")});n=r[0]&&r[0].id;Yo=d(n)}else zo.updateCache(o,i)}},redo:function(e){var t,r=(e[0],"\0");t=d(e[1]);if(t){var n=Ka.id,i=e[3].cloneNode(!0);if(Is==ao.PCB&&t.id!==n){var a=m(i,"net"),o=m(t,"net");a&&r.indexOf("\0"+a+"\0")<0&&(r+=a+"\0");o&&r.indexOf("\0"+o+"\0")<0&&(r+=o+"\0")}f(i,"active")&&u(i,"active",!1);t.parentNode.replaceChild(i,t);if(t.id===n){Ka=d(n);activeNode=i.childNodes.filter(function(e){return f(e,"active")});activeId=activeNode[0]&&activeNode[0].id;Yo=d(activeId)}else zo.updateCache(i,r)}}});zo.defineUndoRedo("text",{undo:function(e){var t=d(e[1]);if(t&&e[2]){Rt(t,e[2]);zo.updateCache(t)}},redo:function(e){var t=d(e[1]);if(t&&e[3]){Rt(t,e[3]);zo.updateCache(t)}}});zo.defineUndoRedo("move",{undo:function(e){var t;e[0];t=p("#"+e[1].replace(/\,/g,",#"),Ka);Tt(t,-e[2],-e[3]);zo.updateCache(t)},redo:function(e){var t;e[0];t=p("#"+e[1].replace(/\,/g,",#"),Ka);Tt(t,e[2],e[3]);zo.updateCache(t)}});zo.defineUndoRedo("rotate",{undo:function(e){var t;e[0];t=p("#"+e[1].replace(/\,/g,",#"),Ka);sn(t,Le(-e[2]));zo.updateCache(t)},redo:function(e){var t;e[0];t=p("#"+e[1].replace(/\,/g,",#"),Ka);on(t,e[2]);zo.updateCache(t)}});zo.defineUndoRedo("copperArea",{undo:function(e){},redo:function(e){}});zo.defineUndoRedo("variable",{undo:function(e){var t=e[2],r=e[3],n=e[4],i=e[6];switch(typeof n){case"object":D(n)&&[];t[r]=Eo.extend({},n);break;case"string":case"number":case"boolean":case"function":t[r]=n}i&&i("undo",t,r,n)},redo:function(e){var t=e[2],r=e[3],n=e[5],i=e[6]
;switch(typeof n){case"object":D(n)&&[];t[r]=Eo.extend({},n);break;case"string":case"number":case"function":t[r]=n}i&&i("redo",t,r,n)}});zo.defineUndoRedo("originXY",{undo:function(e){var t=e[2];if((t.offsetX||0==t.offsetX)&&(t.offsetY||0==t.offsetY)){ops={};ops.x=Zo.canvas.originX-t.offsetX;ops.y=Zo.canvas.originY-t.offsetY;a("setOriginXY",[{x:ops.x,y:ops.y}])}},redo:function(e){var t=e[2];if((t.offsetX||0==t.offsetX)&&(t.offsetY||0==t.offsetY)){ops={};ops.x=Zo.canvas.originX+t.offsetX;ops.y=Zo.canvas.originY+t.offsetY;a("setOriginXY",[{x:ops.x,y:ops.y}])}}});zo.defineUndoRedo("targetEdit",{undo:function(e){var t=e[2],r=e[3];r&&r("undo",t)},redo:function(e){var t=e[2],r=e[3];r&&r("redo",t)}});zo.defineUndoRedo("elePosition",{undo:function(e){var t,r,n,i;e[0];i=e[1].split(",");r=e[2].split(",");for(n=i.length;--n>=0;){t=d(i[n]);t&&re(t.parentNode,t,r[n])}},redo:function(e){var t,r,n,i;e[0];i=e[1].split(",");r=e[3].split(",");for(n=i.length;--n>=0;){t=d(i[n]);t&&re(t.parentNode,t,r[n])}}});zo.removeCache=function(e){};zo.updateCache=function(e,t){};zo.canRedo=function(){return zo.index<zo.records.length-1};zo.canUndo=function(e){return zo.index>=0};zo.allRecordsToString=function(){for(var e=[],t=0,r=zo.records,n=r.length;t<n;t++)e[t]=zo.recordToString(r[t]);return e};zo.recordToString=function(e){if(!e||!e[0])return"";if(Array.isArray(e[0]))return zo.recordToString(e[0])+(e.length>1?"...["+e.length+"]":"");if("string"!=typeof e[1])return e[0];var t=e[0],r="#"+e[1].replace(/\,/g,",#"),n=t+" : "+r;switch(t){case"add":case"del":e[2]&&(n+=" ; next_sibling : #"+e[2]);break;case"attr":case"attrpanel":n+=" ; old:"+JSON.stringify(e[2])+"; new:"+JSON.stringify(e[3]);break;case"node":break;case"text":n+=" ; old: "+H(e[2])+"; new: "+H(e[3]);break;case"move":n+=" ; dx:"+e[2]+"; dy:"+e[3];break;case"rotate":n+=" ; degree : "+e[2]}return n};zo.recordToPlainObject=function(e,t){function r(e){if(!e)return"<null/>";var t;if(e.children[0]){t=zo.XMLSerializer.serializeToString(e.cloneNode(!1));t=t.replace(/\/?>.*/,">...</"+e.tagName+">")}else t=zo.XMLSerializer.serializeToString(e);t=t.replace(/ xmlns="[^"]*"/g,"");return t}function n(e){return e.split(",").map(function(e){if(!e)return"<null/>";try{var t=e==Ka.id?Ka:Ka.querySelector("#"+e);return t?r(t):"<null/>"}catch(e){return"<ERROR/>"}})}function i(e){for(var t,n=e.split(","),i=[],a=0,o=n.length;a<o;a++)if(n[a]){t=p("#"+n[a],Ro);t=t&&t.length&&t[t.length-1];if(t)try{i.push(r(t))}catch(e){i.push("<null/>")}else i.push("<null/>")}else i.push("<null/>");return i}function a(e){if(Array.isArray(e[0]))return e.map(a);var t=e.slice(),o=t[0];if("node"==o){t[2]=r(t[2]);t[3]=r(t[3])}else"add"==o?t.push(n(t[1])):"del"==o&&t.push(i(t[1]));return t}return e&&e[0]&&Array.isArray(e)?a(e):""};Jt.prototype.deleteItemAt=function(e){this.hist.splice(e,1);this.nodes.splice(e,1)};Jt.prototype.update=function(){for(var e=this.hist,t=this.nodes,r=0,n=t.length;r<n;r++)e[r][3]=t[r].cloneNode(!0)};Jt.prototype.updateAndSave=function(){this.update();this.hist.length>0&&zo.save(this.hist)};a.registerHook({getHistory:function(){return{index:zo.index,records:zo.allRecordsToString()}},getHistoryTimestamp:function(){var e=zo.index,t={};e>=0&&(t.undo=zo.timestamps[e]);e<zo.records.length-1&&(t.redo=zo.timestamps[e+1]);return t},consoleHistory:function(){},clearHistory:function(){zo.clear()},cacheHistory:function(){zo.startBatch()},flushHistory:function(){zo.saveBatch()}});var ls={makePArrFromStr:function(e){for(var t=[],r=e.replace(/ +/g,","),n=r.split(","),i=n.length/2,a=0;a<i;a++)t.push({x:+n[2*a],y:+n[2*a+1]});return t},makePArrToStr:function(e){if(e&&e.length>=2){for(var t=[],r=0;r<e.length;r++){t.push(e[r].x);t.push(e[r].y)}return t.join(" ")}return""},isPointInPolygon:function(e,t){for(var r=+e.x,n=+e.y,i=!1,a=0,o=t.length,s=o-1;a<o;s=a++){var l=+t[a].x,c=+t[a].y,d=+t[s].x,p=+t[s].y;n<c!=n<p&&r<(d-l)*(n-c)/(p-c)+l&&(i=!i)}return i},isPointInBBox:function(e,t){for(var r=new c(1e4,1e5),n=new c(0,0),i=0,a=e.length;i<a;i++){r.x=+r.x>+e[i].x?e[i].x:r.x;r.y=+r.y>+e[i].y?e[i].y:r.y;n.x=+n.x<+e[i].x?e[i].x:n.x;n.y=+n.y<+e[i].y?e[i].y:n.y}r.x=r.x-2;r.y=r.y-2;n.x=+n.x+2;n.y=+n.y+2;return t.x>=r.x&&t.y>=r.y&&t.x<=n.x&&t.y<=n.y},isPointInCircle:function(e,t,r){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)<r*r},distancePointToPoint:function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},ptOnLine:function(e,t,r){var n=Math.min,i=Math.max;return n(t.x,r.x)<=e.x&&e.x<=i(t.x,r.x)&&n(t.y,r.y)<=e.y&&e.y<=i(t.y,r.y)&&(e.x-t.x)*(r.y-t.y)==(r.x-t.x)*(e.y-t.y)},getDistanceFromPointToLine:function(e,t,r){return e.x==t.x&&t.x==r.x?Math.min(Math.abs(e.y-t.y),Math.abs(e.y-r.y)):e.y==t.y&&t.y==r.y?Math.min(Math.abs(e.x-t.x),Math.abs(e.x-r.x)):Math.abs(((r.x-t.x)*(t.y-e.y)-(t.x-e.x)*(r.y-t.y))/Math.sqrt((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y)))},getPointToSegmentObj:function(e,t,r){var n,i,a,o={};e.x=+e.x;e.y=+e.y;t.x=+t.x;t.y=+t.y;r.x=+r.x;r.y=+r.y;n=r.x-t.x;i=r.y-t.y;if(0===n&&0===i){n=e.x-t.x;i=e.y-t.y;o.x=t.x;o.y=t.y;return{d:Math.sqrt(n*n+i*i),point:o}}a=((e.x-t.x)*n+(e.y-t.y)*i)/(n*n+i*i);if(a<0){n=e.x-t.x;i=e.y-t.y;o.x=t.x;o.y=t.y}else if(a>1){n=e.x-r.x;i=e.y-r.y;o.x=r.x;o.y=r.y}else{o.x=t.x+a*n;o.y=t.y+a*i;n=e.x-o.x;i=e.y-o.y}return{d:Math.sqrt(n*n+i*i),point:o}},splitPloylineByPoint:function(e,t){var r=Fo.gJsonCache.TRACK[t];if(!r||!r.pointArr)return!1;var n=r.pointArr,i=n.length;if(i<2)return!1;if(this.isPointInCircle(e,n[0],1)||this.isPointInCircle(e,n[i-1],1))return!1;for(var a="",o="",s=!1,l=0;l<i-1;l++){a+=n[l].x+" "+n[l].y+" ";if(ls.getPointToSegmentObj(e,n[l],n[l+1]).d<.4){s=!0;break}}if(!s)return!1;a+=e.x+" "+e.y;o=e.x+" "+e.y+" ";for(l++;l<=i-1;l++)o+=n[l].x+" "+n[l].y+" ";return[V(a),V(o)]},getStartAndEndPointByDimensionElement:function(e){var t=e.pathSegList;if(!t)return[];var r=t.getItem(0),n=t.getItem(1),i=t.getItem(3),a=t.getItem(6),o=t.getItem(8);return a.x===n.x&&a.y===n.y?[r.x,r.y,n.x,n.y]:o.x===i.x&&o.y===i.y?[r.x,r.y,i.x,i.y]:[]},getDimensionPath:function(e){var t,r,n,i,a=e.fromP,o=e.toP,s=e.fontSize||10,l=e.unit||Zo.canvas.unit,c=0===e.precision?0:e.precision?e.precision:3,d=e.mirror||!1,p=o.x-a.x,h=a.y-o.y,u=[a.x+5,a.y+3,a.x,a.y,a.x+5,a.y-3],f=[o.x-5,o.y+3,o.x,o.y,o.x-5,o.y-3],g=fe(a.x,a.y,o.x,o.y),y=he(a.x,a.y,o.x,o.y),v=180/(Math.PI/y);r=Eo.formatLengthShow(Eo.units.convert(g,"pixel",l),{decimalPlacesShow:c,fixedDecimal:!0})+("inch"===l?'"':l);var x=sr("getFontsWidth",[r,s]),m=(g-x)/2-2,C=Math.abs(m)*Math.cos(y),L=Math.abs(m)*Math.sin(y),_=+a.x+p/2,P=+a.y-h/2,A=0;if(x>0){if(m>0)if(p>0){_=+a.x+C;P=+a.y+L}else{_=+o.x-C;P=+o.y-L}else if(p>0){_=+a.x-C;P=+a.y-L}else{_=+o.x+C;P=+o.y+L}m-5<0&&(A+=3+s/2)}i={text:r,x:d?+_+2+x+2:+_+2,y:+P-A,fontSize:s,degree:360-(p>0?v:v+180),rotateOriginX:+_,rotateOriginY:+P,mirror:d};n=sr("getRotateStringPath",[i]);var b=m-5<0?v+180:v;u=ge(u,b,a.x,a.y);f=ge(f,b,o.x,o.y);t="M"+a.x+","+a.y+"L"+(m-5<0?o.x+","+o.y:a.x+C+","+(a.y+L)+"M"+(o.x-C)+","+(o.y-L)+"L"+o.x+","+o.y)+"M"+u[0]+","+u[1]+"L"+u[2]+","+u[3]+"L"+u[4]+","+u[5]+"M"+f[0]+","+f[1]+"L"+f[2]+","+f[3]+"L"+f[4]+","+f[5];return t+n},getProtractorPath:function(e,t,r,n){var i,a,o,s,l,c="",d=e[0],p=e[1],h=r[0],u=r[1];if(n){i=n.fontPoint;a=n.fontSize;o=n.canAdjustLineLength;s=isNaN(n.precision)?0:n.precision;l=n.mirror||!1}var f=0,g=h-d,y=u-p,v=Math.sqrt(Math.pow(g,2)+Math.pow(y,2)),x=g/v,m=Math.acos(x),C=180/(Math.PI/m);y>0&&(C=360-C);var L=t[0],_=t[1],P=L-d,A=_-p,b=Math.sqrt(Math.pow(P,2)+Math.pow(A,2)),S=P/b,E=Math.acos(S),O=180/(Math.PI/E);A>0&&(O=360-O);var I=Math.abs(O-C);f=I;I>180&&(f=360-I);f=Eo.toFixed(f,s);if(isNaN(f))return"";var T=v,R=v,w=Eo.arc.getAngle(P,A),N=Eo.arc.getDotByAngle(T,R,w),k=o?L:d+N.x,M=o?_:p+N.y;if(fe(d,p,k,M)<=20){T=R=20;N=Eo.arc.getDotByAngle(T,R,w);k=d+N.x;M=p+N.y}c+="M"+d+" "+p+" L"+k+" "+M;var B=h,V=u;if(fe(d,p,B,V)<=20){T=R=20;w=Eo.arc.getAngle(g,y);N=Eo.arc.getDotByAngle(T,R,w);B=d+N.x;V=p+N.y}c+="M"+d+" "+p+" L"+B+" "+V;var F=Eo.arc.getAngle(P,A),G=Eo.arc.getAngle(g,y),Y=Eo.arc.getDotByAngle(10,10,F),j=Eo.arc.getDotByAngle(10,10,G),H=d+Y.x,X=p+Y.y,U=d+j.x,J=p+j.y,z=ge(r,180,d,p),W=(k-z[0])*(e[1]-z[1])-(M-z[1])*(e[0]-z[0])>0?1:0;c+="M"+H+" "+X+" A10,10 0 0,"+W+" "+U+","+J;var Z=f+"°",K=a||4.5,q=sr("getFontsWidth",[Z,K]),$=null,Q=null;if(D(i)&&2===i.length){$=i[0];Q=i[1]}else{var ee=zt("path",{d:"M"+H+" "+X+" A10,10 0 0,"+W+" "+U+","+J,fill:"none","stroke-width":1}),te=ee.getTotalLength(),re=ee.getPointAtLength(te/2),ne=he(e[0],e[1],re.x,re.y);$=e[0]+20*Math.cos(ne)-q/2;Q=e[1]+20*Math.sin(ne)}c+="M"+($-2)+" "+Q+sr("getRotateStringPath",[{text:Z,x:l?$+q:$,y:Q,fontSize:K,rotateOriginX:$,rotateOriginY:Q,mirror:l}]);return c},ptOnPolyline:function(e,t){for(var r=t.length,n=0;n<r-1;n++)if(this.ptOnLine(e,t[n],t[n+1]))return!0;return!1},getWireByXY:function(e,t){for(var r=p("#g1>polyline[c_etype=wire]",Ka),n=r.length,i=0;i<n;i++){var a={x:e,y:t};if(this.isPointOnPolyline(a,r[i]))return r[i]}},isPointOnPolyline:function(e,t){var r=t.getBBox(),n=e.x,i=e.y;if(n<r.x||n>r.x+r.width||i<r.y||i>r.y+r.height)return!1;var a=t.points;if(n==a.getItem(0).x&&i==a.getItem(0).y)return!0;for(var o=1,s=a.length||a.numberOfItems;o<s;o++)if(this.ptOnLine(e,a.getItem(o-1),a.getItem(o)))return!0;return!1},formatTrackPoints:function(e,t,r,n,i){function a(e,t){return Math.abs(e-t)}function o(e,t,r,n,i,o){var s,l,c,d=a(e,r),p=a(t,n);i=!1!==i;if(0===d||0===p)return"L";if(d==p){o=void 0===o?1:o;return"A"+d+" "+p+" 0 0 "+o+" "}l=Math.min(d,p);o=void 0===o?function(){var a=Math.atan2(n-t,r-e);a<0&&(a+=Math.PI+Math.PI);var o=4*a/Math.PI|0;return i==o%2>0?1:0}():o;s="A"+l+" "+l+" 0 0 "+o+" ";if(i){if(d>p){c=e<r?e+l:e-l;return s+c+" "+n+"L"}c=t<n?t+l:t-l;return s+r+" "+c+"L"}if(d>p){c=e<r?e+(d-p):e-(d-p);return"L"+c+" "+t+s}c=t<n?t+(p-d):t-(p-d);return"L"+e+" "+c+s}r=+r;n=+n;if("0"==t)return e.join(" ")+" "+r+" "+n;var s=e.length;if(!(s<2)){for(var l=0;l<s;l++)e[l]=+e[l];var d,p=new c(r,n),h=new c(e[s-2],e[s-1]),u=a(p.x,h.x),f=a(p.y,h.y);if("ARC"!=t&&(0===u||0===f))return e.join(" ")+" "+r+" "+n;if("90"==t){if(u>0&&f>0){d="h-v"==i?{x:p.x,y:h.y}:{x:h.x,y:p.y};return e.concat(Eo.formatLengthSave(d.x),Eo.formatLengthSave(d.y),r,n).join(" ")}return e.join(" ")+" "+r+" "+n}if("45"==t){var g="90-45"!=i;if(u==f||0===u||0===f)return e.join(" ")+" "+r+" "+n;d=g?u>f?{x:h.x+(p.x>h.x?f:-f),y:p.y}:{x:p.x,y:h.y+(p.y>h.y?u:-u)}:u>f?{x:p.x+(p.x>h.x?-f:f),y:h.y}:{x:h.x,y:p.y+(p.y>h.y?-u:u)};return e.concat(Eo.formatLengthSave(d.x),Eo.formatLengthSave(d.y),r,n).join(" ")}if("ARC"==t){var y="90-arc"!=i,v="M"+e[0]+" "+e[1];for(l=3;l<s;l+=2)v+=o(e[l-3],e[l-2],e[l-1],e[l],y)+e[l-1]+" "+e[l];v+=o(e[s-2],e[s-1],r,n,y)+r+" "+n;return v}}},getLengthOfTrackAndArc:function(e,t){if(!e||!e.d&&!e.pointArr)return 0;for(var r=e.d?pi(e,!1):e.pointArr,n=0,i=0,a=r.length-1;i<a;i++)n+=ls.distancePointToPoint(r[i],r[i+1]);t&&(n=Eo.units.convert(n,"pixel",Zo.canvas.unit));return Eo.formatLengthSave(n)},getWholeNetLength:function(e){for(var t=Fo.gJsonCache.SIGNALS[e]||[],r=0,n=0,i=t.length;n<i;n++)!t[n]||"TRACK"!=t[n].cmd&&"ARC"!=t[n].cmd||(r+=ls.getLengthOfTrackAndArc(Fo.gJsonCache[t[n].cmd][t[n].gId]));return Eo.formatLengthSave(Eo.units.convert(r,"pixel",Zo.canvas.unit))},getArcFromCircle:function(e){var t=e.r,r=e.layerid||Ls.getActiveLayer(),n=e.strokeWidth||"1",i=oi(r)?e.netId||br():"",a=!1!==bo.getCacheObj("AssignNet");(Cs.readyed&&!a||Is===ao.PCBLIB||bi(r))&&(i="");var o,s;if(e.cx){o={x:e.cx-t,y:e.cy};s={x:e.cx+t,y:e.cy}}else{o=e.start;s=e.end}var l="M"+o.x+","+o.y+" A"+t+","+t+" 0 1 1 "+s.x+","+s.y,c="M"+s.x+","+s.y+" A"+t+","+t+" 0 1 1 "+o.x+","+o.y,d={d:l,"stroke-width":n,fill:"none",c_shapetype:"line",layerid:r,id:Eo.newId(),net:i,c_auto_net:!!e.autoNet},p={d:c,"stroke-width":n,fill:"none",c_shapetype:"line",layerid:r,id:Eo.newId(),net:i,c_auto_net:!!e.autoNet};return[zt("path",d),zt("path",p)]},getTrackAndArcLengthFromElement:function(e){return!e||!e.tagName||"polyline"!==e.tagName&&"path"!==e.tagName?0:"polyline"===e.tagName?ls.getLengthOfTrackAndArc({pointArr:Eo.extend([],e.points)}):"path"===e.tagName?ls.getLengthOfTrackAndArc({d:m(e,"d")}):void 0},getNetLengthAndIds:function(e){for(var t=Fo.gJsonCache.SIGNALS[e]||[],r=0,n=[],i=0,a=t.length;i<a;i++)if(t[i]&&("TRACK"==t[i].cmd||"ARC"==t[i].cmd)){r+=ls.getLengthOfTrackAndArc(Fo.gJsonCache[t[i].cmd][t[i].gId]);n.push(t[i].gId)}return{length:Eo.formatLengthSave(r),ids:n}}},cs=function(){var e,t={PAD:function(e,t){var r={x:e.x,y:e.y};if(Ee(r,t))return!0;for(var n=0;n<t.length;n+=2)if(ae(t[n],t[n+1>=t.length?0:n+1],r)<e.width/2*(e.width/2))return!0;return!1},TRACK:function(e,t){for(var r={x:null,y:null},n=0;n<e.pointArr.length;n++){r.x=e.pointArr[n].x;r.y=e.pointArr[n].y;if(Ee(r,t))return!0}for(n=0;n<t.length;n+=2)if(We(e.pointArr[0],e.pointArr[1],t[n],t[n+1>=t.length?0:n+1]))return!0;return!1},ARC:function(e,t){var r=[],n=[.25,.5,.75],i=ui(e.d);r.push(i[3],i[i.length-1]);for(var a=0;a<n.length;a++){var o=Math.ceil(i.length*n[a]),s=i[o];r.push(s)}for(a=0;a<r.length;a++)if(Ee(r[a],t))return!0;return!1},CIRCLE:function(e,t){var r={x:e.cx,y:e.cy};if(Ee(r,t))return!0;for(var n=0;n<t.length;n+=2)if(ae(t[n],t[n+1>=t.length?0:n+1],r)<e.r*e.r)return!0;return!1},SOLIDREGION:function(e,t){for(var r={x:null,y:null},n=0;n<e.pointArr.length;n++){r.x=e.pointArr[n].x;r.y=e.pointArr[n].y;if(Ee(r,t))return!0}return!1},VIA:function(e,t){var r={x:e.x,y:e.y};if(Ee(r,t))return!0;for(var n=0;n<t.length;n+=2)if(ae(t[n],t[n+1>=t.length?0:n+1],r)<e.diameter/2*(e.diameter/2))return!0;return!1}},r=function(e,r,n){return!(!r.net||""===r.net||void 0===r.net||"COPPERAREA"===e||"DOT"===e)&&(!!t[e]&&t[e](r,n))},n=function(t,r){e=e||this.findNet(t,r);return e},i=function(){e=null};n.prototype.findNet=function(e,t){var r,n=e.getBBox(),i={x:n.x+n.width/2,y:n.y+n.height/2},a=n.width>n.height?n.width/2:n.height/2,o=es.searchByPoint2(i.x,i.y,a,m(e,"layerid"));r=this.filterObj(o,t);if(r){m(e,"net",r.node.net);return r.node.net}return null};n.prototype.filterObj=function(e,t){for(var n=[],i=0;i<t.length;i+=2){var a={x:t[i],y:t[i+1]};n.push(a)}for(i=0;i<e.length;i++){if(r(e[i].type,e[i].node,n))return e[i]}return!1};return{findFirstObjNet:n,cleanNet:i}}();Sr.data={clientX:null,clientY:null,lastUpX:null,lastUpY:null,uplock:!1,currAbsX:null,currAbsY:null};t.addEventListener("click",function(e){sr("triggerClick",[e])},!1);var ds=function(){function e(){for(var a=Date.now();r.length&&Date.now()-a<100;)r.shift()();if(t){var o=r.length&&i?1-r.length/i:1;t(o)}r.length?setTimeout(e,0):n="idle"}var t,r=[],n="idle",i=0;return{addTask:function(e){r.push(e);return ds},run:function(){if("idle"==n){n="running";i=r.length;e()}},onProgress:function(e){t=e}}}();$r.fn={started:!1,position:!1,on:!1,init:function(){t.addEventListener("click",this.setReference,!1);t.addEventListener("mousemove",this.mouseMoveHandler,!1);t.addEventListener("mouseup",this.mouseUpHandler,!1);t.addEventListener("keydown",this.keyDownHandler,!1);ur("cross-red");this.started=!0},setReference:function(e){var t=$r.fn;t.position=ps.getAdsorpPoint(e);t.cancelCopy();t.on=!0},cancelCopy:function(){Cs["draw.origin"].hideSnapPoint();t.removeEventListener("click",$r.fn.setReference,!1);t.removeEventListener("mousemove",$r.fn.mouseMoveHandler,!1);ur();$r.fn.on=!1},cancelPaste:function(){t.removeEventListener("mouseup",$r.fn.mouseUpHandler,!1);t.removeEventListener("keydown",$r.fn.keyDownHandler,!1);$r.fn.cancelCopy()},mouseMoveHandler:function(e){var t=ps.getAdsorpPoint(e);ur("cross-red",t.x,t.y);ps.movePosition(Io.targets,e)},mouseUpHandler:function(e){e.button===no&&$r.fn.cancelPaste()},keyDownHandler:function(e){27===e.keyCode&&$r.fn.cancelPaste()}};var ps={started:!1,nodes:[],clonedNodes:[],hasRotated:!1,position:!1,excludePre:{},getAdsorpPoint:function(e){var t,r,n,i,a=Ct({x:e.clientX,y:e.clientY});if(Zo.adsorbGrid.enabled){t=Fo.ifFind(a.x,a.y,"",io.ALL,"ALL");r=Fo.ifFind(a.x,a.y,"",io.ALL,"MeasureLine");if(t&&t.type){n=Eo.formatLengthSave(t.X);i=Eo.formatLengthSave(t.Y)}if(r&&r.type){n=Eo.formatLengthSave(r.X);i=Eo.formatLengthSave(r.Y)}if(n&&i){Cs["draw.origin"].showSnapPoint(n,i);return{x:n,y:i}}Cs["draw.origin"].hideSnapPoint()}return a},mouseMoveHandler:function(e){var t=ps.getAdsorpPoint(e);ur("cross-red",t.x,t.y);Io.targets&&ps.movePosition(Io.targets,e)},mouseUpHandler:function(e){if(e.button===no){t.removeEventListener("click",ps.clickHandler,!1);t.removeEventListener("mouseup",ps.mouseUpHandler,!1);t.removeEventListener("keydown",ps.keyDownHandler,!1);t.removeEventListener("mousemove",ps.mouseMoveHandler,!1);ur(!1);ps.position=!1;ps.started=!1;Cs["draw.origin"].hideSnapPoint()}},keyDownHandler:function(e){var r=e.keyCode,n=Sr.data,i=+bo.getCacheObj("RotateStep");i=i?360-i:270;if(27===r){var a=new MouseEvent("mouseup",{button:2});t.dispatchEvent(a)}else if(32===r){ps.clonedNodes.forEach(function(e){ns.rotate(e,i,n.currAbsX,n.currAbsY)});ps.nodes=ps.clonedNodes;ps.hasRotated=!0}},appendElement:function(e){for(var t,r=0,n=e.length;r<n;r++){t=e[r];jt(t);if("pinpart"===m(t,"c_etype")){var i=t.querySelector("path[c_note=note_pre]");if(i){var a=m(i,"c_text")||"",o=Vo.getNewPre2(a,!0,!0,this.excludePre);if(o!=a){Sa(i.parentNode,{text:o});this.excludePre[o]=!0}}}Ls.appendElement(t)}},movePosition:function(e,t){var r=ps.getAdsorpPoint(t),n=Io,i=r.x-n.startX,a=r.y-n.startY,o=i-n.offsetX,s=a-n.offsetY;if(Zo.adsorbGrid.enabled&&(o||s)){n.offsetX+=o;n.offsetY+=s;Tt(e,o,s)}},clickHandler:function(e){var r=[];t.removeEventListener("mousemove",ps.mouseMoveHandler,!1);ps.nodes.forEach(function(e){r.push(e.cloneNode(!0))});ps.clonedNodes=r;ps.appendElement(r);if(!ps.position||ps.hasRotated){ps.position=ps.getAdsorpPoint(e);ps.hasRotated=!1}qi(!0);Qi({targets:r,x:ps.position.x,y:ps.position.y,hasPin:!1});t.addEventListener("mousemove",ps.mouseMoveHandler,!1);ur("cross-red")}},Ka=d("g1"),hs=d("selectBox1"),us=d("gControlDots"),fs=d("gRotateHelper"),gs=d("gControlRects"),ys=d("gControlLines"),vs=d("gCopperAreaOutlineCushions"),xs=d("gPanelizedOutlines");Ji.prototype={mdown:function(e){var r=uo,n=Yo,i=e.originalTarget||e.target||e.srcElement;if(e.button===ro&&n&&"cdot"==m(i,"c_shapetype")&&!ss.isLocked(n)){var a=rr(e,!1);Go.style.cursor="move";r.ready=!0;r.target=n;r.x0=a.x;r.y0=a.y;r.dotIndex=+(m(i,"id")||"").substr(4);r.targetX0=+m(i,"cx");r.targetY0=+m(i,"cy");r.movedX=0;r.movedY=0;r.alwaysNotSnap=as.alwaysNotSnap(n,r.dotIndex);r.effectD0=as.get(n);r.pathD0=m(n,"d")||void 0;t.addEventListener("mousemove",r.mmove,!1);t.addEventListener("mouseup",r.mup,!1)}},mmove:function(e){var t,r,n,i,a,o,s,l,c=uo,d=c.target;if(d&&c.ready){os.altKeyEnabled=e.altKey;var p=rr(e,!1);t=p.x-c.x0;r=p.y-c.y0;if(c.start||!((t*t+r*r)*wo*wo<9)){var h,u=Z(d),f="TRACK"==u||"ARC"==u&&(0===c.dotIndex||1===c.dotIndex);if(f&&(h=Fo.ifFind(t+c.targetX0,r+c.targetY0,"",Ls.getActiveLayer(),"ALL"))&&h.type&&h.gId!=d.id){a=h.X-c.targetX0;o=h.Y-c.targetY0}else if(Zo.adsorbGrid.enabled&&!c.alwaysNotSnap){n={x:t+c.targetX0,y:r+c.targetY0};i=Et(n);a=i.x-c.targetX0;o=i.y-c.targetY0}else{a=t;o=r}s=a-c.movedX;l=o-c.movedY;if(s||l){c.movedX=a;c.movedY=o;if(!c.start){c.start=!0;c.ondragstart&&c.ondragstart()}m(d,"c_partid")&&0===m(d,"c_partid").indexOf("part_import")&&0!==c.dotIndex?as.set(d,c.effectD0,c.dotIndex,s,l,c.pathD0):as.set(d,c.effectD0,c.dotIndex,c.movedX,c.movedY,c.pathD0);f&&Is==ao.PCB&&Ko.doRealtimeDRC(d,!0);dr(d);c.ondrag&&c.ondrag()}}}},mup:function(e){var r=uo;if(e.button===ro&&r.ready){t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);r.ready=!1;Go.style.cursor="";if(r.start){r.start=!1;r.ondragend&&r.ondragend()}}}};zi.prototype={mdown:function(e){if(Uo)return!1;if(Io.on)1===un().length&&"FOOTPRINT"===Z(un()[0])&&cr();else if(e.button===ro){var r=un().filter(function(e){return!(!e||"part_pcbtext"!==m(e,"c_partid")&&e.parentNode!=Ka||ss.isLocked(e))}),n=e.target;m(n,"attach_libid")&&(n=d(m(n,"attach_libid")));var i=(Is==ao.PCB||Is==ao.PCBLIB||Is==ao.PCBMODULE)&&Z(n);if(r.length>1){if(e.ctrlKey||e.metaKey)return}else if("TRACK"!=i&&"COPPERAREA"!=i||n.parentNode!=Ka){if(e.ctrlKey||e.metaKey)return}else if(!e.shiftKey||e.ctrlKey||e.metaKey)return;if(n!=t.documentElement&&!(e.target.tagName&&/^(input|textarea|button|a)/i.test(e.target.tagName)||"cdot"==m(n,"c_shapetype"))){var a=Yr(n),o=a;o&&"FOOTPRINT"==Z(o)&&"TEXT"==Z(n.parentNode)&&(o=e.target.parentNode);if(!o&&Oo){o=Oo.target;if("FOOTPRINT"==Z(o)){var s=Oo.evtTarget.parentNode;"TEXT"==Z(s)&&(o=s)}}if(o){var l=fo,c=rr(e,!1);l.ready=!0;l.start=!1;l.target=o;l.evtTarget=n;l.selectedObjs=r;l.x0=c.x;l.y0=c.y;l.lastX=l.x0;l.lastY=l.y0;l.lastDX=0;l.lastDY=0;l.movedX=0;l.movedY=0;if(!l.onready||!1!==l.onready()){Go.style.cursor="move";l.atPartNoteText="TEXT"==Z(o);l.snapped=Zo.adsorbGrid.enabled;l.originOffset=l.snapped&&function(e){var t;t="part_pcbtext"===m(n.parentNode,"c_partid")?St(n.parentNode):bt(e);var r=t&&Et(t);if(r&&(r.x!=t.x||r.y!=t.y))return{x:t.x-l.x0,y:t.y-l.y0}}(l.selectedObjs);t.addEventListener("mousemove",l.mmove,!1);t.addEventListener("mouseup",l.mup,!1)}}}}},mmove:function(e){var t=fo,r=t.target;if(t.ready&&!ss.isLocked(Yr(r))){var n=t.selectedObjs.filter(function(e){return!ss.isLocked(e)});if("dimensionCheck"!==m(n,"c_shapetype")){var i=Z(n[0]);os.altKeyEnabled=e.altKey;if(n.length>1){if(e.ctrlKey||e.metaKey)return}else if(1!==n.length||n[0].parentNode!=Ka||"TRACK"!=i&&"COPPERAREA"!=i){if(e.ctrlKey||e.metaKey)return}else if(!e.shiftKey||e.ctrlKey||e.metaKey)return;var a,o,s,l,c,d,p,h,u=rr(e,!1),f=u.x,g=u.y,y=f-t.x0,v=g-t.y0;if(!t.start){if(!y&&!v)return;if((y*y+v*v)*wo*wo<9)return;t.start=!0;if(t.ondragstart){a=t.ondragstart();if(!1===a){t.ready=!1;t.start=!1;return!1}}}var x="FOOTPRINT"===Z(r)&&1===n.length;if(!t.dragCenter){var C=m(r,"c_origin");if(C)t.dragCenter={x:+C.split(",")[0],y:+C.split(",")[1]};else{var L=r.getBBox();t.dragCenter={x:L.x+L.width/2,y:L.y+L.height/2}}}t.lastX=f;t.lastY=g;t.lastDX=y;t.lastDY=v;if(t.snapped)if(x&&e.shiftKey){s={x:f,y:g};l=Et(s);c=l.x-t.dragCenter.x;d=l.y-t.dragCenter.y}else{o=t.originOffset;if(o){s={x:f+o.x,y:g+o.y};l=Et(s);c=l.x-(t.x0+o.x);d=l.y-(t.y0+o.y)}else{l=Et({x:t.dragCenter.x+y,y:t.dragCenter.y+v});c=l.x-t.dragCenter.x;d=l.y-t.dragCenter.y}}if(void 0===c){c=y;d=v}(x||["PAD","HOLE"].indexOf(Z(r))>-1&&1===n.length)&&fr(t.dragCenter.x+c,t.dragCenter.y+d);p=c-t.movedX;h=d-t.movedY;if(p||h){t.movedX=c;t.movedY=d;for(var _=[],P=0;P<n.length;P++){var A=n[P];A.parentNode!=Ka&&n.indexOf(A.parentNode)>-1||_.push(A)}n=_;Tt(n,p,h);t.ondrag&&t.ondrag()}}}},mup:function(e){if(e.button===ro){var r=fo;r.dragCenter=null;fr(!1);t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);if(r.ready){r.ready=!1;Go.style.cursor="";if(r.start){r.start=!1;r.ondragend&&r.ondragend()}}}}};Wi.prototype={mdown:function(e){if(e.button===ro&&!(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||"cdot"==m(e.target,"c_shapetype")||Oo)){var t,r=this;r.mouseIsDown=!0;if(!(r.strictMousedownTarget&&r.strictMousedownTarget!=e.target||r.mousedownTarget instanceof Function&&!0!==r.mousedownTarget(e,r))){if(r.onmousedown){t=r.onmousedown.call(r.mousedownTarget,e,r);if(!1===t)return!1}if(r.downcursor){r.oldDownCursor=r.mousedownTarget.style.cursor;r.mousedownTarget.style.cursor=r.downcursor}var n=rr(e,!1);r.ready=!0;r.x0=n.x;r.y0=n.y;r.dx=0;r.dy=0;r.x1=r.x0;r.y1=r.y0;if(r.onready){t=r.onready.call(r.mousedownTarget,e,r);if(!1===t){r.ready=!1;return!1}}r.mousedownTarget instanceof Function?Go.addEventListener("mousemove",r.e.mmove,!1):r.mousemoveTarget.addEventListener("mousemove",r.e.mmove,!1);r.mousedownTarget instanceof Function?Go.addEventListener("mouseup",r.e.mup,!1):r.mouseupTarget.addEventListener("mouseup",r.e.mup,!1);r.bind=!0}}},mmove:function(e){var t=this;if(t.mouseIsDown&&t.ready){var r,n=rr(e,!1),i=n.x,a=n.y,o=i-t.x0,s=a-t.y0;if(!t.start){if((o*o+s*s)*wo*wo<9)return;if(t.mousemoveTarget instanceof Function&&!0!==t.mousemoveTarget(e,t))return;if(t.ondragstart){r=t.ondragstart.call(t.mousedownTarget,e,t);if(!1===r){t.ready=!1;t.start=!1;return!1}}t.start=!0;if(t.cursor){t.oldMoveCursor=t.mousemoveTarget.style.cursor;t.mousemoveTarget.style.cursor=t.cursor}t.downcursor&&(t.mousedownTarget.style.cursor=t.oldDownCursor)}t.x1=i;t.y1=a;t.dx=o;t.dy=s;if(t.ondrag){if(t.mousemoveTarget instanceof Function&&!0!==t.mousemoveTarget(e,t))return;r=t.ondrag.call(t.mousedownTarget,e,t);if(!1===r){t.cursor&&(t.mousemoveTarget.style.cursor=t.oldMoveCursor);t.ready=!1;t.start=!1;return!1}}}},mup:function(e){var t=this;if(e.button===ro){t.mouseIsDown=!1;if(t.bind){t.mousedownTarget instanceof Function?Go.removeEventListener("mousemove",t.e.mmove,!1):t.mousemoveTarget.removeEventListener("mousemove",t.e.mmove,!1);t.mousedownTarget instanceof Function?Go.removeEventListener("mouseup",t.e.mup,!1):t.mouseupTarget.removeEventListener("mouseup",t.e.mup,!1);t.bind=!1}if(t.ready&&t.start){t.ready=!1;t.start=!1;t.start&&t.downcursor&&(t.mousedownTarget.style.cursor=t.oldDownCursor);t.cursor&&(t.mousemoveTarget.style.cursor=t.oldMoveCursor);if(t.ondragend){t.ondragend.call(t.mousedownTarget,e,t)}}}},destroy:function(){var e=this;e.mousedownTarget instanceof Function?Go.removeEventListener("mousedown",e.e.mdown,!1):e.mousedownTarget.removeEventListener("mousedown",e.e.mdown,!1);if(e.bind){e.mousedownTarget instanceof Function?Go.removeEventListener("mousemove",e.e.mmove,!1):e.mousemoveTarget.removeEventListener("mousemove",e.e.mmove,!1);e.mousedownTarget instanceof Function?Go.removeEventListener("mouseup",e.e.mup,!1):e.mouseupTarget.removeEventListener("mouseup",e.e.mup,!1);e.bind=!1}}};!function(e){function r(){s=!0;t.addEventListener("keyup",function(e){27==e.keyCode&&a()},!1)}function n(e){qi();$i(e,o);ur("cross-red");t.removeEventListener("click",n,!1);l.isDragging=!0}function i(){var e=un()||[];if(e.length){!s&&r();qi(!1);l.started=!0;o=e;t.addEventListener("click",n,!1);ur("cross-red")}}function a(){l.isDragging&&setTimeout(function(){qi(!1)},1);l.started&&ur();l.isDragging=!1;l.started=!1;t.removeEventListener("click",n,!1)}var o,s=!1,l={started:!1,isDragging:!1,setRelativePoint:i,end:a};e.moveRelatively=l}(this);ia.prototype={mdown:function(e){var r=e.button,n=vo?e.metaKey:e.ctrlKey;if(r==ro&&!n){var i=e.target;if("polyline"!=i.tagName&&"polygon"!=i.tagName){if("cdot"==m(i,"c_shapetype"))return;if(!Oo||!Oo.target||"polyline"!=Oo.target.tagName&&"polygon"!=Oo.target.tagName)return;i=Oo.target}if(i.parentNode===Ka&&!(i.points.numberOfItems<2||ss.isLocked(i))){var a=ia.instance,o=!1,s=un().filter(function(e){return!(!e||"part_pcbtext"!==m(e,"c_partid")&&e.parentNode!=Ka||ss.isLocked(e))});if(Is==ao.PCB||Is==ao.PCBLIB||Is==ao.PCBMODULE){if(e.button!==ro||e.shiftKey||a.ready||s.length>1)return;o=Zo.adsorbGrid.enabled&&(Is==ao.PCB||Is==ao.PCBLIB)&&"TRACK"==Z(i)}else{if(e.button!==ro||e.shiftKey||a.ready||s.length>1)return;if(Is==ao.SCH||Is==ao.SCHLIB||Is==ao.SCHMODULE){cmd=Z(i);if("wire"!==cmd&&"bus"!==cmd)return}o=Zo.adsorbGrid.enabled}var l=Ct({x:e.clientX,y:e.clientY}),c=Pt(i),d=se(l,i,9);if(!(d<0||d%2==0)){var p=d>>1,h=c[p],u=c[p+1];a.target=i;a.startX=l.x;a.startY=l.y;a.A=h;a.B=u;a.ready=1;a.start=0;a.snap=o;a.pIndex=d;a.oldPoints=c;a.polylinePoints=m(i,"points");t.addEventListener("mousemove",a.mmove,!1);t.addEventListener("mouseup",a.mup,!1)}}}},mmove:function(e){var t=ia.instance,r=t.target;if(t.ready){var n=Ct({x:e.clientX,y:e.clientY}),i=Pt(r),a=t.pIndex;if(!(a<0||a%2==0)){var o,s,l=a>>1,c=t.startX,d=t.startY,p=t.A,h=t.B,u=n.x,f=n.y;if(i.length>2){o=u-t.startX;s=f-t.startY}else{var g=fe(p.x,p.y,c,d),y=fe(h.x,h.y,c,d),v=i[l],x=i[l+1],m=Ge(v.x,v.y,g,x.x,x.y,y);if(null==m){var C=(v.x+x.x)/2,L=(v.y+x.y)/2;o=u-C;s=f-L}else{if(fe(u,f,m[0].x,m[0].y)<fe(u,f,m[1].x,m[1].y)){o=u-m[0].x;s=f-m[0].y}else{o=u-m[1].x;s=f-m[1].y}}}if(!t.start){if(fe(c,d,u,f)*wo<2)return;t.start=1;t.ondragstart&&t.ondragstart({target:r,x0:t.startX,y0:t.startY,x1:u,y1:f,dx:o,dy:s,originalEvent:e})}t.ondrag&&t.ondrag({target:r,x0:t.startX,y0:t.startY,x1:u,y1:f,dx:o,dy:s,originalEvent:e})}}},mup:function(e){if(e.button===ro){var r=ia.instance;if(r.ready){t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);var n=r.start;r.ready=0;r.start=0;n&&r.ondragend&&r.ondragend({target:r.target,originalEvent:e});r.oldPoints=null;r.target=null}}},mover:function(e){var t=e.target;if("polyline"==t.tagName&&t===Yo){if(Is==ao.PCB||Is==ao.PCBLIB){if(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey){ur();return}}else if(!e.shiftKey){ur();return}var r=Ct({x:e.clientX,y:e.clientY}),n=se(r,t,9);(n>0||n%2!=0)&&aa(t,n)}},mout:function(e){var t=e.target;"polyline"==t.tagName&&t===Yo&&ur()},dblclick:function(e){var t=e.target;if("polyline"==t.tagName&&t===Yo){var r=m(t,"points");Lt(t);var n=(m(t,"points"),Ct({x:e.clientX,y:e.clientY})),i=se(n,t,9);if(i<0)m(t,"points",r);else{0===i?i=1:i%2==0&&(i-=1);m(t,"stroke-opacity","0.5");var a=i>>1,o=t.points.getItem(a),s=t.points.getItem(a+1),l=getComputedStyle(t)||{},c=l.stroke||m(t,"stroke")||"#ffff66",d=l.strokeWidth||m(t,"stroke-width")||"1";d=d.replace(/[\D]+$/,"");var p={x1:o.x,y1:o.y,x2:s.x,y2:s.y,stroke:c,"stroke-width":1.1*d},h=ia.instance;h.target=t;if(h.controlLine){p.visibility="visible";m(h.controlLine,p);m(h.controlLine2,p)}else{var u=zt("line",p);u.style.stroke=c;u.style.strokeDasharray="none";u.style.cursor="row-resize";Go.appendChild(u);h.controlLine=u;u.addEventListener("mousedown",this.mdown,!1)}}}}};var ms={clear:function(e){var t=!!fn();Mr();Gr();var r,n,i="NotSaveHistory"==e,a=Eo.fileType.getAbstractFileType(Is),o=Ka.childNodes,s=o.length,l=[],c=!1;if(i){for(;--s>=0;){r=o[s];if(r&&r.id&&!Ls.markers[r.id]){c||(c=!0);Ka.removeChild(r)}}if(!c){t&&sr("triggerEvent",["select_change"]);return}zo.clear();Fo.removeAll();if("pcb"==a){Vo.clear();qo._copperOutline=null;lo.copperNetRelation={};qo._padOrViaHasSameNetNameWithCopperArr=[];qo._attachedCopperId=null;qo._boardOutlines=[];qo._activeCopperPolygons=[];qo._boardOutlinesInFootprint=[];Qo.removeAllRatline();es.init();So.ini()}}else{var d=[],h=p('#g1 > [layerid="'+io.BOARDOUTLINE+'"]:not([locked="1"])',Ka);if(h.length){for(s=h.length-1;s>=0;s--){r=h[s];if(i)Ka.removeChild(r);else{l.push(r.id);Ro.appendChild(r)}c=!0}if(c){o=Ka.childNodes;s=o.length}}for(;--s>=0;){r=o[s];if(r&&r.id&&!Ls.markers[r.id])if(ss.isLocked(r))d.push(r);else{n=Z(r);if(n)if("RATLINE"!=n){if(i)Ka.removeChild(r);else{l.push(r.id);Ro.appendChild(r)}c||(c=!0)}else v(r);else v(r)}}if(c){Fo.removeAll();if("pcb"==a){Vo.clear();qo._copperOutline=null;lo.copperNetRelation={};qo._padOrViaHasSameNetNameWithCopperArr=[];qo._attachedCopperId=null;qo._boardOutlines=[];qo._activeCopperPolygons=[];qo._boardOutlinesInFootprint=[];Qo.removeAllRatline();es.init();So.ini();Fo.updateMore(d);Qo.buildAllNet()}else Fo.updateMore(d);if(!i){l=l.join(",");zo.save(["del",l])}t&&sr("triggerEvent",["select_change"])}else t&&sr("triggerEvent",["select_change"])}},getCanvasAttrs:function(){var e,t,r,n={};e=ms.getViewBox();r=e[2];t=e[3];n["attr-pcbcanvas-unit"]=Zo.canvas.unit;n["attr-pcbcanvas-width"]=r;n["attr-pcbcanvas-height"]=t;n["attr-pcbcanvas-bgcolor"]=m(d("gridBg"),"fill")||"#000000";n["attr-pcbcanvas-grid-visible"]="none"==m(d("grid1"),"display")?"none":"yes";n["attr-pcbcanvas-grid-color"]=m(d("gridCell"),"fill");n["attr-pcbcanvas-grid-style"]="url(#gridPattern)"==m(d("grid1"),"fill")?"dot":"line";n["attr-pcbcanvas-grid-size"]=Zo.adsorbGrid.gridSize;n["attr-pcbcanvas-snap-size"]=Zo.adsorbGrid.distanceX;n["attr-pcbcanvas-alt-snap-size"]=Zo.adsorbGrid.altSnapSize||.5;n["attr-pcbcanvas-snap"]=Zo.adsorbGrid.enabled?"yes":"none";n["attr-pcbcanvas-routing-size"]=Zo.canvas.routing;n["attr-pcbcanvas-angle"]=Zo.canvas.angle;n["attr-pcbcanvas-route-conflict"]=Zo.canvas.routeConflict;n["attr-pcbcanvas-remove-loop"]=Zo.canvas.removeLoop;n["attr-pcbcanvas-copper-zone"]=Zo.canvas.copperZone;n["attr-canvas-origin-x"]=Zo.canvas.originX;n["attr-canvas-origin-y"]=Zo.canvas.originY;var i=m(Ka,"c_para")||"",o=Eo.c_paraToJson(i);if("pcblib"==Eo.fileType.getAbstractFileType(Is)){S(o,"package")||(o.package="");S(o,"pre")||(o.pre="")
;S(o,"Contributor")||(o.Contributor="");delete n["attr-pcbcanvas-route-conflict"];i=Eo.jsonToC_para(o)}if(Is==ao.PHOTOVIEW){var s=a("getPhotoviewConfig");n["attr-photo-board-side"]=s.side;n["attr-photo-silk-screen"]=s.silk;n["attr-photo-board-color"]=s.color;n["attr-photo-surface-finish-color"]=s.solder}n.c_para=i;return n},modify_canvas:function(e,t){var r,n,i,o=e["attr-pcbcanvas-unit"]||Zo.canvas.unit,s="mm"==o&&{decimalPlaces:lo.decimalPlaces+2};for(n in e)if(S(e,n)){r=e[n];if("attr-pcbcanvas-width"==n);else if("attr-pcbcanvas-height"==n);else if("attr-pcbcanvas-bgcolor"==n){m(d("gridBg"),{fill:r});Fo.gJsonCache.systemColor.background=r}else if("attr-pcbcanvas-grid-visible"==n){Zo.adsorbGrid.visible="none"!==r;m(d("grid1"),"display","none"==r?r:"")}else if("attr-pcbcanvas-grid-color"==n){m(d("gridCell"),{fill:r});m(d("gridCell2"),{stroke:r});Fo.gJsonCache.systemColor.grid=r}else if("attr-pcbcanvas-grid-size"==n){if(+r<.1)continue;for(var l=+r;l*wo<5;)l*=l*wo*2>=5?2:l*wo*5>=5?5:10;l=Eo.formatLengthSave(l,s);m([d("gridPattern"),d("gridPattern2")],{width:l,height:l});m(d("gridCell2"),{d:"M10 0V10H-10".replace(/10/g,l)});Zo.adsorbGrid.gridSize=Eo.formatLengthSave(r,s)}else if("attr-pcbcanvas-grid-style"==n)m(d("grid1"),"fill","dot"==r?"url(#gridPattern)":"url(#gridPattern2)");else if("attr-pcbcanvas-snap-size"==n){r=r||.5;if(r<.001)continue;Zo.adsorbGrid.distanceX=Zo.adsorbGrid.distanceY=Eo.formatLengthSave(+r,s)}else if("attr-pcbcanvas-snap"==n)Zo.adsorbGrid.enabled="yes"==r;else if("attr-pcbcanvas-alt-snap-size"==n)Zo.adsorbGrid.altSnapSize=Eo.formatLengthSave(+r||.1,s);else if("attr-pcbcanvas-routing-size"==n){Zo.canvas.routing=r;+Zo.canvas.routing<=.2&&(Zo.canvas.routing=.2);if(("draw.track"===Uo||"draw.arc2"===Uo||"draw.arcCenter"===Uo)&&Cs.target){m(Cs.target,"stroke-width",Zo.canvas.routing);Cs.controlLine&&m(Cs.controlLine,"stroke-width",Zo.canvas.routing);Cs["draw.track"].redrawDRCLine()}}else if("attr-pcbcanvas-angle"==n)Zo.canvas.angle=r;else if("attr-pcbcanvas-route-conflict"==n)Zo.canvas.routeConflict=r;else if("attr-pcbcanvas-remove-loop"==n)Zo.canvas.removeLoop=r;else if("attr-pcbcanvas-unit"==n){Zo.canvas.unit=r;var c=p('[c_shapeType="dimensionCheck"]');if(c.length>0){zr(c);return}zn()}else if("attr-pcbcanvas-copper-zone"==n){if(Is==ao.PCB){var u=Fo.gJsonCache.objectMap,f="visible"===r;u&&u.objects["Copper Area"].visible!=f&&sr("copperChangeLinkObjectsTool",[u,f]);Zo.canvas.copperZone=r;Ii(Zo.canvas.copperZone)}}else if("attr-photo-board-side"==n)$o._changeSide(r);else if("attr-photo-silk-screen"==n)$o._changeSilk(r);else if("attr-photo-board-color"==n)$o._changeColor(r);else if("attr-photo-surface-finish-color"==n)$o._changeSolder(r);else if("attr-footprint-3d-outline"==n){i=h('#g1 [c_etype="outline3D"]');i?m(i,{display:"invisible"===r?"none":"yes"}):sr("warnOutlineNeeded")}else if(n.match(/attr\-footprint\-3d\-outline\-/))_a(d("g1"),n,r,t);else if("c_para"==n)m(Ka,{c_para:r});else{if((n+r).indexOf("`")>=0)continue;if(Eo.fileType.isLib(Is)&&"pre"==n&&!r.trim()){parent.$.messager.error("This field can't be removed!");continue}ba(Ka,n,r);sr("updateAttrPanel")}}S(e,"attr-pcbcanvas-unit")&&Qt();if(S(e,"attr-pcbcanvas-origin-x")||S(e,"attr-pcbcanvas-origin-y")){var g=Zo.canvas.originX,y=Zo.canvas.originY;S(e,"attr-pcbcanvas-origin-x")&&(g=+e["attr-pcbcanvas-origin-x"]);S(e,"attr-pcbcanvas-origin-y")&&(y=+e["attr-pcbcanvas-origin-y"]);isFinite(g)&&isFinite(y)&&a("setOriginXY",[{x:g,y:y}])}},getViewBox:function(){return m(Go,"viewBox").split(" ").map(parseFloat)},setViewBox:function(){var e=d("gridBg"),t=d("grid1"),r=d("gridOH"),n=d("gridOV");return function(i){m(Go,"viewBox",i.join(" "));var a={x:i[0],y:i[1],width:i[2],height:i[3]};m(e,a);m(t,a);m(r,{x1:i[0],x2:i[0]+i[2]});m(n,{y1:i[1],y2:i[1]+i[3]});sr("updateRuler",[{vbX:i[0],vbY:i[1]}]);yo.showAll()}}()},Cs={version:1,readyed:!1,started:!1,dots:[],line:null,mockX:null,mockY:null,moveEndX:null,moveEndY:null,fromPadId:null,routedRealRatLine:null,trackPreference:{0:"",45:"90-45",90:"h-v",ARC:"arc-90"},ready:function(){var e=Uo;Ls.getActiveLayer();if(!Cs.readyed){Cs.readyed=!0;t.addEventListener("mousedown",Cs.mousedown,!1);t.addEventListener("mouseup",Cs.mouseup,!1);t.addEventListener("mousemove",Cs.mousemove,!1);u(Ka,"events-none",!0);ur("cross-red");0===Uo.indexOf("place.part_")&&(e="place.part");0===Uo.indexOf("place.partimg_")&&(e="place.image");Cs[e]&&"function"==typeof Cs[e].ready&&Cs[e].ready()}},mousedown:function(e){},mouseup:function(e){var r,n,i,a=Cs;if((_o||e.target!=t.documentElement&&e.target!=t.body)&&!(e.button==no&&lo.dragpanning||1==e.button&&lo.dragpanning&&"draw.track"==Uo)){Gr();if(e.button!=no){var o=a.dots;r=rr(e);n=r.x;i=r.y;var s=!0,l=Uo;0===Uo.indexOf("place.part_")?l="place.part":0===Uo.indexOf("place.partimg_")&&(l="place.image");Cs[l]&&"function"==typeof Cs[l].canDraw&&(s=Cs[l].canDraw(n,i,e));if(s){if(!a.started){a.started=!0;o.length=0}a.draw(n,i,!0,e)}}else{if(a.started&&0!==Uo.indexOf("place.part_"))if(a.started&&0!==Uo.indexOf("place.partimg_"))if("draw.track"!==Uo&&"draw.arc2"!==Uo&&"draw.differentialRoute"!==Uo||0!==a.dots.length)if("draw.arcCenter"===Uo){a.end();kr();Ko&&Ko.hideRealtimeDRCError&&Ko.hideRealtimeDRCError()}else if("draw.image"===Uo){a.end();kr()}else if("draw.protractor"===Uo){a.end();kr()}else if("draw.measureLine"===Uo){a.end();kr()}else{r=rr(e);n=r.x;i=r.y;a.next(n,i,e)}else{a.end();kr()}else{a.end();kr()}else{a.end();kr()}lo.drawing=!0;setTimeout(function(){lo.drawing=!1},5)}}},mousemove:function(e){var r=Cs;if(r.started&&("object"!=typeof po||!po||!po.ready)){var n=rr(e),i=n.x,a=n.y;if(_o||e.target!=t.documentElement&&e.target!=t.body){r.draw(i,a,!1,e);r.mockX=i;r.mockY=a;r.moveEndX=e.clientX;r.moveEndY=e.clientY}else if(0===Uo.indexOf("place.part_")){var o=Uo.substr(6);yr(o)}else if(0===Uo.indexOf("place.partimg_")){o=Uo.substr(6);yr(o)}}},draw:function(e,t,r,n){var i,a=Cs,o=Uo;if(r&&a.target&&"draw.track"===o){if("ARC"===Zo.canvas.angle&&!m(a.target,"full_d"))return;if("ARC"!==Zo.canvas.angle&&!m(a.target,"full_points"))return}a.lastX=e;a.lastY=t;i=a.dots.length;if(!(i>=2&&e==a.dots[i-2]&&t==a.dots[i-1])){if(r){if(a.target&&m(a.target,"full_points")){var s=m(a.target,"full_points").split(" ");t=s.pop();e=s.pop()}a.dots.push(e,t)}0===Uo.indexOf("place.part_")?o="place.part":0===Uo.indexOf("place.partimg_")&&(o="place.image");Cs[o]&&"function"==typeof Cs[o].draw&&Cs[o].draw(e,t,r,n)}},next:function(e,t,r){var n,i=Cs,a=[],o=d("pdot0"),s=Uo;i.started=!1;o&&"none"!=m(o,"display")&&m(o,"display","none");Ko&&Ko.hideRealtimeDRCError&&Ko.hideRealtimeDRCError();var l=i.target;if(i.target&&void 0!==e&&void 0!==t){i.draw(e,t,!0,r);i.target||(l=null)}0===Uo.indexOf("place.part_")&&(s="place.part");0===Uo.indexOf("place.partimg_")&&(s="place.image");Cs[s]&&"function"==typeof Cs[s].next&&Cs[s].next(e,t,r);i.target||(l=null);l&&Ls.appendElement(l);i.target=null;i.dots.length=0;i.mockX=null;i.mockY=null;i.fromPadId=null;i.routedRealRatLine=null;if("notSaveHistory"!==e&&l){n=l.id;a=["add",n,Eo.node.getRefId(l)];a.length&&zo.save(a)}},end:function(e){var r=Cs,n=Uo;0===Uo.indexOf("place.part_")&&(n="place.part");0===Uo.indexOf("place.partimg_")&&(n="place.image");Cs[n]&&"function"==typeof Cs[n].end&&Cs[n].end(e);r.mockX=null;r.mockY=null;r.target=null;r.started=!1;r.dots.length=0;r.readyed=!1;t.removeEventListener("mousedown",r.mousedown,!1);t.removeEventListener("mouseup",r.mouseup,!1);t.removeEventListener("mousemove",r.mousemove,!1);u(Ka,"events-none",!1);ur();var i=d("pdot0");i&&"none"!=m(i,"display")&&m(i,"display","none")},restart:function(){var e=Cs,t=Uo;Ko&&Ko.hideRealtimeDRCError&&Ko.hideRealtimeDRCError();if(Uo){"draw.measureLine"!==Uo&&e.next();e.end();Uo="";(e.started&&e.dots.length||"draw.connect"==t)&&wr(t)}},canBackStep:function(){var e=Cs,t=Uo;return e.started&&(("draw.polyline"==t||"draw.polygon"==t||"draw.bezier"==t||"draw.wire"==t||"draw.bus"==t||"draw.track"==t||"draw.solidRegion"==t||"draw.copperArea"==t)&&e.dots.length>=4||"draw.differentialRoute"==t)},backStep:function(){var e=Cs;if(e.canBackStep())if(e[Uo]&&"function"==typeof e[Uo].backStep)e[Uo].backStep();else{e.dots.length-=2;if("draw.track"==Uo){var t=Zo.canvas.angle;e.certainPath="ARC"==t?e.certainPath.replace(/[LA][^LA]+$/i,""):e.certainPath.replace(/(\s+\S+){2}\s*$/,"")}e.DELETE=!0;e.draw(e.lastX,e.lastY)}},showSnapPoint:function(e,t){var r=Ls.getActiveLayer(),n=Cs.target&&m(Cs.target,"c_auto_net"),i=n||!Cs.target?"":m(Cs.target,"net");Fo.checkShow(e,t,i,r)}};!function(e){e.nameObj={};e.cancelNextName=function(){function t(t){if(e.nameObj[Uo+t]&&e.nameObj[Uo+t].match(/\d$/)){var r=e.resolveNextName(e.nameObj[Uo+t]),n=r.num,i=r.name;e.nameObj[Uo+t]=i+(n-1)}}if("place.part_pin"==Uo){t(0);t(1)}else t("")};e.updateNextDrawLineName=function(t,r){e.nameObj[t]&&r.match(/\d$/)&&(e.nameObj[t]=r)};e.resolveNextName=function(e){var t,r=e.match(/\d+$/)[0],n=e.match(/(.*?)\d+$/)?e.match(/(.*?)\d+$/)[1]:"";if(!isNaN(r)){var i=r.match(/^0+/);r*=1;if(i){t=i[0];String(r+1).length!=String(r).length&&(t=t.substr(0,t.length-1));n+=t}}return{name:n,num:r}};e.getNextName=function(t){void 0===t&&(t="");var r,n,i="";if(e.nameObj[Uo+t]){if(e.nameObj[Uo+t].match(/\d$/)){n=e.resolveNextName(e.nameObj[Uo+t]);r=n.num;i=n.name;e.nameObj[Uo+t]=i+(r+1)}else if(!e.nameObj[Uo+t].match(/\d$/))return e.nameObj[Uo+t]}else if("place.part_pin"==Uo||"place.part_netLabel_text"==Uo||"place.part_netLabel_netPort"==Uo||"place.part_netLabel_volProbe"==Uo||"place.part_pad"==Uo){"place.part_netLabel_text"==Uo?i="netLabel":"place.part_netLabel_netPort"==Uo?i="netPort":"place.part_netLabel_volProbe"==Uo&&(i="volProbe");var a,o,s,l=Uo.split(".")[1],c=p("#g1 > g[c_partid="+l+"]",Go).filter(function(t){return t!=e.target}),d=0;for(a=0;a<c.length;a++){if("part_pad"===l){o=c[a];s=o&&m(o,"number")}else{o=c[a].childNodes["part_pin"===l?t||0:1];s=o&&o.textContent}if(s){r=s.match(/\d+$/)?s.match(/\d+$/)[0]:"";if(r&&r>d){n=e.resolveNextName(s);r=n.num;d=r}}}d+=1;e.nameObj[Uo+t]=i+d}return e.nameObj[Uo+t]}}(Cs);Cs["draw.arc2"]={ready:function(){Cs.started=!0},draw:function(e,t,r,n){var i,a,o,s,l,c,p,h,u,f,g,y=Cs,v="",x=y.dots,L=Ls.getActiveLayer(),_=r?y.dots.length-2>0?y.dots.length-2:0:y.dots.length;if(Zo.adsorbGrid.enabled){g=n?Ct({x:n.clientX,y:n.clientY}):{x:e,y:t};p=Fo.ifFind(g.x,g.y,"",L,"ALL");e==g.x&&t==g.y||p&&p.type||(p=Fo.ifFind(e,t,"",L,"ALL"));if(p&&p.type){e=Eo.formatLengthSave(p.X);t=Eo.formatLengthSave(p.Y);ur("cross-red",e,t)}}if(r){Zo.adsorbGrid.enabled&&(p=Fo.ifFind(e,t,"",L,"ALL"));var P;y.target&&(f=m(y.target,"c_auto_net"));if(p&&p.type){e=Eo.toFixed(p.X,2);t=Eo.toFixed(p.Y,2);ur("cross-red",e,t);if(p.net&&y.target){var A=m(y.target,"net");if(A!==p.net)if(A){f&&C(y.target,"c_auto_net");if(!bi(L))if(f){m(y.target,"net",p.net);P=Qo.mergeNets(p.net,A,!1)}else{P=Qo.mergeNets(A,p.net);if(!1===P){y.restart();return}}}else bi(L)||m(y.target,"net",p.net)}if(0===_){var b=["TRACK","ARC","CIRCLE"];y.startNet=p&&p.type?p.net:"";y.startNetId=p&&p.type?p.gId:"";y.startNetType=p&&p.type?p.type:"";y.startStrokeWidth=p&&p.strokeWidth&&b.indexOf(p.type)>-1?p.strokeWidth:""}if(p&&p.type&&_>=2){if(y.target){l=m(y.target,"net");if(!l){l=br();m(y.target,"net",l)}c=[["add",y.target.id,Eo.node.getRefId(y.target)]];Fo.updateOne(y.target);Qo.buildOneNet(l,!1);if(void 0!==P){if(P instanceof Array&&P.length)for(;s=P.shift();)c.push(["attr",s[0],{net:s[1]},{net:s[2]}])}else if(!bi(L)){if(y.startNetId&&y.startNet!=l){c.push(["attr",y.startNetId,{net:y.startNet},{net:l}]);m(d(y.startNetId),"net",l);Fo.updateOne(d(y.startNetId))}var S=p&&p.type?p.net:"",E=p&&p.type?p.gId:"";if(E&&S!=l){c.push(["attr",E,{net:S},{net:l}]);m(d(E),"net",l);Fo.updateOne(d(E))}}c.length&&zo.save(c);y.layerid=m(y.target,"layerid");y.target=null}y.next();return}}}0===_&&r&&(Cs.routedRealRatLine=Qo.findRatLineByPos(e,t,L));if(_>=2){if(Zo.adsorbGrid.enabled){p=Fo.ifFind(e,t,"",L,"ALL");if(p&&p.type){e=Eo.toFixed(p.X,2);t=Eo.toFixed(p.Y,2);ur("cross-red",e,t)}}if(x[_-2]==e&&x[_-1]==t)return;if(Cs.routedRealRatLine){var O=e,I=t;2==Cs.routedRealRatLine[1]?m(Cs.routedRealRatLine[0],{x2:O,y2:I}):m(Cs.routedRealRatLine[0],{x1:O,y1:I})}if(y.target){a=fe(x[0],x[1],e,t)/2;i="M"+x[0]+","+x[1]+" A"+a+","+a+" 0 0 1 "+e+","+t;m(y.target,"d",i);if(r){ji(y.target);Fo.updateOne(y.target);y.next()}Is==ao.PCB&&y.target&&Ko.doRealtimeDRC(y.target,!0)}else{y.certainPath="";v=y.startNet||"";p&&p.type&&p.net&&(v?v&&v!==p.net&&Qo.mergeNets(v,p.net):v=p.net);bi(L)&&(v="");h={"stroke-width":L==io.BOARDOUTLINE?1:Zo.canvas.routing,fill:"none",id:Eo.newId(),c_shapetype:"line",layerid:L,net:v};o="path";y.startStrokeWidth&&(h["stroke-width"]=y.startStrokeWidth);a=fe(x[0],x[1],e,t)/2;i="M"+x[0]+","+x[1]+" A"+a+","+a+" 0 0 1 "+e+","+t;h.d=i;y.target=zt(o,h);Ka.appendChild(y.target);In(v)}}if(y.target){y.target.id||m(y.target,{id:Eo.newId()});u="ARC";m(y.target,"layerid",L);Ls.updateElementLayerId(y.target,u);Ls.appendElement(y.target,u)}!r&&Zo.adsorbGrid.enabled&&Cs.showSnapPoint(e,t)},next:function(e,t){var r,n,i,a=Cs,o=a.dots;if(a.target)if(o.length<=2){v(a.target);a.target=null}else if(o.length<4){v(a.target);a.target=null}if(a.target){i=["add",a.target.id,Eo.node.getRefId(a.target)];n=m(a.target,"net");r=m(a.target,"layerid");if(!n){var s=bo.getCacheObj("AssignNet");void 0===s&&(s=!0);if(s&&r&&oi(r)&&Is!==ao.PCBLIB&&!bi(r)){n=br();m(a.target,"net",n)}}if(!a.startNet&&a.startNetId&&a.startNetType){m(d(a.startNetId),"net",n);Fo.updateOne(d(a.startNetId));i=[i,["attr",a.startNetId,{net:""},{net:n}]]}Fo.updateOne(a.target);bi(r)&&qo.rebuildPlane(r);Qo.buildOneNet(m(a.target,"net"),!1);zo.save(i);a.target=null}else{r=a.layerid||Ls.getActiveLayer();bi(r)&&qo.rebuildPlane(r)}In("")},end:function(){var e=Cs;if(e.target){v(e.target);Qo.buildOneNet(m(e.target,"net"),!1)}In("");Cs.routedRealRatLine=null}};Cs["draw.arcCenter"]={ready:function(){Cs.started=!0},draw:function(e,t,r,n){var i,a,o,s,l,c,p,h,u,f,g,y=Cs,v="",x=y.dots,L=Ls.getActiveLayer(),_=r?y.dots.length-2>0?y.dots.length-2:0:y.dots.length;g=n?Ct({x:n.clientX,y:n.clientY}):{x:e,y:t};p=Fo.ifFind(g.x,g.y,"",L,"ALL");e==g.x&&t==g.y||p&&p.type||(p=Fo.ifFind(e,t,"",L,"ALL"));if(p&&p.type){e=Eo.formatLengthSave(p.X);t=Eo.formatLengthSave(p.Y);ur("cross-red",e,t)}if(r){p=Fo.ifFind(e,t,"",L,"ALL");var P;y.target&&(f=m(y.target,"c_auto_net"));if(p&&p.type){e=Eo.toFixed(p.X,2);t=Eo.toFixed(p.Y,2);ur("cross-red",e,t);if(p.net&&y.target){var A=m(y.target,"net");if(A!==p.net)if(A){f&&C(y.target,"c_auto_net");if(!bi(L))if(f){m(y.target,"net",p.net);P=Qo.mergeNets(p.net,A,!1)}else{P=Qo.mergeNets(A,p.net);if(!1===P){y.restart();return}}}else bi(L)||m(y.target,"net",p.net)}}if(2===_){y.startNet=p&&p.type?p.net:"";y.startNetId=p&&p.type?p.gId:"";y.startNetType=p&&p.type?p.type:""}if(p&&p.type&&_>=4){if(y.target){l=m(y.target,"net");if(!l){l=br();m(y.target,"net",l)}c=[["add",y.target.id,Eo.node.getRefId(y.target)]];Fo.updateOne(y.target);Qo.buildOneNet(l,!1);if(void 0!==P){if(P instanceof Array&&P.length)for(;s=P.shift();)c.push(["attr",s[0],{net:s[1]},{net:s[2]}])}else if(!bi(L)){if(y.startNetId&&y.startNet!=l){c.push(["attr",y.startNetId,{net:y.startNet},{net:l}]);m(d(y.startNetId),"net",l);Fo.updateOne(d(y.startNetId))}var b=p&&p.type?p.net:"",S=p&&p.type?p.gId:"";if(S&&b!=l){c.push(["attr",S,{net:b},{net:l}]);m(d(S),"net",l);Fo.updateOne(d(S))}}c.length&&zo.save(c);y.layerid=m(y.target,"layerid");y.target=null}y.next();return}}if(_>=2){r&&(Cs.routedRealRatLine=Qo.findRatLineByPos(e,t,L));p=Fo.ifFind(e,t,"",L,"ALL");if(p&&p.type){e=Eo.toFixed(p.X,2);t=Eo.toFixed(p.Y,2);ur("cross-red",e,t)}if(x[_-2]==e&&x[_-1]==t)return;if(Cs.routedRealRatLine){var E=e,O=t;if(y.arcCenterRadius){var I=he(x[0],x[1],e,t);E=x[0]+y.arcCenterRadius*Math.cos(I);O=x[1]+y.arcCenterRadius*Math.sin(I)}2==Cs.routedRealRatLine[1]?m(Cs.routedRealRatLine[0],{x2:E,y2:O}):m(Cs.routedRealRatLine[0],{x1:E,y1:O})}if(r&&2===_){y.certainPath="";v=y.startNet||"";y.currNet=v;p&&p.type&&p.net&&(v?v&&v!==p.net&&Qo.mergeNets(v,p.net):v=p.net);bi(L)&&(v="")}if(y.target){Cs.routedRealRatLine&&In(y.currNet);m(y.target,"net")||m(y.target,"net",y.currNet);if(x.length<4){var T=ge([e,t],180,x[0],x[1]);a=fe(T[0],T[1],e,t)/2;i="M"+T[0]+","+T[1]+" A"+a+","+a+" 0 0 1 "+e+","+t;i+="M"+e+","+t+" A"+a+","+a+" 0 0 1 "+T[0]+","+T[1];m(y.target,"d",i)}else if(x.length>=4&&!r&&y.arcCenterDots&&y.arcCenterOppositeDots){var R=he(x[0],x[1],e,t),w=x[0]+y.arcCenterRadius*Math.cos(R),N=x[1]+y.arcCenterRadius*Math.sin(R),k=(w-y.arcCenterOppositeDots[0])*(y.arcCenterDots[1]-y.arcCenterOppositeDots[1])-(N-y.arcCenterOppositeDots[1])*(y.arcCenterDots[0]-y.arcCenterOppositeDots[0])>0?0:1;i="M"+y.arcCenterDots[0]+","+y.arcCenterDots[1]+" A"+y.arcCenterRadius+","+y.arcCenterRadius+" 0 "+k+" 0 "+w+","+N;m(y.target,"d",i)}if(r)if(x.length>=6){ji(y.target);Fo.updateOne(y.target);y.next()}else if(4===x.length){var M=ge([e,t],180,x[0],x[1]);y.arcCenterDots=[e,t];y.arcCenterOppositeDots=M;y.arcCenterRadius=fe(M[0],M[1],e,t)/2}Is==ao.PCB&&y.target&&Ko.doRealtimeDRC(y.target,!0)}else{h={"stroke-width":L==io.BOARDOUTLINE?1:Zo.canvas.routing,fill:"none",id:Eo.newId(),c_shapetype:"line",layerid:L,net:v};var B=ge([e,t],180,x[0],x[1]);o="path";a=fe(B[0],B[1],e,t)/2;i="M"+B[0]+","+B[1]+" A"+a+","+a+" 0 0 1 "+e+","+t;i+="M"+e+","+t+" A"+a+","+a+" 0 0 1 "+B[0]+","+B[1];h.d=i;y.target=zt(o,h);Ka.appendChild(y.target)}}if(y.target){y.target.id||m(y.target,{id:Eo.newId()});u="ARC";m(y.target,"layerid",L);Ls.updateElementLayerId(y.target,u);Ls.appendElement(y.target,u)}r||Cs.showSnapPoint(e,t)},next:function(e,t){var r,n,i,a=Cs,o=a.dots;if(a.target)if(o.length<=2){v(a.target);a.target=null}else{a.arcCenterDots=null;a.arcCenterOppositeDots=null;a.arcCenterRadius=null;Cs.routedRealRatLine=null;a.currNet=null}if(a.target){i=["add",a.target.id,Eo.node.getRefId(a.target)];n=m(a.target,"net");r=m(a.target,"layerid");if(!n){var s=bo.getCacheObj("AssignNet");void 0===s&&(s=!0);if(r&&oi(r)&&s&&Is!==ao.PCBLIB&&!bi(r)){n=br();m(a.target,"net",n)}}if(!a.startNet&&a.startNetId&&a.startNetType){m(d(a.startNetId),"net",n);Fo.updateOne(d(a.startNetId));i=[i,["attr",a.startNetId,{net:""},{net:n}]]}Fo.updateOne(a.target);bi(r)&&qo.rebuildPlane(r);Qo.buildOneNet(m(a.target,"net"),!1);zo.save(i);a.target=null}else{r=a.layerid||Ls.getActiveLayer();bi(r)&&qo.rebuildPlane(r)}In("")},end:function(){var e=Cs;e.arcCenterDots=null;e.arcCenterOppositeDots=null;e.arcCenterRadius=null;e.currNet=null;if(e.target){v(e.target);Qo.buildOneNet(m(e.target,"net"),!1)}In("");Cs.routedRealRatLine=null}};Cs["draw.circle"]={ready:function(){Cs.started=!0},draw:function(e,t,r,n){var i,a,o,s,l,c,p,h,u=Cs,f=[],g=r?u.dots.length-2>0?u.dots.slice(0,u.dots.length-2):[]:u.dots,y=g.length,v=Ls.getActiveLayer();h=n?Ct({x:n.clientX,y:n.clientY}):{x:e,y:t};x=Fo.ifFind(h.x,h.y,"",v,"ALL");e==h.x&&t==h.y||x&&x.type||(x=Fo.ifFind(e,t,"",v,"ALL"));if(x&&x.type){e=Eo.formatLengthSave(x.X);t=Eo.formatLengthSave(x.Y);ur("cross-red",e,t)}if(r){var x=Fo.ifFind(e,t,"",v,"ALL");if(x&&x.length){e=Eo.toFixed(x.X,2);t=Eo.toFixed(x.Y,2);ur("cross-red",e,t)}var L;if(x&&x.type&&x.net&&u.target){var _=m(u.target,"net");if(_!==x.net&&_){l=m(u.target,"c_auto_net");l&&C(u.target,"c_auto_net");if(!bi(v))if(l){m(u.target,"net",x.net);L=Qo.mergeNets(x.net,_,!1)}else{L=Qo.mergeNets(_,x.net);if(!1===L){u.restart();return}}}}if(0===y){var P=["TRACK","ARC","CIRCLE"];u.startNet=x&&x.type?x.net:"";u.startNetId=x&&x.type?x.gId:"";u.startNetType=x&&x.type?x.type:"";u.startStrokeWidth=x&&x.strokeWidth&&P.indexOf(x.type)>-1?x.strokeWidth:""}if(y>=2){if(u.target){c=m(u.target,"net");if(x&&x.type&&!bi(v)){var A=x&&x.type?x.net:"",b=x&&x.type?x.gId:"";if(!c&&b)if(u.startNet&&u.startNet!==A){c=u.startNet;L=Qo.mergeNets(c,x.net);if(!L){u.restart();return}}else c=A;if(b){f.push(["attr",b,{net:A},{net:c}]);m(d(b),"net",c);Fo.updateOne(d(b));u.net=c}}if(!u.startNet&&!A){m(u.target,"c_auto_net");u.net=br()}bi(v)&&(u.net=br());f.length&&zo.save(f)}u.dots=[u.dots[0],u.dots[1],e,t];u.next()}}0===y&&r&&(Cs.routedRealRatLine=Qo.findRatLineByPos(e,t,v));if(y>=2){x=Fo.ifFind(e,t,"",v,"ALL");if(x&&x.type){e=Eo.toFixed(x.X,2);t=Eo.toFixed(x.Y,2);ur("cross-red",e,t)}if(Cs.routedRealRatLine){var S=e,E=t;2==Cs.routedRealRatLine[1]?m(Cs.routedRealRatLine[0],{x2:S,y2:E}):m(Cs.routedRealRatLine[0],{x1:S,y1:E})}i=g[y-2],a=g[y-1];o=fe(i,a,e,t);if(u.target)m(u.target,{cx:i,cy:a,r:o});else{u.certainPath="";p=u.startNet||"";x&&x.type&&x.net&&(p||(p=x.net));bi(v)&&(p="");u.net=p;var O=Zo.canvas.routing||1;u.startStrokeWidth&&(O=u.startStrokeWidth);u.target=zt("circle",{cx:i,cy:a,r:o,"stroke-width":O,fill:"none",layerid:v});m(u.target,{c_shapetype:"line"});Ka.appendChild(u.target)}r&&u.next();if(u.target){u.target.id||m(u.target,{id:Eo.newId()});s="CIRCLE";m(u.target,"layerid",v);Ls.updateElementLayerId(u.target,s);Ls.appendElement(u.target,s)}}r||Cs.showSnapPoint(e,t)},next:function(e,t){var r=Cs,n=r.dots;if(r.target){var i=m(r.target,"layerid");if(n.length<4){v(r.target);r.target=null}else{var a=bo.getCacheObj("AssignNet");void 0===a&&(a=!0);if(Bi(parseInt(i))){a&&Is!==ao.PCBLIB&&!bi(i)&&m(r.target,"net",r.net);Vi(r.target);bi(i)&&qo.rebuildPlane(i);Qo.buildGroupNets([r.net]);var o={start:n[0]+","+n[1],end:n[2]+","+n[3],net:r.net,autoNet:m(r.target,"c_auto_net")};m(r.target,"autoNet",o.autoNet)}bi(i)&&qo.rebuildPlane(i);ji(r.target);Fo.updateOne(r.target)}}else{i=Ls.getActiveLayer();bi(i)&&qo.rebuildPlane(i)}},end:function(e){var t=Cs;t.target&&v(t.target)}};Cs["draw.connect"]={ready:function(){Ls.show(io.RATLINES)},draw:function(e,t,r){var n,a,o,s,l=Cs,c=r?l.dots.length-2>0?l.dots.slice(0,l.dots.length-2):[]:l.dots,d=(Ls.getActiveLayer(),c.length);if(0===d){if(r){o=Fo.ifFind(e,t,"",io.ALL,"ALL");if(!o||!o.isFootprintPad){l.dots.splice(0,2);return}e=o.X;t=o.Y;Cs.fromPadId=o.gId}}else if(d>=2){if(r){o=Fo.ifFind(e,t,"",io.ALL,"ALL");if(!o||!o.isFootprintPad){l.dots.splice(d-2,2);return}e=o.X;t=o.Y;if(e==c[d-2]&&t==c[d-1])return}if(l.target){m(l.target,{x2:e,y2:t});if(r){v(l.target);l.target=null;if(o.gId){var p=Qo.connect(l.fromPadId,o.gId);s=[];if(p&&p.length){for(;i=p.shift();)s.push(["attr",i[0],{net:i[1]},{net:i[2]}]);zo.save(s)}}l.next()}}else{a="line";n={x1:c[0],y1:c[1],x2:e,y2:t,id:Eo.newId(),c_shapetype:"line"};n.layerid=io.RATLINES;l.target=zt(a,n);Ka.appendChild(l.target)}l.target&&(l.target.id||m(l.target,{id:Eo.newId()}))}},next:function(e,t){var r=Cs,n=r.dots;e&&t&&(n=r.dots.length-2>0?r.dots.slice(0,r.dots.length-2):[]);if(r.target&&n.length<=2&&r.target){v(r.target);r.target=null}},end:function(){var e=Cs;e.target&&v(e.target)}};Cs["draw.copperArea"]={ready:function(){var e=Cs;e.removeLastSeg=!0;e.segItemCounts=[];var t=Fo.gJsonCache.COPPERAREA||{},r=[];for(var n in t)r.push(t[n].order);0==r.length?e.copperAreaOrder=0:e.copperAreaOrder=Math.max.apply(null,r)},draw:function(e,t,r){var n,i,a,o,s,l,c,d=Cs,p="COPPERAREA",h=d.dots,u=Ls.getActiveLayer(),f=h.length,g=0,y=Zo.canvas.angle,v=Cs.trackPreference[y];"45"==y?y="0":"0"==y&&(y="45");if(f>=2)if(d.target){o=d.target.pathSegList;if(!r){if(o.numberOfItems)if(d.removeLastSeg){d.removeItemCount||(d.removeItemCount=1);1===o.getItem(o.numberOfItems-1).pathSegType&&d.removeItemCount++;if(d.DELETE){var x=d.segItemCounts.length;if(x>1){d.removeItemCount+=d.segItemCounts[x-1].counts;d.segItemCounts.pop()}}for(i=0;i<d.removeItemCount;i++)o.removeItem(o.numberOfItems-1);d.removeItemCount=null}else if(d.DELETE){d.removeItemCount=1;x=d.segItemCounts.length;if(x>1){d.removeItemCount+=d.segItemCounts[x-1].counts;d.segItemCounts.pop();for(i=0;i<d.removeItemCount;i++)o.removeItem(o.numberOfItems-1);d.removeItemCount=null}}a=m(d.target,"d");if("ARC"==y){s="arc-90"==v?" 0 0 1 ":" 0 0 0 ";g=fe(h[f-2],h[f-1],e,t)/2;a+=" A"+g+","+g+s+e+","+t;d.removeItemCount=1}else{l=ls.formatTrackPoints(h.slice(-2),y,e,t,v);l=l.replace(/^\S+\s+\S+/,"");c=l.trim().split(" ");for(i=0;i<c.length;i++)a+=i%2==0?" L"+c[i]:","+c[i];d.removeItemCount=c.length/2}a=a.replace(/Z/g,"");a+=" Z";m(d.target,{d:a});d.target.id||m(d.target,{id:Eo.newId()});d.DELETE=""}}else{a="M"+h[0]+","+h[1];n="path";d.copperAreaOrder+=1;d.target=zt(n,{d:a,"stroke-width":"1",clearanceWidth:"1",fillStyle:"solid",fill:"none",c_shapetype:"line",thermal:"spoke",keepIsland:"none","stroke-dasharray":"3,3",net:"GND",layerid:u,copper:u,name:"",order:d.copperAreaOrder});Ka.appendChild(d.target);Ls.updateElementLayerId(d.target,p);Ls.appendElement(d.target,p)}if(r){d.removeLastSeg=!1;d.segItemCounts.push({p:{x:e,y:t},counts:d.removeItemCount})}else d.removeLastSeg=!0;if(d.target){d.target.id||m(d.target,{id:Eo.newId()});m(d.target,"layerid",u);Ls.updateElementLayerId(d.target,p);Ls.appendElement(d.target,p)}},next:function(e,t){var r=Cs,n=r.dots;if(r.target)if(n.length<4||!Er(r.target)){if(r.target){v(r.target);r.target=null}}else{ji(r.target);Fo.updateOne(r.target);Qo.buildOneNet(m(r.target,"net"),!1)}r.DELETE&&(r.DELETE="");r.segItemCounts=[]},end:function(e){var t=Cs,r=t.dots;if(!e&&t.target&&r.length>=4&&Er(t.target)){Fo.updateOne(t.target);Qo.buildOneNet(m(t.target,"net"),!1);zo.save(["add",t.target.id,Eo.node.getRefId(t.target)])}else t.target&&v(t.target)}};Cs["draw.dimension"]={ready:null,draw:function(e,t,r){var n,i,a,o,s=Cs,l=r?s.dots.length-2>0?s.dots.slice(0,s.dots.length-2):[]:s.dots,c=Ls.getActiveLayer(),d=[io.BOTTOMSILKLAYER,io.BOTTOMASSEMBLY].indexOf(+c)>-1,p=l.length,h=!s.target;if(p>=2)if(s.target){var u=m(s.target,"c_fontSize"),f=m(s.target,"c_precision"),g=m(s.target,"c_unit");o=ls.getDimensionPath({fromP:{x:l[0],y:l[1]},toP:{x:e,y:t},precision:f,unit:g,fontSize:u,mirror:d});m(s.target,"d",o);if(r){ji(s.target);Fo.updateOne(s.target);s.next()}}else{o=ls.getDimensionPath({fromP:{x:l[0],y:l[1]},toP:{x:e,y:t}});i="path";n={d:o,"stroke-width":"1",fill:"none",id:Eo.newId(),c_shapetype:"group"};s.target=zt(i,n);Ka.appendChild(s.target)}if(s.target){s.target.id||m(s.target,{id:Eo.newId()});if(h&&"draw.connect"!=Uo){a="PROTRACTOR";m(s.target,"layerid",c);Ls.updateElementLayerId(s.target,a);Ls.appendElement(s.target,a)}}},next:function(e,t){var r=Cs,n=r.dots;if(r.target&&n.length<=2&&r.target){v(r.target);r.target=null}},end:function(e){var t=Cs;t.target&&v(t.target)}};Cs["draw.measureLine"]={ready:function(){var e=Eo.newId();this.preMeasureLine=this.measureLine;this.measureLine=zt("line",{id:e,x1:0,y1:0,x2:0,y2:0,stroke:"#FFFFFF","stroke-width":1,visibility:"hidden"});Ka.appendChild(this.measureLine);Cs.target=this.measureLine;Cs.started=!0},draw:function(e,t,r,n){var i,a,o,s,l,c,d,p=Cs,h=p.dots,u=h.length,f=n?Ct({x:n.clientX,y:n.clientY}):{x:e,y:t},g=function(e){return Eo.units.convert(e,"pixel",Zo.canvas.unit)};if(Zo.adsorbGrid.enabled){c=Fo.ifFind(f.x,f.y,"",io.ALL,"MeasureLine");e===f.x&&t===f.y||c&&c.type||(c=Fo.ifFind(e,t,"","","MeasureLine"));if(c&&c.type){e=Eo.formatLengthSave(c.X);t=Eo.formatLengthSave(c.Y);ur("cross-red",e,t)}else if(c&&c.length){e=Eo.formatLengthSave((c[0].minX+c[0].maxX)/2);t=Eo.formatLengthSave((c[0].minY+c[0].maxY)/2);ur("cross-red",e,t)}}if(r&&2===u&&(e!==h[0]||t!==h[1])){h[0]=e;h[1]=t}if(u>=2)if("hidden"===m(this.measureLine,"visibility")){this.preMeasureLine&&v(this.preMeasureLine);m(this.measureLine,{x1:h[0],y1:h[1],x2:e,y:t,visibility:"yes","stroke-width":1/wo})}else{m(this.measureLine,{x2:e,y2:t});i=m(this.measureLine,"x1");a=m(this.measureLine,"y1");o=i-e;s=a-t;d=Eo.toFixed(g(Math.sqrt(o*o+s*s)),lo.decimalPlacesShow,lo.fixedDecimal);l=Eo.toFixed(180-180*Math.atan2(s,o)/Math.PI,lo.decimalPlacesShow,lo.fixedDecimal);sr("editorMsgbox",["DX:"+Math.abs(Eo.toFixed(g(o),lo.decimalPlacesShow,lo.fixedDecimal))+Zo.canvas.unit+"<br/>DY:"+Math.abs(Eo.toFixed(g(s),lo.decimalPlacesShow,lo.fixedDecimal))+Zo.canvas.unit+'<br/><span class="i18n">Length:</span>'+d+Zo.canvas.unit+'<br/><span class="i18n">Angle:</span>'+l+"°",{left:n.clientX+50,top:n.clientY+50}]);r&&p.next("notSaveHistory")}},next:function(){this.ready()},end:function(){v(this.measureLine);v(this.preMeasureLine);sr("editorMsgbox",[null])}};Cs["draw.origin"]={tree:null,margin:null,showSnapPoint:function(e,t){m(d("pdot0"),{display:"",cx:e,cy:t})},hideSnapPoint:function(){m(d("pdot0"),"display","none")},getSearchArea:function(e,t){var r,n;if(t.width&&t.height){r=t.width/2;n=t.height/2}else r=n=+t;return{minX:e.x-r,minY:e.y-n,maxX:e.x+r,maxY:e.y+n}},ready:function(){var e=Cs,t=Cs["draw.origin"];t.margin=Zo.adsorbGrid.distanceX/2;var r,n,i,a,o,s,l,c,d=Fo.gJsonCache.ARC,p=Fo.gJsonCache.CIRCLE,h=Fo.gJsonCache.TRACK,u=Fo.gJsonCache.PAD,f=Fo.gJsonCache.VIA,g=Fo.gJsonCache.HOLE;e.preOrigin={offsetX:0,offsetY:0};e.started=!0;t.tree=rbush(9);for(a in d)if(S(d,a)){n=d[a];o=n.pointArr;!o&&n.d&&(o=pi({d:n.d},!1));var y=n.strokeWidth/2;if(D(o)){s=o[0];l=o[Math.round(o.length/2)-1];c=o[o.length-1];t.tree.insert(t.getSearchArea(s,y));t.tree.insert(t.getSearchArea(l,y));t.tree.insert(t.getSearchArea(c,y));var v=n.d.match(/([-+]?\d+(\.\d+)?)/g),x=Eo.arc.getCenterParam(+v[0],+v[1],+v[7],+v[8],+v[5],+v[6],+v[2],+v[3],+v[4]);t.tree.insert(t.getSearchArea({x:x.cx,y:x.cy},n.strokeWidth))}}for(a in p)S(p,a)&&t.tree.insert(t.getSearchArea({x:p[a].cx,y:p[a].cy},p[a].strokeWidth));for(a in h)if(S(h,a)){i=h[a];o=i.pointArr;if(D(o))for(r=0;r<o.length;r++)t.tree.insert(t.getSearchArea(o[r],i.strokeWidth/2))}for(a in u)S(u,a)&&t.tree.insert(t.getSearchArea(u[a],u[a]));for(a in f)S(f,a)&&t.tree.insert(t.getSearchArea(f[a],f[a].diameter/2));for(a in g)S(g,a)&&t.tree.insert(t.getSearchArea(g[a],g[a].holeR))},draw:function(e,t,r,n){var i=Cs,o=Cs["draw.origin"];o.hideSnapPoint();var s=n?Ct({x:n.clientX,y:n.clientY}):{x:e,y:t};if(Zo.adsorbGrid.enabled){var l=o.tree.search({minX:s.x-o.margin,minY:s.y-o.margin,maxX:s.x+o.margin,maxY:s.y+o.margin});e==s.x&&t==s.y||l&&l.length||(l=o.tree.search({minX:e-o.margin,minY:t-o.margin,maxX:e+o.margin,maxY:t+o.margin}));if(l&&l.length){e=Eo.formatLengthSave(l[0].minX+l[0].maxX)/2;t=Eo.formatLengthSave(l[0].minY+l[0].maxY)/2;ur("cross-red",e,t);o.showSnapPoint(e,t)}}if(r){i.preOrigin.offsetX=e-Zo.canvas.originX;i.preOrigin.offsetY=t-Zo.canvas.originY;a("setOriginXY",[{x:e,y:t}]);i.end();kr();sr("setTabUnsaved");zo.save(["originXY","set.origin",i.preOrigin])}var c=p('[c_shapetype="dimensionCheck"]');c.length>0&&zr(c)},next:function(){var e=Cs,t=Cs["draw.origin"];t.tree=null;t.margin=null;e.end();kr()},end:null};Cs["place.part"]={cloneTemplate:function(){if(!Uo)return kr();var e=Uo.substr(6);this.template=d(e);Cs.target=this.template.cloneNode(!0);Cs.lastX&&Cs.lastY&&yr(Cs.target,Cs.lastX,Cs.lastY);Ls.appendElement(Cs.target);m(Cs.target,{id:Eo.newId(),c_shapetype:"group",c_etype:"pinpart"});if("place.part_pad"==Uo){var t=Cs.getNextName();m(Cs.target,"number",t);Oi(Cs.target,m(Cs.target,"c_shape"))}var r=+Ls.getActiveLayer()||1,n=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER,io.BOTTOMASSEMBLY];if("place.part_pcbtext"==Uo){var i=m(Cs.target,"c_mirror"),a=m(Cs.target,"c_origin"),o=n.indexOf(r)>=0;if("h"==i!=o){m(Cs.target,"c_mirror",o?"h":"none");is.flipH(Cs.target,+a.split(",")[0])}m(Cs.target,"layerid",Ls.getValidLayer("TEXT",r)||r)}jt(Cs.target)},ready:function(){this.cloneTemplate();Cs.started=!0;var e=tr(),t=e.viewBox;t=t.split(" ");var r=+t[0],n=+t[1],i=+t[2],a=+t[3];Cs.lastX&&Cs.lastY&&yr(Cs.target,r+i+1e3,n+a+1e3)},draw:function(e,t,r){var n,i=Cs.target,a=m(Cs.target,"layerid");if(i)if(r){if(r&&!m(i,"c_module")){C(i,"pointer-events");this.extendPadNet(i,e,t);var o;if("place.part_via"==Uo){o=Is==ao.PCB?Qn(i,e,t):null;o&&(n=o.history)}Is==ao.PCB&&ti(i);ji(i);Fo.updateOne(i);Qo.buildOneNet(m(i,"net"),!1);n?zo.save(n.concat([["add",i.id]])):zo.save(["add",i.id])}else if(r&&m(i,"c_module")){var s=d("pcblayerStyle").sheet;s.insertRule("#"+i.id+" [layerid] { display:inline}",0);!function(e){for(var t=e.children.length-1;t>=0;t--){var r=e.children[t],n=Eo.svg.getBBox(r);n.width||n.height||v(r)}}(i);s.deleteRule(0);jt(i);for(var l,c,p=[].slice.call(i.children),h=[],u=0;u<p.length;u++){var f=p[u],g=f.tagName;h[u]=f.id;c=Z(f);"COPPERAREA"===c&&(l=!0)
;if("importDxf"===m(i,"c_from")||m(i,"c_module")){if(m(f,"attachedcopperid"))continue;Ls.appendElement(i.removeChild(f))}else Ls.appendElement(f);"g"==g?ti(f):"polyline"!=g&&"polygon"!=g||ut(f,Pt(f,1));Fo.updateOne(f,{notCopper:!0})}l&&sr("buildCopper");"place.part_pad"!=Uo&&"place.part_via"!=Uo||!bi(a,!0)||qo.rebuildPlane(a);if(h.length){h=h.join(",");Qo.buildAllNet();zo.save(["add",h])}}this.cloneTemplate()}else{"none"==m(i,"display")&&m(i,"display","");yr(i,e,t);navigator.userAgent.indexOf("Firefox")>-1&&"FOOTPRINT"===Z(i)&&yr(this.template,-e,-t)}},next:function(){Cs.started=!0},end:function(){yr(this.template.id);Cs.target.parentNode.removeChild(Cs.target);p('[c_from="importDxf"], [c_module]').forEach(function(e){v(e)});Cs.cancelNextName();kr()},extendPadNet:function(e,t,r){var n,i,a,o,s,l,c,d=m(e,"c_shape");if(-1!==["place.part_pad","place.part_via"].indexOf(Uo)){switch(Uo){case"place.part_via":n=Number(m(p("circle",e)[0],"r"));break;case"place.part_pad":if("ELLIPSE"===d)n=Number(m(p("ellipse",e)[2],"rx"));else if("OVAL"===d)n=Number(m(p("polyline",e)[0],"stroke-width"))/2;else if("RECT"===d||"POLYGON"===d){c=Eo.svg.getBBox(p("polygon",e)[0]);n=Math.max(c.width,c.height)/2}break;default:return}a=Fo.ifFind(t,r,"",io.ALL,"ALL")||{};if("PAD"!==a.type&&"VIA"!==a.type){i={centerPoint:{x:t,y:r},startPoint:{x:t+Math.cos(0)*n,y:r+Math.sin(0)*n},endPoint:{x:t+Math.cos(Math.PI)*n,y:r+Math.sin(Math.PI)*n},r:n,startAngle:0,endAngle:Math.PI,clockwise:1};o=pi(i,!1);i.clockwise=0;o=o.concat(pi(i,!1));for(s=0;s<o.length;s+=1){l=o[s];a=Fo.ifFind(l.x,l.y,"",io.ALL,"ALL")||{};if("PAD"===a.type||"VIA"===a.type){m(e,"net",a.net);return}}}else m(e,"net",a.net)}}};Cs["place.image"]={cloneTemplate:function(){var e=Uo.substr(6);this.template=d(e);Cs.target=this.template.cloneNode(!0);Ls.appendElement(Cs.target);m(Cs.target,{id:Eo.newId(),c_shapetype:"group",c_etype:"pinpart"});"place.part_pad"==Uo&&m(Cs.target,"number","");jt(Cs.target)},ready:function(){this.cloneTemplate();Cs.started=!0;var e=+Ls.getActiveLayer()||1,t=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER],r=m(Cs.target,"c_mirror"),n=m(Cs.target,"c_origin"),i=t.indexOf(e)>=0;if("h"==r!=i){m(Cs.target,"c_mirror",i?"h":"none");is.flipH(Cs.target,+n.split(",")[0])}},draw:function(e,t,r){var n,i=Cs.target;if(i)if(r){if(r&&!m(i,"c_module")){C(i,"pointer-events");var a;if("place.part_via"==Uo){a=Is==ao.PCB?Qn(i,e,t):null;a&&(n=a.history)}Is==ao.PCB&&ti(i);Fo.updateOne(i);Qo.buildOneNet(m(i,"net"),!1);n?zo.save(n.concat([["add",i.id]])):zo.save(["add",i.id])}else if(r&&m(i,"c_module")){!function(e){for(var t=e.children.length-1;t>=0;t--){var r=e.children[t],n=Eo.svg.getBBox(r);n.width||n.height||v(r)}}(i);jt(i);for(var o=[].slice.call(i.children),s=[],l=0;l<o.length;l++){var c=o[l],d=c.tagName;s[l]=c.id;Ls.appendElement(i.removeChild(c));"g"==d?ti(c):"polyline"!=d&&"polygon"!=d||ut(c,Pt(c,1));ji(c);Fo.updateOne(c)}if(s.length){s=s.join(",");Qo.buildAllNet();zo.save(["add",s])}}this.cloneTemplate()}else{"none"==m(i,"display")&&m(i,"display","");yr(i,e,t)}},next:function(){THIS.started=!0},end:function(){yr(this.template.id);Cs.target.parentNode.removeChild(Cs.target);kr()}};Cs["draw.protractor"]={ready:null,draw:function(e,t,r){var n,i=Cs,a=i.dots,o=Ls.getActiveLayer(),s=[io.BOTTOMSILKLAYER,io.BOTTOMASSEMBLY].indexOf(+o)>-1,l=a.length,c=!i.target;if(l>=2){var d=i.protractorTrackLinePath?i.protractorTrackLinePath:"",p=null,h=null;n="PROTRACTOR";if(r&&a.length>=6){ji(i.target);Fo.updateOne(i.target);i.next();return}if(2===a.length){p=a[0];h=a[1];d="M"+e+" "+t+" L"+p+" "+h}4===a.length&&(d=ls.getProtractorPath(a.slice(0,2),[e,t],a.slice(2,4),{mirror:s}));if(d)if(i.target)m(i.target,"d",d);else{i.target=zt("path",{d:d,layerid:Ls.getValidLayer(n,o),fill:"none","stroke-width":.7,c_shapetype:"protractor",c_fontSize:"4.5",c_precision:"0"});Ka.appendChild(i.target)}if(i.target){i.target.id||m(i.target,{id:Eo.newId()});if(c){n="PROTRACTOR";m(i.target,"layerid",o);Ls.updateElementLayerId(i.target,n);Ls.appendElement(i.target,n)}}}},next:function(e,t){var r=Cs,n=r.dots;if(r.target&&n.length<=2&&r.target){v(r.target);r.target=null}},end:function(e){var t=Cs;t.target&&v(t.target)}};Cs["draw.rect"]={ready:null,draw:function(e,t,r){var n,i,a,o,s,l=Cs,c=r?l.dots.length-2>0?l.dots.slice(0,l.dots.length-2):[]:l.dots;n=c.length;var d=Ls.getActiveLayer(),p=!l.target;if(n>=2){o=Math.min(e,c[n-2]),s=Math.min(t,c[n-1]),i=Math.max(e,c[n-2])-o,a=Math.max(t,c[n-1])-s;0!==i&&0!==a||(i=a=Math.max(i,a));if(l.target)m(l.target,{x:o,y:s,width:i,height:a});else{l.target=zt("rect",{x:o,y:s,width:i,height:a,"stroke-width":"0"});m(l.target,{c_shapetype:"line"});Is==ao.PCBLIB&&m(l.target,{fill:"none",fillType:"none","stroke-width":"1",layerid:Ls.getValidLayer("HOLLOWRECT",d)});Ka.appendChild(l.target)}if(r){c.push(e,t);ji(l.target);Fo.updateOne(l.target);l.next()}if(l.target){l.target.id||m(l.target,{id:Eo.newId()});if(p){Ls.updateElementLayerId(l.target);Ls.appendElement(l.target)}}}},next:function(){var e=Cs,t=e.dots;if(e.target&&t.length<=2&&e.target){v(e.target);e.target=null}},end:function(){var e=Cs;e.target&&v(e.target)}};Cs["draw.solidRegion"]={ready:function(){var e=Cs;e.removeLastSeg=!0;e.segItemCounts=[]},draw:function(e,t,r){var n,i,a,o,s,l,c,d=Cs,p="SOLIDREGION",h=d.dots,u=Ls.getActiveLayer(),f=h.length,g=0,y=Zo.canvas.angle,v=Cs.trackPreference[y];"45"==y?y="0":"0"==y&&(y="45");if(f>=2)if(d.target){o=d.target.pathSegList;if(!r){if(o.numberOfItems)if(d.removeLastSeg){d.removeItemCount||(d.removeItemCount=1);1===o.getItem(o.numberOfItems-1).pathSegType&&d.removeItemCount++;if(d.DELETE){var x=d.segItemCounts.length;if(x>1){d.removeItemCount+=d.segItemCounts[x-1].counts;d.segItemCounts.pop()}}for(i=0;i<d.removeItemCount;i++)o.removeItem(o.numberOfItems-1);d.removeItemCount=null}else if(d.DELETE){d.removeItemCount=1;x=d.segItemCounts.length;if(x>1){d.removeItemCount+=d.segItemCounts[x-1].counts;d.segItemCounts.pop();for(i=0;i<d.removeItemCount;i++)o.removeItem(o.numberOfItems-1);d.removeItemCount=null}}a=m(d.target,"d");if("ARC"==y){s="arc-90"==v?" 0 0 1 ":" 0 0 0 ";g=fe(h[f-2],h[f-1],e,t)/2;a+=" A"+g+","+g+s+e+","+t;d.removeItemCount=1}else{l=ls.formatTrackPoints(h.slice(-2),y,e,t,v);l=l.replace(/^\S+\s+\S+/,"");c=l.trim().split(" ");for(i=0;i<c.length;i++)a+=i%2==0?" L"+c[i]:","+c[i];d.removeItemCount=c.length/2}a=a.replace(/Z/g,"");a+=" Z";m(d.target,{d:a});var C=d.dots.concat();if("ARC"===y&&d.dots.length>0){for(var L=[.25,.5,.75],_=ui(a),i=0;i<L.length;i++){var P=Math.ceil(_.length*L[i]),A=_[P];C.push(A.x,A.y)}C.push(e,t);new cs.findFirstObjNet(d.target,C)}else if(d.dots.length>2){C.push(e,t);new cs.findFirstObjNet(d.target,C)}d.target.id||m(d.target,{id:Eo.newId()});d.DELETE=""}}else{a="M"+h[0]+","+h[1];n="path";d.target=zt(n,{d:a,"stroke-width":"1",type:"solid",layerid:u,c_shapetype:"line",drawing:"1","fill-opacity":"0"});Ka.appendChild(d.target);Ls.updateElementLayerId(d.target,p);Ls.appendElement(d.target,p)}if(r){d.removeLastSeg=!1;d.segItemCounts.push({p:{x:e,y:t},counts:d.removeItemCount})}else d.removeLastSeg=!0;if(d.target){d.target.id||m(d.target,{id:Eo.newId()});p="draw.solidRegion";m(d.target,"layerid",u);Ls.updateElementLayerId(d.target,p);Ls.appendElement(d.target,p)}},next:function(e,t){var r=Cs,n=r.dots;if(r.target)if(n.length<4||!Er(r.target)){if(r.target){v(r.target);r.target=null}}else{m(r.target,"layerid")==io.ALL&&m(r.target,"type","npth");m(r.target,"fill-opacity",1);cs.cleanNet();ji(r.target);Fo.updateOne(r.target);Qo.buildOneNet(m(r.target,"net"),!1)}r.DELETE&&(r.DELETE="");r.segItemCounts=[]},end:function(e){var t=Cs,r=t.dots;if(!e&&t.target&&r.length>=4&&Er(t.target)){Fo.updateOne(t.target);Qo.buildOneNet(m(t.target,"net"),!1);zo.save(["add",t.target.id,Eo.node.getRefId(t.target)])}else t.target&&v(t.target)},getArcDots:function(e,t,r){var n=fe(e.x,e.y,t.x,t.y)/2;return Eo.arc.getDotByAngle(n,n,r)}};Cs["draw.track"]={ready:function(){Cs.started=!0},draw:function(e,t,r,n){function i(e,t,r){var n,i=null;for(var a in t){n=t[a];if(S(t,a)&&r!==n.gId){var o=function(e){var t=e.pointArr,r=t.length-1;return[t[0],t[r]]}(n);if(!Pe(o[0],o[1])&&(Pe(e,o[0])||Pe(e,o[1]))){if(i)return null;i=n}}}return i}var a,o,s,l,c,p,h,u,f,g,y,x,L,_=Cs,P="",A=_.dots,b=Ls.getActiveLayer(),E=r?_.dots.length-2>0?_.dots.length-2:0:_.dots.length,O=Ai(),I=0,T=Zo.canvas.routeConflict;Is==ao.PCBLIB&&(T=0);void 0===T&&(T=0);Fo.gJsonCache.DRCRULE&&(_.drawDRCLine=Fo.gJsonCache.DRCRULE.showDRCRangeLine&&oi(b)&&Is==ao.PCB);if(bi(b)){_.drawDRCLine=!1;T=0}if(!_.drawDRCLine){v(_.DRCRangeLine);_.DRCRangeLine=null}if(_.controlLine){O=Ai(m(_.controlLine,"net"));O&&(I=O.clearance)}if(Zo.adsorbGrid.enabled){h=n?Ct({x:n.clientX,y:n.clientY}):{x:e,y:t};g=Fo.ifFind(h.x,h.y,"",b,"ALL");e==h.x&&t==h.y||g&&g.type||(g=Fo.ifFind(e,t,"",b,"ALL"));if(g&&g.type){e=Eo.formatLengthSave(g.X);t=Eo.formatLengthSave(g.Y);ur("cross-red",e,t);if("PAD"===g.type){var R=m(d(g.gId),"c_shape"),w=+m(d(g.gId),"c_rotation");if(["RECT","OVAL"].indexOf(R)>-1&&Math.abs(w%90)<22.5){if(!(_.prevPadId&&_.prevPadId===g.gId||_.oldTrackPreference)){_.prevPadId=g.gId;if("90-45"===_.trackPreference[45]){_.trackPreference[45]="45-90";_.oldPref="90-45"}}}else{_.prevPadId&&(_.prevPadId=null);if(_.oldPref){_.trackPreference[45]=_.oldPref;_.oldPref=null}}}}if(!g||!g.type||"TRACK"===g.type||"ARC"===g.type){if(m(_.controlLine,"points")&&45==Zo.canvas.angle&&"90-45"===_.trackPreference[45]){var M=m(_.controlLine,"points").split(" ");if("horizontal"===(M[0]===M[2]?"vertical":"horizontal")){if(Math.abs(M[1]-h.y)<2e3/No){t=M[1];ur("cross-red",e,t)}}else if(Math.abs(M[0]-h.x)<2e3/No){e=M[0];ur("cross-red",e,t)}}_.prevPadId&&(_.prevPadId=null);if(_.oldPref){_.trackPreference[45]=_.oldPref;_.oldPref=null}}}if(r){if(_.target&&m(_.target,"c_need_via")){if(m(_.target,"c_need_via")!=m(_.target,"layerid")&&oi(m(_.target,"layerid"))){var B;if("polyline"==_.target.tagName){B=m(_.target,"points").trim().split(" ");B={x:B[0],y:B[1]}}else if("path"==_.target.tagName){B=m(_.target,"full_d").split(/\s*[A-Z]\s*|[\s\,]+/i);B={x:B[1],y:B[2]}}if(B){var V=m(_.target,"net")||"",F=ei(B.x,B.y,V);Fo.updateOne(F);zo.save(["add",F.id,Eo.node.getRefId(F)])}}C(_.target,"c_need_via")}var G;if(g&&g.type){A[A.length-2>0?A.length-2:0]=e;A[A.length-1>0?A.length-1:1]=t;_.target&&("polyline"==_.target.tagName&&m(_.target,"full_points")?m(_.target,"points",m(_.target,"full_points")):"path"==_.target.tagName&&m(_.target,"full_d")&&m(_.target,"d",m(_.target,"full_d")));if(g.net&&_.target){var Y=m(_.target,"net");if(Y!==g.net&&0==T)if(Y){L=m(_.target,"c_auto_net");L&&C(_.target,"c_auto_net");if(L){m(_.target,"net",g.net);_.controlLine&&m(_.controlLine,"net",g.net);G=Qo.mergeNets(g.net,Y,!1)}else if(!bi(b)){G=Qo.mergeNets(Y,g.net);if(!1===G){_.restart();return}}}else{if("draw.track"==Uo&&"polyline"==_.target.tagName){var j=_.target.points.getItem(_.target.points.numberOfItems-1);j.x=e;j.y=t}var H=!1!==bo.getCacheObj("AssignNet");if(!bi(b)&&H&&Is!==ao.PCBLIB){m(_.target,"net",g.net);_.controlLine&&m(_.controlLine,"net",g.net)}}}}if(0===E){var X=["TRACK","ARC","CIRCLE"];_.startNet=g&&g.type?g.net:"";_.startNetId=g&&g.type?g.gId:"";_.startNetType=g&&g.type?g.type:"";_.startStrokeWidth=g&&g.strokeWidth&&X.indexOf(g.type)>-1?g.strokeWidth:""}if("yes"===Zo.canvas.removeLoop){if(g&&"TRACK"===g.type){var U=function(e){var t={},r=Fo.gJsonCache.TRACK;for(var n in r)S(r,n)&&r[n].layerid===b&&r[n].net===e&&(t[n]=r[n]);return t}(g.net),J={x:g.X,y:g.Y},z=i(J,U);if(z&&0===E){_.prevTrackId=z.gId;var W=z.pointArr;Xe(z.pointArr[0],J)&&(W=W.reverse());_.concatTrackPoints=k(W)}}if(E>=2&&!bi(b)&&"ARC"!==Zo.canvas.angle){if(_.prevTrackId){var Z=d(_.prevTrackId),K=m(Z,"stroke-width"),q=m(Z,"layerid");if(K===m(_.controlLine,"stroke-width")&&q==b){var $=m(_.target,"points")||"",Q=m(_.target,"full_points");if(_.concatTrackPoints&&-1===$.indexOf(_.concatTrackPoints)){var ee={"stroke-width":K,points:_.concatTrackPoints+" "+$,full_points:_.concatTrackPoints+" "+Q};if(Z){_.oldPrevTrackPoints=$;Fo.removeOne(Z);Ro.appendChild(Z)}m(_.target,ee)}}}if(g&&g.type){_.oldPrevTrackPoints||(_.oldPrevTrackPoints=m(_.target,"points"));_.concatTrackPoints=m(_.target,"points");z=i(J,U);if(_.prevTrackId&&!z||z&&z.gId!==_.prevTrackId){if(z&&m(z,"stroke-width")===m(_.controlLine,"stroke-width")){var te=z.pointArr;Xe(z.pointArr[0],J)||(te=te.reverse())}_.concatTrackPoints+=" "+k(te);m(_.target,{points:_.concatTrackPoints});f=[];_.prevTrackId&&f.push(["del",_.prevTrackId]);if(z&&m(z,"stroke-width")===m(_.controlLine,"stroke-width")){f.push(["del",z.gId]);var re=d(z.gId);Fo.removeOne(re);Ro.appendChild(re)}f.push(["add",m(_.target,"id")])}delete _.concatTrackPoints}}}if(!bi(b)&&g&&g.type&&E>=2&&(0==T||1==T&&!m(_.controlLine,"c_cut"))){if(_.target){u=m(_.target,"net");if(!u&&H&&Is!==ao.PCBLIB){u=br();m(_.target,"net",u);_.controlLine&&m(_.controlLine,"net",u)}f=f||[];if("path"==_.target.tagName){var ne=Eo.node.getRefId(_.target),ie=di(_.target),ae=ie.map(function(e){return e.id}).join(",");Fo.updateMore(ie);Qo.buildOneNet(u,!1);f.push(["add",ae,ne]);_.target=ie[ie.length-1]}else{Ls.appendElement(_.target);Fo.updateOne(_.target);Qo.buildOneNet(u,!1);f.push(["add",_.target.id,Eo.node.getRefId(_.target)])}if(void 0!==G){if(G instanceof Array&&G.length)for(;p=G.shift();)f.push(["attr",p[0],{net:p[1]},{net:p[2]}])}else{if(_.startNetId&&_.startNet!=u){f.push(["attr",_.startNetId,{net:_.startNet},{net:u}]);m(d(_.startNetId),"net",u);Fo.updateOne(d(_.startNetId))}var oe=g&&g.type?g.net:"",se=g&&g.type?g.gId:"";if(se&&oe!=u){f.push(["attr",se,{net:oe},{net:u}]);m(d(se),"net",u);Fo.updateOne(d(se))}}if("yes"===Zo.canvas.removeLoop&&"polyline"==_.target.tagName){var le=_.target,ce=ni(le);if(ce&&ce.type)if("replace"==ce.type){f.push(["del",ce.track.id,Eo.node.getRefId(ce.track)]);Fo.removeOne(ce.track);Ro.appendChild(ce.track);Qo.buildOneNet(m(ce.track,"net"),!1)}else if("cancel"==ce.type){Fo.removeOne(le);Qo.buildOneNet(u,!1);v(le);f.shift()}else if("merge"==ce.type)if(D(ce.track)){Qo.buildOneNet(u,!1);var de=le;ue=m(de,"points");fe=ce.points;var pe=ce.track[0].track.strokeWidth,he=m(de,"stroke-width");m(de,{points:fe,"stroke-width":pe});ce.track.forEach(function(e){var t=d(e.track.gId);f.push(["del",e.track.gId]);Fo.removeOne(t);Ro.appendChild(t);Qo.buildOneNet(m(t,"net"),!1)});gi(void 0,"S$6");Lt(de);fe=Eo.fixLongNumberString(m(de,"points"));m(ce.track,"points",fe);f.push(["attr",de.id,{points:ue,"stroke-width":he},{points:fe,"stroke-width":pe}]);Fo.updateOne(de);Qo.buildOneNet(m(de,"net"),!1)}else{Qo.buildOneNet(u,!1);var ue=m(le,"points"),fe=ce.points;pe=m(ce.track,"stroke-width");he=m(le,"stroke-width");m(le,{points:fe,"stroke-width":pe});Lt(le);fe=Eo.fixLongNumberString(m(le,"points"));m(le,"points",fe);f.push(["attr",le.id,{points:ue,"stroke-width":he},{points:fe,"stroke-width":pe}]);f.push(["del",ce.track.id]);Fo.removeOne(ce.track);Ro.appendChild(ce.track);Qo.buildOneNet(m(ce.track,"net"),!1);Fo.updateOne(le);Qo.buildOneNet(m(le,"net"),!1)}}_.target=null;_.certainPath=""}f&&f.length&&zo.save(f);m(_.controlLine,"c_cut")&&C(_.controlLine,"c_cut");_.next();return}}if(0===E)r&&(Cs.routedRealRatLine=Qo.findRatLineByPos(e,t,b));else if(E>=2){if(Cs.routedRealRatLine){var ge=e,ye=t;2==Cs.routedRealRatLine[1]?m(Cs.routedRealRatLine[0],{x2:ge,y2:ye}):m(Cs.routedRealRatLine[0],{x1:ge,y1:ye})}if(_.target){var ve=Zo.canvas.angle;if(!r){var xe=_.target.tagName;if("ARC"==ve!=("path"==xe)){var me=m(_.target,"net"),Ce=m(_.target,"layerid");A=A.slice(-2);if(_.certainPath){if("path"==xe){m(_.target,"full_d",_.certainPath);m(_.controlLine,"d",_.certainPath)}else{m(_.target,"full_points",_.certainPath);m(_.controlLine,"points",_.certainPath)}Cs["draw.track"].redrawDRCLine(_.certainPath,I);_.next()}else{v(_.target);v(_.controlLine);_.controlLine=null;v(_.DRCRangeLine);_.DRCRangeLine=null}_.started=!0;_.target=null;_.certainPath="";_.dots.length=0;_.draw(A[0],A[1],!0);_.draw(e,t,!1);if(_.target){me&&m(_.target,"net",me);if(Ce&&oi(Ce)){m(_.target,"layerid",Ce);m(_.target,"c_need_via",Ce)}}if(_.controlLine){me&&m(_.controlLine,"net",me);Ce&&m(_.controlLine,"layerid",Ce)}return}if("ARC"==ve){a=ls.formatTrackPoints(A.slice(-2),ve,e,t,Cs.trackPreference[ve]);o=a;if(_.certainPath){m(_.target,"d",_.certainPath);a=_.certainPath+a.replace(/^M[^ALM]+/,"")}m(_.controlLine,"d",o);1==T&&(o=Cs["draw.track"].applyInteractiveType("block","arc",o,O));m(_.controlLine,"d",o);_.drawDRCLine&&m(_.DRCRangeLine,"d",Cs["draw.track"].getDRCPathFromD(o,Number(m(_.target,"stroke-width"))+2*I));s=o;_.certainPath&&(s=_.certainPath+o.replace(/^M[^ALM]+/,""));m(_.target,"full_d",s)}else if("45"==ve||"90"==ve){a=ls.formatTrackPoints(A.slice(-2),ve,e,t,Cs.trackPreference[ve]);o=a;if(_.certainPath){m(_.target,"points",_.certainPath);a=_.certainPath+a.replace(/^\S+\s+\S+/,"")}if(1==T){var Le,_e,Ae,be=o;o=Cs["draw.track"].applyInteractiveType("block","polyline",o,O);45==ve?Le="90-45"===_.trackPreference[ve]?"45-90":"90-45":90==ve&&(Le="h-v"===_.trackPreference[ve]?"v-h":"h-v");if(o!==be){_e=ls.formatTrackPoints(A.slice(-2),ve,e,t,Le);Ae=_e;_e=Cs["draw.track"].applyInteractiveType("block","polyline",_e,O);if(Ae===_e&&!_.oldTrackPreference){_.oldTrackPreference=_.trackPreference[ve];_.trackPreference[ve]=Le;o=_e}}else if(_.oldTrackPreference){_e=ls.formatTrackPoints(A.slice(-2),ve,e,t,Le);Ae=_e;_e=Cs["draw.track"].applyInteractiveType("block","polyline",_e,O);if(Ae===_e){_.trackPreference[ve]=_.oldTrackPreference;delete _.oldTrackPreference;o=_e}else C(_.controlLine,"c_cut")}}m(_.controlLine,"points",o);_.drawDRCLine&&m(_.DRCRangeLine,"d",Cs["draw.track"].getDRCPathFromPoints(o,Number(m(_.target,"stroke-width"))+2*I));s=o;_.certainPath&&(s=_.certainPath+o.replace(/^\S+\s+\S+/,""));m(_.target,"full_points",s)}else{a=ls.formatTrackPoints(A.slice(-2),ve,e,t,Cs.trackPreference[ve]);o=a;_.certainPath&&m(_.target,"points",_.certainPath);a=ls.formatTrackPoints(A,ve,e,t,Cs.trackPreference[ve]);1==T&&(o=Cs["draw.track"].applyInteractiveType("block","polyline",o,O));m(_.controlLine,"points",o);_.drawDRCLine&&m(_.DRCRangeLine,"d",Cs["draw.track"].getDRCPathFromPoints(o,Number(m(_.target,"stroke-width"))+2*I));s=o;_.certainPath&&(s=_.certainPath+o.replace(/^\S+\s+\S+/,""));m(_.target,"full_points",s)}}if(r)if("ARC"==ve){m(_.controlLine,"d","");_.certainPath=m(_.target,"full_d");n&&0===n.button&&_.certainPath&&m(_.target,"d",_.certainPath);a=_.certainPath.substr(1).replace(/L/g," ").replace(/A\s*(\S+\s+){5}/g," ");a=a.trim().split(/\s+/).map(Number);A.length=0;A.push.apply(A,a)}else{m(_.controlLine,"points","");_.certainPath=m(_.target,"full_points");n&&0===n.button&&_.certainPath&&m(_.target,"points",_.certainPath);l=N(_.certainPath);E=l.length;A.length+2==2*E&&A.splice(A.length-2,0,Eo.formatLengthSave(l[E-2].x),Eo.formatLengthSave(l[E-2].y));1==T&&A.length>=4&&l.length>=2&&A.splice(A.length-2,2,Eo.formatLengthSave(l[E-1].x),Eo.formatLengthSave(l[E-1].y))}Is==ao.PCB&&_.controlLine&&(m(_.controlLine,"points")||m(_.controlLine,"d"))&&Ko.doRealtimeDRC(_.controlLine,!0)}else{_.certainPath="";P=_.startNet||"";g&&g.type&&g.net&&(P?P&&P!==g.net&&Qo.mergeNets(P,g.net):P=g.net);bi(b)&&(P="");y={"stroke-width":b==io.BOARDOUTLINE?1:Zo.canvas.routing,fill:"none",id:Eo.newId(),c_shapetype:"line",layerid:b,net:P};if("ARC"==Zo.canvas.angle){c="path";a="M"+A.join(" ");y.full_d=a;y["stroke-linejoin"]="round"}else{c="polyline";a=A.join(" ");y.full_points=a}y.c_etype="wire";_.startStrokeWidth&&(y["stroke-width"]=_.startStrokeWidth);_.target=zt(c,y);Ka.appendChild(_.target);In(P);m(ys,{visibility:"inherit"});var Se=ys.children.filter(function(e){return"line"===e.tagName});for(p=0;p<Se.length;p++)m(Se[p],{visibility:"hidden"});if(!_.controlLine){var Ee={"stroke-width":y["stroke-width"],fill:"none",stroke:"#fff","stroke-opacity":"0.4",targetId:y.id,"stroke-linecap":"round","stroke-linejoin":"round","shape-rendering":"crispEdges",id:"pcbTrackControlLines",layerid:b,net:P};y.d?Ee.d=y.d:y.points&&(Ee.points=y.points);_.controlLine=zt(c,Ee);ys.appendChild(_.controlLine)}if(_.drawDRCLine&&!_.DRCRangeLine){var Oe={"stroke-width":"1","stroke-opacity":"0.8",style:"shape-rendering: auto;","vector-effect":"non-scaling-stroke",fill:"none",stroke:"#fff",targetId:y.id},Ie=Number(y["stroke-width"])+2*I;y.d?Oe.d=Cs["draw.track"].getDRCPathFromD(y.d,Ie):y.points&&(Oe.d=Cs["draw.track"].getDRCPathFromPoints(y.points,Ie));if(_.drawDRCLine){_.DRCRangeLine=zt("path",Oe);ys.appendChild(_.DRCRangeLine)}}}}if(_.target){_.target.id||m(_.target,{id:Eo.newId()});x="TRACK";m(_.target,"layerid",b);m(_.controlLine,"layerid",b);Ls.updateElementLayerId(_.target,x);Ls.updateElementLayerId(_.controlLine,x);Ls.appendElement(_.target,x);r&&2===n.button?sr("realTimeNetLengthHandler",[{type:"hide"}]):this.realTimeNetLengthHandler(_.target,_.startNet,n)}!r&&Zo.adsorbGrid.enabled&&Cs.showSnapPoint(e,t)},next:function(){var e=Cs,t=[],r=Ls.getActiveLayer();if(e.concatTrackPoints){t.push(["del",e.prevTrackId]);delete e.prevTrackId;delete e.concatTrackPoints}Qo.buildOneNet(m(e.target,"net"),!1);In("");e.started=!0;if(e.target){var n=e.target,i=Eo.node.getRefId(n),a=m(n,"layerid"),o=m(n,"net");"path"===e.target.tagName?n.removeAttribute("full_d"):n.removeAttribute("full_points");v(e.DRCRangeLine);e.DRCRangeLine=null;v(e.controlLine);e.controlLine=null;if("path"==e.target.tagName){var s=di(n),l=s.map(function(e){return e.id}).join(","),c=!1!==bo.getCacheObj("AssignNet");if(c&&a&&(!o||bi(a))&&!bi(a)&&Is!==ao.PCBLIB){o=br();m(s,"net",o)}Fo.updateMore(s);Qo.buildOneNet(o,!1);t.push(["add",l,i]);if(!e.startNet&&e.startNetId&&e.startNetType){m(d(e.startNetId),"net",o);Fo.updateOne(d(e.startNetId));t=[t,["attr",e.startNetId,{net:""},{net:o}]]}zo.save(t);bi(a)&&qo.rebuildPlane(a);Qo.buildOneNet(m(n,"net"),!1);e.target=null;return}if("polyline"===e.target.tagName||"polygon"===e.target.tagName){Lt(e.target);var p=e.target.points.numberOfItems;if("polyline"==e.target.tagName&&p<2||"polygon"==e.target.tagName&&p<3){v(e.target);e.target=null;v(e.DRCRangeLine);e.DRCRangeLine=null;v(e.controlLine);e.controlLine=null;return}}t.push(["add",n.id,i]);var c=bo.getCacheObj("AssignNet");void 0===c&&(c=!0);if(c&&(a&&!o||bi(a))&&Is!==ao.PCBLIB&&!bi(a)){o=br();m(n,"net",o)}if(!e.startNet&&e.startNetId&&e.startNetType){m(d(e.startNetId),"net",o);Fo.updateOne(d(e.startNetId));t=[t,["attr",e.startNetId,{net:""},{net:o}]]}ji(n);Fo.updateOne(n);zo.save(t);bi(a)&&qo.rebuildPlane(a);Qo.buildOneNet(m(n,"net"),!1);e.target=null}else bi(r)&&qo.rebuildPlane(r);if(e.DRCRangeLine){v(e.DRCRangeLine);e.DRCRangeLine=null}if(e.controlLine){v(e.controlLine);e.controlLine=null}e.certainPath&&(e.certainPath="");sr("realTimeNetLengthHandler",[{type:"hide"}])},end:function(){var e=Cs;e.target&&e.dots.length>=4&&"polyline"==e.target.tagName&&m(e.target,{points:e.dots.join(" "),c_shapetype:"line"});if(e.DRCRangeLine){v(e.DRCRangeLine);e.DRCRangeLine=null}if(e.controlLine){v(e.controlLine);e.controlLine=null}if(e.target){Fo.updateOne(e.target);zo.save(["add",e.target.id,Eo.node.getRefId(e.target)]);Qo.buildOneNet(m(e.target,"net"),!1)}In("");Cs.routedRealRatLine=null;sr("realTimeNetLengthHandler",[{type:"hide"}])},getDRCPathFromPoints:function(e,t){if(!t)return"";var r=N(e);if(r.length<2)return"";var n,i="";t=Number(t);for(n=1;n<r.length;n++)i+=function(e,r){var n=Math.atan2(r.y-e.y,r.x-e.x),i=Ne(e,n),a=Ne(r,n),o=t/2,s={x:i.x,y:i.y-o},l={x:i.x,y:i.y+o},c={x:a.x,y:a.y-o},d={x:a.x,y:a.y+o},p=Ne(s,-n),h=Ne(l,-n),u=Ne(c,-n),f=Ne(d,-n);return"M "+p.x+" "+p.y+" L "+u.x+" "+u.y+" A "+o+" "+o+" 0 1 1 "+f.x+" "+f.y+" L "+h.x+" "+h.y+" A "+o+" "+o+" 0 1 1 "+p.x+" "+p.y}(r[n-1],r[n]);return i},getDRCPathFromD:function(e,t){if(!e)return"";var r,n,i,a,o,s,l,c,d=this.pathInterpreter(e),p="",h=t/2;if("M"!==d[0].cmd)return null;d[1]&&"A"===d[1].cmd?i="M "+d[0].value+" A "+d[1].value:d[2]&&"A"===d[2].cmd&&(i="M "+d[1].value+" A "+d[2].value);if(!i)return d[1]?Cs["draw.track"].getDRCPathFromPoints(d[0].value+" "+d[1].value,t):Cs["draw.track"].getDRCPathFromPoints(d[0].value,t);n=Ke(i);r=null;"L"===d[1].cmd?r=d[0].value+" "+d[1].value:d[2]&&"L"===d[2].cmd&&(r=n.A.x+" "+n.A.y+" "+d[2].value);r&&(p+=Cs["draw.track"].getDRCPathFromPoints(r,t));a=qe(n);o=rt(n.M,a,h);o.r=h;s=rt(n.M,a,-h);s.r=h+n.A.rx;l=rt(n.A,a,-h);l.r=h;c=rt(n.A,a,h);c.r=h-n.A.rx;p+=" M "+o.x+" "+o.y+" A "+o.r+" "+o.r+" "+n.A.rotation+" "+n.A.largeArc+" "+n.A.clockwise+" "+s.x+" "+s.y+" A "+s.r+" "+s.r+" "+n.A.rotation+" "+n.A.largeArc+" "+n.A.clockwise+" "+l.x+" "+l.y+" A "+l.r+" "+l.r+" "+n.A.rotation+" "+n.A.largeArc+" "+n.A.clockwise+" "+c.x+" "+c.y+" A "+c.r+" "+c.r+" "+n.A.rotation+" "+n.A.largeArc+" "+Math.abs(n.A.clockwise-1)+" "+o.x+" "+o.y;return p},pathInterpreter:function(e){for(var t,r=["A","M","L","Z"],n=[],i="",a=0;a<e.length;a++)if(r.indexOf(e[a])>=0){if(t){n.push({cmd:t,value:i.trim()});i=""}t=e[a]}else i+=e[a];t&&n.push({cmd:t,value:i.trim()});return n},redrawDRCLine:function(e,t){var r=Cs;if(void 0===t){var n=Ai(m(r.controlLine,"net"));n||(n=Ai());t=n.clearance}if(r.drawDRCLine)if("path"===r.target.tagName){e||(e=m(r.target,"full_d"));m(r.DRCRangeLine,"d",Cs["draw.track"].getDRCPathFromD(e,Number(m(r.target,"stroke-width"))+2*t))}else{e||(e=m(r.target,"full_points"));m(r.DRCRangeLine,"d",Cs["draw.track"].getDRCPathFromPoints(e,Number(m(r.target,"stroke-width"))+2*t))}},applyInteractiveType:function(e,t,r,n){function i(e,t,r,n,i,a){i=Number(i);var o,s,l,c,d,p;if(e&&t&&r&&n&&i>=0&&!Xe(e,t)&&!Xe(r,n)){e.x=Number(e.x);e.y=Number(e.y);t.x=Number(t.x);t.y=Number(t.y);r.x=Number(r.x);r.y=Number(r.y);n.x=Number(n.x);n.y=Number(n.y);if(et(e,t,r,n).d>=i&&0!==i)return null;var h=pe(r,e,t);if(!h||h.d<i)return r;if(0===i)return null;var u=tt(e,t,r,n);if(u<.001||Math.abs(Math.abs(u)-Math.PI)<.001){var f=function(){return ue(r.x,r.y,e.x,e.y)<ue(r.x,r.y,t.x,t.y)?e:t}(),g=fe(f.x,f.y,n.x,n.y),y=tt(f,n,n,r);o=g*Math.cos(y);o<0&&(o=g*Math.cos(Math.PI-y));l=ie(r,n,f)?1:-1;var v=o*o+i*i-g*g;if(v<0||isNaN(v)){if(!(v*v<.001))return null;v=0}s=l*o+Math.sqrt(v)+a}else{c=oe(e,t,r,n);l=Re(c,r,n)?1:-1;var x=nt(r,n,c)?1:-1;o=i/Math.sin(u);var m=1===x?rt(c,r,o):rt(r,c,o);if(ie(e,t,m,a))s=i/Math.sin(u)+fe(c.x,c.y,n.x,n.y)*l+a;else{var C=ne(e,t,m);if(ue(C.x,C.y,e.x,e.y)>ue(C.x,C.y,t.x,t.y))var L=t,_=e;else{L=e;_=t}var P=fe(c.x,c.y,L.x,L.y);o=P*Math.cos(u);o<0&&(o=P*Math.cos(Math.PI-u));v=o*o+i*i-P*P;if(v<0){if(!(v*v<.001))return null;v=0}var A=nt(L,_,c)?1:-1;d={x:_.x-L.x,y:_.y-L.y};p={x:r.x-n.x,y:r.y-n.y};(d.x*p.x+d.y*p.y)/(Math.sqrt(d.x*d.x+d.y*d.y)*Math.sqrt(p.x*p.x+p.y*p.y))>0&&(A=-A);s=(o+Math.sqrt(v)*A)*A+fe(c.x,c.y,n.x,n.y)*l*x+a}}return rt(n,r,s)}}function a(e,t,r,n,i,a,o){e=Number(e);t=Number(t);r=Number(r);a=Number(a);o=void 0===o?.001:Number(o);if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(a)||isNaN(o)||!n||!i)return null;n.x=Number(n.x);n.y=Number(n.y);i.x=Number(i.x);i.y=Number(i.y);if(pe({x:e,y:t},n,i).d>a)return null;if(fe(e,t,n.x,n.y)<a+r)return n;var s=ne(n,i,{x:e,y:t}),l=Re(s,n,i)?1:-1,c=fe(s.x,s.y,e,t),d=a*a-c*c;return d<0||isNaN(d)?null:rt(i,n,Math.sqrt(d)+l*fe(s.x,s.y,i.x,i.y)+o)}function o(e,t,r,n,a){function o(e,t,r){var i=Ge(A.x,A.y,_.rx,t.x,t.y,n-p),o=Ge(A.x,A.y,_.rx,t.x,t.y,n+a);if(i){for(var s=0;s<i.length;s++)if(o&&o[s]){i[s].realX=o[s].x;i[s].realY=o[s].y;i[s].isArcToArc=!0}i=i.filter(function(e){var n=Math.max(t.x,r.x)-p,i=Math.min(t.x,r.x)+p;return n>=e.x||e.x>=i});return i}return[]}if(!(e&&t&&r))return null;var s=r.replace(/[^ALM]/g,"").replace(/[M]/,"").replace(/[L]/,"").replace(/[A]/,"");if("M"!==r[0]||""!==s)return null;var l,c,d,p=.001,h=Cs["draw.track"].pathInterpreter(r);if(3===h.length)if("A"===h[2].cmd){s="M "+h[1].value+" A "+h[2].value;d=!0}else{s="M "+h[0].value+" A "+h[1].value;d=!1}else{if("A"!==h[1].cmd){var u=i(e,t,Je(h[0].value)[0],Je(h[1].value)[0],n,a);if(u){u.d="M "+h[0].value+" L "+Eo.toFixed(u.x,3)+" "+Eo.toFixed(u.y,3);return u}return null}s="M "+h[0].value+" A "+h[1].value}var f=Ke(s);if(!d&&pe(f.M,e,t).d<n){s=Je(h[0].value)[0];return{d:"M "+h[0].value+" L "+h[0].value,x:s.x,y:s.y}}if(h[2]){if("A"===h[2].cmd){l=Je(h[0].value)[0];c=Je(h[1].value)[0]}else if("L"===h[2].cmd){l={x:f.A.x,y:f.A.y};c=Je(h[2].value)[0]}var g=i(e,t,l,c,n,a)}if(!g||!d){var y=qe(f);s=[e,t,f.M,f.A];var v=Math.atan2(t.y-e.y,t.x-e.x);s=s.map(function(e){return Ne(ke(e,-y.x,-y.y),v)});var x,m=s[0],C=s[1],L=s[2],_=Eo.extend({},f.A,s[3]),P={M:L,A:_},A={x:0,y:0},b=[],S=[];b.push({y:m.y-n,realY:m.y-(n+a)});b.push({y:m.y+n,realY:m.y+(n+a)});b.forEach(function(e){var t=_.rx*_.rx-e.y*e.y,r=_.rx*_.rx-e.realY*e.realY;if(!(t<-p||r<-p)){t<0&&(t=0);r<0&&(r=0);var n=Math.sqrt(t),i=Math.sqrt(r);S.push({x:n,y:e.y,realX:i,realY:e.realY});S.push({x:-n,y:e.y,realX:-i,realY:e.realY})}});x=function(){var e=[];S.forEach(function(t){var r=Math.max(m.x,C.x)+a,n=Math.min(m.x,C.x)-a;r<t.x||t.x<n?e=Math.abs(t.x-m.x)<Math.abs(t.x-C.x)?e.concat(o(t,m,C)):e.concat(o(t,C,m)):e.push(t)});e=e.filter(function(e){var t=Math.min(m.x,C.x),r=Math.max(m.x,C.x);t-=n;r+=n;return e&&$e(P,e,A,0)&&r>=e.x==e.x>=t}).sort(function(e,t){return ue(L.x,L.y,e.x,e.y)-ue(L.x,L.y,t.x,t.y)});return e.length>0?{x:e[0].realX,y:e[0].realY}:null}();if(x)var E=ke(Ne(x,-v),y.x,y.y)}if(d){if(g){g.d="M "+h[0].value+" L "+Eo.toFixed(g.x,3)+" "+Eo.toFixed(g.y,3);return g}if(E){E.d="M "+h[0].value+" L "+h[1].value+" A "+f.A.rx+" "+f.A.ry+" "+f.A.rotation+" "+f.A.largeArc+" "+f.A.clockwise+" "+Eo.toFixed(E.x,3)+" "+Eo.toFixed(E.y,3);return E}}else{if(E){E.d="M "+h[0].value+" A "+f.A.rx+" "+f.A.ry+" "+f.A.rotation+" "+f.A.largeArc+" "+f.A.clockwise+" "+Eo.toFixed(E.x,3)+" "+Eo.toFixed(E.y,3);return E}if(g){g.d="M "+h[0].value+" A "+h[1].value+" L "+Eo.toFixed(g.x,3)+" "+Eo.toFixed(g.y,3);return g}}return null}function s(e,t,r,n,i,o){e=Number(e);t=Number(t);r=Number(r);if(isNaN(e)||isNaN(t)||isNaN(t)||!n)return null;var s=n.replace(/[^ALM]/g,"").replace(/[M]/,"").replace(/[L]/,"").replace(/[A]/,"");if("M"!==n[0]||""!==s)return null;var l,c,d,p=Cs["draw.track"].pathInterpreter(n);if(3===p.length)if("A"===p[2].cmd){s="M "+p[1].value+" A "+p[2].value;d=!0}else{s="M "+p[0].value+" A "+p[1].value;d=!1}else{if("A"!==p[1].cmd){var h=a(e,t,r,Je(p[0].value)[0],Je(p[1].value)[0],i,o);if(h){h.d="M "+p[0].value+" L "+Eo.toFixed(h.x,3)+" "+Eo.toFixed(h.y,3);return h}return null}s="M "+p[0].value+" A "+p[1].value}var u=Ke(s),f=d?Je(p[0].value)[0]:u.M;if(fe(f.x,f.y,e,t)<i){s=Je(p[0].value)[0];return{d:"M "+p[0].value+" L "+p[0].value,x:s.x,y:s.y}}if(p[2]){if("A"===p[2].cmd){l=Je(p[0].value)[0];c=Je(p[1].value)[0]}else if("L"===p[2].cmd){l={x:u.A.x,y:u.A.y};c=Je(p[2].value)[0]}var g=a(e,t,r,l,c,i,o)}if(!g||!d){var y=qe(u),v=Ge(y.x,y.y,u.A.rx,e,t,i),x=Ge(y.x,y.y,u.A.rx,e,t,i+o);if(v){for(var m=0;m<v.length;m+=1)if(x&&x[m]){v[m].realX=x[m].x;v[m].realY=x[m].y}v=v.filter(function(e){return $e(u,e,y,0)});if(v.length>0){v=v.sort(function(e,t){return ue(u.M.x,u.M.y,e.x,e.y)-ue(u.M.x,u.M.y,t.x,t.y)});if(void 0!==v[0].realX)var C={x:v[0].realX,y:v[0].realY};else C=v[0]}}}if(d){if(g){g.d="M "+p[0].value+" L "+Eo.toFixed(g.x,3)+" "+Eo.toFixed(g.y,3);return g}if(C){C.d="M "+p[0].value+" L "+p[1].value+" A "+u.A.rx+" "+u.A.ry+" "+u.A.rotation+" "+u.A.largeArc+" "+u.A.clockwise+" "+Eo.toFixed(C.x,3)+" "+Eo.toFixed(C.y,3);return C}}else{if(C){C.d="M "+p[0].value+" A "+u.A.rx+" "+u.A.ry+" "+u.A.rotation+" "+u.A.largeArc+" "+u.A.clockwise+" "+Eo.toFixed(C.x,3)+" "+Eo.toFixed(C.y,3);return C}if(g){g.d="M "+p[0].value+" A "+p[1].value+" L "+Eo.toFixed(g.x,3)+" "+Eo.toFixed(g.y,3);return g}}return null}var l,c,d,p,h,u,f=Cs,g=r,y=0,v=0,x=m(f.controlLine,"net");switch(e){case"block":if(f.controlLine){var L=Number(m(f.controlLine,"layerid"));if(!oi(L))return g;if("polyline"===t){l=Je(r);if(l.length<2)return g;p=_s.ARC(f.controlLine);p.pointArr=l;c=es.createNode(p,"TRACK").treeNodes}if("arc"===t)return g;var _,P=[],A=[];if(c)for(h=0;h<c.length;h+=1){P=es.trees[L].search(c[h]);for(u=0;u<P.length;u+=1)if(P[u].node.net!==x&&(""!==P[u].node.net||null!==x)){d=Ai(P[u].node.net);if(d){y=Math.max(Number(n.clearance),Number(d.clearance))
;v=Math.max(Number(n.clearance),Number(d.clearance))}if("TRACK"===P[u].type||"ARC"===P[u].type){var b=(c[h].node.strokeWidth+P[u].node.strokeWidth)/2+y;_=Xe(P[u].node.pointArr[0],P[u].node.pointArr[1])?"ARC"!==c[h].type?a(P[u].node.pointArr[0].x,P[u].node.pointArr[0].y,P[u].node.strokeWidth/2,c[h].node.pointArr[0],c[h].node.pointArr[1],b,.01):s(P[u].node.pointArr[0].x,P[u].node.pointArr[0].y,P[u].node.strokeWidth/2,c[h].node.d,b,.01):"TRACK"===P[u].type?i(P[u].node.pointArr[0],P[u].node.pointArr[1],c[h].node.pointArr[0],c[h].node.pointArr[1],b,.01):function(e,t,r,n,a,o){function s(t,r){var n=null,i=0,a=0;if(t&&r){i=fe(t.x,t.y,e.x,e.y);a=fe(r.x,r.y,e.x,e.y);n=i<a?t:r}else n=t||r;return n}n+=a;if(!(e&&t&&r))return null;var l=r.replace(/[^ALM]/g,"").replace(/[M]/,"").replace(/[L]/,"").replace(/[A]/,"");if("M"!==r[0]||""!==l)return null;var c=null,d=null,p=null,h=0,u=0,f=o.pointArr;f||(f=pi(o));var g=f&&f.length;if(f&&g>=4){d=i(f[0],f[1],e,t,n,a);p=i(f[g-2],f[g-1],e,t,n,a);if(d&&p){h=fe(d.x,d.y,e.x,e.y)||0;u=fe(p.x,p.y,e.x,e.y)||0;c=h<u?d:p}else c=d||p}var y,v=e.x,x=e.y,m=t.x,C=t.y,L=Cs["draw.track"].pathInterpreter(r);if(3===L.length)if("A"===L[2].cmd){l="M "+L[1].value+" A "+L[2].value;lineFirst=!0}else{l="M "+L[0].value+" A "+L[1].value;lineFirst=!1}else{if("A"!==L[1].cmd){var _=i(e,t,Je(L[0].value)[0],Je(L[1].value)[0],n,a);if(_){_.d="M "+L[0].value+" L "+Eo.toFixed(_.x,decimal)+" "+Eo.toFixed(_.y,decimal);return s(c,_)}return c}l="M "+L[0].value+" A "+L[1].value}var P=Ke(l),A=P.A.rx||P.A.ry,b=qe(P),S=b.x,E=b.y;if(Math.abs(A-fe(S,E,v,x))<n-a){N=Ie({x:v,y:x},b,S,E,A);k=fe(N[0].x,N[0].y,v,x);M=fe(N[1].x,N[1].y,v,x);B=k<M?N[0]:N[1];if(dt(P,B,b))return e}y=Se(v,x,S,E,A);var O=Qe(P,e,t),I=!1;O&&(I=!0);var T={},R=Math.pow(A-n,2);if(!y&&!Se(t.x,t.y,S,E,A)&&O){var h,u;if(1===O.length)O=O[0];else{h=fe(e.x,e.y,O[0].x,O[0].y);u=fe(e.x,e.y,O[1].x,O[1].y);O=h<u?O[0]:O[1]}a=1e-4;var w={},h=fe(e.x,e.y,O.x,O.y);w.x=a*(e.x-O.x)/h+O.x;w.y=a*(e.y-O.y)/h+O.y;if(Se(w.x,w.y,S,E,A)){v=w.x;x=w.y;y=!0}}if(!y){m=e.x;C=e.y;v=t.x;x=t.y;R=Math.pow(A+n,2)}var N,k,M,B;if(v===m){T.d=r;T.x=v;T.y=Math.sqrt(R-Math.pow(v-S,2));T.y=C>x?E+T.y:E-T.y;if(Re(T,e,t)){N=Ie(e,t,S,E,A);k=fe(N[0].x,N[0].y,T.x||v,T.y||x);M=fe(N[1].x,N[1].y,T.x||v,T.y||x);B=k<M?N[0]:N[1];return dt(P,B,b)?s(c,T):c}return Math.min(Math.abs(e.y-T.y),Math.abs(t.y-T.y))<n&&dt(P,e,b)?e:c}var D=(C-x)/(m-v),V=C-D*m,F=1+D*D,G=-2*(S-D*V+D*E),Y=S*S+E*E-2*E*V+V*V-R,j=Math.pow(G,2)-4*F*Y,H={};if(j<0)return c;if(0===j){H.x=-G/2*F;H.y=D*(H.x-m)+C;T={d:r,x:H.x,y:H.y}}else{H.x1=(-G+Math.sqrt(j))/(2*F);H.x2=(-G-Math.sqrt(j))/(2*F);H.y1=D*(H.x1-v)+x;H.y2=D*(H.x2-v)+x;H.d1=fe(H.x1,H.y1,m,C);H.d2=fe(H.x2,H.y2,m,C);var X;if(H.d1<=H.d2){X=y?fe(H.x1,H.y1,v,x):H.d1;if(X>=n)T={d:r,x:H.x1,y:H.y1};else{T=e;T.d=r}}else{X=y?fe(H.x2,H.y2,v,x):H.d2;if(X>=n)T={d:r,x:H.x2,y:H.y2};else{T=e;T.d=r}}}if(Re(T,e,t)){var U=(T.y-E)/(T.x-S),J={};J.x1=S+A/Math.sqrt(1+U*U);J.x2=S-A/Math.sqrt(1+U*U);T.x>S?J.x=J.x1>S?J.x1:J.x2:J.x=J.x1<S?J.x1:J.x2;J.y=(J.x-S)*U+E;if($e(P,J,{x:S,y:E}))return s(c,T)}return I?s(c,T):c}(c[h].node.pointArr[0],c[h].node.pointArr[1],P[u].node.d,b,.01,P[u].node);_&&A.push({p:_,i:h})}if("PAD"===P[u].type)if("RECT"===P[u].node.shape||"POLYGON"===P[u].node.shape){b=c[h].node.strokeWidth/2+v;P[u].node.pointArr.forEach(function(e,t,r){var n;n=0===t?r[r.length-1]:r[t-1];_="ARC"!==c[h].type?i(e,n,c[h].node.pointArr[0],c[h].node.pointArr[1],b,.01):o(e,n,c[h].node.d,b,.01);_&&A.push({p:_,i:h})})}else if("ELLIPSE"===P[u].node.shape){b=c[h].node.strokeWidth/2+v+P[u].node.width/2;_="ARC"!==c[h].type?a(P[u].node.x,P[u].node.y,P[u].node.width/2,c[h].node.pointArr[0],c[h].node.pointArr[1],b,.01):s(P[u].node.x,P[u].node.y,P[u].node.width/2,c[h].node.d,b,.01);_&&A.push({p:_,i:h})}else if("OVAL"===P[u].node.shape){b=c[h].node.strokeWidth/2+v+Math.min(P[u].node.width,P[u].node.height)/2;_=Xe(P[u].node.pointArr2[0],P[u].node.pointArr2[1])?"ARC"!==c[h].type?a(P[u].node.pointArr2[0].x,P[u].node.pointArr2[0].y,P[u].node.width/2,c[h].node.pointArr[0],c[h].node.pointArr[1],b,.01):s(P[u].node.pointArr2[0].x,P[u].node.pointArr2[0].y,P[u].node.width/2,c[h].node.d,b,.01):"ARC"!==c[h].type?i(P[u].node.pointArr2[0],P[u].node.pointArr2[1],c[h].node.pointArr[0],c[h].node.pointArr[1],b,.01):o(P[u].node.pointArr2[0],P[u].node.pointArr2[1],c[h].node.d,b,.01);_&&A.push({p:_,i:h})}if("VIA"===P[u].type){b=c[h].node.strokeWidth/2+v+P[u].node.diameter/2;_="ARC"!==c[h].type?a(P[u].node.x,P[u].node.y,P[u].node.diameter/2,c[h].node.pointArr[0],c[h].node.pointArr[1],b,.01):s(P[u].node.x,P[u].node.y,P[u].node.diameter/2,c[h].node.d,b,.01);_&&A.push({p:_,i:h})}if("SOLIDREGION"===P[u].type){b=c[h].node.strokeWidth/2+v;P[u].node.pointArr.forEach(function(e,t,r){var n;n=0===t?r[r.length-1]:r[t-1];_="ARC"!==c[h].type?i(e,n,c[h].node.pointArr[0],c[h].node.pointArr[1],b,.01):o(e,n,c[h].node.d,b,.01);_&&A.push({p:_,i:h})})}}}if(A.length>0){m(f.controlLine,"c_cut","true");if("polyline"===t){A=A.sort(function(e,t){return e.i-t.i}).filter(function(e,t,r){return e.i===r[0].i});A=A.sort(function(e,t){var r=l[A[0].i];return ue(e.p.x,e.p.y,r.x,r.y)-ue(t.p.x,t.p.y,r.x,r.y)});l.splice(A[0].i+1,l.length,A[0].p);return ze(l)}if("arc"===t){var S=Je(l[0].value)[0];A=A.sort(function(e,t){return ue(e.p.x,e.p.y,S.x,S.y)-ue(t.p.x,t.p.y,S.x,S.y)});return A[0].p.d}}C(f.controlLine,"c_cut");return g}}return g},realTimeNetLengthHandler:function(e,t,r){if(bo.getCacheObj("showRealTimeNetLength")&&r){var n=Ls.getActiveLayer();if(oi(n)&&!bi(n)){var i,a,o=e.tagName,s={};if("polyline"===o){i=m(e,"full_points").split(" ");for(var l=[],c=0;c<i.length;c+=2)l.push({x:i[c],y:i[c+1]});s.pointArr=l}else"path"===o&&(s.d=m(e,"full_d"));var d=ls.getLengthOfTrackAndArc(s);a=Eo.formatLengthSave(Eo.units.convert(d,"pixel",Zo.canvas.unit));Is===ao.PCB&&(a+=ls.getWholeNetLength(t));sr("realTimeNetLengthHandler",[{type:"update",html:": "+Eo.toFixed(a,3)+" "+Zo.canvas.unit,x:r.clientX+50,y:r.clientY+80}])}}}};Cs["draw.differentialRoute"]={data:{},initData:function(){this.data={pads:[],tracks:[],ratlines:[],surePoints:[[],[]],trackLayerId:io.TOPLAYER,steps:[],hist:[]}},ready:function(){Cs.started=!0;u(Ka,"events-none",!1);this.initData()},canDraw:function(e,t,r){if(this.data&&this.data.pads&&2==this.data.pads.length)return!0;if(!oi(Ls.getActiveLayer()))return!1;var n=function(e){if(!e||!Ka.contains(e))return null;for(;e!=Ka;){if("part_pad"==m(e,"c_partid"))return e;e=e.parentNode}return null}(r.target),i=n&&n.id;if(!n||!i)return!1;var a;if(n.parentNode==Ka){a=Fo.gJsonCache.PAD[i];!0}else{var o,s=n.parentNode;if(s.parentNode==Ka){var l=s.id;o=Fo.gJsonCache.FOOTPRINT[l];o&&o.PAD&&(a=o.PAD[i])}}if(!a||!a.net||!Ts.isDifferentialNet(a.net))return!1;var c=Ts.getDifferentialPairPad(a);if(!c)return!1;this.data.pads=[a,c];this.data.tracks=[];Ts.getConfig(a.net);return!0},draw:function(e,t,r,n){function i(e){return{x:e.x,y:e.y}}function a(e,t){var r=e-t;return r<1e-5&&r>-1e-5}function o(e){for(var t,r=Qo.ratLineArr[e.net]||[],n=[],i=0;i<r.length;i++){var o=r[i];if(!o.bTracked&&(!o.bTracked&&(o.from.gId==e.gId||o.to.gId==e.gId))){t=o;break}}if(!t)return n;for(var s=p('line[layerid="'+io.RATLINES+'"][net="'+e.net+'"]',Ka),l=0;l<s.length;l++){var c=m(s[l],"x1"),d=m(s[l],"x2"),h=m(s[l],"y1"),u=m(s[l],"y2"),f=s[l].id,g={x1:c,y1:h,x2:d,y2:u};a(c,e.x)&&a(h,e.y)?n.push({id:f,which:1,oldAtts:g}):a(d,e.x)&&a(u,e.y)&&n.push({id:f,which:2,oldAtts:g})}return n}function s(e,t){if(e&&t)for(var r=0;r<e.length;r++){var n=e[r],i=d(n.id),a=2==n.which?"x2":"x1",o=2==n.which?"y2":"y1";m(i,a,Eo.formatLengthSave(t.x));m(i,o,Eo.formatLengthSave(t.y))}}var l,c,u,f=Cs,g=f.dots,y=this.data,v=y&&y.pads,x=y&&y.tracks,C=y&&y.trackLayerId,L=Ls.getActiveLayer(),_={x:e,y:t};if(!C||!x||!x[0])if(v&&y.pads[0]){l=v[0].layerid;C=v[0].layerid!=io.ALL?v[0].layerid:Ls.calLayerId("TRACK")}else C=Ls.calLayerId("TRACK");var P,A,b;b=v&&v[0]&&v[0].net||"_diff_pair";if(n){P=n?Ct({x:n.clientX,y:n.clientY}):{x:e,y:t};A=Fo.ifFind(P.x,P.y,b,C,"ALL")}A&&A.type||P&&e==P.x&&t==P.y||(A=Fo.ifFind(e,t,b,C,"ALL"));if(A&&A.type)if(A.gId==(v&&v[0]&&v[0].gId))A=null;else{e=Eo.formatLengthSave(A.X);t=Eo.formatLengthSave(A.Y);ur("cross-red",e,t)}if(!r){Cs.showSnapPoint(e,t);if(0===g.length)return}if(r&&A&&A.type&&2==g.length){g[0]=e;g[1]=t}var S=d("part_diff");if(!S){S=zt("g",{id:"part_diff",layerid:"1"});d("gCurParts").appendChild(S)}var E,I,T,R,w,M,B,D,V,F,G;if(r){if(g.length<=2){if(this.canDraw(e,t,n)){y.surePoints=[[i(y.pads[0])],[i(y.pads[1])]];l=v[0].layerid;l!=io.ALL&&l!=L&&Ls.setActivePCBLayer(l)}else{g.length=0;y.surePoints=[[],[]]}y.trackLayerId=C}else{if(g[0]==e&&g[1]==t){g.length-=2;return}if(!x||2!=x.length){g.length-=2;return}c=d(x[0]);u=d(x[1]);M=y.surePoints;T=null;if(M[1].length>1){w=M[1].length;T=Ts.getVectorDegreeByTwoPoints(M[1][w-2],M[1][w-1])}R=g.length<=4;E=Ts.getEventPad(n,v[0].net,m(c,"layerid"),v[0].gId);I=R?E?4:1:E?3:2;B=_;D=null;V=null;if(E){B=i(E);V=Ts.getDifferentialPairPad(E,{except:v[1]});if(V){if(V.net!=v[1].net)return!1;if(V.layerid!=io.ALL&&V.layerid!=m(u,"layerid"))return!1;D=i(V)}}var Y=!R&&1===M[1].length,j=Ts.getPathPoints(M[0],M[1],B,D,I,T);if(j[0].length<=M[0].length){g.length-=2;return}var H=O(j);y.surePoints=H;m(c,"points",k(j[0]));m(u,"points",k(j[1]));Y&&function(){var e=m(c,"layerid"),t=v[0].net,r=v[1].net,n=function(e,t,r){for(var n=e;n=n.previousElementSibling;)if(m(n,"net")==r&&"TRACK"==Eo.getPCBCmdKey(n))return m(n,"layerid")!=t?n:null;return null},i=n(c,e,t);if(!i)return!1;var a=Ts.createVia(j[0][0],t);S.insertBefore(a,null);var o=Ts.createVia(j[1][0],r);S.insertBefore(o,null);var s=_s.VIA(a),l=+m(a.querySelectorAll(":not([c_padid]):not(title)")[0],"r"),d=+m(c,"stroke-width");if(s.diameter<=d)return!1;var p=_s.VIA(o),h=n(u,e,r);if(!h)return!1;var f=N(m(i,"points")),g=N(m(h,"points"));s.radius=l;p.radius=l;var x=Ts.fixVia([{viaObj:s,pointsPrev:f,points:j[0],trackWidth:d},{viaObj:p,pointsPrev:g,points:j[1],trackWidth:d}]);if(x){yr(a,x[0].viaObj.x,x[0].viaObj.y);m(i,"points",k(x[0].pointsPrev));m(c,"points",k(x[0].points));yr(o,x[1].viaObj.x,x[1].viaObj.y);m(h,"points",k(x[1].pointsPrev));m(u,"points",k(x[1].points));y.surePoints=[x[0].points,x[1].points]}}();if(E){Tn();Cs.next(E.x,E.y,n)}}this.saveStep()}else{if(g.length<2)return;if(!v||!v.length)return;if(2!=g.length||x&&2==x.length){if(!x||2!=x.length)return;c=d(x[0]);u=d(x[1]);if(!c||!u)return;M=y.surePoints;T=null;R=g.length<=2;I=R?1:2;if(M[1].length>1&&R){w=M[1].length;T=Ts.getVectorDegreeByTwoPoints(M[1][w-2],M[1][w-1])}E=Ts.getEventPad(n,v[0].net,m(c,"layerid"),v[0].gId);B=_;D=null;V=null;if(E){B=i(E);V=Ts.getDifferentialPairPad(E);V&&(V.gId==v[1].gId?V=null:V.net!=v[1].net?V=null:V.layerid!=io.ALL&&V.layerid!=m(u,"layerid")?V=null:D=i(V));I=R?4:3}j=Ts.getPathPoints(M[0],M[1],B,D,I,T);m(c,"points",k(j[0]));m(u,"points",k(j[1]));if(y.ratlines){s(y.ratlines[0],j[0].slice(-1)[0]);s(y.ratlines[1],j[1].slice(-1)[0])}}else{C=v[0].layerid!=io.ALL?v[0].layerid:Ls.calLayerId("TRACK");c=Ts.createTrack(C,v[0].net);u=Ts.createTrack(C,v[1].net);M=y.surePoints;var X=M[0],U=M[1],J=Ts.getMustBeginPoints(X[0],U[0],P||_);m(c,"points",k(J[0]));m(u,"points",k(J[1]));m(S,"display","");for(;S.firstChild;)S.removeChild(S.firstChild);var z=h('g[c_partid="part_via"]',S);S.insertBefore(c,z);S.insertBefore(u,z);y.tracks=[c.id,u.id];y.trackLayerId=C;Tn(v[0].net,v[1].net);F=o(v[0]);G=o(v[1]);y.ratlines=[F,G]}}},next:function(e,t,r){var n=Cs,i=this.data,a=i&&i.pads,o=i&&i.tracks;if(a&&a[0]&&o&&o[0]){var s=d(o[0]);if(s){!Ts.getEventPad(r,a[0].net,m(s,"layerid"),a[0].gId)&&r&&void 0!==e&&void 0!==t&&n.draw(e,t,!0,r)}}this.initData();var l=d("part_diff");l&&m(l,"display","none");n.started=!0;this.saveHist();if(i&&i.pads&&i.pads[0]){Qo.buildOneNet(i.pads[0].net,!1);Qo.buildOneNet(i.pads[1].net,!1)}Tn()},end:function(e){var t=this.data,r=d("part_diff");r&&m(r,"display","none");27==e||this.saveHist(t);this.initData();if(t&&t.pads&&t.pads[0]){Qo.buildOneNet(t.pads[0].net,!1);Qo.buildOneNet(t.pads[1].net,!1)}Tn()},saveStep:function(){var e=Cs,t=(e.dots,this.data),r=d("part_diff");if(t&&t.steps&&(r&&r.children.length||!t.steps.length)){var n=Eo.extend({},t);delete n.steps;delete n.hist;t.steps.push({config:Eo.cloneJSON(Ts.config),dots:Eo.cloneJSON(e.dots),data:Eo.cloneJSON(n),dom:r?r.cloneNode(!0):null})}},backStep:function(){var e=Cs,t=this.data,r=d("part_diff");if(r&&r.children.length)if(t&&t.steps.length){t.steps.pop();var n=t.steps.length&&t.steps[t.steps.length-1];if(n){Eo.extend(Ts.config,n.config);e.dots=n.dots;Eo.extend(t,n.data);r?n.dom?r.parentNode.replaceChild(n.dom,r):r.parentNode.removeChild(r):n.dom&&d("gCurParts").appendChild(n.dom);e.draw(e.lastX,e.lastY)}else{e.dots=[];this.initData();r.parentNode.removeChild(r)}}else{e.dots=[];this.initData();r.parentNode.removeChild(r)}},onActiveLayerChange:function(e){var t=Cs,r=(t.dots,this.data),n=r&&r.pads,i=r&&r.tracks,a=Ls.getActiveLayer();if(oi(a)&&r&&n&&i){trackA=d(i[0]);trackB=d(i[1]);if(trackA&&trackB&&a!=m(trackA,"layerid")){var o=r.surePoints,s=o[0],l=o[1],c=N(m(trackA,"points")),p=N(m(trackB,"points")),h=d("part_diff");if(!(s.length>c.length||l.length>p.length))if(s.length<=1||l.length<=1){m(trackA,"layerid",a);m(trackB,"layerid",a)}else{m(trackA,"points",k(c.slice(0,s.length)));m(trackB,"points",k(p.slice(0,l.length)));var u=trackA.cloneNode(!0),f=trackB.cloneNode(!0),g=c.slice(s.length-c.length-1),y=p.slice(l.length-p.length-1);m(u,{id:Eo.newId(),layerid:a,points:k(g)});m(f,{id:Eo.newId(),layerid:a,points:k(y)});h.insertBefore(u,trackB.nextSibling);h.insertBefore(f,u.nextSibling);r.surePoints=[g.slice(0,1),y.slice(0,1)];r.tracks=[u.id,f.id]}}}},saveHist:function(){var e=d("part_diff"),t=[];if(!e)return!1;for(;e.firstChild;){var r=e.firstChild,n=Eo.getPCBCmdKey(r);if("VIA"==n);else{if("TRACK"!=n){e.removeChild(r);continue}var i=m(r,"points");if(!i){e.removeChild(r);continue}i=N(i);if(!i.length){e.removeChild(r);continue}}r=e.removeChild(r);Ls.appendElement(r);Fo.updateOne(r);t.push(["add",r.id,Eo.node.getRefId(r)])}t.length&&zo.save(t);return t.length>0}};Fo.removeOne=function(e){if(e){var t=m(e,"id"),r=Z(e);if("CIRCLE"===r&&Bi(parseInt(m(e,"layerid")))){var n=m(e,"net"),a=[];m(e,"transformArc")&&(a=m(e,"transformArc").split(","));if(2===a.length&&Fo.gJsonCache.ARC){es.removeFromRTree(Fo.gJsonCache.ARC[a[0]],"ARC");es.removeFromRTree(Fo.gJsonCache.ARC[a[1]],"ARC");Fo.gJsonCache.ARC[a[0]]&&delete Fo.gJsonCache.ARC[a[0]];Fo.gJsonCache.ARC[a[1]]&&delete Fo.gJsonCache.ARC[a[1]];var o=Fo.gJsonCache.SIGNALS||{},s=o[n]||[];for(i=0,l=s.length;i<l;i++)if(s[i]&&(s[i].gId==a[0]||s[i].gId==a[1])){s.splice(i,1);i--;0===s.length&&delete o[n]}}}var c=Fo.gJsonCache[r];if(c){Fo.removeSignalsOfOneObject(e);if(Is==ao.PCB||Is==ao.PCBLIB){es.removeFromRTree(c[t],r);Ko&&Ko.hideRealtimeDRCError&&Ko.hideRealtimeDRCError()}delete c[t]}var d=p('[c_shapetype="dimensionCheck"]');"dimensionCheck"!==m(e,"c_shapetype")&&d.length>0&&zr(d);if("FOOTPRINT"===r){var u=h('#libMasker rect[attach_libid="'+t+'"]');u&&u.parentNode.removeChild(u)}"CIRCLE"!=r&&"TRACK"!=r&&"PAD"!=r&&"ARC"!=r&&"FOOTPRINT"!=r&&"VIA"!=r||gi(e,"");if(("TRACK"==r||"ARC"==r)&&Is==ao.PCB&&_s[r](e).layerid==io.BOARDOUTLINE){if(Fo.gJsonCache.panelize){var f=Fo.getAllObjsOf("TRACK",!1,!1,[io.BOARDOUTLINE]),g=Fo.getAllObjsOf("ARC",!1,!1,[io.BOARDOUTLINE]);(f.length>0||g.length>0)&&za(Fo.gJsonCache.panelize,!1);za(Fo.gJsonCache.panelize)}}Is!=ao.PCB&&Is!=ao.PCBMODULE||yo.removeRtreeNode(e)}};Fo.removeAll=function(e){Object.keys(Fo.gJsonCache).forEach(function(e){e==e.toUpperCase()&&"DRCRULE"!=e&&(Fo.gJsonCache[e]=D(Fo.gJsonCache[e])?[]:{})});if(Fo.gJsonCache.preference){Fo.gJsonCache.preference.hideNets=[];Fo.gJsonCache.preference.hideFootprints=[]}e&&!1===e.updateNetText||gi(void 0,"");if(Is==ao.PCB||Is==ao.PCBMODULE){yo.clearRtree();d("masker-topLayer").innerHTML="";d("masker-bottomLayer").innerHTML=""}};Fo.updateOne=function(e,t){if(e&&(!e.parentNode||"gCurParts"!=e.parentNode.id)&&"gPre"!=e.id&&"gPad"!=e.id){t||(t={});var r=p('[c_shapeType="dimensionCheck"]');"dimensionCheck"!==m(e,"c_shapetype")&&r.length>0&&zr(r);if(e.parentNode&&e.parentNode.tagName){for(var n=e;e&&e.parentNode!=Ka;)e=e.parentNode;if(e){var i=m(e,"id"),a=Z(e);if(a&&_s[a]){var o=_s[a](e);if(o){if((Is==ao.PCB||Is==ao.PCBMODULE||Is==ao.PCBLIB)&&i&&d(i)&&("COPPERAREA"==a||"SOLIDREGION"==a)){qo.simplifySelfIntersectingPolygon(d(i))?o.pathStr=m(d(i),"d"):t.notCopper=!0}Fo.gJsonCache[a]||(Fo.gJsonCache[a]={});var s=Fo.gJsonCache[a][i];Fo.gJsonCache[a][i]=o;Fo.updateSignal(o);if("COPPERAREA"==a&&(Is==ao.PCB||Is==ao.PCBMODULE)){t.notCopper||sr("buildCopper");_n(e)}if(Is==ao.PCB||Is==ao.PCBLIB){"CIRCLE"==a&&Vi(e);"ARC"==a&&(s&&s.d==o.d&&o.pointArr||(o.pointArr=pi(e,!1)));es.addToRTree(o,a);!t.notRealtimeDRC&&Ko&&Ko.doRealtimeDRC&&Ko.doRealtimeDRC(e)}if(("TRACK"==a||"ARC"==a)&&Is==ao.PCB&&o.layerid==io.BOARDOUTLINE){var l=Fo.gJsonCache.panelize;l&&za(l,!1)}if("CIRCLE"==a||"TRACK"==a||"PAD"==a||"ARC"==a||"FOOTPRINT"==a||"VIA"==a){var c=m(e,"layerid");if("FOOTPRINT"==a)for(var h=p("[id][layerid]",e),u=0;u<h.length;u++)h[u].netTextCache=null;else e.netTextCache=null;t.noText||(oi(c)?gi(e):gi(e,""))}var f,g;if(n!=e){f=Z(n);g=m(n,"id");if("PAD"==f&&"FOOTPRINT"==a){a="PAD";s=s&&s.PAD?s.PAD[g]:null;o=o&&o.PAD?o.PAD[g]:null;e=d(g)}}if("PAD"==a&&o&&e&&(!s||s.width!=o.width||s.height!=o.height||s.shape!=o.shape||s.layerid!=o.layerid||s.pasteExpansion!=o.pasteExpansion||s.solderExpansion!=o.solderExpansion||"POLYGON"==o.shape&&o.pointArr.length!=s.pointArr.length)){Oi(e,o.shape);ji(e,"Pad")}"PAD"!=a&&"VIA"!=a||Is!=ao.PCB||Zi()||(s&&bi(s.layerid,!0)||bi(o.layerid,!0))&&(t.noRebuildPlane||qo.rebuildPlane("all"));if("FOOTPRINT"==a){Is!=ao.PCB||Zi()||t.noRebuildPlane||qo.rebuildPlane("all");setTimeout(function(){Fo.updateLibMasker(e)},16.7)}Is!=ao.PCB&&Is!=ao.PCBMODULE||setTimeout(function(){yo.updateRtreeNode(e)},16.7)}}}}}};Fo.updateMore=function(e,t){if(e&&e.length)for(var r=0,n=e.length;r<n;r++)Fo.updateOne(e[r],t)};Fo.updateViasBatch=function(e,t){if(e&&e.length)for(var r=0,n=e.length;r<n;r++){var i=e[r];if(i){var a=m(i,"id");if(t&&_s[t]){var o=_s[t](i);if(o){Fo.gJsonCache[t]||(Fo.gJsonCache[t]={});Fo.gJsonCache[t][a]=o;Fo.updateSignal(o);gi(i);Is!=ao.PCB&&Is!=ao.PCBMODULE||setTimeout(function(){yo.updateRtreeNode(i)},16.7)}}}}};Fo.updateLibMasker=function(e){var t=e.id,r=Eo.svg.getPlainBBox(e),n=h('rect[attach_libid="'+t+'"]');n&&n.parentNode.removeChild(n);var i=m(e,"layerid");r.fill="rgba(255,255,255,0)";r.attach_libid=t;var a=zt("rect",r),o=d("masker-topLayer"),s=d("masker-bottomLayer");i==io.TOPLAYER?o.appendChild(a):s.appendChild(a)};Fo.calAll=function(e){e||(e={});e.noRebuildPlane=!0;e.notCopper=!0;Is==ao.PCB&&Mi();Fo.removeAll({updateNetText:!1});for(var t,r,n=Ka.childNodes,i=[],a=0,o=n.length;a<o;a++){var s=n[a];if(s&&1===s.nodeType&&!(s.id.indexOf("layer_")>=0)){t=Z(s);if("COPPERAREA"!=t&&"PLANEZONE"!=t)"RATLINE"!=t&&Fo.updateOne(s,e);else{i.push(s);r=!0}}}i.forEach(function(t){Fo.updateOne(t,e)});if(Is==ao.PCB&&r&&!e.notCopper){sr("buildCopper",["all"]);qo.rebuildPlane("all")}};Fo.ifFind=function(e,t,r,n,i,a){var o,s,l=null;r=r||"";var c,d=[];n==io.ALL?es.layers.forEach(function(r){d=d.concat(es.searchByPoint2(e,t,2,r))}):d=es.searchByPoint2(e,t,2,n);if("ALL"==i){var p=[],h=[];d.forEach(function(e){"PAD"==e.type||"VIA"==e.type?p.push(e):h.push(e)});d=p.concat(h)}else if("MeasureLine"===i){var u=[];h=[];d.forEach(function(e){"PAD"==e.type||"VIA"==e.type||"HOLE"==e.type?u.push(e):h.push(e)});d=u.concat(h)}else for(o=0,s=d.length;o<s;o++){c=d[o];c.type!=i&&(d[o]=null)}for(o=0,s=d.length;o<s;o++){var f=d[o];if(f&&f.node&&f.node.gId!==a){var g=f.node,y=f.type;if(("MeasureLine"===i||"HOLE"!==y)&&(g.net==r||""===r||"_diff_pair"==r&&g.net.match(/(?:\+|-|_P|_N)$/))){l=Fo.searchPointOnObject(y,g,e,t);if(l.type)return l}}}return l||{}};Fo.searchPointOnObject=function(e,t,r,n){var i,a,o,s,l,d,p,h,u,f,g,y,v,x={type:!1,gId:null,X:0,Y:0,net:"",layerid:0},m=[],C=!1,L=new c(r,n);switch(e){case"PAD":case"VIA":case"HOLE":case"DOT":"VIA"==e?l=t.diameter/2:"PAD"==e?l=t.width/2:"HOLE"==e?l=t.holeR:"DOT"==e&&(l=t.strokeWidth/2);if("PAD"==e&&"ELLIPSE"!=t.shape){m=t.pointArr;C=ls.isPointInPolygon(L,m)}else C=ls.isPointInCircle({x:t.x,y:t.y},L,l);if(C){x.X=t.x;x.Y=t.y;x.type=e;x.net=t.net;x.gId=t.gId;x.isFootprintPad=!("PAD"!=e||Fo.gJsonCache.PAD&&Fo.gJsonCache.PAD[t.gId]);x.layerid=t.layerid;return x}break;case"TRACK":m=t.pointArr;y=m.length;if(!m||y<2)return x;i=!1;if(ls.isPointInCircle(m[0],L,+t.strokeWidth/2)){x.X=m[0].x;x.Y=m[0].y;i=!0}else if(ls.isPointInCircle(m[y-1],L,+t.strokeWidth/2)){x.X=m[y-1].x;x.Y=m[y-1].y;i=!0}else{v=de(L,m,+t.strokeWidth/2);if(v){x.X=v.point.x;x.Y=v.point.y;i=!0}}if(i){x.gId=t.gId;x.type=e;x.net=t.net;x.layerid=t.layerid;x.strokeWidth=t.strokeWidth;return x}break;case"ARC":a=t.centerParam;o=+a.cx;s=+a.cy;l=+a.rx;d=t.arcParams;p=+d[0];h=+d[1];u=+d[7];f=+d[8];i=!1;if(ls.isPointInCircle({x:p,y:h},L,+t.strokeWidth/2)){x.X=p;x.Y=h;i=!0}else if(ls.isPointInCircle({x:u,y:f},L,+t.strokeWidth/2)){x.X=u;x.Y=f;i=!0}else{g=fe(o,s,+L.x,+L.y);if(Math.abs(g-l)<=+t.strokeWidth/2&&Ko._isPointInsideArc(t,L)){x.X=o+l*((L.x-o)/g);x.Y=s+l*((L.y-s)/g);i=!0}}if(i){x.gId=t.gId;x.type=e;x.net=t.net;x.layerid=t.layerid;x.strokeWidth=t.strokeWidth;return x}}return x};Fo.checkShow=function(e,t,r,n){var i=d("pdot0");m(i,"display","none");var a=Fo.ifFind(e,t,r,n,"ALL");if(!a||!a.type)return!1;m(i,{display:"",cx:a.X,cy:a.Y})};Fo.removeSignalsOfOneObject=function(e){if(Is==ao.PCBLIB)return!1;var t=m(e,"id");if(t){var r,n,i,a,o={CIRCLE:!0,PAD:!0,VIA:!0,COPPERAREA:!0,TRACK:!0,ARC:!0,SOLIDREGION:!0,PLANEZONE:!0},s=Z(e),l=Fo.gJsonCache.SIGNALS;if(o[s]){r=m(e,"net");g=+m(e,"layerid");if(!oi(g)){"TRACK"===s&&delete l[r];return}"COPPERAREA"==s&&qo.resetActiveCopperPolygons(_s.COPPERAREA(e));n=l[r]||[];for(i=0,a=n.length;i<a;i++)if(n[i]&&n[i].gId==t){n.splice(i,1);0===n.length&&delete l[r];Qo.buildOneNet(r,!0);return}}if("FOOTPRINT"==s){var c=Fo.gJsonCache.FOOTPRINT[t];if(!c)return;var d=c.PAD,p={},h=[];for(var u in d)if(S(d,u)){var f=d[u];t=f.gId;r=f.net;var g=+f.layerid;if(r&&!p[r]){h.push(r);p[r]=1}if(!oi(g))continue;if(l[r]){n=l[r];for(i=0,a=n.length;i<a;i++)if(n[i]&&n[i].gId==t){n.splice(i,1);break}}}Qo.buildGroupNets(h)}}};Fo.buildSignals=function(){if(Is==ao.PCBLIB)return!1;for(var e,t,r,n,i=["PAD","VIA","COPPERAREA","TRACK","ARC","SOLIDREGION","PLANEZONE"],a={},o=0;o<i.length;o++){e=i[o];t=Fo.gJsonCache[e];if(t)for(var s in t)if(S(t,s)){r=t[s].net;n=+t[s].layerid;if(!oi(n))continue;if(("TRACK"===e||"ARC"===e)&&bi(n))continue;a[r]||(a[r]=[]);a[r].push({gId:s,cmd:e,layerid:n,fid:0})}}t=Fo.gJsonCache.FOOTPRINT;for(var l in t)if(S(t,l)){var c=t[l],d=c.PAD;for(var p in d)if(S(d,p)){var h=d[p];r=h.net;n=+h.layerid;if(!oi(n))continue;a[r]||(a[r]=[]);a[r].push({gId:p,cmd:"PAD",layerid:n,fid:l})}var u=c.VIA;for(var f in u)if(u.hasOwnProperty(f)){var g=u[f];r=g.net;n=+g.layerid;if(!oi(n))continue;a[r]||(a[r]=[]);a[r].push({gId:f,cmd:"VIA",layerid:n,fid:l})}}Fo.gJsonCache.SIGNALS=a};Fo.getAllNetName=function(){var e=[],t=Fo.gJsonCache.SIGNALS;for(var r in t)S(t,r)&&r.length>0&&e.push(r);return e};Fo.updateSignal=function(e){if(Is==ao.PCBLIB)return!1;var t=["CIRCLE","PAD","VIA","COPPERAREA","TRACK","ARC","SOLIDREGION","PLANEZONE"],r=d(e.gId);if(r){var n=Z(r);if(-1!=t.indexOf(n)&&("CIRCLE"!==n&&"TRACK"!==n&&"ARC"!==n||!bi(e.layerid))){var i=Fo.gJsonCache.SIGNALS;e.net=void 0===e.net?"":e.net;!i[e.net]&&oi(e.layerid)&&(i[e.net]=[]);var a,o,s,l=i[e.net],c=(Fo.getNetName(e.gId),!1);if(l){for(o=0,s=l.length;o<s;o++){a=l[o];if("object"==typeof a&&a.gId==e.gId){c=!0;if(oi(e.layerid)){l[o].layerid=e.layerid;break}l.splice(o,1);o--;break}}if(!1===c&&oi(e.layerid)){Fo.deleteSignal(e.gId);l.push({gId:e.gId,cmd:n,layerid:e.layerid,fid:e.fid||0})}}else{Fo.deleteSignal(e.gId);if(oi(e.layerid)){i[e.net]||(i[e.net]=[]);i[e.net].push({gId:e.gId,cmd:n,layerid:e.layerid,fid:e.fid||0})}}}}};Fo.deleteSignal=function(e){if(Is==ao.PCBLIB)return!1;if(e){var t,r,n=Fo.gJsonCache.SIGNALS,i=!1;for(var a in n)if(S(n,a)){t=n[a];for(var o=0,s=t.length;o<s;o++){r=t[o];if(void 0!==r&&(r.gId==e||r.fid==e)){t.splice(o,1);0===t.length&&delete n[a];i=!0}}}return i}};Fo.getNetName=function(e){if(e){var t,r,n=Fo.gJsonCache.SIGNALS;for(var i in n)if(S(n,i)){t=n[i];for(var a=0,o=t.length;a<o;a++){r=t[a];if(void 0!==r&&r.gId==e)return i}}return!1}};Fo.getElementByObj=function(e){var t=e.gId,r=e.cmd,n=e.fid;return n?Fo.gJsonCache.FOOTPRINT[n]&&Fo.gJsonCache.FOOTPRINT[n][r][t]:Fo.gJsonCache[r][t]};Fo.getRatLineInfoOfPCBLib=function(e){var t=Fo.gJsonCache.FOOTPRINT[e.id],r=[];if(t){var n=t.PAD;for(var i in n)if(S(n,i)){var a=n[i];if(!a.net)continue;var o=Fo.findClosestPad(a);if(!o)continue;var s={net:a.net,from:{fid:e.id,gId:a.gId,x:a.x,y:a.y},to:{fid:null,gId:o.gId,x:o.x,y:o.y}};r.push(s)}}return r};Fo.findClosestPad=function(e){if(!e.net)return!1;var t=Fo.gJsonCache.SIGNALS[e.net],r=null,n=9999999999;if(t)for(var i=0,a=t.length;i<a;i++){var o=t[i]||{};if("PAD"==o.cmd&&o.gId!=e.gId){var s=Fo.getElementByObj(o);if(s){var l=(e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y);if(l<n){r=s;n=l}}}}return r};Fo.findClosestSignalPoint=function(e,t,r){};Fo.getAllObjsOf=function(e,t,r,n){function i(e){for(var t in e)if(S(e,t)){if(r&&!oi(e[t].layerid)||D(n)&&-1==n.indexOf(+e[t].layerid))continue;a.push(e[t])}}var a=[];Fo.gJsonCache[e]&&i(Fo.gJsonCache[e]);if(t&&-1==parent.$.inArray(e,["COPPERAREA","RECT"])){var o=Fo.gJsonCache.FOOTPRINT;for(var s in o)if(S(o,s))for(var l in o[s])o[s].hasOwnProperty(l)&&l==e&&i(o[s][e])}return a};var Ls,_s={ARC:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,net:Y(t.net||""),d:t.d,c_helper_dots:"",strokeWidth:+t["stroke-width"],locked:t.locked||0}},COPPERAREA:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,net:Y(t.net||""),pathStr:t.d?t.d:mt(e.points),clearanceWidth:+t.clearanceWidth||1,fillStyle:t.fillStyle||"solid",strokeWidth:t["stroke-width"],thermal:t.thermal||"spoke",keepIsland:t.keepIsland||"none",locked:t.locked||0,name:Y(t.name||""),order:t.order||""}},PLANEZONE:function(e){var t=wt(e),r={};e.children.forEach(function(e){r[e.id]=m(e,"d")});return{gId:t.id,layerid:t.layerid,net:Y(t.net||""),pathStrObj:r,fillStyle:t.fillStyle||"solid"}},CIRCLE:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,cx:Eo.formatLengthSave(+t.cx),cy:Eo.formatLengthSave(+t.cy),r:Eo.formatLengthSave(+t.r),strokeWidth:Eo.formatLengthSave(+t["stroke-width"]),locked:t.locked||0,net:t.net||"",transformArc:t.transformArc||""}},DIMENSION:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,d:t.d,fontSize:t.c_fontSize,locked:t.locked||0}},PROTRACTOR:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,d:t.d,strokeWidth:parseFloat(e.getAttribute("stroke-width"),10),fontSize:t.c_fontSize,precision:t.c_precision,locked:t.locked||0}},IMAGE:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,x:Eo.formatLengthSave(t.x),y:Eo.formatLengthSave(t.y),width:t.width,height:t.height,rotation:t.c_rotation,href:t["xlink:href"],locked:t.locked||0}},RECT:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,net:Y(t.net||""),x:Eo.formatLengthSave(t.x),y:Eo.formatLengthSave(t.y),width:Eo.formatLengthSave(+t.width),rotation:t.transform,height:Eo.formatLengthSave(+t.height),strokeWidth:t["stroke-width"],fill:t.fill,locked:t.locked||0}},SOLIDREGION:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,net:Y(t.net||""),pathStr:t.d?t.d:mt(e.points),type:t.type,teardrop:t.c_teardrop,targetPad:t.c_targetpad,targetWire:t.c_targetwire,locked:t.locked||0}},TRACK:function(e){var t=wt(e);return{gId:t.id,layerid:t.layerid,net:Y(t.net||""),pointArr:N(t.points),strokeWidth:+t["stroke-width"],locked:t.locked||0}},FOOTPRINT:function(e){var t=wt(e),r={TRACK:{},PAD:{},VIA:{},HOLE:{},TEXT:{},SOLIDREGION:{},DIMENSION:{},PROTRACTOR:{},ARC:{},RECT:{},CIRCLE:{},IMAGE:{},COPPERAREA:{},SVGNODE:{},gId:t.id,itemOrder:[]};t.c_origin||(t.c_origin=",");r.head={x:Eo.formatLengthSave(t.c_origin.split(",")[0]),y:Eo.formatLengthSave(t.c_origin.split(",")[1]),c_para:t.c_para,rotation:t.c_rotation,gId:t.id,layerid:t.layerid,uuid:t.uuid,utime:t.utime,locked:t.locked||0,bindSCHId:t.bindSCHId||""};for(var n,i,a,o=e.childNodes,s=0,l=o.length;s<l;s++){a=o[s];if(3!=a.nodeType){n=m(a,"id");i=Z(a);if(_s[i]){var c=_s[i](a);if(c){r[i]||(r[i]={});r[i][n]=c;if("PAD"==i||"VIA"==i){c.fid=e.id;Fo.updateSignal(c)}r.itemOrder.push(n)}}}}return r},PAD:function(e){var t=wt(e),r=wt(e.querySelectorAll(":not([c_padid]):not(title)")[0]),n=wt(e.querySelectorAll(":not([c_padid]):not(title)")[1]);if(!n){var i=t.c_origin.split(",");n={r:Eo.formatLengthSave(Math.min(+t.c_width,+t.c_height)/2),cx:Eo.formatLengthSave(+i[0]),cy:Eo.formatLengthSave(+i[1])}}if("slot"==ci(e)){n.r=m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"stroke-width")/2;var a=N(m(e.querySelectorAll(":not([c_padid]):not(title)")[1],"points"));n.holeLength=Eo.formatLengthSave(+(Ue(a[0],a[1])+2*n.r));n.slotPointArr=a}else{n.center={x:Eo.formatLengthSave(n.cx),y:Eo.formatLengthSave(n.cy)};n.holeLength=0;n.slotPointArr=[]}return{gId:t.id,layerid:t.layerid,shape:t.c_shape,x:Eo.formatLengthSave(+t.c_origin.split(",")[0]),y:Eo.formatLengthSave(+t.c_origin.split(",")[1]),net:Y(t.net||""),width:Eo.formatLengthSave(+t.c_width),height:Eo.formatLengthSave(+t.c_height),number:Y(t.number),holeR:Eo.formatLengthSave(+n.r),holeCenter:n.center||"",pointArr:"OVAL"==t.c_shape?Ti(N(r.points),r["stroke-width"]/2):N(r.points),pointArr2:"OVAL"==t.c_shape?N(r.points):"",rotation:t.c_rotation||0,holeLength:Eo.formatLengthSave(n.holeLength),slotPointArr:n.slotPointArr,plated:t.plated,locked:t.locked||0,pasteExpansion:t.pasteExpansion,solderExpansion:t.solderExpansion}},TEXT:function(e){var t=wt(e),r=wt(e.firstChild),n="L";"note_pre"==r.c_note?n="P":"note_name"==r.c_note&&(n="N");return{gId:t.id,layerid:t.layerid,type:n,x:Eo.formatLengthSave(t.c_origin.split(",")[0]),y:Eo.formatLengthSave(t.c_origin.split(",")[1]),rotation:t.c_rotation||"0",mirror:t.c_mirror,fontSize:r.c_fontSize,fontFamily:r.c_fontFamily,text:Y(r.c_text),pathStr:r.d,display:t.display,strokeWidth:r["stroke-width"],locked:t.locked||0}},VIA:function(e){var t=wt(e),r=wt(e.querySelectorAll(":not([c_padid]):not(title)")[0]),n=wt(e.querySelectorAll(":not([c_padid]):not(title)")[1]);if(!n){var i=t.c_origin.split(",");n={cx:Eo.formatLengthSave(+i[0]),cy:Eo.formatLengthSave(+i[1]),r:0}}return{gId:t.id,x:Eo.formatLengthSave(+n.cx),y:Eo.formatLengthSave(+n.cy),net:Y(t.net||""),diameter:Eo.formatLengthSave(2*r.r),layerid:io.ALL,holeR:n.r,locked:t.locked||0,solderExpansion:t.solderExpansion}},HOLE:function(e){var t=wt(e),r=wt(e.childNodes[1]);return{gId:t.id,x:Eo.formatLengthSave(+r.cx),y:Eo.formatLengthSave(+r.cy),holeR:Eo.formatLengthSave(+r.r),layerid:io.ALL,locked:t.locked||0}},SVGNODE:function(e){if(1===e.nodeType){var t=wt(e),r={gId:t.id,nodeName:e.nodeName,nodeType:e.nodeType};t.layerid&&(r.layerid=t.layerid);delete t.class;delete t.xmlns;r.attrs=t;var n=0,i=e.childNodes,a=i.length;if(a){r.childNodes=[];for(;n<a;n++)r.childNodes[n]=_s.SVGNODE(i[n])}return r}return{nodeName:e.nodeName,nodeType:e.nodeType,nodeValue:e.nodeValue}}};!function(){function r(e){if("string"!=typeof e||!e.match(/#?([\da-f]{6})/i))return e;var t=parseInt(RegExp.$1,16);return"#"+("00000"+((Math.min(255,Math.round(.5*(t>>16)))<<16)+(Math.min(255,Math.round(.5*(t>>8&255)))<<8)+Math.min(255,Math.round(.5*(255&t)))).toString(16)).substr(-6).toUpperCase()}var n=io.RATLINES,i={};i[n]=1;i.pad=1;Ls={prefix:"layer_",front:"",cache:null,markers:{},getLayersCache:function(){var e=Fo.gJsonCache.layers;this.cache=e;return e},getActiveLayer:function(){return this.front},setActiveLayer:function(t){if(!this.cache[t]||!this.cache[t].config)return!1;if("place.part_import"==Uo){var r=d("part_import");if(r&&"FOOTPRINT"==Z(r)){var n=+m(r,"layerid"),i=Ls.getValidLayer("FOOTPRINT",t),a=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER];if(i)if(n&&a.indexOf(n)<0!=a.indexOf(i)<0){Ra(r,i,!0);Cs.target&&Ra(Cs.target,i,!0)}else if(!n&&a.indexOf(i)>=0){
Ra(r,i,!0);Cs.target&&Ra(Cs.target,i,!0)}}}if("draw.track"==Uo&&bi(t)){sr("messagerShow",[{title:"Notice",msg:"Change to a plane layer is not allowed during track routing.",timeout:2500,showType:"slide"}]);return!1}if(Yo&&"part_plane"===m(Yo,"c_partid")){Gr();sr("triggerEvent",["select_change"])}p('path[c_shapetype="plane"].hover',Ka).forEach(function(e){u(e,"hover",!1)});Ls.showAtFront(t);bi(t)&&qo.rebuildPlane(t);Fo.getAllObjsOf("PLANEZONE",!0).map(function(e){var t=d(e.gId);t&&y(t,"current-layer");return e}).filter(function(e){return e.layerid==t}).forEach(function(e){var t=d(e.gId);t&&g(t,"current-layer")});sr("setActivePCBLayer",[t,e]);return!0},add:function(e){var t=this.prefix+e;if(d(t))return d(t);var r=zt("g");r.id=t;this.markers[t]=r;return Ka.appendChild(r)},get:function(e){var t=this.prefix+e,r=d(t);r||(r=Ls.add(e));return r},_attr:function(e,t,r){if(1==arguments.length)return e.getAttribute(this.prefix+t);e.setAttribute(this.prefix+t,r)},_removeAttr:function(e,t){e.removeAttribute(this.prefix+t)},_setElementShow:function(e,t){this._attr(e,"show",!1===t?"0":"1")},_showElement:function(e){this._setElementShow(d(e.gId),!0)},_hideElement:function(e){this._setElementShow(d(e.gId),!1)},show:function(e,t){t=!1!==t;this.cache[e]&&(this.cache[e].visible=t);var r=Si(d("pcblayerStyle").sheet,+e);r&&(r.style.display=t?"":"none");t||Yo&&m(Yo,"layerid")==e&&Gr();e!=io.RATLINES&&oi(e)&&fi(e);Ei(d("padExpansionLayerStyle").sheet,e,!t)},hide:function(e){this.show(e,!1)},isVisible:function(e){var t=this.cache||this.getLayersCache();return t&&t[e]&&t[e].visible},isSignalLayer:function(e){e=+e;return e<io.TOPSILKLAYER||e>=io.INNER1||e==io.ALL},_setElementFront:function(e,t){this._attr(e,"front",!1===t?"0":"1")},_getGroupName:function(e,t){var r=Z(e),n=m(e,"layerid"),i=!t||n==t;if(!r&&m(e,"attachedcopperid"))return"copperPolygon";if(n==io.TOPSILKLAYER||n==io.BOTTOMSILKLAYER)return"silk";m(e,"layerid");switch(r){case"":return"bad";case"TRACK":case"ARC":return"trackAndArc";case"COPPERAREA":case"PAD":return"copperAndPad";case"FOOTPRINT":return i?"footprint":"otherFootprint";case"TEXT":return"text";default:return"shape"}},showAtFront:function(e){function r(e,t,r){if(e.length){var n=t;r=r||e[0]&&e[0].parentNode;if(r)for(var i=e.length-1;i>=0;i--){e[i].nextElementSibling!=n&&r.insertBefore(e[i],n);n=e[i]}}}function n(t,a,o,s){var l=["bad","copperPolygon","shape","trackAndArc","copperAndPad","otherFootprint","footprint","text","silk","multi"],c={};l.forEach(function(e){c[e]=[]});var d=Eo.node.children(a);(o||s)&&(d=[].filter.call(d,function(e){return(!o||i(o,e))&&(!s||i(e,s))}));var h,u,f=s||null,g=t==io.TOPSILKLAYER||t==io.BOTTOMSILKLAYER;u=p(('#g1 > [layerid="'+io.ALL+'"], #g1 > [layerid="'+io.DOCUMENT+'"], #g1 > [layerid="'+io.BOARDOUTLINE+'"]').replace(/#g1/g,"#"+a.id),a);r(u,f,a);f=u[0]||f;if(t==io.TOPLAYER||t==io.BOTTOMLAYER){u=p(('#g1 > [layerid="'+(t==io.TOPLAYER?io.TOPSILKLAYER:io.BOTTOMSILKLAYER)+'"]').replace(/#g1/g,"#"+a.id),a);r(u,f,a);f=u[0]||f}if(g){u=p(('#g1 > [layerid="'+t+'"]').replace(/#g1/g,"#"+a.id),a);r(u,f,a);f=u[0]||f}if(t==io.TOPPASTERLAYER||t==io.TOPSOLDERLAYER||t==io.BOTTOMPASTERLAYER||t==io.BOTTOMSOLDERLAYER){u=p(('#g1 > g[c_partid="part_pad"] > *[layerid="'+t+'"]').replace(/#g1/g,"#"+a.id),a);for(h=0;h<u.length;h++)r([u[h]],null,null)}else{u=p(('#g1 > g[c_partid="part_pad"][layerid="'+io.ALL+'"] > *[c_padid][layerid="'+io.TOPSOLDERLAYER+'"]').replace(/#g1/g,"#"+a.id),a);for(h=0;h<u.length;h++)r([u[h]],null,null);u=p(('#g1 > g[c_partid="part_pad"] > *[layerid="'+io.ALL+'"]').replace(/#g1/g,"#"+a.id),a);for(h=0;h<u.length;h++)r([u[h]],null,null);u=p(('#g1 > g[c_partid="part_pad"] > *[layerid="'+io.TOPLAYER+'"]').replace(/#g1/g,"#"+a.id),a);for(h=0;h<u.length;h++)r([u[h]],null,null);u=p(('#g1 > g[c_partid="part_pad"] > *[layerid="'+io.BOTTOMLAYER+'"]').replace(/#g1/g,"#"+a.id),a);for(h=0;h<u.length;h++)r([u[h]],null,null)}if(!g){u=p(('#g1 > g[layerid="'+t+'"][c_partid="part_pcbtext"]').replace(/#g1/g,"#"+a.id),a);r(u,f,a);f=u[0]||f}u=p(('#g1 > g[layerid="'+t+'"][c_partid^="part_import_"]').replace(/#g1/g,"#"+a.id),a);r(u,f,a);f=u[0]||f;u=p(('#g1 > g:not([layerid="'+t+'"])[c_partid^="part_import_"]').replace(/#g1/g,"#"+a.id),a);r(u,f,a);f=u[0]||f;if(!g){u=p(('#g1 > [layerid="'+t+'"]').replace(/#g1/g,"#"+a.id),a);for(h=0;h<u.length;h++){var y=Ls._getGroupName(u[h],t);c[y].push(u[h])}}var v=["bad","copperPolygon","shape","trackAndArc","copperAndPad"];for(h=v.length-1;h>=0;h--){u=c[v[h]];r(u,f,a);f=u[0]||f}u=p('#g1 > g[c_partid^="part_import_"]'.replace(/#g1/g,"#"+a.id),a);for(h=u.length-1;h>=0;h--)n(t,u[h]);if(bi(t)){u=p(('#g1 > [layerid="'+io.ALL+'"], #g1 > [layerid="'+io.DOCUMENT+'"], #g1 > [layerid="'+io.BOARDOUTLINE+'"]').replace(/#g1/g,"#"+a.id),a);f=u[0];u=p(('#g1 > [layerid="'+t+'"]').replace(/#g1/g,"#"+a.id),a);r(u,f,a)}if(vs){u=p('path[copper_id][copper_layerid="'+e+'"]',vs);for(h=0;h<u.length;h++)vs.appendChild(u[h])}}function i(e,t){return 4==e.compareDocumentPosition(t)}var o,s,l,c=this.front;if(this.front!=e){for(var h in this.cache)S(this.cache,h)&&(this.cache[h].active=h==e);if(""!==this.front){o=Si(d("pcblayerStyle").sheet,+this.front);if(o){if(this.front==io.TOPLAYER||this.front==io.BOTTOMLAYER){l=this.front==io.TOPLAYER?io.TOPSILKLAYER:io.BOTTOMSILKLAYER;s=d("pcblayerStyle").sheet.cssRules[l];s.style.stroke=this.cache[l].darkColor;s.style.fill=this.cache[l].darkColor}o.style.stroke=this.cache[+this.front].darkColor;o.style.fill=this.cache[+this.front].darkColor}}this.front=e;o=Si(d("pcblayerStyle").sheet,+e);if(o){if(this.front==io.TOPLAYER||this.front==io.BOTTOMLAYER){l=this.front==io.TOPLAYER?io.TOPSILKLAYER:io.BOTTOMSILKLAYER;s=d("pcblayerStyle").sheet.cssRules[l];s.style.stroke=this.cache[l].color;s.style.fill=this.cache[l].color}o.style.stroke=this.cache[+e].color;o.style.fill=this.cache[+e].color;o.style.pointerEvents=""}n(e,Ka,Ls.get("other_begin"),Ls.get("other_end"));if("place.part_import"==Uo){var u=d("part_import");u&&"FOOTPRINT"==Z(u)&&n(e,u)}if("place.part_pcbtext"==Uo){var f=+e,g=d("part_pcbtext"),y=m(g,"c_mirror"),v=m(g,"c_origin"),x=[io.BOTTOMLAYER,io.BOTTOMSILKLAYER,io.BOTTOMPASTERLAYER,io.BOTTOMSOLDERLAYER].indexOf(f)>=0;if("h"==y!=x){m(g,"c_mirror",x?"h":"none");is.flipH(g,+v.split(",")[0])}m(g,"layerid",f)}var C=b("afterActiveLayerChange",{detail:{layeridOld:c||"",layeridNew:e}});t.dispatchEvent(C);a("updateNetColor",[Fo.gJsonCache.netColors])}},moveElementToLayer:function(e,t){this.moveElementsToLayer([e],t)},moveElementsToLayer:function(e,t){var r,n,i,a,o=this.cache[t];if(o){n=o.active;i=!!o.config&&o.visible;for(a=0;a<e.length;a++){r=e[a];this._setElementFront(r,n);this._setElementShow(r,i);m(r,"layerid",t);if("part_pad"==m(r,"c_partid")){m(r.querySelectorAll(":not([c_padid]):not(title)"),"layerid",t);m(r.querySelectorAll("[c_padlayerid]"),"c_padlayerid",t)}Ls.appendElement(r)}}},calLayerId:function(e){if(!e)throw"Layer.calLayerId error!";var t=Mo[e.toUpperCase()];if(!t)throw"Layer.calLayerId error!";for(var r=0;r<t.length;r++)if(t[r]+""==this.front)return this.front;return t[0]+""},updateElementLayerId:function(e,t){t=t||Z(e);if(t){"RECT"==t&&Is==ao.PCBLIB&&(t="HOLLOWRECT");var r=m(e,"layerid"),n=Ls.getActiveLayer(),i=Ls.getValidLayer(t,r||n);r!=i&&m(e,"layerid",i)}},appendElement:function(e,t){function r(e){return g==Ka?e:e.replace(/#g1 >/g,"#g1 > #"+g.id+" >")}function n(e,t){var n;n=a(e)?i():e==io.TOPLAYER||e==io.TOPSILKLAYER?t&&t.exceptFootprint?p(r('#g1 > [layerid="'+io.TOPLAYER+'"]:not([c_partid^="part_import_"]), #g1 > [layerid="'+io.TOPSILKLAYER+'"]'),g):p(r('#g1 > [layerid="'+io.TOPLAYER+'"], #g1 > [layerid="'+io.TOPSILKLAYER+'"], #g1 > g[c_partid^="part_import_"]'),g):e==io.BOTTOMLAYER||e==io.BOTTOMSILKLAYER?t&&t.exceptFootprint?p(r('#g1 > [layerid="'+io.BOTTOMLAYER+'"]:not([c_partid^="part_import_"]), #g1 > [layerid="'+io.BOTTOMSILKLAYER+'"]'),g):p(r('#g1 > [layerid="'+io.BOTTOMLAYER+'"], #g1 > [layerid="'+io.BOTTOMSILKLAYER+'"], #g1 > g[c_partid^="part_import_"]'),g):K(e)?t&&t.exceptFootprint?p(r('#g1 > [layerid="'+e+'"]:not([c_partid^="part_import_"])'),g):p(r('#g1 > [layerid="'+e+'"], #g1 > g[c_partid^="part_import_"]'),g):p(r('#g1 > [layerid="'+e+'"]'),g);return n}function i(e){var t=p(r('#g1 > [layerid="'+io.ALL+'"], #g1 > [layerid="'+io.DOCUMENT+'"], #g1 > [layerid="'+io.BOARDOUTLINE+'"]'),g);return e?o(t,e):t}function a(e){return e==io.ALL||e==io.DOCUMENT||e==io.BOARDOUTLINE}function o(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n++,i++)e[n]!==t?r[i]=e[n]:i--;return r}t=t||Z(e);var s=m(e,"layerid");s&&!bi(s)||Ls.updateElementLayerId(e);var l,c,d,u=s==io.TOPSILKLAYER||s==io.BOTTOMSILKLAYER,f=Ls.getActiveLayer(),g=e.parentNode&&e.parentNode.parentNode==Ka?e.parentNode:Ka,y=!0,v=!1,x=!t&&!!m(e,"attachedcopperid");if("RATLINE"==t){d="ratline_end";y=!1}else if("IMAGE"==t){d="image_end";y=!1}else{d="other_end";x?v=!0:a(s)&&(y=!1)}d=g==Ka?Ls.get(d):null;if(y)if("FOOTPRINT"!=t)if(u){c=function(e,t){var n,o=e==io.TOPSILKLAYER?io.TOPLAYER:io.BOTTOMLAYER,s=e==io.TOPSILKLAYER?io.BOTTOMLAYER:io.TOPLAYER,l=e==io.TOPSILKLAYER?io.BOTTOMSILKLAYER:io.TOPSILKLAYER;n=p(r('#g1 > [layerid="'+o+'"]:not([c_partid^="part_import_"]), #g1 > [layerid="'+e+'"]'),g);if(n[0])return n[n.length-1].nextElementSibling;if(t==o||t==e){n=p(r('#g1 > g[c_partid^="part_import_"]'),g);if(n[0])return n[n.length-1].nextElementSibling}else if(t==s||t==l){n=p(r('#g1 > [layerid="'+s+'"], #g1 > [layerid="'+l+'"], #g1 > g[c_partid^="part_import_"]'),g);if(n[0])return n[0]}else if(!a(t)){n=p(r('#g1 > g[layerid="'+t+'"]'),g);if(n[0])return n[0]}n=i();return n[0]?n[0]:void 0}(s,f);g.insertBefore(e,c||d)}else{var C=["bad","copperPolygon","shape","trackAndArc","copperAndPad","otherFootprint","footprint","text","silk","multi"],L={};C.forEach(function(e){L[e]=[]});var _=i()[0],P=f!=s&&(s==io.TOPLAYER&&f!=io.TOPSILKLAYER||s==io.BOTTOMLAYER&&f!=io.BOTTOMSILKLAYER);l=n(s,{exceptFootprint:P});l=o(l,e);if(l.length){for(var A,b,S=0;S<l.length;S++){A=Ls._getGroupName(l[S],f);L[A].push(l[S])}A=Ls._getGroupName(e,f);S=C.indexOf(A);c=null;b=L[A];b[0]&&(c=v?b[0]:b[b.length-1].nextElementSibling);if(!c)for(S++;S<C.length;S++){b=L[C[S]];if(b[0]){c=b[0];break}}if(!c){S=C.indexOf(A);for(S--;S>=0;S--){b=L[C[S]];if(b[0]){c=b[b.length-1].nextElementSibling;break}}}}else if(s==f)c=_;else if(a(f))c=_;else{l=n(f,{exceptFootprint:!1});l=o(l,e);c=l[0]||_}g.insertBefore(e,c||d);m(e,"copper")&&_n(e);m(c,"selected_to_top")&&m(e,{selected_to_top:!0})}else{c=function(e,t){var r;if(e==t){r=p('#g1 > g[c_partid^="part_import_"]',g);if(r[0])return r[r.length-1].nextElementSibling}else{r=h('#g1 > g[layerid="'+t+'"][c_partid^="part_import_"]',g);if(r)return r;r=p('#g1 > g[layerid="'+e+'"][c_partid^="part_import_"]',g);if(r[0])return r[r.length-1].nextElementSibling}r=p('#g1 > g[layerid="'+t+'"][c_partid="part_pcbtext"], #g1 > g[layerid="'+(t==io.TOPLAYER?io.TOPSILKLAYER:io.BOTTOMSILKLAYER)+'"]',g);if(r[0])return r[0];r=i();return r[0]?r[0]:null}(s,f);g.insertBefore(e,c||d)}else g.insertBefore(e,d)},updateFront:function(e){var t,n,i=this.getLayersCache();if(!e||i[e]||"ALL"===e){var a,o,s,l,c;l=d("pcblayerStyle").sheet;c=d("padExpansionLayerStyle").sheet;for(t in i)if(i[t].color){i[t].darkColor||(i[t].darkColor=r(i[t].color));if("ALL"===e){i[t].active=!0;n=1}else e?i[t].active=t==e:i[t].active&&(n?i[t].active=!1:n=t);s=i[t].active?"color":"darkColor";a=Si(l,t);if(a){if(n==io.TOPLAYER||n==io.BOTTOMLAYER){p=n==io.TOPLAYER?io.TOPSILKLAYER:io.BOTTOMSILKLAYER;o=Si(l,p);o.style.stroke=this.cache[p].color;o.style.fill=this.cache[p].color}a.style.stroke=i[t][s];a.style.fill=i[t][s];a.style.display=i[t].visible?"":"none";Ei(c,t,!i[t].visible);if(i[t].transparency){a.style["stroke-opacity"]=1-i[t].transparency;a.style["fill-opacity"]=1-i[t].transparency}}else l.insertRule('[layerid="'+t+'"]:not([c_para]) { stroke: '+(i[t].active?i[t].color:i[t].darkColor)+"; fill: "+(i[t].active?i[t].color:i[t].darkColor)+"; stroke-opacity: "+(1-i[t].transparency)+"; fill-opacity: "+(1-i[t].transparency)+"; }",l.cssRules.length)}if(!n){n=e||this.front||io.TOPLAYER;i[n].active=!0}this.front=t=n;if(a&&i[t]){if(n==io.TOPLAYER||n==io.BOTTOMLAYER){var p=n==io.TOPLAYER?io.TOPSILKLAYER:io.BOTTOMSILKLAYER;o=Si(l,p);o.style.stroke=this.cache[p].color;o.style.fill=this.cache[p].color}a.style.stroke=i[t].color;a.style.fill=i[t].color;a.style.display=i[t].visible?"":"none";if(i[t].transparency){a.style["stroke-opacity"]=1-i[t].transparency;a.style["fill-opacity"]=1-i[t].transparency}}var h,u=(Fo.gJsonCache.systemColor||{}).hole;if(u&&d("padHoleStyle")){h=d("padHoleStyle").sheet.cssRules;h[0].style.fill=u;h[1].style.fill=u;h[2].style.fill=u;h[3].style.stroke=u;h[4].style.stroke=u;h[5].style.stroke=u;h[6].style.stroke=u}}},initLayerSplitter:function(){this.add("image_begin");this.add("image_end");this.add("other_begin");this.add("other_end");this.add("ratline_begin");this.add("ratline_end")},setActivePCBLayer:function(e){return Ls.setActiveLayer(e)},initByCache:function(){var e=Ls.getLayersCache();for(var t in e)if(S(e,t)){Ls.show(t,!!e[t].config&&e[t].visible);e[t].active&&(Ls.front=t)}Ls.setActiveLayer(Ls.front)},getValidLayer:function(e,t){var r=Mo[e];if(r){var n,i=Ls.getLayersCache();t=+t;if(i){t=function(e,t){var n={SOLIDREGION:"Solid regions",FOOTPRINT:"Parts",COPPERAREA:"Copper areas",TEXT:"Texts",RECT:"Rects",SVGNODE:"Images"};if(n[e]&&bi(t)){var a=!1;r.some(function(e){if(i[e]&&i[e].config&&!bi(e)){a=e;return!0}});return a||1}return t}(e,t);if(t&&i[t]&&i[t].config&&r.indexOf(t)>=0)return t;r.some(function(e){if(i[e]&&i[e].config){n=e;return!0}});return n}}},updateNetColor:function(e){for(var t,n,i=this.getActiveLayer(),a={},o=d("net-color-stylesheet").sheet;o.cssRules.length;)o.deleteRule(0);for(var s in e)if(S(e,s)){t=e[s].color;n=r(t);a[s]={color:t};var l='[net="'+s+'"]',c="stroke:"+t+";",p="stroke:"+n+";";for(var h in io)if(S(io,h)){var u='[layerid="'+io[h]+'"]';if(io[h]==i){o.insertRule("#g1 line"+l+u+"{"+c+"}");oi(io[h])&&o.insertRule(l+u+"{"+c+";fill:none;}");o.insertRule(l+" > "+u+":not([c_para]) {"+c+"fill: "+t+"; }");o.insertRule(l+u+":not([c_para]):not([fill=none]){"+c+"fill:"+t+";}")}else{o.insertRule("#g1 line"+l+u+"{"+p+"}");oi(io[h])&&o.insertRule(l+u+"{"+p+";fill:none;}");o.insertRule(l+" > "+u+":not([c_para]) {"+p+"fill: "+n+"; }");o.insertRule(l+u+":not([c_para]):not([fill=none]){"+p+"fill:"+n+";}")}}}Fo.gJsonCache.netColors=a}};t.addEventListener("DOMContentLoaded",function(){Ls.initLayerSplitter();Ls.updateFront()},!1);a.registerHook({layer_show:function(e){Ls.show(e)},layer_hide:function(e){Ls.show(e,!1)},layer_front:function(e){return Ls.setActivePCBLayer(e)},layer_cfg:function(){return Ls.getLayersCache()},update_layer_transparensy:function(e){var t=d("pcblayerStyle").sheet;for(var r in e){var n=e[r],i=Si(t,r);i.style["stroke-opacity"]=1-n.transparency;i.style["fill-opacity"]=1-n.transparency}},layer_cfg_update:function(e,t){var n,i,a,o,s,l,c,h=[],u=[],f=[],g=[],y=Eo.extend({},Fo.gJsonCache.layers,!0);for(n in e)if(S(e,n))if("_hole"==n){Fo.gJsonCache.systemColor.hole=e[n].color;if(d("padHoleStyle")){l=d("padHoleStyle").sheet.cssRules;l[0].style.fill=e[n].color;l[1].style.fill=e[n].color;l[2].style.fill=e[n].color;l[3].style.stroke=e[n].color;l[4].style.stroke=e[n].color;l[5].style.stroke=e[n].color;l[6].style.stroke=e[n].color}}else if("_DRCError"==n){Fo.gJsonCache.systemColor.DRCError=e[n].color;m(p("#gDrcDots > path"),"stroke",e[n].color)}else{i=Fo.gJsonCache.layers[n];s=d("pcblayerStyle").sheet;c=Si(s,n);if(i){a=i.color;o=i.transparency;i.config&&!e[n].config&&bi(n)&&qo.cleanPlaneLayer(n);i.config=e[n].config;e[n].visible&&(i.visible=e[n].visible);if(a!==e[n].color){i.color=e[n].color;i.darkColor=r(e[n].color);if(c){c.style.stroke=i.active?i.color:i.darkColor;c.style.fill=i.active?i.color:i.darkColor}}if(o!=e[n].transparency){i.transparency=e[n].transparency;if(c){c.style["stroke-opacity"]=1-i.transparency;c.style["fill-opacity"]=1-i.transparency}}}else{Fo.gJsonCache.layers[n]=e[n];i=Fo.gJsonCache.layers[n]}if(K(n)){if("Plane"===i.type&&i.type!==e[n].type){h.push(n);g.push(n);for(var v in Fo.gJsonCache.PLANEZONE)S(Fo.gJsonCache.PLANEZONE,v)&&Fo.gJsonCache.PLANEZONE[v].layerid==n&&f.push(Fo.gJsonCache.PLANEZONE[v].net)}i.name=e[n].name||"Inner"+(+n-20);if("Plane"===e[n].type&&e[n].type!==i.type){g.push(n);qo.isLayerCleanForConvertingToPlane(n)||u.push(sr("$",[{cmd:"init",args:'#dlgLayerOptionsSetTable tr[data-layerid="'+n+'"] input[data-i18n-attr="placeholder"]'},{cmd:"attr",args:"placeholder"}])||i.name)}i.type=e[n].type;i.darkColor=r(e[n].color)}c||s.insertRule('[layerid="'+n+'"]:not([c_para]) { stroke: '+(i.active?i.color:i.darkColor)+"; fill: "+(i.active?i.color:i.darkColor)+"; stroke-opacity: "+(1-i.transparency)+"; fill-opacity: "+(1-i.transparency)+"; }",s.cssRules.length)}for(n in Fo.gJsonCache.layers)if(S(Fo.gJsonCache.layers,n)&&Fo.gJsonCache.layers[n]&&Fo.gJsonCache.layers[n].config&&!e[n]){Fo.gJsonCache.layers[n].config=!1;if(K(n)){Fo.gJsonCache.layers[n].name="Inner"+(n-20);Fo.gJsonCache.layers[n].type="";Fo.gJsonCache.layers[n].transparency="";1==Fo.gJsonCache.layers[n].active&&Ls.setActivePCBLayer(io.TOPLAYER);h.push(n);g.push(n);if(S(Fo.gJsonCache,"PLANEZONE"))for(v in Fo.gJsonCache.PLANEZONE)S(Fo.gJsonCache.PLANEZONE,v)&&Fo.gJsonCache.PLANEZONE[v].layerid==n&&f.push(Fo.gJsonCache.PLANEZONE[v].net)}}if(t){es.rebuild();qo.rebuildPlane("all");if(g.length>0){zo.startBatch();g.forEach(function(e){zo.save(["variable","",Fo.gJsonCache.layers[e],"type",y[e].type,Fo.gJsonCache.layers[e].type,function(t,r,n,i){"undo"===t&&"Plane"!==i&&qo.removePlaneZone(e)}])});h.length>0&&h.forEach(function(e){qo.cleanPlaneLayer(e,!0)});if(u.length>0){var x=u.reduce(function(e,t){return e+="'"+t+"', "},"").trim();sr("messagerWarn",[sr("i18nTransfer",["You are converting Signal Layer to Plane Layer, There're some non-track objects remain on following layers. Please delete the objects manually on the canvas."])[0]+'<p style="color:red">'+x+"</p>"])}zo.saveBatch()}f.length>0&&Qo.buildGroupNets(ot(f));sr("updateAttrPanel")}},toplayer:function(){a("toggleBottomTopLayer",[io.TOPLAYER])&&Ls.setActivePCBLayer(io.TOPLAYER)},bottomlayer:function(){a("toggleBottomTopLayer",[io.BOTTOMLAYER])&&Ls.setActivePCBLayer(io.BOTTOMLAYER)},inner1:function(){Ls.setActivePCBLayer(io.INNER1)},inner2:function(){Ls.setActivePCBLayer(io.INNER2)},inner3:function(){Ls.setActivePCBLayer(io.INNER3)},inner4:function(){Ls.setActivePCBLayer(io.INNER4)},getUsedLayerCount:function(){var e=0,r=0,n=0;if(t.querySelector('[layerid="'+io.ALL+'"]:not([display="none"])')){e=1;r=1}(t.querySelector('[layerid="'+io.TOPLAYER+'"]:not([display="none"])')||t.querySelector('[layerid="'+io.TOPSILKLAYER+'"]:not([display="none"])'))&&(e=1);(t.querySelector('[layerid="'+io.BOTTOMLAYER+'"]:not([display="none"])')||t.querySelector('[layerid="'+io.BOTTOMSILKLAYER+'"]:not([display="none"])'))&&(r=1);for(var i=io.INNER1,a=io.INNER32;i<=a;i++)Fo.gJsonCache.layers[i]&&Fo.gJsonCache.layers[i].config&&t.querySelector('[layerid="'+i+'"]:not([display="none"])')&&n++;return e+r+n},isLayerEmpty:function(e){return!h('[layerid="'+e+'"]:not([c_partid="part_plane"])')},updateNetColor:function(e){Ls.updateNetColor(e)},object_show:function(e,t){var r=Fo.gJsonCache.objectMap.objects;if(r&&r[e]){r[e].visible=t;Fo.gJsonCache.objectMap.visibleIndex===Fo.gJsonCache.objectMap.allIndex?r.All.visible=!0:r.All.visible=!1}var n,i=[];i=p(r[e].selectorText);switch(e){case"Copper Area":La("canvas",{"attr-pcbcanvas-copper-zone":t?"visible":"invisible"});sr("triggerEvent",["select_change"]);break;case"All":for(var o in r)S(r,o)&&"All"!==o&&r[o].visible!==t&&a("object_show",[o,t]);break;case"Prefix":case"Name":case"Text":for(n=0;n<i.length;n++)i[n].parentNode.setAttribute("display",t?"":"none");if("Prefix"==e||"Name"==e){i=p('#g1 > g[c_partid^="part_import_"]');Fo.updateMore(i)}break;case"Component":for(n=0;n<i.length;n++)i[n].setAttribute("display",t?"":"none");i=p('#g1 > g[c_partid^="part_import_"] > g[c_partid="part_pcbtext"] > path[c_text]:not([c_note]');for(n=0;n<i.length;n++)i[n].parentNode.setAttribute("display",t?"":"none");break;default:for(n=0;n<i.length;n++)i[n].setAttribute("display",t?"":"none")}},object_selected:function(e,t){var r=Fo.gJsonCache.objectMap.objects;if(r&&r[e]){r[e].selected=t;Fo.gJsonCache.objectMap.selectedIndex===Fo.gJsonCache.objectMap.allIndex?r.All.selected=!0:r.All.selected=!1}var n,i=[];i=p(r[e].selectorText);switch(e){case"All":for(var o in r)S(r,o)&&"All"!==o&&r[o].selected!==t&&a("object_selected",[o,t]);break;case"Name":case"Prefix":case"Text":for(n=0;n<i.length;n++)i[n].parentNode.style["pointer-events"]=t?"":"none";break;case"Component":if(!d("pcblayerObject"))break;var s=d("pcblayerObject").sheet,l=Gi(s,e);l&&(l.style["pointer-events"]=t?"":"none");i=p('#g1 > g[c_partid^="part_import_"] > g[c_partid="part_pcbtext"] > path[c_text]:not([c_note])');for(n=0;n<i.length;n++)i[n].parentNode.style["pointer-events"]=t?"":"none";break;default:if(!d("pcblayerObject"))break;var s=d("pcblayerObject").sheet,l=Gi(s,e);l&&(l.style["pointer-events"]=t?"":"none")}Gr()}})}();Qo._createGraph=function(e){var t=[];Qo.graph=[];if(!e)return!1;var r=Fo.gJsonCache.SIGNALS[e];if("object"==typeof r){for(var n,i=0,a=r.length;i<a;i++)r[i]&&"PAD"==r[i].cmd&&r[i].fid&&r[i].fid.length>3&&t.push({gId:r[i].gId,fid:r[i].fid});Qo.nodeCount=t.length;if(Qo.nodeCount<2){delete Qo.ratLineArr[e];var o=Qo.realRatLineArr[e]||[];for(i=0;i<o.length;i++){v(d(o[i].gId))}delete Qo.realRatLineArr[e];return!1}for(i=0;i<Qo.nodeCount;i++)Qo.graph[i]=[];Qo.PADMap=t;a=Qo.nodeCount;for(i=0;i<a;i++)for(n=i;n<a;n++)Qo.graph[i][n]=i!=n?Qo.graph[n][i]=Qo.getWeight(i,n):0}};Qo.getWeight=function(e,t){var r=Fo.gJsonCache.FOOTPRINT,n=Qo.PADMap[e],i=Qo.PADMap[t],a=n&&n.fid,o=i&&i.fid,s=n&&n.gId,l=i&&i.gId;if(!(a&&o&&r&&r[a]&&r[o])){Eo.reportError(new Error("Error in ratLineMgr.getWeight()"));return 0}var c=r[a].PAD[s],d=r[o].PAD[l];if(!c||!d){Eo.reportError(new Error("Error in ratLineMgr.getWeight()"));return 0}return(c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y)};Qo._doPrim=function(e){var t,r=0,n=0;if(0===Qo.graph.length)return!1;if(Qo.nodeCount<2){if(!Qo.realRatLineArr[e])return!1;for(r=0,t=Qo.realRatLineArr[e].length;r<t;r++)v(d(Qo.realRatLineArr[e][r].gId));return!1}var i=[];for(r=1;r<Qo.nodeCount;r++)i.push(!1);i[0]=!0;var a,o;Qo.ratLineArr[e]=[];for(;n<Qo.nodeCount-1;){var s=Number.MAX_VALUE;r=0;for(;r<Qo.nodeCount;)if(i[r]){for(var l=0;l<Qo.nodeCount;++l)if(!i[l]&&s>Qo.graph[r][l]){s=Qo.graph[r][l];a=r;o=l}++r}else++r;i[o]=!0;var c={from:Qo.PADMap[a],to:Qo.PADMap[o],weight:s,bTracked:!1};Qo._insertOneRatLine(e,c);n++}};Qo._lineInVertexs=function(e,t){return e&&t&&t.from&&t.to&&t.from.gId in e&&t.to.gId in e};Qo._insertOneRatLine=function(e,t){Qo.ratLineArr[e]||(Qo.ratLineArr[e]=[]);Qo.ratLineArr[e].push(t)};Qo.buildAllNet=function(){var e;for(var t in Qo.realRatLineArr)if(S(Qo.realRatLineArr,t)&&D(Qo.realRatLineArr[t]))for(i=0;i<Qo.realRatLineArr[t].length;i++){e=d(Qo.realRatLineArr[t][i].gId);"RATLINE"===Z(e)&&v(d(Qo.realRatLineArr[t][i].gId))}Qo.realRatLineArr={};var r=Fo.getAllNetName();Qo.buildGroupNets(r)};Qo.buildGroupNets=function(e){for(var t=0,r=e.length;t<r;t++)e[t]&&Qo.buildOneNet(e[t],!0)};Qo._cachedNets={};Qo.buildOneNet=function(e,t){if(e){if(Is==ao.PCBLIB)return!1;(new Date).getTime();if(!0===t){Qo._createGraph(e);if(!1===Qo._doPrim(e))return!1}else{var r=Qo.ratLineArr[e];r&&r.length>0&&r.forEach(function(e){e.bTracked=!1})}var n=So.buildOneNet(e);for(var i in n)if(S(n,i)){var a=n[i],o=0;for(var s in a)S(a,s)&&o++;if(o>=2){var l=Qo.ratLineArr[e];for(var c in l)S(l,c)&&Qo._lineInVertexs(a,l[c])&&!1===l[c].bTracked&&(l[c].bTracked=!0)}}Qo._createRealRatLinesOfOneNet(e)}};Qo._createRealRatLinesOfOneNet=function(e){var t=[],r=Qo.realRatLineArr[e]||[],n=Qo.ratLineArr[e];if(!n)return!1;for(var i,a,o,s,l,c,p,h,u,f,g=Fo.gJsonCache.FOOTPRINT,y=0;y<n.length;y++){c=n[y];if(c&&!c.bTracked&&c.from&&c.to){p=c.from.fid;h=c.to.fid;u=c.from.gId;f=c.to.gId;if(p&&h&&u&&f&&g[p]&&g[h]&&g[p].PAD&&g[h].PAD){i=g[p].PAD[u];a=g[h].PAD[f];if(i&&a){s=null;l=null;for(;!s&&r.length;){l=r.pop();s=l&&l.gId&&d(l.gId)}if(s){o=l.gId;m(s,{x1:i.x,x2:a.x,y1:i.y,y2:a.y})}else{o=Eo.newId();props={id:o,stroke:Fo.gJsonCache.layers[io.RATLINES].color,fill:"none",x1:i.x,x2:a.x,y1:i.y,y2:a.y,net:e,c_shapetype:"line",layerid:io.RATLINES,class:"events-none"};s=zt("line",props);Qo._appendRatLineElement(s)}t.push({gId:o,dataId:y})}}}}for(var x;r.length;){l=r.pop();x=d(l.gId);if("RATLINE"===Z(x)){s=l&&l.gId&&d(l.gId);s&&v(s)}}Qo.realRatLineArr[e]=t};Qo.buildRatLinesOfPCBLib=function(e){var t;if(e&&(e.tagName||[0])){if(e[0]&&e[0].tagName){t=Sn(e);Fi(e[0])}else{if(!e.tagName)return;t=Sn([e]);Fi(e)}t&&t.length&&Qo.buildGroupNets(t)}};Qo.highlightNets=function(e,t){for(var r=t?"highlight-h":"highlight",n=0;n<e.length;n++){var i=e[n],a=Qo.realRatLineArr[i];if(a)for(var o=0;o<a.length;o++)g(d(a[o].gId),r)}};Qo.cancelHighlightNets=function(e){for(var t=e?"highlight-h":"highlight",r=p("line."+t,Ka),n=0;n<r.length;n++)y(r[n],t)};Qo.lastHighlightNet="";Qo.historyHandler=function(){Qo.hasHighlightedNets("highlight-h")||Qo.hasHighlightedNets("selected-h")?Wn(Qo.lastHighlightNet,{scroll:!1,fromHotKey:!0}):gn("selected-h")};Qo.hasHighlightedNets=function(e){e=e||"highlight";return p("."+e,Ka).length};Qo.findRatLineByPos=function(e,t,r){if(!oi(r)||Is==ao.PCBLIB)return!1;var n=Fo.ifFind(e,t,"",r,"ALL");return n&&n.net?So.findRatLine(n.net,n.gId,e,t):void 0};Qo.isRoutedOfOneNet=function(e){var t=!0;if(S(Qo.ratLineArr,e))for(var r,n=Qo.ratLineArr[e],i=0,a=n.length;i<a;i++){r=n[i];if(r&&!r.bTracked){t=!1;break}}return t};Qo.connect=function(e,t){var r=d(e),n=d(t);if(!r||!n)return!1;var i=V(m(r,"net")||""),a=V(m(n,"net")||""),o=i,s=[];if(a||i)if(a&&i)if(a==i&&a);else{var l=Qo.mergeNets(i,a);if(!1===l)return!1;l instanceof Array&&(s=l)}else if(a){o=a;m(r,"net",a);Fo.updateOne(r.parentNode)}else{m(n,"net",o);Fo.updateOne(n.parentNode)}else{o="N$"+ ++ko;m(r,"net",o);m(n,"net",o);Fo.updateOne(r.parentNode);Fo.updateOne(n.parentNode)}Qo.buildOneNet(o,!0);if(a==i&&a)return"";i!=o&&s.unshift([e,i,o]);a!=o&&s.unshift([t,a,o]);return s};Qo.mergeNets=function(e,t,r){var n=sr("i18nTransfer",[{text:"Are you sure merge net {0} and net {1}?",args:[e,t]}]);if(!1!==r&&!parent.confirm(n))return!1;var i,a,o=Fo.gJsonCache.SIGNALS[t]||[],s=e,l=null,c=[];for(i=0,a=o.length;i<a;i++)if(o[i]){l=d(o[i].gId);c.push([l.id,m(l,"net")||"",s]);m(l,"net",s);l.parentNode&&"g1"==l.parentNode.id?Fo.updateOne(l):"g"==l.tagName&&"FOOTPRINT"==Z(l.parentNode)&&Fo.updateOne(l.parentNode)}delete Fo.gJsonCache.SIGNALS[t];delete Qo.ratLineArr[t];if(Qo.realRatLineArr[t])for(i=0,a=Qo.realRatLineArr[t].length;i<a;i++)v(d(Qo.realRatLineArr[t][i].gId));return c};Qo.removeAllRatline=function(){function e(e){v(d(e.gId))}for(var t in Qo.realRatLineArr)S(Qo.realRatLineArr,t)&&Qo.realRatLineArr[t].forEach(e);Qo.ratLineArr={};Qo.realRatLineArr={};Qo.graph=[];Qo.nodeCount=0;Qo.PADMap=[];Qo.layer_ratline_end=null};Qo._appendRatLineElement=function(e){var t=Qo.layer_ratline_end;if(!t){t=d("layer_ratline_end");Qo.layer_ratline_end=t}Ka.insertBefore(e,t)};So.ini=function(){So.currentNet=1;So.nodes={};So.nets={};So.routedGroup={};So.signals={}};So.createNewNet=function(){return So.currentNet++};So.buildOneNet=function(e){if(So._solveOneNet(e))return So.createRoutedGroup()};So.findRatLine=function(e,t,r,n){if(So._solveOneNet(e)){var i,a,o,s=null,l=!1;for(o in So.nets)if(S(So.nets,o)){var c=So.nets[o];l=!1;s={};for(i=0,a=c.length;i<a;i++)if(c[i]){var p=c[i].obj;p&&p.gId==t&&(l=!0);p&&"PAD"==p.cmd&&p.fid&&(s[p.gId]=p)}if(l)break}if(l){var h,u=Qo.ratLineArr[e]||[],f={};for(i=0,a=u.length;i<a;i++){h=u[i];if(h&&!h.bTracked){h.from.gId in s&&(f[h.to.gId]=1);h.to.gId in s&&(f[h.from.gId]=1)}}var g=1e10,y=null;for(o in f)if(S(f,o)){var v=d(o),x=m(v.querySelectorAll(":not([c_padid]):not(title)")[1],"cx"),C=m(v.querySelectorAll(":not([c_padid]):not(title)")[1],"cy"),L=(x-r)*(x-r)+(C-n)*(C-n);if(L<g){y=o;g=L}}if(y){var _=-1,P=0;for(i=0,a=u.length;i<a;i++){h=u[i];if(h&&!h.bTracked){if(h.from.gId==y&&h.to.gId in s){_=i;P=2;break}if(h.to.gId==y&&h.from.gId in s){_=i;P=1;break}}}if(_>-1){var A=Qo.realRatLineArr[e]||[];for(i=0,a=A.length;i<a;i++){var b=A[i];if(b&&b.dataId==_)return[d(b.gId),P]}}}}}};So._getShapeOfElement=function(e,t){var r="";switch(t){case"TRACK":r="line";break;case"ARC":r="arc";break;case"CIRCLE":r="circle";break;case"PAD":switch(e.shape){case"ELLIPSE":r="circle";break;case"RECT":r="polygon";break;case"OVAL":r="line";break;case"POLYGON":r="polygon"}break;case"VIA":r="circle";break;case"COPPERAREA":r=e.arcParams?"arc":e.pointArr&&e.pointArr.length?"line":"polygon";break;case"SOLIDREGION":r="polygon"}return r};So._getConnecttionDistance=function(e,t){var r,n=0;switch(t){case"TRACK":case"ARC":n=e.strokeWidth/2;break;case"CIRCLE":r=e.r?e.r:e.centerParam?e.centerParam.rx:0;n=e.strokeWidth/2+r;break;case"PAD":switch(e.shape){case"ELLIPSE":r=e.width/2;n=r;break;case"RECT":n=0;break;case"OVAL":n=Math.min(e.width,e.height)/2;break;case"POLYGON":n=0}break;case"VIA":n=e.diameter/2;break;case"COPPERAREA":n=e.pointArr&&e.pointArr.length||e.arcParams?e.strokeWidth/2:0;break;case"SOLIDREGION":n=0}return n};So._getMethodByTwoShape=function(e,t){return e<t?e+"To"+t:t+"To"+e};So._getDistanceMethods={lineToline:function(e,t,r,n){var i,a;i=e.pointArr2?e.pointArr2:e.pointArr;a=r.pointArr2?r.pointArr2:r.pointArr;return Ko._distanceBetweenSegments(i[0],i[1],a[0],a[1]).d},arcToline:function(e,t,r,n){var i,a,o;if("arc"==t){i=e;a=r}else{i=r;a=e}o=a.pointArr2?a.pointArr2:a.pointArr;return Ko._checkClearanceBetweenArcAndLine(i,o[0],o[1]).d},circleToline:function(e,t,r,n){var i,a,o,s,l;if("circle"==t){i=e;a=r}else{i=r;a=e}if(i.centerParam){s=i.centerParam.cx;l=i.centerParam.cy}else if(i.holeR||"ELLIPSE"==i.shape){s=i.x;l=i.y}else{if(!i.r)return Number.MAX_VALUE;s=i.cx;l=i.cy}o=a.pointArr2?a.pointArr2:a.pointArr;return pe({x:s,y:l},o[0],o[1]).d},lineTopolygon:function(e,t,r,n){var i,a,o,s={d:Number.MAX_VALUE};if("line"==t){a=e;i=r}else{a=r;i=e}o=a.pointArr2?a.pointArr2:a.pointArr;if(i.pointArr&&i.pointArr.length){if(ls.isPointInPolygon(o[0],i.pointArr)||ls.isPointInPolygon(o[1],i.pointArr))return 0;s=Ko._getDistanceBetweenSegmentWithPolygon(i.pointArr,o[0],o[1])}else i.polygonArr&&(s=Ko._getDistanceBetweenSegmentWithCopperAreaPolygon(i.polygonArr,o[0],o[1]));return s.d},arcToarc:function(e,t,r,n){return Ko._checkClearanceBetweenArcAndArc(e,r).d},arcTocircle:function(e,t,r,n){var i,a,o,s;if("arc"==t){a=e;i=r}else{a=r;i=e}if(i.centerParam){o=i.centerParam.cx;s=i.centerParam.cy}else if(i.holeR||"ELLIPSE"==i.shape){o=i.x;s=i.y}else{if(!i.r)return Number.MAX_VALUE;o=i.cx;s=i.cy}return Ko._checkClearanceBetweenArcAndPoint(a,{x:o,y:s}).d},arcTopolygon:function(e,t,r,n){var a,o,s,c,d={d:Number.MAX_VALUE};if("arc"==t){a=e;o=r}else{a=r;o=e}if(o.pointArr&&o.pointArr.length){c=Ko._polygon2Segments(o.pointArr);s=d;for(i=0,l=c.length;i<l;i++){d=Ko._checkClearanceBetweenArcAndLine(a,c[i].fromP,c[i].toP);d.d<s.d&&(s=d)}d=s}else o.polygonArr&&(d=Ko._getDistanceBetweenArcWithCopperAreaPolygon(o.polygonArr,a));return d.d},circleTocircle:function(e,t,r,n){var i,a,o,s;if(e.centerParam){i=e.centerParam.cx;a=e.centerParam.cy}else if(e.holeR||"ELLIPSE"==e.shape){i=e.x;a=e.y}else{if(!e.r)return Number.MAX_VALUE;i=e.cx;a=e.cy}if(r.centerParam){o=r.centerParam.cx;s=r.centerParam.cy}else if(r.holeR||"ELLIPSE"==r.shape){o=r.x;s=r.y}else{if(!r.r)return Number.MAX_VALUE;o=r.cx;s=r.cy}return fe(i,a,o,s)},circleTopolygon:function(e,t,r,n){var a,o,s,c,d,p,h={d:Number.MAX_VALUE};if("circle"==t){a=e;o=r}else{a=r;o=e}if(a.centerParam){s=a.centerParam.cx;c=a.centerParam.cy}else if(a.holeR||"ELLIPSE"==a.shape){s=a.x;c=a.y}else{if(!a.r)return Number.MAX_VALUE;s=a.cx;c=a.cy}if(o.pointArr&&o.pointArr.length){if(ls.isPointInPolygon({x:s,y:c},o.pointArr))return 0;d=Ko._polygon2Segments(o.pointArr);p=h;for(i=0,l=d.length;i<l;i++){h=pe({x:s,y:c},d[i].fromP,d[i].toP);h.d<p.d&&(p=h)}h=p
}else o.polygonArr&&(h=Ko._getDistanceBetweenPointWithCopperAreaPolygon(o.polygonArr,{x:s,y:c}));return h.d},polygonTopolygon:function(e,t,r,n){var a,o,s,c,d={d:Number.MAX_VALUE};if(e.pointArr&&e.pointArr.length)a=e.pointArr;else{if(!e.polygonArr)return Number.MAX_VALUE;a=e.polygonArr[0][0]}if(r.pointArr&&r.pointArr.length)o=r.pointArr;else{if(!r.polygonArr)return Number.MAX_VALUE;o=r.polygonArr[0][0]}if(ls.isPointInPolygon(a[0],o)||ls.isPointInPolygon(o[0],a))return 0;s=Ko._polygon2Segments(a);c=d;for(i=0,l=s.length;i<l;i++){d=Ko._getDistanceBetweenSegmentWithPolygon(o,s[i].fromP,s[i].toP);d.d<c.d&&(c=d)}d=c;return d.d}};So._getFid=function(e,t){for(var r=Fo.gJsonCache.SIGNALS[e],n=0;n<r.length;n++)if(r[n].gId==t)return r[n].fid||"";return""};So._solveOneNet=function(e){So.ini();var t=Fo.gJsonCache.SIGNALS[e];if(!t||!e)return!1;var r,n,i,a,o,s,l,c,d,p,h,u,f,g,y,v,x,m,C,L,_,P,A,b,E,O,I;for(r=0;r<t.length;r++){d=t[r].cmd;l=Fo.getElementByObj(t[r]);if(l){s=l.layerid;m=So._getConnecttionDistance(l,d);h=So._getShapeOfElement(l,d);if("COPPERAREA"!=d){b=l.gId;_=So.nodes[b];if(!_){A=So.createNewNet();So.nodes[b]=A;So.nets[A]=[{layerid:s,obj:Eo.extend({},l,{cmd:d,gId:b,fid:So._getFid(e,b)})}]}if("PAD"==d&&s==io.ALL||"VIA"==d)for(I in lo.copperNetRelation.planeZone)if(S(lo.copperNetRelation.planeZone,I)&&lo.copperNetRelation.planeZone[I][b]&&lo.copperNetRelation.planeZone[I][b].net==e){b=l.gId;_=So.nodes[b];E=I;f=Fo.gJsonCache.PLANEZONE[E];if(f){p="PLANEZONE";P=So.nodes[E];if(P){if(_!=P){for(i=0;i<So.nets[_].length;i++){I=So.nets[_][i].obj.gId;So.nodes[I]=P}So.nets[P]=So.nets[P].concat(So.nets[_]);delete So.nets[_]}}else{A=_;So.nodes[E]=A;So.nets[A].push({layerid:f.layerid,obj:Eo.extend({},f,{cmd:p,gId:E})})}}}g=es.createNode(l,d);if(g){a=g.treeNodes.length;if("CIRCLE"==d){g.treeNodes.splice(1,a);a--}for(o=0;o<a;o++)if(es.trees[s]){y=g.treeNodes[o];if(y.type==d){if(s==io.ALL){v=[];for(n=0;n<es.signalLayers.length;n++){O=es.signalLayers[n];if(es.trees[O]){x=es.trees[O].search(y);x=x.filter(function(e){return e.node.gId!=l.gId});v=v.concat(x)}}}else v=es.trees[s].search(y);for(n=0;n<v.length;n++){p=v[n].type;f=v[n].node;if(f.gId!=l.gId&&f.net==e&&!f.isCircle){u=So._getShapeOfElement(f,p);c=So._getMethodByTwoShape(h,u);if(So._getDistanceMethods[c]){b=l.gId;E=f.gId;"COPPERAREA"==p&&(E=E+"_"+f.copperAreaId);_=So.nodes[b];P=So.nodes[E];if(!P||_!=P){C=m+So._getConnecttionDistance(f,p);L=So._getDistanceMethods[c](y.node,h,f,u);if(!(L>C))if(P){if(_!=P){for(i=0;i<So.nets[_].length;i++){I=So.nets[_][i].obj.gId;So.nodes[I]=P}So.nets[P]=So.nets[P].concat(So.nets[_]);delete So.nets[_]}}else{A=_;So.nodes[E]=A;So.nets[A].push({layerid:f.layerid,obj:Eo.extend({},f,{cmd:p,gId:E,fid:So._getFid(e,E)})})}}}}}}}}}}}return!0};So.createRoutedGroup=function(){for(var e in So.nets)if(S(So.nets,e)){So.routedGroup[e]={};for(var t=So.nets[e],r=0,n=t.length;r<n;r++)if(t[r]){var i=t[r].obj;i&&"PAD"==i.cmd&&i.fid&&(So.routedGroup[e][i.gId||i.gid]=1)}}return So.routedGroup};Ko.CirclePolygonDeviation=.01;Ko.init=function(){Ko._rules=Fo.gJsonCache.DRCRULE||{};Ko._errorA=[];Ko._padBaseShapeCache={};Ko._errorgIdList=[]};Ko.doDRC=function(e){if(!e||!e.callback){Ko._errorgIdList=[];Ko.hideErrorSymbols();Ko._testTrackSize();Ko._clearPadBaseShapeCache();Ko._testHole();Ko._testBoardOutline();Ko._testClearance();return Ko._errorTree()}Ko.hideErrorSymbols();Ko._doClearanceDrcInWebWorker(e)};Ko.doRealtimeDRC=function(e,t){Ko._errorgIdList=[];Ko.hideRealtimeDRCError();if(e&&Fo.gJsonCache.DRCRULE&&Fo.gJsonCache.DRCRULE.isRealtime){var r,n=Z(e);if(n){t&&_s[n]?r=_s[n](e):Fo.gJsonCache[n]&&(r=Fo.gJsonCache[n][e.id]);if(r&&("SOLIDREGION"!=n||"cutout"!=r.type&&"npth"!=r.type)){Ko._errorA=[];var i=[];"FOOTPRINT"==n?Ko.checkedKeys.forEach(function(e){for(var t in r[e])S(r[e],t)&&oi(r[e][t].layerid)&&i.push(es.createNode(r[e][t],e))}):oi(r.layerid)&&i.push(es.createNode(r,n));Ko._clearPadBaseShapeCache();i.forEach(function(e){if(e&&e.treeNodes&&e.treeNodes.length){Ko._testHoleSize(e.treeNodes[0]);Ko._testOneNode(e.treeNodes,e.layerid)}});Ko._showRealtimeDRCError(Ko._errorA);return Ko._errorA}}}};Ko._createXPathErrorFlag=function(e,t){var r=t||2;return"M"+(+e.x-r)+" "+(+e.y-r)+"L"+(+e.x+r)+" "+(+e.y+r)+"M"+(+e.x+r)+" "+(+e.y-r)+"L"+(+e.x-r)+" "+(+e.y+r)};Ko._showRealtimeDRCError=function(e){var t=d("gDrcDots");if(t){for(var r,n=t.childNodes,i=n.length,a=0,o=e.length;a<o;a++)if(a<i){r=n[a];m(r,{d:Ko._createXPathErrorFlag(e[a].pos),display:"inline","stroke-width":1.2/wo})}else{r=n[0].cloneNode(!0);m(r,{d:Ko._createXPathErrorFlag(e[a].pos),display:"inline","stroke-width":1.2/wo});t.appendChild(r)}for(;a<i;a++){r=n[a];m(r,{display:"none"})}}};Ko.hideRealtimeDRCError=function(){var e=d("gDrcDots");if(e)for(var t=e.childNodes,r=t.length,n=0;n<r;n++)m(t[n],{display:"none"})};Ko._addError=function(e){Ko._hasError=!0;for(var t=!1,r=0,n=Ko._errorA.length;r<n;r++)if(Ko._errorA[r].pos.x==e.pos.x&&Ko._errorA[r].pos.y==e.pos.y&&("trackLength"!=e.errorStr&&"holeOuterSize"!=e.errorStr||Ko._errorA[r].errorStr==e.errorStr)){t=!0;break}isNaN(e.pos.x)||isNaN(e.pos.y);t||Ko._errorA.push(e)};Ko._errorTree=function(){for(var e=[],t=0,r=Ko._errorA.length;t<r;t++)e.push({text:Ko._errorA[t].errorStr,id:t,checked:!0,iconCls:"icon-no"});return{treeData:e,errorData:Ko._errorA}};Ko._markError=function(e){if(e){yn(un());for(var t=0;t<e.ids.length;t++)if(e.ids[t]){var r=d(e.ids[t]);r&&u(r,"selected",!0)}e.pos.x=+e.pos.x;e.pos.y=+e.pos.y;Bt(e.pos.x,e.pos.y);Ko.showErrorSymbols(e.pos)}};Ko.showErrorSymbols=function(e){var t=Ko._createXPathErrorFlag(e,5);m(d("gDrcDots").childNodes[0],{d:t,display:"inline","stroke-width":2/wo})};Ko.hideErrorSymbols=function(){m(d("gDrcDots").childNodes[0],{display:"none","stroke-width":1.2/wo})};Ko._doClearanceDrcInWebWorker=function(e){var t=e.callback,r=e.progressCallback,n=function(){var e={},t=["ARC","PAD","VIA","SOLIDREGION","COPPERAREA","PLANEZONE"],r=function(r){for(var n=0;n<t.length;n++){var i=r[t[n]];for(var a in i)S(i,a)&&(e[a]=Eo.svg.getBBox(d(a)))}};r(Fo.gJsonCache);var n=Fo.gJsonCache.FOOTPRINT;for(var i in n)S(n,i)&&r(n[i]);return e}();Do();Bo.onmessage=function(e){switch(e.data.type){case"testClearanceDone":t(e.data.data);break;case"progress":r&&r(e.data.data)}};Bo.onerror=function(e){};Bo.postMessage({type:"testClearance",data:{trees:es.trees,nodeIndex:es.nodeIndex,bboxCache:n,gJsonCache:Fo.gJsonCache,LAYERTYPE:io,gVars:O(lo),doctype:Is,DOCTYPE:ao},dependence:[d("pcb.drcWorker.main").value,d("pcb.drcWorker.dependence").value]})};Ko._testTrack2Track=function(){var e=Ko._trackA.length;if(e>=2)for(var t=0;t<e;t++)for(var r=t+1;r<e;r++)Ko._track2Track(Ko._trackA[t],Ko._trackA[r])};Ko._testTrackSize=function(){var e=[];for(var t in es.nodeIndex)if(S(es.nodeIndex,t)){var r=es.nodeIndex[t].treeNodes;if(!r[0])continue;var n,i=r[0].type,a=r[0].node,o=Ai(a.net).trackWidth,s=Ai(a.net).trackLength;if(!oi(a.layerid))continue;if("TRACK"==i||"ARC"==i){Eo.formatLengthSave(a.strokeWidth,{decimalPlaces:3})<Eo.formatLengthSave(o,{decimalPlaces:3})&&Ko._addError({errorStr:"trackWidth",ids:[t],net:[a.net],drcValue:o,currentValue:a.strokeWidth,pos:a.pointArr[0],type:[a.isCircle?"CIRCLE":i]});var l=ls.getNetLengthAndIds(a.net);n=l.length;if(-1===e.indexOf(a.net)&&s&&Eo.formatLengthSave(n,{decimalPlaces:3})>Eo.formatLengthSave(s,{decimalPlaces:3})){e.push(a.net);Ko._addError({errorStr:"trackLength",ids:l.ids,net:[a.net],drcValue:s,currentValue:n,pos:a.pointArr[0],type:[a.isCircle?"CIRCLE":i]})}}}};Ko._testHole=function(){var e,t,r=[];for(t in es.nodeIndex)if(S(es.nodeIndex,t)){var n=es.nodeIndex[t].treeNodes,i=n[0]&&n[0].type;if("PAD"==i||"VIA"==i){e=Ko._testHoleSize(n[0]);if(e){e.type=i;r.push(e)}}}Fo.getAllObjsOf("HOLE",!0).forEach(function(t){e=Ko._checkHole(t);if(e){e.type="HOLE";r.push(e)}});Ko._testHole2Hole(r)};Ko._checkHole=function(e){var t=Ai(e.net),r=t.viaHoleD,n=t.viaHoleDiameter,i=(r||1.6)/2,a=n,o=parseFloat(e.holeR),s=parseFloat(e.diameter);if(o>.01){Eo.formatLengthSave(o,{decimalPlaces:3})<Eo.formatLengthSave(i,{decimalPlaces:3})-.001&&Ko._addError({errorStr:"holeSize",ids:[e.gId],net:e.net,drcValue:r,currentValue:2*o,pos:{x:+e.x,y:+e.y}});Eo.formatLengthSave(s,{decimalPlaces:3})<Eo.formatLengthSave(a,{decimalPlaces:3})&&Ko._addError({errorStr:"holeOuterSize",ids:[e.gId],net:e.net,drcValue:n,currentValue:s,pos:{x:+e.x,y:+e.y}});return e}return null};Ko._testHoleSize=function(e){var t=e.type,r=e.node;return"PAD"==t||"VIA"==t?Ko._checkHole(r):null};Ko._testOneNode=function(e,t){if(e&&e.length)for(var r=t==io.ALL?es.signalLayers:[t],n=0,i=e.length;n<i;n++){var a=e[n],o=a.node.layerid;if("COPPERAREA"!=a.type&&"PLANEZONE"!=a.type)for(var s=0,l=r.length;s<l;s++){t=r[s];if(es.trees[t]&&(o==io.ALL||o==io.BOARDOUTLINE||o==t))for(var c=es.trees[t].search(a),d=0,p=c.length;d<p;d++){var h=a.node.gId>c[d].node.gId?a.node.gId+"_"+c[d].node.gId:c[d].node.gId+"_"+a.node.gId;if(a.node.gId!=c[d].node.gId&&-1==Ko._errorgIdList.indexOf(h)){if(function(e,t){if(!isNaN(+e)){if(e==io.ALL&&t)return!0;if(Fo.gJsonCache.layers[e]&&"Plane"===Fo.gJsonCache.layers[e].type&&Fo.gJsonCache.layers[e].config)return!0}return!1}(t)){if("TRACK"===a.type||"TRACK"===c[d].type||"ARC"===a.type||"ARC"===c[d].type)continue;if("PLANEZONE"===a.type&&"none"===a.node.fillStyle||"PLANEZONE"===c[d].type&&"none"===c[d].node.fillStyle)continue}Ko._testObj2Obj(a,c[d])}}}}};Ko.checkNodeForError=function(e,t,r){var n=e.id,i=m(e,"layerid");if(t)var a=t;else a=es.nodeIndex[n]&&es.nodeIndex[n].treeNodes;if(!a||!a.length||void 0===i)return null;for(var o=i==io.ALL?es.signalLayers:[i],s=0,l=a.length;s<l;s++)for(var c=a[s],d=c.node.layerid,p=0,h=o.length;p<h;p++){i=o[p];if(es.trees[i]&&(d==io.ALL||d==i)){var u=es.trees[i].search(c);Ko._hasError=!1;for(var f=0,g=u.length;f<g;f++){var y=u[f].type;isCheck=r&&("PAD"==y||"VIA"==y);Ko._testObj2Obj(c,u[f],isCheck);if(Ko._hasError)return{hasError:!0,errObj:Eo.extend({},Ko._errorA[0])}}}}return{hasError:!1,errObj:null}};Ko._testClearance=function(){for(var e in es.nodeIndex)S(es.nodeIndex,e)&&oi(es.nodeIndex[e].layerid)&&Ko._testOneNode(es.nodeIndex[e].treeNodes,es.nodeIndex[e].layerid)};Ko._convertItem=function(e,t){var r=null;if("ARC"==t||"TRACK"==t||"PAD"==t||"RECT"==t||"TEXT"==t||"SVGNODE"==t)return e;if("VIA"==t)r={gId:e.gId,holeR:e.holeR,net:e.net,layerid:io.ALL,width:e.diameter,height:e.diameter,x:e.x,y:e.y,shape:"ELLIPSE"};else if("HOLE"==t)r={gId:e.gId,holeR:e.holeR,net:e.net,layerid:io.ALL,width:2*e.holeR,height:2*e.holeR,x:e.x,y:e.y,shape:"ELLIPSE"};else if("SOLIDREGION"==t){var n=es.points2bbCoordinates(e.pointArr),i=n.minX+(n.maxX-n.minX)/2,a=n.minY+(n.maxY-n.minY)/2;r={gId:e.gId,layerid:e.layerid,holeR:0,net:e.net,pointArr:D(e.pointArr)&&e.pointArr.length>0?e.pointArr:ui(e.pathStr),x:i,y:a,shape:"RECT"}}else if("COPPERAREA"==t){if(!e.polygonArr)return e;n=es.points2bbCoordinates(e.polygonArr[0][0]);i=n.minX+(n.maxX-n.minX)/2,a=n.minY+(n.maxY-n.minY)/2;r={gId:e.gId,layerid:e.layerid,clearanceWidth:e.clearanceWidth,holeR:0,net:e.net,polygonArr:e.polygonArr,x:i,y:a,shape:"RECT"}}else{if("PLANEZONE"!=t)return null;n=Eo.svg.getBBox(d(e.gId));i=n.x+n.width/2,a=n.y+n.height/2;r={gId:e.gId,layerid:e.layerid,clearanceWidth:0,holeR:0,net:e.net,polygonArr:e.polygonArr,x:i,y:a,shape:"RECT"}}return r};Ko._testObj2Obj=function(e,t,r){function n(e,t){return"TRACK"==e||"ARC"==e||"SVGNODE"==e?"TRACK":"PAD"==e||"VIA"==e||"HOLE"==e||"SOLIDREGION"==e||"PLANEZONE"==e||"RECT"==e||"TEXT"==e?"PAD":"COPPERAREA"==e?t.node&&t.node.polygonArr?"PAD":"TRACK":""}var i=e.type,a=Ko._convertItem(e.node,i),o=t.type,s=Ko._convertItem(t.node,o),l=n(i,e),c=n(o,t);if(a&&s){a.type=i;s.type=o;a.gId==s.gId||a.net==s.net&&!0!==r||(Fo.gJsonCache.DRCRULE.checkObjectToCopperarea||"COPPERAREA"!=i&&"COPPERAREA"!=o)&&("COPPERAREA"==i&&"COPPERAREA"==o||("PLANEZONE"!=i&&"PLANEZONE"!=o||"PAD"==l||"PAD"==c)&&("TRACK"==l&&"TRACK"==c?Ko._track2Track(a,s):"PAD"==l&&"PAD"==c?Ko._testPad2Pad(a,s,r):"TRACK"==l?Ko._testTrack2Pad(a,s):Ko._testTrack2Pad(s,a)))}};Ko._testBoardOutline=function(){function e(e,t){var r=Fo.getAllObjsOf(e,!0,null,t),n=[];r.forEach(function(t){if("none"!=t.display){t.layerid==io.BOARDOUTLINE&&(t.net="$BoardOutlineNet");n=n.concat(es.createNode(t,e))}});return n}var t=e("TRACK",[io.BOARDOUTLINE]).concat(e("ARC",[io.BOARDOUTLINE]));t.forEach(function(e){Ko._testOneNode(e.treeNodes,io.ALL)});if(Fo.gJsonCache.DRCRULE.itemBoardOutlineClearance){var r,n,i=[io.TOPSILKLAYER,io.BOTTOMSILKLAYER,io.TOPPASTERLAYER,io.BOTTOMPASTERLAYER,io.TOPSOLDERLAYER,io.BOTTOMSOLDERLAYER,io.TOPASSEMBLY,io.BOTTOMASSEMBLY,io.MECHANICAL],a=e("TRACK",i).concat(e("ARC",i)).concat(e("CIRCLE",i)).concat(e("DIMENSION",i)).concat(e("PROTRACTOR",i)).concat(e("RECT",i.concat([io.TOPLAYER,io.BOTTOMLAYER]))).concat(e("SVGNODE",i)).concat(e("TEXT",i.concat([io.TOPLAYER,io.BOTTOMLAYER]))),o=rbush(9);for(r=0;r<a.length;r++)if(a[r].treeNodes)for(n=0;n<a[r].treeNodes.length;n++)o.insert(a[r].treeNodes[n]);t.forEach(function(e){var t,r,n,i,a,s,c,d,p,h=+Fo.gJsonCache.DRCRULE.itemBoardOutlineClearance;for(t=0;t<e.treeNodes.length;t++){n=e.treeNodes[t];a=n.type;s=n.node;i=o.search(n);for(r=0;r<i.length;r++)if("DOT"!=a){c=i[r].node;if("DOT"!=i[r].type&&-1===Ko._errorgIdList.indexOf(c.gId)){goodDistance=h;c.strokeWidth&&(goodDistance+=c.strokeWidth/2);if("HOLE"==i[r].type){goodDistance=Math.max(h,c.holeR);d="ARC"==a?Ko._checkClearanceBetweenArcAndPoint(s,{x:c.x,y:c.y}):pe({x:c.x,y:c.y},s.pointArr[0],s.pointArr[1])}else if("RECT"==i[r].type){segs=Ko._polygon2Segments([{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height},{x:c.x,y:c.y}]);p=d||{d:Number.MAX_VALUE};for(t=0,l=segs.length;t<l;t++){d="ARC"==a?Ko._checkClearanceBetweenArcAndLine(s,segs[t].fromP,segs[t].toP):Ko._getDistanceBetweenSegmentWithPolygon(s.pointArr,segs[t].fromP,segs[t].toP);d&&d.d<p.d&&(p=d)}d=p}else d="ARC"==i[r].type?"ARC"==a?Ko._checkClearanceBetweenArcAndArc(s,c):Ko._checkClearanceBetweenArcAndLine(c,s.pointArr[0],s.pointArr[1]):"ARC"==a?Ko._checkClearanceBetweenArcAndLine(s,c.pointArr[0],c.pointArr[1]):Ko._distanceBetweenSegments(s.pointArr[0],s.pointArr[1],c.pointArr[0],c.pointArr[1]);if(d&&Eo.formatLengthSave(d.d,{decimalPlaces:3})<Eo.formatLengthSave(goodDistance,{decimalPlaces:3})){Ko._addError({errorStr:"obj2Boardoutline",ids:[n.node.gId,i[r].node.gId],type:["BOARDOUTLINE",i[r].isCircle?"CIRCLE":i[r].type],drcValue:h,currentValue:i[r].type,pos:{x:i[r].minX+(i[r].maxX-i[r].minX)/2,y:i[r].minY+(i[r].maxY-i[r].minY)/2}});Ko._errorgIdList.push(c.gId)}}}}})}};Ko._track2Track=function(e,t){if(e.net!=t.net){var r=Math.max(Ai(e.net).clearance,Ai(t.net).clearance),n="track2Track",i=e.type,a=t.type;if(e.layerid==io.BOARDOUTLINE||t.layerid==io.BOARDOUTLINE){if(!Fo.gJsonCache.DRCRULE.itemBoardOutlineClearance)return;n="obj2Boardoutline";r=+Fo.gJsonCache.DRCRULE.itemBoardOutlineClearance||0;e.layerid==io.BOARDOUTLINE&&(i="BOARDOUTLINE");t.layerid==io.BOARDOUTLINE&&(a="BOARDOUTLINE")}if("COPPERAREA"==e.type){r=Math.max(r,e.clearanceWidth);i="COPPERAREA"}if("COPPERAREA"==t.type){r=Math.max(r,t.clearanceWidth);a="COPPERAREA"}e.isCircle&&(i="CIRCLE");t.isCircle&&(a="CIRCLE");var o,s=parseFloat(e.strokeWidth)/2+parseFloat(t.strokeWidth)/2+r;o=("ARC"==e.type||"COPPERAREA"==e.type&&e.arcParams)&&("ARC"==t.type||"COPPERAREA"==t.type&&t.arcParams)?Ko._checkClearanceBetweenArcAndArc(e,t):"ARC"==e.type||"COPPERAREA"==e.type&&e.arcParams?Ko._checkClearanceBetweenArcAndLine(e,t.pointArr[0],t.pointArr[1]):"ARC"==t.type||"COPPERAREA"==t.type&&t.arcParams?Ko._checkClearanceBetweenArcAndLine(t,e.pointArr[0],e.pointArr[1]):Ko._distanceBetweenSegments(e.pointArr[0],e.pointArr[1],t.pointArr[0],t.pointArr[1]);if(Eo.formatLengthSave(o.d,{decimalPlaces:3})<Eo.formatLengthSave(s,{decimalPlaces:3})){Ko._addError({errorStr:n,ids:[e.gId,t.gId],type:[i,a],net:[e.net,t.net],drcValue:r,currentValue:"obj2Boardoutline"==n?"Track":null,pos:o.point});Ko._errorgIdList.push(e.gId>t.gId?e.gId+"_"+t.gId:t.gId+"_"+e.gId)}}};Ko._polygon2Segments=function(e){for(var t=e.length-1,r=[],n=0;n<t;n++)r.push({fromP:e[n],toP:e[n+1]});r.push({fromP:e[t],toP:e[0]});return r};Ko._pad2PadFilter=function(e,t,r){return!e||!t||!(e.net!=t.net||!e.net||!0===r)};Ko._testPad2Pad=function(e,t,r){if(!Ko._pad2PadFilter(e,t,r)){var n,i,a,o=Math.max(Ai(e.net).clearance,Ai(t.net).clearance);if("OVAL"!=e.shape||"OVAL"!=t.shape)if("OVAL"!=e.shape&&"OVAL"!=t.shape||"ELLIPSE"!=e.shape&&"ELLIPSE"!=t.shape||e.shape==t.shape){var s,l,c,d,p;if("COPPERAREA"!=e.type&&"PLANEZONE"!=e.type&&"COPPERAREA"!=t.type&&"PLANEZONE"!=t.type||e.type==t.type){for(var h=Ko._getPadBaseShapes(e),u=Ko._getPadBaseShapes(t),f=0;f<h.length;f++)for(var g=0;g<u.length;g++)if(Ko._isTwoBaseShapesNearerThan(h[f],u[g],o)){Ko._addPad2PadError(e,t);return}}else{if("COPPERAREA"==e.type||"PLANEZONE"==e.type){s=e;l=t}else{s=t;l=e}o=Math.max(s.clearanceWidth,o)-Ko.CirclePolygonDeviation;if("OVAL"==l.shape){n=Math.min(l.width,l.height)/2+o;i=Ko._getDistanceBetweenSegmentWithCopperAreaPolygon(s.polygonArr,l.pointArr2[0],l.pointArr2[1]);i&&Eo.formatLengthSave(i.d,{decimalPlaces:3})<Eo.formatLengthSave(n,{decimalPlaces:3})&&Ko._addPad2PadError(s,l)}else if("ELLIPSE"==l.shape){n=l.width/2+o;i=Ko._getDistanceBetweenPointWithCopperAreaPolygon(s.polygonArr,{x:l.x,y:l.y});i&&Eo.formatLengthSave(i.d,{decimalPlaces:3})<Eo.formatLengthSave(n,{decimalPlaces:3})&&Ko._addPad2PadError(Eo.extend({x:l.x,y:l.y},s),l)}else if("circle"==l.shape){n=l.r/2+o;i=Ko._getDistanceBetweenPointWithCopperAreaPolygon(s.polygonArr,{x:l.x,y:l.y});i&&Eo.formatLengthSave(i.d,{decimalPlaces:3})<Eo.formatLengthSave(n,{decimalPlaces:3})&&Ko._addPad2PadError(s,l)}else if(l.pointArr){c=Ko._polygon2Segments(l.pointArr);a=i;n=o;for(d=0,p=c.length;d<p;d++){i=Ko._getDistanceBetweenSegmentWithCopperAreaPolygon(s.polygonArr,c[d].fromP,c[d].toP);(!a||i.d<a.d)&&(a=i);if(0===a.d)break}i=a;i&&Eo.formatLengthSave(i.d,{decimalPlaces:3})<Eo.formatLengthSave(n,{decimalPlaces:3})&&Ko._addPad2PadError(s,l)}}}else{var y="OVAL"==e.shape?e:t,v="OVAL"==e.shape?t:e,x=Math.min(y.width,y.height)/2,m=v.width/2;n=x+m+o;i=pe({x:v.x,y:v.y},y.pointArr2[0],y.pointArr2[1]);i&&Eo.formatLengthSave(i.d,{decimalPlaces:3})<Eo.formatLengthSave(n,{decimalPlaces:3})&&Ko._addPad2PadError(e,t)}else{n=Math.min(e.width,e.height)/2+Math.min(t.width,t.height)/2+o;i=Ko._distanceBetweenSegments(e.pointArr2[0],e.pointArr2[1],t.pointArr2[0],t.pointArr2[1]);i&&Eo.formatLengthSave(i.d,{decimalPlaces:3})<Eo.formatLengthSave(n,{decimalPlaces:3})&&Ko._addPad2PadError(e,t)}}};Ko._addPad2PadError=function(e,t){var r={x:(+e.x+ +t.x)/2,y:(+e.y+ +t.y)/2},n="pad2Pad",i=Math.max(Ai(e.net).clearance,Ai(t.net).clearance);if("PAD"==e.type&&"VIA"==t.type||"PAD"==t.type&&"VIA"==e.type)n="via2pad";else if("PAD"==e.type&&"SOLIDREGION"==t.type||"PAD"==t.type&&"SOLIDREGION"==e.type)n="pad2solidregion";else if("PAD"==e.type&&"COPPERAREA"==t.type||"PAD"==t.type&&"COPPERAREA"==e.type){n="pad2copperarea";r="COPPERAREA"==t.type?e:t;i=Math.max("COPPERAREA"==t.type?t.clearanceWidth:e.clearanceWidth,i)}else if("PAD"==e.type&&"PLANEZONE"==t.type||"PAD"==t.type&&"PLANEZONE"==e.type){n="pad2PlaneZone";r="PLANEZONE"==t.type?e:t;i=Math.max("PLANEZONE"==t.type?t.clearanceWidth:e.clearanceWidth,i)}else if("SOLIDREGION"==e.type&&"COPPERAREA"==t.type||"SOLIDREGION"==t.type&&"COPPERAREA"==e.type){n="solidregion2copperarea";r="COPPERAREA"==t.type?e:t;i=Math.max("COPPERAREA"==t.type?t.clearanceWidth:e.clearanceWidth,i)}else if("VIA"==e.type&&"VIA"==t.type)n="via2via";else if("VIA"==e.type&&"SOLIDREGION"==t.type||"VIA"==t.type&&"SOLIDREGION"==e.type){n="via2solidregion";r="SOLIDREGION"==t.type?e:t}else if("VIA"==e.type&&"COPPERAREA"==t.type||"VIA"==t.type&&"COPPERAREA"==e.type){n="via2copperarea";r="COPPERAREA"==t.type?e:t;i=Math.max("COPPERAREA"==t.type?t.clearanceWidth:e.clearanceWidth,i)}else if("VIA"==e.type&&"PLANEZONE"==t.type||"VIA"==t.type&&"PLANEZONE"==e.type){n="via2PlaneZone";r="PLANEZONE"==t.type?e:t;i=Math.max("PLANEZONE"==t.type?t.clearanceWidth:e.clearanceWidth,i)}else if("PAD"==e.type&&"RECT"==t.type||"PAD"==t.type&&"RECT"==e.type){n="pad2Rect";r="RECT"==t.type?e:t}Ko._addError({errorStr:n,ids:[e.gId,t.gId],type:[e.type,t.type],net:[e.net,t.net],drcValue:i,pos:r});Ko._errorgIdList.push(e.gId>t.gId?e.gId+"_"+t.gId:t.gId+"_"+e.gId)};Ko._getDistanceBetweenSegmentWithPolygon=function(e,t,r){for(var n=Ko._polygon2Segments(e),i={},a={d:Number.MAX_VALUE},o=0,s=n.length;o<s;o++){i=Ko._distanceBetweenSegments(n[o].fromP,n[o].toP,t,r);i.d<a.d&&(a=i)}return a};Ko._getDistanceBetweenPointWithCopperAreaPolygon=function(e,t){var r={},n={d:Number.MAX_VALUE};if(!D(e))return n;var i,a,o,s,l,c,d,p;for(i=0;i<e.length;i++){o=e[i];for(a=0;a<o.length;a++){s=o[a];l=function(e,t){var r,n,i,a,o=!1,s=0,l=t.length-1,c=+e.x,d=+e.y;for(l;s<t.length;l=s++){r=+t[s].x;n=+t[s].y;i=+t[l].x;a=+t[l].y;n>d!=a>d&&c<(i-r)*(d-n)/(a-n)+r&&(o=!o)}return o}(t,s);if(0===a){if(l){if(1===o.length)return{d:0,point:t};continue}c=Ko._polygon2Segments(s);for(d=0,p=c.length;d<p;d++){r=pe(t,c[d].fromP,c[d].toP);r.d<n.d&&(n=r)}break}if(l){c=Ko._polygon2Segments(s);for(d=0,p=c.length;d<p;d++){r=pe(t,c[d].fromP,c[d].toP);r.d<n.d&&(n=r)}break}if(a===o.length-1)return{d:0,point:t}}}return n};Ko._getDistanceBetweenSegmentWithCopperAreaPolygon=function(e,t,r){function n(e,t){var r,n,i,a,o=!1,s=0,l=t.length-1,c=+e.x,d=+e.y;for(l;s<t.length;l=s++){r=+t[s].x;n=+t[s].y;i=+t[l].x;a=+t[l].y;n>d!=a>d&&c<(i-r)*(d-n)/(a-n)+r&&(o=!o)}return o}var i={},a={d:Number.MAX_VALUE};if(!D(e))return a;var o,s,l,c,d,p;for(o=0;o<e.length;o++){l=e[o];for(s=0;s<l.length;s++){c=l[s];d=n(t,c);p=n(r,c);if(0===s){if(d&&p){if(1===l.length)return{d:0,point:d?r:t};continue}if(d&&!p||!d&&p)return{d:0,point:d?t:r};if(!d&&!p){i=Ko._getDistanceBetweenSegmentWithPolygon(c,t,r);i.d<a.d&&(a=i);break}}if(d&&p){i=Ko._getDistanceBetweenSegmentWithPolygon(c,t,r);i.d<a.d&&(a=i);break}if(d&&!p||!d&&p)return{d:0,point:d?r:t};if(d||p);else if(s===l.length-1)return{d:0,point:d?t:r}}}return a};Ko._getDistanceBetweenArcWithCopperAreaPolygon=function(e,t){function r(e,t){var r,n,i,a,o=!1,s=0,l=t.length-1,c=+e.x,d=+e.y;for(l;s<t.length;l=s++){r=+t[s].x;n=+t[s].y;i=+t[l].x;a=+t[l].y;n>d!=a>d&&c<(i-r)*(d-n)/(a-n)+r&&(o=!o)}return o}var n={},i={d:Number.MAX_VALUE};if(!D(e))return i;var a,o,s,l,c,d,p,h,u=t.arcParams,f=u[0],g=u[1],y=u[7],v=u[8],x={x:f,y:g},m={x:y,y:v};for(a=0;a<e.length;a++){c=e[a];for(o=0;o<c.length;o++){d=c[o];p=r(x,d);h=r(m,d);if(0===o){if(p&&h){if(1===c.length)return{d:0,point:p?m:x};continue}if(p&&!h||!p&&h)return{d:0,point:p?x:m};if(!p&&!h){for(s=0,l=d.length-1;s<d.length-1;l=s++){n=Ko._checkClearanceBetweenArcAndLine(t,d[s],d[l]);n.d<i.d&&(i=n)}break}}if(p&&h){for(s=0,l=d.length-1;s<d.length-1;l=s++){n=Ko._checkClearanceBetweenArcAndLine(t,d[s],d[l]);n.d<i.d&&(i=n)}break}if(p&&!h||!p&&h)return{d:0,point:p?m:x};if(p||h);else if(o===c.length-1)return{d:0,point:p?x:m}}}return i};Ko._isDistanceLessThan=function(e,t){return+e.toFixed(6)<+t.toFixed(6)};Ko._isCircleToPolygonNearerThan=function(e,t,r){var n,i,a,o,s=e.r,l=s+r,c=t.points,d=c.length;for(n=0;n<d;n++){a=fe(e.x,e.y,c[n].x,c[n].y);if(Ko._isDistanceLessThan(a,l))return!0}if(ls.isPointInPolygon(e,c))return!0;for(n=0,i=d-1;n<d;i=n++){o=ls.getPointToSegmentObj(e,c[n],c[i]);if(Ko._isDistanceLessThan(o.d,l))return!0}return!1};Ko._isCircleToCircleNearerThan=function(e,t,r){var n;n=e.x==t.x?e.y-t.y:e.y==t.y?e.x-t.x:fe(e.x,e.y,t.x,t.y);n=Math.abs(n)-e.r-t.r;return Ko._isDistanceLessThan(n,r)};Ko._isPolygonToPolygonNearerThan=function(e,t,r){for(var n=Ko._polygon2Segments(e.points),i=Ko._polygon2Segments(t.points),a=0,o=n.length;a<o;a++)for(var s=0,l=i.length;s<l;s++){var c=Ko._distanceBetweenSegments(n[a].fromP,n[a].toP,i[s].fromP,i[s].toP);if(Ko._isDistanceLessThan(c.d,r))return!0}return!1};Ko._isTwoOvalPadsNearerThan=function(e,t,r){for(var n=Ko._convertOvalPadToBaseShapes(e),i=Ko._convertOvalPadToBaseShapes(t),a=0,o=n.length;a<o;a++)for(var s=0,l=i.length;s<l;s++){if(Ko._isTwoBaseShapesNearerThan(n[a],i[s],r))return!0;var c=Ko._distanceBetweenSegments(segsA[a].fromP,segsA[a].toP,segsB[s].fromP,segsB[s].toP);if(Ko._isDistanceLessThan(c.d,r))return!0}return!1};Ko._isTwoBaseShapesNearerThan=function(e,t,r){return"circle"==e.shape?"circle"==t.shape?Ko._isCircleToCircleNearerThan(e,t,r):Ko._isCircleToPolygonNearerThan(e,t,r):"circle"==t.shape?Ko._isCircleToPolygonNearerThan(t,e,r):Ko._isPolygonToPolygonNearerThan(e,t,r)};Ko._clearPadBaseShapeCache=function(){Ko._padBaseShapeCache={}};Ko._getOvalPadBaseShapes=function(e){var t=e.gId;if(t&&S(Ko._padBaseShapeCache,t))return Ko._padBaseShapeCache[t];var r=Ko._convertOvalPadToBaseShapes(e);t&&(Ko._padBaseShapeCache[t]=r);return r};Ko._convertOvalPadToBaseShapes=function(e){if(e.width==e.height)return[{shape:"circle",x:e.x,y:e.y,r:e.width}];var t=e.pointArr2,r=e.x,n=e.y,i=e.height>e.width,a=(i?e.width:e.height)/2,o=e.width/2-(i?0:a),s=e.height/2-(i?a:0),l=+e.rotation,c=t[0],d=t[1],p={shape:"circle",x:c.x,y:c.y,r:a},h={shape:"circle",x:d.x,y:d.y,r:a},u=[r-o,n-s,r+o,n-s,r+o,n+s,r-o,n+s],f=l?ge(u,360-l,r,n):u;return[p,h,{shape:"polygon",points:[{x:f[0],y:f[1]},{x:f[2],y:f[3]},{x:f[4],y:f[5]},{x:f[6],y:f[7]}]}]};Ko._getPadBaseShapes=function(e){switch(e.shape){case"OVAL":return Ko._getOvalPadBaseShapes(e);case"RECT":case"POLYGON":return[{shape:"polygon",points:e.pointArr}];case"ELLIPSE":return[{shape:"circle",x:e.x,y:e.y,r:e.width/2}];default:return[]}};Ko._isSegmentToPolygonNearerThan=function(e,t,r){for(var n=e.fromP,i=e.toP,a=Ko._polygon2Segments(t),o=0,s=a.length;o<s;o++){if(Ko._distanceBetweenSegments(a[o].fromP,a[o].toP,n,i).d<r)return!0}return!1};Ko._track2PadFilter=function(e,t){return!e||!t||!(e.net!=t.net||!t.net)};Ko._testTrack2Pad=function(e,t){if(!Ko._track2PadFilter(e,t)){var r,n,i,a,o,s,l=e.pointArr?e.pointArr[0]:null,c=e.pointArr?e.pointArr[1]:null,d=Math.max(Ai(e.net).clearance,Ai(t.net).clearance),p="track2Pad";"COPPERAREA"==e.type&&(d=Math.max(d,e.clearanceWidth));if(e.layerid!=io.BOARDOUTLINE&&"VIA"==t.type)p="track2via";else if(e.layerid!=io.BOARDOUTLINE&&"COPPERAREA"==t.type)p="track2copperarea";else if(e.layerid!=io.BOARDOUTLINE&&"SOLIDREGION"==t.type)p="track2solidregion";else if(e.layerid!=io.BOARDOUTLINE&&"SOLIDREGION"==e.type)p="VIA"==t.type?"via2copperarea":"pad2copperarea";else if(e.layerid==io.BOARDOUTLINE){if(!Fo.gJsonCache.DRCRULE.itemBoardOutlineClearance)return;p="obj2Boardoutline";d=+Fo.gJsonCache.DRCRULE.itemBoardOutlineClearance||0}switch(t.shape){case"OVAL":var h=t.pointArr2;n=parseFloat(e.strokeWidth)/2+Math.min(t.width,t.height)/2+d;i="ARC"==e.type||"COPPERAREA"==e.type&&e.arcParams?Ko._checkClearanceBetweenArcAndLine(e,h[0],h[1]):Ko._distanceBetweenSegments(h[0],h[1],l,c);break;case"ELLIPSE":n=parseFloat(e.strokeWidth)/2+d+t.width/2;i="ARC"==e.type||e.arcParams?Ko._checkClearanceBetweenArcAndPoint(e,{x:t.x,y:t.y}):pe({x:t.x,y:t.y},l,c);break;default:if("COPPERAREA"==t.type)if(e.layerid==io.BOARDOUTLINE)i=!1;else{d=Math.max(t.clearanceWidth,d);i="ARC"==e.type?Ko._getDistanceBetweenArcWithCopperAreaPolygon(t.polygonArr,e):Ko._getDistanceBetweenSegmentWithCopperAreaPolygon(t.polygonArr,l,c)}else if("ARC"==e.type||"COPPERAREA"==e.type&&e.arcParams){r=Ko._polygon2Segments(t.pointArr);a=i||{d:Number.MAX_VALUE};for(o=0,s=r.length;o<s;o++){i=Ko._checkClearanceBetweenArcAndLine(e,r[o].fromP,r[o].toP);i.d<a.d&&(a=i)}i=a}else i=Ko._getDistanceBetweenSegmentWithPolygon(t.pointArr,l,c);n=parseFloat(e.strokeWidth)/2+d;"COPPERAREA"==t.type&&(n-=Ko.CirclePolygonDeviation)}if(i&&Eo.formatLengthSave(i.d,{decimalPlaces:3})<Eo.formatLengthSave(n,{decimalPlaces:3})){Ko._addError({errorStr:p,ids:[t.gId,e.gId],net:[t.net,e.net],type:[t.type,e.layerid==io.BOARDOUTLINE?"BOARDOUTLINE":e.isCircle?"CIRCLE":e.type],currentValue:"obj2Boardoutline"==p?t.type:null,drcValue:d,pos:"ELLIPSE"==t.shape?{x:t.x,y:t.y}:i.point});Ko._errorgIdList.push(e.gId>t.gId?e.gId+"_"+t.gId:t.gId+"_"+e.gId)}}};Ko._testHole2Hole=function(e){var t=e.length;if(t>=2)for(var r=0;r<t;r++)for(var n=r+1;n<t;n++)Ko._hole2Hole(e[r],e[n])};Ko._hole2Hole=function(e,t){var r=Math.max(Ai(e.net).clearance,Ai(t.net).clearance),n=parseFloat(e.holeR)+parseFloat(t.holeR)+r,i=ls.distancePointToPoint({x:e.x,y:e.y},{x:t.x,y:t.y}),a="via2via";"PAD"==e.type&&"PAD"==t.type?a="pad2Pad":("PAD"==e.type&&!t.type||"PAD"==t.type&&!e.type)&&(a="via2pad");Ko._isDistanceLessThan(i,n)&&Ko._addError({errorStr:a,ids:[e.gId,t.gId],net:[e.net,t.net],type:[e.type,t.type],drcValue:r,pos:{x:(+e.x+ +t.x)/2,y:(+e.y+ +t.y)/2}})};Ko._testHole2Track=function(){};Ko._hole2Track=function(e,t){};Ko._testHole2Pad=function(){};Ko._hole2Pad=function(e,t){};Ko._distanceBetweenSegments=function(e,t,r,n){var i,a,o={x:null,y:null},s=null;s=Ko._checkSegmentsIntersect(e,t,r,n);if(s)return s;s=pe(e,r,n);a=s.d;i=1e38;if(a<i){i=a;o.x=s.point.x;o.y=s.point.y;e}s=pe(t,r,n);a=s.d;if(a<i){i=a;o.x=s.point.x;o.y=s.point.y;t}s=pe(r,e,t);a=s.d;if(a<i){i=a;o.x=s.point.x;o.y=s.point.y;r}s=pe(n,e,t);a=s.d;if(a<i){i=a;o.x=s.point.x;o.y=s.point.y;n}return{d:i,point:o}};Ko._checkSegmentsIntersect=function(e,t,r,n){var i,a,o,s,l,c;i=t.x-e.x;a=t.y-e.y;o=n.x-r.x;s=n.y-r.y;if(o*a-s*i==0)return!1;c=(i*(r.y-e.y)+a*(e.x-r.x))/(o*a-s*i);l=(o*(e.y-r.y)+s*(r.x-e.x))/(s*i-o*a);return c>=0&&c<=1&&l>=0&&l<=1&&{d:0,point:{x:e.x-0+l*i,y:e.y-0+l*a}}};Ko._isPointInsideArc=function(e,t){var r=e.centerParam,n=+r.cx,i=+r.cy,a=(r.rx,fe(n,i,+t.x,+t.y)),o=r.startAngle,s=o+r.delta_theta,l=Math.acos((t.x-n)/a);t.y>i&&(l=2*Math.PI-l);l=-l;var c=Math.min(o,s),d=Math.max(o,s),p=l>=c&&l<=d;p||(p=l+2*Math.PI>=c&&l+2*Math.PI<=d);p||(p=l-2*Math.PI>=c&&l-2*Math.PI<=d);return p};Ko._getPtInLineAndArc=function(e,t,r,n,i){var a,o,s=Eo.formatLengthSave(e.x,{decimalPlaces:3}),l=Eo.formatLengthSave(e.y,{decimalPlaces:3}),c=Eo.formatLengthSave(t.x,{decimalPlaces:3}),d=Eo.formatLengthSave(t.y,{decimalPlaces:3}),p=Eo.formatLengthSave(n.x,{decimalPlaces:3}),h=Eo.formatLengthSave(n.y,{decimalPlaces:3}),u=Eo.formatLengthSave(i.x,{decimalPlaces:3}),f=Eo.formatLengthSave(i.y,{decimalPlaces:3});a=!!Ko._isPointInsideArc(r,e)&&(s>=Math.min(p,u)&&s<=Math.max(p,u)&&l>=Math.min(h,f)&&l<=Math.max(h,f));o=!!Ko._isPointInsideArc(r,t)&&(c>=Math.min(p,u)&&c<=Math.max(p,u)&&d>=Math.min(h,f)&&d<=Math.max(h,f));return a?e:o?t:null};Ko._checkClearanceBetweenArcAndPoint=function(e,t){var r=e.centerParam,n=+r.cx,i=+r.cy,a=+r.rx,o=e.arcParams,s=+o[0],l=+o[1],c=+o[7],d=+o[8],p=fe(n,i,+t.x,+t.y);return p>=a?Ko._isPointInsideArc(e,t)?{d:p-a,point:t}:{d:Math.min(fe(s,l,+t.x,+t.y),fe(c,d,+t.x,+t.y)),point:t}:Ko._isPointInsideArc(e,t)?{d:a-p,point:t}:{d:Math.min(fe(s,l,+t.x,+t.y),fe(c,d,+t.x,+t.y)),point:t}};Ko._checkClearanceBetweenArcAndLine=function(e,t,r){var n,i,a,o,s,l,c,d,p,h,u=e.centerParam,f=+u.cx,g=+u.cy,y=+u.rx,v=e.arcParams,x=+v[0],m=+v[1],C=+v[7],L=+v[8],_=fe(f,g,+t.x,+t.y),P=fe(f,g,+r.x,+r.y);t.x=+t.x;t.y=+t.y;r.x=+r.x;r.y=+r.y;if(_>y&&P>y){n=pe({x:f,y:g},t,r);if(n.d<y){h=Ie(t,r,f,g,y);h=1===h.length?h[0]:2===h.length?Ko._getPtInLineAndArc(h[0],h[1],e,t,r):null;if(h)return{d:0,point:h};s=pe({x:x,y:m},t,r);l=pe({x:C,y:L},t,r);d=Math.min(s.d,l.d);return d==s.d?s:l}n.d=n.d-y;s=pe({x:x,y:m},t,r);l=pe({x:C,y:L},t,r);d=Math.min(n.d,s.d,l.d);d==n.d&&(Ko._isPointInsideArc(e,n.point)?p=n.point:d=Math.min(s.d,l.d));d==s.d?p=s.point:d==l.d&&(p=l.point);return{d:d,point:p}}if(_==y||P==y){if(Ko._isPointInsideArc(e,t)||Ko._isPointInsideArc(e,r))return{d:0,point:_==y?t:r};s=pe({x:x,y:m},t,r);l=pe({x:C,y:L},t,r);d=Math.min(s.d,l.d);return d==s.d?s:l}if(_<y&&P<y){if(Ko._isPointInsideArc(e,t)&&Ko._isPointInsideArc(e,r)){s=y-_;l=y-P;d=Math.min(s,l);p=d==s?t:r;return{d:d,point:p}}if(Ko._isPointInsideArc(e,t)||Ko._isPointInsideArc(e,r)){if(Ko._isPointInsideArc(e,t)){i=t;o=_;a=r}else{i=r;o=P;a=t}s=y-o;l=fe(x,m,a.x,a.y);c=fe(C,L,a.x,a.y);d=Math.min(s,l,c);p=d==s?i:d==l?{x:x,y:m}:{x:C,y:L};return{d:d,point:p}}s=pe({x:x,y:m},t,r);l=pe({x:C,y:L},t,r);d=Math.min(s.d,l.d);return d==s.d?s:l}if(_<y){i=t;o=_;a=r}else{i=r;o=P;a=t}h=Ie(i,a,f,g,y);if(h.length){
h=1==h.length?Ko._getPtInLineAndArc(h[0],h[0],e,t,r):2==h.length?Ko._getPtInLineAndArc(h[0],h[1],e,t,r):null;if(h)return{d:0,point:h}}if(Ko._isPointInsideArc(e,i)){s=y-o;l=pe({x:x,y:m},t,r);c=pe({x:C,y:L},t,r);d=Math.min(s,l.d,c.d);p=d==s?i:d==l.d?l.point:c.point;return{d:d,point:p}}s=pe({x:x,y:m},t,r);l=pe({x:C,y:L},t,r);d=Math.min(s.d,l.d);return d==s.d?s:l};Ko._checkClearanceBetweenArcAndArc=function(e,t){for(var r,n=e.centerParam,i=+n.cx,a=+n.cy,o=+n.rx,s=e.arcParams,l=+s[0],c=+s[1],d=+s[7],p=+s[8],h=+s[6],u=pi({startPoint:{x:l,y:c},centerPoint:{x:i,y:a},endPoint:{x:d,y:p},r:o,startAngle:n.startAngle,endAngle:n.endAngle,clockwise:h},!1),f={d:Number.MAX_VALUE},g=0;g<u.length;g++){r=Ko._checkClearanceBetweenArcAndPoint(t,u[g]);r.d<f.d&&(f=r)}return f};var Ps=function(){function e(e){var t,r=Z(e),n=r&&Fo.gJsonCache[r]?Fo.gJsonCache[r][e.id]:0,i=[];if(n)if("FOOTPRINT"==r&&n.PAD){for(r in n.PAD)if(S(n.PAD,r)){t=n.PAD[r];t.net&&i.push({x:t.x,y:t.y,net:t.net})}}else"PAD"!=r&&"VIA"!=r||n.net&&i.push({x:n.x,y:n.y,net:n.net});return i}function t(e,t){for(var r=0,n=t.length;r<n;r++)if(Ae(t[r].x,e.x)&&Ae(t[r].y,e.y))return r;return-1}function r(e){var r,n,i,a=Fo.gJsonCache.TRACK,o={};for(n in a)if(S(a,n)){r=a[n];if(r.net==e.net){i=t(e,r.pointArr);i>-1&&(o[n]=i)}}return o}function n(t){var n,i,a,o,s,l,c,d,p={},h=[],u={},f=[];for(n=0,a=t.length;n<a;n++){o=t[n];s=Z(o);"TRACK"==s?p[o.id]=1:"FOOTPRINT"!=s&&"PAD"!=s&&"VIA"!=s||h.push(o)}for(n=0,a=h.length;n<a;n++){o=h[n];l=e(o);for(i=0;i<l.length;i++){c=r(l[i]);for(d in c)if(S(c,d)&&!S(p,d)&&(!S(u,d)||!function(e,t,r){for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a[0]==t&&a[1]==r)return!0}return!1}(f,d,c[d]))){u[d]=1;f.push([d,c[d],l[i]])}}}return{followingWires:f,followingWireIds:u}}function i(e,t,r,n){var i,a,o,l,c,p,h=Zo.canvas.angle+"";if(e){i=e.followingWires||[];for(c=0,p=i.length;c<p;c++){a=i[c];if(a&&a[0]){o=d(a[0]);o=ss.isLocked(o)?null:o;if(o&&o.points){var u=Eo.toFixed(a[2].x+t,3),f=Eo.toFixed(a[2].y+r,3);if("45"===h||"90"===h)m(o,"points",function(e){var t=[].slice.call(n[e].points),r=[],i=[],o=[],l=n[e][0===a[1]?"start":"end"];l&&-1===l.indexOf("45")&&(t=function(e){for(var t,r=[],n=0;n<e.length/2;n++){t=2*n;r.push([e[t],e[t+1]])}t=r.length;for(;t;){t--;if(t<3)break;t>r.length-2||function(e){return r[e][0]===r[e-1][0]&&r[e-1][0]===r[e-2][0]||r[e][1]===r[e-1][1]&&r[e-1][1]===r[e-2][1]}(t)&&r.splice(t-1,1)}return r.join().split(",")}(t));if(0===a[1]){r=t.splice(0,6);i=[u,f];o=r.slice(-2)}else{r=t.splice(-6);i=r.slice(0,2);o=[u,f]}s=ls.formatTrackPoints(i,l&&l.indexOf("45")>=0?"45":"90",o[0],o[1],l);var c=s.split(" ");return(0===a[1]?c.concat(t):t.concat(c)).join(" ")}(a[0]));else{l=o.points.getItem(a[1]);l.x=u;l.y=f}}}}}}return{calFollowing:n,moveFollowing:i}}();es.init=function(e){es.clear();Ko.init();var t=[],r=[];for(var n in io)if(S(io,n)){var i=io[n];if(i<=52&&i!==io.RATLINES){t.push(i);oi(i)&&r.push(i)}}t.forEach(function(e){es.layers.push(e);es.trees[e]=rbush(9);es._bulkPatch[e]=[]});r.forEach(function(e){es.signalLayers.push(e)});Is!==ao.PCBLIB&&(Ko.maxClearance=Fo.gJsonCache.DRCRULE.Default.clearance)};es.points2bbCoordinates=function(e,t){var r,n,i,a,o;t=t||0;for(var s=0;s<e.length;s++){o=e[s];if(r||n||i||a){+o.x<r&&(r=+o.x);+o.y<n&&(n=+o.y);+o.x>i&&(i=+o.x);+o.y>a&&(a=+o.y)}else{r=+o.x;n=+o.y;i=+o.x;a=+o.y}}return{minX:r-t,minY:n-t,maxX:i+t,maxY:a+t}};es.bbox2bbCoordinates=function(e,t){t=t||0;return{minX:e.x-t,minY:e.y-t,maxX:e.x+e.width+t,maxY:e.y+e.height+t}};es.line2bbCoordinates=function(e,t,r,n){var i=(n||Ko.maxClearance)+r/2;i=i||0;return{minX:Math.min(e.x,t.x)-i,minY:Math.min(e.y,t.y)-i,maxX:Math.max(e.x,t.x)+i,maxY:Math.max(e.y,t.y)+i}};es.createNode=function(e,t){var r,n,i,a,o,s,l,c,h,u,f=[];if(Is!==ao.PCBLIB)var g=+Fo.gJsonCache.DRCRULE.itemBoardOutlineClearance;if("TRACK"==t)for(r=0,n=e.pointArr.length;r<n-1;r++){i=es.line2bbCoordinates(e.pointArr[r],e.pointArr[r+1],e.strokeWidth,oi(e.layerid)?Ai(e.net).clearance:e.layerid==io.BOARDOUTLINE?g:g/2);s={gId:e.gId,layerid:e.layerid,net:e.net,pointArr:[e.pointArr[r],e.pointArr[r+1]],strokeWidth:e.strokeWidth};f[r]=i;f[r].type=t;f[r].node=s}else if("CIRCLE"==t){if(!d(e.gId))return!1;c={x:Eo.formatLengthSave(e.cx-e.r-Number(e.strokeWidth)/2),y:Eo.formatLengthSave(e.cy-e.r-Number(e.strokeWidth)/2),width:Eo.formatLengthSave(2*e.r+Number(e.strokeWidth)),height:Eo.formatLengthSave(2*e.r+Number(e.strokeWidth))};f[0]=es.bbox2bbCoordinates(c,h);f[0].type=t;f[0].node=e;c={x:Eo.formatLengthSave(e.cx-e.strokeWidth/2),y:Eo.formatLengthSave(e.cy-e.strokeWidth/2),width:Eo.formatLengthSave(e.strokeWidth),height:Eo.formatLengthSave(e.strokeWidth)};f[1]=es.bbox2bbCoordinates(c,h);f[1].type="DOT";f[1].node={x:Eo.formatLengthSave(e.cx),y:Eo.formatLengthSave(e.cy),gId:e.gId,net:e.net,strokeWidth:e.strokeWidth}}else if("DIMENSION"==t||"PROTRACTOR"==t&&g){o=es._pathConvexHullPoints(e.d||e.pathStr);o.push(o[0]);for(r=0,n=o.length;r<n-1;r++){i=es.line2bbCoordinates(o[r],o[r+1],0,g/2);s={gId:e.gId,layerid:e.layerid,net:"",pointArr:[o[r],o[r+1]],strokeWidth:e.strokeWidth||0};f[r]=i;f[r].type=t;f[r].node=s}}else if("TEXT"==t){h=Math.max(Ai(e.net).clearance,e.strokeWidth||0);u=e.pathStr?e.pathStr.split("M"):[];u=u.filter(function(e){return""!==e.trim()});for(r=0;r<u.length;r++){o=es._pathConvexHullPoints("M"+u[r]);o.push(o[0]);c=es.points2bbCoordinates(o,h);s={gId:e.gId,layerid:e.layerid,net:e.net,pointArr:o,strokeWidth:e.strokeWidth||0,shape:"POLYGON",x:(c.minX+c.maxX)/2,y:(c.minY+c.maxY)/2};f[r]=c;f[r].type=t;f[r].node=s}}else if("SVGNODE"==t){if(e.attrs&&e.attrs.d){o=es._pathConvexHullPoints(e.attrs.d);if(o.length)for(r=0,n=o.length-1;r<n;r++){i=es.line2bbCoordinates(o[r],o[r+1],0,Ai("Default").clearance);s={gId:e.gId,layerid:e.layerid,net:"",pointArr:[o[r],o[r+1]],strokeWidth:0};f[r]=i;f[r].type=t;f[r].node=s}}}else if("RECT"==t){c={x:e.x,y:e.y,width:e.width,height:e.height};f[0]=es.bbox2bbCoordinates(c,Ai("Default").clearance);f[0].type=t;f[0].node=Eo.extend({},e,{shape:"RECT",net:"",pointArr:[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height},{x:e.x,y:e.y}]})}else if("HOLE"==t){c={x:e.x-e.holeR,y:e.y-e.holeR,width:2*e.holeR,height:2*e.holeR};f[0]=es.bbox2bbCoordinates(c,Ai("Default").clearance);f[0].type=t;f[0].node=e}else if("VIA"==t){c={x:e.x-e.diameter/2,y:e.y-e.diameter/2,width:e.diameter,height:e.diameter};f[0]=es.bbox2bbCoordinates(c,Ai(e.net||"Default").clearance);f[0].type=t;f[0].node=e}else if("COPPERAREA"==t||"PLANEZONE"==t){h=Ai(e.net).clearance;void 0!==e.clearanceWidth&&(h=Math.max(e.clearanceWidth,h));var y=p("path[attachedcopperid="+e.gId+"]");if(!y.length&&e.fillData){var v=E(e.fillData);Array.isArray(v)&&(v=v[0]);for(r=0;r<v.length;r++)y[r]={d:v[r]}}e.trackArr=null;e.polygonArr=null;y.length&&y.forEach(function(r,n){var i,a,o,l,c,d,p,u,g=[],y=[],v=m(r,"d");if(v&&"null"!=v){if(+m(r,"stroke-width")){a=hi(v);Array.isArray(e.trackArr)?e.trackArr.push(a):e.trackArr=[a];for(o=0;o<a.length;o++){p=f.length;c=a[o];d=c[0];switch(d){case"M":l={x:+c[1],y:+c[2]};break;case"L":s={gId:e.gId,layerid:e.layerid,net:e.net,pointArr:[l,{x:+c[1],y:+c[2]}],strokeWidth:+e.strokeWidth,clearanceWidth:+e.clearanceWidth,copperAreaId:n};f[p]=es.line2bbCoordinates(l,{x:+c[1],y:+c[2]},+e.strokeWidth,h);f[p].type=t;f[p].node=s;l={x:+c[1],y:+c[2]};break;case"A":s={gId:e.gId,layerid:e.layerid,net:e.net,strokeWidth:+e.strokeWidth,clearanceWidth:+e.clearanceWidth,copperAreaId:n,arcParams:[l.x,l.y].concat(c.slice(1)),centerParam:Eo.arc.getCenterParam(l.x,l.y,+c[6],+c[7],+c[4],+c[5],+c[1],+c[2],+c[3])};f[p]=es.bbox2bbCoordinates({x:s.centerParam.cx-c[1],y:s.centerParam.cy-c[2],width:2*Number(c[1]),height:2*Number(c[2])},h);f[p].type=t;f[p].node=s;l={x:+c[6],y:+c[7]}}}}else{i=ui(v);for(o in i)S(i,o)&&"hole"!==o&&y.push(i[o]);g.push(y);i&&i.hole&&i.hole.forEach(function(e,t){g.push(e)});u=es.splitPolygon(g);for(o=0;o<u.length;o++){s={gId:e.gId,layerid:e.layerid,net:e.net,polygonArr:[[u[o]]],clearanceWidth:e.clearanceWidth,copperAreaId:n};u[o].holes&&(s.polygonArr[0]=s.polygonArr[0].concat(u[o].holes));p=f.length;f[p]=es.points2bbCoordinates(u[o],h);f[p].type=t;f[p].node=s}Array.isArray(e.polygonArr)?e.polygonArr.push(g):e.polygonArr=[g]}}})}else if("SOLIDREGION"==t){e.pointArr=ui(e.pathStr);f[0]=es.points2bbCoordinates(e.pointArr,h);f[0].type=t;f[0].node=e}else if("ARC"==t){if(!d(e.gId))return!1;a=e.d.match(/([-+]?\d+(\.\d+)?)/g);e.arcParams=a;e.centerParam=Eo.arc.getCenterParam(+a[0],+a[1],+a[7],+a[8],+a[5],+a[6],+a[2],+a[3],+a[4]);e.pointArr||(e.pointArr=pi(e,!1));c={x:Eo.formatLengthSave(e.centerParam.cx-e.centerParam.rx-e.strokeWidth/2),y:Eo.formatLengthSave(e.centerParam.cy-e.centerParam.ry-e.strokeWidth/2),width:Eo.formatLengthSave(2*e.centerParam.rx+e.strokeWidth),height:Eo.formatLengthSave(2*e.centerParam.ry+e.strokeWidth)};f[0]=es.bbox2bbCoordinates(c,h);f[0].type=t;f[0].node=e;c={x:Eo.formatLengthSave(e.centerParam.cx-e.strokeWidth/2),y:Eo.formatLengthSave(e.centerParam.cy-e.strokeWidth/2),width:Eo.formatLengthSave(e.strokeWidth),height:Eo.formatLengthSave(e.strokeWidth)};f[1]=es.bbox2bbCoordinates(c,h);f[1].type="DOT";f[1].node={x:Eo.formatLengthSave(e.centerParam.cx),y:Eo.formatLengthSave(e.centerParam.cy),gId:e.gId,net:e.net,strokeWidth:e.strokeWidth}}else if("PAD"==t){h=Ai(e.net).clearance;switch(e.shape){case"OVAL":f[0]=es.line2bbCoordinates(e.pointArr2[0],e.pointArr2[1],Math.min(e.width,e.height),h);f[0].type=t;f[0].node=e;break;case"ELLIPSE":c={x:Eo.formatLengthSave(e.x-e.width/2),y:Eo.formatLengthSave(e.y-e.height/2),width:Eo.formatLengthSave(e.width),height:Eo.formatLengthSave(e.height)};f[0]=es.bbox2bbCoordinates(c,h);f[0].type=t;f[0].node=e;break;case"RECT":case"POLYGON":f[0]=es.points2bbCoordinates(e.pointArr,h);f[0].type=t;f[0].node=e;break;default:return!1}}else{l=d(e.gId);if(!l)return!1;h=Ai(e.net).clearance;c=Eo.svg.getBBox(l);f[0]=es.bbox2bbCoordinates(c,h);f[0].type=t;f[0].node=e}return!!f.length&&{layerid:e.layerid,treeNodes:f}};es._pathConvexHullPoints=function(e){var t,n,i,a,o,s,l,c,d=function(e){var t,r,n,i,a,o,s,l,c,d,p={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"},u=/([MZLHVCSQTAmzlhvcsqta])([eE ,\-\+.\d]+)*/g,f=e.match(u),g=[];for(t=0;t<f.length;t++){r=u.exec(e);if(Array.isArray(r)&&3===r.length&&r[2]&&r[2].trim()){a=r[2].match(/(?:[-+]?(?:(?:\d+\.\d+)|(?:(?:\d+)|(?:\.\d+)))(?:e[-+]?\d+)?)/gi);s=r[1].toLowerCase();if(p[s]&&(l=p[s])&&a.length>l){c=h[r[1]]?h[r[1]]:r[1];d=r[1];for(n=0,i=a.length;n<i;n+=l){o=a.slice(n,l);o.unshift(d);g.push(o);d=c}}else{a.unshift(r[1]);g.push(a)}}else{a=[r[1]];"z"==a[0]&&(a[0]="Z");g.push(a)}}return g}(e),p=new r;for(t=0;t<d.length;t++){i=d[t];switch(i[0]){case"M":case"L":p.addPoint(i[1],i[2]);break;case"C":p.addPoint(i[5],i[6]);break;case"Q":p.addPoint(i[3],i[4]);break;case"A":a=d[t-1];if("M"==a[0]||"L"==a[0]){o=a[1];s=a[2]}else if("C"==a[0]){o=a[5];s=a[6]}else if("Q"==a[0]){o=a[3];s=a[4]}else if("A"==a[0]){o=a[6];s=a[7]}l={d:"M"+o+","+s+" A"+i[1]+","+i[2]+" "+i[3]+" "+i[4]+" "+i[5]+" "+i[6]+","+i[7]};c=pi(l,!1);for(n=0;n<c.length;n++)p.addPoint(c[n].x,c[n].y)}}var h=p.getHull();return h<3?null:h};es._cacheToNodeIndex=function(e,t){es.nodeIndex[e]=t};es.insertNode=function(e,t){function r(e,t){es._isBulkMode?es._bulkPatch[e]=(es._bulkPatch[e]||[]).concat(t):es.trees[e]&&es.trees[e].load(t)}es.removeNode(e);if("SOLIDREGION"==t&&("cutout"==e.type||"npth"==e.type))return!1;var n=es.createNode(e,t),i=n.treeNodes;if(!n||!i)return!1;if(n&&n.treeNodes.length){es._cacheToNodeIndex(e.gId,n);n.layerid==io.ALL?es.layers.filter(function(e){return oi(e)}).forEach(function(e){r(e,i)}):r(n.layerid,i)}};es.insertNodes=function(e,t){if(Array.isArray(e))e.forEach(function(e){es.insertNode(e,t)});else for(var r in e)S(e,r)&&es.insertNode(e[r],t)};es.removeNode=function(e){function t(e,t){e.forEach(function(e){es.trees[t]&&es.trees[t].remove(e)})}if(e&&S(es.nodeIndex,e.gId)){var r=es.nodeIndex[e.gId],n=r.treeNodes;r.layerid==io.ALL?es.layers.forEach(function(e){t(n,e)}):t(n,r.layerid);delete es.nodeIndex[e.gId];return!0}return!1};es.removeNodes=function(e){if(Array.isArray(e))e.forEach(function(e){es.removeNode(e)});else for(var t in e)S(e,t)&&es.removeNode(e[t])};es.clear=function(){es.nodeIndex={};es.trees={};es.signalLayers=[];es.layers=[];es._bulkPatch={};es._isBulkMode=!1};es.searchByPoint=function(e,t){var r={minX:e.x-e.r,minY:e.y-e.r,maxX:e.x+e.r,maxY:e.y+e.r};return es.trees[t]?es.trees[t].search(r):[]};es.searchByPoint2=function(e,t,r,n){var i={minX:e-r,minY:t-r,maxX:e+r,maxY:t+r};return es.trees[n]?es.trees[n].search(i):[]};es.rebuild=function(){es.init();es._isBulkMode=!0;for(var e=0,t=Ko.checkedKeys.length;e<t;e++)for(var r in Fo.gJsonCache[Ko.checkedKeys[e]])S(Fo.gJsonCache[Ko.checkedKeys[e]],r)&&es.addToRTree(Fo.gJsonCache[Ko.checkedKeys[e]][r],Ko.checkedKeys[e]);es.allCircleToArc();es.layers.forEach(function(e){es.trees[e].load(es._bulkPatch[e])});es._isBulkMode=!1};es.addToRTree=function(e,t){e&&("FOOTPRINT"==t?Ko.checkedKeys.forEach(function(t){es.insertNodes(e[t],t)}):es.insertNode(e,t))};es.removeFromRTree=function(e,t){e&&("FOOTPRINT"==t?Ko.checkedKeys.forEach(function(t){es.removeNodes(e[t])}):es.removeNode(e))};es.circleToArc=function(e){var t,r;es.nodeIndex;t=e.type;r=e.node;if("CIRCLE"===t&&r){var n=+r.cx,i=+r.cy,a=+r.r,o=n-a,s=i+.01,l="M"+o+","+i+" A"+a+","+a+" 0 1 1 "+o+","+s,c={d:l,"stroke-width":r.strokeWidth,fill:"none",c_shapetype:"line",layerid:r.layerid,id:r.gId,net:r.net,c_auto_net:r.c_auto_net||null},d=zt("path",c),p=Z(d),h=_s[p](d),u={},f=[],g=Eo.svg.getBBox(d),y=Ai(h.net).clearance,v=h.d.match(/([-+]?\d+(\.\d+)?)/g);u.layerid=r.layerid;f[0]=es.bbox2bbCoordinates(g,y);f[0].type=p;h.isCircle=!0;h.arcParams=v;h.pointArr=pi(d,!1);h.centerParam=Eo.arc.getCenterParam(+v[0],+v[1],+v[7],+v[8],+v[5],+v[6],+v[2],+v[3],+v[4]);f[0].node=h;u.treeNodes=f;es.nodeIndex[d.id]=u;es._bulkPatch[r.layerid]?es._bulkPatch[r.layerid].push(f[0]):es._bulkPatch[r.layerid]=f;es._bulkPatch[r.layerid]?es._bulkPatch[r.layerid].push(f[0]):es._bulkPatch[r.layerid]=f}};es.allCircleToArc=function(){var e,t,r=es.nodeIndex;for(var n in r)if(S(r,n)){e=r[n];t=e.treeNodes[0].type;e.treeNodes[0].node;"CIRCLE"===t&&es.circleToArc(e.treeNodes[0])}};es.splitPolygon=function(e){var t=function(e){for(var t,r,n,i,a,o=0;o<e.length;o++){a=e[o];if(t||r||n||i){+a.x<t&&(t=+a.x);+a.y<r&&(r=+a.y);+a.x>n&&(n=+a.x);+a.y>i&&(i=+a.y)}else{t=+a.x;r=+a.y;n=+a.x;i=+a.y}}return{minX:t,minY:r,maxX:n,maxY:i,width:n-t,height:i-r}}(e[0]);if(t.width<=25&&t.height<=25){if(e.length>1){e[0].holes=e.splice(1);return e}return e}var r=Math.ceil(t.width/25),n=Math.ceil(t.height/25),i=new ClipperLib.Polygons,a=new ClipperLib.ExPolygons,o=new ClipperLib.Clipper;for(s=0;s<e.length;s++)i.push(e[s].map(function(e){return{x:Math.round(500*e.x),y:Math.round(500*e.y)}}));o.AddPolygons(i,ClipperLib.PolyType.ptSubject);var s,l,c=new ClipperLib.Polygons;for(s=0;s<r;s+=2)c.push([{x:500*(t.minX+25*s),y:500*t.minY},{x:500*(t.minX+25*s+25),y:500*t.minY},{x:500*(t.minX+25*s+25),y:500*t.maxY},{x:500*(t.minX+25*s),y:500*t.maxY},{x:500*(t.minX+25*s),y:500*t.minY}]);o.AddPolygons(c,ClipperLib.PolyType.ptClip);o.Execute(ClipperLib.ClipType.ctIntersection,a,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);var d,p,h=[],u=new ClipperLib.Polygons;for(s=0;s<a.length;s++){d=a[s].outer;d.push(d[0]);u.push(d);p=a[s].holes;for(l=0;l<p.length;l++){p[l].push(p[l][0]);u.push(p[l])}}c=new ClipperLib.Polygons;for(s=0;s<n;s+=2)c.push([{x:500*t.minX,y:500*(t.minY+25*s)},{x:500*t.maxX,y:500*(t.minY+25*s)},{x:500*t.maxX,y:500*(t.minY+25*s+25)},{x:500*t.minX,y:500*(t.minY+25*s+25)},{x:500*t.minX,y:500*(t.minY+25*s)}]);a=new ClipperLib.ExPolygons;o=new ClipperLib.Clipper;o.AddPolygons(u,ClipperLib.PolyType.ptSubject);o.AddPolygons(c,ClipperLib.PolyType.ptClip);o.Execute(ClipperLib.ClipType.ctIntersection,a,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);for(s=0;s<a.length;s++){d=a[s].outer;d=d.map(function(e){return{x:e.x/500,y:e.y/500}});d.push(d[0]);h.push(d);p=a[s].holes;if(p.length){for(l=0;l<p.length;l++){p[l]=p[l].map(function(e){return{x:e.x/500,y:e.y/500}});p[l].push(p[l][0])}d.holes=p}}c=new ClipperLib.Polygons;for(s=1;s<n;s+=2)c.push([{x:500*t.minX,y:500*(t.minY+25*s)},{x:500*t.maxX,y:500*(t.minY+25*s)},{x:500*t.maxX,y:500*(t.minY+25*s+25)},{x:500*t.minX,y:500*(t.minY+25*s+25)},{x:500*t.minX,y:500*(t.minY+25*s)}]);a=new ClipperLib.ExPolygons;o=new ClipperLib.Clipper;o.AddPolygons(u,ClipperLib.PolyType.ptSubject);o.AddPolygons(c,ClipperLib.PolyType.ptClip);o.Execute(ClipperLib.ClipType.ctIntersection,a,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);for(s=0;s<a.length;s++){d=a[s].outer;d=d.map(function(e){return{x:e.x/500,y:e.y/500}});d.push(d[0]);h.push(d);p=a[s].holes;if(p.length){for(l=0;l<p.length;l++){p[l]=p[l].map(function(e){return{x:e.x/500,y:e.y/500}});p[l].push(p[l][0])}d.holes=p}}u=new ClipperLib.Polygons;c=new ClipperLib.Polygons;for(s=1;s<r;s+=2)c.push([{x:500*(t.minX+25*s),y:500*t.minY},{x:500*(t.minX+25*s+25),y:500*t.minY},{x:500*(t.minX+25*s+25),y:500*t.maxY},{x:500*(t.minX+25*s),y:500*t.maxY},{x:500*(t.minX+25*s),y:500*t.minY}]);a=new ClipperLib.ExPolygons;o=new ClipperLib.Clipper;o.AddPolygons(i,ClipperLib.PolyType.ptSubject);o.AddPolygons(c,ClipperLib.PolyType.ptClip);o.Execute(ClipperLib.ClipType.ctIntersection,a,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);for(s=0;s<a.length;s++){d=a[s].outer;d.push(d[0]);u.push(d);p=a[s].holes;for(l=0;l<p.length;l++){p[l].push(p[l][0]);u.push(p[l])}}c=new ClipperLib.Polygons;for(s=0;s<n;s+=2)c.push([{x:500*t.minX,y:500*(t.minY+25*s)},{x:500*t.maxX,y:500*(t.minY+25*s)},{x:500*t.maxX,y:500*(t.minY+25*s+25)},{x:500*t.minX,y:500*(t.minY+25*s+25)},{x:500*t.minX,y:500*(t.minY+25*s)}]);a=new ClipperLib.ExPolygons;o=new ClipperLib.Clipper;o.AddPolygons(u,ClipperLib.PolyType.ptSubject);o.AddPolygons(c,ClipperLib.PolyType.ptClip);o.Execute(ClipperLib.ClipType.ctIntersection,a,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);for(s=0;s<a.length;s++){d=a[s].outer;d=d.map(function(e){return{x:e.x/500,y:e.y/500}});d.push(d[0]);h.push(d);p=a[s].holes;if(p.length){for(l=0;l<p.length;l++){p[l]=p[l].map(function(e){return{x:e.x/500,y:e.y/500}});p[l].push(p[l][0])}d.holes=p}}c=new ClipperLib.Polygons;for(s=1;s<n;s+=2)c.push([{x:500*t.minX,y:500*(t.minY+25*s)},{x:500*t.maxX,y:500*(t.minY+25*s)},{x:500*t.maxX,y:500*(t.minY+25*s+25)},{x:500*t.minX,y:500*(t.minY+25*s+25)},{x:500*t.minX,y:500*(t.minY+25*s)}]);a=new ClipperLib.ExPolygons;o=new ClipperLib.Clipper;o.AddPolygons(u,ClipperLib.PolyType.ptSubject);o.AddPolygons(c,ClipperLib.PolyType.ptClip);o.Execute(ClipperLib.ClipType.ctIntersection,a,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);for(s=0;s<a.length;s++){d=a[s].outer;d=d.map(function(e){return{x:e.x/500,y:e.y/500}});d.push(d[0]);h.push(d);p=a[s].holes;if(p.length){for(l=0;l<p.length;l++){p[l]=p[l].map(function(e){return{x:e.x/500,y:e.y/500}});p[l].push(p[l][0])}d.holes=p}}return h};qo.zoomInPoint=function(e){return{x:Math.round(e.x*qo._scaleFactor),y:Math.round(e.y*qo._scaleFactor)}};qo.zoomOutPoint=function(e){return{x:e.x/qo._scaleFactor,y:e.y/qo._scaleFactor}};qo.zoomInOffsetVal=function(e){return Math.round(e*qo._scaleFactor)};qo._isOnCopperLayer=function(e){return qo._copperLayerId==e||e==io.ALL};qo._fetchCopperAreaOfThisLayer=function(e){var t=Fo.gJsonCache.COPPERAREA,r=[];for(var n in t)S(t,n)&&t[n].layerid==e&&r.push(t[n]);return r};qo._markError=function(e){Bt(e.x,e.y);if(Ko&&Ko.showErrorSymbols){Ko.showErrorSymbols(e);setTimeout(Ko.hideErrorSymbols,8e3)}};qo.setUpFromJsonCache=function(){qo.copperPolygons={};qo._padOrViaHasSameNetNameWithCopperArr=[];var e,t,r,n,i,a,o,s,l,c,h,u,f,g,y,v=Fo.gJsonCache.COPPERAREA,x=Fo.getAllObjsOf("VIA",!0),C=Fo.getAllObjsOf("PAD",!0),L=[],_=[];Fo.gJsonCache.PLANEZONE&&(v=Eo.extend({},v,Fo.gJsonCache.PLANEZONE));for(e in v)if(S(v,e)){n=v[e];if(n){qo._copperNet=n.net;qo._copperLayerId=n.layerid;for(i=0,s=x.length;i<s;i++){h=x[i];if(h.net==qo._copperNet){u={cmd:"VIA",fid:0,gId:h.gId,layerid:h.layerid,diameter:h.diameter,x:h.x,y:h.y};qo._padOrViaHasSameNetNameWithCopperArr.push(u)}}for(i=0,s=C.length;i<s;i++){f=C[i];!function(e,t,r,n){if(r.net==qo._copperNet&&qo._isOnCopperLayer(r.layerid)){var i={cmd:"PAD",fid:n,gId:r.gId,layerid:r.layerid,shape:r.shape,pointArr:r.pointArr,pointArr2:r.pointArr2,width:r.width,height:r.height,x:r.x,y:r.y};e.push(i)}qo._isOnCopperLayer(r.layerid)&&t.push(r)}(qo._padOrViaHasSameNetNameWithCopperArr,L,f)}c=n.net+"_"+n.layerid;qo.copperPolygons[c]||(qo.copperPolygons[c]={});qo.copperPolygons[c][e]=[];t=p('path[attachedcopperid="'+n.gId+'"]');if(Fo.gJsonCache.PLANEZONE&&n.gId in Fo.gJsonCache.PLANEZONE){t=[];for(var P in Fo.gJsonCache.PLANEZONE[n.gId].pathStrObj)t.push(d(P))}for(i=0;i<t.length;i++){r=m(t[i],"d");l=ui(r);if(l){if(D(l.hole))for(a=0;a<l.hole.length;a++)D(l.hole[a])&&(l.hole[a]=l.hole[a].map(qo.zoomInPoint));y={holes:l.hole?l.hole:[],outer:l.map(qo.zoomInPoint)};_=[];for(o=0,s=qo._padOrViaHasSameNetNameWithCopperArr.length;o<s;o++){g=qo._padOrViaHasSameNetNameWithCopperArr[o];if(g&&qo.testPolygonContainsPoint(y,qo.zoomInPoint(g),g)){_.push(g);delete qo._padOrViaHasSameNetNameWithCopperArr[o]}}qo.copperPolygons[c][e].push({connectedPadOrViaArr:_,polygon:y})}}}}};qo.rebuildCopperArea=function(e){var t=null,r=[];Ko&&Ko.hideRealtimeDRCError&&Ko.hideRealtimeDRCError();if("object"==typeof e){t=e;qo.processOneCopperArea(t);r.push(t.net)}else if("selected"==e){var n=un();if(1!=n.length||"COPPERAREA"!=Z(n[0]))return;t=_s.COPPERAREA(n[0]);qo.processOneCopperArea(t);r.push(t.net)}else{if("all"!=e)return;var i=Fo.gJsonCache.COPPERAREA;for(var a in i)if(S(i,a)){t=i[a];t.net&&qo.processOneCopperArea(t);r.push(t.net)}}return r};qo.rebuildPlane=function(e){if("string"==typeof e){if("all"===e||"11"==e){var t=Object.keys(io);for(var r in t)S(t,r)&&bi(io[t[r]])&&"ALL"!=t[r]&&qo.rebuildPlaneInLayer(io[t[r]]);return}if("currentLayer"===e){qo.rebuildPlaneInLayer(Ls.getActiveLayer());return}}else if(D(e)){var n=ot(e);n.forEach(qo.rebuildPlane);return}var i=Number(e);isNaN(i)||qo.rebuildPlaneInLayer(i)};qo.rebuildPlaneInLayer=function(e){var t,r,n=null,i=[],a=[],o=[],s=function(){var e=qo._connectBoardOutlinesAsPolygon();if(e){return e.reduce(function(e,t,r){pOut=qo.zoomOutPoint(t);0!==r&&(e+="L ");return e+=pOut.x+" "+pOut.y+" "},"M ").trim()}return!1}();if(bi(e)){if(!s)return!1;n={clearanceWidth:0,fillStyle:"solid",keepIsland:"yes",layerid:e,locked:"0",net:"GND",pathStr:s,strokeWidth:"0",thermal:"spoke",gId:"planeDivide"};qo._planeStage="divide";a=qo.processOnePlaneArea(n).children;qo._prevPlaneStatus&&qo._prevPlaneStatus.pointsArr&&qo._prevPlaneStatus.pointsArr.forEach(function(e){i.indexOf(e.net)<0&&i.push(e.net)});qo.clearOldCopperPolygons();if(a.length>0){a.forEach(function(n,i){var a,s,l,c,d,p=m(n,"d");qo._planeBlockId=i;var h=it(qo._getOuterPath(p));if(qo._prevPlaneStatus&&qo._prevPlaneStatus.pointsArr&&qo._prevPlaneStatus.pointsArr.length>0){var u=qo._prevPlaneStatus.pointsArr.map(function(e){return{cache:e,count:at(e.points,h,.001)}}).sort(function(e,t){return t.count-e.count});if(0===u[0].count&&qo._prevPlaneStatus.ids[n.id]){a=qo._prevPlaneStatus.ids[n.id].net||"GND";s=qo._prevPlaneStatus.ids[n.id].fillStyle||"solid"}else{a=u[0].cache.net||"GND";s=u[0].cache.fillStyle||"solid"}}else{a="GND";s="solid"}v(n);var f={clearanceWidth:Ai(a).clearance,fillStyle:s,keepIsland:"yes",layerid:e,locked:"0",net:a,pathStr:p.replace(/\s/g," L ").replace(/[Zz][Mm]/g,"z M"),strokeWidth:"0",thermal:"spoke"};qo._planeStage="zone";var g=qo.processOnePlaneArea(f);m(g,"net",a);m(g,"fillStyle",s);var y=f.net+"_"+f.layerid;y in qo.copperPolygons||(qo.copperPolygons[y]={});qo.copperPolygons[y][n.id]=[qo._activeCopperPolygons[0]];o.push(g);t||(t=Fo.getAllObjsOf("PAD",!0,!0,[io.ALL]));r||(r=Fo.getAllObjsOf("VIA",!0,!0));lo.copperNetRelation.planeZone||(lo.copperNetRelation.planeZone={});lo.copperNetRelation.planeZone[n.id]||(lo.copperNetRelation.planeZone[n.id]={});for(l=0;l<t.length;l++){c=t[l];c.net==a?c.x&&c.y&&ls.isPointInPolygon(c,h)?lo.copperNetRelation.planeZone[n.id][c.gId]={net:a,id:n.id}:lo.copperNetRelation.planeZone[n.id][c.gId]&&lo.copperNetRelation.planeZone[n.id][c.gId].id==n.id&&delete lo.copperNetRelation.planeZone[n.id][c.gId]:lo.copperNetRelation.planeZone[n.id][c.gId]&&lo.copperNetRelation.planeZone[n.id][c.gId].id==n.id&&delete lo.copperNetRelation.planeZone[n.id][c.gId]}for(l=0;l<r.length;l++){d=r[l];d.net==a&&(d.x&&d.y&&ls.isPointInPolygon(d,h)?lo.copperNetRelation.planeZone[n.id][d.gId]={net:a,id:n.id}:lo.copperNetRelation.planeZone[n.id][d.gId]&&lo.copperNetRelation.planeZone[n.id][d.gId].id==n.id&&delete lo.copperNetRelation.planeZone[n.id][d.gId])}});i.indexOf("GND")<0&&i.push("GND")}o.forEach(function(e){Fo.updateOne(e)});Qo.buildGroupNets(i);qo._planeStage=null}};qo.cleanPlaneLayer=function(e,t){qo.removePlaneZone(e,!!t);p('*[layerid="'+e+'"]',Ka).forEach(function(e){if(t){var r=e.id;r&&zo.save(["del",r,Eo.node.getRefId(e)])}Fo.removeOne(e);Ro.appendChild(e)})};qo.isLayerCleanForConvertingToPlane=function(e){var t=p('*[layerid="'+e+'"]',Ka),r=!0;t.forEach(function(e){var t=Z(e);"PLANEZONE"!==t&&"TRACK"!==t&&(r=!1)});return r};qo._getOuterPath=function(e){var t=e.replace(/\s/g," L ").split(/[Mm]/);t.shift();t.length;return"M "+t[0]};qo.clearOldCopperPolygons=function(){var e=Fo.gJsonCache.COPPERAREA,t=Fo.gJsonCache.PLANEZONE,r=qo.copperPolygons;for(var n in r)if(S(r,n)){var i=r[n],a=!1;if(!i)continue;for(var o in i)if(S(i,o)){a=!0;(e&&o in e||t&&o in t)&&qo.copperPolygons[n][o].length||delete qo.copperPolygons[n][o]}a||delete qo.copperPolygons[n]}};qo.getCompressData=function(e){if("grid"===e.fillStyle)return JSON.stringify([[m(p('path[attachedcopperid="'+e.gId+'"]')[0],"d")]]);var t=[];p('path[attachedcopperid="'+e.gId+'"]').forEach(function(e){t.push(m(e,"d"))});return JSON.stringify([t])};qo.removeAllCopperPolygons=function(){var e=Fo.gJsonCache.COPPERAREA;for(var t in e)if(S(e,t)){var r=e[t];qo.resetActiveCopperPolygons(r)}qo.clearOldCopperPolygons()};qo._checkOutlineConflict=function(e){for(var t=qo._fetchCopperAreaOfThisLayer(e.layerid),r=!1,n=0,i=t.length;n<i;n++){var a=t[n];if(a.net&&a.net!=e.net){var o=qo.createPolygonFromPointArr(e.pathStr),s=qo.createPolygonFromPointArr(a.pathStr),l=new ClipperLib.Polygons,c=new ClipperLib.Clipper,d=ClipperLib.PolyFillType.pftNonZero,p=ClipperLib.PolyFillType.pftNonZero;c.AddPolygons([o],ClipperLib.PolyType.ptSubject);c.AddPolygons([s],ClipperLib.PolyType.ptClip);c.Execute(ClipperLib.ClipType.ctIntersection,l,d,p);if(l.length>0){var h=qo.zoomOutPoint(l[0][0]);parent.$.messager.show({title:"error",width:"400",msg:"CopperArea conflict: copper area outlines in same layer with different net names must not overlap",timeout:5e3,showType:"slide"});qo._markError(h);r=!0;break}}}return r};qo.resetActiveCopperPolygons=function(e){if(!e.net)return!1;qo._clearanceWidth=e.clearanceWidth||1;"grid"==e.fillStyle&&(qo._clearanceWidth=qo._clearanceWidth<1?1.5:1.5*qo._clearanceWidth);qo._copperNet=e.net;qo._fillStyle=e.fillStyle;qo._copperLayerId=e.layerid||io.TOPLAYER;qo._padOrViaHasSameNetNameWithCopperArr=[];qo._attachedCopperId=e.gId;qo._copperThermal=e.thermal;qo._copperKeepIsland=e.keepIsland;qo._copperOrder=e.order;if(qo._planeStage){qo._planePolygonArr=qo.createPolygonArrFromComplexPath(e.pathStr);qo._activeCopperPolygons=[]}else{qo._copperOutline=qo.createPolygonFromPointArr(e.pathStr);polygonKey=e.net+"_"+e.layerid;polygonKey in qo.copperPolygons||(qo.copperPolygons[polygonKey]={});qo.copperPolygons[polygonKey][e.gId]=[];qo._activeCopperPolygons=qo.copperPolygons[polygonKey][e.gId]}if("divide"===qo._planeStage)qo.removePlaneZone(e.layerid);else if("zone"===qo._planeStage);else{es.removeFromRTree(e,"COPPERAREA");qo._removeCopperZone();Qo.buildOneNet(qo._copperNet,!1);Ko.hideErrorSymbols()}};qo.createPolygonArrFromComplexPath=function(e){return e.split(/[Mm]/).splice(1).map(function(e){return"M "+e}).map(ui).map(function(e){return e.map(qo.zoomInPoint)})};qo.removePlaneZone=function(e,t){if(e){qo._storePlaneStatus(e);Fo.getAllObjsOf("PLANEZONE",!0).filter(function(t){return t.layerid==e}).forEach(function(e){var r=d(e.gId);t&&zo.save(["del",e.gId,Eo.node.getRefId(r)]);Fo.removeOne(r);t?Ro.appendChild(r):v(r)})}};qo._storePlaneStatus=function(e){qo._prevPlaneStatus={pointsArr:[],ids:{}};Fo.getAllObjsOf("PLANEZONE",!0).filter(function(t){return t.layerid==e}).forEach(function(e){var t=Eo.extend({},e),r=Object.keys(e.pathStrObj)[0];t.points=it(qo._getOuterPath(e.pathStrObj[r]));qo._prevPlaneStatus.pointsArr.push(t);qo._prevPlaneStatus.ids[t.gId]=t})};qo.processOneCopperArea=function(e){(new Date).getTime();qo.loading&&sr("hideLoading",[qo.loading]);qo.loading=sr("showLoading",[{interval:50,title:"Create Grid Path"}]);!e.net&&e.gId&&qo._removeCopperZone(e.gId);if(!e.net){sr("hideLoading",[qo.loading]);return!1}qo._boardOutlines=[];qo.clearOldCopperPolygons();qo.resetActiveCopperPolygons(e);if("none"==e.fillStyle){Qo.buildOneNet(qo._copperNet,!1);sr("hideLoading",[qo.loading]);return!1}var t=qo._connectBoardOutlinesAsPolygon();if(!t){sr("hideLoading",[qo.loading]);return!1}var r=qo._buildCopperZoneOutline(qo._copperOutline,t);if(!r){sr("hideLoading",[qo.loading]);return!1}qo._buildCopperZonesByClipper(r);if("grid"==e.fillStyle){var n=new Worker(d("copperArea_main").value);n.postMessage({type:"grid",copperAreaMgr:O(qo),clipperUrl:d("clipperJsUrl").value});n.onmessage=function(e){if("grid"===e.data.type){qo._showActiveCopperPolygons("grid",e.data.d,e.data.copperAreaMgr);Qo.buildOneNet(e.data.copperAreaMgr._copperNet,!1);sr("hideLoading",[qo.loading])}"createPoint"===e.data.type&&Pi.apply(this,e.data.args);"createLine"===e.data.type&&_i.apply(this,e.data.args)}}else{sr("hideLoading",[qo.loading]);qo._showActiveCopperPolygons(e.fillStyle);Qo.buildOneNet(qo._copperNet,!1)}};qo.processOnePlaneArea=function(e){if(!e.net)return[];qo._boardOutlines=[];qo.resetActiveCopperPolygons(e);var t=qo._connectBoardOutlinesAsPolygon();if(!t)return[];var r=qo._buildCopperZoneOutline(qo._planePolygonArr,t);if(!r)return[];qo._buildCopperZonesByClipper(r);return qo._showActivePlanePolygons()};qo.getGridHalfWidth=function(e){e||(e=qo);var t=1.5;e._clearanceWidth>=t&&(t=e._clearanceWidth);return t/2/1.5};qo._addItemsToClipPolygons=function(){var e=[];qo._boardOutlinesInFootprint=[];var t,r,n,i,a=Fo.getAllObjsOf("PAD",!0),o=Fo.getAllObjsOf("VIA",!0),s=Fo.getAllObjsOf("HOLE",!0),l=Fo.getAllObjsOf("TRACK",!0,!0),c=Fo.getAllObjsOf("ARC",!0,!0),p=Fo.getAllObjsOf("SOLIDREGION",!0,!0),h=Fo.getAllObjsOf("TEXT",!0,!0),u=Fo.getAllObjsOf("RECT",!0,!0),f="grid"===qo._fillStyle;qo._crosshairData=[];qo._planeStage&&(i=0);var g=function(e){return e.net===qo._copperNet};if(!qo._planeStage||"divide"===qo._planeStage){for(t=0,r=l.length;t<r;t++){var y=l[t];if(!g(y)&&qo._isOnCopperLayer(y.layerid)){n=qo._transformTrackWithClearanceToPolygon(y,i);e=e.concat(n)}}for(t=0,r=c.length;t<r;t++){var v=c[t];if(!g(v)&&qo._isOnCopperLayer(v.layerid)){n=qo._transformArcWithClearanceToPolygon(v,i);e=e.concat(n)}}}if("divide"===qo._planeStage)return e;for(t=0,r=h.length;t<r;t++){var x=h[t];if(qo._isOnCopperLayer(x.layerid)){var m=Eo.svg.getBBox(d(x.gId));e.push(qo._transformRectWithClearanceToPolygon(m))}}for(t=0,r=u.length;t<r;t++){var C=u[t];qo._isOnCopperLayer(C.layerid)&&e.push(qo._transformRectWithClearanceToPolygon(C))}for(t=0,r=p.length;t<r;t++){var L=p[t];if(qo._isOnCopperLayer(L.layerid)&&!g(L)){n="npth"===L.type||"cutout"===L.type?qo._transformPolygonWithClearanceToPolygon(L.pathStr,0):qo._transformPolygonWithClearanceToPolygon(L.pathStr,Math.max(Ai(L.net).clearance,qo._clearanceWidth));e.push(n)}}var _=null,P=null;qo._padOrViaHasSameNetNameWithCopperArr=[];var A;for(t=0,r=o.length;t<r;t++){var b=o[t];_=qo._transformPadOrViaWithClearanceToPolygon(b);A={cmd:"VIA",fid:0,gId:b.gId,layerid:b.layerid,diameter:b.diameter,x:b.x,y:b.y};if(g(b)){
qo._padOrViaHasSameNetNameWithCopperArr.push(A);(function(e){return!!f||!g(e)})(b)&&qo._crosshairData.push(qo._transformPadOrViaWithClearanceToPolygon(b,0))}else _&&e.push(_)}var S=[];for(t=0,r=s.length;t<r;t++){_=qo._transformHoleWithClearanceToPolygon(s[t]);_&&e.push(_)}for(t=0,r=a.length;t<r;t++){var E=a[t];!function(e,t,r){if(g(t)&&qo._isOnCopperLayer(t.layerid)){var n={cmd:"PAD",fid:r,gId:t.gId,layerid:t.layerid,shape:t.shape,pointArr:t.pointArr,pointArr2:t.pointArr2,width:t.width,height:t.height,x:t.x,y:t.y};qo._padOrViaHasSameNetNameWithCopperArr.push(n)}qo._isOnCopperLayer(t.layerid)&&e.push(t)}(S,E)}S.forEach(function(t){_=qo._transformPadOrViaWithClearanceToPolygon(t);P=qo._transformPadOrViaWithClearanceToPolygon(t,0);D(_)&&_.forEach(function(t){e.push(t)});D(P)&&P.forEach(function(e){g(t)&&qo._crosshairData.push(e)})});return e};qo._addCopperItemsToClipPolygons=function(){var e=[],t=Fo.getAllObjsOf("COPPERAREA",!0,!0);for(i=0,l=t.length;i<l;i++){var r=t[i];if(qo._isOnCopperLayer(r.layerid)&&r.net!=qo._copperNet&&Number(r.order)<Number(qo._copperOrder)){if(r.clearanceWidth>qo._clearanceWidth)var n=r.clearanceWidth;else n=qo._clearanceWidth;e.push(qo._transformPolygonWithClearanceToPolygon(r.pathStr,n))}}return e};qo._buildCopperZonesByClipper=function(e){var t=qo._addItemsToClipPolygons(),r=qo._addCopperItemsToClipPolygons(),n=new ClipperLib.Polygons,i=new ClipperLib.ExPolygons,a=new ClipperLib.Clipper;if(qo._planeStage){n.push(e.outer);e.holes&&e.holes.forEach(function(e){n.push(e)})}else n.push(e);var o=t.concat(r),s=ClipperLib.PolyFillType.pftNonZero,l=ClipperLib.PolyFillType.pftNonZero;qo._planeStage||o.forEach(function(e){st(e)||(e=e.reverse())});a.AddPolygons(n,ClipperLib.PolyType.ptSubject);a.AddPolygons(o,ClipperLib.PolyType.ptClip);a.Execute(ClipperLib.ClipType.ctDifference,i,s,l);qo._fixExPolygonsSolutions(i);qo._createCopperPolygons(i)};qo._fixExPolygonsSolutions=function(e){function t(e){for(var t=e[0].x,r=e[0].x,n=e[0].y,i=e[0].y,a=1;a<e.length;a++){var o=e[a];t=Math.min(o.x,t);r=Math.max(o.x,r);n=Math.min(o.y,n);i=Math.max(o.y,i)}return{minX:t,minY:n,maxX:r,maxY:i,w:r-t,h:i-n}}function r(e,t){return e.w<t.w||e.h<t.h?-1:1}function n(e,n,a,o){a=a||t(e);o=o||t(n);if(r(a,o)>0)return!1;for(var s=0,l=e.length;s<l;s++)if(i(e[s],n,o))return!0;return!1}function i(e,r,n){n=n||t(r);if(e.x<n.minX||e.x>n.maxX||e.y<n.minY||e.y>n.maxY)return!1;var i=!1,a=0,o=r.length-1;for(o;a<r.length;o=a++)r[a].y>e.y!=r[o].y>e.y&&e.x<(r[o].x-r[a].x)*(e.y-r[a].y)/(r[o].y-r[a].y)+r[a].x&&(i=!i);return i}if(!(e.length<2)){var a=e.map(function(e){return e.outer}),o=e.map(function(e){return t(e.outer)}),s=[].concat.apply([],e.map(function(e){return e.holes})),l=s.map(function(e){return t(e)}),c=[];s.forEach(function(e,t){if(e&&!(e.length<3)){for(var i=l[t],s=c[t],d=0,p=o.length;d<p;d++){var h=o[d];n(e,a[d],i,h)&&(void 0===s||r(h,o[s])<0)&&(s=d)}c[t]=s}});e.forEach(function(e,t){e.holes=[]});s.forEach(function(t,r){var n=c[r];void 0!==n&&e[n].holes.push(t)})}};qo._createCopperPolygons=function(e){e.forEach(function(e){var t,r,n,i=[];for(t=0,r=qo._padOrViaHasSameNetNameWithCopperArr.length;t<r;t++){n=qo._padOrViaHasSameNetNameWithCopperArr[t];if(n&&qo.testPolygonContainsPoint(e,qo.zoomInPoint(n),n)){i.push(n);delete qo._padOrViaHasSameNetNameWithCopperArr[t]}}("yes"==qo._copperKeepIsland||"none"==qo._copperKeepIsland&&i.length>0)&&qo._activeCopperPolygons.push({connectedPadOrViaArr:i,polygon:e})})};qo.createPolygonFromPointArr=function(e){"string"==typeof e&&(e=ui(e));return e.map(qo.zoomInPoint)};qo.transformLineToOutlineBox=function(e,t){var r=null;"string"==typeof pointArr&&(pointArr=ui(pointArr));r=ClipperLib.OffsetPolyline(e.map(qo.zoomInPoint),qo.zoomInOffsetVal(t));var n=[];if(r[0]&&r[0].length)for(var i=0,a=r[0].length;i<a;i++){var o=qo.zoomOutPoint(r[0][i]);n.push(new c(o.x,o.y))}return n};qo._transformTrackWithClearanceToPolygon=function(e,t){var r=null,n=Math.max(Ai(e.net).clearance,qo._clearanceWidth);"number"==typeof t&&(n=Math.min(n,t));r=ClipperLib.OffsetPolyline(e.pointArr.map(qo.zoomInPoint),qo.zoomInOffsetVal(n+e.strokeWidth/2));return r};qo._transformArcWithClearanceToPolygon=function(e,t){var r=pi(e,!0),n=null,i=Math.max(Ai(e.net).clearance,qo._clearanceWidth);"number"==typeof t&&(i=Math.min(i,t));n=ClipperLib.OffsetPolyline(r,qo.zoomInOffsetVal(i+e.strokeWidth/2+Ko.CirclePolygonDeviation));return n};qo._transformRectWithClearanceToPolygon=function(e){var t=Eo.convertRect2Polygon(e.x,e.y,e.width,e.height).join(" "),r=Math.max(Ai(e.net).clearance,qo._clearanceWidth);return ClipperLib.OffsetPolygon(N(V(t)).map(qo.zoomInPoint),qo.zoomInOffsetVal(r))[0]};qo._transformPolygonWithClearanceToPolygon=function(e,t){e=ui(e);maxCW=void 0!==typeof t?t:qo._clearanceWidth;return ClipperLib.OffsetPolygon(e.map(qo.zoomInPoint),qo.zoomInOffsetVal(maxCW))[0]};qo._transformHoleWithClearanceToPolygon=function(e){var t=null,r=Math.max(Ai("").clearance,qo._clearanceWidth);t=ClipperLib.OffsetPoint(qo.zoomInPoint(e),qo.zoomInOffsetVal(r+e.holeR+Ko.CirclePolygonDeviation));return t[0]};qo._transformPadOrViaWithClearanceToPolygon=function(e,t){var r=!e.shape,n=null,i=Math.max(Ai(e.net).clearance,qo._clearanceWidth);if("ELLIPSE"==e.shape||r){var a=r?e.diameter/2:e.width/2;n=ClipperLib.OffsetPoint(qo.zoomInPoint(e),qo.zoomInOffsetVal(void 0!==t?t+a:i+a+Ko.CirclePolygonDeviation))}else n=ClipperLib.OffsetPolygon((e.pointArr||[]).map(qo.zoomInPoint),qo.zoomInOffsetVal(i));return r?n[0]:"direct"==qo._copperThermal?"grid"===qo._fillStyle?n:e.net==qo._copperNet?[]:n:"grid"===qo._fillStyle?n:e.net==qo._copperNet?qo._createThermalReliefPadHoles(n,e,i):n};qo._createThermalReliefPadHoles=function(e,t,r){var n,i=[];if("POLYGON"==t.shape){n=Eo.svg.getBBoxMerged(p("#"+t.gId+">:not([c_padid])"));t.width=n.width;t.height=n.height}i.push(t.x-t.width/2-r,t.y,t.x+t.width/2+r,t.y,t.x,t.y-t.height/2-r,t.x,t.y+t.height/2+r);i=ge(i,360-t.rotation,t.x,t.y);var a=ClipperLib.OffsetPolyline([{x:i[0],y:i[1]},{x:i[2],y:i[3]}].map(qo.zoomInPoint),qo.zoomInOffsetVal(.25*t.height)),o=ClipperLib.OffsetPolyline([{x:i[4],y:i[5]},{x:i[6],y:i[7]}].map(qo.zoomInPoint),qo.zoomInOffsetVal(.25*t.width)),s=[a[0],o[0]],l=e,c=new ClipperLib.Polygons,d=ClipperLib.PolyFillType.pftNonZero,h=ClipperLib.PolyFillType.pftNonZero,u=new ClipperLib.Clipper;u.AddPolygons(l,ClipperLib.PolyType.ptSubject);u.AddPolygons(s,ClipperLib.PolyType.ptClip);u.Execute(ClipperLib.ClipType.ctDifference,c,d,h);return c};qo._createSimplePolygon=function(e,t,r){if(!e)return"";r=r||1;var n=zt("polygon",{points:function(e){function t(e){return e*r}e=e.trim().replace(/[, ]+/g," ");e=e.split(" ").map(t).join(" ");return e}(e),"stroke-width":0,c_shapetype:"line",layerid:t});Ls.appendElement(n);sentElementToBack(n)};qo._convertContourPointsToPath=function(e){function t(e){return[e.x/qo._scaleFactor,e.y/qo._scaleFactor].join(",")}return"M"+e.map(t).join(" ")+"z"};qo.showOrHideCopperZone=function(e){for(var t="invisible"==e?"none":"",r=p("path[attachedcopperid]",Ka),n=0,i=r.length;n<i;n++)m(r[n],"display",t)};qo._showActiveCopperPolygons=function(e,t,r){r||(r=qo);var n=r._activeCopperPolygons,i=[],a=[],o=2*qo.getGridHalfWidth(r);n.forEach(function(n){var s=n.polygon;if(s){var l;l="grid"==e?t+"z":qo._convertContourPointsToPath(s.outer);if("grid"!==e)for(var c=0,d=s.holes.length;c<d;c++)s.holes[c]&&s.holes[c].length>=3&&(l+=qo._convertContourPointsToPath(s.holes[c]));var p=r._copperLayerId,h=zt("path",{id:Eo.newId(),d:l,"stroke-width":t?o:0,fill:t?"none":"#FF0000",layerid:p,attachedcopperid:qo._attachedCopperId,c_shapetype:"line",display:"invisible"==Zo.canvas.copperZone?"none":""});Ls.appendElement(h);var u=h.nextSibling,f=u&&u.id||"";f?i.push(["add",h.id,f]):i.push(["add",h.id]);a.push(h)}});i.length;return a};qo._showActivePlanePolygons=function(){var e=qo._activeCopperPolygons,t=qo._copperLayerId,r={layerid:t,c_partid:"part_plane"};"zone"===qo._planeStage&&(r.id="planeL"+t+"B"+qo._planeBlockId);Ls.getActiveLayer()==t&&(r.class="current-layer");var n=zt("g",r);e.forEach(function(e,r){var i=e.polygon;if(i){for(var a=qo._convertContourPointsToPath(i.outer),o=0,s=i.holes.length;o<s;o++)i.holes[o]&&i.holes[o].length>=3&&(a+=qo._convertContourPointsToPath(i.holes[o]));var l,c={d:a,"stroke-width":0};"divide"===qo._planeStage?c.id="planeL"+t+"B"+r:c.id="planeL"+t+"B"+qo._planeBlockId+"I"+r;l=zt("path",c);n.appendChild(l)}});"zone"===qo._planeStage&&Ls.appendElement(n);return n};qo._removeCopperZone=function(e){e=e||qo._attachedCopperId;for(var t=p('path[attachedcopperid="'+e+'"]',Ka),r=0,n=t.length;r<n;r++)Ka.removeChild(t[r])};qo.switchDisplayCoppersAndOthers=function(e){for(var t=0,r=Ka.childNodes.length;t<r;t++){var n=Ka.childNodes[t];"all"==e?m(n,"display",""):m(n,"attachedcopperid")?m(n,"display","copper"==e?"":"none"):m(n,"display","copper"!=e?"":"none")}};qo.testSimplyPolygonContainsPoint=function(e,t){for(var r=0,n=e.length,i=0,a=n-1;i<n;a=i++){var o=e[i].x,s=e[i].y,l=e[a].x,c=e[a].y;if(!(s>t.y&&c>t.y)&&!(s<=t.y&&c<=t.y)){l-=o;c-=s;t.x-o<(t.y-s)*l/c&&r++}}return r>0&&r%2==1};qo.testSimplyPolygonsContainsPoint=function(e,t){for(var r=0;r<e.length;r++)if(qo.testSimplyPolygonContainsPoint(e[r],t))return!0;return!1};qo.testPolygonIntersectsCircle=function(e,t,r){var n;r*=qo._scaleFactor;for(var i=0;i<e.length;i++){n=fe(e[i].x,e[i].y,t.x,t.y);if(n<=r)return!0}return!1};qo.testPolygonIntersectsPolygon=function(e,t){for(var r=0;r<e.length;r++)if(qo.testSimplyPolygonContainsPoint(t,qo.zoomInPoint(e[r])))return!0;return!1};qo.testPolygonContainsPoint=function(e,t,r){var n,i,a=qo.testSimplyPolygonContainsPoint(e.outer,t);if(a){i=e.holes.length;if(i>0)for(n=0,l=i;n<l;n++)if(qo.testSimplyPolygonContainsPoint(e.holes[n],t)){if("VIA"==r.cmd||"ELLIPSE"==r.shape){if(qo.testPolygonIntersectsCircle(e.holes[n],t,"VIA"==r.cmd?r.diameter/2:r.width/2)){a=!0;break}}else if(("POLYGON"==r.shape||"RECT"==r.shape||"OVAL"==r.shape)&&qo.testPolygonIntersectsPolygon(e.holes[n],r.pointArr)){a=!0;break}a=!1;break}}return a};qo.PRECISION=5;qo._collectionBoardOutlines=function(e){var t,r,n;if(e.d){r=pi(e,!1);if(ls.distancePointToPoint(r[0],r[r.length-1])<qo.PRECISION){t=!0;Pe(r[0],r[r.length-1])||r.push(r[0])}qo._boardOutlines.push({id:e.gId,pointArr:r,isConnected:!1,isSelfClose:t})}else{n=O(e.pointArr);if(ls.distancePointToPoint(e.pointArr[0],e.pointArr[e.pointArr.length-1])<qo.PRECISION){t=!0;Pe(e.pointArr[0],e.pointArr[e.pointArr.length-1])||n.push(e.pointArr[0])}qo._boardOutlines.push({id:e.gId,pointArr:n,isConnected:!1,isSelfClose:t})}};qo._connectBoardOutlinesAsPolygon=function(){function e(e){for(var t,r=null,n={d:1e5},i=0,o=a.length;i<o;i++){t=a[i];if(!t.isConnected){var s=ls.distancePointToPoint(e,t.pointArr[0]);s<n.d&&(n={d:s,index:i,point:"start"});s=ls.distancePointToPoint(e,t.pointArr[t.pointArr.length-1]);s<n.d&&(n={d:s,index:i,point:"end"})}}if(n.d<=qo.PRECISION){t=a[n.index];t.isConnected=!0;r="start"==n.point?t.pointArr:t.pointArr.reverse()}return r}var t=Fo.getAllObjsOf("TRACK",!0),r=Fo.getAllObjsOf("ARC",!0);qo._boardOutlines=[];var n,i;for(n=0,i=t.length;n<i;n++)t[n].layerid==io.BOARDOUTLINE&&qo._collectionBoardOutlines(t[n]);for(n=0,i=r.length;n<i;n++)r[n].layerid==io.BOARDOUTLINE&&qo._collectionBoardOutlines(r[n]);var a=qo._boardOutlines;if(a.length<1){qo.loading&&sr("hideLoading",[qo.loading]);parent.$.messager.error("Please create board outline first.");return!1}!function(){for(var e={l:0},t=0,r=a.length;t<r;t++){var n=ls.getLengthOfTrackAndArc(a[t],!1);if(n>e.l){e.l=n;e.index=t}}if(e.index>0){a.unshift(a[e.index]);a.splice(e.index+1,1)}}();var o=a[0].pointArr;a[0].isConnected=!0;for(var s,l,c=o,d=o[0],h=o[o.length-1],u=p('[layerid="'+io.BOARDOUTLINE+'"]').length;!function(){for(var e=!0,t=0,r=a.length;t<r;t++)if(!a[t].isConnected){e=!1;break}return e}();){s=e(h);s||(l=e(d));if(s){c=c.concat(s);h=s[s.length-1]}else{if(!l)break;c=l.reverse().concat(c);d=c[0]}}if(!(s||u>0&&a.length<u||1===a.length&&o.length>=4&&ls.distancePointToPoint(o[0],o[o.length-1])<=qo.PRECISION)){var f=h;if(!a[0].isSelfClose&&ls.distancePointToPoint(c[0],c[c.length-1])>qo.PRECISION||1===a.length&&o.length>=4&&ls.distancePointToPoint(o[0],o[o.length-1])>qo.PRECISION){parent.$.messager.show({title:"Warning",width:"200",msg:"Board outlines are not closed",timeout:15e3,showType:"slide"});qo._markError(f)}else{var g=[];a.forEach(function(e){g.push(e.pointArr)});Ut(g.slice(1),qo.PRECISION).closed.length}}var y=new ClipperLib.Clipper,v=y.SimplifyPolygons([c.map(qo.zoomInPoint)],ClipperLib.PolyFillType.pftNonZero);return qo._findMaxPolygons(v,y)};qo._findMaxPolygons=function(e,t){function r(e,r){return t.Area(e)>t.Area(r)?-1:1}return e.length<2?e[0]:e.sort(r)[0]};qo._getBBoxOfClipperedPoint=function(e){for(var t,r,n,i,a,o=0;o<e.length;o++){a=e[o];if(t||r||n||i){+a.x<t&&(t=+a.x);+a.y<r&&(r=+a.y);+a.x>n&&(n=+a.x);+a.y>i&&(i=+a.y)}else{t=+a.x;r=+a.y;n=+a.x;i=+a.y}}return{x:t/qo._scaleFactor,y:r/qo._scaleFactor,width:(n-t)/qo._scaleFactor,height:(i-r)/qo._scaleFactor}};qo.getPolygonBoardOutline=function(){var e=Fo.getAllObjsOf("TRACK",!0,!1,[io.BOARDOUTLINE]),t=Fo.getAllObjsOf("ARC",!0,!1,[io.BOARDOUTLINE]),r=1;qo._boardOutlines=[];var n,i;for(n=0,i=e.length;n<i;n++){qo._collectionBoardOutlines(e[n]);e[n].strokeWidth>r&&(r=e[n].strokeWidth)}for(n=0,i=t.length;n<i;n++){qo._collectionBoardOutlines(t[n]);t[n].strokeWidth>r&&(r=t[n].strokeWidth)}r/=2;var a=qo._boardOutlines;if(a.length<1)return null;var o,s,l,c=new ClipperLib.Polygons,d=new ClipperLib.Polygons,p=new ClipperLib.ExPolygons,h=ri(),u=Eo.bbox2Polygon(h),f=new ClipperLib.Clipper;u.push(u[0]);d.push(u.map(qo.zoomInPoint));f.AddPolygons(d,ClipperLib.PolyType.ptSubject);for(n=0,i=a.length;n<i;n++){o=a[n];s=o.pointArr;l=ClipperLib.OffsetPolyline(s.map(qo.zoomInPoint),qo.zoomInOffsetVal(r));c=c.concat(l)}f.AddPolygons(c,ClipperLib.PolyType.ptClip);f.Execute(ClipperLib.ClipType.ctDifference,p,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);var g=[];for(n=0;n<p.length;n++){g[n]={area:Math.abs(ClipperLib.Clipper.Area(p[n].outer)),index:n,points:p[n].outer};l=ClipperLib.OffsetPolygon(p[n].outer,qo.zoomInOffsetVal(r),ClipperLib.JoinType.jtMiter);g[n].pathStr="M"+l[0].map(function(e){return e.x/qo._scaleFactor+" "+e.y/qo._scaleFactor})+"z"}g.sort(function(e,t){return e.area>t.area?-1:e.area<t.area?1:0});if(!g.length)return null;var y=qo._getBBoxOfClipperedPoint(g[0].points);g.length>1&&(_e(y.width,h.width,1e-4)||_e(y.height,h.height,1e-4))&&g.splice(0,1);return{outer:g[0].pathStr,holes:g.slice(1).map(function(e){return e.pathStr})}};qo._buildCopperZoneOutline=function(e,t){var r=new ClipperLib.ExPolygons,n=new ClipperLib.Clipper,i=ClipperLib.PolyFillType.pftNonZero,a=ClipperLib.PolyFillType.pftNonZero;if(qo._planeStage){var o=new ClipperLib.Polygons;e.forEach(function(e){o.push(e)});n.AddPolygons(o,ClipperLib.PolyType.ptSubject)}else n.AddPolygons([e],ClipperLib.PolyType.ptSubject);n.AddPolygons([t],ClipperLib.PolyType.ptClip);n.Execute(ClipperLib.ClipType.ctIntersection,r,i,a);return qo._planeStage?!!r.length&&r[0]:!!r.length&&r[0].outer};qo.isBuiltCopperArea=function(){for(var e in Fo.gJsonCache.COPPERAREA)if(S(Fo.gJsonCache.COPPERAREA,e)){var t=Fo.gJsonCache.COPPERAREA[e],r=t.net+"_"+t.layerid,n=Fo.gJsonCache.SIGNALS[t.net];n&&(n=n.filter(function(e){return"COPPERAREA"!=e.cmd}));if(!qo.copperPolygons[r]||!qo.copperPolygons[r][t.gId]||!qo.copperPolygons[r][t.gId].length){if("none"==t.keepIsland){if(n&&n.length>0)return!1;continue}return!1}}return!0};qo.simplifySelfIntersectingPolygon=function(e){function t(e,t,n,i){var a,s,l,c=[],d="Z"==i[0]?"L":i[0];if("L"==d){t.x<n.x?e.sort(function(e,t){return e.x-t.x}):t.x>n.x?e.sort(function(e,t){return t.x-e.x}):t.y<n.y?e.sort(function(e,t){return e.y-t.y}):t.y>n.y&&e.sort(function(e,t){return t.y-e.y});for(a=0;a<e.length;a++)c.push({p:e[a],segWithPre:["L"],segWithAfter:["L"]})}else if("A"==d){var p=i.slice(0,6),h=p[p.length-1],u=i.slice(0,6);u[5]="1"==h?"0":"1";var f;for(a=0;a<e.length;a++){var g=e[a];Math.abs(g.x-t.x)<.001&&Math.abs(g.y-t.y)<.001?t=g:Math.abs(g.x-n.x)<.001&&Math.abs(g.y-n.y)<.001&&(n=g)}c.push({p:t,segWithPre:[],segWithAfter:p});c.push({p:n,segWithPre:u,segWithAfter:[]});var y="M "+t.x+" "+t.y+" "+p.join(" ")+" "+n.x+" "+n.y;y=Ke(y);var v=qe(y),x=fe(v.x,v.y,y.M.x,y.M.y);for(a=0;a<e.length;a++){g=e[a];f=-1;for(l=0;l<c.length;l++)o(c[l].p,g)&&(f=l);if(-1==f)for(s=0;s<c.length-1;s++){var m=c[s].p,C=c[s+1].p,L=c[s].segWithAfter.slice(0),_=c[s+1].segWithPre.slice(0);y="M "+m.x+" "+m.y+" "+L.join(" ")+" "+C.x+" "+C.y;var P=Math.sqrt(Math.pow(g.x-v.x,2)+Math.pow(g.y-v.y,2))/x-1;if(!(P>1e-4)&&$e(y,g)){if("0"==L[4])c.splice(s+1,0,{p:g,segWithPre:c[s+1].segWithPre,segWithAfter:L});else if("1"==L[4]){var A=r(L,m,C,g);if("endLargeArc"==A){var b=c[s+1].segWithPre.slice(0);b[4]="0";c[s].segWithAfter[4]="0";c.splice(s+1,0,{p:g,segWithPre:b,segWithAfter:L})}else if("startLargeArc"==A){var S=c[s].segWithAfter.slice(0);S[4]="0";c[s+1].segWithPre[4]="0";c.splice(s+1,0,{p:g,segWithPre:_,segWithAfter:S})}else{c[s].segWithAfter[4]="0";c[s+1].segWithPre[4]="0";c.splice(s+1,0,{p:g,segWithPre:c[s+1].segWithPre,segWithAfter:c[s].segWithAfter})}}break}}}}return c}function r(e,t,r,n){var i="M "+t.x+" "+t.y+" "+e.join(" ")+" "+r.x+" "+r.y,a=e[5];i=Ke(i);var o=qe(i),s={x:o.x-t.x,y:-(o.y-t.y)},l={x:o.x-r.x,y:-(o.y-r.y)},c={x:o.x-n.x,y:-(o.y-n.y)},d=Math.atan2(l.y,l.x)-Math.atan2(s.y,s.x);d<0&&(d+=2*Math.PI);d<Math.PI&&(d=2*Math.PI-d);var p=Math.atan2(l.y,l.x)-Math.atan2(c.y,c.x);if("1"==a){p>0&&(p=2*Math.PI-Math.abs(p));p=Math.abs(p)}else{p<0&&(p=2*Math.PI-Math.abs(p));p=Math.abs(p)}p>d&&(p=2*Math.PI-p);if(p>Math.PI)return"endLargeArc";var h=Math.atan2(c.y,c.x)-Math.atan2(s.y,s.x);if("1"==a){h>0&&(h=2*Math.PI-Math.abs(h));h=Math.abs(h)}else{h<0&&(h=2*Math.PI-Math.abs(h));h=Math.abs(h)}h>d&&(h=2*Math.PI-h);return h>Math.PI&&"startLargeArc"}function n(e,t,r){var a,o=i(e,t,r);o.length;if(!(o.length<1)){var s=o[0].p,d=o[0].seg;if(d){var p,h="Z"==d[0]?"L":d[0],u="",f="";if("L"==h){u="L "+s.x+" "+s.y+" ";f="M "+e.x+" "+e.y+" L "+s.x+" "+s.y;p=["L"]}else if("A"==h){u=d.join(" ")+" "+s.x+" "+s.y+" ";f="M "+e.x+" "+e.y+" "+d.join(" ")+" "+s.x+" "+s.y;p=d}if(u){for(var g=0;g<c.length;g++)if(c[g].pathSegmentData==f)return;-1==l.indexOf(s)&&l.push(s);c.push({start:e,end:s,segData:p,pathSegmentData:f,pathSegment:u})}}if("L"==h)a={x:s.x-e.x,y:-(s.y-e.y)};else{a=pt("M "+e.x+" "+e.y+" "+d.join(" ")+" "+s.x+" "+s.y,s)}n(s,a,e)}}function i(e,t,r){var n,i,o,s,l,c,d,p,h=[],u=e.x+"_"+e.y,f=g[u];if(!f)return[];var y=f,v=[];for(i=0;i<y.length;i++){s=y[i].p;l=y[i].seg;if("L"==l[0]){c={x:s.x-e.x,y:-(s.y-e.y)};d=c}else if("A"==l[0]){var x="M "+e.x+" "+e.y+" "+l.join(" ")+" "+s.x+" "+s.y;c=pt(x,e);d={x:s.x-e.x,y:-(s.y-e.y)}}n=a(c,t,r,s);p=a(d,t,r,s);Math.abs(n-Math.PI)<.001&&p<=0&&(n=-Math.PI);Math.abs(n+Math.PI)<.001&&p>0&&(n=Math.PI);if(0==h.length)h.push({p:s,seg:l,angle:n,vector:c,endAngle:p});else for(o=0;o<h.length;o++)if(n-h[o].angle>.001||Math.abs(n-h[o].angle)<.001&&p>h[o].endAngle){h.splice(o,0,{p:s,seg:l,angle:n,vector:c,endAngle:p});break}}h.length>0&&h.forEach(function(e){v.push({p:e.p,seg:e.seg})});return v}function a(e,t,r,n){var i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);i>Math.PI||i==Math.PI&&o(r,n)?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI);Math.abs(e.x+t.x)<.001&&Math.abs(e.y+t.y)<.001&&(i=-Math.PI);Math.abs(e.x)<1e-5&&Math.abs(t.x)<1e-5&&e.y*t.y<0?i=-Math.PI:Math.abs(e.y)<1e-5&&Math.abs(t.y)<1e-5&&e.x*t.x<0&&(i=-Math.PI);return i}function o(e,t){return e.x==t.x&&e.y==t.y}if(!0===qo.notCopperAreaIntersect(e))return!0;var s=m(e,"d"),l=[],c=[];if(s){var d=function(e){var t,r,n,i,a,o,s,l,c,d,p={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"},u=/([MZLHVCSQTAmzlhvcsqta])([eE ,\-\+.\d]+)*/g,f=e.match(u),g=[];if(!f||!f.length)return[];for(t=0;t<f.length;t++){r=u.exec(e);if(Array.isArray(r)&&3===r.length&&r[2]&&r[2].trim()){a=r[2].match(/(?:[-+]?(?:(?:\d+\.\d+)|(?:(?:\d+)|(?:\.\d+)))(?:e[-+]?\d+)?)/gi);s=r[1].toLowerCase();if(p[s]&&(l=p[s])&&a.length>l){c=h[r[1]]?h[r[1]]:r[1];d=r[1];for(n=0,i=a.length;n<i;n+=l){o=a.slice(n,n+l);o.unshift(d);g.push(o);d=c}}else{a.unshift(r[1]);g.push(a)}}else{a=[r[1]];"z"==a[0]&&(a[0]="Z");g.push(a)}}return g}(s),p=function(e){for(var t=[],r=[],n=[],i=1;i<e.length;i++){var a=e[i-1],o=e[i];r="M"+a[a.length-2]+" "+a[a.length-1]+" "+o.join(" ");if("L"==o[0])t={p1:{x:+a[a.length-2],y:+a[a.length-1]},p2:{x:+o[1],y:+o[2]}};else if("A"==o[0]){t={p1:{x:+a[a.length-2],y:+a[a.length-1]},p2:{x:+o[o.length-2],y:+o[o.length-1]}};var s=fe(t.p1.x,t.p1.y,t.p2.x,t.p2.y);if(o[1]<s/2){o[1]=o[2]=s/2+"";r="M"+a[a.length-2]+" "+a[a.length-1]+" "+o.join(" ")}}else{if("Z"!=o[0])return;r="M"+a[a.length-2]+" "+a[a.length-1]+" L "+e[0][1]+" "+e[0][2];t={p1:{x:+a[a.length-2],y:+a[a.length-1]},p2:{x:+e[0][1],y:+e[0][2]}}}n.push({path:o,line:r,data:t})}return n}(d),h=function(e){for(var t,r,n,i,a=[],o=[],s=0;s<p.length;s++){t=p[s].line;var l=p[s].data;r="Z"==p[s].path[0]?"L":p[s].path[0];if("A"==r){var c=zt("path",{d:t}),d=Eo.svg.getBBox(c);if(Math.abs(d.x-e)>1)continue;n=Ke(t);i=qe(n);Math.abs(i.x-n.A.rx-e)<1&&o.push({p:{x:i.x-n.A.rx,y:i.y},index:s});Math.abs(n.A.x-e)<.01&&o.push({p:{x:n.A.x,y:n.A.y},index:s});Math.abs(n.M.x-e)<.01&&o.push({p:{x:n.M.x,y:n.M.y},index:s});o=o.filter(function(e){return!(isNaN(e.p.x)||isNaN(e.p.y)||!$e(n,e.p,i))});o.length>0&&(a=a.concat(o))}else if("L"==r){Math.abs(l.p1.x-e)<.01&&a.push({p:l.p1,index:-1});Math.abs(l.p2.x-e)<.01&&a.push({p:l.p2,index:-1})}}var h;a.forEach(function(e){void 0==h?h=e.p.x:e.p.x<h&&(h=e.p.x)});a=a.filter(function(e){return e.p.x==h});a.sort(function(e,t){return t.p.y-e.p.y});if(0!=a.length)return a[0].p}(Eo.svg.getBBox(e).x);if(h&&void 0!=h.x&&void 0!=h.y){var u=function(e){var t,r,n,i,a,s,l=[],c=[];c.push(h);for(var d=0;d<e.length-1;d++){n=e[d].data;t=e[d].line;e[d].path;a=e[d].path[0];for(var p=d+1;p<e.length;p++){i=e[p].data;r=e[p].line;e[p].path;s=e[p].path[0];var u="Z"==s?"L":s;"L"==a&&"L"==u?l=le(n.p1,n.p2,i.p1,i.p2)||[]:"L"==a&&"A"==u?l=Qe(r,n.p1,n.p2)||[]:"A"==a&&"L"==u?l=Qe(t,i.p1,i.p2)||[]:"A"==a&&"A"==u&&(l=Ze(t,r)||[]);l&&!D(l)&&(l=[l]);o(n.p1,i.p2)||o(n.p1,i.p1)?l.unshift(n.p1):(o(n.p2,i.p1)||o(n.p2,i.p2))&&l.unshift(n.p2);if(l&&l.length>0)for(var f=0;f<l.length;f++){var g=c.some(function(e){return Math.abs(e.x-l[f].x)<.001&&Math.abs(e.y-l[f].y)<.001});g||c.push(l[f])}}}return c}(p);p=function(e,r){for(var n,i,a=[],o=!1,s=[],l=0;l<e.length;l++){n=e[l].data;var c=e[l].path,d=e[l].line,p="Z"==c[0]?"L":c[0];"1"==c[4];for(var h=0;h<r.length;h++){i=r[h];"L"==p?o=Ve(i,n.p1,n.p2):"A"==p&&(o=dt(d,i));o&&a.push(i)}a.length>0&&(s=t(a,n.p1,n.p2,c));e[l].dividedPoints=a;e[l].sortDividedPoints=s;a=[];s=[]}return e}(p,u);var g=function(e,t){for(var r,n,i,a,s,l,c={},d=0;d<t.length;d++){r=t[d];n=r.x+"_"+r.y;c[n]=[];for(var p=0;p<e.length;p++){i=e[p].sortDividedPoints;var h=(e[p].data,e[p].path);for(a=0;a<i.length;a++){if(o(i[a].p,r))break}if(a>-1&&a<i.length){var u="Z"==h[0]?["L"]:h.slice(0,-2);if(a-1>=0){s=c[n].some(function(e){return o(e.p,i[a-1].p)&&u.toString()==e.seg.toString()});if(!s){l={p:i[a-1].p,seg:i[a].segWithPre};c[n].push(l)}}if(a+1<=i.length-1){s=c[n].some(function(e){return o(e.p,i[a+1].p)&&u.toString()==e.seg.toString()});if(!s){l={p:i[a+1].p,seg:i[a].segWithAfter};c[n].push(l)}}}}}return c}(p,u),y={x:10,y:0};l.push(h);n(h,y,h);for(var v="M "+h.x+" "+h.y+" ",x=0;x<c.length;x++)v+=c[x].pathSegment;v+=" Z";m(e,"d",v);f(e,"active")&&dr(e);return!0}}};qo.simplifySelfIntersectingPolygonOld=function(e){function t(e){return[e.x/qo._scaleFactor,e.y/qo._scaleFactor].join(",")}var r=m(e,"d");if(!r)return!0;var n=qo.notCopperAreaIntersect(e);if(!0===n)return!0;if(r.match(/a/gi)){if("path is illegal"!==n){var i="COPPERAREA"==Z(e)?"Copper Area do not allow self-intersection!":"Solid Region do not allow self-intersection!";parent.$.messager.alert(i);return!1}return!0}var a,o,s=new ClipperLib.Clipper,l=new ClipperLib.Polygons,c=qo.createPolygonFromPointArr(r),d=[];s.AddPolygons(c,ClipperLib.PolyType.ptSubject);l=s.SimplifyPolygon(c,ClipperLib.PolyFillType.pftNonZero);for(var p=0;p<l.length;p++){var h={dots:[],d:""};h.dots=l[p].map(t);h.d="M"+h.dots.join(" L ")+"z";d[p]=h}if(d.length){a=d[0].dots.length;o=d[0].d;for(p=1;p<d.length;p++)if(a<d[p].dots.length){a=d[p].dots.length;o=d[p].d}m(e,"d",o);f(e,"active")&&dr(e)}return!0};qo.notCopperAreaIntersect=function(e){function t(e,t){for(var r in t)if(Math.abs(t[r].x-e.x)<.1&&Math.abs(t[r].y-e.y)<.1)return!0;return!1}var r=e.pathSegList,n="",i="",a=[],o={},s=r.numberOfItems;n=m(e,"d");a=n.split(/M|L|A|Z/);if(a.length<1)return"path is illegal";a=a.slice(1,a.length-1);for(var l=[],c=0;c<s;c++)i+=r.getItem(c).pathSegTypeAsLetter;for(c=0;c<a.length;c++){for(var d=a[c].replace(/\s+/g," ").split(/\s|,/),p=0;p<d.length;p++)""===d[p]&&d.splice(p,1);o=d.length>2?{letter:"A",d:a[c],x:d[d.length-2],y:d[d.length-1]}:0===c?{letter:"M",x:d[0],y:d[1]}:{letter:"L",x:d[0],y:d[1]};l.push(o)}if(l[l.length-1].x!=l[0].x||l[l.length-1].y!=l[0].y){l.push({letter:"L",x:l[0].x,y:l[0].y});i=i.slice(0,-1);i+="LZ"}for(c=1;c<l.length;c++){var h={},u="",f=[];if("L"==l[c].letter){h={p1:{x:+l[c-1].x,y:+l[c-1].y},p2:{x:+l[c].x,y:+l[c].y}};f=[h.p1,h.p2]}else if("A"==l[c].letter){u="M "+l[c-1].x+" "+l[c-1].y+" A"+l[c].d;f=[{x:+l[c-1].x,y:+l[c-1].y},{x:+l[c].x,y:+l[c].y}]}for(p=c+1;p<l.length;p++){var g={},y="",v=[];if("L"==l[p].letter){g={p1:{x:+l[p-1].x,y:+l[p-1].y},p2:{x:+l[p].x,y:+l[p].y}};v=[g.p1,g.p2]}else if("A"==l[p].letter){y="M"+l[p-1].x+" "+l[p-1].y+" A"+l[p].d;v=[{x:+l[p-1].x,y:+l[p-1].y},{x:+l[p].x,y:+l[p].y}]}if(Object.keys(h).length>0&&Object.keys(g).length>0)var x=le(h.p1,h.p2,g.p1,g.p2)||[];else""!==u&&""!==y?x=Ze(u,y)||[]:Object.keys(h).length>0&&""!==y?x=Qe(y,h.p1,h.p2)||[]:Object.keys(g).length>0&&""!==u&&(x=Qe(u,g.p1,g.p2)||[]);D(x)||(x=[x]);newIntersections=function(e,r,n){var i=[];e.forEach(function(e){t(e,r)&&t(e,n)||i.push(e)});return i}(x,f,v);if(newIntersections.length>0)return!1}}return!0};Vo.ini=function(e){e=V(e);Vo.data[e]=1};Vo.clear=function(){Vo.data={}};Vo.getNewPre=function(e){var t,r=1;e=V(e).toUpperCase();if(e.indexOf("?")<0){t=e;Vo.data[t]=1;return t}for(;;){t=e.replace("?",r++);if(!Vo.data[t])if(h('#g1 > g > g > path[c_text="'+t.replace(/\"/g,'\\"')+'"]'))Vo.data[t]=1;else if(!Vo.data[t]){Vo.data[t]=1;return t}}};Vo.getNewPre2=function(e,t,r,n){e=V(e).toUpperCase();t=void 0===t||t;r=void 0===r||r;e||(e="U?");for(;e.indexOf("?")!=e.lastIndexOf("?");)e=e.replace("?","");var i=e,a=e.indexOf("?");if(a<0){if(e.search(/\d/)<0)return i;e=e.replace(/\d+(?=\D*$)/,"?");a=e.indexOf("?")}else{i=e.replace("?",1);t=!1}var o=new RegExp("^"+e.replace(/[^\w?]/g,"\\$&").replace("?","(\\d+)")+"$"),s=+i.match(o)[1],l=1,c=a<0?e:e.substr(0,a),d=a<0?"":e.substr(a+1),h="";if(c){h+='[c_text^="'+c.replace(/['"\\]/g,"\\$&")+'"]'}if(d){h+='[c_text$="'+d.replace(/['"\\]/g,"\\$&")+'"]'}for(var u=p('#g1 > g > g > path[c_note="note_pre"]'+h),f=Fo.gJsonCache.FOOTPRINT,g=0,y={},v=0;v<u.length;v++){var x=u[v];if(S(f,u[v].parentNode.parentNode.id)){var C=m(x,"c_text"),L=C.match(o);if(L){var _=+L[1];y[_]=1;if(r&&g<_){g=_;l=g+1}_==l&&l++}}}if(t&&!y[s]&&(!n||!n[i]))return i;r&&(l=g+1);for(;!l||y[l]||n&&n[e.replace("?",l)];)l++;return e.replace("?",l)};Vo.isUsed=function(e,t){var r=t&&t.except;return!(!e||e.indexOf("?")>=0)&&Vo.some(function(t,n){return!(r&&(!t||r==t.gId||r==n.gId))&&(t&&t.text==e)})};Vo.walk=function(e,t,r){if("function"!=typeof t)throw"callback is not a function";if(["every","some","each"].indexOf(e)<0)throw"invalid argument type";var n,i,a,o,s,l=Fo.gJsonCache.FOOTPRINT;for(n in l)if(S(l,n)){o=l[n];s=void 0;i=o.TEXT;for(a in i)if(S(i,a)&&"P"==i[a].type){s=i[a];break}var c=t.call(r||null,s,o);switch(e){case"every":if(!c)return!1;break;case"some":if(c)return!0}}switch(e){case"every":return!0;case"some":return!1}};Vo.every=function(e,t){return Vo.walk("every",e,t)};Vo.some=function(e,t){return Vo.walk("some",e,t)};Vo.each=function(e,t){return Vo.walk("each",e,t)};a.registerHook({photoView:function(){return $o.reset.apply(null,arguments)},getPhotoviewConfig:function(){return{side:$o._side,silk:$o._silk,color:$o._color,solder:$o._solder}}});$o._colors={};$o._side="topSide";$o._silk="visible";$o._color="blue";$o._solder="gold";$o._colorConfig={green:["#00BE00","#0B3B0B"],red:["#D90305","#940300"],blue:["#005CB6","#002966"],yellow:["#EEEE00","#B8AC00"],black:["#000000","#101010"],purple:["#7A0956","#19001E"],copper:["#F7A456","#686048"]};$o._boardColor="#80785F";$o._silkColor="#FFFFFF";$o._signalColor=["#DCAA14","#D2D2D2"];$o.init=function(){Ka.classList.add("photoview");m(d("topSilkLayer"),{fill:$o._silkColor,stroke:$o._silkColor});m(d("bottomSilkLayer"),{fill:$o._silkColor,stroke:$o._silkColor});m(d("topSignalReal"),{fill:$o._signalColor[0],stroke:$o._signalColor[0]});m(d("bottomSignalReal"),{fill:$o._signalColor[0],stroke:$o._signalColor[0]});$o._changeColorConfig($o._color);$o._changeSide("topSide")};$o._changeColorConfig=function(e){if(S($o._colorConfig,e)){m(d("topBoardSolderReal"),{fill:$o._colorConfig[e][1]});m(d("topSignalSolderReal"),{fill:$o._colorConfig[e][0],stroke:$o._colorConfig[e][0]});m(d("bottomBoardSolderReal"),{fill:$o._colorConfig[e][1]});m(d("bottomSignalSolderReal"),{fill:$o._colorConfig[e][0],stroke:$o._colorConfig[e][0]})}};$o.reset=function(e){if(e){var t="_"+e.split("_")[0],r=e.split("_")[1];$o[t]&&$o[t](r)}};$o._changeSide=function(e){var t,r;if("topSide"==e){m(d("topBoardSolderReal"),"display","");m(d("topSignalReal"),"display","");m(d("topSignalSolderReal"),"display","");m(d("topSilkLayer"),"display","visible"==$o._silk?"":"none");m(d("bottomBoardSolderReal"),"display","none");m(d("bottomSignalReal"),"display","none");m(d("bottomSignalSolderReal"),"display","none");m(d("bottomSilkLayer"),"display","none");t="";$o._side="topSide"}else{m(d("topBoardSolderReal"),"display","none");m(d("topSignalReal"),"display","none");m(d("topSignalSolderReal"),"display","none");m(d("topSilkLayer"),"display","none");m(d("bottomBoardSolderReal"),"display","");m(d("bottomSignalReal"),"display","");m(d("bottomSignalSolderReal"),"display","");m(d("bottomSilkLayer"),"display","visible"==$o._silk?"":"none");r=Ka.getBBox()||{x:0,y:0,width:0,height:0};t="matrix(-1, 0, 0, 1, "+(2*r.x+r.width)+", 0)";$o._side="bottomSide"}m(Ka,"transform",t);gi();$o.sideChanged=!0};$o._changeSilk=function(e){$o._silk=e;if("visible"==e)"topSide"==$o._side?m(d("topSilkLayer"),"display",""):m(d("bottomSilkLayer"),"display","");else{m(d("topSilkLayer"),"display","none");m(d("bottomSilkLayer"),"display","none")}};$o._changeColor=function(e){$o._color=e;$o._changeColorConfig(e)};$o._changeSolder=function(e){$o._solder=e;if("silver"==e){m(d("topSignalReal"),{fill:$o._signalColor[1],stroke:$o._signalColor[1]});m(d("bottomSignalReal"),{fill:$o._signalColor[1],stroke:$o._signalColor[1]})}else{m(d("topSignalReal"),{fill:$o._signalColor[0],stroke:$o._signalColor[0]});m(d("bottomSignalReal"),{fill:$o._signalColor[0],stroke:$o._signalColor[0]})}};var As="    ",bs="\n",Ss="      ",Es={};Es.resolution=1e3;Es.scale=1;Es.grap="0.1mil";Es.grid="2.5mil";Es.adjustment=.005;Es.init=function(){Es.layers=Es.config.routerLayers.length?Es.config.routerLayers:[io.TOPLAYER];Es.skipNetArr=Es.config.skipNets.split(" ")||[];Es.pads=Fo.getAllObjsOf("PAD",!0);Es.vias=Fo.getAllObjsOf("VIA",!0);Es.tracks=Fo.getAllObjsOf("TRACK",!0,!0);var e=Fo.getAllObjsOf("TEXT",!0,!0);if(e.length)for(i=0,l=e.length;i<l;i++){var t=e[i],r=Eo.svg.getBBox(d(t.gId)),n=+t.strokeWidth;Es.pads.push({gId:t.gId,shape:"POLYGON",pointArr:N(Eo.convertRect2Polygon(r.x-n/2,r.y-n/2,r.width+n,r.height+n).join(",")),layerid:t.layerid,net:""})}Es.vias.forEach(function(e){Es.pads.push({gId:e.gId,shape:"ELLIPSE",x:e.x,y:e.y,width:e.diameter,layerid:e.layerid,net:e.net||""})});Fo.getAllObjsOf("RECT",!0).forEach(function(e){Es.pads.push({gId:e.gId,shape:"RECT",x:e.x,y:e.y,width:e.width,height:e.height,pointArr:[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],layerid:e.layerid,net:e.net||""})})
;Es.pads=Es.pads.concat(Fo.getAllObjsOf("SOLIDREGION",!0,!0));Es.tracks=Es.tracks.concat(Fo.getAllObjsOf("ARC",!0,!0));Fo.getAllObjsOf("HOLE",!0).forEach(function(e){e.diameter=2*e.holeR;Es.vias.push(e);Es.pads.push({gId:e.gId,shape:"ELLIPSE",x:e.x,y:e.y,width:2*e.holeR,layerid:io.ALL,net:""})});Es.viaStack={}};Es.jointPoints=function(e){var t=0,r=0,n=[];for(t=0,r=e.length;t<r;t++){n.push(Eo.formatLengthSave(e[t].x*Es.scale));n.push(Eo.formatLengthSave(e[t].y*Es.scale))}return n.join(" ")};Es.exportDSN=function(e){Fo.gJsonCache;Es.config=e||{};Es.init();var t=function(e){return Eo.formatLengthSave((Eo.units.convert(e,"pixel")+Es.adjustment)*Es.scale)},r=t(Es.config.width),n=t(Es.config.clearance),i=t(Es.config.smdClearance);if(!Es.isOKPCBForAutorouter()){parent.$.messager.error("Please make sure all components are inside the board outline!");return!1}var a=Es.createStructure(n,r,i);return!(!a||!Es.pads.length)&&"(PCB ''"+bs+"  (resolution mil "+Es.resolution+")"+bs+a+bs+Es.createPlace()+bs+Es.createLibrary()+bs+Es.createNetwork()+bs+Es.createWiring()+bs+")"};Es.createPlace=function(){var e="  (placement"+bs;e+=Es.createComponent()+bs;e+="  )";return e};Es.createComponent=function(){var e=As+"(component u1"+bs;e+=Ss+"(place u1 0 0 front 0"+bs;e+=Ss+")"+bs;e+=As+")"+bs;return e};Es.createLibrary=function(){var e="  (library"+bs;e+=Es.createImage()+bs;e+=Es.createViaStack()+bs;e+=Es.createAllPadStack()+bs;e+="  )";return e};Es.createImage=function(){var e=As+"(image u1"+bs;Es.pads.forEach(function(t){if(t.layerid==io.ALL||-1!=Es.layers.indexOf(+t.layerid)){var r=Es.remove_gge(t.gId);e+=Ss+"(pin p"+r+" "+r+" 0 0)"+bs}});e+=As+")"+bs;return e};Es.createAllPadStack=function(){var e=[];Es.pads.forEach(function(t){t.layerid!=io.ALL&&-1==Es.layers.indexOf(+t.layerid)||e.push(Es.createPadStack(t))});return e.join(bs)};Es.createPadStack=function(e){var t=As+"(padstack p"+Es.remove_gge(e.gId)+bs;if("ELLIPSE"==e.shape){var r=" "+Eo.formatLengthSave(e.x*Es.scale)+" "+Eo.formatLengthSave(e.y*Es.scale);e.layerid==io.ALL?Es.layers.forEach(function(n){t+=Ss+"(shape(circle "+n+" "+Eo.formatLengthSave(e.width*Es.scale)+r+"))"+bs}):t+=Ss+"(shape(circle "+e.layerid+" "+Eo.formatLengthSave(e.width*Es.scale)+r+"))"+bs}else{e.pathStr&&!e.pointArr&&(e.pointArr=ui(e.pathStr));var n=Es.jointPoints(e.pointArr),i=Eo.units.convert(Es.grap,"pixel")*Es.scale;i=Eo.formatLengthSave(i);e.layerid==io.ALL?Es.layers.forEach(function(e){t+=Ss+"(shape(polygon "+e+" "+i+" "+n+"))"+bs}):t+=Ss+"(shape(polygon "+e.layerid+" "+i+" "+n+"))"+bs}return t+As+")"};Es.netClass=function(){var e="";"object"==typeof Es.config.netClass&&Es.config.netClass.forEach(function(t){var r=Eo.units.convert(t.width,"pixel"),n=Eo.units.convert(t.clearance,"pixel");r=Eo.formatLengthSave(r*Es.scale);n=Eo.formatLengthSave(n*Es.scale);e+=As+"(class "+t.net+" "+t.net+bs+Ss+"(rule "+bs+"        (width "+r+")"+bs+"        (clearance "+n+")"+bs+Ss+")"+bs+As+")"+bs});return e};Es.createNetwork=function(){var e,t,r=Fo.gJsonCache.SIGNALS,n=new RegExp("[^\0-]","g"),i="",a=[],o=Es.skipNetArr;for(var s in r)if(S(r,s)&&s){t=s;-1!==s.indexOf("(")&&(t=t.replace("(","%LPAREN%"));-1!==s.indexOf(")")&&(t=t.replace(")","%RPAREN%"));n.test(t)&&(t=t.replace(n,function(e){return"%U"+e.codePointAt().toString(16)+"%"}));e=Es.connectPins(s);if(e){i=As+"(net "+t+bs;i+=Ss+"(pins "+e+")"+bs;-1!=o.indexOf(s)&&(i+=Ss+"(type protect)"+bs);i+=As+")"}a.push(i)}return"  (network"+bs+a.join(bs)+bs+Es.netClass()+bs+"  )"+bs};Es.connectPins=function(e){var t=[];Es.pads.forEach(function(r){r.net!=e||r.layerid!=io.ALL&&-1==Es.layers.indexOf(+r.layerid)||t.push("u1-"+Es.remove_gge(r.gId))});return t.join(" ")};Es.createWiring=function(){function e(e){var t=As+"(wire(path "+e.layerid+" "+Eo.formatLengthSave(Es.scale*e.strokeWidth)+" "+Es.jointPoints(e.pointArr)+" )"+bs;t+=Ss+"(net "+e.net+")"+bs;t+=Ss+"(type protect)"+bs;t+=As+")"+bs;return t}function t(e){var t="via"+Es.viaStack[e.diameter];return As+"(via "+t+" "+Es.jointPoints([e])+bs+Ss+"(net "+e.net+")"+bs+Ss+"(type protect)"+bs+As+")"+bs}var r="   (wiring"+bs;Es.tracks.forEach(function(t){for(var n=t.pointArr,i=0,a=1;a<n.length;a++){i+=Math.sqrt(Math.pow(n[a].x-n[a-1].x,2)+Math.pow(n[a].y-n[a-1].y,2));if(i>=1&&-1!=Es.layers.indexOf(+t.layerid)){r+=e(t);break}}});Es.vias.forEach(function(e){e.net&&!e.locked&&(r+=t(e))});r+=As+")"+bs;return r};Es.remove_gge=function(e){return(e||"").replace("gge","")};Es.createViaStack=function(){var e=Eo.units.convert(Es.config.viaDiameter,"pixel");e=Eo.formatLengthSave(e);var t="",r=0;Es.viaStack[e]=r;r++;for(var n=0,i=Es.vias.length;n<i;n++)void 0===Es.viaStack[Es.vias[n].diameter]&&(Es.viaStack[Es.vias[n].diameter]=r++);r=0;for(var a in Es.viaStack)S(Es.viaStack,a)&&(t+=As+"(padstack via"+Es.viaStack[a]+bs+function(e){var t="";Es.layers.forEach(function(r){t+=Ss+"(shape(circle "+r+" "+Eo.formatLengthSave(Es.scale*e)+"))"+bs});return t}(a)+As+")"+bs);return t};Es._getBoardOutlinePointStr=function(){var e=qo.getPolygonBoardOutline();if(e&&e.outer){e=e.outer.split("zM")[0];return e.replace(/[^0-9\- ,\.]/g,"")}return""};Es.createStructure=function(e,t,r){if(!Es._getBoardOutlinePointStr())return!1;for(var n="",i=Fo.getAllObjsOf("TRACK").filter(function(e){return e.layerid==io.BOARDOUTLINE}),a=Fo.getAllObjsOf("ARC").filter(function(e){return e.layerid==io.BOARDOUTLINE}),o=i.concat(a),s=0;s<o.length;s++)n+=As+"(boundary(path signal 0 "+Es.jointPoints(o[s].pointArr)+" )"+bs+As+")"+bs;var l=Es.grid;l=Eo.units.convert(l,"pixel");l=Eo.formatLengthSave(l*Es.scale);return"  (structure"+bs+n+As+"(via  via0"+bs+As+")"+bs+As+"(grid via   "+l+")"+bs+As+"(grid wire   "+l+")"+bs+As+"(grid place   "+l+")"+bs+As+"(rule(clear "+e+"))"+bs+As+"(rule(clear "+r+" (type default_smd)))"+bs+As+"(rule(clear "+r+" (type smd_smd)))"+bs+As+"(rule(width "+t+"))"+bs+function(){var e="";Es.layers.forEach(function(t){e+=As+"(layer "+t+bs+Ss+"(type signal)"+bs+As+")"+bs});return e}()+bs+"  )"+bs};Es.isOKPCBForAutorouter=function(){var e=ri();if(e.width<1||e.height<1)return!1;for(var t=Fo.getAllObjsOf("PAD",!0),r=0;r<t.length;r++)if(!function(t){return t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height}(t[r]))return!1;return!0};Es.importSession=function(){function e(e,r,n){s=0;Qo.buildAllNet();l=setTimeout(t(e,r,n),0)}function t(e,t,r){l=0;if(t||0===t){var n=[];for(var i in e)e[i].vias&&(n=n.concat(e[i].vias));var a=Es.exportPins().length,s=a-t;sr("showAutoRouteResultDlg",[a,s+(0===a?"":" ( "+(s/a*100).toFixed(2)+"% )"),t,n.length])}else if(0==r){var c=parent.$.messager.alert({msg:"Router is time out.",callback:function(){sr("buildCopper",["all"]);Fo.buildSignals()}});c.window("options").onClose=function(){sr("buildCopper",["all"]);Fo.buildSignals()}}else{sr("buildCopper",["all"]);Fo.buildSignals()}Ls.setActivePCBLayer(io.TOPLAYER);o=!1;f=null;u.length&&zo.save(u);zo.saveBatch()}function r(t,r,n){Fo.calAll({notCopper:!0});Qo.removeAllRatline();s=setTimeout(e(t,r,n),0)}function n(e){var t;for(var r in e)if(S(e,r)){var n=(e[r].net,e[r].wires),i=e[r].vias;for(var a in n)if(S(n,a)){var o=n[a];t=o.id&&v(d(o.id));t&&c.push(t)}for(a in i)if(S(i,a)){var s=i[a];t=s.id&&v(d(s.id));t&&p.push(t)}}}function i(e){f&&n(f);var t=function(e){var t={};t.viaRadius=Eo.formatLengthSave(Eo.units.convert(e.viaDiameter,"pixel")/2);t.viaHoleRadius=Eo.formatLengthSave(Eo.units.convert(e.viaHoleD,"pixel")/2);t.trackWidth=Eo.formatLengthSave(Eo.units.convert(e.width,"pixel"));t.netTrackWidth={};for(var r=0;r<e.netClass.length;r++){var n=e.netClass[r];t.netTrackWidth[n.net]=Eo.formatLengthSave(Eo.units.convert(n.width,"pixel"))}return t}(Es.config),r=d("part_via").cloneNode(!0);m(r,"display","");m(r.querySelectorAll(":not([c_padid]):not(title)")[0],"r",t.viaRadius);m(r.querySelectorAll(":not([c_padid]):not(title)")[1],"r",t.viaHoleRadius);var i={},a=new RegExp("%U[0-9a-f]{1,5}%","g");for(var o in e)if(S(e,o)){var s=e[o].net,l=e[o].wires||{},g=e[o].vias||{};if(!s)continue;if(-1!=Es.skipNetArr.indexOf(s))continue;-1!==s.indexOf("%LPAREN%")&&(s=s.replace("%LPAREN%","("));-1!==s.indexOf("%RPAREN%")&&(s=s.replace("%RPAREN%",")"));a.test(s)&&(s=s.replace(a,function(e){var t,r=e.replace("%","").replace("U","");try{t=String.fromCodePoint(parseInt(r,16))}catch(e){t=""}return t}));for(var y in l)if(S(l,y)){var v=l[y],x={id:Eo.newId(),fill:"none","stroke-width":function(e){return e&&t.netTrackWidth[e]||t.trackWidth}(s),layerid:v.layerid,c_shapetype:"line",c_etype:"wire",net:s,points:v.points.join(" ")},C=c.pop()||zt("polyline");m(C,x);var L=v.layerid;i[L]||(i[L]=h('#g1 > polyline[layerid="'+L+'"]'));if(i[L]){Ls.appendElement(C);u.push(["add",C.id,C.nextElementSibling.id])}else{i[L]=C;Ls.appendElement(C);u.push(["add",C.id,C.nextElementSibling.id])}v.id=C.id}for(y in g)if(S(g,y)){var _=g[y],P=p.pop();if(P){m(P.querySelectorAll(":not([c_padid]):not(title)")[0],"r",t.viaRadius);m(P.querySelectorAll(":not([c_padid]):not(title)")[1],"r",t.viaHoleRadius)}else P=r.cloneNode(!0);m(P.querySelectorAll(":not([c_padid]):not(title)")[0],{cx:_.x,cy:_.y});m(P.querySelectorAll(":not([c_padid]):not(title)")[1],{cx:_.x,cy:_.y});m(P,"net",s);m(P,"id",Eo.newId());Ls.appendElement(P);_.id=P.id;u.push(["add",P.id,P.nextElementSibling.id])}}f=e}function a(e,t,n,a,s){if(o){if("start"==t){parent.$.messager.error("Cannot start again before previous activity is stopped");return}}else{if("start"!=t)return;o=!0;f=null;zo.startBatch();Nn(n);Qo.removeAllRatline()}u.length=0;var l="string"==typeof e&&""!=e?E(e):e;l&&i(l);"end"==t&&r(e,a,s)}var o=!1,s=0,l=0,c=[],p=[],u=[],f=null;return a}();Es.exportPins=function(){var e=Fo.gJsonCache.SIGNALS,t=[],r=Es.skipNetArr;for(var n in e)S(e,n)&&n&&-1==r.indexOf(n)&&Es.pads.forEach(function(e){e.net!=n||e.layerid!=io.ALL&&-1==Es.layers.indexOf(+e.layerid)||t.push(Es.remove_gge(e.gId))});return t};a.registerHook({getActiveElement:function(){return Yo},getActiveElementsArr:function(){return p("#g1 .selected",Ka)}});var Os={config:{activeLineArr:[]},isPath:{MITERED_WITH_NONE:!1,MITERED_WITH_LINE:!1,MITERED_WITH_ARC:!0},events:{mmove:function(e){if("DrawRouteLengthTuning"===Uo){var t=Os.status,r=Os.config,n=Os.isPath,i=(t.target,Ct({x:e.clientX,y:e.clientY}));if(t.ready){var a=i.x,o=i.y,s=a-t.startX,l=o-t.startY;if(!t.start){if((s*s+l*l)*wo*wo<9)return;t.start=1}if(t.startPoint){var c=Os.getLinePosFromCanvasPos(i);if(c){var d=r.activeLineArr.reduce(function(e,t){return e+=ls.getTrackAndArcLengthFromElement(t)},0);if(0===r.drcLimit&&0===r.addtionalLength)var p=null;else p=r.targetLength-d;if(p>0||null===p){var h=Ja(t.startPoint,c,r.width,r.height,p,r.type,n[r.type]);n[r.type]?m(t.snakeLine,"d",h):m(t.snakeLine,"points",h);m(t.lineBlocker,"points",t.startPoint.x+" "+t.startPoint.y+" "+c.x+" "+c.y);var u=sr("i18nTransfer",["Target Length:","Current Length:"]);sr("showFloatingPanel",[{html:'<div style="margin-bottom: 10px;"><span>'+u[0]+' </span><span class="bold">'+(null===p?0:Eo.toFixed(Eo.units.convert(r.targetLength,"pixel",Zo.canvas.unit),3))+"</span><span> "+Zo.canvas.unit+"</span></div><div><span>"+u[1]+' </span><span class="bold">'+Eo.toFixed(Eo.units.convert(d+ls.getTrackAndArcLengthFromElement(t.snakeLine)-ls.getTrackAndArcLengthFromElement(t.lineBlocker),"pixel",Zo.canvas.unit),3)+"</span><span> "+Zo.canvas.unit+"</span></div>",style:{left:e.clientX+50,top:e.clientY+80}}])}fr(c.x,c.y)}}}else fr(i.x,i.y)}else Os.events.mup({button:no})},mup:function(e){var r=Os.status,n=Os.config,i=Os.isPath;if(e.button!=no)if(r.ready){r.ready=0;r.start=0;v(r.lineBlocker);r.lineBlocker=null;var a,o;if(i[n.type]){var s=[],l=[],c=m(r.target,"net");a=m(r.snakeLine,"d");if(a&&a.replace(/[^ALM]/g,"").length>6){var p=Os.insertPath(r.snakeLine);Fo.removeOne(r.target);s.push(["del",r.target.id]);Ro.append(r.target);p.forEach(function(e){Ls.appendElement(e);Fo.updateOne(e);l.push(e.id);n.activeLineArr.push(e)});var h=n.activeLineArr.indexOf(r.target);h>=0&&n.activeLineArr.splice(h,1);xn(n.activeLineArr);Qo.buildOneNet(c);s.push(["add",l.join(",")]);zo.save(s)}}else{a=m(r.snakeLine,"points");if(a&&a.split(" ").length>4){o={points:m(r.target,"points")};Os.insertPoints(a);Lt(r.target);Fo.updateOne(r.target);zo.save(["attr",r.target.id,o,{points:m(r.target,"points")}])}}sr("triggerEvent",["select_change"]);v(r.snakeLine);r.snakeLine=null;Os.status={}}else{var f=vo?e.metaKey:e.ctrlKey;if(e.button!=ro||f)return;var g=Ct({x:e.clientX,y:e.clientY}),y=Fo.ifFind(g.x,g.y,"",io.ALL,"ALL"),x=d(y.gId);r.target=x;if(!x||"polyline"!=x.tagName)return;if(x.parentNode!==Ka)return;if(x.points.numberOfItems<2)return;if(Os.config.activeLineArr.indexOf(x)<0)return;if(ss.isLocked(x))return;var C=se(g,x);if(C<0)return;r.startX=g.x;r.startY=g.y;r.ready=1;r.start=0;r.pIndex=C;Lt(x);r.startPoint=Os.getLinePosFromCanvasPos(g);if(!r.startPoint)return;r.lineBlocker=zt("polyline",{"stroke-width":m(x,"stroke-width"),id:"pcbSnakeLineBlocker",stroke:ma().backGround,"shape-rendering":"crispEdges",points:""});ys.appendChild(r.lineBlocker);i[n.type]?r.snakeLine=zt("path",{"stroke-width":m(x,"stroke-width"),id:"pcbSnakeLineGernating",c_shapetype:"line",layerid:m(x,"layerid"),net:m(x,"net"),fill:"none","shape-rendering":"crispEdges",d:""}):r.snakeLine=zt("polyline",{"stroke-width":m(x,"stroke-width"),id:"pcbSnakeLineGernating",c_shapetype:"line",layerid:m(x,"layerid"),net:m(x,"net"),fill:"none","shape-rendering":"crispEdges",points:""});ys.appendChild(r.snakeLine);m(ys,{visibility:"visible"});var L=n.activeLineArr.reduce(function(e,t){return e+=ls.getTrackAndArcLengthFromElement(t)},0);L=Eo.toFixed(Eo.units.convert(L,"pixel",Zo.canvas.unit),3);var _=sr("i18nTransfer",["Target Length:","Current Length:"]);sr("showFloatingPanel",[{html:'<div style="margin-bottom: 10px;"><span>'+_[0]+' </span><span class="bold">'+(0==n.addtionalLength?"0":Eo.toFixed(Eo.units.convert(n.targetLength,"pixel",Zo.canvas.unit),3))+"</span><span> "+Zo.canvas.unit+"</span></div><div><span>"+_[1]+' </span><span class="bold">'+L+"</span><span> "+Zo.canvas.unit+"</span></div>"}])}else{if(lo.dragpanning)return;if(r.lineBlocker){v(r.lineBlocker);r.lineBlocker=null}if(r.snakeLine){v(r.snakeLine);r.snakeLine=null}r.ready=0;r.start=0;Os.status={};t.removeEventListener("mousemove",Os.events.mmove,!1);t.removeEventListener("mouseup",Os.events.mup,!1);fr(!1);u(Ka,"events-none",!1);sr("hideFloatingPanel");setTimeout(function(){"DrawRouteLengthTuning"===Uo&&(Uo="")},100)}},stopDefault:function(e){e.stopPropagation();e.preventDefault()}},status:{},getLinePosFromCanvasPos:function(e){if(!e)return null;var t=this.status.pIndex,r=this.status.target;if(void 0===t||!r)return null;var n=Math.floor(t/2);if(!r.points[n+1])return null;var i=ie(r.points[n],r.points[n+1],e);return i?i.point:null},Snake:function(e,t,r,n,i){this.points=e;this.type=t;this.length=r;this.isFirst=n;this.isLast=i;if("polyline"===t){this.startPoint=e[0];this.terminalPoint=e[e.length-1]}else if("path"===t){this.startPoint=e[0];this.terminalPoint=e[e.length-1]}},insertPoints:function(e){var t=Os.status,r=t.target,n="",i=Math.floor(t.pIndex/2);if(r&&"polyline"===r.tagName){for(var a=r.points,o=0;o<=i;o++)n+=a[o].x+" "+a[o].y+" ";this.isInverse(a[i],e)?n+=e.split(" ").map(function(e,t,r){return t%2==0?e+" "+r[t+1]:void 0}).filter(function(e){return void 0!==e}).reverse().join(" ")+" ":n+=e+" ";for(o=i;o<a.length;o++)n+=a[o].x+" "+a[o].y+" ";m(r,"points",n.trim())}},insertPath:function(e){var t,r,n=Os.status,i=n.target,a=[],o="",s="",l=Math.floor(n.pIndex/2),c={"stroke-width":m(i,"stroke-width"),fill:"none",c_shapetype:"line",layerid:m(i,"layerid"),net:m(i,"net")},d=m(e,"d"),p=d.replace(/[^MAL]/g,"");if("L"===p[p.length-1]){d=d.slice(0,d.lastIndexOf("L"));m(e,"d",d)}var h=d.replace(/[MAL]/,"").trim().split(/\s/g),u=h[0]+" "+h[1],f=h[h.length-2]+" "+h[h.length-1];if(i&&"polyline"===i.tagName){for(var g=i.points,y=this.isInverse(g[l],u+" "+f),v=0;v<=l;v++)o+=g[v].x+" "+g[v].y+" ";o+=y?f:u;t=zt("polyline",c);m(t,"points",o.trim());m(t,"id",Eo.newId());a.push(t);a=a.concat(di(e));s+=(y?u:f)+" ";for(v=l+1;v<g.length;v++)s+=g[v].x+" "+g[v].y+" ";r=zt("polyline",c);m(r,"points",s.trim());m(r,"id",Eo.newId());a.push(r)}return a},stringToPoint:function(e){return e.split(" ").map(function(e,t,r){return t%2==0?{x:Number(e),y:Number(r[t+1])}:void 0}).filter(function(e){return void 0!==e})},isInverse:function(e,t){var r=this.stringToPoint(t),n=r.length-1;return ue(e.x,e.y,r[0].x,r[0].y)>ue(e.x,e.y,r[n].x,r[n].y)}};Os.Snake.prototype={toString:function(){return"polyline"===this.type&&this.points?this.points.reduce(function(e,t){return e+=Eo.toFixed(t.x,3)+" "+Eo.toFixed(t.y,3)+" "},"").trim():"path"===this.type&&this.points?this.points.reduce(function(e,t,r){return e+=0===r?Eo.toFixed(t.x,3)+" "+Eo.toFixed(t.y,3)+" ":t.path+" "},""):Object.prototype.toString()},constructor:Os.Snake};var Is=e.frameElement?e.frameElement.getAttribute("c_doctype"):"3";d("gMark");!function(){e.doctype=Is;a.registerHook({getJsonCache:function(){return Fo.gJsonCache},gCanvas:function(){return Ka},getLogs:function(){return zo.getLogs()},selectedObj:function(){return fn()},setCustomPara:function(e,t){var r=un(),n=r.length;1===n?Yt(r[0],e,t):n>1?r.forEach(function(r){Yt(r,e,t)}):Yt(Ka,e,t)},changeCanvasUnit:function(){sr("changeCanvasUnit")},setPinMap:function(){return setPinMap.apply(null,arguments)},importDocEdit:function(){return sa.apply(null,arguments)},importPart:function(){return da.apply(null,arguments)},importModule:function(){return pa.apply(null,arguments)},importShape:function(){return ha.apply(null,arguments)},placePart:function(e){return Ba(e)},drawShape:function(e){return Da(e)},updateShape:function(){return Va.apply(null,arguments)},setToolbarCmd:function(){return wr.apply(null,arguments)},zoom:function(){return Vr.apply(null,arguments)},getDocStatus:function(){return Fr.apply(null,arguments)},getViewStatus:function(){return tr()},getCanvas:function(){return ma()},getBBox:function(){var t,r;try{t=Ka.getBBox()}catch(n){r=e.frameElement.parentNode;if("none"!=r.style.display)throw"getBBox error";r.style.display="";try{t=Ka.getBBox()}catch(e){}r.style.display="none"}if(t&&0===t.x&&0===t.y&&0===t.width&&0===t.height){r=e.frameElement.parentNode;if("none"==r.style.display){r.style.display="";try{t=Ka.getBBox()}catch(e){}r.style.display="none"}}if(t)return{x:Eo.toFixed(t.x,1),y:Eo.toFixed(t.y,1),width:Eo.toFixed(t.width,1),height:Eo.toFixed(t.height,1)}},getPackage:function(){return Eo.c_paraToJson(m(Ka,"c_para")).package},getComponents:function(){return jr()},findComponent:function(e,t,r,n,i){return Hr(e,t,r,n,i)},getPadsByFootprintId:function(e){return An(e)},updateSaveIndex:function(){zo.savedIndex=zo.index;zo.fileWaitingforSaving=!1},checkPrefixNamesAndNetNames:function(e,t,r,n,i){if(!(e&&e.length||t&&t.length||r&&Object.keys(r).length))return!1;var a=i&&i.toString()||Is;if(a===ao.SCH||a===ao.PCB){var o,s,l,c,d=n||Fo.gJsonCache;if(d.schlib){o=d.schlib;s="annotation";l="mark";c=ao.SCH}else if(d.FOOTPRINT){o=d.FOOTPRINT;s="TEXT";l="type";c=ao.PCB}if(o&&e&&e.length>0)for(var p in o)if(S(o,p)){var h=o[p][s];for(var u in h)if(S(h,u)){var f=h[u];if("P"==f[l]&&-1!==e.indexOf(c===ao.PCB?f.text:f.string.split(".")[0]))return!0}}if(a===ao.PCB){if(t&&t.length>0)for(p in d){var g=d[p];if("TRACK"==p||"PAD"==p||"ARC"==p||"VIA"==p||"HOLD"==p&&eleJson){for(var y in g)if(S(g,y)&&t.indexOf(g[y].net)>-1)return!0}else if("FOOTPRINT"==p){g=d[p];for(y in g)if(S(g,y)){var v=g[y];for(var x in v){var m=v[x];if("TRACK"==x||"PAD"==x||"ARC"==x||"VIA"==x||"HOLD"==x&&m)for(var C in m)if(S(m,C)&&t.indexOf(m[C].net)>-1)return!0}}}}}else if(a===ao.SCH&&r&&Object.keys(r).length>0&&o)for(var L in o){var _=o[L];h=_.annotation;for(u in h)if(S(h,u)){f=h[u];var P=f.string.split(".")[0];if("P"==f.mark&&r[P]&&_.pin)for(var A in _.pin){var b=_.pin[A];if(S(b,"num")&&b.num.text==r[P])return!0}}}return!1}},setSymbolInfo:function(e){Zt(e)},groupSymbol:function(){return pn.apply(null,arguments)},isPreUsed:function(e){return e.indexOf("?")<0&&Vo.isUsed(e)},saveHistory:function(e){zo.save(e)},undo:function(){Cs.started&&Cs.dots.length||Io.on&&Io.waitingSave||Zi()||e.routeLengthTuning&&Os.status&&Os.status.ready||(_r(Is)?sr("project_undo"):zo.go(-1))},redo:function(){Cs.started&&Cs.dots.length||Io.on&&Io.waitingSave||Zi()||e.routeLengthTuning&&Os.status&&Os.status.ready||(_r(Is)?sr("project_redo"):zo.go(1))},sheet_undo:function(){Cs.started&&Cs.dots.length||Io.on&&Io.waitingSave||Zi()||e.routeLengthTuning&&Os.status&&Os.status.ready||zo.go(-1)},sheet_redo:function(){Cs.started&&Cs.dots.length||Io.on&&Io.waitingSave||Zi()||e.routeLengthTuning&&Os.status&&Os.status.ready||zo.go(1)},changeTrackWidth:function(){"draw.track"===Uo&&sr("toggleTrackWidthPanel",[Sr.data])},cut:function(){!Zi()&&Wr()},pasteRepeatedly:function(){Zi()||Qr()},copyByRefPoint:function(){Zi()||$r()},copy:function(){var e=!1;if(!Zi()){e=Zr();if(e){$r.fn.position=!1;$r.fn.started=!1}}},paste:function(){!Zi()&&en()},pasteCloseRatLines:function(){!Zi()&&qr()},paste_xdoc:function(){!Zi()&&en()},clone:function(){var e=arguments[0];if("object"==typeof e&&e.ids){var t=e.ids;if(!Array.isArray(t))return;var r=t.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Ka});if(r.length)return rn(r)}},select_all:function(){!Zi()&&vn()},select_none:function(){Gr()},getSelectedIds:function(){return vr()},getSelectAttrJson:function(){var e=un();return e.length>=1?wt(e[0]):{}},select:function(){var e=arguments[0];if("object"==typeof e&&e.ids){var t=e.ids;if(!Array.isArray(t))return;var r=t.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Ka});if(r.length)return xn(r)}},clear_canvas:function(){ms.clear()},move:function(){Ur.apply(null,arguments)},moveTo:function(){Jr.apply(null,arguments)},drag:function(){},bring_to_front:function(){ln()},send_to_back:function(){cn()},ctrlTab:function(){sr("ctrlTab")},ctrlTabReverse:function(){sr("ctrlTabReverse")},openLayerOptionsSet:function(){sr("openLayerOptionsSetDlg")},toggleActiveLayerVisible:function(){sr("toggleActiveLayerVisible",[Ls.getActiveLayer()])},changeRouteConflictWay:function(){sr("changeRouteConflictWay")},align_left:function(e){an("align_left",e)},align_right:function(e){an("align_right",e)},align_top:function(e){an("align_top",e)},align_bottom:function(e){an("align_bottom",e)},align_horizontal_center:function(e){an("align_horizontal_center",e)},align_vertical_center:function(e){an("align_vertical_center",e)},align_horizontal_equidistant:function(e){an("align_horizontal_equidistant",e)},align_vertical_equidistant:function(e){an("align_vertical_equidistant",e)},align_left_side_edge_equidistant:function(e){an("align_left_side_edge_equidistant",e)},align_top_side_edge_equidistant:function(e){an("align_top_side_edge_equidistant",e)},align_grid:function(e){an("align_grid",e)},rotate_left:function(){var e=arguments[0];"object"==typeof e&&e.ids?a("rotate",[{ids:e.ids,degree:270}]):a("rotate",[270])},rotate_right:function(){var e=arguments[0];"object"==typeof e&&e.ids?a("rotate",[{ids:e.ids,degree:90}]):a("rotate",[90])},fliph:function(){var e,t=arguments[0];if("object"==typeof t&&t.ids){e=t.ids;if(!Array.isArray(e))return;var r=e.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Ka&&!ss.isLocked(e)});r.length&&nn(1,r)}else nn(1)},flipv:function(){var e,t=arguments[0];if("object"==typeof t&&t.ids){e=t.ids;if(!Array.isArray(e))return;var r=e.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Ka&&!ss.isLocked(e)});r.length&&nn(0,r)}else nn(0)},lock:function(){ss.lockObjs()},unlock:function(){ss.unlockObjs()},unlockAll:function(){ss.unlockObjs(p('[locked="1"]',Ka))},fitview:function(){Gt()},cross_cursor:function(e){!1===e&&fr(!1)},canvas_config:function(){return O(Zo.canvas)},getConfig:function(){return O(Zo)},config:function(){return Zo},attrpanel_apply:function(e,t,r,n,i){La(e,t,r,n,i)},attrpanel_data:function(){return Aa()},realTimeNetLengthHandler:function(){sr("realTimeNetLengthHandler",[{type:"updateConfig"}])},getCanvasAttr:function(){return ms.getCanvasAttrs()},size:function(){return{width:+m(Go,"width"),height:+m(Go,"height")}},currZoom:function(){return No},getSelected:function(){return un()},getSelectedObjs:function(){return un(!0)},deletePathNode:function(e){e&&mn(e.target[0])},delete_segment:function(e){Xt(e.target[0],{x:e.x,y:e.y})},convert_to_NPTH:function(e){vi(e.target)},convert_to_pad:function(e){xi(e.target)},editorShowAttrDialog:function(){Lr()},updatePackageUuid:function(e,t){if(e&&Object.keys(e).length){var r,n,i,a=Fo.gJsonCache,o=a.schlib||a.FOOTPRINT;for(i in e)if(S(e,i))for(r in o)if(S(o,r)&&!r.match(/frame_lib_/)){n=Eo.c_paraToJson(o[r].head.c_para);if(n.package==i)if(t==ao.PCB||t==ao.PCBMODULE){o[r].head.uuid=e[i].uuid;o[r].head.utime=e[i].updateTime||"";m(d(r),{uuid:e[i].uuid,utime:e[i].updateTime||""})}else{o[r].head.puuid=e[i].uuid;m(d(r),{puuid:e[i].uuid})}}a.head.hasIdFlag=!0}},getNearestGridPoint:function(){return ce(arguments[0],arguments[1])},dragMoveSwitch:qi,dragMoveCheck:$i,getSnappedPoint:Et,getDecimalConfig:function(){return{fixedDecimal:lo.fixedDecimal,decimalPlaces:lo.decimalPlaces,decimalPlacesShow:lo.decimalPlacesShow}},getElementInfoById:function(e){return wt(d(e))},getLibInfoById:function(e){var t=d(e),r=wt(t),n=Fo.gJsonCache,i={ele:[t],attr:r,bbox:Eo.svg.getBBox(t),uuid:m(t,"uuid")};if(n.schlib)i.schlib=n.schlib[e];else if(n.FOOTPRINT){i.FOOTPRINT=n.FOOTPRINT[e];var a=n.FOOTPRINT[e].PAD,o={};if(a){for(var s in a)S(a,s)&&(o[a[s].number]=a[s].net);i.nets=o}}return i},findSimilar:function(e){e?Ar(e):sr("showFindSimilarDlg")},distributeItems:function(e){Pr(e)},removeCustomAttr:function(e){var t;t=Is==ao.SCHLIB||Is==ao.PCBLIB||Is==ao.SUBPART?[d("g1")]:un();var r,n;if(1===t.length&&/\.\d+$/.test(mr("pre",t[0]).textContent))for(var i=sr("getAllJson"),a=mr("pre",t[0]).textContent,o=0;o<i.length;o++){var s=i[o].json.schlib,l=sr("getTabById",[i[o].fid]).contentWindow.document;for(var c in s)if(!(c.indexOf("frame_lib")>=0)){var p=[];for(var h in s[c].annotation)p.push(s[c].annotation[h]);var u=p[1].string.indexOf(".");if(u>=1&&p[1].string.substr(0,u)===a.substr(0,u)){var f=l.getElementById(s[c].head.gId);r=m(f,"c_para");n=Eo.c_paraToJson(r);delete n[e];m(f,"c_para",Eo.jsonToC_para(n));Fo.updateOne(f)}}}t.forEach(function(t){r=m(t,"c_para");n=Eo.c_paraToJson(r);delete n[e];m(t,"c_para",Eo.jsonToC_para(n));Fo.updateOne(t)});sr("setTabUnsaved")},setPrePosition:function(e){Ir(e)},show_drawing_attr_dlg:function(e,t){if("TRACK"===e||"ARC"===e||"CIRCLE"===e)var r=m(t,"stroke-width");sr("show_drawing_attr_dlg",[e,"",r])},modify_drawing_attr:function(e,t){var r={},n=Z(Cs.target);""===n&&Cs.controlLine&&(n=Z(Cs.controlLine));if(Cs.started&&Cs.target||"origin"===n){switch(e){case"name":switch(n){case"schlib":r["attr-part-common-name"]=t;break;case"FOOTPRINT":r["attr-footprint-name"]=t;break;case"netflag":case"netlabel":r["attr-netLabel-name"]=t;break;case"pin":r["attr-pinpart-name"]=t;break;case"annotation":r["attr-text-text"]=t;break;case"TEXT":r["attr-pcbtext-text"]=t}break;case"width":switch(n){case"TRACK":r["attr-track-width"]=t;break;case"CIRCLE":r["attr-pcbcircle-width"]=t;break;case"ARC":r["attr-pcbarc-width"]=t}break;case"number":if("pin"===n){t=t.replace(/[^\x20-\x7E]+/g,"");r["attr-pinpart-number"]=t;r["attr-pinpart-spicepin"]=t}else if("PAD"===n){r["attr-pad-number"]=t;Cs.nameObj[Uo]=t}break;case"net":r["attr-via-net"]=t}if("origin"===n&&"object"==typeof e){var i={offsetX:e.x-Zo.canvas.originX,offsetY:e.y-Zo.canvas.originY};a("setOriginXY",[e]);Cs.end();kr();sr("setTabUnsaved");zo.save(["originXY","set.origin",i])}else{La(Cs.target,r,"NotSaveHistory","NotUpdateJsonCache");"TRACK"!==n&&"ARC"!==n||!Cs.controlLine||La(Cs.controlLine,r,"NotSaveHistory","NotUpdateJsonCache")}}},getPreOrNameNode:function(e,t){return mr(e,t)},initVerifyAndMounted:function(e,t){return Tr(e,t)},getActiveElement:function(){return Yo},componentFoundHighLight:function(e){componentFoundHighLight(e)},updateSymbolCache:function(e,t){return Rr(e,t)},terminalWorker:function(){Do()},setOriginByCenter:function(e){var t,r,n={x:Zo.canvas.originX,y:Zo.canvas.originY},i={offsetX:0,offsetY:0},o=Eo.fileType.getAbstractFileType(Is);if("pcblib"==o){var s,l,c,d,h=Fo.gJsonCache.PAD;if(h&&Object.keys(h).length>0){var u=Object.values(h)[0];s=l=u.x;c=d=u.y;for(var f in h){s=h[f].x>s?h[f].x:s;c=h[f].y>c?h[f].y:c;l=h[f].x<l?h[f].x:l;d=h[f].y<d?h[f].y:d}t=(s+l)/2;r=(c+d)/2;i={offsetX:t-n.x,offsetY:r-n.y};a("setOriginXY",[{x:t,y:r}]);sr("setTabUnsaved");zo.save(["originXY","set.origin",i]);return}}else if("schlib"==o){for(var g=Ka.cloneNode(!0),y=p("text",g),x=0;x<y.length;x++)v(y[x]);var m=Eo.svg.getBBox(g);if(0!==m.width||0!==m.height){t=m.x+m.width/2;r=m.y+m.height/2;var C=ce({x:t-n.x,y:r-n.y});i={offsetX:C.x,offsetY:C.y};a("setOriginXY",[{x:C.x+n.x,y:C.y+n.y}]);sr("setTabUnsaved");zo.save(["originXY","set.origin",i]);return}}if(("pcblib"==o||"schlib"==o)&&1==e){m=Eo.svg.getBBox(Ka);t=m.x+m.width/2;r=m.y+m.height/2;i={offsetX:t-n.x,offsetY:r-n.y};a("setOriginXY",[{x:t,y:r}]);sr("setTabUnsaved");zo.save(["originXY","set.origin",i])}},offsetElements:function(e,t){var r=un();Is!=ao.SCH&&Is!=ao.SCHLIB||junctionUtils.solveItems(r);Tt(r,e,t);Fo.updateMore(r);1===r.length?dr(r[0]):cr();if(Is==ao.SCH||Is==ao.SCHLIB){junctionUtils.solveItems(r);junctionUtils.solveTodoList()}var n=r.map(function(r){return["move",r.id,e,t]});Is==ao.SCH||Is==ao.SCHLIB?zo.save(junctionUtils.batHistoryCmd(n)):zo.save(n)},toggleBottomTopLayer:function(e){var t=un(),r={ARC:"attr-pcbarc-layerid",CIRCLE:"attr-pcbcircle-layerid",COPPERAREA:"attr-copperArea-layerid",DIMENSION:"attr-dimension-layerid",FOOTPRINT:"attr-footprint-layerid",PAD:"attr-pad-layerid",PROTRACTOR:"attr-protractor-layerid",RECT:"attr-pcbrect-layerid",SOLIDREGION:"attr-solidRegion-layerid",SVGNODE:"attr-pcbsvgimage-layerid",TEXT:"attr-pcbtext-layerid",TRACK:"attr-track-layerid"};t=t.filter(function(e){return"FOOTPRINT"===Z(e)});if(t.length){t.forEach(function(t){var n=Z(t),i={};i[r[n]]=e;La(t,i)});Fo.updateMore(t);sr("updateAttrPanel");return!1}return!0},set_fullscreen:function(){var t=e.parent.document.documentElement;(t.requestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen).call(t)},showDrawingAttrDlg:function(){sr("show_drawing_attr_dlg",["origin","setToolbarCmd"])},moveRelatively:function(){moveRelatively.setRelativePoint()},highlight_net:function(){var e,t,r=Is==ao.PCB||Is==ao.PCBMODULE,n=Is==ao.SCH||Is==ao.SCHMODULE;if(Yo){e=m(Yo,"net");t=m(Yo,"id")}else{var i=un();if(i&&i[0]){e=m(i[0],"net");t=m(i[0],"id")}}if(r&&(Qo.hasHighlightedNets("highlight-h")||Qo.hasHighlightedNets("selected-h"))){gn("selected-h");Qo.cancelHighlightNets(!0);if(Qo.lastHighlightNet===e)return}if(r&&e){Wn(e,{scroll:!1,fromHotKey:!0});Qo.lastHighlightNet=e}else if(n&&t){var a=d(t);"wire"===Z(a)&&sr("schCreateNet",[a])}},setPartElements:function(e,t,r){for(var n=un(),i=n.length,a=zt("g"),o=-1;++o<i;)a.appendChild(n[o]);Go.appendChild(a);var s,l,c=a.getBBox(),d=Zo.canvas,h={x:c.x+c.width/2,y:c.y+c.height/2};if(1===i){h.x=+m(n[0],"c_origin").split(",")[0];h.y=+m(n[0],"c_origin").split(",")[1]}if(Is===ao.PCB){l=t+d.originY-h.y;s=e+d.originX-h.x}else{s=e-h.x;l=t-h.y}Tt(n,s,l);var u={};if(Is!==ao.SCH)for(o=0,i=n.length;o<i;o++){var f=n[o];jt(f);Ls.appendElement(f);g(f,"selected");var y=m(f,"c_etype");if("pinpart"==y){var v=f.querySelector("path[c_note=note_pre]");if(v){var x=m(v,"c_text")||"",C=Vo.getNewPre2(x,!0,!0,u);C!=x&&Sa(v.parentNode,{text:C});u[C]=1}}if("COPPERAREA"==Eo.getPCBCmdKey(f)&&(Is==ao.PCBLIB||Is==ao.PCBMODULE||Is==ao.PCB)){var L,_=Fo.gJsonCache.COPPERAREA||{},P=[];for(var A in _)P.push(_[A].order);if(P.length){L=Math.max.apply(null,P);var b=m(f,"order")}else{L=0;b=0}m(f,"order",Number(L)+Number(b))}}else{if("sch"==Eo.fileType.getAbstractFileType(Is)){var S=p("text[c_note=note_pre]",a);if(S.length){var E=[];for(o=0,i=S.length;o<i;o++)E[o]=V(S[o].textContent).toUpperCase();var O=Vo.getNewPreArr(E,!0);for(o=0,
i=S.length;o<i;o++)O[o]&&O[o]!=E[o]&&Eo.node.setTextContent(S[o],O[o])}}jt(a);for(o=-1;++o<n.length;){g(n[o],"selected");Ka.appendChild(n[o])}}Go.removeChild(a);var I="";for(o=0;o<n.length;o++)I+=","+n[o].id;zo.save(["add",I]);ta()},rotatePartSvg:function(e,t){var r=e.id;Ka.appendChild(e);on([e],t);return d(r)},updateBindId:function(){var e=[];if(Is==ao.SCH)e=p("g[bindPCBId]",Ka);else{if(Is!=ao.PCB)return;e=p("g[bindSCHId]",Ka)}e.forEach(function(e,t){m(e,Is==ao.SCH?"bindPCBId":"bindSCHId",Q(t));Fo.updateOne(e,{noRebuildPlane:!0})})},updateSheetText:function(e,t){updateSheetText(e,t)},setSheetSize:function(e,t){setSheetSize(e,t)},jsonMgr_updateOne:function(e){Fo.updateOne(e)},changeLogo:function(){var e=null;e="lceda"===co?p('#part_frame_lib g[c_partid="part_image"] image[logotype="en"]')[0]:p('#part_frame_lib g[c_partid="part_image"] image[logotype="zh"]')[0];e&&e.remove()},getHoleLengthOfPad:function(){var e=un();if(e&&e[0]&&"PAD"===Z(e[0])){var t=e[0],r=+m(t.querySelectorAll(":not([c_padid]):not(title)")[1],"stroke-width"),n=N(m(t.querySelectorAll(":not([c_padid]):not(title)")[1],"points")),i=Eo.formatLengthSave(ls.distancePointToPoint(n[0],n[1])+r),a=Zo.canvas.unit;return{pixelVal:i,showVal:Eo.formatLengthShow(Eo.units.convert(i,"pixel",a))+a}}},modify_drawing_track_width:function(e){var r=Cs,n=r.dots.length;if(!e&&!isNaN(parseFloat(e))||m(r.target,"stroke-width")==e)return!1;if(2===n)a.hooks.modify_drawing_attr.apply(null,["width",e]);else if(n>2&&"draw.track"===Uo){Zo.canvas.modifyLineWidth=!0;var i=r.dots[n-2],o=r.dots[n-1],s=r.moveEndX,l=r.moveEndY;r.next();var c=new MouseEvent("mouseup",{button:0});r.draw(i,o,!0,c);var d=new MouseEvent("mousemove",{clientX:s,clientY:l});t.dispatchEvent(d);r.draw(r.mockX,r.mockY,!1,d);isNaN(parseFloat(e))||ms.modify_canvas({"attr-pcbcanvas-routing-size":e||"1"});Zo.canvas.modifyLineWidth=!1;return!0}},getPinStrFromModule:function(e){var t,r,n,i,a="",o=p('g[c_partid="part_pin"]',d("g1")).toArray(),s=0,l=o.length,c={},h=[],u=1;for(s=0;s<l;s++){t=p("text[text-anchor]",o[s]);if(t.length<1)break;if(m(t[0],"c_pinname")){n=t[0].textContent||"";r=t[1].textContent||""}else{n=t[1].textContent||"";r=t[0].textContent||""}r=r.replace(/[\s|,]/g,"");n=n.replace(/[\s|,]/g,"");if(void 0!==c[r]){i=r;for(;void 0!==c[r]||100===u;){r=i+"_"+u;u++}u=1}c[r]=n;h.push(r)}h.sort(function(e,t){return parseInt(e)-parseInt(t)});for(s=0;s<h.length;s++){r=h[s];n=c[r];a+=r+", "+n+"\n"}return a},createSchlibPackageText:function(e){createSchlibPackageText(e,arguments[1])},rebuildPlane:function(e){qo.rebuildPlane(e)},getShapeLength:function(){return d("g1").childNodes.filter(function(e){return e.id&&!e.id.match(/^layer_[^_]+_(begin|end)/)}).length},buildSignals:function(){Fo.buildSignals()},releaseActive:function(e){return Gr(e)},"jsonMgr.calAll":function(){Fo.calAll()}});e.addEventListener("error",Eo.reportError,!1);sr("triggerEvent",["history_change",0,-1,!0]);Ui()}();a.registerHook({getSVG:function(){var e=Fo.gJsonCache.systemColor.background,t=Fo.gJsonCache.systemColor.hole,r=Fo.gJsonCache.layers,n=a("getBBox"),i=n.x-10||0,o=n.y-10||0,s=Math.max(n.width+20,100)||0,l=Math.max(n.height+20,100)||0,c=sr("getTitle");return Is===ao.PHOTOVIEW?'<?xml version="1.0" encoding="utf-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+Eo.units.convert(s,"pixel","mm")+'mm" height="'+Eo.units.convert(l,"pixel","mm")+'mm" viewBox="'+i+" "+o+" "+s+" "+l+'"><title>'+H(c)+'</title><rect x="'+i+'" y="'+o+'" width="'+s+'" height="'+l+'" fill="'+e+'" stroke="none"/>'+(new XMLSerializer).serializeToString(Ka.parentElement.children[0])+(new XMLSerializer).serializeToString(Ka)+"</svg>":'<?xml version="1.0" encoding="utf-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+Eo.units.convert(s,"pixel","mm")+'mm" height="'+Eo.units.convert(l,"pixel","mm")+'mm" viewBox="'+i+" "+o+" "+s+" "+l+'"><title>'+H(c)+'</title><style type="text/css">\npath, polyline, polygon {stroke-linejoin:round;}\npath, polyline, polygon, line {stroke-linecap:round;}\nrect, circle, ellipse, polyline, polygon, line, path {shape-rendering:crispEdges;}\n'+function(e){for(var t=[],r=0;r<=24;r++)9!=r?e[r]&&e[r].color?t.push('*[layerid="'+r+'"] {stroke:'+e[r].color+"; fill:"+e[r].color+";}"):t.push('*[layerid="'+r+'"] {stroke:#FFFFFF; FILL:#FFFFFF;}'):t.push('*[layerid="'+r+'"] {display:none}');return t.join("")}(r)+'*[fill="none"] {fill: none;}\n*[stroke="none"] {stroke: none;}\ng[c_partid="part_pad"] > * + circle {fill: '+t+';}\ng[c_partid="part_via"] > * + circle {fill: '+t+';}\ng[c_partid="part_pad"] > polyline:nth-of-type(2) {stroke: '+t+';}g[c_partid="part_pad"][c_shape="ELLIPSE"]  polyline:nth-last-of-type(1) {stroke:'+t+';}g[c_partid="part_pad"][c_shape="RECT"]  polyline:nth-last-of-type(1) {stroke:'+t+';}g[c_partid="part_pad"][c_shape="POLYGON"]  polyline:nth-last-of-type(1) {stroke:'+t+';}g[c_partid="part_pad"] > polygon[c_padid], #gCurParts g[c_partid="part_pad"] > polygon[c_padid] {stroke-linejoin: miter;stroke-miterlimit: 100;}</style>\n<rect x="'+i+'" y="'+o+'" width="'+s+'" height="'+l+'" fill="'+e+'" stroke="none"/>'+function(){if("undefined"!=typeof XMLSerializer){var e=(new XMLSerializer).serializeToString(Ka);e.search(/[^\x00-\x7f]/)>=0&&(e=e.replace(/[^\x00-\x7f]/g,function(e){return"&#"+e.charCodeAt(0)+";"}));e=e.replace(/<circle [^>]*c_pindot="true"[^>]*(?:\/>|><\/circle>)/g,"").replace(/<rect [^>]*class="hitbox"[^>]*(?:\/>|><\/rect>)/g,"").replace(/<g(\s[^>]*)?\/>/g,"").replace(/ xmlns="http:\/\/www\.w3\.org\/2000\/svg"/g,"").replace(/ xmlns:xlink="http:\/\/www\.w3\.org\/1999\/xlink"/g,"");for(var t=["id","class","title","net","number"],r=0;r<t.length;r++)for(var n=new RegExp("(<\\w+[^>]*)\\s"+t[r]+'=\\"[^\\"]*\\"',"g");n.test(e);)e=e.replace(n,"$1");e=e.replace(/<g\s*>\s*<\/g>/g,"");e=e.replace(/( xlink:href=")(\/\/)/g,"$1"+location.protocol+"$2");e=e.replace(/( xlink:href=")(\/[^\/"][^"]*)/g,"$1"+location.protocol+"//"+location.host+"$2");return e}return"gCanvasToXML error! "}()+"</svg>"},updateLibCanvasAttr:function(e){m(d("g1"),"c_para",e)},updateJsonCache:function(e){if(e)"all"===e?Fo.calAll():Fo.gJsonCache=e;else{var t=un();Fo.updateMore(t)}},gJsonCache:function(e){if(e&&(e.id||e.gId)){var t=d(e.id||e.gId);if(!t)return;var r=e.cmdKey||Z(t),n=Fo.gJsonCache[r];return n&&n[e.id]}Fo.gJsonCache.head.docType=Is;Fo.gJsonCache.head.c_para=m(Ka,"c_para");Fo.gJsonCache.BBox=a("getBBox");Fo.gJsonCache.canvas=ma();Fo.gJsonCache.itemOrder=T();return Za(Fo.gJsonCache)},isSignalLayer:function(e){return oi(e)},highlightItems:function(){return pr.apply(null,arguments)},crossProbe:function(e,r){var n=e.selectObjPrefixs,i=e.selectObjWireNets,o=n&&n.length>0;if(o||i&&0!==i.length){Gr();for(var s=[],l=[],c=0;c<n.length;c++){for(var d,h,f=n[c].pre,g=p("#g1>g>g path[c_note]",Ka),y=0;y<g.length;y++){h=m(g[y],"c_text");if(V(h||"").toUpperCase()==f.toUpperCase()){d=g[y].parentNode.parentNode;if(ss.isLocked(d))continue;if(-1!==s.indexOf(d))break;s.push(d);l.push({rotation:n[c].rotation,x:n[c].x,y:n[c].y});break}}d&&u(d,"selected",!0)}for(c=0;c<i.length;c++){var v=i[c];p("[net="+v+"]",Ka).forEach(function(e){u(e,"selected",!0)});Qo.highlightNets([v])}if(r&&o){Gt();if(!s.length)return;t.addEventListener("mousemove",function e(r){t.removeEventListener("mousemove",e,!1);var n,i,o=s.map(function(e,t){return{x:Number(l[t].x),y:Number(l[t].y),rotation:Number(l[t].rotation)||0,node:e}}),c=rr(r,!1),d=0,p=0,h=0,u=0,f=0,g=0,y=[];for(i=0;i<l.length;i++){d+=Number(l[i].x);p+=Number(l[i].y)}d/=l.length;p/=l.length;for(i=0;i<o.length;i++){n=bt(o[i].node);u=Number(m(o[i].node,"c_rotation"))||0;if(u!=o[i].rotation){h=Le(360-(parseInt(o[i].rotation,10)-parseInt(u,10)));ns.rotate(o[i].node,h)}f=o[i].x-d+c.x;g=o[i].y-p+c.y;It(o[i].node,f-n.x,g-n.y);y.push({id:o[i].node.id,offsetX:f-n.x,offsetY:g-n.y})}Io.crossProbePlaceMoves=y;qi(!0);a("dragMoveCheck",[r,s])},!1)}else{if(1==s.length)kt(d);else if(s.length>1){var x=s.map(function(e){return Eo.svg.getBBox(e)}),C=Eo.combineMultiBox(x);C&&Mt(C)}sr("triggerEvent",["select_change"])}}},globalDelete:function(e){var t,r=[];e.deleteCopperArea&&(t=Fo.gJsonCache.COPPERAREA)&&(r=r.concat(Object.keys(t).map(function(e){return d(e)})));e.deleteText&&(t=Fo.gJsonCache.TEXT)&&(r=r.concat(Object.keys(t).map(function(e){return d(e)})));if(e.deleteBoardOutlines){var n=p('[layerid="'+io.BOARDOUTLINE+'"]');0!==n.length&&(r=r.concat(Array.prototype.slice.call(n)))}if(e.deleteDrawings){var i=Fo.gJsonCache.ARC,a=Fo.gJsonCache.CIRCLE,o=Fo.gJsonCache.DIMENSION,s=Fo.gJsonCache.PROTRACTOR,l=Fo.gJsonCache.HOLE,c=Fo.gJsonCache.PAD,h=Fo.gJsonCache.RECT,u=Fo.gJsonCache.SOLIDREGION,f=Fo.gJsonCache.SVGNODE,g=Fo.gJsonCache.VIA;i&&(r=r.concat(Object.keys(i).map(function(e){return d(e)}).filter(function(e){var t=m(e,"layerid");return t!=io.BOARDOUTLINE&&!oi(t)})));a&&(r=r.concat(Object.keys(a).map(function(e){return d(e)})));o&&(r=r.concat(Object.keys(o).map(function(e){return d(e)})));s&&(r=r.concat(Object.keys(s).map(function(e){return d(e)})));l&&(r=r.concat(Object.keys(l).map(function(e){return d(e)})));c&&(r=r.concat(Object.keys(c).map(function(e){return d(e)})));h&&(r=r.concat(Object.keys(h).map(function(e){return d(e)})));u&&(r=r.concat(Object.keys(u).map(function(e){return d(e)})));f&&(r=r.concat(Object.keys(f).map(function(e){return d(e)})));g&&(r=r.concat(Object.keys(g).map(function(e){return d(e)}).filter(function(e){return""===m(e,"net")})))}e.deleteFootprints&&(t=Fo.gJsonCache.FOOTPRINT)&&(r=r.concat(Object.keys(t).map(function(e){return d(e)})));if(e.deleteTracks&&(t=Fo.gJsonCache.TRACK)){r=r.concat(Object.keys(t).map(function(e){return d(e)}).filter(function(e){return m(e,"layerid")!=io.BOARDOUTLINE}));var y=Fo.gJsonCache.VIA;y&&(r=r.concat(Object.keys(y).filter(function(e){return oi(y[e].layerid)&&""!==y[e].net}).map(function(e){return d(e)})));var v=Fo.gJsonCache.ARC;v&&(r=r.concat(Object.keys(v).filter(function(e){return oi(v[e].layerid)}).map(function(e){return d(e)})))}r.length&&zr(r)},getSelectPrefixNamesAndNetNames:function(){var e=un(),t=Fo.gJsonCache.FOOTPRINT||{},r=Eo.extend({},Fo.gJsonCache.TRACK,Fo.gJsonCache.ARC,Fo.gJsonCache.CIRCLE),n={prefixNames:[],wireNetNames:[],padNetNames:{}};if(t||r)for(var i=0;i<e.length;i++){var a=e[i].id;if(t[a]){var o=t[a],s=o?o.TEXT:"";if(!s)continue;for(var l in s)if(S(s,l)){var c=s[l];"P"==c.type&&n.prefixNames.push({pre:c.text})}}else if(r[a]){o=r[a];var d=o.net;d&&-1==n.wireNetNames.indexOf(d)&&oi(o.layerid)&&n.wireNetNames.push(d)}else for(var p in t){var h,u,f=t[p];if(f.PAD&&f.PAD[a]){o=f.PAD[a];u=o.number;s=f?f.TEXT:"";if(!s)continue;for(l in s)if(S(s,l)){c=s[l];if("P"==c.type){h=c.text;break}}n.padNetNames[h]=u}}}return n},isPrefixDuplicated:function(e){var t,r=un();r&&r[0]&&(t=mr("pre",r[0]));return!(!t||!t.childNodes[0])&&(e.indexOf("?")<0&&Vo.isUsed(e,{except:t.id}))},delete:function(){if(Cs.started&&Cs.canBackStep())Cs.backStep();else if(!Zi()){var e,t,r,n=arguments[0];if("object"==typeof n){if(n.ids){e=n.ids;if(!Array.isArray(e))return;t=e.map(function(e){return d(e)})}else n.target&&(t=n.target);n.force&&(r=n.force);t=t.filter(function(e){var t="FOOTPRINT"===Z(e.parentNode)&&("note_name"===m(e.firstChild,"c_note")||"note_pre"===m(e.firstChild,"c_note"));return e&&(e.parentNode==Ka||t)});t.length&&zr(t,r);return}if(Yo){var i=Yo,a=Z(i);if("PAD"==a&&i.parentNode!=Ka){i.parentNode.parentNode==Ka&&zr([i.parentNode]);return}}zr()}},undoDraw:function(){Cs.started&&Cs.canBackStep()&&Cs.backStep()},rotate:function(){var e=fo&&fo.start,t=e;if(!Zi()||e){var r,n,i,a,o=arguments[0];if("number"==typeof o)n=o;else if("string"==typeof o)isNaN(+o)||(n=+o);else if("object"==typeof o&&o.ids){i=o.ids;n=o.degree;if(!Array.isArray(i))return}if(void 0===n){var s=+bo.getCacheObj("RotateStep");n=s?360-s:270}if(i){r=i.map(function(e){return d(e)});r=r.filter(function(e){return e&&(e.parentNode==Ka||li(e))});if(r.length){a=new Jt(r);sn(r,n);a.update();zo.save(a.hist)}sr("updateAttrPanel")}else if("draw.image"==Uo&&Cs.target)vt(Cs.target,n);else if(Jo&&Uo&&0===Uo.indexOf("place.part_")){var l=Uo.substr(6),c=d(l);Cs.target&&on([Cs.target],n);if(c)return on([c],n)}else if("draw.track"!=Uo&&"draw.copperArea"==Uo&&"draw.solidRegion"==Uo||!Cs.target){if(Yo){var p=Yo,h=Z(p);if("PAD"==h&&p.parentNode!=Ka){if(p.parentNode.parentNode==Ka){p=p.parentNode;if(ss.isLocked(p))return;sn([p],n);!t&&zo.save(["rotate",p.id,n]);sr("updateAttrPanel")}return}}r=un().filter(function(e){return!ss.isLocked(e)});if(r.length){if(t)sn(r,n);else{a=new Jt(r);sn(r,n);a.update();zo.save(a.hist)}sr("updateAttrPanel")}}else ii()}},visible_grid:function(){var e=m(d("grid1"),"display")||"";e="none"==e?"":"none";m(d("grid1"),{display:e});Zo.adsorbGrid.visible=!e},snap_grid:function(){Zo.adsorbGrid.enabled=!Zo.adsorbGrid.enabled},getAllCopperId:function(){var e=Fo.gJsonCache.COPPERAREA;if(e)return Object.keys(e)},setOriginXY:function(e){if(Is==ao.PCBLIB&&e.x<=0&&e.y<=0){e.x=400;e.y=300}e.x=isFinite(e.x)&&null!==e.x?+e.x:Zo.canvas.originX;e.y=isFinite(e.y)&&null!==e.y?+e.y:Zo.canvas.originY;e.x=Eo.formatLengthSave(e.x);e.y=Eo.formatLengthSave(e.y);Zo.canvas.originX=e.x;Zo.canvas.originY=e.y;var t=.5/wo,r=Eo.toFixed(1/wo+1e-5,5);m(d("gridOH"),{y1:e.y+t,y2:e.y+t});m(d("gridOV"),{x1:e.x+t,x2:e.x+t});m(d("gridPattern"),{x:e.x,y:e.y});m(d("gridPattern2"),{x:e.x+r,y:e.y+r});Qt()},findAndReplaceComponent:function(e,t,r){Hn(e,t,r)}});a.registerHook({PCBNetlist:function(){return Rn.apply(null,arguments)},PCBPreferences:function(){},autoRouterConfig:function(e){return qn(e)},buildPCB:function(){return Gn.apply(null,arguments)},drawBoardOutlineRoundrect:function(e,t,r,n,i){var a=p('[layerid="'+io.BOARDOUTLINE+'"]');zo.startBatch();zr(a);var o,s,l=" ",c="A"+i+l+i+" 0 0 1 ",d={"stroke-width":"1",fill:"none",c_shapetype:"line",layerid:io.BOARDOUTLINE};if(i&&i>0){o=[e+i+l+t,e+r-i+l+t,e+r+l+(t+i),e+r+l+(t+n-i),e+r-i+l+(t+n),e+i+l+(t+n),e+l+(t+n-i),e+l+(t+i)];s=[zt("polyline",{id:Eo.newId(),points:o[0]+l+o[1]}),zt("path",{id:Eo.newId(),d:"M"+o[1]+c+o[2]}),zt("polyline",{id:Eo.newId(),points:o[2]+l+o[3]}),zt("path",{id:Eo.newId(),d:"M"+o[3]+c+o[4]}),zt("polyline",{id:Eo.newId(),points:o[4]+l+o[5]}),zt("path",{id:Eo.newId(),d:"M"+o[5]+c+o[6]}),zt("polyline",{id:Eo.newId(),points:o[6]+l+o[7]}),zt("path",{id:Eo.newId(),d:"M"+o[7]+c+o[0]})]}else{o=[e,t,e+r,t,e+r,t+n,e,t+n,e,t];s=[zt("polyline",{id:Eo.newId(),points:o.join(l)})]}m(s,d);for(var h=0;h<s.length;h++){Ls.appendElement(s[h]);zo.save(["add",s[h].id])}Fo.updateMore(s);zo.saveBatch();var u=Ls.getActiveLayer();bi(u)&&qo.rebuildPlaneInLayer(u)},exportDSN:function(e){return Es.exportDSN(e)},fixPretextAngle:function(){var e=p('#g1 > g[c_shapetype="group"]:not([locked]):not([display="none"])',Ka);zo.startBatch();for(var t=0;t<e.length;t++)Un(e[t],!0);zo.saveBatch()},getBOMFromPCBEditor:function(){return Pn()},getBoardBBox:function(){return ri()},getBoardOutlines:function(){return ai()},getCmdFilter:function(){return Mo},getCopperAreaCompressData:function(e){var t=[];p('path[attachedcopperid="'+e.gId+'"]').forEach(function(e){t.push(m(e,"d"))});return JSON.stringify([t])},getAllCopperAreaCompressData:function(){var e={};p("path[attachedcopperid]").forEach(function(t){var r=m(t,"attachedcopperid");e[r]?e[r].push(m(t,"d")):e[r]=[m(t,"d")]});for(var t in e)S(e,t)&&(e[t]=JSON.stringify([e[t]]));return e},getCopperNetRelation:function(){return lo.copperNetRelation},getDRCRuleInfo:function(){return kn()},getAllNetName:function(){return Fo.getAllNetName()},getNetRule:function(e){return Ai(e)},getAllNetsRules:function(){var e=Fo.gJsonCache.SIGNALS,t={};for(var r in e)e[r].length&&S(e,r)&&(t[r]=Ai(r));return t},getHighLightNet:function(){return En()},getPolygonBoardOutline:function(){return qo.getPolygonBoardOutline()},getSelectedPadPoints:function(){return Zn()},hideErrorSymbols:function(){Ko&&Ko.hideErrorSymbols&&Ko.hideErrorSymbols()},highlightNet:function(){return Wn.apply(null,arguments)},importByPathD:function(){return ya.apply(null,arguments)},importChanges:function(){return jn.apply(null,arguments)},importSession:function(e,t,r,n,i){return Es.importSession(e,t,r,n,i)},isBuiltCopperArea:function(){return qo.isBuiltCopperArea()},layerColor:function(){return Ls.getLayersCache()},markDRCError:function(){return Dn.apply(null,arguments)},modifyPackage:function(e){var t=m(Ka,"c_para")||"",r=t?t.split("`"):[];""===r[0]&&r.shift();r.length%2&&r.push("");e=e||"";e=e.replace(/[`~]/gi,"");for(var n=0;n<r.length-1;n+=2)if("package"==r[n]){r[n+1]=e;break}n>r.length-1&&r.push("package",e);var i=r.join("`");m(Ka,"c_para",i);zo.save(["attr",Ka.id,{c_para:t},{c_para:i}])},modifyLink:function(e){var t=m(Ka,"c_para")||"",r=t?t.split("`"):[];""===r[0]&&r.shift();r.length%2&&r.push("");e=e||"";e=e.replace(/[`~]/gi,"");for(var n=0;n<r.length-1;n+=2)if("link"==r[n]){r[n+1]=e;break}n>r.length-1&&r.push("link",e);var i=r.join("`");m(Ka,"c_para",i)},pcb_generates_pick_and_place_file:function(){var e=ri();if(e.width<1||e.height<1)return"NOBOARDOUTLINE";var t=Zo.canvas.originX,r=Zo.canvas.originY;if(isNaN(t)||isNaN(r))return"CANVASORIGINANOMALY";var n=[],i=Fo.gJsonCache.FOOTPRINT||{};for(var a in i)if(S(i,a)){var o=function(e){function n(e){return Eo.toFixed(Eo.units.convert(e,"pixel","inch"===Zo.canvas.unit?"mil":Zo.canvas.unit),2)+("inch"===Zo.canvas.unit?"mil":Zo.canvas.unit)}var i=e.PAD||{},a=e.head||{};if(!Object.keys(i).length)return!1;var o={centroidX:0,centroidY:0,padX:0,padY:0,padNumber:"~"},s=-9999999,l=9999999,c=s,d=l;for(var p in i)if(S(i,p)){var h=i[p];if(h.number+""<o.padNumber){o.padNumber=h.number+"";o.padX=h.x;o.padY=h.y}h.x>s&&(s=h.x);h.y>c&&(c=h.y);h.x<l&&(l=h.x);h.y<d&&(d=h.y)}o.centroidX=(s+l)/2;o.centroidY=(c+d)/2;var u=o.centroidX-t,f=o.padX-t,g=e.head.x-t;if("1"!=a.layerid){u-=2*u;f-=2*f;g-=2*g}o.centroidX=n(u);o.centroidY=n(r-o.centroidY);o.padX=n(f);o.padY=n(r-o.padY);o.refX=n(g);o.refY=n(r-e.head.y);return o}(i[a]),s="",l="",c=i[a].TEXT;for(var d in c){S(c,d)&&("P"==c[d].type?s=c[d].text:"N"==c[d].type&&(l=c[d].text));if(s&&l)break}if(o){o.pre=s;o.name=l;var p=i[a].head||{};o.footprint=Eo.c_paraToJson(p.c_para).package||"";o.TB="1"==p.layerid?"T":"B";o.rotation=+p.rotation;o.rotation=isNaN(o.rotation)?0:o.rotation;"B"==o.TB&&(o.rotation=180-o.rotation);n.push(o)}}n.forEach(function(e){for(var t in e)S(e,t)&&e[t].toString().match(/^0\d+$/)&&(e[t]+="'")});return n},pcbnettext_toggle:function(e){if("boolean"!=typeof e){e=!(!1!==lo.pcbNetTextVisible)}lo.pcbNetTextVisible=e;gi();sr("triggerEvent",["pcbnettext_toggle",e])},reDrawBoardOutlineRect:function(e){var t=p('[layerid="'+io.BOARDOUTLINE+'"]');zo.startBatch();zr(t);var r={c_shapetype:"line",layerid:"10",fill:"none","stroke-width":"1",id:Eo.newId(),points:e},n=zt("polyline",r);Ls.appendElement(n);Fo.updateOne(n);var i=Ls.getActiveLayer();bi(i)&&qo.rebuildPlaneInLayer(i);zo.save(["add",n.id]);zo.saveBatch()},reDrawBoardOutlineRound:function(e,t,r){if(e||t||r){var n=p('[layerid="'+io.BOARDOUTLINE+'"]');zo.startBatch();zr(n);var i={cx:e,cy:t,r:r,layerid:"10","stroke-width":"1",fill:"none",c_shapetype:"line",id:Eo.newId()},a=zt("circle",i);Ls.appendElement(a);Fo.updateOne(a);var o=Ls.getActiveLayer();bi(o)&&qo.rebuildPlaneInLayer(o);zo.save(["add",a.id]);zo.saveBatch()}},rebuildAllCopperArea:function(){sr("buildCopper",["all"]);var e=Fo.getAllObjsOf("COPPERAREA");es.insertNodes(e,"COPPERAREA")},rebuildCurrentPlane:function(){qo.rebuildPlane("currentLayer")},getSelectedPath:function(){var e=un();return 1==e.length&&e[0]instanceof SVGPathElement?{path:m(e[0],"d"),id:m(e[0],"id")}:""},editSelectedPath:function(e){if(e){var t,r=un(),n=d(e.id),i=e.path,a=Z(n);if(n&&n instanceof SVGPathElement){t=m(n,"d");m(n,"d",i);zo.save(["attr",n.id,{d:t},{d:i}]);Fo.updateOne(n);if("COPPERAREA"==a){sr("buildCopper",[_s.COPPERAREA(n).id])}1==r.length&&r[0]instanceof SVGPathElement&&m(r[0],"id")==e.id&&dr(n)}}},removeAllCopperArea:function(){Mi()},deleteAllNet:function(){return Nn()},wireToLine:function(e){return wn(e)},runDRC:function(e){return Bn(e)},setAutoRouterInfo:function(e){"object"==typeof e?Fo.gJsonCache.autoRouter=e||{}:delete Fo.gJsonCache.autoRouter},getDifferentialPairSetting:function(){return Ts.getConfig()},setDifferentialPairSetting:function(e){return Ts.setConfig(e)},setDRCRuleInfo:function(e){return Mn(e)},setSelectedPadPoints:function(e){return Kn(e)},showHideItems:function(e,t,r){return On(e,t,r)},systemColor:function(){return Xn()},innerLayerCount:function(){var e,t=0;for(e in Fo.gJsonCache.layers)S(Fo.gJsonCache.layers,e)&&K(e)&&!0===Fo.gJsonCache.layers[e].config&&t++;return t},unit:function(){return Zo.canvas.unit},getClippedPolygon:function(e,t){var r,n,i,a,o=new ClipperLib.Polygons,s=new ClipperLib.ExPolygons,l=new ClipperLib.Clipper;e=e.map(function(e){return{x:Math.round(500*e[0]),y:Math.round(500*e[1])}});o.push(e);for(r=0;r<t.length;r++)t[r]=t[r].map(function(e){return{x:Math.round(500*e[0]),y:Math.round(500*e[1])}});l.AddPolygons(o,ClipperLib.PolyType.ptSubject);l.AddPolygons(t,ClipperLib.PolyType.ptClip);l.Execute(ClipperLib.ClipType.ctXor,s,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);for(r=0;r<s.length;r++){i=s[r].holes;a=s[r].outer;s[r].outer=a.map(function(e){return[e.x/500,e.y/500]});for(n=0;n<i.length;n++)i[n]=i[n].map(function(e){return[e.x/500,e.y/500]})}return s},getSimplifiedPolygon:function(e){var t=new ClipperLib.ExPolygons,r=new ClipperLib.Clipper;r.AddPolygons([e],ClipperLib.PolyType.ptSubject)&&r.Execute(ClipperLib.ClipType.ctUnion,t,ClipperLib.PolyFillType.pftEvenOdd,ClipperLib.PolyFillType.pftEvenOdd);return t},offsetPolygon:function(e,t){var r,n,i,a,o=N(e),s=[];for(r=0;r<o.length;r++){i=o[r];if(s.length<2)s.push(i);else{a=!0;for(n=0;n<s.length-1;n++)if(He(i,s[n],s[n+1])){a=!1;break}a&&s.push(i)}}var l=s.map(function(e){return{x:100*e.x,y:100*e.y}}),c=new ClipperLib.Polygons;c.push(l);var d=new ClipperLib.Clipper,p=d.OffsetPolygons(c,100*t,ClipperLib.JoinType.jtMiter,100,!0);return p.length>0?p[0].map(function(e){return e.x/100+" "+e.y/100}).join(" "):""},applyTeardropAll:function(){ja.apply(null,arguments)},removeTeardropAll:function(){Ha.apply(null,arguments)},applyPanelize:function(){za.apply(null,arguments)},applyCheckDimension:function(){q(Fo.gJsonCache,!0)},startRouteLengthTuning:function(){Ua.apply(null,arguments)},getSelectedPolygonPoints:function(){var e=un(),t=Z(e[0]);if(1==e.length){if("SOLIDREGION"===t)return{point:m(e[0],"points"),id:m(e[0],"id")};if("PAD"===t)return{point:m(p("polygon:not([c_padid]):not(title)",e[0])[0],"points"),id:m(e[0],"id"),c_origin:m(e[0],"c_origin"),hole:p(":not([c_padid]):not(title)",e[0])[1]}}return null},editSelectedPolygon:function(e){if(e){var t,r=e.point,n=un(),i=d(e.id),a=[i],o=Z(i);"PAD"===o&&(a=p("polygon:not([c_padid]):not(title)",i));if(1==a.length&&a[0]instanceof SVGPolygonElement){t=x(i,!0);m(a[0],"points",r);zo.save(["node",i.id,t,x(i,!0)]);Fo.updateOne(i);if("COPPERAREA"==o){sr("buildCopper",[_s.COPPERAREA(a[0]).id])}m(a[0],"id")==e.id&&dr(a[0])}if("PAD"===o){Oi(i,m(i,"c_shape"));var s=N(r),l=s[0].x,c=s[0].x,h=s[0].y,u=s[0].y;s.forEach(function(e){l=Math.max(l,e.x);c=Math.min(c,e.x);h=Math.max(h,e.y);u=Math.min(u,e.y)});m(i,{c_width:Eo.formatLengthShow(l-c),c_height:Eo.formatLengthShow(h-u)});if(e.hole&&e.hole.hasHole){var f,g=e.hole,y=p(":not([c_padid]):not(title)",n[0])[1];f=i.parentNode===Ka?Fo.gJsonCache.PAD[i.id]:Fo.gJsonCache.FOOTPRINT[i.parentNode.id].PAD[i.id];f.holeCenter=g.center;if("round"===g.type)m(y,{cx:g.center.x,cy:g.center.y});else{m(y,{points:g.points});f.slotPointArr=Je(g.points)}}sr("updateAttrPanel")}}},createSolderMask:function(){yi()},pcbGetLengthOfTrackAndArc:function(){return ls.getLengthOfTrackAndArc.apply(null,arguments)},pcbGetTrackAndArcLengthFromElement:function(){return ls.getTrackAndArcLengthFromElement.apply(null,arguments)},isPlaneLayer:function(){return bi.apply(null,arguments)},getActiveLayer:function(){return Ls.getActiveLayer()},getNetOfPlacingElement:function(){return m(Cs.target,"net")||""},isPointInPolygon:function(){return ls.isPointInPolygon.apply(void 0,arguments)},moveTrackTopWhenSelected:function(){var e=p('[selected_to_top]:not([c_outlinetype="panelizedOutline"])'),t=h('[after_selected_to_top]:not([c_outlinetype="panelizedOutline"])');if(e.length>0){e.forEach(function(e){Ka.insertBefore(e,t);C(e,"selected_to_top")});C(t,"after_selected_to_top")}var r=un();if(1===r.length){var n=r[0],i=n.nextSibling;if(n.parentElement===Ka&&["TRACK","ARC"].indexOf(Z(n))>-1){Ka.appendChild(n);m(i,{after_selected_to_top:!0});m(n,{selected_to_top:!0})}}},importPhotoview:function(){return ca.apply(null,arguments)},changeLibMaskerOrder:function(e){d("libMasker")&&(e==io.TOPLAYER||e==io.TOPSILKLAYER?d("libMasker").appendChild(d("masker-topLayer")):e!=io.BOTTOMLAYER&&e!=io.BOTTOMSILKLAYER||d("libMasker").appendChild(d("masker-bottomLayer")))},createLibMasker:function(){la()},deleteCopperPath:function(e,t){if(e&&e.length){var r,n,i={};for(var a in Fo.gJsonCache.COPPERAREA)S(Fo.gJsonCache.COPPERAREA,a)&&Fo.gJsonCache.COPPERAREA[a].fillData&&delete Fo.gJsonCache.COPPERAREA[a].fillData;e.forEach(function(e){var t=p("path[attachedcopperid="+e);t.length&&t.forEach(function(t){t.parentNode.removeChild(t);r=m(d(e),"net");n=m(d(e),"layerid");lo.copperNetRelation[r+"_"+n]&&lo.copperNetRelation[r+"_"+n][e]&&delete lo.copperNetRelation[r+"_"+n][e];i[r]=!0})});if(!t)for(var o in i)S(i,o)&&Qo.buildOneNet(o,!1)}},placeCopperPath:function(e,t,r){"string"==typeof e&&(e=JSON.parse(e));if(e.pours){var n=[];for(var i in e.connect)for(var a in e.connect[i]){lo.copperNetRelation[i]||(lo.copperNetRelation[i]={});lo.copperNetRelation[i][a]=e.connect[i][a]}var o,s,l,c,p,h,u;if(t){var f={algorithmVersion:"1.0",fillData:{},copperNetRelation:lo.copperNetRelation,datastrid:sr("getTabInfo",[r]).datastrid};for(var g in e.pours)if(S(e.pours,g)){o=e.pours[g];o.paths&&o.paths.length>0&&(f.fillData[g]=JSON.stringify([o.paths]))}sr("updateCopperAreaDataInIndexDB",[r])(f)}var y={};for(g in e.pours)if(S(e.pours,g)){o=e.pours[g];if(!o.paths||!o.paths.length)continue;s=d(g);l=m(s,"layerid");p=o.stroke;h=m(s,"fillStyle");u="grid"===h;for(var v=0;v<o.paths.length;v++)if(void 0!==o.paths[v]){c=zt("path",{id:Eo.newId(),d:o.paths[v],"stroke-width":u?p:0,stroke:"#FF0000",fill:u?"none":"#FF0000",layerid:l,attachedcopperid:g,c_shapetype:"line",display:"invisible"==Zo.canvas.copperZone?"none":""});Ls.appendElement(c)}else n.push({id:g,err:e.pours[g].err||"Error"});u&&(Fo.gJsonCache.COPPERAREA[m(s,"id")].strokeWidth=p);es.addToRTree(Fo.gJsonCache.COPPERAREA[m(s,"id")],"COPPERAREA");y[m(s,"net")]=!0}for(var x in y)S(y,x)&&Qo.buildOneNet(x,!1);if(n.length){var C="";n.forEach(function(e){C+=e.id+": "+e.err+"<br>"});sr("messagerAlert",[{title:"Error",msg:'<div class="i18n" style="margin-bottom: 10px;background-color: #fff3cd;border-color: #ffeeba;color: #856404;padding: .75rem 1.25rem;border-radius: .25rem;">'+C+"</div>"}])}}},switchLayer:function(){for(var t,r=e.parent.jQuery,n=r("#toolbar-pcblayer-tbl tr"),i=null,a=0,o=n.length;a<o;a++){var s=r(n[a]),l=s.attr("layer_id");null===i&&oi(l)&&(i=a);s.hasClass("active")&&(t=a);var c=r(n[a+1]).attr("layer_id");if(a+1>t&&oi(c)){i=a+1;break}}n.removeClass("active");n.eq(i).find("td:first-child").trigger("click").parent().addClass("active")},switchLayerReverse:function(){for(var t,r=e.parent.jQuery,n=r("#toolbar-pcblayer-tbl tr"),i=null,a=n.length-1;a>-1;a--){var o=r(n[a]),s=o.attr("layer_id");null===i&&oi(s)&&(i=a);o.hasClass("active")&&(t=a);s=n.eq(a-1).attr("layer_id");if(a-1<t&&oi(s)){i=a-1;break}}n.removeClass("active");n.eq(i).find("td:first-child").trigger("click").parent().addClass("active")},switchAllLayer:function(){sr("switchAllLayer",["-"])},switchAllLayerReverse:function(){sr("switchAllLayer",["+"])},objectMap_cfg:function(){return Fo.gJsonCache.objectMap},initPcblayObjectSheet:function(e){if(d("pcblayerObject")){var t=d("pcblayerObject").sheet,r=t.cssRules||t.rules;if(r){for(var n=r.length-1;n>=0;)t.deleteRule(n--);var i,a=Fo.gJsonCache.objectMap.objects,n=0,o="";for(var s in a)if(S(a,s)){if("All"==s||"Prefix"==s||"Name"==s||"Text"==s)continue;e||(o=!0===a[s].selected?"":"none");i=a[s].selectorText+"{display:;pointer-events:"+o+";}";t.insertRule(i,n++)}}}},exportPins:function(){return Es.exportPins()},batchPlaceVias:function(e){function r(e,t,i,a){setTimeout(function(){ae+=ie;var o=Math.round(ae);w.length&&parent.$.data(w[0],"progressbar")&&w.progressbar("setValue",o);if(!R.is(":visible")&&t<oe-2)return n(i,a);var s=I.cloneNode(!0);m(s,{id:"gge"+ ++ko,net:e[t].copperNet||""});i.appendChild(s);yr(s,e[t].row,e[t].col);var l=_s.VIA(s),c=es.createNode(l,"VIA").treeNodes,d=Ko.checkNodeForError(s,c,!0);if(d&&!d.hasError){a.push(s);zo.save(["add",s.id,Eo.node.getRefId(s)])}else v(s);t+=1;if(t===oe)return n(i,a);if(t%50==0){Ka.insertBefore(i,se);Fo.updateViasBatch(a,"VIA");a=[]}return r(e,t,i,a)},0)}function n(e,t){Ka.insertBefore(e,se);Fo.updateViasBatch(t,"VIA");R&&R.dialog("close");zo.saveBatch();qo.rebuildPlane("all");parent.$.messager.confirm({title:"Notice",msg:parent.Locale.i18n("Multiple vias have been placed, do you want to rebuild the copper area?"),textOK:"Yes",textCancel:"No"},function(e){e&&sr("buildCopper",["all"])})}var i,a,o,s,l,c,h,u,f,g,y=[],x=un(),L=d("part_via").childNodes,_=e.diameter/2||+m(L[0],"r"),P=e.drillDiameter/2||+m(L[1],"r"),A=t.createDocumentFragment(),b=/Z/gi,S=zt("polyline",{points:""}),E=[],O=[],I=d("part_via").cloneNode(!0);m(I,{c_shapetype:"group",c_etype:"pinpart"});C(I,"pointer-events");C(I,"display");var T=I.childNodes;m(T[0],"r",_);m(T[1],"r",P);var R=parent.$.messager.progress({title:parent.Locale.i18n("Placing Vias"),interval:0,value:0,text:parent.Locale.i18n("Progressing..."),closable:!0}),w=parent.$.messager.progress("bar",R);for(i=0;i<x.length;i++){s=x[i];l=m(s,"net");c=m(s,"id");h=m(s,"fillStyle");u=m(s,"layerid");if("solid"===h&&"COPPERAREA"===Z(s)){var N=function(e){var t=[],r=Fo.gJsonCache.COPPERAREA;for(var n in r){var i=r[n];if(i.layerid!=e&&oi(i.layerid)&&"solid"==i.fillStyle){var s=+i.clearanceWidth||1,l=p("path[attachedcopperid = "+i.gId+"]");if(0!==l.length)for(a=0;a<l.length;a++){f=l[a];var c=[],d=m(f,"d"),h=d.split(b).filter(function(e){if(/M|L|A/gi.test(e))return e}),u=_+s,g=[];for(o=0;o<h.length;o++){H=h[o];b.test(H)||(H+="Z");if(0===o){j=ui(H,10);for(var y=ClipperLib.OffsetPolygon(j.map(qo.zoomInPoint),qo.zoomInOffsetVal(-u)),v=0;v<y.length;v++){z=y[v];!z[0]||z[0].x==z[z.length-1].x&&z[0].y==z[z.length-1].y||z.push(z[0]);g.push(z)}}else{j=ui(H,10);B=ClipperLib.OffsetPolygon(j.map(qo.zoomInPoint),qo.zoomInOffsetVal(u))[0];B&&c.push(B)}}0!==g.length&&t.push({outer:g,holes:c})}}}return t}(u),k=m(s,"d");(function(e){var t,r,n,i,a,o,s,l,c,d,p={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"},u=/([MZLHVCSQTAmzlhvcsqta])([eE ,\-\+.\d]+)*/g,f=e.match(u),g=[];for(t=0;t<f.length;t++){r=u.exec(e);if(D(r)&&3===r.length&&r[2]&&r[2].trim()){a=r[2].match(/(?:[-+]?(?:(?:\d+\.\d+)|(?:(?:\d+)|(?:\.\d+)))(?:e[-+]?\d+)?)/gi);s=r[1].toLowerCase();if(p[s]&&(l=p[s])&&a.length>l){c=h[r[1]]?h[r[1]]:r[1];d=r[1];for(n=0,i=a.length;n<i;n+=l){o=a.slice(n,l);o.unshift(d);g.push(o);d=c}}else{a.unshift(r[1]);g.push(a)}}else{a=[r[1]];"z"==a[0]&&(a[0]="Z");g.push(a)}}})(k);g=+m(s,"clearanceWidth")||1;y=p("path[attachedcopperid = "+c+"]");if(0===y.length)continue;for(a=0;a<y.length;a++){f=y[a];var M,B,V=[],F=m(f,"d"),G=F.split(b).filter(function(e){if(/M|L|A/gi.test(e))return e}),Y=_+g;for(o=0;o<G.length;o++){var j,H=G[o];b.test(H)||(H+="Z");if(0===o){var X="";M=[];j=ui(H,10);for(var U=ClipperLib.OffsetPolygon(j.map(qo.zoomInPoint),qo.zoomInOffsetVal(-Y)),J=0;J<U.length;J++){var z=U[J];!z[0]||z[0].x==z[z.length-1].x&&z[0].y==z[z.length-1].y||z.push(z[0]);M.push(z)}M.forEach(function(e){e.forEach(function(e){var t=qo.zoomOutPoint({x:e.x,y:e.y});X+=t.x+" ";X+=t.y+" "})});m(S,"points",X)}else{j=ui(H,10);B=ClipperLib.OffsetPolygon(j.map(qo.zoomInPoint),qo.zoomInOffsetVal(Y))[0]||[]
;B&&V.push(B)}}if(0!==M.length){var W=Eo.svg.getBBox(S);if(W&&W.width>0&&W.height>0)for(var K=W.x+1;K<W.x+W.width;K+=e.rowSpacing)for(var q=W.y+1;q<W.y+W.height;q+=e.columnSpacing){var $=qo.zoomInPoint({x:K,y:q}),Q=qo.testSimplyPolygonsContainsPoint(M,$),ee=qo.testSimplyPolygonsContainsPoint(V,$);if(Q&&!ee){var te=!0;for(i=0;i<N.length;i++){var re=qo.testSimplyPolygonsContainsPoint(N[i].outer,$);if(re){var ne=qo.testSimplyPolygonsContainsPoint(N[i].holes,$);if(!ne){te=!1;break}}}te||E.push({row:K,col:q,copperNet:l})}}}}}}w.progressbar("options").text="{value}%";w.progressbar("setValue",0);if(E.length<=0)R&&R.dialog("close");else{var ie=100/E.length,ae=0,oe=E.length,se=Ls.get("other_end");zo.startBatch();r(E,0,A,O)}},pathToPolygons:function(e){return ui(e)}});e.addEventListener("load",function(){var r=U();u(Go,"bw-"+r,!0);lo.decimalPlaces=lo.pcbDecimalPlaces;lo.decimalPlacesShow=lo.pcbDecimalPlacesShow;lo.fixedDecimal=!0;lo.vectorEffectSupported=void 0!==hs.style.vectorEffect;e.addEventListener("resize",function(){var e=t.documentElement.clientWidth||9,r=t.documentElement.clientHeight||9,n=ms.getViewBox(),i=[n[0]+.5*n[2]-.5*e/wo,n[1]+.5*n[3]-.5*r/wo,e/wo,r/wo];m(Go,{width:e,height:r});ms.setViewBox(i)},!1);!function(){var e=t.documentElement.clientWidth||9,r=t.documentElement.clientHeight||9,n=Zo.canvas.originX,i=Zo.canvas.originY;if(Eo.fileType.isLib(Is)){n-=e/wo/2;i-=r/wo/2}m(Go,{width:e,height:r,viewBox:[n,i,e/wo,r/wo].join(" ")})}();t.addEventListener("mouseover",Br,!1);t.addEventListener("mouseout",Br,!1);t.addEventListener("mousedown",Br,!1);t.addEventListener("mouseup",Br,!1);t.addEventListener("click",function(e){var t=e.altKey;~function(e){e&&a("highlight_net")}(t)},!1);t.addEventListener("contextmenu",nr,!1);t.addEventListener(!Po||"onwheel"in t?"wheel":"MozMousePixelScroll",ir,{passive:!1});t.addEventListener("mousemove",er,!1);t.addEventListener("mousemove",Sr,!1);t.addEventListener("mouseup",Sr,!1);t.addEventListener("mouseout",function(){Sr.data.uplock=!0},!1);t.addEventListener("drop",function(e){sr("editor_drop",[e]);e.preventDefault()},!1);hr();$t(Go);Ki();oa();ho();Wa();qt();Qt();hn();sr("buildVersionCheck",[lo.version+","+lo.buildDate]);if(Is==ao.PCB||Is==ao.PCBLIB){if(Fo.gJsonCache.layers[io.RATLINES]&&!1===Fo.gJsonCache.layers[io.RATLINES].visible){Ls.hide(io.RATLINES);Fo.gJsonCache.DRCRULE.isRealtime=!1;sr("triggerEvent",["layer_update"])}es.rebuild()}Is==ao.PCBLIB&&(Zo.canvas.unit="mm");zn();e.loaded=!0;sr("triggerEvent",["select_change"]);sr("triggerEvent",["editor_load"])},!1);!function(){function e(e){if(""!==Uo)return!1;var r=Eo.node.children(e.target.parentNode)[0],n=d("textInputBox");if(!n){n=t.createElement("textarea");t.body.appendChild(n);n.id="textInputBox";n.className="textInputBox";n.style.width="200px";n.style.height="100px";m(n,"min-ofw",n.offsetWidth);m(n,"min-ofh",n.offsetHeight);n.addEventListener("change",function(){var e=i,t=this.value;sr("addUserBehaviorRecord",["text-edit-submit",{text:t}]);e.id||(e.id=Eo.newId());var r=e.parentNode,n=r.cloneNode(!0);Sa(r,{text:t},function(){var e=r.cloneNode(!0);zo.save(["node",r.id,n,e]);r.parentNode==Ka?Fo.updateOne(r):Fo.updateOne(r.parentNode,{noRebuildPlane:!0})})},!1);n.addEventListener("blur",function(){this.style.display="none"},!1);n.addEventListener("keydown",function(e){32==e.keyCode&&e.stopPropagation()},!1);void 0!==n.style.resize||function(e){function r(r){if(r.button===ro){c&&i();if(r.offsetX>e.offsetWidth-16&&r.offsetY>e.offsetHeight-16){r.preventDefault();e.style.cursor="nwse-resize";t.addEventListener("mousemove",n,!1);t.addEventListener("mouseup",i,!1);c=!0;a=r.pageX;o=r.pageY;s=parseInt(e.style.width,10);l=parseInt(e.style.height,10)}}}function n(t){var r=s+t.pageX-a,n=l+t.pageY-o;e.style.width=Math.min(Math.max(r,100),1200)+"px";e.style.height=Math.min(Math.max(n,100),1e3)+"px"}function i(){if(c){e.style.cursor="";t.removeEventListener("mousemove",n,!1);t.removeEventListener("mouseup",i,!1);c=!1}}var a=0,o=0,s=0,l=0,c=!1;e.addEventListener("mousedown",r,!1);e.addEventListener("blur",i,!1)}(n)}var a=e.pageX,o=e.pageY;n.style.display="";n.style.top=Math.max(o-5,5)+"px";n.style.left=Math.max(a-5,5)+"px";var s=m(r,"c_text");n.value=V(s.replace(/\\n/g,"\n"));n.oldValue=s;n.select();n.focus();i=r;sr("addUserBehaviorRecord",["text-edit-dbclick",{text:n.value}]);!function(e){for(var t=e.value.replace(/[^\x00-\xff]/g,"**").split(/\r\n|\r|\n/),r=t.length,i=0,a=0;a<t.length;a++)i=Math.max(t[a].length,i);m(n,"rows",r);m(n,"cols",i);n.style.width="";n.style.height="";n.style.width=200+Math.max(0,n.offsetWidth-m(n,"min-ofw"))+"px";n.style.height=100+Math.max(0,n.offsetHeight-m(n,"min-ofh"))+"px"}(n)}function r(e){if(""===Uo){var t=e.target,r=e.shiftKey;if(t.parentNode==Ka){r&&e.preventDefault();var n=rr(e,!1),i=new Jt([t]),a=m(t,"net");if(!r&&Ht(t,n)){dr(t);Fo.updateOne(t);a&&Qo.buildOneNet(a,!1);i.updateAndSave()}r&&Xt(t,n)}}}function n(e){if(""===Uo){var t=e.target;e.ctrlKey||e.altKey||e.shiftKey||mn(t)}}var i;t.addEventListener("dblclick",function(t){var i=t.target,a=Z(i),o=i.tagName;"TRACK"===a&&i.parentNode==Ka?r(t):i.parentNode==us?n(t):"path"===o&&"part_pcbtext"===m(i.parentNode,"c_partid")&&"dimensionCheck"!==m(i.parentNode,"c_shapetype")&&e(t)},!1)}();t.addEventListener("afterActiveLayerChange",$n,!1);var Ts=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);this.x=t||0;this.y=r||0}function t(e,t,r){var n=e-t;return Math.abs(n)<=(r||M)?0:n<0?-1:1}function r(e,r,n){return 0===t(e,r,n)}function n(e,t,r){return{x:e.x+r*(t.x-e.x),y:e.y+r*(t.y-e.y)}}function i(e,t,r){var n=[e.x,e.y],i=ge(n,r,t.x,t.y);return{x:i[0],y:i[1]}}function a(e,t){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function o(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}function s(e,t){return{x:2*t.x-e.x,y:2*t.y-e.y}}function l(e,t,r){var n=e.x-t.x,i=e.y-t.y,a=r.x-t.x,o=r.y-t.y,s=n*a+i*o,l=Math.sqrt(n*n+i*i),c=Math.sqrt(a*a+o*o),d=s/(l*c);d=d>1?1:d<-1?-1:d;return Math.acos(d)}function c(t,r,n){var i=e.fromTwoPoint(r,t),a=e.fromTwoPoint(r,n);return i.angleTo(a)}function p(e){return{x:Eo.formatLengthSave(e.x),y:Eo.formatLengthSave(e.y)}}function h(e){return e.map(p)}function u(e){return{x:e[0],y:e[1]}}function f(e){return 180*e/Math.PI}function g(e){return e*Math.PI/180}function y(e,t){for(var r=[t],i=t,o=0;o+2<e.length;o++){var s=e[o],l=e[o+1],c=e[o+2],d={x:i.x+l.x-s.x,y:i.y+l.y-s.y},p=a(s,l),u=a(l,c),f=n(s,c,p/(p+u));0===Eo.formatLengthSave(a(l,f))?s.x==c.x?l.y>i.y==l.y>s.y&&(d.y=l.y):s.y==c.y&&l.x>i.x==l.x>s.x&&(d.x=l.x):d=oe(l,f,i,d);i=d;r.push(d)}if(e.length>=2){s=e[e.length-2];l=e[e.length-1];i=r[r.length-1];d={x:i.x+l.x-s.x,y:i.y+l.y-s.y};r.push(d);var g=e.length,y=e[g-1],v=e[g-2];y.x===v.x?y.y>i.y==d.y>i.y&&(d.y=y.y):y.y===v.y&&y.x>i.x==d.x>i.x&&(d.x=y.x)}return h(r)}function v(e,t){var r=e.length,n=t.length;r>1&&n>1&&(e[r-1].x==e[r-2].x?(t[n-1].x,t[n-2].x):e[r-1].y==e[r-2].y&&(t[n-1].y,t[n-2].y))}function x(e,t,n,i){function o(e,t){return r(e.x,t.x)&&r(e.y,t.y)}if(o(e,n)||o(e,i))return{type:"intersect",point:e};if(o(t,n)||o(t,i))return{type:"intersect",point:t};var s,c,d,h,u,f,g,y,v;s=t.x-e.x;c=t.y-e.y;d=i.x-n.x;h=i.y-n.y;g=d*c-h*s;if(r(g,0)){var x=l(e,n,i);if(!r(x,0)&&!r(x,B))return{type:"parallel"};var m=a(e,t),C=a(n,i),L=a(e,n),_=a(e,i),P=a(t,n),A=a(t,i);return r(L+_,C)||r(P+A,C)?{type:"coincide"}:r(L+P,m)||r(_+A,m)?{type:"coincide"}:{type:"sameline"}}y=n.x-e.x;v=n.y-e.y;f=(s*v-c*y)/g;u=(d*v-h*y)/g;return f>=0&&f<=1&&u>=0&&u<=1?{type:"intersect",point:p({x:e.x+u*s,y:e.y+u*c})}:{type:"separated",point:p({x:e.x+u*s,y:e.y+u*c})}}function L(e,t,n,i){function o(e,t){return e.x==t.x&&e.y==t.y}if(o(e,n)||o(e,i)||o(t,n)||o(t,i))return!0;var s,c,d,p,h,u,f,g,y;s=t.x-e.x;c=t.y-e.y;d=i.x-n.x;p=i.y-n.y;f=d*c-p*s;if(r(f,0)){var v=l(e,n,i);if(!r(v,0)&&!r(v,B))return!1;var x=a(e,t),m=a(n,i),C=a(e,n),L=a(e,i),_=a(t,n),P=a(t,i);return!(!r(C+L,m)&&!r(_+P,m))||!(!r(C+_,x)&&!r(L+P,x))}g=n.x-e.x;y=n.y-e.y;u=(s*y-c*g)/f;h=(d*y-p*g)/f;return u>=0&&u<=1&&h>=0&&h<=1}function _(e,t){for(var r=e.length,n=t.length,i=0;i<r-1;i++)if(!Xe(e[i],e[i+1]))for(var a=0;a<n-1;a++)if(!Xe(t[a],t[a+1])&&L(e[i],e[i+1],t[a],t[a+1]))return!0;return!1}function P(e,t){var r=e.net,n=A(r);if(!n)return null;var i,o,s,l,c,d,p,h=e.layerid,u=h==io.ALL,f=Fo.gJsonCache,g=f.PAD||{},y=f.FOOTPRINT||{},v=t&&t.except;for(o in g)if(S(g,o)&&g[o].net==n){i=g[o].layerid;if(!u&&i!=h&&i!=io.ALL)continue;if(e.gId==o)continue;if(v&&v.gId==o)continue;if(p){d=a(e,g[o]);if(d<=c){c=d;p=g[o]}}else{p=g[o];c=a(e,p)}}for(o in y)if(S(y,o)&&y[o].PAD){l=y[o].PAD;for(s in l)if(S(l,s)&&l[s].net==n){i=l[s].layerid;if(!u&&i!=h&&i!=io.ALL)continue;if(e.gId==s)continue;if(v&&v.gId==s)continue;if(p){d=a(e,l[s]);if(d<=c){c=d;p=l[s]}}else{p=l[s];c=a(e,p)}}}return p||null}function A(e){return"_N"==e.slice(-2)?e.slice(0,-1)+"P":"_P"==e.slice(-2)?e.slice(0,-1)+"N":"+"==e.slice(-1)?e.slice(0,-1)+"-":"-"==e.slice(-1)?e.slice(0,-1)+"+":""}function b(e){return e&&/(?:_N|_P|\+|\-)$/.test(e)}function E(t,r){return f(e.fromTwoPoint(t,r).angle())}function I(e,t){var r=d("part_via").cloneNode(!0);m(r,{id:Eo.newId(),c_shapetype:"group",c_etype:"pinpart",net:t||""});C(r,"pointer-events");C(r,"display");m(r.querySelectorAll(":not([c_padid]):not(title)")[0],"r",Eo.formatLengthSave(F.config.viaHoleDiameter/2));m(r.querySelectorAll(":not([c_padid]):not(title)")[1],"r",Eo.formatLengthSave(F.config.viaHoleD/2));yr(r,e.x,e.y);return r}function T(e,t){return zt("polyline",{"stroke-width":F.config.trackWidth,fill:"none",id:Eo.newId(),c_shapetype:"line",c_etype:"wire",layerid:e,points:"",net:t})}function R(e,t,r,n){if(!e||!e.target)return null;var i=function(e){if(!e||!Ka.contains(e))return null;for(;e!=Ka;){if("part_pad"==m(e,"c_partid"))return e;e=e.parentNode}return null}(e.target);if(!i)return null;var a=_s.PAD(i);return n&&a.gId==n?null:t&&a.net!=t?null:r&&a.layerid!=io.ALL&&a.layerid!=r?null:a}function w(e){return(e.nextElementSibling||"").id||""}function N(e){for(var t,r,n=Fo.gJsonCache.SIGNALS[e],i=[],a=[],o=[],s=0;s<n.length;s++)if(n[s]&&("TRACK"==n[s].cmd||"VIA"==n[s].cmd)){t=n[s].gId;r=d(t);if(r&&r.parentNode==Ka){a.push(r);i.push(t)}}if(a.length){for(s=0;s<a.length;s++){t=i[s];r=a[s];o.push(["del",t,w(r),r.cloneNode(!0)]);Fo.removeOne(r);Ro.appendChild(r)}Qo.buildOneNet(e,!1)}return{removes:i,hists:o}}function k(t){function i(e,t,r){var i=a(e,t),o=a(r,t);if(i>o){return n(t,e,o/i)}}function o(t,n,o,s){var l,d,p,h,u=t.slice(-2)[0],f=n[0],g=n[1],v=o.radius,x=v+v;if(!(x<=y))if(r(x,y)){o.radius=Eo.formatLengthSave(y/2-Math.pow(10,-1-lo.pcbDecimalPlaces));o.diameter=Eo.formatLengthSave(2*o.radius);s.radius=o.radius;s.diameter=o.diameter}else{var m=c(u,f,g);if(r(Math.abs(m),Math.PI,.001)||r(m,0,.001)){l=(x-y)/2;p=e.fromTwoPoint(f,g);p.rotate(D).lengthTo(l)}else{var C=c(u,f,s);l=m>0==C>0?v-y/1.84775906:(v-y/2)/.92387953;p=e.fromTwoPoint(f,u);p.rotate(m/2).lengthTo(l)}h=p.clone().invert();p.add(o);h.add(o);a(p,s)<a(h,s)&&(p=h);o.x=p.x;o.y=p.y;d=i(u,f,o);d&&(t[t.length-1]=d);d=i(g,f,o);d&&(n[0]=d);d={x:o.x,y:o.y};t.push(d);n.unshift(d)}}t=O(t);var s=t[0],l=t[1],d=s.viaObj,p=s.pointsPrev,h=s.points,u=l.viaObj,f=l.pointsPrev,g=l.points,y=s.trackWidth;o(p,h,d,u);o(f,g,u,d);return t}e.fromTwoPoint=function(t,r){return new e(r.x-t.x,r.y-t.y)};e.prototype.length=function(e){return Math.sqrt(this.x*this.x+this.y*this.y)};e.prototype.dot=function(e){return this.x*e.x+this.y*e.y};e.prototype.cross=function(e){return this.x*e.y-this.y*e.x};e.prototype.invert=function(){this.x=-this.x;this.y=-this.y;return this};e.prototype.add=function(e){this.x+=e.x;this.y+=e.y;return this};e.prototype.addToPoint=function(e){e.x+=this.x;e.y+=this.y;return e};e.prototype.rotate=function(e){var t=Math.cos(e),r=Math.sin(e),n=this.x*t-this.y*r,i=this.x*r+this.y*t;this.x=n;this.y=i;return this};e.prototype.clone=function(){return new e(this.x,this.y)};e.prototype.multiplyScalar=function(e){this.x*=e;this.y*=e;return this};e.prototype.lengthTo=function(e){return this.multiplyScalar(e/this.length())};e.prototype.clockwiseTo=function(e){return this.cross(e)>=0};e.prototype.angle=function(){return Math.atan2(this.y,this.x)};e.prototype.sameSide=function(e,t){var r=this.cross(e),n=this.cross(t);return Math.abs(r)<=1e-5||Math.abs(n)<=1e-5||(r>0&&n>0||r<0&&n<0)};e.prototype.angleAbsTo=function(e){var t=this.length(),r=e.length();if(0===t||0===r)return 0;var n=this.dot(e)/(t*r);n=n>1?1:n<-1?-1:n;return Math.acos(n)};e.prototype.angleTo=function(e){var t=this.angleAbsTo(e);return this.clockwiseTo(e)?t:-t};var M=1e-5,B=Math.PI,D=Math.PI/2,V=Math.PI/4,F=(Math.PI,{config:{clearance:3,trackWidth:1,viaHoleDiameter:2.4,viaHoleD:1.2,min2Scale:2.4},getConfig:function(e){var t=this.config,r=Zo.canvas.unit;if(e){var n=Fo.gJsonCache.DRCRULE,i=Fo.gJsonCache.netRuleMap||{},a=i[e]||"Default",o=n[a]||{};t.trackWidth=o.trackWidth||1;t.clearance=o.clearance||3;t.viaHoleDiameter=o.viaHoleDiameter||2.4;t.viaHoleD=o.viaHoleD||1.2}return{clearance:Eo.formatLengthShow(Eo.units.convert(t.clearance,"pixel",r)),trackWidth:Eo.formatLengthShow(Eo.units.convert(t.trackWidth,"pixel",r)),unit:r}},setConfig:function(e){var t=+e.clearance,r=+e.trackWidth,n=e.unit,i=/^\d+(\.\d+)?$/;if(r&&i.test(r+"")&&!(r<.2)&&t&&i.test(t+"")&&!(r<.2)&&n&&Eo.units.isUnit(n)){var a=this.config;a.trackWidth=Eo.formatLengthSave(Eo.units.convert(r,n,"pixel"));a.clearance=Eo.formatLengthSave(Eo.units.convert(t,n,"pixel"))}},getPathPoints:function(t,i,s,l,c,d){var h,v,m,C,L=F.config,P=Eo.formatLengthSave(L.clearance+L.trackWidth),A=(Eo.formatLengthSave(P*L.min2Scale),t[t.length-1]),b=i[i.length-1],S=[[],[]],E=[[],[]],I=[],T=[];if(1===c||4===c){S=F.getMustBeginPoints(A,b,s);A=S[0].slice(-1)[0];b=S[1].slice(-1)[0];d=S[2];v=g(d)}if((3===c||4===c)&&l){E=F.getMustBeginPoints(s,l,o(A,b));I=E[0].slice(0).reverse();T=E[1].slice(0).reverse();s=I[0];l=T[0];m=e.fromTwoPoint(T[0],T[1]).angle();C=Math.round(f(m))}var R,w,N,k;if("number"!=typeof d)if(1===t.length)if(3===c){d=f(e.fromTwoPoint(A,s).angle());d=C%90==0?d<=-90?-135:d<=0?-45:d<=90?45:135:d<=-135||d>=135?180:d<=-45?-90:d<=45?0:90}else{d=f(e.fromTwoPoint(A,s).angle());var M=Math.round(f(e.fromTwoPoint(A,b).angle()));M<0&&(M+=180);M=Math.abs(M);if(0===M)d=d>=0?90:-90;else if(90===M)d=d<=90&&d>=-90?0:180;else{R=e.fromTwoPoint(A,b);w=e.fromTwoPoint(A,s);R.angleTo(w)>0?R.rotate(D):R.rotate(-D);d=f(R.angle())}}else{R=e.fromTwoPoint(t[t.length-2],A);d=f(R.angle())}d=45*Math.round(d/45);-180==d&&(d=180);v=g(d);var G=function(e,t,r,n){var i=t.x-e.x>0,a=r.x-e.x>0,o=n.x-t.x>0,s=n.x-r.x>0,l=i==a&&a==o&&o==s,c=t.y-e.y>0,d=r.y-e.y>0,p=n.y-t.y>0,h=n.y-r.y>0,u=c==d&&d==p&&p==h;return l&&u},Y=function(e,t,r,i){var o,s,l,c=e.length,d=x(e[c-2],e[c-1],t[0],t[1]);switch(d.type){case"intersect":e[c-1]=d.point;t[0]=d.point;break;case"separated":if(_([e[c-2],e[c-1],d.point,t[0]],r))t.length=0;else{e[c-1]=d.point;t[0]=d.point}break;case"sameline":case"coincide":G(e[c-2],e[c-1],t[0],t[1])?t[0]=e[c-1]:t.length=0;break;case"parallel":t.length=0}if(0===t.length)for(o=1;o<i.length;o++){l=oe(e[c-2],e[c-1],i[o-1],i[o]);if(l){l=p(l);s=a(e[c-2],l)-P;if(s>=0){l=n(e[c-2],e[c-1],s/a(e[c-2],e[c-1]));e[c-1]=l}break}}};R=e(100*Math.cos(v),100*Math.sin(v));w=e.fromTwoPoint(A,s);N=e.fromTwoPoint(A,b);k=R.clockwiseTo(w);var j,H,X,U,J,z=R.sameSide(w,N),W=[[0,0,0],[3,0,45],[5,2,90],[5,5,135],[3,7,180],[0,7,-135],[-2,5,-90],[-2,2,-45]],Z=W.length,K=[],q=f(w.angle()),$=0;if(r(d,q))X=!0;else{if("number"==typeof C){var Q=Math.abs(d-C),ee=function(e,t){return p({x:e.x+100*Math.cos(t),y:e.y+100*Math.sin(t)})};if(0===Q){var te=function(t,n,i,a){var s=o(t,i),l=e(Math.cos(n),Math.sin(n)).multiplyScalar(100),c=e.fromTwoPoint(t,i),d=l.angleTo(c),p={connected:!1};if(d>-V&&d<V){var h=n+(d<0?-V:V),u=ee(s,h),f=ee(t,n),g=oe(t,f,s,u);d=e.fromTwoPoint(t,g).angle();r(d,-B)&&(d=B);if(!r(d,n))return p;var y=ee(i,a),v=oe(i,y,s,u);d=e.fromTwoPoint(v,i).angle();r(d,-B)&&(d=B);return r(d,a)?{corners:[t,g,v],connected:!0}:p}return p}(A,v,s,m);X=te.connected;X&&(K=te.corners)}else if(45===Q||315===Q){var re=function(t,n,i,a){var o=ee(t,n),s=ee(i,a),l=oe(t,o,i,s),c={connected:!1},d=e.fromTwoPoint(t,l).angle();r(d,-B)&&(d=B);if(!r(d,n))return c;d=e.fromTwoPoint(l,i).angle();r(d,-B)&&(d=B);return r(d,a)?{corners:[t,l],connected:!0}:c}(A,v,s,m);X=re.connected;X&&(K=re.corners)}}if(!X){if(!k)for(U=0;U<Z;U++)W[U][1]=-W[U][1];var ne=1;ne=z?Math.max(.5,3*P/7):Math.max(.2,P/7);if(1!==ne)for(U=0;U<Z;U++){W[U][0]=Eo.formatLengthSave(W[U][0]*ne);W[U][1]=Eo.formatLengthSave(W[U][1]*ne)}var ie=(d+360)%360/45;k||(ie=(Z-ie)%Z);var se=A.x-W[ie][0],le=A.y-W[ie][1];for(U=0;U<Z;U++){W[U][0]+=se;W[U][1]+=le}for(U=ie;U<ie+6;U++){J=U%Z;j=u(W[J]);H=u(W[(J-1+Z)%Z]);R=e.fromTwoPoint(H,j);w=e.fromTwoPoint(j,s);q=f(R.angleTo(w));if(k&&r(q,45)||!k&&r(q,-45)){K.push(j);$++;X=!0;break}if(k&&q>0&&q<45||!k&&q<0&&q>-45){var ce=s.x-j.x,de=s.y-j.y,pe=ce<0?-1:1,he=de<0?-1:1,ue=Math.abs(ce),fe=Math.abs(de),ge=ue<fe,ye=Math.min(ue,fe),ve=Math.max(ue,fe),xe=j.x==H.x||j.y==H.y,me={x:j.x,y:j.y};if(xe)ge?me.y+=(ve-ye)*he:me.x+=(ve-ye)*pe;else{me.x+=ye*pe;me.y+=ye*he}K.push(me);$++;X=!0;break}K.push(j);$++}}}var Ce,Le,_e,Pe,Ae,be;if(X){Ce=t.concat(S[0].slice(1),K.slice(1),[s],I.slice(1));if(1===c||4===c){Pe=y([A].concat(K.slice(1),[s]),b);if(l){U=Pe.length;R=e.fromTwoPoint(Pe[U-2],Pe[U-1]);w=e.fromTwoPoint(T[0],T[1]);Ae=R.angleTo(w);r(Ae,0)||Y(Pe,T,Ce,I)}Le=i.concat(S[1].slice(1),Pe.slice(1),T.slice(1))}else if(i.length>=2){h=i[i.length-2];Pe=y(t.slice(-2).concat(K.slice(1),[s]),h);if(T.length>=2){U=Pe.length;Xe(Pe[U-1],T[0])||Y(Pe,T,Ce,I)}i=O(i);i[i.length-1]=Pe[1];Le=i.slice(0,-2).concat(Pe,T.slice(1))}else{_e=t.concat(K.slice(1),[s]);var Se,Ee=Math.sqrt(ae(_e[0],_e[1],b));if(r(P,Ee))Pe=y(_e,b);else if(3===c){Pe=y(_e.slice(0).reverse(),l);Pe=Pe.reverse();if(r(0,Math.sqrt(ae(Pe[0],Pe[1],b))))Pe[0]=b;else{Se=function(){var t=f(e.fromTwoPoint(Pe[0],Pe[1]).angle());t=45*Math.round(t/45);var r=g(t-45),n={x:b.x+10*Math.cos(r),y:b.y+10*Math.sin(r)},i=oe(Pe[0],Pe[1],b,n),o=a(Pe[1],i);r=g(t+45);n={x:b.x+10*Math.cos(r),y:b.y+10*Math.sin(r)};var s=oe(Pe[0],Pe[1],b,n);return o<a(Pe[1],s)?i:s}();Pe[0]=Se;Pe.unshift(b)}}else{Se=function(){var t=f(e.fromTwoPoint(_e[0],_e[1]).angle());t=45*Math.round(t/45);var r=g(t-45),i={x:b.x+10*Math.cos(r),y:b.y+10*Math.sin(r)},o=oe(_e[0],_e[1],b,i),s=P/a(o,b),l=n(o,b,s),c=a(_e[1],l);r=g(t+45);i={x:b.x+10*Math.cos(r),y:b.y+10*Math.sin(r)};o=oe(_e[0],_e[1],b,i);s=P/a(o,b);connPoint2=n(o,b,s);return c<a(_e[1],connPoint2)?l:connPoint2}();Pe=y(_e,Se);Pe.unshift(b)}if(T.length>=2){U=Pe.length;be=oe(Pe[U-2],Pe[U-1],T[0],T[1]);be&&(Pe[U-1]=p(be));Le=Pe.concat(T.slice(1))}else Le=Pe.concat(T)}}else{Ce=t.concat(S[0].slice(1));Le=i.concat(S[1].slice(1))}return O([Ce,Le])},getMustBeginPoints:function(e,t,r){var l,c,d,u,g,x,m,C,L,_,P,A,b=F.config,S=Eo.formatLengthSave(b.clearance+b.trackWidth),E=Eo.formatLengthSave(S*b.min2Scale),O=e,I=t,T=Eo.formatLengthSave(a(O,I)),R=[O],w=[I],N=o(O,I),k=T>E;l=O;c=I;if(k){d=n(N,l,E/T);R.push(d);u=n(N,c,E/T);w.push(u);A=Eo.formatLengthSave(a(d,u))}else{d=l;u=c;A=T}if(A!=S){_=n(N,l,S/T);P=n(N,c,S/T);g=i(d,_,90);x=i(u,P,-90);C=s(g,_);L=s(x,P);if(a(C,r)<a(g,r)){g=C;x=L}R.push(g);w.push(x);R.push(s(_,g));w.push(s(P,x))}else{g=i(u,d,90);x=i(d,u,-90);C=s(g,d);L=s(x,u);if(a(C,r)<a(g,r)){g=C;x=L}g=n(d,g,2/a(d,g));x=n(u,x,2/a(u,x));R.push(p(g));w.push(p(x))}v(R,w);var M=R[R.length-1],B=R[R.length-2],D=Math.atan2(M.y-B.y,M.x-B.x),V=Math.round(f(D)),G=Math.round(V/45);if(V%45!=0){V=45*G;var Y=[-1,-1,0,1,1,1,0,-1,-1],j=[0,-1,-1,-1,0,1,1,1,0],H=1.5*Y[G+4],X=1.5*j[G+4];m={x:M.x+H,y:M.y+X};R.push(m);var U=y(R.slice(-3),w[w.length-2]);w.pop();w.push(U[1],U[2])}-180==V&&(V=180);var J=a(R[R.length-2],R[R.length-1]);if(J<4){var z=n(R[R.length-2],R[R.length-1],4/J),W=4-J;R[R.length-1]=z;var Z=a(w[w.length-2],w[w.length-1]),K=n(w[w.length-2],w[w.length-1],(Z+W)/Z);w[w.length-1]=K}R=h(R);w=h(w);return[R,w,V]},getDifferentialPairPad:P,getPairNet:A,isDifferentialNet:b,createVia:I,createTrack:T,getVectorDegreeByTwoPoints:E,fixVia:k,getEventPad:R,clearTrackAndViaOfNet:N});return F}();yo={timer:0,timerDelay:200,wheelDelay:100,bigDocPadsCount:300,vb:null,rtree:rbush(),rtreeEnabled:!0,rtreeIdsMap:{},wireframeEnabled:!0,observer:null,init:function(t){yo.debug_times=0;Object.assign(yo,t);if(yo.netTimer){e.clearTimeout(yo.netTimer);yo.netTimer=0}if(lo.updateNetTextTimer){e.clearTimeout(lo.updateNetTextTimer);lo.updateNetTextTimer=0}yo.rtreeEnabled=p('#g1 g[c_partid="part_pad"]').length>yo.bigDocPadsCount},updateRtreeNode:function(e){if(yo.rtreeEnabled&&e.parentNode==Ka){if(e.zoomMgrRtreeNode){yo.rtree.remove(e.zoomMgrRtreeNode);delete e.zoomMgrRtreeNode;delete yo.rtreeIdsMap[e.id]}var t=Eo.getPCBCmdKey(e);if(t&&"RATLINE"!=t){var r=null;try{var r=e.getBBox()}catch(e){}if(r){var n={minX:r.x,minY:r.y,maxX:r.x+r.width,maxY:r.y+r.height,id:e.id};if(r.width&&r.height){e.zoomMgrRtreeNode=n;yo.rtree.insert(n);yo.rtreeIdsMap[e.id]=!0}}}}},removeRtreeNode:function(e){if(yo.rtreeEnabled&&e.zoomMgrRtreeNode){yo.rtree.remove(e.zoomMgrRtreeNode);delete e.zoomMgrRtreeNode;delete yo.rtreeIdsMap[e.id]}},clearRtree:function(){yo.rtree.clear();yo.rtreeIdsMap={}},rebuildRTree:function(){var e=(performance.now(),yo.rtree);yo.clearRtree();for(var t=Ka.children,r=t.length,n=0;n<r;n++){var i=t[n],a=null;if(Eo.getPCBCmdKey(i)){try{a=i.getBBox()}catch(e){}if(a){var o={minX:a.x,minY:a.y,maxX:a.x+a.width,maxY:a.y+a.height,id:i.id};if(a.width&&a.height){i.zoomMgrRtreeNode=o;e.insert(o);yo.rtreeIdsMap[i.id]=!0}else i.zoomMgrRtreeNode&&delete i.zoomMgrRtreeNode}else if(i.zoomMgrRtreeNode){e.remove(i.zoomMgrRtreeNode);delete i.zoomMgrRtreeNode}}}},showAll:function(){if(yo.rtreeEnabled){C(p("#g1 > [view-out]"),"view-out")}},setViewBox:function(){var e,t,r,n=m(Go,"viewBox").split(" ").map(Number),i=yo.vb,a=i[2]<n[2],o=yo.rtree;if(yo.rtreeEnabled)if(a){e=o.search({minX:i[0],minY:i[1],maxX:i[0]+i[2],maxY:i[1]+i[3]});r={};e.forEach(function(e){r[e.id]=!0});for(var s=p("#g1 > *:not([view-out]):not(.active):not(.selected):not(:hover)"),l=0,c=s.length;l<c;l++){var h=s[l],u=Eo.getPCBCmdKey(h);u&&"RATLINE"!=u&&(!r[h.id]&&yo.rtreeIdsMap[h.id]&&m(h,"view-out","1"))}}else{t=Array.from(p("#g1 > [view-out]"));e=o.search({minX:i[0],minY:i[1],maxX:i[0]+i[2],maxY:i[1]+i[3]});r={};e.forEach(function(e){r[e.id]=!0});t.forEach(function(e){r[e.id]&&C(d(e.id),"view-out")})}m(Go,"viewBox",yo.vb.join(" "))},updateRuler:function(){sr("updateRuler",[{zoom:wo,unit:Zo.canvas.unit,vbX:yo.vb[0],vbY:yo.vb[1],originX:Zo.canvas.originX,originY:Zo.canvas.originY}])},updateGrid:function(){var e=yo.px1,t=yo.vb,r=+Zo.adsorbGrid.gridSize;(!r||r<.1)&&(r=.1);for(;r*wo<5;)r*=r*wo*2>=5?2:r*wo*5>=5?5:10;m(d("gridPattern"),{width:r,height:r,x:Zo.canvas.originX,y:Zo.canvas.originY});m(d("gridPattern2"),{width:r,height:r,x:Zo.canvas.originX+e,y:Zo.canvas.originY+e});m(d("gridCell"),{width:e,height:e});m(d("gridCell2"),{"stroke-width":e,d:"M10 0V10H-10".replace(/10/g,r)});var n={x:t[0],y:t[1],width:t[2],height:t[3]};m(d("gridBg"),n);m(d("grid1"),n);var i=.5/wo;m(d("gridOH"),{"stroke-width":e,x1:t[0],x2:t[0]+t[2],y1:Zo.canvas.originY+i,y2:Zo.canvas.originY+i});m(d("gridOV"),{"stroke-width":e,x1:Zo.canvas.originX+i,x2:Zo.canvas.originX+i,y1:t[1],y2:t[1]+t[3]})},updatePinDot:function(){m(p("circle.pindot, #gPinDots circle"),{r:4*yo.px1})},updateControl:function(){var e=yo.px1;if(!lo.vectorEffectSupported){var t=Eo.toFixed(3*e,2);m(ys.children,{"stroke-width":e,"stroke-dasharray":t+","+t});m(gs.children,{"stroke-width":e,"stroke-dasharray":t+","+t});m(p("#gControlDots>*"),{"stroke-width":e});m(p("#gControlLocks rect"),{"stroke-width":e,"stroke-dasharray":t+","+t})}m(jo,"r",4*e);if("visible"===m(fs.children[0],"visibility")){var r=30/(wo<=6?6:wo);wo>=20&&(r=1.5);var n=m(jo[0],"cx"),i=m(jo[0],"cy");m(fs.children[0],{x:Number(n)-r/2});m(fs.children[0],{y:Number(i)-r/2});m(fs.children[0],{width:r});m(fs.children[0],{height:r})}},updatePx1:function(){var e=yo.px1,t=yo.vb;if(!lo.vectorEffectSupported){var r=Eo.toFixed(3*e,2);m(hs,"stroke-width",e);hs.style.strokeDasharray=r+","+r;var i=d("cross-x-big"),a=d("cross-y-big");m([i,a],{"stroke-width":e,"stroke-dasharray":r+","+r});i.style.strokeDasharray=r+","+r;a.style.strokeDasharray=r+","+r;var o=m(i,"d");if(o.indexOf("v")>0){var s=m(a,"d"),l=50/n,c=o.match(/\d+(?:\.\d*)?/)[0],p=s.match(/\d+(?:\.\d*)?/g)[1];c=c-c%(100/n)+l;p=p-p%(100/n)+l;c=Math.round(1e6*c)/1e6;p=Math.round(1e6*p)/1e6;m(i,"d","M"+c+" "+t[1]+" v"+t[3]);m(a,"d","M"+t[0]+" "+p+" h"+t[2])}}!function(e,t){if(e){var r=e.sheet.cssRules[0];r&&(r.style.strokeWidth=t)}}(d("px1Style"),e);!function(e){if(e)if(wo<1){var t,r=e.sheet,n=r.cssRules,i=n.length,a=1/wo;for(t=i-1;t>=0;t--)r.deleteRule(t);var o="";for(t=1;t<a;t++)o+=',#g1 [stroke-width="'+t+'"]';o=o.substr(1);lo.vectorEffectSupported?o+="{stroke-width:1;vector-effect:non-scaling-stroke;}":o+="{stroke-width:"+Eo.toFixed(a+99e-7,5)+";}";r.insertRule(o,0);e.disabled=!1}else e.disabled=!0}(d("thinLineStyle"));lo.vectorEffectSupported||function(t){if(t){t.sheet.cssRules[0].style.strokeWidth=Ao?1.04*e:e}}(d("ratlineStyle"));!function(e){if(e){m(e.childNodes,"stroke-width",2/wo)}}(d("gDrcDots"))},updateCursors:function(){for(var e=function(e){return e/wo},t=p("#gCursors>image"),r=0;r<t.length;r++){var n=Wo[t[r].id];if(n&&n.trs){var i=1==wo?n.trs:n.trs.replace(/\-?[\d\.]+/g,e);m(t[r],{width:n.width/wo,height:n.height/wo,transform:i})}}},updateNetText:function(){var e=yo.px1,t=yo.gZoomOld,r=yo.zoomTowards,n=d("gNets")||lo.gNets,i="none"!=m(n,"display"),a=wo>=8&&!1!==lo.pcbNetTextVisible,o=(Math.min(40/t,Math.max(1,10/t)),Math.min(40/wo,Math.max(1,10/wo)));m(n,"font-size",o);m(n,"stroke-width",Math.min(e,.02)+"");if(!lo.netTextCharWidthBase){var s=d("gNetsTextRuler");m(s,"font-size","10");lo.netTextCharWidthBase=Eo.svg.getBBox(s).width/s.textContent.length/10}lo.netTextCharWidth=lo.netTextCharWidthBase*o;if(r){m(n,"display",a?"":"none");a!=i&&m(n.children,"display","none");gi(void 0,void 0,r)}},replaceCopperAsImage:function(){var e=function(e,t,r,n,i){var a=URL.createObjectURL(i),o=zt("image");m(o,"xlink:href",a);m(o,"attachedcopperid",m(e,"attachedcopperid"));m(o,"old-id",m(e,"id")||"");m(o,n);Ka.replaceChild(e,o);jt(o);if(e.zoomMgrRtreeNode){e.zoomMgrRtreeNode.id=o.id;delete e.zoomMgrRtreeNode}else{var s={minX:r.x,minY:r.y,maxX:r.x+r.width,maxY:r.y+r.height,id:o.id};o.zoomMgrRtreeNode=s;yo.rtree.insert(s)}};Array.from(p("#g1 > [attachedcopperid]")).forEach(function(r){var n=r.getBBox();if(n.width&&n.height){var i={x:n.x,y:n.y,width:Math.ceil(n.width),height:Math.ceil(n.height)},a=Ls.getLayersCache()[m(r,"layerid")].color,o=r.getPathData(),s=t.createElement("canvas"),l=s.getContext("2d"),c=0,d=0,p=0,h=0;m(s,{width:i.width,height:i.height});l.fillStyle=a;for(var u=0;u<o.length;u++){var f=o[u],g=f.values;switch(f.type){case"M":c=g[0];d=g[1];p=g[0];h=g[1];u>0&&l.fill();l.beginPath();l.lineTo(p,h);break;case"V":h=g[0];l.lineTo(p,h);break;case"H":p=g[0];l.lineTo(p,h);break;case"L":p=g[0];h=g[1];l.lineTo(p,h);break;case"Z":l.closePath();p=c;h=d;break;default:throw Error("not implemented type: "+f.type)}}o.length&&l.fill();s.toBlob(e.bind(null,r,s,n,i),"image/png")}})},hideAllCoppers:function(){for(var e=p("#g1 > [attachedcopperid]"),t=0,r=e.length;t<r;t++)e[t].style.display="none"},showAllCoppers:function(){for(var e=p("#g1 > [attachedcopperid]"),t=0,r=e.length;t<r;t++)e[t].style.display=""},isWaiting:function(){return!1},getWaitingZoomOption:function(){return yo._waitingZoomOption},setWaitingZoomOption:function(e){yo._waitingZoomOption=e},runTask:function(t){var r=Is==ao.PCB||Is==ao.PCBMODULE,n=!0===bo.getCacheObj("PCBZoomOptimizeEnabled");if(r&&n){var i=performance.now();yo.count||(yo.count=0);yo.timeStart||(yo.timeStart=i);if(i-yo.timeStart>3e3){yo.timeStart=i;yo.count=0}yo.count++;yo.wireframeEnabled=p('#g1 g[c_partid="part_pad"]').length>yo.bigDocPadsCount;yo.timer||yo.wireframeEnabled;yo.wireframeEnabled&&yo.hideAllCoppers();Ka.style.pointerEvents="none";d("grid1").style.display="none";setTimeout(function(e){return function(){yo.getWaitingZoomOption()&&setTimeout(function(){var e=yo.getWaitingZoomOption();yo.setWaitingZoomOption(null);Vr(e.nextZoom,{clientX:e.clientX,clientY:e.clientY});sr("setZoomText",[e.nextZoom+"%"])},0)}}(),0);yo.setViewBox();yo.updateGrid();yo.updateCursors();yo.timer&&e.clearTimeout(yo.timer);yo.timer=setTimeout(function(){var e=performance.now();yo.wireframeEnabled&&yo.showAllCoppers();Ka.style.pointerEvents="";d("grid1").style.display="";if(e-yo.timeStart>3e3){yo.timeStart=e;yo.count=0}yo.timer=0;yo.updateRuler();yo.updatePinDot();yo.updateControl();yo.updatePx1();yo.updateNetText()},yo.wireframeEnabled?yo.timerDelay:0)}else{yo.setViewBox();yo.updateRuler();yo.updateGrid();yo.updatePinDot();yo.updateControl();yo.updatePx1();yo.updateCursors();yo.updateNetText()}}}}(window,document);
//# sourceMappingURL=editorPCB.min.map